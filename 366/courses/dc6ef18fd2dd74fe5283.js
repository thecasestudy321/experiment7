!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=195)}([function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){function r(e,t){for(var i in e)t[i]=e[i]}function n(e,t,i){return s(e,t,i)}var o=i(3),s=o.Buffer;s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=o:(r(o,t),t.Buffer=n),r(s,n),n.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return s(e,t,i)},n.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"==typeof i?r.fill(t,i):r.fill(t):r.fill(0),r},n.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s(e)},n.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},function(e,t,i){"use strict";(function(e){function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function n(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,i){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return s(this,e,t,i)}function s(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,i,r):"string"==typeof t?c(e,t,i):d(e,t)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t,i,r){return a(t),t<=0?n(e,t):void 0!==i?"string"==typeof r?n(e,t).fill(i,r):n(e,t).fill(i):n(e,t)}function h(e,t){if(a(t),e=n(e,t<0?0:0|p(t)),!o.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function c(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!o.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,i);e=n(e,r);var s=e.write(t,i);return s!==r&&(e=e.slice(0,s)),e}function u(e,t){var i=t.length<0?0:0|p(t.length);e=n(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function f(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=u(e,t),e}function d(e,t){if(o.isBuffer(t)){var i=0|p(t.length);return e=n(e,i),0===e.length?e:(t.copy(e,0,0,i),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||q(t.length)?n(e,0):u(e,t);if("Buffer"===t.type&&J(t.data))return u(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function p(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function m(e){return+e!=e&&(e=0),o.alloc(+e)}function g(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return Y(e).length;default:if(r)return j(e).length;t=(""+t).toLowerCase(),r=!0}}function v(e,t,i){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if(i>>>=0,t>>>=0,i<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,i);case"utf8":case"utf-8":return P(this,t,i);case"ascii":return R(this,t,i);case"latin1":case"binary":return D(this,t,i);case"base64":return A(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function _(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=o.from(t,r)),o.isBuffer(t))return 0===t.length?-1:b(e,t,i,r,n);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):b(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function b(e,t,i,r,n){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,i/=2}var h;if(n){var c=-1;for(h=i;h<a;h++)if(o(e,h)===o(t,-1===c?0:h-c)){if(-1===c&&(c=h),h-c+1===l)return c*s}else-1!==c&&(h-=h-c),c=-1}else for(i+l>a&&(i=a-l),h=i;h>=0;h--){for(var u=!0,f=0;f<l;f++)if(o(e,h+f)!==o(t,f)){u=!1;break}if(u)return h}return-1}function x(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?(r=Number(r))>n&&(r=n):r=n;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[i+s]=a}return s}function T(e,t,i,r){return K(j(t,e.length-i),e,i,r)}function E(e,t,i,r){return K(W(t),e,i,r)}function S(e,t,i,r){return E(e,t,i,r)}function w(e,t,i,r){return K(Y(t),e,i,r)}function M(e,t,i,r){return K(X(t,e.length-i),e,i,r)}function A(e,t,i){return 0===t&&i===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,i))}function P(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o=e[n],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n+a<=i){var l,h,c,u;switch(a){case 1:o<128&&(s=o);break;case 2:l=e[n+1],128==(192&l)&&(u=(31&o)<<6|63&l)>127&&(s=u);break;case 3:l=e[n+1],h=e[n+2],128==(192&l)&&128==(192&h)&&(u=(15&o)<<12|(63&l)<<6|63&h)>2047&&(u<55296||u>57343)&&(s=u);break;case 4:l=e[n+1],h=e[n+2],c=e[n+3],128==(192&l)&&128==(192&h)&&128==(192&c)&&(u=(15&o)<<18|(63&l)<<12|(63&h)<<6|63&c)>65535&&u<1114112&&(s=u)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),n+=a}return C(r)}function C(e){var t=e.length;if(t<=$)return String.fromCharCode.apply(String,e);for(var i="",r=0;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=$));return i}function R(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function D(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function I(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var n="",o=t;o<i;++o)n+=H(e[o]);return n}function O(e,t,i){for(var r=e.slice(t,i),n="",o=0;o<r.length;o+=2)n+=String.fromCharCode(r[o]+256*r[o+1]);return n}function F(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,i,r,n,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function B(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-i,2);n<o;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function N(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-i,4);n<o;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function k(e,t,i,r,n,o){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function V(e,t,i,r,n){return n||k(e,t,i,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(e,t,i,r,23,4),i+4}function U(e,t,i,r,n){return n||k(e,t,i,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(e,t,i,r,52,8),i+8}function z(e){if(e=G(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function G(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],s=0;s<r;++s){if((i=e.charCodeAt(s))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&o.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function W(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}function X(e,t){for(var i,r,n,o=[],s=0;s<e.length&&!((t-=2)<0);++s)i=e.charCodeAt(s),r=i>>8,n=i%256,o.push(n),o.push(r);return o}function Y(e){return Q.toByteArray(z(e))}function K(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function q(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var Q=i(85),Z=i(86),J=i(42);t.Buffer=o,t.SlowBuffer=m,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,i){return s(null,e,t,i)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,i){return l(null,e,t,i)},o.allocUnsafe=function(e){return h(null,e)},o.allocUnsafeSlow=function(e){return h(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,s=Math.min(i,r);n<s;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!J(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=o.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var s=e[i];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,n),n+=s.length}return r},o.byteLength=g,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?P(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,i,r,n){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&t>=i)return 0;if(r>=n)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,r>>>=0,n>>>=0,this===e)return 0;for(var s=n-r,a=i-t,l=Math.min(s,a),h=this.slice(r,n),c=e.slice(t,i),u=0;u<l;++u)if(h[u]!==c[u]){s=h[u],a=c[u];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},o.prototype.indexOf=function(e,t,i){return _(this,e,t,i,!0)},o.prototype.lastIndexOf=function(e,t,i){return _(this,e,t,i,!1)},o.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return x(this,e,t,i);case"utf8":case"utf-8":return T(this,e,t,i);case"ascii":return E(this,e,t,i);case"latin1":case"binary":return S(this,e,t,i);case"base64":return w(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,i);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;o.prototype.slice=function(e,t){var i=this.length;e=~~e,t=void 0===t?i:~~t,e<0?(e+=i)<0&&(e=0):e>i&&(e=i),t<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=o.prototype;else{var n=t-e;r=new o(n,void 0);for(var s=0;s<n;++s)r[s]=this[s+e]}return r},o.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||F(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},o.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||F(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},o.prototype.readUInt8=function(e,t){return t||F(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||F(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||F(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||F(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||F(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||F(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return n*=128,r>=n&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||F(e,t,this.length);for(var r=t,n=1,o=this[e+--r];r>0&&(n*=256);)o+=this[e+--r]*n;return n*=128,o>=n&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||F(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||F(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt16BE=function(e,t){t||F(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt32LE=function(e,t){return t||F(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||F(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||F(e,4,this.length),Z.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||F(e,4,this.length),Z.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||F(e,8,this.length),Z.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||F(e,8,this.length),Z.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,i,r){if(e=+e,t|=0,i|=0,!r){L(this,e,t,i,Math.pow(2,8*i)-1,0)}var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},o.prototype.writeUIntBE=function(e,t,i,r){if(e=+e,t|=0,i|=0,!r){L(this,e,t,i,Math.pow(2,8*i)-1,0)}var n=i-1,o=1;for(this[t+n]=255&e;--n>=0&&(o*=256);)this[t+n]=e/o&255;return t+i},o.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);L(this,e,t,i,n-1,-n)}var o=0,s=1,a=0;for(this[t]=255&e;++o<i&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},o.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);L(this,e,t,i,n-1,-n)}var o=i-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+i},o.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,i){return V(this,e,t,!0,i)},o.prototype.writeFloatBE=function(e,t,i){return V(this,e,t,!1,i)},o.prototype.writeDoubleLE=function(e,t,i){return U(this,e,t,!0,i)},o.prototype.writeDoubleBE=function(e,t,i){return U(this,e,t,!1,i)},o.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n,s=r-i;if(this===e&&i<t&&t<r)for(n=s-1;n>=0;--n)e[n+t]=this[n+i];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(n=0;n<s;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},o.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<i;++s)this[s]=e;else{var a=o.isBuffer(e)?e:j(new o(e,r).toString()),l=a.length;for(s=0;s<i-t;++s)this[s+t]=a[s%l]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,i(1))},function(e,t,i){(function(e){!function(e,t){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function n(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function o(e,t,i){if(o.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}function s(e,t,i){for(var r=0,n=Math.min(e.length,i),o=t;o<n;o++){var s=e.charCodeAt(o)-48;r<<=4,r|=s>=49&&s<=54?s-49+10:s>=17&&s<=22?s-17+10:15&s}return r}function a(e,t,i,r){for(var n=0,o=Math.min(e.length,i),s=t;s<o;s++){var a=e.charCodeAt(s)-48;n*=r,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}function l(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var r=i/26|0,n=i%26;t[i]=(e.words[r]&1<<n)>>>n}return t}function h(e,t,i){i.negative=t.negative^e.negative;var r=e.length+t.length|0;i.length=r,r=r-1|0;var n=0|e.words[0],o=0|t.words[0],s=n*o,a=67108863&s,l=s/67108864|0;i.words[0]=a;for(var h=1;h<r;h++){for(var c=l>>>26,u=67108863&l,f=Math.min(h,t.length-1),d=Math.max(0,h-e.length+1);d<=f;d++){var p=h-d|0;n=0|e.words[p],o=0|t.words[d],s=n*o+u,c+=s/67108864|0,u=67108863&s}i.words[h]=0|u,l=0|c}return 0!==l?i.words[h]=0|l:i.length--,i.strip()}function c(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var r=0,n=0,o=0;o<i.length-1;o++){var s=n;n=0;for(var a=67108863&r,l=Math.min(o,t.length-1),h=Math.max(0,o-e.length+1);h<=l;h++){var c=o-h,u=0|e.words[c],f=0|t.words[h],d=u*f,p=67108863&d;s=s+(d/67108864|0)|0,p=p+a|0,a=67108863&p,s=s+(p>>>26)|0,n+=s>>>26,s&=67108863}i.words[o]=a,r=s,s=n}return 0!==r?i.words[o]=r:i.length--,i.strip()}function u(e,t,i){return(new f).mulp(e,t,i)}function f(e,t){this.x=e,this.y=t}function d(e,t){this.name=e,this.p=new o(t,16),this.n=this.p.bitLength(),this.k=new o(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function p(){d.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function m(){d.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function g(){d.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function v(){d.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function y(e){if("string"==typeof e){var t=o._prime(e);this.m=t.p,this.prime=t}else r(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){y.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new o(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}"object"==typeof e?e.exports=o:t.BN=o,o.BN=o,o.wordSize=26;var b;try{b=i(124).Buffer}catch(e){}o.isBN=function(e){return e instanceof o||null!==e&&"object"==typeof e&&e.constructor.wordSize===o.wordSize&&Array.isArray(e.words)},o.max=function(e,t){return e.cmp(t)>0?e:t},o.min=function(e,t){return e.cmp(t)<0?e:t},o.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),r(t===(0|t)&&t>=2&&t<=36),e=e.toString().replace(/\s+/g,"");var n=0;"-"===e[0]&&n++,16===t?this._parseHex(e,n):this._parseBase(e,t,n),"-"===e[0]&&(this.negative=1),this.strip(),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(r(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},o.prototype._initArray=function(e,t,i){if(r("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var o,s,a=0;if("be"===i)for(n=e.length-1,o=0;n>=0;n-=3)s=e[n]|e[n-1]<<8|e[n-2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);else if("le"===i)for(n=0,o=0;n<e.length;n+=3)s=e[n]|e[n+1]<<8|e[n+2]<<16,this.words[o]|=s<<a&67108863,this.words[o+1]=s>>>26-a&67108863,(a+=24)>=26&&(a-=26,o++);return this.strip()},o.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var r,n,o=0;for(i=e.length-6,r=0;i>=t;i-=6)n=s(e,i,i+6),this.words[r]|=n<<o&67108863,this.words[r+1]|=n>>>26-o&4194303,(o+=24)>=26&&(o-=26,r++);i+6!==t&&(n=s(e,t,i+6),this.words[r]|=n<<o&67108863,this.words[r+1]|=n>>>26-o&4194303),this.strip()},o.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var r=0,n=1;n<=67108863;n*=t)r++;r--,n=n/t|0;for(var o=e.length-i,s=o%r,l=Math.min(o,o-s)+i,h=0,c=i;c<l;c+=r)h=a(e,c,c+r,t),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==s){var u=1;for(h=a(e,c,e.length,t),c=0;c<s;c++)u*=t;this.imuln(u),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}},o.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},o.prototype.clone=function(){var e=new o(null);return this.copy(e),e},o.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},o.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},o.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},o.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var x=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],T=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],E=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];o.prototype.toString=function(e,t){e=e||10,t=0|t||1;var i;if(16===e||"hex"===e){i="";for(var n=0,o=0,s=0;s<this.length;s++){var a=this.words[s],l=(16777215&(a<<n|o)).toString(16);o=a>>>24-n&16777215,i=0!==o||s!==this.length-1?x[6-l.length]+l+i:l+i,n+=2,n>=26&&(n-=26,s--)}for(0!==o&&(i=o.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var h=T[e],c=E[e];i="";var u=this.clone();for(u.negative=0;!u.isZero();){var f=u.modn(c).toString(e);u=u.idivn(c),i=u.isZero()?f+i:x[h-f.length]+f+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}r(!1,"Base should be between 2 and 36")},o.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},o.prototype.toJSON=function(){return this.toString(16)},o.prototype.toBuffer=function(e,t){return r(void 0!==b),this.toArrayLike(b,e,t)},o.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},o.prototype.toArrayLike=function(e,t,i){var n=this.byteLength(),o=i||Math.max(1,n);r(n<=o,"byte array longer than desired length"),r(o>0,"Requested array length <= 0"),this.strip();var s,a,l="le"===t,h=new e(o),c=this.clone();if(l){for(a=0;!c.isZero();a++)s=c.andln(255),c.iushrn(8),h[a]=s;for(;a<o;a++)h[a]=0}else{for(a=0;a<o-n;a++)h[a]=0;for(a=0;!c.isZero();a++)s=c.andln(255),c.iushrn(8),h[o-a-1]=s}return h},Math.clz32?o.prototype._countBits=function(e){return 32-Math.clz32(e)}:o.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},o.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},o.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},o.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},o.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},o.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},o.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},o.prototype.isNeg=function(){return 0!==this.negative},o.prototype.neg=function(){return this.clone().ineg()},o.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},o.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},o.prototype.ior=function(e){return r(0==(this.negative|e.negative)),this.iuor(e)},o.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},o.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},o.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},o.prototype.iand=function(e){return r(0==(this.negative|e.negative)),this.iuand(e)},o.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},o.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},o.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var r=0;r<i.length;r++)this.words[r]=t.words[r]^i.words[r];if(this!==t)for(;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this.strip()},o.prototype.ixor=function(e){return r(0==(this.negative|e.negative)),this.iuxor(e)},o.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},o.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},o.prototype.inotn=function(e){r("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var n=0;n<t;n++)this.words[n]=67108863&~this.words[n];return i>0&&(this.words[n]=~this.words[n]&67108863>>26-i),this.strip()},o.prototype.notn=function(e){return this.clone().inotn(e)},o.prototype.setn=function(e,t){r("number"==typeof e&&e>=0);var i=e/26|0,n=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<n:this.words[i]&~(1<<n),this.strip()},o.prototype.iadd=function(e){var t;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();var i,r;this.length>e.length?(i=this,r=e):(i=e,r=this);for(var n=0,o=0;o<r.length;o++)t=(0|i.words[o])+(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<i.length;o++)t=(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=i.length,0!==n)this.words[this.length]=n,this.length++;else if(i!==this)for(;o<i.length;o++)this.words[o]=i.words[o];return this},o.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},o.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i=this.cmp(e);if(0===i)return this.negative=0,this.length=1,this.words[0]=0,this;var r,n;i>0?(r=this,n=e):(r=e,n=this);for(var o=0,s=0;s<n.length;s++)t=(0|r.words[s])-(0|n.words[s])+o,o=t>>26,this.words[s]=67108863&t;for(;0!==o&&s<r.length;s++)t=(0|r.words[s])+o,o=t>>26,this.words[s]=67108863&t;if(0===o&&s<r.length&&r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this.length=Math.max(this.length,s),r!==this&&(this.negative=1),this.strip()},o.prototype.sub=function(e){return this.clone().isub(e)};var S=function(e,t,i){var r,n,o,s=e.words,a=t.words,l=i.words,h=0,c=0|s[0],u=8191&c,f=c>>>13,d=0|s[1],p=8191&d,m=d>>>13,g=0|s[2],v=8191&g,y=g>>>13,_=0|s[3],b=8191&_,x=_>>>13,T=0|s[4],E=8191&T,S=T>>>13,w=0|s[5],M=8191&w,A=w>>>13,P=0|s[6],C=8191&P,R=P>>>13,D=0|s[7],I=8191&D,O=D>>>13,F=0|s[8],L=8191&F,B=F>>>13,N=0|s[9],k=8191&N,V=N>>>13,U=0|a[0],z=8191&U,G=U>>>13,H=0|a[1],j=8191&H,W=H>>>13,X=0|a[2],Y=8191&X,K=X>>>13,q=0|a[3],Q=8191&q,Z=q>>>13,J=0|a[4],$=8191&J,ee=J>>>13,te=0|a[5],ie=8191&te,re=te>>>13,ne=0|a[6],oe=8191&ne,se=ne>>>13,ae=0|a[7],le=8191&ae,he=ae>>>13,ce=0|a[8],ue=8191&ce,fe=ce>>>13,de=0|a[9],pe=8191&de,me=de>>>13;i.negative=e.negative^t.negative,i.length=19,r=Math.imul(u,z),n=Math.imul(u,G),n=n+Math.imul(f,z)|0,o=Math.imul(f,G);var ge=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(ge>>>26)|0,ge&=67108863,r=Math.imul(p,z),n=Math.imul(p,G),n=n+Math.imul(m,z)|0,o=Math.imul(m,G),r=r+Math.imul(u,j)|0,n=n+Math.imul(u,W)|0,n=n+Math.imul(f,j)|0,o=o+Math.imul(f,W)|0;var ve=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(ve>>>26)|0,ve&=67108863,r=Math.imul(v,z),n=Math.imul(v,G),n=n+Math.imul(y,z)|0,o=Math.imul(y,G),r=r+Math.imul(p,j)|0,n=n+Math.imul(p,W)|0,n=n+Math.imul(m,j)|0,o=o+Math.imul(m,W)|0,r=r+Math.imul(u,Y)|0,n=n+Math.imul(u,K)|0,n=n+Math.imul(f,Y)|0,o=o+Math.imul(f,K)|0;var ye=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(ye>>>26)|0,ye&=67108863,r=Math.imul(b,z),n=Math.imul(b,G),n=n+Math.imul(x,z)|0,o=Math.imul(x,G),r=r+Math.imul(v,j)|0,n=n+Math.imul(v,W)|0,n=n+Math.imul(y,j)|0,o=o+Math.imul(y,W)|0,r=r+Math.imul(p,Y)|0,n=n+Math.imul(p,K)|0,n=n+Math.imul(m,Y)|0,o=o+Math.imul(m,K)|0,r=r+Math.imul(u,Q)|0,n=n+Math.imul(u,Z)|0,n=n+Math.imul(f,Q)|0,o=o+Math.imul(f,Z)|0;var _e=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(_e>>>26)|0,_e&=67108863,r=Math.imul(E,z),n=Math.imul(E,G),n=n+Math.imul(S,z)|0,o=Math.imul(S,G),r=r+Math.imul(b,j)|0,n=n+Math.imul(b,W)|0,n=n+Math.imul(x,j)|0,o=o+Math.imul(x,W)|0,r=r+Math.imul(v,Y)|0,n=n+Math.imul(v,K)|0,n=n+Math.imul(y,Y)|0,o=o+Math.imul(y,K)|0,r=r+Math.imul(p,Q)|0,n=n+Math.imul(p,Z)|0,n=n+Math.imul(m,Q)|0,o=o+Math.imul(m,Z)|0,r=r+Math.imul(u,$)|0,n=n+Math.imul(u,ee)|0,n=n+Math.imul(f,$)|0,o=o+Math.imul(f,ee)|0;var be=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(be>>>26)|0,be&=67108863,r=Math.imul(M,z),n=Math.imul(M,G),n=n+Math.imul(A,z)|0,o=Math.imul(A,G),r=r+Math.imul(E,j)|0,n=n+Math.imul(E,W)|0,n=n+Math.imul(S,j)|0,o=o+Math.imul(S,W)|0,r=r+Math.imul(b,Y)|0,n=n+Math.imul(b,K)|0,n=n+Math.imul(x,Y)|0,o=o+Math.imul(x,K)|0,r=r+Math.imul(v,Q)|0,n=n+Math.imul(v,Z)|0,n=n+Math.imul(y,Q)|0,o=o+Math.imul(y,Z)|0,r=r+Math.imul(p,$)|0,n=n+Math.imul(p,ee)|0,n=n+Math.imul(m,$)|0,o=o+Math.imul(m,ee)|0,r=r+Math.imul(u,ie)|0,n=n+Math.imul(u,re)|0,n=n+Math.imul(f,ie)|0,o=o+Math.imul(f,re)|0;var xe=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(xe>>>26)|0,xe&=67108863,r=Math.imul(C,z),n=Math.imul(C,G),n=n+Math.imul(R,z)|0,o=Math.imul(R,G),r=r+Math.imul(M,j)|0,n=n+Math.imul(M,W)|0,n=n+Math.imul(A,j)|0,o=o+Math.imul(A,W)|0,r=r+Math.imul(E,Y)|0,n=n+Math.imul(E,K)|0,n=n+Math.imul(S,Y)|0,o=o+Math.imul(S,K)|0,r=r+Math.imul(b,Q)|0,n=n+Math.imul(b,Z)|0,n=n+Math.imul(x,Q)|0,o=o+Math.imul(x,Z)|0,r=r+Math.imul(v,$)|0,n=n+Math.imul(v,ee)|0,n=n+Math.imul(y,$)|0,o=o+Math.imul(y,ee)|0,r=r+Math.imul(p,ie)|0,n=n+Math.imul(p,re)|0,n=n+Math.imul(m,ie)|0,o=o+Math.imul(m,re)|0,r=r+Math.imul(u,oe)|0,n=n+Math.imul(u,se)|0,n=n+Math.imul(f,oe)|0,o=o+Math.imul(f,se)|0;var Te=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Te>>>26)|0,Te&=67108863,r=Math.imul(I,z),n=Math.imul(I,G),n=n+Math.imul(O,z)|0,o=Math.imul(O,G),r=r+Math.imul(C,j)|0,n=n+Math.imul(C,W)|0,n=n+Math.imul(R,j)|0,o=o+Math.imul(R,W)|0,r=r+Math.imul(M,Y)|0,n=n+Math.imul(M,K)|0,n=n+Math.imul(A,Y)|0,o=o+Math.imul(A,K)|0,r=r+Math.imul(E,Q)|0,n=n+Math.imul(E,Z)|0,n=n+Math.imul(S,Q)|0,o=o+Math.imul(S,Z)|0,r=r+Math.imul(b,$)|0,n=n+Math.imul(b,ee)|0,n=n+Math.imul(x,$)|0,o=o+Math.imul(x,ee)|0,r=r+Math.imul(v,ie)|0,n=n+Math.imul(v,re)|0,n=n+Math.imul(y,ie)|0,o=o+Math.imul(y,re)|0,r=r+Math.imul(p,oe)|0,n=n+Math.imul(p,se)|0,n=n+Math.imul(m,oe)|0,o=o+Math.imul(m,se)|0,r=r+Math.imul(u,le)|0,n=n+Math.imul(u,he)|0,n=n+Math.imul(f,le)|0,o=o+Math.imul(f,he)|0;var Ee=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,r=Math.imul(L,z),n=Math.imul(L,G),n=n+Math.imul(B,z)|0,o=Math.imul(B,G),r=r+Math.imul(I,j)|0,n=n+Math.imul(I,W)|0,n=n+Math.imul(O,j)|0,o=o+Math.imul(O,W)|0,r=r+Math.imul(C,Y)|0,n=n+Math.imul(C,K)|0,n=n+Math.imul(R,Y)|0,o=o+Math.imul(R,K)|0,r=r+Math.imul(M,Q)|0,n=n+Math.imul(M,Z)|0,n=n+Math.imul(A,Q)|0,o=o+Math.imul(A,Z)|0,r=r+Math.imul(E,$)|0,n=n+Math.imul(E,ee)|0,n=n+Math.imul(S,$)|0,o=o+Math.imul(S,ee)|0,r=r+Math.imul(b,ie)|0,n=n+Math.imul(b,re)|0,n=n+Math.imul(x,ie)|0,o=o+Math.imul(x,re)|0,r=r+Math.imul(v,oe)|0,n=n+Math.imul(v,se)|0,n=n+Math.imul(y,oe)|0,o=o+Math.imul(y,se)|0,r=r+Math.imul(p,le)|0,n=n+Math.imul(p,he)|0,n=n+Math.imul(m,le)|0,o=o+Math.imul(m,he)|0,r=r+Math.imul(u,ue)|0,n=n+Math.imul(u,fe)|0,n=n+Math.imul(f,ue)|0,o=o+Math.imul(f,fe)|0;var Se=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Se>>>26)|0,Se&=67108863,r=Math.imul(k,z),n=Math.imul(k,G),n=n+Math.imul(V,z)|0,o=Math.imul(V,G),r=r+Math.imul(L,j)|0,n=n+Math.imul(L,W)|0,n=n+Math.imul(B,j)|0,o=o+Math.imul(B,W)|0,r=r+Math.imul(I,Y)|0,n=n+Math.imul(I,K)|0,n=n+Math.imul(O,Y)|0,o=o+Math.imul(O,K)|0,r=r+Math.imul(C,Q)|0,n=n+Math.imul(C,Z)|0,n=n+Math.imul(R,Q)|0,o=o+Math.imul(R,Z)|0,r=r+Math.imul(M,$)|0,n=n+Math.imul(M,ee)|0,n=n+Math.imul(A,$)|0,o=o+Math.imul(A,ee)|0,r=r+Math.imul(E,ie)|0,n=n+Math.imul(E,re)|0,n=n+Math.imul(S,ie)|0,o=o+Math.imul(S,re)|0,r=r+Math.imul(b,oe)|0,n=n+Math.imul(b,se)|0,n=n+Math.imul(x,oe)|0,o=o+Math.imul(x,se)|0,r=r+Math.imul(v,le)|0,n=n+Math.imul(v,he)|0,n=n+Math.imul(y,le)|0,o=o+Math.imul(y,he)|0,r=r+Math.imul(p,ue)|0,n=n+Math.imul(p,fe)|0,n=n+Math.imul(m,ue)|0,o=o+Math.imul(m,fe)|0,r=r+Math.imul(u,pe)|0,n=n+Math.imul(u,me)|0,n=n+Math.imul(f,pe)|0,o=o+Math.imul(f,me)|0;var we=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(we>>>26)|0,we&=67108863,r=Math.imul(k,j),n=Math.imul(k,W),n=n+Math.imul(V,j)|0,o=Math.imul(V,W),r=r+Math.imul(L,Y)|0,n=n+Math.imul(L,K)|0,n=n+Math.imul(B,Y)|0,o=o+Math.imul(B,K)|0,r=r+Math.imul(I,Q)|0,n=n+Math.imul(I,Z)|0,n=n+Math.imul(O,Q)|0,o=o+Math.imul(O,Z)|0,r=r+Math.imul(C,$)|0,n=n+Math.imul(C,ee)|0,n=n+Math.imul(R,$)|0,o=o+Math.imul(R,ee)|0,r=r+Math.imul(M,ie)|0,n=n+Math.imul(M,re)|0,n=n+Math.imul(A,ie)|0,o=o+Math.imul(A,re)|0,r=r+Math.imul(E,oe)|0,n=n+Math.imul(E,se)|0,n=n+Math.imul(S,oe)|0,o=o+Math.imul(S,se)|0,r=r+Math.imul(b,le)|0,n=n+Math.imul(b,he)|0,n=n+Math.imul(x,le)|0,o=o+Math.imul(x,he)|0,r=r+Math.imul(v,ue)|0,n=n+Math.imul(v,fe)|0,n=n+Math.imul(y,ue)|0,o=o+Math.imul(y,fe)|0,r=r+Math.imul(p,pe)|0,n=n+Math.imul(p,me)|0,n=n+Math.imul(m,pe)|0,o=o+Math.imul(m,me)|0;var Me=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Me>>>26)|0,Me&=67108863,r=Math.imul(k,Y),n=Math.imul(k,K),n=n+Math.imul(V,Y)|0,o=Math.imul(V,K),r=r+Math.imul(L,Q)|0,n=n+Math.imul(L,Z)|0,n=n+Math.imul(B,Q)|0,o=o+Math.imul(B,Z)|0,r=r+Math.imul(I,$)|0,n=n+Math.imul(I,ee)|0,n=n+Math.imul(O,$)|0,o=o+Math.imul(O,ee)|0,r=r+Math.imul(C,ie)|0,n=n+Math.imul(C,re)|0,n=n+Math.imul(R,ie)|0,o=o+Math.imul(R,re)|0,r=r+Math.imul(M,oe)|0,n=n+Math.imul(M,se)|0,n=n+Math.imul(A,oe)|0,o=o+Math.imul(A,se)|0,r=r+Math.imul(E,le)|0,n=n+Math.imul(E,he)|0,n=n+Math.imul(S,le)|0,o=o+Math.imul(S,he)|0,r=r+Math.imul(b,ue)|0,n=n+Math.imul(b,fe)|0,n=n+Math.imul(x,ue)|0,o=o+Math.imul(x,fe)|0,r=r+Math.imul(v,pe)|0,n=n+Math.imul(v,me)|0,n=n+Math.imul(y,pe)|0,o=o+Math.imul(y,me)|0;var Ae=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,r=Math.imul(k,Q),n=Math.imul(k,Z),n=n+Math.imul(V,Q)|0,o=Math.imul(V,Z),r=r+Math.imul(L,$)|0,n=n+Math.imul(L,ee)|0,n=n+Math.imul(B,$)|0,o=o+Math.imul(B,ee)|0,r=r+Math.imul(I,ie)|0,n=n+Math.imul(I,re)|0,n=n+Math.imul(O,ie)|0,o=o+Math.imul(O,re)|0,r=r+Math.imul(C,oe)|0,n=n+Math.imul(C,se)|0,n=n+Math.imul(R,oe)|0,o=o+Math.imul(R,se)|0,r=r+Math.imul(M,le)|0,n=n+Math.imul(M,he)|0,n=n+Math.imul(A,le)|0,o=o+Math.imul(A,he)|0,r=r+Math.imul(E,ue)|0,n=n+Math.imul(E,fe)|0,n=n+Math.imul(S,ue)|0,o=o+Math.imul(S,fe)|0,r=r+Math.imul(b,pe)|0,n=n+Math.imul(b,me)|0,n=n+Math.imul(x,pe)|0,o=o+Math.imul(x,me)|0;var Pe=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,r=Math.imul(k,$),n=Math.imul(k,ee),n=n+Math.imul(V,$)|0,o=Math.imul(V,ee),r=r+Math.imul(L,ie)|0,n=n+Math.imul(L,re)|0,n=n+Math.imul(B,ie)|0,o=o+Math.imul(B,re)|0,r=r+Math.imul(I,oe)|0,n=n+Math.imul(I,se)|0,n=n+Math.imul(O,oe)|0,o=o+Math.imul(O,se)|0,r=r+Math.imul(C,le)|0,n=n+Math.imul(C,he)|0,n=n+Math.imul(R,le)|0,o=o+Math.imul(R,he)|0,r=r+Math.imul(M,ue)|0,n=n+Math.imul(M,fe)|0,n=n+Math.imul(A,ue)|0,o=o+Math.imul(A,fe)|0,r=r+Math.imul(E,pe)|0,n=n+Math.imul(E,me)|0,n=n+Math.imul(S,pe)|0,o=o+Math.imul(S,me)|0;var Ce=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,r=Math.imul(k,ie),n=Math.imul(k,re),n=n+Math.imul(V,ie)|0,o=Math.imul(V,re),r=r+Math.imul(L,oe)|0,n=n+Math.imul(L,se)|0,n=n+Math.imul(B,oe)|0,o=o+Math.imul(B,se)|0,r=r+Math.imul(I,le)|0,n=n+Math.imul(I,he)|0,n=n+Math.imul(O,le)|0,o=o+Math.imul(O,he)|0,r=r+Math.imul(C,ue)|0,n=n+Math.imul(C,fe)|0,n=n+Math.imul(R,ue)|0,o=o+Math.imul(R,fe)|0,r=r+Math.imul(M,pe)|0,n=n+Math.imul(M,me)|0,n=n+Math.imul(A,pe)|0,o=o+Math.imul(A,me)|0;var Re=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Re>>>26)|0,Re&=67108863,r=Math.imul(k,oe),n=Math.imul(k,se),n=n+Math.imul(V,oe)|0,o=Math.imul(V,se),r=r+Math.imul(L,le)|0,n=n+Math.imul(L,he)|0,n=n+Math.imul(B,le)|0,o=o+Math.imul(B,he)|0,r=r+Math.imul(I,ue)|0,n=n+Math.imul(I,fe)|0,n=n+Math.imul(O,ue)|0,o=o+Math.imul(O,fe)|0,r=r+Math.imul(C,pe)|0,n=n+Math.imul(C,me)|0,n=n+Math.imul(R,pe)|0,o=o+Math.imul(R,me)|0;var De=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(De>>>26)|0,De&=67108863,r=Math.imul(k,le),n=Math.imul(k,he),n=n+Math.imul(V,le)|0,o=Math.imul(V,he),r=r+Math.imul(L,ue)|0,n=n+Math.imul(L,fe)|0,n=n+Math.imul(B,ue)|0,o=o+Math.imul(B,fe)|0,r=r+Math.imul(I,pe)|0,n=n+Math.imul(I,me)|0,n=n+Math.imul(O,pe)|0,o=o+Math.imul(O,me)|0;var Ie=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,r=Math.imul(k,ue),n=Math.imul(k,fe),n=n+Math.imul(V,ue)|0,o=Math.imul(V,fe),r=r+Math.imul(L,pe)|0,n=n+Math.imul(L,me)|0,n=n+Math.imul(B,pe)|0,o=o+Math.imul(B,me)|0;var Oe=(h+r|0)+((8191&n)<<13)|0;h=(o+(n>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,r=Math.imul(k,pe),n=Math.imul(k,me),n=n+Math.imul(V,pe)|0,o=Math.imul(V,me);var Fe=(h+r|0)+((8191&n)<<13)|0;return h=(o+(n>>>13)|0)+(Fe>>>26)|0,Fe&=67108863,l[0]=ge,l[1]=ve,l[2]=ye,l[3]=_e,l[4]=be,l[5]=xe,l[6]=Te,l[7]=Ee,l[8]=Se,l[9]=we,l[10]=Me,l[11]=Ae,l[12]=Pe,l[13]=Ce,l[14]=Re,l[15]=De,l[16]=Ie,l[17]=Oe,l[18]=Fe,0!==h&&(l[19]=h,i.length++),i};Math.imul||(S=h),o.prototype.mulTo=function(e,t){var i=this.length+e.length;return 10===this.length&&10===e.length?S(this,e,t):i<63?h(this,e,t):i<1024?c(this,e,t):u(this,e,t)},f.prototype.makeRBT=function(e){for(var t=new Array(e),i=o.prototype._countBits(e)-1,r=0;r<e;r++)t[r]=this.revBin(r,i,e);return t},f.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var r=0,n=0;n<t;n++)r|=(1&e)<<t-n-1,e>>=1;return r},f.prototype.permute=function(e,t,i,r,n,o){for(var s=0;s<o;s++)r[s]=t[e[s]],n[s]=i[e[s]]},f.prototype.transform=function(e,t,i,r,n,o){this.permute(o,e,t,i,r,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,l=Math.cos(2*Math.PI/a),h=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var u=l,f=h,d=0;d<s;d++){var p=i[c+d],m=r[c+d],g=i[c+d+s],v=r[c+d+s],y=u*g-f*v;v=u*v+f*g,g=y,i[c+d]=p+g,r[c+d]=m+v,i[c+d+s]=p-g,r[c+d+s]=m-v,d!==a&&(y=l*u-h*f,f=l*f+h*u,u=y)}},f.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),r=1&i,n=0;for(i=i/2|0;i;i>>>=1)n++;return 1<<n+1+r},f.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var r=0;r<i/2;r++){var n=e[r];e[r]=e[i-r-1],e[i-r-1]=n,n=t[r],t[r]=-t[i-r-1],t[i-r-1]=-n}},f.prototype.normalize13b=function(e,t){for(var i=0,r=0;r<t/2;r++){var n=8192*Math.round(e[2*r+1]/t)+Math.round(e[2*r]/t)+i;e[r]=67108863&n,i=n<67108864?0:n/67108864|0}return e},f.prototype.convert13b=function(e,t,i,n){for(var o=0,s=0;s<t;s++)o+=0|e[s],i[2*s]=8191&o,o>>>=13,i[2*s+1]=8191&o,o>>>=13;for(s=2*t;s<n;++s)i[s]=0;r(0===o),r(0==(-8192&o))},f.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},f.prototype.mulp=function(e,t,i){var r=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(r),o=this.stub(r),s=new Array(r),a=new Array(r),l=new Array(r),h=new Array(r),c=new Array(r),u=new Array(r),f=i.words;f.length=r,this.convert13b(e.words,e.length,s,r),this.convert13b(t.words,t.length,h,r),this.transform(s,o,a,l,r,n),this.transform(h,o,c,u,r,n);for(var d=0;d<r;d++){var p=a[d]*c[d]-l[d]*u[d];l[d]=a[d]*u[d]+l[d]*c[d],a[d]=p}return this.conjugate(a,l,r),this.transform(a,l,f,o,r,n),this.conjugate(f,o,r),this.normalize13b(f,r),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},o.prototype.mul=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},o.prototype.mulf=function(e){var t=new o(null);return t.words=new Array(this.length+e.length),u(this,e,t)},o.prototype.imul=function(e){return this.clone().mulTo(e,this)},o.prototype.imuln=function(e){r("number"==typeof e),r(e<67108864);for(var t=0,i=0;i<this.length;i++){var n=(0|this.words[i])*e,o=(67108863&n)+(67108863&t);t>>=26,t+=n/67108864|0,t+=o>>>26,this.words[i]=67108863&o}return 0!==t&&(this.words[i]=t,this.length++),this},o.prototype.muln=function(e){return this.clone().imuln(e)},o.prototype.sqr=function(){return this.mul(this)},o.prototype.isqr=function(){return this.imul(this.clone())},o.prototype.pow=function(e){var t=l(e);if(0===t.length)return new o(1);for(var i=this,r=0;r<t.length&&0===t[r];r++,i=i.sqr());if(++r<t.length)for(var n=i.sqr();r<t.length;r++,n=n.sqr())0!==t[r]&&(i=i.mul(n));return i},o.prototype.iushln=function(e){r("number"==typeof e&&e>=0);var t,i=e%26,n=(e-i)/26,o=67108863>>>26-i<<26-i;if(0!==i){var s=0;for(t=0;t<this.length;t++){var a=this.words[t]&o,l=(0|this.words[t])-a<<i;this.words[t]=l|s,s=a>>>26-i}s&&(this.words[t]=s,this.length++)}if(0!==n){for(t=this.length-1;t>=0;t--)this.words[t+n]=this.words[t];for(t=0;t<n;t++)this.words[t]=0;this.length+=n}return this.strip()},o.prototype.ishln=function(e){return r(0===this.negative),this.iushln(e)},o.prototype.iushrn=function(e,t,i){r("number"==typeof e&&e>=0);var n;n=t?(t-t%26)/26:0;var o=e%26,s=Math.min((e-o)/26,this.length),a=67108863^67108863>>>o<<o,l=i;if(n-=s,n=Math.max(0,n),l){for(var h=0;h<s;h++)l.words[h]=this.words[h];l.length=s}if(0===s);else if(this.length>s)for(this.length-=s,h=0;h<this.length;h++)this.words[h]=this.words[h+s];else this.words[0]=0,this.length=1;var c=0;for(h=this.length-1;h>=0&&(0!==c||h>=n);h--){var u=0|this.words[h];this.words[h]=c<<26-o|u>>>o,c=u&a}return l&&0!==c&&(l.words[l.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},o.prototype.ishrn=function(e,t,i){return r(0===this.negative),this.iushrn(e,t,i)},o.prototype.shln=function(e){return this.clone().ishln(e)},o.prototype.ushln=function(e){return this.clone().iushln(e)},o.prototype.shrn=function(e){return this.clone().ishrn(e)},o.prototype.ushrn=function(e){return this.clone().iushrn(e)},o.prototype.testn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,n=1<<t;return!(this.length<=i)&&!!(this.words[i]&n)},o.prototype.imaskn=function(e){r("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(r(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var n=67108863^67108863>>>t<<t;this.words[this.length-1]&=n}return this.strip()},o.prototype.maskn=function(e){return this.clone().imaskn(e)},o.prototype.iaddn=function(e){return r("number"==typeof e),r(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},o.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},o.prototype.isubn=function(e){if(r("number"==typeof e),r(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},o.prototype.addn=function(e){return this.clone().iaddn(e)},o.prototype.subn=function(e){return this.clone().isubn(e)},o.prototype.iabs=function(){return this.negative=0,this},o.prototype.abs=function(){return this.clone().iabs()},o.prototype._ishlnsubmul=function(e,t,i){var n,o=e.length+i;this._expand(o);var s,a=0;for(n=0;n<e.length;n++){s=(0|this.words[n+i])+a;var l=(0|e.words[n])*t;s-=67108863&l,a=(s>>26)-(l/67108864|0),this.words[n+i]=67108863&s}for(;n<this.length-i;n++)s=(0|this.words[n+i])+a,a=s>>26,this.words[n+i]=67108863&s;if(0===a)return this.strip();for(r(-1===a),a=0,n=0;n<this.length;n++)s=-(0|this.words[n])+a,a=s>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},o.prototype._wordDiv=function(e,t){var i=this.length-e.length,r=this.clone(),n=e,s=0|n.words[n.length-1];0!==(i=26-this._countBits(s))&&(n=n.ushln(i),r.iushln(i),s=0|n.words[n.length-1]);var a,l=r.length-n.length;if("mod"!==t){a=new o(null),a.length=l+1,a.words=new Array(a.length);for(var h=0;h<a.length;h++)a.words[h]=0}var c=r.clone()._ishlnsubmul(n,1,l);0===c.negative&&(r=c,a&&(a.words[l]=1));for(var u=l-1;u>=0;u--){var f=67108864*(0|r.words[n.length+u])+(0|r.words[n.length+u-1]);for(f=Math.min(f/s|0,67108863),r._ishlnsubmul(n,f,u);0!==r.negative;)f--,r.negative=0,r._ishlnsubmul(n,1,u),r.isZero()||(r.negative^=1);a&&(a.words[u]=f)}return a&&a.strip(),r.strip(),"div"!==t&&0!==i&&r.iushrn(i),{div:a||null,mod:r}},o.prototype.divmod=function(e,t,i){if(r(!e.isZero()),this.isZero())return{div:new o(0),mod:new o(0)};var n,s,a;return 0!==this.negative&&0===e.negative?(a=this.neg().divmod(e,t),"mod"!==t&&(n=a.div.neg()),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.iadd(e)),{div:n,mod:s}):0===this.negative&&0!==e.negative?(a=this.divmod(e.neg(),t),"mod"!==t&&(n=a.div.neg()),{div:n,mod:a.mod}):0!=(this.negative&e.negative)?(a=this.neg().divmod(e.neg(),t),"div"!==t&&(s=a.mod.neg(),i&&0!==s.negative&&s.isub(e)),{div:a.div,mod:s}):e.length>this.length||this.cmp(e)<0?{div:new o(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new o(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new o(this.modn(e.words[0]))}:this._wordDiv(e,t)},o.prototype.div=function(e){return this.divmod(e,"div",!1).div},o.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},o.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},o.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,r=e.ushrn(1),n=e.andln(1),o=i.cmp(r);return o<0||1===n&&0===o?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},o.prototype.modn=function(e){r(e<=67108863);for(var t=(1<<26)%e,i=0,n=this.length-1;n>=0;n--)i=(t*i+(0|this.words[n]))%e;return i},o.prototype.idivn=function(e){r(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var n=(0|this.words[i])+67108864*t;this.words[i]=n/e|0,t=n%e}return this.strip()},o.prototype.divn=function(e){return this.clone().idivn(e)},o.prototype.egcd=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=new o(0),l=new o(1),h=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++h;for(var c=i.clone(),u=t.clone();!t.isZero();){for(var f=0,d=1;0==(t.words[0]&d)&&f<26;++f,d<<=1);if(f>0)for(t.iushrn(f);f-- >0;)(n.isOdd()||s.isOdd())&&(n.iadd(c),s.isub(u)),n.iushrn(1),s.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||l.isOdd())&&(a.iadd(c),l.isub(u)),a.iushrn(1),l.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(a),s.isub(l)):(i.isub(t),a.isub(n),l.isub(s))}return{a:a,b:l,gcd:i.iushln(h)}},o.prototype._invmp=function(e){r(0===e.negative),r(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var n=new o(1),s=new o(0),a=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var l=0,h=1;0==(t.words[0]&h)&&l<26;++l,h<<=1);if(l>0)for(t.iushrn(l);l-- >0;)n.isOdd()&&n.iadd(a),n.iushrn(1);for(var c=0,u=1;0==(i.words[0]&u)&&c<26;++c,u<<=1);if(c>0)for(i.iushrn(c);c-- >0;)s.isOdd()&&s.iadd(a),s.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(s)):(i.isub(t),s.isub(n))}var f;return f=0===t.cmpn(1)?n:s,f.cmpn(0)<0&&f.iadd(e),f},o.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var r=0;t.isEven()&&i.isEven();r++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var n=t.cmp(i);if(n<0){var o=t;t=i,i=o}else if(0===n||0===i.cmpn(1))break;t.isub(i)}return i.iushln(r)},o.prototype.invm=function(e){return this.egcd(e).a.umod(e)},o.prototype.isEven=function(){return 0==(1&this.words[0])},o.prototype.isOdd=function(){return 1==(1&this.words[0])},o.prototype.andln=function(e){return this.words[0]&e},o.prototype.bincn=function(e){r("number"==typeof e);var t=e%26,i=(e-t)/26,n=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=n,this;for(var o=n,s=i;0!==o&&s<this.length;s++){var a=0|this.words[s];a+=o,o=a>>>26,a&=67108863,this.words[s]=a}return 0!==o&&(this.words[s]=o,this.length++),this},o.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},o.prototype.cmpn=function(e){var t=e<0;if(0!==this.negative&&!t)return-1;if(0===this.negative&&t)return 1;this.strip();var i;if(this.length>1)i=1;else{t&&(e=-e),r(e<=67108863,"Number is too big");var n=0|this.words[0];i=n===e?0:n<e?-1:1}return 0!==this.negative?0|-i:i},o.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},o.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var r=0|this.words[i],n=0|e.words[i];if(r!==n){r<n?t=-1:r>n&&(t=1);break}}return t},o.prototype.gtn=function(e){return 1===this.cmpn(e)},o.prototype.gt=function(e){return 1===this.cmp(e)},o.prototype.gten=function(e){return this.cmpn(e)>=0},o.prototype.gte=function(e){return this.cmp(e)>=0},o.prototype.ltn=function(e){return-1===this.cmpn(e)},o.prototype.lt=function(e){return-1===this.cmp(e)},o.prototype.lten=function(e){return this.cmpn(e)<=0},o.prototype.lte=function(e){return this.cmp(e)<=0},o.prototype.eqn=function(e){return 0===this.cmpn(e)},o.prototype.eq=function(e){return 0===this.cmp(e)},o.red=function(e){return new y(e)},o.prototype.toRed=function(e){return r(!this.red,"Already a number in reduction context"),r(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},o.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},o.prototype._forceRed=function(e){return this.red=e,this},o.prototype.forceRed=function(e){return r(!this.red,"Already a number in reduction context"),this._forceRed(e)},o.prototype.redAdd=function(e){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},o.prototype.redIAdd=function(e){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},o.prototype.redSub=function(e){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},o.prototype.redISub=function(e){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},o.prototype.redShl=function(e){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},o.prototype.redMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},o.prototype.redIMul=function(e){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},o.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},o.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},o.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},o.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},o.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},o.prototype.redPow=function(e){return r(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var w={k256:null,p224:null,p192:null,p25519:null};d.prototype._tmp=function(){var e=new o(null);return e.words=new Array(Math.ceil(this.n/13)),e},d.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),i=this.imulK(i),i=i.iadd(this.tmp),t=i.bitLength()}while(t>this.n);var r=t<this.n?-1:i.ucmp(this.p);return 0===r?(i.words[0]=0,i.length=1):r>0?i.isub(this.p):i.strip(),i},d.prototype.split=function(e,t){e.iushrn(this.n,0,t)},d.prototype.imulK=function(e){return e.imul(this.k)},n(p,d),p.prototype.split=function(e,t){for(var i=Math.min(e.length,9),r=0;r<i;r++)t.words[r]=e.words[r];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var n=e.words[9];for(t.words[t.length++]=4194303&n,r=10;r<e.length;r++){var o=0|e.words[r];e.words[r-10]=(4194303&o)<<4|n>>>22,n=o}n>>>=22,e.words[r-10]=n,0===n&&e.length>10?e.length-=10:e.length-=9},p.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var r=0|e.words[i];t+=977*r,e.words[i]=67108863&t,t=64*r+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},n(m,d),n(g,d),n(v,d),v.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var r=19*(0|e.words[i])+t,n=67108863&r;r>>>=26,e.words[i]=n,t=r}return 0!==t&&(e.words[e.length++]=t),e},o._prime=function(e){if(w[e])return w[e];var t;if("k256"===e)t=new p;else if("p224"===e)t=new m;else if("p192"===e)t=new g;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new v}return w[e]=t,t},y.prototype._verify1=function(e){r(0===e.negative,"red works only with positives"),r(e.red,"red works only with red numbers")},y.prototype._verify2=function(e,t){r(0==(e.negative|t.negative),"red works only with positives"),r(e.red&&e.red===t.red,"red works only with red numbers")},y.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},y.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},y.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},y.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},y.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},y.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},y.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},y.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},y.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},y.prototype.isqr=function(e){return this.imul(e,e.clone())},y.prototype.sqr=function(e){return this.mul(e,e)},y.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(r(t%2==1),3===t){var i=this.m.add(new o(1)).iushrn(2);return this.pow(e,i)}for(var n=this.m.subn(1),s=0;!n.isZero()&&0===n.andln(1);)s++,n.iushrn(1);r(!n.isZero());var a=new o(1).toRed(this),l=a.redNeg(),h=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new o(2*c*c).toRed(this);0!==this.pow(c,h).cmp(l);)c.redIAdd(l);for(var u=this.pow(c,n),f=this.pow(e,n.addn(1).iushrn(1)),d=this.pow(e,n),p=s;0!==d.cmp(a);){for(var m=d,g=0;0!==m.cmp(a);g++)m=m.redSqr();r(g<p);var v=this.pow(u,new o(1).iushln(p-g-1));f=f.redMul(v),u=v.redSqr(),d=d.redMul(u),p=g}return f},y.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},y.prototype.pow=function(e,t){if(t.isZero())return new o(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new o(1).toRed(this),i[1]=e;for(var r=2;r<i.length;r++)i[r]=this.mul(i[r-1],e);var n=i[0],s=0,a=0,l=t.bitLength()%26;for(0===l&&(l=26),r=t.length-1;r>=0;r--){for(var h=t.words[r],c=l-1;c>=0;c--){var u=h>>c&1;n!==i[0]&&(n=this.sqr(n)),0!==u||0!==s?(s<<=1,s|=u,(4===++a||0===r&&0===c)&&(n=this.mul(n,i[s]),a=0,s=0)):a=0}l=26}return n},y.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},y.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},o.mont=function(e){return new _(e)},n(_,y),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=i.isub(r).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new o(0)._forceRed(this);var i=e.mul(t),r=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=i.isub(r).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===e||e,this)}).call(t,i(61)(e))},function(e,t,i){"use strict";var r=t;r.version=i(130).version,r.utils=i(131),r.rand=i(63),r.curve=i(24),r.curves=i(136),r.ec=i(144),r.eddsa=i(148)},function(e,t){function i(e,t){if(!e)throw new Error(t||"Assertion failed")}e.exports=i,i.equal=function(e,t,i){if(e!=t)throw new Error(i||"Assertion failed: "+e+" != "+t)}},function(e,t,i){"use strict";function r(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"==typeof e)if(t){if("hex"===t)for(e=e.replace(/[^a-z0-9]+/gi,""),e.length%2!=0&&(e="0"+e),r=0;r<e.length;r+=2)i.push(parseInt(e[r]+e[r+1],16))}else for(var r=0;r<e.length;r++){var n=e.charCodeAt(r),o=n>>8,s=255&n;o?i.push(o,s):i.push(s)}else for(r=0;r<e.length;r++)i[r]=0|e[r];return i}function n(e){for(var t="",i=0;i<e.length;i++)t+=a(e[i].toString(16));return t}function o(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function s(e,t){for(var i="",r=0;r<e.length;r++){var n=e[r];"little"===t&&(n=o(n)),i+=l(n.toString(16))}return i}function a(e){return 1===e.length?"0"+e:e}function l(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}function h(e,t,i,r){var n=i-t;P(n%4==0);for(var o=new Array(n/4),s=0,a=t;s<o.length;s++,a+=4){var l;l="big"===r?e[a]<<24|e[a+1]<<16|e[a+2]<<8|e[a+3]:e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a],o[s]=l>>>0}return o}function c(e,t){for(var i=new Array(4*e.length),r=0,n=0;r<e.length;r++,n+=4){var o=e[r];"big"===t?(i[n]=o>>>24,i[n+1]=o>>>16&255,i[n+2]=o>>>8&255,i[n+3]=255&o):(i[n+3]=o>>>24,i[n+2]=o>>>16&255,i[n+1]=o>>>8&255,i[n]=255&o)}return i}function u(e,t){return e>>>t|e<<32-t}function f(e,t){return e<<t|e>>>32-t}function d(e,t){return e+t>>>0}function p(e,t,i){return e+t+i>>>0}function m(e,t,i,r){return e+t+i+r>>>0}function g(e,t,i,r,n){return e+t+i+r+n>>>0}function v(e,t,i,r){var n=e[t],o=e[t+1],s=r+o>>>0,a=(s<r?1:0)+i+n;e[t]=a>>>0,e[t+1]=s}function y(e,t,i,r){return(t+r>>>0<t?1:0)+e+i>>>0}function _(e,t,i,r){return t+r>>>0}function b(e,t,i,r,n,o,s,a){var l=0,h=t;return h=h+r>>>0,l+=h<t?1:0,h=h+o>>>0,l+=h<o?1:0,h=h+a>>>0,l+=h<a?1:0,e+i+n+s+l>>>0}function x(e,t,i,r,n,o,s,a){return t+r+o+a>>>0}function T(e,t,i,r,n,o,s,a,l,h){var c=0,u=t;return u=u+r>>>0,c+=u<t?1:0,u=u+o>>>0,c+=u<o?1:0,u=u+a>>>0,c+=u<a?1:0,u=u+h>>>0,c+=u<h?1:0,e+i+n+s+l+c>>>0}function E(e,t,i,r,n,o,s,a,l,h){return t+r+o+a+h>>>0}function S(e,t,i){return(t<<32-i|e>>>i)>>>0}function w(e,t,i){return(e<<32-i|t>>>i)>>>0}function M(e,t,i){return e>>>i}function A(e,t,i){return(e<<32-i|t>>>i)>>>0}var P=i(6),C=i(0);t.inherits=C,t.toArray=r,t.toHex=n,t.htonl=o,t.toHex32=s,t.zero2=a,t.zero8=l,t.join32=h,t.split32=c,t.rotr32=u,t.rotl32=f,t.sum32=d,t.sum32_3=p,t.sum32_4=m,t.sum32_5=g,t.sum64=v,t.sum64_hi=y,t.sum64_lo=_,t.sum64_4_hi=b,t.sum64_4_lo=x,t.sum64_5_hi=T,t.sum64_5_lo=E,t.rotr64_hi=S,t.rotr64_lo=w,t.shr64_hi=M,t.shr64_lo=A},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function n(e){if(c===setTimeout)return setTimeout(e,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(u===clearTimeout)return clearTimeout(e);if((u===r||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function s(){m&&d&&(m=!1,d.length?p=d.concat(p):g=-1,p.length&&a())}function a(){if(!m){var e=n(s);m=!0;for(var t=p.length;t;){for(d=p,p=[];++g<t;)d&&d[g].run();g=-1,t=p.length}d=null,m=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function h(){}var c,u,f=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{u="function"==typeof clearTimeout?clearTimeout:r}catch(e){u=r}}();var d,p=[],m=!1,g=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new l(e,t)),1!==p.length||m||n(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=h,f.addListener=h,f.once=h,f.off=h,f.removeListener=h,f.removeAllListeners=h,f.emit=h,f.prependListener=h,f.prependOnceListener=h,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,i){function r(e){o.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}var n=i(2).Buffer,o=i(19).Transform,s=i(32).StringDecoder;i(0)(r,o),r.prototype.update=function(e,t,i){"string"==typeof e&&(e=n.from(e,t));var r=this._update(e);return this.hashMode?this:(i&&(r=this._toString(r,i)),r)},r.prototype.setAutoPadding=function(){},r.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},r.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},r.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},r.prototype._transform=function(e,t,i){var r;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){r=e}finally{i(r)}},r.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},r.prototype._finalOrDigest=function(e){var t=this.__final()||n.alloc(0);return e&&(t=this._toString(t,e,!0)),t},r.prototype._toString=function(e,t,i){if(this._decoder||(this._decoder=new s(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var r=this._decoder.write(e);return i&&(r+=this._decoder.end()),r},e.exports=r},function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);h.call(this,e),c.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",n)}function n(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var s=i(21),a=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=r;var l=i(14);l.inherits=i(0);var h=i(43),c=i(31);l.inherits(r,h);for(var u=a(c.prototype),f=0;f<u.length;f++){var d=u[f];r.prototype[d]||(r.prototype[d]=c.prototype[d])}Object.defineProperty(r.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),r.prototype._destroy=function(e,t){this.push(null),this.end(),s(t,e)}},function(e,t,i){"use strict";(function(t,r){function n(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}function o(e,i){if(e>65536)throw new Error("requested too many random bytes");var n=new t.Uint8Array(e);e>0&&a.getRandomValues(n);var o=s.from(n.buffer);return"function"==typeof i?r.nextTick(function(){i(null,o)}):o}var s=i(2).Buffer,a=t.crypto||t.msCrypto;a&&a.getRandomValues?e.exports=o:e.exports=n}).call(t,i(1),i(8))},function(e,t,i){function r(e,t){this._block=n.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}var n=i(2).Buffer;r.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=n.from(e,t));for(var i=this._block,r=this._blockSize,o=e.length,s=this._len,a=0;a<o;){for(var l=s%r,h=Math.min(o-a,r-l),c=0;c<h;c++)i[l+c]=e[a+c];s+=h,a+=h,s%r==0&&this._update(i)}return this._len+=o,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=8*this._len;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var r=4294967295&i,n=(i-r)/4294967296;this._block.writeUInt32BE(n,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var o=this._hash();return e?o.toString(e):o},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},function(e,t,i){"use strict";(function(t){function r(e){h.call(this,"digest"),this._hash=e,this.buffers=[]}function n(e){h.call(this,"digest"),this._hash=e}var o=i(0),s=i(28),a=i(29),l=i(33),h=i(9);o(r,h),r.prototype._update=function(e){this.buffers.push(e)},r.prototype._final=function(){var e=t.concat(this.buffers),i=this._hash(e);return this.buffers=null,i},o(n,h),n.prototype._update=function(e){this._hash.update(e)},n.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return e=e.toLowerCase(),"md5"===e?new r(s):new n("rmd160"===e||"ripemd160"===e?new a:l(e))}}).call(t,i(3).Buffer)},function(e,t,i){(function(e){function i(e){return Array.isArray?Array.isArray(e):"[object Array]"===g(e)}function r(e){return"boolean"==typeof e}function n(e){return null===e}function o(e){return null==e}function s(e){return"number"==typeof e}function a(e){return"string"==typeof e}function l(e){return"symbol"==typeof e}function h(e){return void 0===e}function c(e){return"[object RegExp]"===g(e)}function u(e){return"object"==typeof e&&null!==e}function f(e){return"[object Date]"===g(e)}function d(e){return"[object Error]"===g(e)||e instanceof Error}function p(e){return"function"==typeof e}function m(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function g(e){return Object.prototype.toString.call(e)}t.isArray=i,t.isBoolean=r,t.isNull=n,t.isNullOrUndefined=o,t.isNumber=s,t.isString=a,t.isSymbol=l,t.isUndefined=h,t.isRegExp=c,t.isObject=u,t.isDate=f,t.isError=d,t.isFunction=p,t.isPrimitive=m,t.isBuffer=e.isBuffer}).call(t,i(3).Buffer)},function(e,t,i){(function(t){e.exports=function(e,i){for(var r=Math.min(e.length,i.length),n=new t(r),o=0;o<r;++o)n[o]=e[o]^i[o];return n}}).call(t,i(3).Buffer)},function(e,t,i){"use strict";function r(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}var n=i(7),o=i(6);t.BlockHash=r,r.prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var i=e.length%this._delta8;this.pending=e.slice(e.length-i,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-i,this.endian);for(var r=0;r<e.length;r+=this._delta32)this._update(e,r,r+this._delta32)}return this},r.prototype.digest=function(e){return this.update(this._pad()),o(null===this.pending),this._digest(e)},r.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,i=t-(e+this.padLength)%t,r=new Array(i+this.padLength);r[0]=128;for(var n=1;n<i;n++)r[n]=0;if(e<<=3,"big"===this.endian){for(var o=8;o<this.padLength;o++)r[n++]=0;r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e}else for(r[n++]=255&e,r[n++]=e>>>8&255,r[n++]=e>>>16&255,r[n++]=e>>>24&255,r[n++]=0,r[n++]=0,r[n++]=0,r[n++]=0,o=8;o<this.padLength;o++)r[n++]=0;return r}},function(e,t,i){var r=t;r.bignum=i(4),r.define=i(152).define,r.base=i(18),r.constants=i(69),r.decoders=i(158),r.encoders=i(160)},function(e,t,i){var r=t;r.Reporter=i(155).Reporter,r.DecoderBuffer=i(68).DecoderBuffer,r.EncoderBuffer=i(68).EncoderBuffer,r.Node=i(156)},function(e,t,i){function r(){n.call(this)}e.exports=r;var n=i(30).EventEmitter;i(0)(r,n),r.Readable=i(20),r.Writable=i(93),r.Duplex=i(94),r.Transform=i(95),r.PassThrough=i(96),r.Stream=r,r.prototype.pipe=function(e,t){function i(t){e.writable&&!1===e.write(t)&&h.pause&&h.pause()}function r(){h.readable&&h.resume&&h.resume()}function o(){c||(c=!0,e.end())}function s(){c||(c=!0,"function"==typeof e.destroy&&e.destroy())}function a(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){h.removeListener("data",i),e.removeListener("drain",r),h.removeListener("end",o),h.removeListener("close",s),h.removeListener("error",a),e.removeListener("error",a),h.removeListener("end",l),h.removeListener("close",l),e.removeListener("close",l)}var h=this;h.on("data",i),e.on("drain",r),e._isStdio||t&&!1===t.end||(h.on("end",o),h.on("close",s));var c=!1;return h.on("error",a),e.on("error",a),h.on("end",l),h.on("close",l),e.on("close",l),e.emit("pipe",h),e}},function(e,t,i){t=e.exports=i(43),t.Stream=t,t.Readable=t,t.Writable=i(31),t.Duplex=i(10),t.Transform=i(46),t.PassThrough=i(92)},function(e,t,i){"use strict";(function(t){function i(e,i,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,i)});case 3:return t.nextTick(function(){e.call(null,i,r)});case 4:return t.nextTick(function(){e.call(null,i,r,n)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick(function(){e.apply(null,o)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports=i:e.exports=t.nextTick}).call(t,i(8))},function(e,t,i){function r(e,t,i,r){if(n.isBuffer(e)||(e=n.from(e,"binary")),t&&(n.isBuffer(t)||(t=n.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var s=i/8,a=n.alloc(s),l=n.alloc(r||0),h=n.alloc(0);s>0||r>0;){var c=new o;c.update(h),c.update(e),t&&c.update(t),h=c.digest();var u=0;if(s>0){var f=a.length-s;u=Math.min(s,h.length),h.copy(a,f,0,u),s-=u}if(u<h.length&&r>0){var d=l.length-r,p=Math.min(r,h.length-u);h.copy(l,d,u,u+p),r-=p}}return h.fill(0),{key:a,iv:l}}var n=i(2).Buffer,o=i(105);e.exports=r},function(e,t,i){function r(e){a.isBuffer(e)||(e=a.from(e));for(var t=e.length/4|0,i=new Array(t),r=0;r<t;r++)i[r]=e.readUInt32BE(4*r);return i}function n(e){for(;0<e.length;e++)e[0]=0}function o(e,t,i,r,n){for(var o,s,a,l,h=i[0],c=i[1],u=i[2],f=i[3],d=e[0]^t[0],p=e[1]^t[1],m=e[2]^t[2],g=e[3]^t[3],v=4,y=1;y<n;y++)o=h[d>>>24]^c[p>>>16&255]^u[m>>>8&255]^f[255&g]^t[v++],s=h[p>>>24]^c[m>>>16&255]^u[g>>>8&255]^f[255&d]^t[v++],a=h[m>>>24]^c[g>>>16&255]^u[d>>>8&255]^f[255&p]^t[v++],l=h[g>>>24]^c[d>>>16&255]^u[p>>>8&255]^f[255&m]^t[v++],d=o,p=s,m=a,g=l;return o=(r[d>>>24]<<24|r[p>>>16&255]<<16|r[m>>>8&255]<<8|r[255&g])^t[v++],s=(r[p>>>24]<<24|r[m>>>16&255]<<16|r[g>>>8&255]<<8|r[255&d])^t[v++],a=(r[m>>>24]<<24|r[g>>>16&255]<<16|r[d>>>8&255]<<8|r[255&p])^t[v++],l=(r[g>>>24]<<24|r[d>>>16&255]<<16|r[p>>>8&255]<<8|r[255&m])^t[v++],o>>>=0,s>>>=0,a>>>=0,l>>>=0,[o,s,a,l]}function s(e){this._key=r(e),this._reset()}var a=i(2).Buffer,l=[0,1,2,4,8,16,32,64,128,27,54],h=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var i=[],r=[],n=[[],[],[],[]],o=[[],[],[],[]],s=0,a=0,l=0;l<256;++l){var h=a^a<<1^a<<2^a<<3^a<<4;h=h>>>8^255&h^99,i[s]=h,r[h]=s;var c=e[s],u=e[c],f=e[u],d=257*e[h]^16843008*h;n[0][s]=d<<24|d>>>8,n[1][s]=d<<16|d>>>16,n[2][s]=d<<8|d>>>24,n[3][s]=d,d=16843009*f^65537*u^257*c^16843008*s,o[0][h]=d<<24|d>>>8,o[1][h]=d<<16|d>>>16,o[2][h]=d<<8|d>>>24,o[3][h]=d,0===s?s=a=1:(s=c^e[e[e[f^c]]],a^=e[e[a]])}return{SBOX:i,INV_SBOX:r,SUB_MIX:n,INV_SUB_MIX:o}}();s.blockSize=16,s.keySize=32,s.prototype.blockSize=s.blockSize,s.prototype.keySize=s.keySize,s.prototype._reset=function(){for(var e=this._key,t=e.length,i=t+6,r=4*(i+1),n=[],o=0;o<t;o++)n[o]=e[o];for(o=t;o<r;o++){var s=n[o-1];o%t==0?(s=s<<8|s>>>24,s=h.SBOX[s>>>24]<<24|h.SBOX[s>>>16&255]<<16|h.SBOX[s>>>8&255]<<8|h.SBOX[255&s],s^=l[o/t|0]<<24):t>6&&o%t==4&&(s=h.SBOX[s>>>24]<<24|h.SBOX[s>>>16&255]<<16|h.SBOX[s>>>8&255]<<8|h.SBOX[255&s]),n[o]=n[o-t]^s}for(var a=[],c=0;c<r;c++){var u=r-c,f=n[u-(c%4?0:4)];a[c]=c<4||u<=4?f:h.INV_SUB_MIX[0][h.SBOX[f>>>24]]^h.INV_SUB_MIX[1][h.SBOX[f>>>16&255]]^h.INV_SUB_MIX[2][h.SBOX[f>>>8&255]]^h.INV_SUB_MIX[3][h.SBOX[255&f]]}this._nRounds=i,this._keySchedule=n,this._invKeySchedule=a},s.prototype.encryptBlockRaw=function(e){return e=r(e),o(e,this._keySchedule,h.SUB_MIX,h.SBOX,this._nRounds)},s.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),i=a.allocUnsafe(16);return i.writeUInt32BE(t[0],0),i.writeUInt32BE(t[1],4),i.writeUInt32BE(t[2],8),i.writeUInt32BE(t[3],12),i},s.prototype.decryptBlock=function(e){e=r(e);var t=e[1];e[1]=e[3],e[3]=t;var i=o(e,this._invKeySchedule,h.INV_SUB_MIX,h.INV_SBOX,this._nRounds),n=a.allocUnsafe(16);return n.writeUInt32BE(i[0],0),n.writeUInt32BE(i[3],4),n.writeUInt32BE(i[2],8),n.writeUInt32BE(i[1],12),n},s.prototype.scrub=function(){n(this._keySchedule),n(this._invKeySchedule),n(this._key)},e.exports.AES=s},function(e,t,i){"use strict";var r=t;r.base=i(132),r.short=i(133),r.mont=i(134),r.edwards=i(135)},function(e,t,i){(function(t){function r(e){var i;"object"!=typeof e||t.isBuffer(e)||(i=e.passphrase,e=e.key),"string"==typeof e&&(e=new t(e));var r,s,l=a(e,i),h=l.tag,c=l.data;switch(h){case"CERTIFICATE":s=o.certificate.decode(c,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(s||(s=o.PublicKey.decode(c,"der")),r=s.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return o.RSAPublicKey.decode(s.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return s.subjectPrivateKey=s.subjectPublicKey,{type:"ec",data:s};case"1.2.840.10040.4.1":return s.algorithm.params.pub_key=o.DSAparam.decode(s.subjectPublicKey.data,"der"),{type:"dsa",data:s.algorithm.params};default:throw new Error("unknown key id "+r)}throw new Error("unknown key type "+h);case"ENCRYPTED PRIVATE KEY":c=o.EncryptedPrivateKey.decode(c,"der"),c=n(c,i);case"PRIVATE KEY":switch(s=o.PrivateKey.decode(c,"der"),r=s.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return o.RSAPrivateKey.decode(s.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:s.algorithm.curve,privateKey:o.ECPrivateKey.decode(s.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return s.algorithm.params.priv_key=o.DSAparam.decode(s.subjectPrivateKey,"der"),{type:"dsa",params:s.algorithm.params};default:throw new Error("unknown key id "+r)}throw new Error("unknown key type "+h);case"RSA PUBLIC KEY":return o.RSAPublicKey.decode(c,"der");case"RSA PRIVATE KEY":return o.RSAPrivateKey.decode(c,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:o.DSAPrivateKey.decode(c,"der")};case"EC PRIVATE KEY":return c=o.ECPrivateKey.decode(c,"der"),{curve:c.parameters.value,privateKey:c.privateKey};default:throw new Error("unknown key type "+h)}}function n(e,i){var r=e.algorithm.decrypt.kde.kdeparams.salt,n=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),o=s[e.algorithm.decrypt.cipher.algo.join(".")],a=e.algorithm.decrypt.cipher.iv,c=e.subjectPrivateKey,u=parseInt(o.split("-")[1],10)/8,f=h.pbkdf2Sync(i,r,n,u),d=l.createDecipheriv(o,f,a),p=[];return p.push(d.update(c)),p.push(d.final()),t.concat(p)}var o=i(151),s=i(163),a=i(164),l=i(34),h=i(51);e.exports=r,r.signature=o.signature}).call(t,i(3).Buffer)},function(e,t){function i(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var o=r(n);return[i].concat(n.sources.map(function(e){return"/*# sourceURL="+n.sourceRoot+e+" */"})).concat([o]).join("\n")}return[i].join("\n")}function r(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=i(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},n=0;n<this.length;n++){var o=this[n][0];"number"==typeof o&&(r[o]=!0)}for(n=0;n<e.length;n++){var s=e[n];"number"==typeof s[0]&&r[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},function(e,t,i){function r(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=p[r.id];if(n){n.refs++;for(var o=0;o<n.parts.length;o++)n.parts[o](r.parts[o]);for(;o<r.parts.length;o++)n.parts.push(c(r.parts[o],t))}else{for(var s=[],o=0;o<r.parts.length;o++)s.push(c(r.parts[o],t));p[r.id]={id:r.id,refs:1,parts:s}}}}function n(e,t){for(var i=[],r={},n=0;n<e.length;n++){var o=e[n],s=t.base?o[0]+t.base:o[0],a=o[1],l=o[2],h=o[3],c={css:a,media:l,sourceMap:h};r[s]?r[s].parts.push(c):i.push(r[s]={id:s,parts:[c]})}return i}function o(e,t){var i=g(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=_[_.length-1];if("top"===e.insertAt)r?r.nextSibling?i.insertBefore(t,r.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),_.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var n=g(e.insertInto+" "+e.insertAt.before);i.insertBefore(t,n)}}function s(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=_.indexOf(e);t>=0&&_.splice(t,1)}function a(e){var t=document.createElement("style");return e.attrs.type="text/css",h(t,e.attrs),o(e,t),t}function l(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",h(t,e.attrs),o(e,t),t}function h(e,t){Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}function c(e,t){var i,r,n,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var h=y++;i=v||(v=a(t)),r=u.bind(null,i,h,!1),n=u.bind(null,i,h,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=l(t),r=d.bind(null,i,t),n=function(){s(i),i.href&&URL.revokeObjectURL(i.href)}):(i=a(t),r=f.bind(null,i),n=function(){s(i)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else n()}}function u(e,t,i,r){var n=i?"":r.css;if(e.styleSheet)e.styleSheet.cssText=x(t,n);else{var o=document.createTextNode(n),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function f(e,t){var i=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function d(e,t,i){var r=i.css,n=i.sourceMap,o=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||o)&&(r=b(r)),n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var s=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}var p={},m=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),g=function(e){var t={};return function(i){if(void 0===t[i]){var r=e.call(this,i);if(r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[i]=r}return t[i]}}(function(e){return document.querySelector(e)}),v=null,y=0,_=[],b=i(192);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=m()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=n(e,t);return r(i,t),function(e){for(var o=[],s=0;s<i.length;s++){var a=i[s],l=p[a.id];l.refs--,o.push(l)}if(e){r(n(e,t),t)}for(var s=0;s<o.length;s++){var l=o[s];if(0===l.refs){for(var h=0;h<l.parts.length;h++)l.parts[h]();delete p[l.id]}}}};var x=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()},function(e,t,i){"use strict";function r(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i=1732584193,r=-271733879,n=-1732584194,c=271733878,u=0;u<e.length;u+=16){var f=i,d=r,p=n,m=c;i=o(i,r,n,c,e[u+0],7,-680876936),c=o(c,i,r,n,e[u+1],12,-389564586),n=o(n,c,i,r,e[u+2],17,606105819),r=o(r,n,c,i,e[u+3],22,-1044525330),i=o(i,r,n,c,e[u+4],7,-176418897),c=o(c,i,r,n,e[u+5],12,1200080426),n=o(n,c,i,r,e[u+6],17,-1473231341),r=o(r,n,c,i,e[u+7],22,-45705983),i=o(i,r,n,c,e[u+8],7,1770035416),c=o(c,i,r,n,e[u+9],12,-1958414417),n=o(n,c,i,r,e[u+10],17,-42063),r=o(r,n,c,i,e[u+11],22,-1990404162),i=o(i,r,n,c,e[u+12],7,1804603682),c=o(c,i,r,n,e[u+13],12,-40341101),n=o(n,c,i,r,e[u+14],17,-1502002290),r=o(r,n,c,i,e[u+15],22,1236535329),i=s(i,r,n,c,e[u+1],5,-165796510),c=s(c,i,r,n,e[u+6],9,-1069501632),n=s(n,c,i,r,e[u+11],14,643717713),r=s(r,n,c,i,e[u+0],20,-373897302),i=s(i,r,n,c,e[u+5],5,-701558691),c=s(c,i,r,n,e[u+10],9,38016083),n=s(n,c,i,r,e[u+15],14,-660478335),r=s(r,n,c,i,e[u+4],20,-405537848),i=s(i,r,n,c,e[u+9],5,568446438),c=s(c,i,r,n,e[u+14],9,-1019803690),n=s(n,c,i,r,e[u+3],14,-187363961),r=s(r,n,c,i,e[u+8],20,1163531501),i=s(i,r,n,c,e[u+13],5,-1444681467),c=s(c,i,r,n,e[u+2],9,-51403784),n=s(n,c,i,r,e[u+7],14,1735328473),r=s(r,n,c,i,e[u+12],20,-1926607734),i=a(i,r,n,c,e[u+5],4,-378558),c=a(c,i,r,n,e[u+8],11,-2022574463),n=a(n,c,i,r,e[u+11],16,1839030562),r=a(r,n,c,i,e[u+14],23,-35309556),i=a(i,r,n,c,e[u+1],4,-1530992060),c=a(c,i,r,n,e[u+4],11,1272893353),n=a(n,c,i,r,e[u+7],16,-155497632),r=a(r,n,c,i,e[u+10],23,-1094730640),i=a(i,r,n,c,e[u+13],4,681279174),c=a(c,i,r,n,e[u+0],11,-358537222),n=a(n,c,i,r,e[u+3],16,-722521979),r=a(r,n,c,i,e[u+6],23,76029189),i=a(i,r,n,c,e[u+9],4,-640364487),c=a(c,i,r,n,e[u+12],11,-421815835),n=a(n,c,i,r,e[u+15],16,530742520),r=a(r,n,c,i,e[u+2],23,-995338651),i=l(i,r,n,c,e[u+0],6,-198630844),c=l(c,i,r,n,e[u+7],10,1126891415),n=l(n,c,i,r,e[u+14],15,-1416354905),r=l(r,n,c,i,e[u+5],21,-57434055),i=l(i,r,n,c,e[u+12],6,1700485571),c=l(c,i,r,n,e[u+3],10,-1894986606),n=l(n,c,i,r,e[u+10],15,-1051523),r=l(r,n,c,i,e[u+1],21,-2054922799),i=l(i,r,n,c,e[u+8],6,1873313359),c=l(c,i,r,n,e[u+15],10,-30611744),n=l(n,c,i,r,e[u+6],15,-1560198380),r=l(r,n,c,i,e[u+13],21,1309151649),i=l(i,r,n,c,e[u+4],6,-145523070),c=l(c,i,r,n,e[u+11],10,-1120210379),n=l(n,c,i,r,e[u+2],15,718787259),r=l(r,n,c,i,e[u+9],21,-343485551),i=h(i,f),r=h(r,d),n=h(n,p),c=h(c,m)}return[i,r,n,c]}function n(e,t,i,r,n,o){return h(c(h(h(t,e),h(r,o)),n),i)}function o(e,t,i,r,o,s,a){return n(t&i|~t&r,e,t,o,s,a)}function s(e,t,i,r,o,s,a){return n(t&r|i&~r,e,t,o,s,a)}function a(e,t,i,r,o,s,a){return n(t^i^r,e,t,o,s,a)}function l(e,t,i,r,o,s,a){return n(i^(t|~r),e,t,o,s,a)}function h(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function c(e,t){return e<<t|e>>>32-t}var u=i(87);e.exports=function(e){return u(e,r)}},function(e,t,i){"use strict";(function(t){function r(){u.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function n(e,t){return e<<t|e>>>32-t}function o(e,t,i,r,o,s,a,l){return n(e+(t^i^r)+s+a|0,l)+o|0}function s(e,t,i,r,o,s,a,l){return n(e+(t&i|~t&r)+s+a|0,l)+o|0}function a(e,t,i,r,o,s,a,l){return n(e+((t|~i)^r)+s+a|0,l)+o|0}function l(e,t,i,r,o,s,a,l){return n(e+(t&r|i&~r)+s+a|0,l)+o|0}function h(e,t,i,r,o,s,a,l){return n(e+(t^(i|~r))+s+a|0,l)+o|0}var c=i(0),u=i(88);c(r,u),r.prototype._update=function(){for(var e=new Array(16),t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var i=this._a,r=this._b,c=this._c,u=this._d,f=this._e;i=o(i,r,c,u,f,e[0],0,11),c=n(c,10),f=o(f,i,r,c,u,e[1],0,14),r=n(r,10),u=o(u,f,i,r,c,e[2],0,15),i=n(i,10),c=o(c,u,f,i,r,e[3],0,12),f=n(f,10),r=o(r,c,u,f,i,e[4],0,5),u=n(u,10),i=o(i,r,c,u,f,e[5],0,8),c=n(c,10),f=o(f,i,r,c,u,e[6],0,7),r=n(r,10),u=o(u,f,i,r,c,e[7],0,9),i=n(i,10),c=o(c,u,f,i,r,e[8],0,11),f=n(f,10),r=o(r,c,u,f,i,e[9],0,13),u=n(u,10),i=o(i,r,c,u,f,e[10],0,14),c=n(c,10),f=o(f,i,r,c,u,e[11],0,15),r=n(r,10),u=o(u,f,i,r,c,e[12],0,6),i=n(i,10),c=o(c,u,f,i,r,e[13],0,7),f=n(f,10),r=o(r,c,u,f,i,e[14],0,9),u=n(u,10),i=o(i,r,c,u,f,e[15],0,8),c=n(c,10),f=s(f,i,r,c,u,e[7],1518500249,7),r=n(r,10),u=s(u,f,i,r,c,e[4],1518500249,6),i=n(i,10),c=s(c,u,f,i,r,e[13],1518500249,8),f=n(f,10),r=s(r,c,u,f,i,e[1],1518500249,13),u=n(u,10),i=s(i,r,c,u,f,e[10],1518500249,11),c=n(c,10),f=s(f,i,r,c,u,e[6],1518500249,9),r=n(r,10),u=s(u,f,i,r,c,e[15],1518500249,7),i=n(i,10),c=s(c,u,f,i,r,e[3],1518500249,15),f=n(f,10),r=s(r,c,u,f,i,e[12],1518500249,7),u=n(u,10),i=s(i,r,c,u,f,e[0],1518500249,12),c=n(c,10),f=s(f,i,r,c,u,e[9],1518500249,15),r=n(r,10),u=s(u,f,i,r,c,e[5],1518500249,9),i=n(i,10),c=s(c,u,f,i,r,e[2],1518500249,11),f=n(f,10),r=s(r,c,u,f,i,e[14],1518500249,7),u=n(u,10),i=s(i,r,c,u,f,e[11],1518500249,13),c=n(c,10),f=s(f,i,r,c,u,e[8],1518500249,12),r=n(r,10),u=a(u,f,i,r,c,e[3],1859775393,11),i=n(i,10),c=a(c,u,f,i,r,e[10],1859775393,13),f=n(f,10),r=a(r,c,u,f,i,e[14],1859775393,6),u=n(u,10),i=a(i,r,c,u,f,e[4],1859775393,7),c=n(c,10),f=a(f,i,r,c,u,e[9],1859775393,14),r=n(r,10),u=a(u,f,i,r,c,e[15],1859775393,9),i=n(i,10),c=a(c,u,f,i,r,e[8],1859775393,13),f=n(f,10),r=a(r,c,u,f,i,e[1],1859775393,15),u=n(u,10),i=a(i,r,c,u,f,e[2],1859775393,14),c=n(c,10),f=a(f,i,r,c,u,e[7],1859775393,8),r=n(r,10),u=a(u,f,i,r,c,e[0],1859775393,13),i=n(i,10),c=a(c,u,f,i,r,e[6],1859775393,6),f=n(f,10),r=a(r,c,u,f,i,e[13],1859775393,5),u=n(u,10),i=a(i,r,c,u,f,e[11],1859775393,12),c=n(c,10),f=a(f,i,r,c,u,e[5],1859775393,7),r=n(r,10),u=a(u,f,i,r,c,e[12],1859775393,5),i=n(i,10),c=l(c,u,f,i,r,e[1],2400959708,11),f=n(f,10),r=l(r,c,u,f,i,e[9],2400959708,12),u=n(u,10),i=l(i,r,c,u,f,e[11],2400959708,14),c=n(c,10),f=l(f,i,r,c,u,e[10],2400959708,15),r=n(r,10),u=l(u,f,i,r,c,e[0],2400959708,14),i=n(i,10),c=l(c,u,f,i,r,e[8],2400959708,15),f=n(f,10),r=l(r,c,u,f,i,e[12],2400959708,9),u=n(u,10),i=l(i,r,c,u,f,e[4],2400959708,8),c=n(c,10),f=l(f,i,r,c,u,e[13],2400959708,9),r=n(r,10),u=l(u,f,i,r,c,e[3],2400959708,14),i=n(i,10),c=l(c,u,f,i,r,e[7],2400959708,5),f=n(f,10),r=l(r,c,u,f,i,e[15],2400959708,6),u=n(u,10),i=l(i,r,c,u,f,e[14],2400959708,8),c=n(c,10),f=l(f,i,r,c,u,e[5],2400959708,6),r=n(r,10),u=l(u,f,i,r,c,e[6],2400959708,5),i=n(i,10),c=l(c,u,f,i,r,e[2],2400959708,12),f=n(f,10),r=h(r,c,u,f,i,e[4],2840853838,9),u=n(u,10),i=h(i,r,c,u,f,e[0],2840853838,15),c=n(c,10),f=h(f,i,r,c,u,e[5],2840853838,5),r=n(r,10),u=h(u,f,i,r,c,e[9],2840853838,11),i=n(i,10),c=h(c,u,f,i,r,e[7],2840853838,6),f=n(f,10),r=h(r,c,u,f,i,e[12],2840853838,8),u=n(u,10),i=h(i,r,c,u,f,e[2],2840853838,13),c=n(c,10),f=h(f,i,r,c,u,e[10],2840853838,12),r=n(r,10),u=h(u,f,i,r,c,e[14],2840853838,5),i=n(i,10),c=h(c,u,f,i,r,e[1],2840853838,12),f=n(f,10),r=h(r,c,u,f,i,e[3],2840853838,13),u=n(u,10),i=h(i,r,c,u,f,e[8],2840853838,14),c=n(c,10),f=h(f,i,r,c,u,e[11],2840853838,11),r=n(r,10),u=h(u,f,i,r,c,e[6],2840853838,8),i=n(i,10),c=h(c,u,f,i,r,e[15],2840853838,5),f=n(f,10),r=h(r,c,u,f,i,e[13],2840853838,6),u=n(u,10);var d=this._a,p=this._b,m=this._c,g=this._d,v=this._e;d=h(d,p,m,g,v,e[5],1352829926,8),m=n(m,10),v=h(v,d,p,m,g,e[14],1352829926,9),p=n(p,10),g=h(g,v,d,p,m,e[7],1352829926,9),d=n(d,10),m=h(m,g,v,d,p,e[0],1352829926,11),v=n(v,10),p=h(p,m,g,v,d,e[9],1352829926,13),g=n(g,10),d=h(d,p,m,g,v,e[2],1352829926,15),m=n(m,10),v=h(v,d,p,m,g,e[11],1352829926,15),p=n(p,10),g=h(g,v,d,p,m,e[4],1352829926,5),d=n(d,10),m=h(m,g,v,d,p,e[13],1352829926,7),v=n(v,10),p=h(p,m,g,v,d,e[6],1352829926,7),g=n(g,10),d=h(d,p,m,g,v,e[15],1352829926,8),m=n(m,10),v=h(v,d,p,m,g,e[8],1352829926,11),p=n(p,10),g=h(g,v,d,p,m,e[1],1352829926,14),d=n(d,10),m=h(m,g,v,d,p,e[10],1352829926,14),v=n(v,10),p=h(p,m,g,v,d,e[3],1352829926,12),g=n(g,10),d=h(d,p,m,g,v,e[12],1352829926,6),m=n(m,10),v=l(v,d,p,m,g,e[6],1548603684,9),p=n(p,10),g=l(g,v,d,p,m,e[11],1548603684,13),d=n(d,10),m=l(m,g,v,d,p,e[3],1548603684,15),v=n(v,10),p=l(p,m,g,v,d,e[7],1548603684,7),g=n(g,10),d=l(d,p,m,g,v,e[0],1548603684,12),m=n(m,10),v=l(v,d,p,m,g,e[13],1548603684,8),p=n(p,10),g=l(g,v,d,p,m,e[5],1548603684,9),d=n(d,10),m=l(m,g,v,d,p,e[10],1548603684,11),v=n(v,10),p=l(p,m,g,v,d,e[14],1548603684,7),g=n(g,10),d=l(d,p,m,g,v,e[15],1548603684,7),m=n(m,10),v=l(v,d,p,m,g,e[8],1548603684,12),p=n(p,10),g=l(g,v,d,p,m,e[12],1548603684,7),d=n(d,10),m=l(m,g,v,d,p,e[4],1548603684,6),v=n(v,10),p=l(p,m,g,v,d,e[9],1548603684,15),g=n(g,10),d=l(d,p,m,g,v,e[1],1548603684,13),m=n(m,10),v=l(v,d,p,m,g,e[2],1548603684,11),p=n(p,10),g=a(g,v,d,p,m,e[15],1836072691,9),d=n(d,10),m=a(m,g,v,d,p,e[5],1836072691,7),v=n(v,10),p=a(p,m,g,v,d,e[1],1836072691,15),g=n(g,10),d=a(d,p,m,g,v,e[3],1836072691,11),m=n(m,10),v=a(v,d,p,m,g,e[7],1836072691,8),p=n(p,10),g=a(g,v,d,p,m,e[14],1836072691,6),d=n(d,10),m=a(m,g,v,d,p,e[6],1836072691,6),v=n(v,10),p=a(p,m,g,v,d,e[9],1836072691,14),g=n(g,10),d=a(d,p,m,g,v,e[11],1836072691,12),m=n(m,10),v=a(v,d,p,m,g,e[8],1836072691,13),p=n(p,10),g=a(g,v,d,p,m,e[12],1836072691,5),d=n(d,10),m=a(m,g,v,d,p,e[2],1836072691,14),v=n(v,10),p=a(p,m,g,v,d,e[10],1836072691,13),g=n(g,10),d=a(d,p,m,g,v,e[0],1836072691,13),m=n(m,10),v=a(v,d,p,m,g,e[4],1836072691,7),p=n(p,10),g=a(g,v,d,p,m,e[13],1836072691,5),d=n(d,10),m=s(m,g,v,d,p,e[8],2053994217,15),v=n(v,10),p=s(p,m,g,v,d,e[6],2053994217,5),g=n(g,10),d=s(d,p,m,g,v,e[4],2053994217,8),m=n(m,10),v=s(v,d,p,m,g,e[1],2053994217,11),p=n(p,10),g=s(g,v,d,p,m,e[3],2053994217,14),d=n(d,10),m=s(m,g,v,d,p,e[11],2053994217,14),v=n(v,10),p=s(p,m,g,v,d,e[15],2053994217,6),g=n(g,10),d=s(d,p,m,g,v,e[0],2053994217,14),m=n(m,10),v=s(v,d,p,m,g,e[5],2053994217,6),p=n(p,10),g=s(g,v,d,p,m,e[12],2053994217,9),d=n(d,10),m=s(m,g,v,d,p,e[2],2053994217,12),v=n(v,10),p=s(p,m,g,v,d,e[13],2053994217,9),g=n(g,10),d=s(d,p,m,g,v,e[9],2053994217,12),m=n(m,10),v=s(v,d,p,m,g,e[7],2053994217,5),p=n(p,10),g=s(g,v,d,p,m,e[10],2053994217,15),d=n(d,10),m=s(m,g,v,d,p,e[14],2053994217,8),v=n(v,10),p=o(p,m,g,v,d,e[12],0,8),g=n(g,10),d=o(d,p,m,g,v,e[15],0,5),m=n(m,10),v=o(v,d,p,m,g,e[10],0,12),p=n(p,10),g=o(g,v,d,p,m,e[4],0,9),d=n(d,10),m=o(m,g,v,d,p,e[1],0,12),v=n(v,10),p=o(p,m,g,v,d,e[5],0,5),g=n(g,10),d=o(d,p,m,g,v,e[8],0,14),m=n(m,10),v=o(v,d,p,m,g,e[7],0,6),p=n(p,10),g=o(g,v,d,p,m,e[6],0,8),d=n(d,10),m=o(m,g,v,d,p,e[2],0,13),v=n(v,10),p=o(p,m,g,v,d,e[13],0,6),g=n(g,10),d=o(d,p,m,g,v,e[14],0,5),m=n(m,10),v=o(v,d,p,m,g,e[0],0,15),p=n(p,10),g=o(g,v,d,p,m,e[3],0,13),d=n(d,10),m=o(m,g,v,d,p,e[9],0,11),v=n(v,10),p=o(p,m,g,v,d,e[11],0,11),g=n(g,10);var y=this._b+c+g|0;this._b=this._c+u+v|0,this._c=this._d+f+d|0,this._d=this._e+i+p|0,this._e=this._a+r+m|0,this._a=y},r.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=new t(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=r}).call(t,i(3).Buffer)},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function n(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,n,a,l,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(i=this._events[e],s(i))return!1;if(r(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(o(i))for(a=Array.prototype.slice.call(arguments,1),h=i.slice(),n=h.length,l=0;l<n;l++)h[l].apply(this,a);return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,n,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||r(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(i)){for(a=s;a-- >0;)if(i[a]===t||i[a].listener&&i[a].listener===t){n=a;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],r(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){"use strict";(function(t,r,n){function o(e){var t=this;this.next=null,this.entry=null,this.finish=function(){A(t,e)}}function s(e){return F.from(e)}function a(e){return F.isBuffer(e)||e instanceof L}function l(){}function h(e,t){C=C||i(10),e=e||{},this.objectMode=!!e.objectMode,t instanceof C&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){y(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function c(e){if(C=C||i(10),!(N.call(c,this)||this instanceof C))return new c(e);this._writableState=new h(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),O.call(this)}function u(e,t){var i=new Error("write after end");e.emit("error",i),P(t,i)}function f(e,t,i,r){var n=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),P(r,o),n=!1),n}function d(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=F.from(t,i)),t}function p(e,t,i,r,n,o){if(!i){var s=d(t,r,n);r!==s&&(i=!0,n="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var l=t.length<t.highWaterMark;if(l||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:n,isBuf:i,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else m(e,t,!1,a,r,n,o);return l}function m(e,t,i,r,n,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,i?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function g(e,t,i,r,n){--t.pendingcb,i?(P(n,r),P(w,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(n(r),e._writableState.errorEmitted=!0,e.emit("error",r),w(e,t))}function v(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function y(e,t){var i=e._writableState,r=i.sync,n=i.writecb;if(v(i),t)g(e,i,r,t,n);else{var o=T(i);o||i.corked||i.bufferProcessing||!i.bufferedRequest||x(e,i),r?R(_,e,i,o,n):_(e,i,o,n)}}function _(e,t,i,r){i||b(e,t),t.pendingcb--,r(),w(e,t)}function b(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function x(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var r=t.bufferedRequestCount,n=new Array(r),s=t.corkedRequestsFree;s.entry=i;for(var a=0,l=!0;i;)n[a]=i,i.isBuf||(l=!1),i=i.next,a+=1;n.allBuffers=l,m(e,t,!0,t.length,n,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new o(t)}else{for(;i;){var h=i.chunk,c=i.encoding,u=i.callback;if(m(e,t,!1,t.objectMode?1:h.length,h,c,u),i=i.next,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=i,t.bufferProcessing=!1}function T(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final(function(i){t.pendingcb--,i&&e.emit("error",i),t.prefinished=!0,e.emit("prefinish"),w(e,t)})}function S(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,P(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}function w(e,t){var i=T(t);return i&&(S(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}function M(e,t,i){t.ending=!0,w(e,t),i&&(t.finished?P(i):e.once("finish",i)),t.ended=!0,e.writable=!1}function A(e,t,i){var r=e.entry;for(e.entry=null;r;){var n=r.callback;t.pendingcb--,n(i),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}var P=i(21);e.exports=c;var C,R=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:P;c.WritableState=h;var D=i(14);D.inherits=i(0);var I={deprecate:i(91)},O=i(44),F=i(2).Buffer,L=n.Uint8Array||function(){},B=i(45);D.inherits(c,O),h.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(h.prototype,"buffer",{get:I.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}();var N;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(N=Function.prototype[Symbol.hasInstance],Object.defineProperty(c,Symbol.hasInstance,{value:function(e){return!!N.call(this,e)||e&&e._writableState instanceof h}})):N=function(e){return e instanceof this},c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},c.prototype.write=function(e,t,i){var r=this._writableState,n=!1,o=a(e)&&!r.objectMode;return o&&!F.isBuffer(e)&&(e=s(e)),"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof i&&(i=l),r.ended?u(this,i):(o||f(this,r,e,i))&&(r.pendingcb++,n=p(this,r,o,e,t,i)),n},c.prototype.cork=function(){this._writableState.corked++},c.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||x(this,e))},c.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},c.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},c.prototype._writev=null,c.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||M(this,r,i)},Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),c.prototype.destroy=B.destroy,c.prototype._undestroy=B.undestroy,c.prototype._destroy=function(e,t){this.end(),t(e)}}).call(t,i(8),i(40).setImmediate,i(1))},function(e,t,i){"use strict";function r(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}function n(e){var t=r(e);if("string"!=typeof t&&(y.isEncoding===_||!_(e)))throw new Error("Unknown encoding: "+e);return t||e}function o(e){this.encoding=n(e);var t;switch(this.encoding){case"utf16le":this.text=f,this.end=d,t=4;break;case"utf8":this.fillLast=h,t=4;break;case"base64":this.text=p,this.end=m,t=3;break;default:return this.write=g,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=y.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function a(e,t,i){var r=t.length-1;if(r<i)return 0;var n=s(t[r]);return n>=0?(n>0&&(e.lastNeed=n-1),n):--r<i?0:(n=s(t[r]))>=0?(n>0&&(e.lastNeed=n-2),n):--r<i?0:(n=s(t[r]),n>=0?(n>0&&(2===n?n=0:e.lastNeed=n-3),n):0)}function l(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(i);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(i+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(i+2)}}function h(e){var t=this.lastTotal-this.lastNeed,i=l(this,e,t);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){var i=a(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var r=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t}function f(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var r=i.charCodeAt(i.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function p(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function m(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function g(e){return e.toString(this.encoding)}function v(e){return e&&e.length?this.write(e):""}var y=i(2).Buffer,_=y.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},o.prototype.end=u,o.prototype.text=c,o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,i){var t=e.exports=function(e){e=e.toLowerCase();var i=t[e];if(!i)throw new Error(e+" is not supported (we accept pull requests)");return new i};t.sha=i(97),t.sha1=i(98),t.sha224=i(99),t.sha256=i(47),t.sha384=i(100),t.sha512=i(48)},function(e,t,i){function r(){return Object.keys(s)}var n=i(107),o=i(115),s=i(57);t.createCipher=t.Cipher=n.createCipher,t.createCipheriv=t.Cipheriv=n.createCipheriv,t.createDecipher=t.Decipher=o.createDecipher,t.createDecipheriv=t.Decipheriv=o.createDecipheriv,t.listCiphers=t.getCiphers=r},function(e,t,i){var r={ECB:i(108),CBC:i(109),CFB:i(110),CFB8:i(111),CFB1:i(112),OFB:i(113),CTR:i(55),GCM:i(55)},n=i(57);for(var o in n)n[o].module=r[n[o].mode];e.exports=n},function(e,t,i){"use strict";t.utils=i(117),t.Cipher=i(118),t.DES=i(119),t.CBC=i(120),t.EDE=i(121)},function(e,t,i){(function(t){function r(e){var t=o(e);return{blinder:t.toRed(s.mont(e.modulus)).redPow(new s(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}function n(e,i){var n=r(i),o=i.modulus.byteLength(),a=(s.mont(i.modulus),new s(e).mul(n.blinder).umod(i.modulus)),l=a.toRed(s.mont(i.prime1)),h=a.toRed(s.mont(i.prime2)),c=i.coefficient,u=i.prime1,f=i.prime2,d=l.redPow(i.exponent1),p=h.redPow(i.exponent2);d=d.fromRed(),p=p.fromRed();var m=d.isub(p).imul(c).umod(u);return m.imul(f),p.iadd(m),new t(p.imul(n.unblinder).umod(i.modulus).toArray(!1,o))}function o(e){for(var t=e.modulus.byteLength(),i=new s(a(t));i.cmp(e.modulus)>=0||!i.umod(e.prime1)||!i.umod(e.prime2);)i=new s(a(t));return i}var s=i(4),a=i(11);e.exports=n,n.getr=o}).call(t,i(3).Buffer)},function(e,t,i){var r=t;r.utils=i(7),r.common=i(16),r.sha=i(137),r.ripemd=i(141),r.hmac=i(142),r.sha1=r.sha.sha1,r.sha256=r.sha.sha256,r.sha224=r.sha.sha224,r.sha384=r.sha.sha384,r.sha512=r.sha.sha512,r.ripemd160=r.ripemd.ripemd160},function(e,t,i){"use strict";var r=i(41),n=(i(221),i(222)),o=i(177),s=i(178);window.$=i(84),window.jQuery=window.$;var a=i(223),l=i(228),h=i(232),c=i(237),u=i(239).default;void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){var t=this.indexOf(e);return this.length===t+e.length});var f=function(){};f.event={STEP_COMPLETE:"stepComlete"},f.prototype.confData=null,f.prototype.menu=new o,f.STACK_WIDTH=1245,f.prototype.init=function(e,t,i){function n(){$("#loading-bar-spinner").css({left:$(window).width()-$(this).width()/2,top:$(window).height()-$(this).height()/2}),$("#loading-bg").css({width:$(window).width(),height:$(window).height()})}function o(){PIXI.loader.add(r.config.URI_PREFIX+"assets/skin.json").load(function(){instance._init(r.config.MODEL_URI_PREFIX+e,r.config.MODEL_URI_PREFIX+t)})}f.W=r.canvasWidth,f.H=r.canvasHeight,this.options=Object.assign({useResize:!0},i),n(),$(window).resize(n),void 0!=e&&void 0!=t&&(window.instance=this,this.renderer=PIXI.autoDetectRenderer(f.W,f.H,{transparent:!0,resolution:1},!1),document.body.appendChild(this.renderer.view),$.getJSON(window.baseURL+"assets/config.json",function(e){var t=e.config;for(var i in t)r.config[i]=t[i];o()}).fail(function(){o()}),instance.touchScreen=!1,document.addEventListener("touchstart",function(e){instance.touchScreen=!0}),c.loadConfig(c.TYPE.SCI).then(function(e){/(^http:\/\/127\.0\.0\.1)|localhost/.test(window.location.href)||e.autoAuth()}))},f.prototype.showNoBookInfo=function(){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=["\n %c %c %c NOBOOK Html5 Engine. version:0.5.0 %c  %c  http://www.nobook.com.cn/  %c %c \n\n","background: #17797F; padding:5px 0;","background: #17797F; padding:5px 0;","color: #FFFFFF; background: #F55722; padding:5px 0;","background: #17797F; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #17797F; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,e)}else window.console&&window.console.log("NOBOOK Html5 Engine. version:0.5.0 - http://www.nobook.com.cn/")},f.prototype.setLoading=function(e,t){void 0===this.loading&&(this.loading=new n),e?this.loading.show():this.loading.hide(),this.loading.progress(t||0)},f.prototype.updateBackground=function(){0===$("#bgDiv").length&&($("body").append($('<div id="bgDiv"/>')),$("#bgDiv").css({width:"100%",height:"100%",position:"absolute",zIndex:"-1","background-color":"#222"}))},f.prototype.onResize=function(){if(this.options.useResize){var e=this,t=$(window).width(),i=$(window).height();console.log(t,i),f.isIOS&&window.parent&&(t=$(window.parent).width(),i=$(window.parent).height());var n=t/i,o=r.canvasWidth/r.canvasHeight,s=instance.renderer.view;if(n>o?(s.width=r.canvasWidth*(n/o),s.height=r.canvasHeight):(s.width=r.canvasWidth,s.height=r.canvasHeight/(n/o)),instance.renderer.resize(s.width,s.height),s.style.width=t+"px",s.style.height=i+"px",s.style.position="absolute",e.updateBackground(),f.W=s.width,f.H=s.height,instance.W=s.width,instance.H=s.height,f.STACK_WIDTH=s.width-r.stackPosX,e.viewStack&&(e.viewStack.x=r.stackPosX+(s.width-r.canvasWidth)/2,e.viewStack.y=(s.height-r.canvasHeight)/2),e.has3DCanvas()){var a=e.get3DCanvas();a.width=s.width,a.height=s.height,a.style.widht=t+"px",a.style.height=i+"px"}}},f.prototype._init=function(e,t){document.oncontextmenu=document.body.oncontextmenu=function(){return!1},$("body").css({margin:0});var n={};if(n["overflow-x"]="hidden",n["overflow-y"]="hidden",$("body").css(n),window.addEventListener("resize",this.onResize.bind(this)),this.onResize(),setTimeout(this.onResize.bind(this),10),this.baseURI=e.substring(0,e.lastIndexOf("/")+1),this.stage=new PIXI.Container,this.viewStack=new PIXI.Container,this.viewStack.x=r.stackPosX,this.viewStack.on(f.event.STEP_COMPLETE,function(e){instance.menu.setMenuIndexStatus(e.frame,NbBiologyMenu.status.COMPLETE)}),!window.BABYLON){var o=a(),c=instance.info&&instance.info.CONCLUSION?instance.info.CONCLUSION:"";o.setText(c);var d=instance.info&&instance.info.CONCLUSIONAlign?instance.info.CONCLUSIONAlign:"";o.setTextAlign(d);var p=PIXI.Sprite.fromFrame("nb.resultBtn"),m=PIXI.Sprite.fromFrame("nb.resultBtn1"),g=new PIXI.extras.MovieClip([p,m]);this.viewStack.addChild(g),g.x=1070,g.y=640,this.resultBtn=g,g.addEventListener(TouchEvent.TAP,function(){g.gotoAndStop(1),$("#colPanel").css({zIndex:200,left:"50%",transform:"translate(-50%, -50%)"}),$(".model").css("zIndex",100),TweenMax.to($("#colPanel"),.5,{top:"60%",ease:Sine.easeInOut,onComplete:function(){TweenMax.to($("#colPanel"),.2,{top:"50%",ease:Sine.easeInOut})}}),$(".model").stop().animate({opacity:.7},500,function(){function e(){$(".model").off("click",e),g.gotoAndStop(0),TweenMax.to($("#colPanel"),.2,{top:"60%",ease:Sine.easeInOut,onComplete:function(){TweenMax.to($("#colPanel"),.5,{top:"-50%",ease:Sine.easeInOut})}}),$(".model").stop().animate({opacity:0},700,function(){$(".model").css("zIndex",-1)})}$(".model").off().on("click",e)})});var v=PIXI.Sprite.fromFrame("nb.resetBtn0"),y=PIXI.Sprite.fromFrame("nb.resetBtn1"),_=new PIXI.extras.MovieClip([v,y]);this.viewStack.addChild(_),this.resetBtn=_,_.y=750,_.x=870,_.visible=!1,_.addEventListener(TouchEvent.TAP,function(){_.gotoAndStop(1),TweenMax.to(_,.5,{y:750,onComplete:function(){instance.gotoStep("discuss"),instance.gotoStep("frame1"),_.gotoAndStop(0),$(".tip").stop().animate({top:-115},0)}})});var b=l();this.tip=b;(instance.info&&instance.info.ISOFFSET?instance.info.ISOFFSET:void 0)&&(this.resetBtn.x=this.resultBtn.x,this.resultBtn.x+=500)}var x=new h;instance.NBDownTip=x;var T=PIXI.Sprite.fromFrame("steps");this.stage.addChild(T),T.alpha=0,instance.NBStepsShow=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments[1],i=arguments[2];TweenMax.killTweensOf(T),e||TweenMax.to(T,.5,{alpha:0}),T.x=t,T.y=i;var r=t+30;TweenMax.to(T,.4,{x:r,yoyo:!0,repeat:-1}),e&&TweenMax.to(T,.5,{alpha:1})},instance.lateHide=function(){T.visible=!1},this.addInteractionDomObj($("#timeline")[0]),this.stage.addChild(this.viewStack),this.canvas=this.renderer.view,this.canvas.id="bioCanvas",this.interactiveManager=new s(this.canvas);var E=PIXI.Sprite.fromFrame("nb.backBtn");window._global_lg&&(E.visible=!1);var S=110;window.require&&(S=150),i(176).add(E,{top:S,left:100}),instance.backBtn=E,E.addEventListener(TouchEvent.TAP,function(){window.parent!=window&&void 0!==window.require?window.parent.dispatchEvent(new Event("showMenu")):window.history.length>1?window.history.back():window.location.href="http://www.nobook.com.cn"}),this.render(),instance.firstCircle=!0,PIXI.loader.add(e).load(function(){$.getJSON(t,function(e,t){function i(){if("success"==t&&1==instance.firstCircle){if(window._global_lg)if(""!=_global_lg.from){var e="url(./assets/"+_global_lg.from+".png)";$("#logo").css({"background-image":e})}else $("#logo").css({"background-image":"url(./assets/logo1.png)"});instance.isFirstStart=!1}else setTimeout(function(){i()},100)}"success"==t&&(instance.confData=e,instance.start(),instance.showNoBookInfo()),setTimeout(function(){i()},100)})}),SoundManager.loadCommonSounds(function(e){e.id,SoundManager.BG_SOUND}),this.renderer.view.addEventListener("click",function(e){}),u.apply()},f.prototype.get3DCanvas=function(){if(!this._3dCanvas){var e=document.createElement("canvas");e.style.touchAction="none",document.body.appendChild(e),this._3dCanvas=e,$(e).attr("oncontextmenu","return false"),this.onResize()}return this._3dCanvas},f.prototype.has3DCanvas=function(){return!!this._3dCanvas},f.prototype.resetBtnEnable=function(e){e&&(console.log("InitframeBEFUn"),instance.resetBtn.visible=!0,TweenMax.to(instance.resetBtn,.4,{y:640}))},f.prototype.changeBackground=function(e){var t=["libs/css/timeliner.css","libs/css/timeliner1.css","libs/css/timeliner2.css","libs/css/timeliner3.css","libs/css/timeliner1.css"];$("#theme")[0].href=t[e],this.updateBackground()},f.prototype.changeBackgroundToBig=function(e){this.updateBackground()},f.prototype.findDataByLabel=function(e){var t=this.menu.getConfig();if(void 0===e)return null;if(null==t)return null;for(var i=0;i<t.length;i++){var r=t[i];if(r.goto===e)return r}return null},f.prototype.setFullStageMode=function(e){e?(this.menu.visible=!1,this.viewStack.x=0):(this.menu.visible=!0,this.viewStack.x=r.stackPosX)},f.prototype.setRefLineVisible=function(e){this.refLine.visible=e},f.prototype.bindScriptToSprite=function(e,t){null==this.bindData&&(this.bindData={}),this.bindData[t]=e},f.prototype.autoBindScript=function(){for(var e=0;e<1e4;e++){var t="frame"+e;if(!this[t])break;this.bindScriptToSprite(this[t],t)}},f.prototype.start=function(){this.autoBindScript()},f.prototype.jumpTo=function(e){var t;t="string"==typeof e?{index:e}:e,instance.menu.selectMenuIndex(t)&&instance.gotoStep(t.index)},f.prototype.getCurrentFrame=function(){return this.viewStack.lastSprite},f.prototype.gotoStep=function(e){var t=this.viewStack.lastSprite;if(void 0!=t&&t==this.viewStack[e])return t;if(!0===r.config.resetStep&&void 0!=t){if(0===t.name.indexOf("frame")&&void 0===t.threeSystem){var i=t.name;t.emit("destory"),t.onDestory&&t.onDestory(),delete this.viewStack[i],console.log("destory",i)}0===t.name.indexOf("frame")&&$("#loading-bar-spinner")&&$("#loading-bar-spinner").remove()}if(t&&(t.visible=!1,t.threeSystem&&t.threeSystem.hide(),t.onPause&&t.onPause.apply(t),t.emit("onPause")),null==this.viewStack[e])for(var n=0;n<this.confData.length;n++){var o=this.confData[n];if(o.name==e&&(this.createChildFromData(this.viewStack,o),this.viewStack.lastSprite=this.viewStack[e],null!=this.bindData[e])){this.bindData[e].apply(this.viewStack.lastSprite);var t=this.viewStack.lastSprite;t.onStart&&t.onStart.apply(t),t.emit("onStart"),t.onResume&&t.onResume.apply(t),t.emit("onResume")}}else{var t=this.viewStack.lastSprite=this.viewStack[e];t.onResume&&t.onResume.apply(t),t.emit("onResume")}var s=this.viewStack[e];return s?(s.visible=!0,s.threeSystem&&s.threeSystem.show()):console.error("没有配置"+e+"对象"),this.menu.currentFrame=s.name,s},f.prototype.bindSpriteToMenuIndex=function(e,t){this.menu.bindSpriteMap[t]=e},f.prototype.createChildFromData=function(e,t){var n={};return function(e,t){if("sprite"==t.type||"bitmap"==t.type){var o;if(void 0==t.libName)o=new PIXI.Container;else{var s=/\[output-jpg-(\d+)\]/i,a=t.libName,l=s.exec(a);if(null!=l){if(void 0===this.jpgLoaderMap&&(this.jpgLoaderMap={}),-1===this.baseURI.indexOf(r.config.URI_PREFIX))var h=r.config.URI_PREFIX+this.baseURI+a+".json";else var h=this.baseURI+a+".json";var c=i(242);if(o=new PIXI.Sprite,void 0===this.jpgLoaderMap[h]){var u=new c;o.addChild(u);var f=[];this.jpgLoaderMap[h]={queue:f};PIXI.loader.add(h).load(function(){u.destory(),o.texture=PIXI.Texture.fromFrame(a);for(var e=0;e<f.length;e++)f[e]()})}else try{o.texture=PIXI.Texture.fromFrame(a)}catch(e){var f=this.jpgLoaderMap[h].queue;f.push(function(){o.texture=PIXI.Texture.fromFrame(a)})}}else o=new PIXI.Sprite(PIXI.Texture.fromFrame(t.libName))}this.setDisplayInfo(e,o,t),this.setCommonData(o,t),e.addChildAt(o,0),e==this.viewStack?(o.frameRoot=o,o.onStepComplete=function(){if(void 0==this.isComplete)return void console.log("当前步骤完成")},o.showTip=function(e){void 0==this.__tip__&&(this.__tip__=new NBTip,this.addChild(this.__tip__),this.__tip__.x=80,this.__tip__.y=160),this.__tip__.setText(e)},o.hideTip=function(){void 0!=this.__tip__&&this.__tip__.parent.removeChild(this.__tip__)}):o.frameRoot=e.frameRoot;for(var d=0;d<int.MAX_VALUE&&void 0!=t[d];d++)this.createChildFromData(o,t[d]);return o.emit("creationComplete"),o}if("movie"==t.type){for(var p=[],d=0;d<int.MAX_VALUE&&void 0!=t[d];d++)p.push(PIXI.Texture.fromFrame(t[d].libName));var m=new PIXI.extras.MovieClip(p);return this.setDisplayInfo(e,m,t),this.setCommonData(m,t),m.emit("creationComplete"),e.addChildAt(m,0),m}if("text"==t.type){var g=/\d*/gi,v=t.f,y=g.exec(t.f);v=v.replace(y,y);var g=/["|'](.*)["|']/g,_=g.exec(t.f);v=v.replace(_[0],"'Microsoft YaHei'");var g=new RegExp(/\${(.*)}/),l=g.exec(t.txt),b=t.txt;if(null!=l){for(var x=l[1],T=x.split("."),E=instance,d=0;d<T.length;d++)E=E[T[d]];b=E}var S,w,M,A=t.w,P=t.h,C=Math.cos,R=Math.sin,D={x:t.x,y:t.y},I=t.r;console.log(I),S=I>0&&I<Math.PI/2?I:I>Math.PI/2?Math.PI-I:I<-Math.PI/2?Math.PI-Math.abs(I):Math.abs(I);var O=C(S)*C(S)-R(S)*R(S),F=(A*C(S)-P*R(S))/O,L=(-A*R(S)+P*C(S))/O;I==Math.PI/2&&(I+=.001),I>=0&&I<Math.PI/2?(w=D.x+L*R(S),M=D.y):I>Math.PI/2?(w=D.x+A,M=D.y+L*C(S)):I<-Math.PI/2?(w=D.x+F*C(S),M=D.y+P):(w=D.x,M=D.y+F*R(S));var B=new PIXI.Text(b,{font:v,wordWrap:!0,fill:t.c,wordWrapWidth:F,align:t.a});return this.setDisplayInfo(e,B,t),B.x=w,B.y=M,B.rotation=t.r,e.addChildAt(B,0),B}if("button"==t.type){var p=[],N=PIXI.Texture.fromFrame(t[0].libName),k=PIXI.Texture.fromFrame(t[1].libName),m=new NBButton(N,k);return this.setDisplayInfo(e,m,t),this.setCommonData(m,t),e.addChildAt(m,0),m}if("nbMovie"==t.type){var V=new PIXI.Container;e.addChildAt(V,0),r.MovieClip.apply(V);for(var d=0;d<int.MAX_VALUE;d++){var U=t[d];if(void 0===U)break;for(var z=0;z<int.MAX_VALUE;z++){var G=U[z];if(void 0===G)break;var H=n[G.elementID]||this.createChildFromData(V,G);void 0!=G.elementID&&void 0===n[G.elementID]?n[G.elementID]=H:console.log("copy......"),V.insertDisplayObjectToFrame(H,d,G.tweenTransform)}}return this.setDisplayInfo(e,V,t),this.setCommonData(V,t),V.gotoAndStop(0),V.emit("creationComplete"),V}if("shape"==t.type){var j=new PIXI.Graphics;return e.addChildAt(j,0),r.GraphicsUtils.draw(j,t.path.concat()),j}}.call(this,e,t)},f.prototype.setDisplayInfo=function(e,t,i){null!=i.name&&(e[i.name]=t,t.name=i.name),e==this.viewStack?t.frameRoot=t:(t.frameRoot=e.frameRoot,e===t.frameRoot?t.stepRoot=t:t.stepRoot=e.stepRoot)},f.prototype.setCommonData=function(e,t){if(e._nbData_=t,0!=t.r?e.setTransform(t.x,t.y,t.sx,t.sy,t.r):e.setTransform(t.x,t.y,t.sx,t.sy,0,t.skewX,t.skewY),e.alpha=isNaN(t.a)?1:t.a,void 0!==t.linkageClassName)if(-1!==t.linkageClassName.indexOf("bind:")){var i=t.linkageClassName.replace("bind:",""),r=this[i];r&&(this.bindScriptToSprite(r,e.name),console.log("bind object"+e.name+" to function "+i))}else for(var n=t.linkageClassName.split("|"),o=0;o<n.length;o++){for(var s=n[o].split("."),a=window,l=0;l<s.length;l++){if(l==s.length-1){var h=s[l],c=h.indexOf("(");if(-1!=c){var u=h.substring(c+1,h.length-1);u="["+u.replace(/'/gi,'"')+"]",h=h.substring(0,c),a=a[h]}else a=a[s[l]]}else a=a[s[l]];if(void 0===a)break;if(l===s.length-1){var r=function(t,i,r){return function(){if(u){try{var n=JSON.parse(r)}catch(e){console.log("请传入json数据")}t.apply(e,n)}else t.apply(e);e.linkageClassName=i,console.log(i)}};e.once("creationComplete",r(a,n[o],u))}}if(l!==s.length)try{var f=JSON.parse(t.linkageClassName);for(var d in f)void 0!=e[d]&&console.warn("属性"+d+"被覆盖!"),e[d]=f[d]}catch(e){console.log("warning:",t.linkageClassName+"没有该类，请确认引入了该js文件.")}}void 0!==t.b2Data&&(e.b2Data=t.b2Data),void 0!==t.threeData&&(e.threeData=t.threeData)},f.prototype.alert=function(e,t){function i(){TweenMax.killTweensOf(instance.alertGraphics),TweenMax.to(instance.alertGraphics,.6,{alpha:0,onComplete:function(){instance.alertGraphics.visible=!1}}),this.removeEventListener("touchstart",arguments.callee),this.removeEventListener("mousedown",arguments.callee)}if(void 0!==e&&(this.__lastInfo!=e||!this.alertGraphics||1!=this.alertGraphics.visible)){if(this.__lastInfo=e,instance.alertGraphics&&1==instance.alertGraphics.visible&&(instance.alertGraphics.visible=!1,TweenMax.killTweensOf(instance.alertGraphics)),void 0==t&&(t="warning"),null==this.alertGrapihcs){this.alertGraphics=new PIXI.Graphics,this.alertGraphics.beginFill(3237510),this.alertGraphics.lineStyle(20,8767212,1),this.alertGraphics.drawRoundedRect(0,0,950,260,50,50),this.alertGraphics.alpha=0;var r=new PIXI.Text("",{fill:"#FFFFFF",stroke:"#2A5873",strokeThickness:6,font:"normal 32px 微软雅黑",wordWrap:!0,wordWrapWidth:600});r.x=218,r.y=45,this.alertGraphics.addChild(r),this.alertGraphics.t=r,this.alertGraphics.icon=new PIXI.Sprite,this.alertGraphics.icon.x=50,this.alertGraphics.icon.y=60,this.alertGraphics.addChild(this.alertGraphics.icon)}switch(t){case"warning":SoundManager.play(SoundManager.WARNING),this.alertGraphics.icon.texture=PIXI.Texture.fromFrame("main.warning")}this.stage.addChild(this.alertGraphics),this.alertGraphics.visible=!0,this.alertGraphics.t.text=e,this.alertGraphics.t.y=(this.alertGraphics.height-this.alertGraphics.t.height>>1)-20,this.alertGraphics.x=f.W-this.alertGraphics.width>>1,this.alertGraphics.y=f.H-this.alertGraphics.height>>1,TweenMax.killTweensOf(this.alertGraphics),TweenMax.to(this.alertGraphics,.6,{alpha:1}),this.canvas.addEventListener("touchstart",i),this.canvas.addEventListener("mousedown",i)}},f.prototype.setRender=function(e){function t(){this._render_=e,this.stage.visible=e}TweenMax.killTweensOf(this.stage),e?(this.stage.visible=!0,TweenMax.to(this.stage,1,{alpha:1,onComplete:t.bind(this)})):TweenMax.to(this.stage,1,{alpha:0,onComplete:t.bind(this)})},f.prototype.render=function(){if(!instance._render_){instance.renderer.render(instance.stage);var e=instance.viewStack[instance.menu.getSelectMenuIndex()];void 0==instance.__time__&&(instance.__time__=Date.now());var t=Date.now(),i=t-instance.__time__;if(i>30&&(i=30),e&&(e.onUpdate&&e.onUpdate.apply(e,[i]),e.emit("update",{step:i}),e.getActiveStep)){var r=e.getActiveStep();r&&r.emit("update",{step:i})}instance.__time__=t,requestAnimationFrame(instance.render),instance.stats&&instance.stats.update()}},f.prototype.getNBLib=function(e){for(var t=String(Number(e)),i="",n=0;n<4-t.length;n++)i+="0";return e=i+t,r["biology"+e].prototypeDefine},f.prototype.load=function(){},f.prototype.addInteractionDomObj=function(e){if(e&&!0!==e.isAddedInteraction){e.isAddedInteraction=!0;for(var t=this,i=["mousedown","mousemove","mouseup","click","mouseover","mouseout","mouseupoutside","touchstart","touchend","touchmove","tap","touchendoutside"],r=0;r<i.length;r++){var n=i[r];e.addEventListener(n,function(e){var i=document.createEvent("Event");i.initEvent(e.type,!0,!0),i.view=e.view,i.detail=e.detail,i.screenX=e.screenX,i.screenY=e.screenY,i.clientX=e.clientX,i.clientY=e.clientY,i.ctrlKey=e.ctrlKey,i.altKey=e.altKey,i.shiftKey=e.shiftKey,i.metaKey=e.metaKey,i.button=e.button,i.relatedTarget=e.relatedTarget,i.isTrusted=!0,i.touches=e.touches,i.changedTouches=e.changedTouches,t.renderer.view.dispatchEvent(i)})}}},f.prototype.showStats=function(e){void 0===this.stats&&(this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",document.body.appendChild(this.stats.domElement)),this.stats.domElement.style.visibility=e?"visible":"hidden"},f.prototype.showToolTip=function(e,t,i){},f.prototype.changeFilters=function(e,t,i,r){var n=t>>16,o=t>>8&255,s=255&t,a=new PIXI.filters.ColorMatrixFilter;e.filters=[a],a.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];var l=new THREE.Vector3(1,1,1);TweenMax.to(l,i,{x:n/255,y:o/255,z:s/255,onUpdate:function(){a.matrix[0]=l.x,a.matrix[6]=l.y,a.matrix[12]=l.z},onComplete:function(){a.matrix[0]=l.x,a.matrix[6]=l.y,a.matrix[12]=l.z,r&&r()}})},f.prototype.addDiv=function(e,t,i,n){function o(){var t=$("canvas").get(0).width,i=$("canvas").get(0).height,o=$("canvas").get(0).style.width,s=$("canvas").get(0).style.height,a=parseInt(o)/parseInt(t),l=parseInt(s)/parseInt(i);$("#"+e).css({"background-color":"red",position:"absolute",width:n.width+"px",height:n.height+"px",top:-(1-l)*n.height/2+n.y*l+"px",left:-(1-a)*n.width/2+n.x*a+300*a+"px",transform:"matrix("+a+", 0, 0, "+l+","+(t-r.canvasWidth)/2*a+" ,"+(i-r.canvasHeight)/2*l+")"})}if(!$("#"+e).get(0)){var s=document.createElement("div");s.id=e,$("body").append(s),s.innerHTML=i,o(),window.addEventListener("resize",o)}},f.isPC=function(){return function(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),i=!0,r=0;r<t.length;r++)if(e.indexOf(t[r])>0){i=!1;break}return i}()}(),f.isIOS=function(){return function(){for(var e=navigator.userAgent,t=new Array("iPhone","iPad","iPod"),i=!1,r=0;r<t.length;r++)if(e.indexOf(t[r])>0){i=!0;break}return i}()}(),f.isAndroid=function(){return function(){for(var e=navigator.userAgent,t=new Array("Android"),i=!1,r=0;r<t.length;r++)if(e.indexOf(t[r])>0){i=!0;break}return i}()}(),f.browser=function(){var e=navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1==e.indexOf("KHTML"),mobile:!!e.match(/AppleWebKit.*Mobile.*/),iOS:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1==e.indexOf("Safari"),weChat:e.indexOf("MicroMessenger")>-1,UC:e.indexOf("UCBrowser")>-1}}(),f.MicApp=!1,e.exports=f},function(e,t,i){function r(e,t){this._id=e,this._clearFn=t}var n=Function.prototype.apply;t.setTimeout=function(){return new r(n.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(n.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},i(81),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,i){"use strict";var r=r||{};r.MAX_VALUE=2147483647,window.TouchEvent=window.TouchEvent||function(){},window.MouseEvent=window.MouseEvent||function(){},TouchEvent.TOUCH_BEGIN="touchstart",TouchEvent.TOUCH_MOVE="touchmove",TouchEvent.TOUCH_END="touchend",TouchEvent.TAP="tap",TouchEvent.TOUCH_END_OUDSIDE="touchendoutside",TouchEvent.simulateTouchDown=function(e,t){e.emit("touchstart",t),e.emit("mousedown",t),e._isLeftDown=!0},MouseEvent.TOUCH_BEGIN="mousedown",MouseEvent.TOUCH_MOVE="mousemove",MouseEvent.TOUCH_END="mouseup",MouseEvent.TAP="click",MouseEvent.TOUCH_END_OUDSIDE="mouseupoutside",MouseEvent.MOUSE_OVER="mouseover",MouseEvent.MOUSE_OUT="mouseout",window.nb=window.nb||{},nb.canvasWidth=1280,nb.canvasHeight=720,nb.stackPosX=0,nb.CAMERA_NEAR=.1,nb.THREE={},nb.config={defaultFrame:void 0,bgURL:"assets/bg_min.png",bgRepeat:"repeat-x",URI_PREFIX:"",MODEL_URI_PREFIX:"",corssOrigin:"anonymous",resetStep:!0},nb.PIXELS_PER_ML=100,nb.event=nb.event||{},nb.event.OBSERVE="observe",nb.event.CLICK_OUT_SIDE="nb.event.clickOutSide",window.int=r,e.exports=nb},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";(function(t,r){function n(e){return N.from(e)}function o(e){return N.isBuffer(e)||e instanceof k}function s(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?F(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}function a(e,t){O=O||i(10),e=e||{},this.objectMode=!!e.objectMode,t instanceof O&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:n,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new H,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(G||(G=i(32).StringDecoder),this.decoder=new G(e.encoding),this.encoding=e.encoding)}function l(e){if(O=O||i(10),!(this instanceof l))return new l(e);this._readableState=new a(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),B.call(this)}function h(e,t,i,r,o){var s=e._readableState;if(null===t)s.reading=!1,m(e,s);else{var a;o||(a=u(s,t)),a?e.emit("error",a):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===N.prototype||(t=n(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):c(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!i?(t=s.decoder.write(t),s.objectMode||0!==t.length?c(e,s,t,!1):y(e,s)):c(e,s,t,!1))):r||(s.reading=!1)}return f(s)}function c(e,t,i,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,r?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&g(e)),y(e,t)}function u(e,t){var i;return o(t)||"string"==typeof t||void 0===t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}function f(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function d(e){return e>=X?e=X:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function p(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=d(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function m(e,t){if(!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,g(e)}}function g(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(z("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?I(v,e):v(e))}function v(e){z("emit readable"),e.emit("readable"),S(e)}function y(e,t){t.readingMore||(t.readingMore=!0,I(_,e,t))}function _(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(z("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function b(e){return function(){var t=e._readableState;z("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&L(e,"data")&&(t.flowing=!0,S(e))}}function x(e){z("readable nexttick read 0"),e.read(0)}function T(e,t){t.resumeScheduled||(t.resumeScheduled=!0,I(E,e,t))}function E(e,t){t.reading||(z("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),S(e),t.flowing&&!t.reading&&e.read(0)}function S(e){var t=e._readableState;for(z("flow",t.flowing);t.flowing&&null!==e.read(););}function w(e,t){if(0===t.length)return null;var i;return t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=M(e,t.buffer,t.decoder),i}function M(e,t,i){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():i?A(e,t):P(e,t),r}function A(e,t){var i=t.head,r=1,n=i.data;for(e-=n.length;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(s===o.length?n+=o:n+=o.slice(0,e),0===(e-=s)){s===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=o.slice(s));break}++r}return t.length-=r,n}function P(e,t){var i=N.allocUnsafe(e),r=t.head,n=1;for(r.data.copy(i),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(i,i.length-e,0,s),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++n}return t.length-=n,i}function C(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,I(R,t,e))}function R(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function D(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}var I=i(21);e.exports=l;var O,F=i(42);l.ReadableState=a;var L=(i(30).EventEmitter,function(e,t){return e.listeners(t).length}),B=i(44),N=i(2).Buffer,k=t.Uint8Array||function(){},V=i(14);V.inherits=i(0);var U=i(89),z=void 0;z=U&&U.debuglog?U.debuglog("stream"):function(){};var G,H=i(90),j=i(45);V.inherits(l,B);var W=["error","close","destroy","pause","resume"];Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),l.prototype.destroy=j.destroy,l.prototype._undestroy=j.undestroy,l.prototype._destroy=function(e,t){this.push(null),t(e)},l.prototype.push=function(e,t){var i,r=this._readableState;return r.objectMode?i=!0:"string"==typeof e&&(t=t||r.defaultEncoding,t!==r.encoding&&(e=N.from(e,t),t=""),i=!0),h(this,e,t,!1,i)},l.prototype.unshift=function(e){return h(this,e,null,!0,!1)},l.prototype.isPaused=function(){return!1===this._readableState.flowing},l.prototype.setEncoding=function(e){return G||(G=i(32).StringDecoder),this._readableState.decoder=new G(e),this._readableState.encoding=e,this};var X=8388608;l.prototype.read=function(e){z("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return z("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?C(this):g(this),null;if(0===(e=p(e,t))&&t.ended)return 0===t.length&&C(this),null;var r=t.needReadable;z("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,z("length less than watermark",r)),t.ended||t.reading?(r=!1,z("reading or ended",r)):r&&(z("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=p(i,t)));var n;return n=e>0?w(e,t):null,null===n?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&C(this)),null!==n&&this.emit("data",n),n},l.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},l.prototype.pipe=function(e,t){function i(e,t){z("onunpipe"),e===f&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,o())}function n(){z("onend"),e.end()}function o(){z("cleanup"),e.removeListener("close",h),e.removeListener("finish",c),e.removeListener("drain",g),e.removeListener("error",l),e.removeListener("unpipe",i),f.removeListener("end",n),f.removeListener("end",u),f.removeListener("data",a),v=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function a(t){z("ondata"),y=!1,!1!==e.write(t)||y||((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&-1!==D(d.pipes,e))&&!v&&(z("false write response, pause",f._readableState.awaitDrain),f._readableState.awaitDrain++,y=!0),f.pause())}function l(t){z("onerror",t),u(),e.removeListener("error",l),0===L(e,"error")&&e.emit("error",t)}function h(){e.removeListener("finish",c),u()}function c(){z("onfinish"),e.removeListener("close",h),u()}function u(){z("unpipe"),f.unpipe(e)}var f=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,z("pipe count=%d opts=%j",d.pipesCount,t);var p=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr,m=p?n:u;d.endEmitted?I(m):f.once("end",m),e.on("unpipe",i);var g=b(f);e.on("drain",g);var v=!1,y=!1;return f.on("data",a),s(e,"error",l),e.once("close",h),e.once("finish",c),e.emit("pipe",f),d.flowing||(z("pipe resume"),f.resume()),e},l.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i),this);if(!e){var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<n;o++)r[o].emit("unpipe",this,i);return this}var s=D(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i),this)},l.prototype.on=function(e,t){var i=B.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&g(this):I(x,this))}return i},l.prototype.addListener=l.prototype.on,l.prototype.resume=function(){var e=this._readableState;return e.flowing||(z("resume"),e.flowing=!0,T(this,e)),this},l.prototype.pause=function(){return z("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(z("pause"),this._readableState.flowing=!1,this.emit("pause")),this},l.prototype.wrap=function(e){var t=this._readableState,i=!1,r=this;e.on("end",function(){if(z("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(n){if(z("wrapped data"),t.decoder&&(n=t.decoder.write(n)),(!t.objectMode||null!==n&&void 0!==n)&&(t.objectMode||n&&n.length)){r.push(n)||(i=!0,e.pause())}});for(var n in e)void 0===this[n]&&"function"==typeof e[n]&&(this[n]=function(t){return function(){return e[t].apply(e,arguments)}}(n));for(var o=0;o<W.length;o++)e.on(W[o],r.emit.bind(r,W[o]));return r._read=function(t){z("wrapped _read",t),i&&(i=!1,e.resume())},r},l._fromList=w}).call(t,i(1),i(8))},function(e,t,i){e.exports=i(30).EventEmitter},function(e,t,i){"use strict";function r(e,t){var i=this,r=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;if(r||n)return void(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||s(o,this,e));this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(s(o,i,e),i._writableState&&(i._writableState.errorEmitted=!0)):t&&t(e)})}function n(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function o(e,t){e.emit("error",t)}var s=i(21);e.exports={destroy:r,undestroy:n}},function(e,t,i){"use strict";function r(e){this.afterTransform=function(t,i){return n(e,t,i)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function n(e,t,i){var r=e._transformState;r.transforming=!1;var n=r.writecb;if(!n)return e.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!==i&&void 0!==i&&e.push(i),n(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);a.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,i){s(t,e,i)}):s(t)})}function s(e,t,i){if(t)return e.emit("error",t);null!==i&&void 0!==i&&e.push(i);var r=e._writableState,n=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(n.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=o;var a=i(10),l=i(14);l.inherits=i(0),l.inherits(o,a),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,a.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,i){var r=this._transformState;if(r.writecb=i,r.writechunk=e,r.writeencoding=t,!r.transforming){var n=this._readableState;(r.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var i=this;a.prototype._destroy.call(this,e,function(e){t(e),i.emit("close")})}},function(e,t,i){function r(){this.init(),this._w=p,u.call(this,64,56)}function n(e,t,i){return i^e&(t^i)}function o(e,t,i){return e&t|i&(e|t)}function s(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function a(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function l(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function h(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}var c=i(0),u=i(12),f=i(2).Buffer,d=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],p=new Array(64);c(r,u),r.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},r.prototype._update=function(e){for(var t=this._w,i=0|this._a,r=0|this._b,c=0|this._c,u=0|this._d,f=0|this._e,p=0|this._f,m=0|this._g,g=0|this._h,v=0;v<16;++v)t[v]=e.readInt32BE(4*v);for(;v<64;++v)t[v]=h(t[v-2])+t[v-7]+l(t[v-15])+t[v-16]|0;for(var y=0;y<64;++y){var _=g+a(f)+n(f,p,m)+d[y]+t[y]|0,b=s(i)+o(i,r,c)|0;g=m,m=p,p=f,f=u+_|0,u=c,c=r,r=i,i=_+b|0}this._a=i+this._a|0,this._b=r+this._b|0,this._c=c+this._c|0,this._d=u+this._d|0,this._e=f+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=g+this._h|0},r.prototype._hash=function(){var e=f.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=r},function(e,t,i){function r(){this.init(),this._w=v,p.call(this,128,112)}function n(e,t,i){return i^e&(t^i)}function o(e,t,i){return e&t|i&(e|t)}function s(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function a(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function l(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function h(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function c(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function u(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function f(e,t){return e>>>0<t>>>0?1:0}var d=i(0),p=i(12),m=i(2).Buffer,g=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],v=new Array(160);d(r,p),r.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},r.prototype._update=function(e){for(var t=this._w,i=0|this._ah,r=0|this._bh,d=0|this._ch,p=0|this._dh,m=0|this._eh,v=0|this._fh,y=0|this._gh,_=0|this._hh,b=0|this._al,x=0|this._bl,T=0|this._cl,E=0|this._dl,S=0|this._el,w=0|this._fl,M=0|this._gl,A=0|this._hl,P=0;P<32;P+=2)t[P]=e.readInt32BE(4*P),t[P+1]=e.readInt32BE(4*P+4);for(;P<160;P+=2){var C=t[P-30],R=t[P-30+1],D=l(C,R),I=h(R,C);C=t[P-4],R=t[P-4+1];var O=c(C,R),F=u(R,C),L=t[P-14],B=t[P-14+1],N=t[P-32],k=t[P-32+1],V=I+B|0,U=D+L+f(V,I)|0;V=V+F|0,U=U+O+f(V,F)|0,V=V+k|0,U=U+N+f(V,k)|0,t[P]=U,t[P+1]=V}for(var z=0;z<160;z+=2){U=t[z],V=t[z+1];var G=o(i,r,d),H=o(b,x,T),j=s(i,b),W=s(b,i),X=a(m,S),Y=a(S,m),K=g[z],q=g[z+1],Q=n(m,v,y),Z=n(S,w,M),J=A+Y|0,$=_+X+f(J,A)|0;J=J+Z|0,$=$+Q+f(J,Z)|0,J=J+q|0,$=$+K+f(J,q)|0,J=J+V|0,$=$+U+f(J,V)|0;var ee=W+H|0,te=j+G+f(ee,W)|0;_=y,A=M,y=v,M=w,v=m,w=S,S=E+J|0,m=p+$+f(S,E)|0,p=d,E=T,d=r,T=x,r=i,x=b,b=J+ee|0,i=$+te+f(b,J)|0}this._al=this._al+b|0,this._bl=this._bl+x|0,this._cl=this._cl+T|0,this._dl=this._dl+E|0,this._el=this._el+S|0,this._fl=this._fl+w|0,this._gl=this._gl+M|0,this._hl=this._hl+A|0,this._ah=this._ah+i+f(this._al,b)|0,this._bh=this._bh+r+f(this._bl,x)|0,this._ch=this._ch+d+f(this._cl,T)|0,this._dh=this._dh+p+f(this._dl,E)|0,this._eh=this._eh+m+f(this._el,S)|0,this._fh=this._fh+v+f(this._fl,w)|0,this._gh=this._gh+y+f(this._gl,M)|0,this._hh=this._hh+_+f(this._hl,A)|0},r.prototype._hash=function(){function e(e,i,r){t.writeInt32BE(e,r),t.writeInt32BE(i,r+4)}var t=m.allocUnsafe(64);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t},e.exports=r},function(e,t,i){"use strict";function r(e,t){s.call(this,"digest"),"string"==typeof t&&(t=a.from(t));var i="sha512"===e||"sha384"===e?128:64;if(this._alg=e,this._key=t,t.length>i){t=("rmd160"===e?new h:c(e)).update(t).digest()}else t.length<i&&(t=a.concat([t,u],i));for(var r=this._ipad=a.allocUnsafe(i),n=this._opad=a.allocUnsafe(i),o=0;o<i;o++)r[o]=54^t[o],n[o]=92^t[o];this._hash="rmd160"===e?new h:c(e),this._hash.update(r)}var n=i(0),o=i(101),s=i(9),a=i(2).Buffer,l=i(28),h=i(29),c=i(33),u=a.alloc(128);n(r,s),r.prototype._update=function(e){this._hash.update(e)},r.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new h:c(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return e=e.toLowerCase(),"rmd160"===e||"ripemd160"===e?new r("rmd160",t):"md5"===e?new o(l,t):new r(e,t)}},function(e,t){e.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},function(e,t,i){t.pbkdf2=i(103),t.pbkdf2Sync=i(54)},function(e,t){var i=Math.pow(2,30)-1;e.exports=function(e,t){if("number"!=typeof e)throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if("number"!=typeof t)throw new TypeError("Key length not a number");if(t<0||t>i||t!==t)throw new TypeError("Bad key length")}},function(e,t,i){(function(t){var i;if(t.browser)i="utf-8";else{i=parseInt(t.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}e.exports=i}).call(t,i(8))},function(e,t,i){function r(e,t,i){var r=n(e),o="sha512"===e||"sha384"===e?128:64;t.length>o?t=r(t):t.length<o&&(t=u.concat([t,f],o));for(var s=u.allocUnsafe(o+d[e]),a=u.allocUnsafe(o+d[e]),l=0;l<o;l++)s[l]=54^t[l],a[l]=92^t[l];var h=u.allocUnsafe(o+i+4);s.copy(h,0,0,o),this.ipad1=h,this.ipad2=s,this.opad=a,this.alg=e,this.blocksize=o,this.hash=r,this.size=d[e]}function n(e){function t(t){return l(e).update(t).digest()}return"rmd160"===e||"ripemd160"===e?a:"md5"===e?s:t}function o(e,t,i,n,o){u.isBuffer(e)||(e=u.from(e,c)),u.isBuffer(t)||(t=u.from(t,c)),h(i,n),o=o||"sha1";var s=new r(o,e,t.length),a=u.allocUnsafe(n),l=u.allocUnsafe(t.length+4);t.copy(l,0,0,t.length);for(var f=0,p=d[o],m=Math.ceil(n/p),g=1;g<=m;g++){l.writeUInt32BE(g,t.length);for(var v=s.run(l,s.ipad1),y=v,_=1;_<i;_++){y=s.run(y,s.ipad2);for(var b=0;b<p;b++)v[b]^=y[b]}v.copy(a,f),f+=p}return a}var s=i(28),a=i(29),l=i(33),h=i(52),c=i(53),u=i(2).Buffer,f=u.alloc(128),d={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};r.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=o},function(e,t,i){function r(e){var t=e._cipher.encryptBlockRaw(e._prev);return s(e._prev),t}var n=i(15),o=i(2).Buffer,s=i(56);t.encrypt=function(e,t){var i=Math.ceil(t.length/16),s=e._cache.length;e._cache=o.concat([e._cache,o.allocUnsafe(16*i)]);for(var a=0;a<i;a++){var l=r(e),h=s+16*a;e._cache.writeUInt32BE(l[0],h+0),e._cache.writeUInt32BE(l[1],h+4),e._cache.writeUInt32BE(l[2],h+8),e._cache.writeUInt32BE(l[3],h+12)}var c=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),n(t,c)}},function(e,t){function i(e){for(var t,i=e.length;i--;){if(255!==(t=e.readUInt8(i))){t++,e.writeUInt8(t,i);break}e.writeUInt8(0,i)}}e.exports=i},function(e,t){e.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},function(e,t,i){function r(e,t){var i=0;e.length!==t.length&&i++;for(var r=Math.min(e.length,t.length),n=0;n<r;++n)i+=e[n]^t[n];return i}function n(e,t,i){if(12===t.length)return e._finID=a.concat([t,a.from([0,0,0,1])]),a.concat([t,a.from([0,0,0,2])]);var r=new c(i),n=t.length,o=n%16;r.update(t),o&&(o=16-o,r.update(a.alloc(o,0))),r.update(a.alloc(8,0));var s=8*n,l=a.alloc(8);l.writeUIntBE(s,0,8),r.update(l),e._finID=r.state;var h=a.from(e._finID);return f(h),h}function o(e,t,i,r){l.call(this);var o=a.alloc(4,0);this._cipher=new s.AES(t);var h=this._cipher.encryptBlock(o);this._ghash=new c(h),i=n(this,i,h),this._prev=a.from(i),this._cache=a.allocUnsafe(0),this._secCache=a.allocUnsafe(0),this._decrypt=r,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}var s=i(23),a=i(2).Buffer,l=i(9),h=i(0),c=i(114),u=i(15),f=i(56);h(o,l),o.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=a.alloc(t,0),this._ghash.update(t))}this._called=!0;var i=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(i),this._len+=e.length,i},o.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=u(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&r(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},o.prototype.getAuthTag=function(){if(this._decrypt||!a.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},o.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},o.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=o},function(e,t,i){function r(e,t,i,r){s.call(this),this._cipher=new n.AES(t),this._prev=o.from(i),this._cache=o.allocUnsafe(0),this._secCache=o.allocUnsafe(0),this._decrypt=r,this._mode=e}var n=i(23),o=i(2).Buffer,s=i(9);i(0)(r,s),r.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},r.prototype._final=function(){this._cipher.scrub()},e.exports=r},function(e,t,i){function r(){if(null!==_)return _;var e=[];e[0]=2;for(var t=1,i=3;i<1048576;i+=2){for(var r=Math.ceil(Math.sqrt(i)),n=0;n<t&&e[n]<=r&&i%e[n]!=0;n++);t!==n&&e[n]<=r||(e[t++]=i)}return _=e,e}function n(e){for(var t=r(),i=0;i<t.length;i++)if(0===e.modn(t[i]))return 0===e.cmpn(t[i]);return!0}function o(e){var t=l.mont(e);return 0===d.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function s(e,t){if(e<16)return new l(2===t||5===t?[140,123]:[140,39]);t=new l(t);for(var i,r;;){for(i=new l(a(Math.ceil(e/8)));i.bitLength()>e;)i.ishrn(1);if(i.isEven()&&i.iadd(f),i.testn(1)||i.iadd(d),t.cmp(d)){if(!t.cmp(p))for(;i.mod(m).cmp(g);)i.iadd(y)}else for(;i.mod(h).cmp(v);)i.iadd(y);if(r=i.shrn(1),n(r)&&n(i)&&o(r)&&o(i)&&u.test(r)&&u.test(i))return i}}var a=i(11);e.exports=s,s.simpleSieve=n,s.fermatTest=o;var l=i(4),h=new l(24),c=i(62),u=new c,f=new l(1),d=new l(2),p=new l(5),m=(new l(16),new l(8),new l(10)),g=new l(3),v=(new l(7),new l(11)),y=new l(4),_=(new l(12),null)},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){function r(e){this.rand=e||new o.Rand}var n=i(4),o=i(63);e.exports=r,r.create=function(e){return new r(e)},r.prototype._randbelow=function(e){var t=e.bitLength(),i=Math.ceil(t/8);do{var r=new n(this.rand.generate(i))}while(r.cmp(e)>=0);return r},r.prototype._randrange=function(e,t){var i=t.sub(e);return e.add(this._randbelow(i))},r.prototype.test=function(e,t,i){var r=e.bitLength(),o=n.mont(e),s=new n(1).toRed(o);t||(t=Math.max(1,r/48|0));for(var a=e.subn(1),l=0;!a.testn(l);l++);for(var h=e.shrn(l),c=a.toRed(o);t>0;t--){var u=this._randrange(new n(2),a);i&&i(u);var f=u.toRed(o).redPow(h);if(0!==f.cmp(s)&&0!==f.cmp(c)){for(var d=1;d<l;d++){if(f=f.redSqr(),0===f.cmp(s))return!1;if(0===f.cmp(c))break}if(d===l)return!1}}return!0},r.prototype.getDivisor=function(e,t){var i=e.bitLength(),r=n.mont(e),o=new n(1).toRed(r);t||(t=Math.max(1,i/48|0));for(var s=e.subn(1),a=0;!s.testn(a);a++);for(var l=e.shrn(a),h=s.toRed(r);t>0;t--){var c=this._randrange(new n(2),s),u=e.gcd(c);if(0!==u.cmpn(1))return u;var f=c.toRed(r).redPow(l);if(0!==f.cmp(o)&&0!==f.cmp(h)){for(var d=1;d<a;d++){if(f=f.redSqr(),0===f.cmp(o))return f.fromRed().subn(1).gcd(e);if(0===f.cmp(h))break}if(d===a)return f=f.redSqr(),f.fromRed().subn(1).gcd(e)}}return!1}},function(e,t,i){function r(e){this.rand=e}var n;if(e.exports=function(e){return n||(n=new r(null)),n.generate(e)},e.exports.Rand=r,r.prototype.generate=function(e){return this._rand(e)},r.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),i=0;i<t.length;i++)t[i]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(r.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var o=i(125);if("function"!=typeof o.randomBytes)throw new Error("Not supported");r.prototype._rand=function(e){return o.randomBytes(e)}}catch(e){}},function(e,t,i){"use strict";function r(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"!=typeof e){for(var r=0;r<e.length;r++)i[r]=0|e[r];return i}if("hex"===t){e=e.replace(/[^a-z0-9]+/gi,""),e.length%2!=0&&(e="0"+e);for(var r=0;r<e.length;r+=2)i.push(parseInt(e[r]+e[r+1],16))}else for(var r=0;r<e.length;r++){var n=e.charCodeAt(r),o=n>>8,s=255&n;o?i.push(o,s):i.push(s)}return i}function n(e){return 1===e.length?"0"+e:e}function o(e){for(var t="",i=0;i<e.length;i++)t+=n(e[i].toString(16));return t}var s=t;s.toArray=r,s.zero2=n,s.toHex=o,s.encode=function(e,t){return"hex"===t?o(e):e}},function(e,t,i){"use strict";function r(e,t,i,r){return 0===e?n(t,i,r):1===e||3===e?s(t,i,r):2===e?o(t,i,r):void 0}function n(e,t,i){return e&t^~e&i}function o(e,t,i){return e&t^e&i^t&i}function s(e,t,i){return e^t^i}function a(e){return f(e,2)^f(e,13)^f(e,22)}function l(e){return f(e,6)^f(e,11)^f(e,25)}function h(e){return f(e,7)^f(e,18)^e>>>3}function c(e){return f(e,17)^f(e,19)^e>>>10}var u=i(7),f=u.rotr32;t.ft_1=r,t.ch32=n,t.maj32=o,t.p32=s,t.s0_256=a,t.s1_256=l,t.g0_256=h,t.g1_256=c},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;v.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=y,this.W=new Array(64)}var n=i(7),o=i(16),s=i(65),a=i(6),l=n.sum32,h=n.sum32_4,c=n.sum32_5,u=s.ch32,f=s.maj32,d=s.s0_256,p=s.s1_256,m=s.g0_256,g=s.g1_256,v=o.BlockHash,y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];n.inherits(r,v),e.exports=r,r.blockSize=512,r.outSize=256,r.hmacStrength=192,r.padLength=64,r.prototype._update=function(e,t){for(var i=this.W,r=0;r<16;r++)i[r]=e[t+r];for(;r<i.length;r++)i[r]=h(g(i[r-2]),i[r-7],m(i[r-15]),i[r-16]);var n=this.h[0],o=this.h[1],s=this.h[2],v=this.h[3],y=this.h[4],_=this.h[5],b=this.h[6],x=this.h[7];for(a(this.k.length===i.length),r=0;r<i.length;r++){var T=c(x,p(y),u(y,_,b),this.k[r],i[r]),E=l(d(n),f(n,o,s));x=b,b=_,_=y,y=l(v,T),v=s,s=o,o=n,n=l(T,E)}this.h[0]=l(this.h[0],n),this.h[1]=l(this.h[1],o),this.h[2]=l(this.h[2],s),this.h[3]=l(this.h[3],v),this.h[4]=l(this.h[4],y),this.h[5]=l(this.h[5],_),this.h[6]=l(this.h[6],b),this.h[7]=l(this.h[7],x)},r.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;R.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=D,this.W=new Array(160)}function n(e,t,i,r,n){var o=e&i^~e&n;return o<0&&(o+=4294967296),o}function o(e,t,i,r,n,o){var s=t&r^~t&o;return s<0&&(s+=4294967296),s}function s(e,t,i,r,n){var o=e&i^e&n^i&n;return o<0&&(o+=4294967296),o}function a(e,t,i,r,n,o){var s=t&r^t&o^r&o;return s<0&&(s+=4294967296),s}function l(e,t){var i=_(e,t,28),r=_(t,e,2),n=_(t,e,7),o=i^r^n;return o<0&&(o+=4294967296),o}function h(e,t){var i=b(e,t,28),r=b(t,e,2),n=b(t,e,7),o=i^r^n;return o<0&&(o+=4294967296),o}function c(e,t){var i=_(e,t,14),r=_(e,t,18),n=_(t,e,9),o=i^r^n;return o<0&&(o+=4294967296),o}function u(e,t){var i=b(e,t,14),r=b(e,t,18),n=b(t,e,9),o=i^r^n;return o<0&&(o+=4294967296),o}function f(e,t){var i=_(e,t,1),r=_(e,t,8),n=x(e,t,7),o=i^r^n;return o<0&&(o+=4294967296),o}function d(e,t){var i=b(e,t,1),r=b(e,t,8),n=T(e,t,7),o=i^r^n;return o<0&&(o+=4294967296),o}function p(e,t){var i=_(e,t,19),r=_(t,e,29),n=x(e,t,6),o=i^r^n;return o<0&&(o+=4294967296),o}function m(e,t){var i=b(e,t,19),r=b(t,e,29),n=T(e,t,6),o=i^r^n;return o<0&&(o+=4294967296),o}var g=i(7),v=i(16),y=i(6),_=g.rotr64_hi,b=g.rotr64_lo,x=g.shr64_hi,T=g.shr64_lo,E=g.sum64,S=g.sum64_hi,w=g.sum64_lo,M=g.sum64_4_hi,A=g.sum64_4_lo,P=g.sum64_5_hi,C=g.sum64_5_lo,R=v.BlockHash,D=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];g.inherits(r,R),e.exports=r,r.blockSize=1024,r.outSize=512,r.hmacStrength=192,r.padLength=128,r.prototype._prepareBlock=function(e,t){for(var i=this.W,r=0;r<32;r++)i[r]=e[t+r];for(;r<i.length;r+=2){var n=p(i[r-4],i[r-3]),o=m(i[r-4],i[r-3]),s=i[r-14],a=i[r-13],l=f(i[r-30],i[r-29]),h=d(i[r-30],i[r-29]),c=i[r-32],u=i[r-31];i[r]=M(n,o,s,a,l,h,c,u),i[r+1]=A(n,o,s,a,l,h,c,u)}},r.prototype._update=function(e,t){this._prepareBlock(e,t);var i=this.W,r=this.h[0],f=this.h[1],d=this.h[2],p=this.h[3],m=this.h[4],g=this.h[5],v=this.h[6],_=this.h[7],b=this.h[8],x=this.h[9],T=this.h[10],M=this.h[11],A=this.h[12],R=this.h[13],D=this.h[14],I=this.h[15];y(this.k.length===i.length);for(var O=0;O<i.length;O+=2){var F=D,L=I,B=c(b,x),N=u(b,x),k=n(b,x,T,M,A),V=o(b,x,T,M,A,R),U=this.k[O],z=this.k[O+1],G=i[O],H=i[O+1],j=P(F,L,B,N,k,V,U,z,G,H),W=C(F,L,B,N,k,V,U,z,G,H);F=l(r,f),L=h(r,f),B=s(r,f,d,p,m),N=a(r,f,d,p,m,g);var X=S(F,L,B,N),Y=w(F,L,B,N);D=A,I=R,A=T,R=M,T=b,M=x,b=S(v,_,j,W),x=w(_,_,j,W),v=m,_=g,m=d,g=p,d=r,p=f,r=S(j,W,X,Y),f=w(j,W,X,Y)}E(this.h,0,r,f),E(this.h,2,d,p),E(this.h,4,m,g),E(this.h,6,v,_),E(this.h,8,b,x),E(this.h,10,T,M),E(this.h,12,A,R),E(this.h,14,D,I)},r.prototype._digest=function(e){return"hex"===e?g.toHex32(this.h,"big"):g.split32(this.h,"big")}},function(e,t,i){function r(e,t){if(s.call(this,t),!a.isBuffer(e))return void this.error("Input not Buffer");this.base=e,this.offset=0,this.length=e.length}function n(e,t){if(Array.isArray(e))this.length=0,this.value=e.map(function(e){return e instanceof n||(e=new n(e,t)),this.length+=e.length,e},this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=a.byteLength(e);else{if(!a.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}var o=i(0),s=i(18).Reporter,a=i(3).Buffer;o(r,s),t.DecoderBuffer=r,r.prototype.save=function(){return{offset:this.offset,reporter:s.prototype.save.call(this)}},r.prototype.restore=function(e){var t=new r(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,s.prototype.restore.call(this,e.reporter),t},r.prototype.isEmpty=function(){return this.offset===this.length},r.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},r.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var i=new r(this.base);return i._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+e,this.offset+=e,i},r.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},t.EncoderBuffer=n,n.prototype.join=function(e,t){return e||(e=new a(this.length)),t||(t=0),0===this.length?e:(Array.isArray(this.value)?this.value.forEach(function(i){i.join(e,t),t+=i.length}):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):a.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length),e)}},function(e,t,i){var r=t;r._reverse=function(e){var t={};return Object.keys(e).forEach(function(i){(0|i)==i&&(i|=0);var r=e[i];t[r]=i}),t},r.der=i(157)},function(e,t,i){function r(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new n,this.tree._init(e.body)}function n(e){h.Node.call(this,"der",e)}function o(e,t){var i=e.readUInt8(t);if(e.isError(i))return i;var r=u.tagClass[i>>6],n=0==(32&i);if(31==(31&i)){var o=i;for(i=0;128==(128&o);){if(o=e.readUInt8(t),e.isError(o))return o;i<<=7,i|=127&o}}else i&=31;return{cls:r,primitive:n,tag:i,tagStr:u.tag[i]}}function s(e,t,i){var r=e.readUInt8(i);if(e.isError(r))return r;if(!t&&128===r)return null;if(0==(128&r))return r;var n=127&r;if(n>4)return e.error("length octect is too long");r=0;for(var o=0;o<n;o++){r<<=8;var s=e.readUInt8(i);if(e.isError(s))return s;r|=s}return r}var a=i(0),l=i(17),h=l.base,c=l.bignum,u=l.constants.der;e.exports=r,r.prototype.decode=function(e,t){return e instanceof h.DecoderBuffer||(e=new h.DecoderBuffer(e,t)),this.tree._decode(e,t)},a(n,h.Node),n.prototype._peekTag=function(e,t,i){if(e.isEmpty())return!1;var r=e.save(),n=o(e,'Failed to peek tag: "'+t+'"');return e.isError(n)?n:(e.restore(r),n.tag===t||n.tagStr===t||n.tagStr+"of"===t||i)},n.prototype._decodeTag=function(e,t,i){var r=o(e,'Failed to decode tag of "'+t+'"');if(e.isError(r))return r;var n=s(e,r.primitive,'Failed to get length of "'+t+'"');if(e.isError(n))return n;if(!i&&r.tag!==t&&r.tagStr!==t&&r.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(r.primitive||null!==n)return e.skip(n,'Failed to match body of: "'+t+'"');var a=e.save(),l=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(l)?l:(n=e.offset-a.offset,e.restore(a),e.skip(n,'Failed to match body of: "'+t+'"'))},n.prototype._skipUntilEnd=function(e,t){for(;;){var i=o(e,t);if(e.isError(i))return i;var r=s(e,i.primitive,t);if(e.isError(r))return r;var n;if(n=i.primitive||null!==r?e.skip(r):this._skipUntilEnd(e,t),e.isError(n))return n;if("end"===i.tagStr)break}},n.prototype._decodeList=function(e,t,i,r){for(var n=[];!e.isEmpty();){var o=this._peekTag(e,"end");if(e.isError(o))return o;var s=i.decode(e,"der",r);if(e.isError(s)&&o)break;n.push(s)}return n},n.prototype._decodeStr=function(e,t){if("bitstr"===t){var i=e.readUInt8();return e.isError(i)?i:{unused:i,data:e.raw()}}if("bmpstr"===t){var r=e.raw();if(r.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var n="",o=0;o<r.length/2;o++)n+=String.fromCharCode(r.readUInt16BE(2*o));return n}if("numstr"===t){var s=e.raw().toString("ascii");return this._isNumstr(s)?s:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){var a=e.raw().toString("ascii");return this._isPrintstr(a)?a:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},n.prototype._decodeObjid=function(e,t,i){for(var r,n=[],o=0;!e.isEmpty();){var s=e.readUInt8();o<<=7,o|=127&s,0==(128&s)&&(n.push(o),o=0)}128&s&&n.push(o);var a=n[0]/40|0,l=n[0]%40;if(r=i?n:[a,l].concat(n.slice(1)),t){var h=t[r.join(" ")];void 0===h&&(h=t[r.join(".")]),void 0!==h&&(r=h)}return r},n.prototype._decodeTime=function(e,t){var i=e.raw().toString();if("gentime"===t)var r=0|i.slice(0,4),n=0|i.slice(4,6),o=0|i.slice(6,8),s=0|i.slice(8,10),a=0|i.slice(10,12),l=0|i.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");var r=0|i.slice(0,2),n=0|i.slice(2,4),o=0|i.slice(4,6),s=0|i.slice(6,8),a=0|i.slice(8,10),l=0|i.slice(10,12);r=r<70?2e3+r:1900+r}return Date.UTC(r,n-1,o,s,a,l,0)},n.prototype._decodeNull=function(e){return null},n.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},n.prototype._decodeInt=function(e,t){var i=e.raw(),r=new c(i);return t&&(r=t[r.toString(10)]||r),r},n.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},function(e,t,i){function r(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new n,this.tree._init(e.body)}function n(e){c.Node.call(this,"der",e)}function o(e){return e<10?"0"+e:e}function s(e,t,i,r){var n;if("seqof"===e?e="seq":"setof"===e&&(e="set"),u.tagByName.hasOwnProperty(e))n=u.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return r.error("Unknown tag: "+e);n=e}return n>=31?r.error("Multi-octet tag encoding unsupported"):(t||(n|=32),n|=u.tagClassByName[i||"universal"]<<6)}var a=i(0),l=i(3).Buffer,h=i(17),c=h.base,u=h.constants.der;e.exports=r,r.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},a(n,c.Node),n.prototype._encodeComposite=function(e,t,i,r){var n=s(e,t,i,this.reporter);if(r.length<128){var o=new l(2);return o[0]=n,o[1]=r.length,this._createEncoderBuffer([o,r])}for(var a=1,h=r.length;h>=256;h>>=8)a++;var o=new l(2+a);o[0]=n,o[1]=128|a;for(var h=1+a,c=r.length;c>0;h--,c>>=8)o[h]=255&c;return this._createEncoderBuffer([o,r])},n.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){for(var i=new l(2*e.length),r=0;r<e.length;r++)i.writeUInt16BE(e.charCodeAt(r),2*r);return this._createEncoderBuffer(i)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)?this._createEncoderBuffer(e):"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},n.prototype._encodeObjid=function(e,t,i){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s\.]+/g);for(var r=0;r<e.length;r++)e[r]|=0}else if(Array.isArray(e)){e=e.slice();for(var r=0;r<e.length;r++)e[r]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!i){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}for(var n=0,r=0;r<e.length;r++){var o=e[r];for(n++;o>=128;o>>=7)n++}for(var s=new l(n),a=s.length-1,r=e.length-1;r>=0;r--){var o=e[r];for(s[a--]=127&o;(o>>=7)>0;)s[a--]=128|127&o}return this._createEncoderBuffer(s)},n.prototype._encodeTime=function(e,t){var i,r=new Date(e);return"gentime"===t?i=[o(r.getFullYear()),o(r.getUTCMonth()+1),o(r.getUTCDate()),o(r.getUTCHours()),o(r.getUTCMinutes()),o(r.getUTCSeconds()),"Z"].join(""):"utctime"===t?i=[o(r.getFullYear()%100),o(r.getUTCMonth()+1),o(r.getUTCDate()),o(r.getUTCHours()),o(r.getUTCMinutes()),o(r.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(i,"octstr")},n.prototype._encodeNull=function(){return this._createEncoderBuffer("")},n.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!l.isBuffer(e)){var i=e.toArray();!e.sign&&128&i[0]&&i.unshift(0),e=new l(i)}if(l.isBuffer(e)){var r=e.length;0===e.length&&r++;var n=new l(r);return e.copy(n),0===e.length&&(n[0]=0),this._createEncoderBuffer(n)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);for(var r=1,o=e;o>=256;o>>=8)r++;for(var n=new Array(r),o=n.length-1;o>=0;o--)n[o]=255&e,e>>=8;return 128&n[0]&&n.unshift(0),this._createEncoderBuffer(new l(n))},n.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},n.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},n.prototype._skipDefault=function(e,t,i){var r,n=this._baseState;if(null===n.default)return!1;var o=e.join();if(void 0===n.defaultBuffer&&(n.defaultBuffer=this._encodeValue(n.default,t,i).join()),o.length!==n.defaultBuffer.length)return!1;for(r=0;r<o.length;r++)if(o[r]!==n.defaultBuffer[r])return!1;return!0}},function(e,t){e.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},function(e,t,i){(function(t){function r(e){var i=new t(4);return i.writeUInt32BE(e,0),i}var n=i(13);e.exports=function(e,i){for(var o,s=new t(""),a=0;s.length<i;)o=r(a++),s=t.concat([s,n("sha1").update(e).update(o).digest()]);return s.slice(0,i)}}).call(t,i(3).Buffer)},function(e,t){e.exports=function(e,t){for(var i=e.length,r=-1;++r<i;)e[r]^=t[r];return e}},function(e,t,i){(function(t){function r(e,i){return new t(e.toRed(n.mont(i.modulus)).redPow(new n(i.publicExponent)).fromRed().toArray())}var n=i(4);e.exports=r}).call(t,i(3).Buffer)},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;r(this,e),t instanceof Object?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}return n(e,[{key:"addXY",value:function(t,i){var r=new e(this.x,this.y);return r.x+=t,r.y+=i,r}},{key:"add",value:function(t){var i=new e(this.x,this.y);return i.x+=isNaN(t.x)?t.get_x():t.x,i.y+=isNaN(t.y)?t.get_y():t.y,i}},{key:"sub",value:function(t){var i=new e(this.x,this.y);return isNaN(t.x)&&!t.get_x||(i.x-=isNaN(t.x)?t.get_x():t.x,i.y-=isNaN(t.y)?t.get_y():t.y),i}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-e.x*this.y}},{key:"projectTo",value:function(t){var i=t.x,r=t.y,n=t.dot(t),o=i*i/n,s=i*r/n,a=r*r/n,l=new PIXI.Matrix;return l.a=o,l.b=s,l.c=s,l.d=a,new e(l.apply(this))}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}},{key:"toArray",value:function(){return[this.x,this.y]}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"setLength",value:function(e){this.multiplyScalar(e/this.length())}},{key:"lerp",value:function(e,t){var i=this.clone();return i.x+=(e.x-i.x)*t,i.y+=(e.y-i.y)*t,i}},{key:"rotate",value:function(e){var t=Math.cos(e),i=Math.sin(e);this.x=x*t-y*i,this.y=x*i+y*t}}]),e}();e.exports=o},function(t,i,r){"use strict";var n=r(83),o={gesture:{TAP:"gesture.tap",TAP_MISS:"gesture.tapMiss",ZOOM:"gesture.zoom",ROTA:"gesture.rota",PAN:"gesture.pan",HOLD:"hold",CLONE:"gesture.clone"},zoomGesture:function(e,t,i){function r(){!1!==a&&(t.x+=(l.x-t.x)*c,t.y+=(l.y-t.y)*c,t.scale.x+=(h.x-t.scale.y)*c,t.scale.y+=(h.y-t.scale.y)*c,t.emit("change.zoom",{zoom:t.scale.x}))}var o=new Map,s=PIXI.ticker.shared;i=i||{},t||(t=e);var a=!0,l={x:t.x,y:t.y},h={x:t.scale.x,y:t.scale.y},c=.15;Object.defineProperty(t,"activeZoomGesture",{set:function(e){this.__activeZoomGesture=e,!0===e?(s.remove(r),s.add(r)):s.remove(r)},get:function(){return this.__activeZoomGesture}}),e.addEventListener(TouchEvent.TOUCH_BEGIN,function(e){o.size>=2||!1!==a&&(o.set(e.data.identifier,{x:e.data.global.x,y:e.data.global.y}),2===o.size&&(h.x=t.scale.x,h.y=t.scale.y,l.x=t.x,l.y=t.y,t.activeZoomGesture=!0))},!1,1),e.addEventListener(TouchEvent.TOUCH_MOVE,function(e){if(!1!==a&&o.has(e.data.identifier)&&2===o.size){var t,r=e.data.identifier,s=o.get(r);o.forEach(function(e,i){r!=i&&(t=e)});var c=(s.x-e.data.global.x)/2,u=(s.y-e.data.global.y)/2;l.x-=c,l.y-=u;var f=n.distance(e.data.global,t)/n.distance(s,t),d=h.x*f;void 0!==i.maxZoom&&d>i.maxZoom&&(d=i.maxZoom,f=d/h.x),void 0!==i.minZoom&&d<i.minZoom&&(d=i.minZoom,f=d/h.x);var p=l.x,m=l.y,g=t.x-l.x,v=t.y-l.y;g*=f-1,v*=f-1,p-=g,m-=v,l.x=p,l.y=m,h.x=d,h.y=d,s.x=e.data.global.x,s.y=e.data.global.y}}),e.addEventListener(TouchEvent.TOUCH_END,function(e){o.delete(e.data.identifier)}),e.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,function(e){o.delete(e.data.identifier)});var u={};return u.getTouchCount=function(){return o.size},u.setGestureEnabled=function(e){a=e},u},panGesture:function(e,t){e.addEventListener(TouchEvent.TOUCH_BEGIN,function(i){e.__panGlobalPos__={x:i.data.global.x,y:i.data.global.y};var r=function(i){var r=i.data.global.x-e.__panGlobalPos__.x,n=i.data.global.y-e.__panGlobalPos__.y,s={target:e,data:i.data,offsetX:r,offsetY:n,type:"move",stopPropagation:function(){i.stopPropagation()}};t&&t.apply(e,[s]),e.emit(o.gesture.PAN,s),e.__panGlobalPos__={x:i.data.global.x,y:i.data.global.y}},n=function i(n){e.removeListener(TouchEvent.TOUCH_MOVE,r),e.removeListener(TouchEvent.TOUCH_END_OUDSIDE,i),e.removeListener(TouchEvent.TOUCH_END,i);var s={target:e,data:n.data,offsetX:0,offsetY:0,type:"end",stopPropagation:function(){n.stopPropagation()}};t&&t.apply(e,[s]),e.emit(o.gesture.PAN,s)};e.addEventListener(TouchEvent.TOUCH_MOVE,r),e.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,n),e.addEventListener(TouchEvent.TOUCH_END,n);var s={target:e,data:i.data,offsetX:0,offsetY:0,type:"begin",stopPropagation:function(){i.stopPropagation()}};t&&t.apply(e,[s]),e.emit(o.gesture.PAN,s)})},addGesture:function(e,t,i){switch(t){case this.gesture.TAP:this.tapGesture(e,i);break;case this.gesture.PAN:this.panGesture(e,i);break;case this.gesture.HOLD:this.holdGesture(e,i)}},holdGesture:function(e){function t(t){var i={target:e,data:t.data,type:"begin",stopPropagation:function(){t.stopPropagation()},startPos:{x:t.data.global.x,y:t.data.global.y}};"touchstart"===t.type?l.set(i.data.identifier,i):l.set("mouse",i),e.emit(o.gesture.HOLD,i),a=setInterval(function(){if(0===l.size)return void clearInterval(a);i.type="hold",l.forEach(function(t,i){e.emit(o.gesture.HOLD,t)})},s)}function i(t){var i,r,s={target:e,data:t.data,type:"move",stopPropagation:function(){t.stopPropagation()}};if(r="touchmove"===t.type?t.data.identifier:"mouse",i=l.get(r)){n.distance(t.data.global,i.startPos)>40&&(e.emit(o.gesture.HOLD,s),l.delete(r),0===l.size&&clearInterval(a))}}function r(t){var i,r={target:e,data:t.data,type:"end",stopPropagation:function(){t.stopPropagation()}};i="touchend"===t.type?t.data.identifier:"mouse",l.get(i)&&(e.emit(o.gesture.HOLD,r),l.delete(i)),0===l.size&&clearInterval(a)}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;e.touches=new Map;var a,l=e.touches;e.addEventListener(TouchEvent.TOUCH_BEGIN,t),e.addEventListener(TouchEvent.TOUCH_MOVE,i),e.addEventListener(TouchEvent.TOUCH_END,r)},tapGesture:function(t,i){function r(e){this.timer=(new Date).getTime(),this.__globalPoint__=Object.assign({},e.data.global)}function s(r){var s=!1;if((new Date).getTime()-this.timer<200&&n.distance(this.__globalPoint__,r.data.global)<40){var a={target:t,data:r.data,stopPropagation:function(){e.stopPropagation()}};null==i?t.emit(o.gesture.TAP,a):i.apply(t,[a]),s=!0}!1===s&&t&&t.emit&&t.emit(o.gesture.TAP_MISS)}t.addEventListener(TouchEvent.TOUCH_BEGIN,r),t.addEventListener(TouchEvent.TOUCH_END,s),void 0===t.__gestureMap__&&(t.__gestureMap__={}),void 0===t.__gestureMap__[this.gesture.TAP]&&(t.__gestureMap__[this.gesture.TAP]=[]),t.__gestureMap__[this.gesture.TAP].push({begin:r,end:s})},removeGesture:function(e,t){if(e.__gestureMap__&&e.__gestureMap__[t])for(var i=e.__gestureMap__[t],r=0;r<i.length;r++)e.removeEventListener(TouchEvent.TOUCH_BEGIN,i[r].begin),e.removeEventListener(TouchEvent.TOUCH_END,i[r].end)},cloneEqGesture:function(e,t){function i(t){var i=t.data.identifier;void 0!==i&&2!==a.size&&(a.has(i)||(a.set(i,{x:t.data.global.x,y:t.data.global.y}),1===a.size&&(e.addEventListener(TouchEvent.TOUCH_MOVE,r),e.addEventListener(TouchEvent.TOUCH_END,s),e.addEventListener(TouchEvent.TOUCH_END_OUTSIDE,s))))}function r(t){if(2===a.size){var i=t.data.identifier;if(i===l){var r=n.distance(a.get(i),t.data.global);r>h&&(a.clear(),s())}else{var r=n.distance(a.get(i),t.data.global);r>c&&(e.emit(o.gesture.CLONE,{global:{x:t.data.global.x,y:t.data.global.y}}),a.clear(),s())}}}function s(t){if(t){var i=t.data.identifier;a.delete(i)}0===a.size&&(l=NaN,e.removeListener(TouchEvent.TOUCH_MOVE,r),e.removeListener(TouchEvent.TOUCH_END,s),e.removeListener(TouchEvent.TOUCH_END_OUTSIDE,s))}t=t||{};var a=new Map;e.addEventListener(TouchEvent.TOUCH_BEGIN,i);var l=NaN,h=30,c=t.triggerDistance||100}};window.NBGesture=o,t.exports=o},function(e,t,i){"use strict";(function(t){function r(){var e=this.threeSystem.camera,t=this,a=[],l=null,h=[],c=null,u=null,f=[];t.on("update",function(t){for(var i=f.length,n=0;n<i;n++){var o=f[n],s=o.mesh,a=o.dis;void 0==a.parent&&console.log("请将"+a+"加入到舞台");var l=r.obj3DVecToDisPoint(s,new THREE.Vector3,e,a.parent);a.x=l.x,a.y=l.y}}),this.createObserveText=function(e,r,n){var o=i(182),s=new o;return s.system=this.threeSystem,s.setTip(r),s.setOffSet(n||null),t.addChild(s),s.bindToObject3D(e),h.push(s),s},this.addCloseFunc=function(e){null==l&&(l=new n,l.addEventListener(TouchEvent.TAP,function(e){var t=a.pop();t&&(t(),0==a.length&&TweenMax.to(l,1,{alpha:0,onComplete:function(){l.parent&&l.parent.removeChild(l)}}))})),a.push(e)},this.execCloseFunc=function(){l&&l.emit(TouchEvent.TAP)},this.addObserveButton=function(){return null==c&&(c=PIXI.Sprite.fromFrame("observe_detail"),this.addChild(c),o.add(c,{right:c.width+30,top:30}),c.hide=function(){var e=this;TweenMax.to(this,1,{alpha:0,onComplete:function(){e.visible=!1}})},c.show=function(){this.visible=!0,TweenMax.to(this,1,{alpha:1})}),c},this.addCameraButton=function(){return null==u&&(u=PIXI.Sprite.fromFrame("observe_camera"),this.addChild(c),o.add(u,{right:c.width+80,top:30})),u},this.bindDisplayToMesh=function(e){for(var i=e.dis||new s,r=e.mesh,n=(e.offsetX,e.offsetY,f.length),o=0;o<n;o++){if(f[o].dis===i||i.mesh===r)return}return i instanceof s&&(t.addChild(i),e.dis=i),f.push(e),i},this.unBindDisplayFromMesh=function(e){for(var t=0;t<f.length;t++){var i=f[t];if(i.dis===e||i.mesh===e){f.splice(t,1),i.dis instanceof s&&i.dis.parent.removeChild(i.dis);break}}},this.getMeshUnderPoint=function(e){return instance.interactiveManager.getInteractiveObject(r.pointToTHREEPoint(e),null,!0)},this.getHitObject3D=function(e){var t=e.toGlobal({x:e.width/2,y:e.height/2});return this.getMeshUnderPoint(t)}}var n=i(220),o=i(176),s=i(181);r.pointToTHREEPoint=function(e){var t=e.x,i=e.y,r={x:0,y:0},n=nb.stem.STEMMain.W,o=nb.stem.STEMMain.H;return r.x=t/n*2-1,r.y=-i/o*2+1,r},r.vertoc3ToPoint=function(e,t){var i=e.clone();return i.project(t),{x:(i.x+1)*nb.stem.STEMMain.W/2,y:(1-i.y)*nb.stem.STEMMain.H/2}},r.obj3DVecToDisPoint=function(e,t,i,n){var o=t.clone();e.localToWorld(o);var s=r.vertoc3ToPoint(o,i);return n.toLocal(s)},r.canvasPoint2DisPoint=function(e){var t={},i=instance.renderer.view;if(i==window.document)t.x=e.x,t.y=e.y;else{var r=i.getBoundingClientRect();t.x=(e.x-r.left)*(i.width/r.width),t.y=(e.y-r.top)*(i.height/r.height)}return t},t.Frame2DUtil=r,e.exports=r}).call(t,i(1))},function(e,t,i){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=i(11),t.createHash=t.Hash=i(13),t.createHmac=t.Hmac=i(49);var r=i(102),n=Object.keys(r),o=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(n);t.getHashes=function(){return o};var s=i(51);t.pbkdf2=s.pbkdf2,t.pbkdf2Sync=s.pbkdf2Sync;var a=i(104);t.Cipher=a.Cipher,t.createCipher=a.createCipher,t.Cipheriv=a.Cipheriv,t.createCipheriv=a.createCipheriv,t.Decipher=a.Decipher,t.createDecipher=a.createDecipher,t.Decipheriv=a.Decipheriv,t.createDecipheriv=a.createDecipheriv,t.getCiphers=a.getCiphers,t.listCiphers=a.listCiphers;var l=i(123);t.DiffieHellmanGroup=l.DiffieHellmanGroup,t.createDiffieHellmanGroup=l.createDiffieHellmanGroup,t.getDiffieHellman=l.getDiffieHellman,t.createDiffieHellman=l.createDiffieHellman,t.DiffieHellman=l.DiffieHellman;var h=i(128);t.createSign=h.createSign,t.Sign=h.Sign,t.createVerify=h.createVerify,t.Verify=h.Verify,t.createECDH=i(166);var c=i(167);t.publicEncrypt=c.publicEncrypt,t.privateEncrypt=c.privateEncrypt,t.publicDecrypt=c.publicDecrypt,t.privateDecrypt=c.privateDecrypt;var u=i(170);t.randomFill=u.randomFill,t.randomFillSync=u.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},function(e,t,i){"use strict";function r(){THREE.Group.call(this),this._alpha=1,this.useChildMatrix=!1}var n=i(187);r.prototype=Object.create(THREE.Group.prototype),r.constructor=r,r.prototype.createMovie=function(e){void 0==this.movie?this.movie=new n(e):console.error("已存在",this.movie)},r.prototype.getChildByFuzzyName=function(e){for(var t=this.children.length,i=0;i<t;i++){var r=this.children[i];if(-1!=r.name.indexOf(e))return r}return null},r.prototype.clone=function(e,t){var i=THREE.Group.prototype.clone.call(this,e,t);return i.ID=this.ID,i},Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(e){0===e&&(e=1e-6);for(var t=this.children.length,i=0;i<t;i++){var r=this.children[i];if(r instanceof THREE.Mesh){var n=r.material;n.transparent=!0;var o=n.opacity/this.alpha;isNaN(o)&&(o=0),n.opacity=o*e}else for(var s=0;s<r.children.length;s++)r.alpha=e}this._alpha=e}}),e.exports=r},function(e,t,i){(function(e,t){!function(e,i){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return h[l]=r,a(l),l++}function n(e){delete h[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(i,r)}}function s(e){if(c)setTimeout(s,0,e);else{var t=h[e];if(t){c=!0;try{o(t)}finally{n(e),c=!1}}}}if(!e.setImmediate){var a,l=1,h={},c=!1,u=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?function(){a=function(e){t.nextTick(function(){s(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?function(){var t="setImmediate$"+Math.random()+"$",i=function(i){i.source===e&&"string"==typeof i.data&&0===i.data.indexOf(t)&&s(+i.data.slice(t.length))};e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),a=function(i){e.postMessage(t+i,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){s(e.data)},a=function(t){e.port2.postMessage(t)}}():u&&"onreadystatechange"in u.createElement("script")?function(){var e=u.documentElement;a=function(t){var i=u.createElement("script");i.onreadystatechange=function(){s(t),i.onreadystatechange=null,e.removeChild(i),i=null},e.appendChild(i)}}():function(){a=function(e){setTimeout(s,0,e)}}(),f.setImmediate=r,f.clearImmediate=n}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,i(1),i(8))},function(e,t,i){"use strict";(function(t){window.NBMath={},NBMath.rotaPoint=function(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=Math.cos(i)*r-Math.sin(i)*n,s=Math.sin(i)*r+Math.cos(i)*n;return{x:o+t.x,y:s+t.y}},NBMath.normalize=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/t,y:e.y/t}},NBMath.distance=function(e,t){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},NBMath.retrieveRotation=function(e){return Math.atan2(e.b,e.d)},NBMath.retrieveScale=function(e){var t=NBMath.retrieveRotation(e);return e.a/Math.cos(t)},NBMath.random=function(e,t){return e instanceof Array&&(t=e[1],e=e[0]),e+Math.random()*(t-e)},t.NBMath=e.exports=NBMath}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i={};i.distance=function(e,t){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},i.interpolate=function(e,t,i){i=1-i;var r={};return r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r},t.NBPoint=i,e.exports=i}).call(t,i(1))},function(e,t,i){var r,n;/*!
 * jQuery JavaScript Library v3.2.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2017-03-20T18:59Z
 */
!function(t,i){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(t)}("undefined"!=typeof window?window:this,function(i,o){"use strict";function s(e,t){t=t||se;var i=t.createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}function a(e){var t=!!e&&"length"in e&&e.length,i=ye.type(e);return"function"!==i&&!ye.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function l(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}function h(e,t,i){return ye.isFunction(t)?ye.grep(e,function(e,r){return!!t.call(e,r,e)!==i}):t.nodeType?ye.grep(e,function(e){return e===t!==i}):"string"!=typeof t?ye.grep(e,function(e){return ue.call(t,e)>-1!==i}):Pe.test(t)?ye.filter(t,e,i):(t=ye.filter(t,e),ye.grep(e,function(e){return ue.call(t,e)>-1!==i&&1===e.nodeType}))}function c(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function u(e){var t={};return ye.each(e.match(Oe)||[],function(e,i){t[i]=!0}),t}function f(e){return e}function d(e){throw e}function p(e,t,i,r){var n;try{e&&ye.isFunction(n=e.promise)?n.call(e).done(t).fail(i):e&&ye.isFunction(n=e.then)?n.call(e,t,i):t.apply(void 0,[e].slice(r))}catch(e){i.apply(void 0,[e])}}function m(){se.removeEventListener("DOMContentLoaded",m),i.removeEventListener("load",m),ye.ready()}function g(){this.expando=ye.expando+g.uid++}function v(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Ue.test(e)?JSON.parse(e):e)}function y(e,t,i){var r;if(void 0===i&&1===e.nodeType)if(r="data-"+t.replace(ze,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(r))){try{i=v(i)}catch(e){}Ve.set(e,t,i)}else i=void 0;return i}function _(e,t,i,r){var n,o=1,s=20,a=r?function(){return r.cur()}:function(){return ye.css(e,t,"")},l=a(),h=i&&i[3]||(ye.cssNumber[t]?"":"px"),c=(ye.cssNumber[t]||"px"!==h&&+l)&&He.exec(ye.css(e,t));if(c&&c[3]!==h){h=h||c[3],i=i||[],c=+l||1;do{o=o||".5",c/=o,ye.style(e,t,c+h)}while(o!==(o=a()/l)&&1!==o&&--s)}return i&&(c=+c||+l||0,n=i[1]?c+(i[1]+1)*i[2]:+i[2],r&&(r.unit=h,r.start=c,r.end=n)),n}function b(e){var t,i=e.ownerDocument,r=e.nodeName,n=Ye[r];return n||(t=i.body.appendChild(i.createElement(r)),n=ye.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),Ye[r]=n,n)}function x(e,t){for(var i,r,n=[],o=0,s=e.length;o<s;o++)r=e[o],r.style&&(i=r.style.display,t?("none"===i&&(n[o]=ke.get(r,"display")||null,n[o]||(r.style.display="")),""===r.style.display&&We(r)&&(n[o]=b(r))):"none"!==i&&(n[o]="none",ke.set(r,"display",i)));for(o=0;o<s;o++)null!=n[o]&&(e[o].style.display=n[o]);return e}function T(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&l(e,t)?ye.merge([e],i):i}function E(e,t){for(var i=0,r=e.length;i<r;i++)ke.set(e[i],"globalEval",!t||ke.get(t[i],"globalEval"))}function S(e,t,i,r,n){for(var o,s,a,l,h,c,u=t.createDocumentFragment(),f=[],d=0,p=e.length;d<p;d++)if((o=e[d])||0===o)if("object"===ye.type(o))ye.merge(f,o.nodeType?[o]:o);else if(Je.test(o)){for(s=s||u.appendChild(t.createElement("div")),a=(qe.exec(o)||["",""])[1].toLowerCase(),l=Ze[a]||Ze._default,s.innerHTML=l[1]+ye.htmlPrefilter(o)+l[2],c=l[0];c--;)s=s.lastChild;ye.merge(f,s.childNodes),s=u.firstChild,s.textContent=""}else f.push(t.createTextNode(o));for(u.textContent="",d=0;o=f[d++];)if(r&&ye.inArray(o,r)>-1)n&&n.push(o);else if(h=ye.contains(o.ownerDocument,o),s=T(u.appendChild(o),"script"),h&&E(s),i)for(c=0;o=s[c++];)Qe.test(o.type||"")&&i.push(o);return u}function w(){return!0}function M(){return!1}function A(){try{return se.activeElement}catch(e){}}function P(e,t,i,r,n,o){var s,a;if("object"==typeof t){"string"!=typeof i&&(r=r||i,i=void 0);for(a in t)P(e,a,i,r,t[a],o);return e}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=M;else if(!n)return e;return 1===o&&(s=n,n=function(e){return ye().off(e),s.apply(this,arguments)},n.guid=s.guid||(s.guid=ye.guid++)),e.each(function(){ye.event.add(this,t,n,r,i)})}function C(e,t){return l(e,"table")&&l(11!==t.nodeType?t:t.firstChild,"tr")?ye(">tbody",e)[0]||e:e}function R(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function D(e){var t=st.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function I(e,t){var i,r,n,o,s,a,l,h;if(1===t.nodeType){if(ke.hasData(e)&&(o=ke.access(e),s=ke.set(t,o),h=o.events)){delete s.handle,s.events={};for(n in h)for(i=0,r=h[n].length;i<r;i++)ye.event.add(t,n,h[n][i])}Ve.hasData(e)&&(a=Ve.access(e),l=ye.extend({},a),Ve.set(t,l))}}function O(e,t){var i=t.nodeName.toLowerCase();"input"===i&&Ke.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function F(e,t,i,r){t=he.apply([],t);var n,o,a,l,h,c,u=0,f=e.length,d=f-1,p=t[0],m=ye.isFunction(p);if(m||f>1&&"string"==typeof p&&!ve.checkClone&&ot.test(p))return e.each(function(n){var o=e.eq(n);m&&(t[0]=p.call(this,n,o.html())),F(o,t,i,r)});if(f&&(n=S(t,e[0].ownerDocument,!1,e,r),o=n.firstChild,1===n.childNodes.length&&(n=o),o||r)){for(a=ye.map(T(n,"script"),R),l=a.length;u<f;u++)h=n,u!==d&&(h=ye.clone(h,!0,!0),l&&ye.merge(a,T(h,"script"))),i.call(e[u],h,u);if(l)for(c=a[a.length-1].ownerDocument,ye.map(a,D),u=0;u<l;u++)h=a[u],Qe.test(h.type||"")&&!ke.access(h,"globalEval")&&ye.contains(c,h)&&(h.src?ye._evalUrl&&ye._evalUrl(h.src):s(h.textContent.replace(at,""),c))}return e}function L(e,t,i){for(var r,n=t?ye.filter(t,e):e,o=0;null!=(r=n[o]);o++)i||1!==r.nodeType||ye.cleanData(T(r)),r.parentNode&&(i&&ye.contains(r.ownerDocument,r)&&E(T(r,"script")),r.parentNode.removeChild(r));return e}function B(e,t,i){var r,n,o,s,a=e.style;return i=i||ct(e),i&&(s=i.getPropertyValue(t)||i[t],""!==s||ye.contains(e.ownerDocument,e)||(s=ye.style(e,t)),!ve.pixelMarginRight()&&ht.test(s)&&lt.test(t)&&(r=a.width,n=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=r,a.minWidth=n,a.maxWidth=o)),void 0!==s?s+"":s}function N(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function k(e){if(e in gt)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=mt.length;i--;)if((e=mt[i]+t)in gt)return e}function V(e){var t=ye.cssProps[e];return t||(t=ye.cssProps[e]=k(e)||e),t}function U(e,t,i){var r=He.exec(t);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):t}function z(e,t,i,r,n){var o,s=0;for(o=i===(r?"border":"content")?4:"width"===t?1:0;o<4;o+=2)"margin"===i&&(s+=ye.css(e,i+je[o],!0,n)),r?("content"===i&&(s-=ye.css(e,"padding"+je[o],!0,n)),"margin"!==i&&(s-=ye.css(e,"border"+je[o]+"Width",!0,n))):(s+=ye.css(e,"padding"+je[o],!0,n),"padding"!==i&&(s+=ye.css(e,"border"+je[o]+"Width",!0,n)));return s}function G(e,t,i){var r,n=ct(e),o=B(e,t,n),s="border-box"===ye.css(e,"boxSizing",!1,n);return ht.test(o)?o:(r=s&&(ve.boxSizingReliable()||o===e.style[t]),"auto"===o&&(o=e["offset"+t[0].toUpperCase()+t.slice(1)]),(o=parseFloat(o)||0)+z(e,t,i||(s?"border":"content"),r,n)+"px")}function H(e,t,i,r,n){return new H.prototype.init(e,t,i,r,n)}function j(){yt&&(!1===se.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(j):i.setTimeout(j,ye.fx.interval),ye.fx.tick())}function W(){return i.setTimeout(function(){vt=void 0}),vt=ye.now()}function X(e,t){var i,r=0,n={height:e};for(t=t?1:0;r<4;r+=2-t)i=je[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function Y(e,t,i){for(var r,n=(Q.tweeners[t]||[]).concat(Q.tweeners["*"]),o=0,s=n.length;o<s;o++)if(r=n[o].call(i,t,e))return r}function K(e,t,i){var r,n,o,s,a,l,h,c,u="width"in t||"height"in t,f=this,d={},p=e.style,m=e.nodeType&&We(e),g=ke.get(e,"fxshow");i.queue||(s=ye._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,f.always(function(){f.always(function(){s.unqueued--,ye.queue(e,"fx").length||s.empty.fire()})}));for(r in t)if(n=t[r],_t.test(n)){if(delete t[r],o=o||"toggle"===n,n===(m?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;m=!0}d[r]=g&&g[r]||ye.style(e,r)}if((l=!ye.isEmptyObject(t))||!ye.isEmptyObject(d)){u&&1===e.nodeType&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],h=g&&g.display,null==h&&(h=ke.get(e,"display")),c=ye.css(e,"display"),"none"===c&&(h?c=h:(x([e],!0),h=e.style.display||h,c=ye.css(e,"display"),x([e]))),("inline"===c||"inline-block"===c&&null!=h)&&"none"===ye.css(e,"float")&&(l||(f.done(function(){p.display=h}),null==h&&(c=p.display,h="none"===c?"":c)),p.display="inline-block")),i.overflow&&(p.overflow="hidden",f.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]})),l=!1;for(r in d)l||(g?"hidden"in g&&(m=g.hidden):g=ke.access(e,"fxshow",{display:h}),o&&(g.hidden=!m),m&&x([e],!0),f.done(function(){m||x([e]),ke.remove(e,"fxshow");for(r in d)ye.style(e,r,d[r])})),l=Y(m?g[r]:0,r,f),r in g||(g[r]=l.start,m&&(l.end=l.start,l.start=0))}}function q(e,t){var i,r,n,o,s;for(i in e)if(r=ye.camelCase(i),n=t[r],o=e[i],Array.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==r&&(e[r]=o,delete e[i]),(s=ye.cssHooks[r])&&"expand"in s){o=s.expand(o),delete e[r];for(i in o)i in e||(e[i]=o[i],t[i]=n)}else t[r]=n}function Q(e,t,i){var r,n,o=0,s=Q.prefilters.length,a=ye.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=vt||W(),i=Math.max(0,h.startTime+h.duration-t),r=i/h.duration||0,o=1-r,s=0,l=h.tweens.length;s<l;s++)h.tweens[s].run(o);return a.notifyWith(e,[h,o,i]),o<1&&l?i:(l||a.notifyWith(e,[h,1,0]),a.resolveWith(e,[h]),!1)},h=a.promise({elem:e,props:ye.extend({},t),opts:ye.extend(!0,{specialEasing:{},easing:ye.easing._default},i),originalProperties:t,originalOptions:i,startTime:vt||W(),duration:i.duration,tweens:[],createTween:function(t,i){var r=ye.Tween(e,h.opts,t,i,h.opts.specialEasing[t]||h.opts.easing);return h.tweens.push(r),r},stop:function(t){var i=0,r=t?h.tweens.length:0;if(n)return this;for(n=!0;i<r;i++)h.tweens[i].run(1);return t?(a.notifyWith(e,[h,1,0]),a.resolveWith(e,[h,t])):a.rejectWith(e,[h,t]),this}}),c=h.props;for(q(c,h.opts.specialEasing);o<s;o++)if(r=Q.prefilters[o].call(h,e,c,h.opts))return ye.isFunction(r.stop)&&(ye._queueHooks(h.elem,h.opts.queue).stop=ye.proxy(r.stop,r)),r;return ye.map(c,Y,h),ye.isFunction(h.opts.start)&&h.opts.start.call(e,h),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always),ye.fx.timer(ye.extend(l,{elem:e,anim:h,queue:h.opts.queue})),h}function Z(e){return(e.match(Oe)||[]).join(" ")}function J(e){return e.getAttribute&&e.getAttribute("class")||""}function $(e,t,i,r){var n;if(Array.isArray(t))ye.each(t,function(t,n){i||Rt.test(e)?r(e,n):$(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,r)});else if(i||"object"!==ye.type(t))r(e,t);else for(n in t)$(e+"["+n+"]",t[n],i,r)}function ee(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var r,n=0,o=t.toLowerCase().match(Oe)||[];if(ye.isFunction(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function te(e,t,i,r){function n(a){var l;return o[a]=!0,ye.each(e[a]||[],function(e,a){var h=a(t,i,r);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(t.dataTypes.unshift(h),n(h),!1)}),l}var o={},s=e===Gt;return n(t.dataTypes[0])||!o["*"]&&n("*")}function ie(e,t){var i,r,n=ye.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:r||(r={}))[i]=t[i]);return r&&ye.extend(!0,e,r),e}function re(e,t,i){for(var r,n,o,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}s||(s=n)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}function ne(e,t,i,r){var n,o,s,a,l,h={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)h[s.toLowerCase()]=e.converters[s];for(o=c.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=h[l+" "+o]||h["* "+o]))for(n in h)if(a=n.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){!0===s?s=h[n]:!0!==h[n]&&(o=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}var oe=[],se=i.document,ae=Object.getPrototypeOf,le=oe.slice,he=oe.concat,ce=oe.push,ue=oe.indexOf,fe={},de=fe.toString,pe=fe.hasOwnProperty,me=pe.toString,ge=me.call(Object),ve={},ye=function(e,t){return new ye.fn.init(e,t)},_e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,be=/^-ms-/,xe=/-([a-z])/g,Te=function(e,t){return t.toUpperCase()};ye.fn=ye.prototype={jquery:"3.2.1",constructor:ye,length:0,toArray:function(){return le.call(this)},get:function(e){return null==e?le.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ye.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ye.each(this,e)},map:function(e){return this.pushStack(ye.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(le.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:ce,sort:oe.sort,splice:oe.splice},ye.extend=ye.fn.extend=function(){var e,t,i,r,n,o,s=arguments[0]||{},a=1,l=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[a]||{},a++),"object"==typeof s||ye.isFunction(s)||(s={}),a===l&&(s=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)i=s[t],r=e[t],s!==r&&(h&&r&&(ye.isPlainObject(r)||(n=Array.isArray(r)))?(n?(n=!1,o=i&&Array.isArray(i)?i:[]):o=i&&ye.isPlainObject(i)?i:{},s[t]=ye.extend(h,o,r)):void 0!==r&&(s[t]=r));return s},ye.extend({expando:"jQuery"+("3.2.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ye.type(e)},isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=ye.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==de.call(e))&&(!(t=ae(e))||"function"==typeof(i=pe.call(t,"constructor")&&t.constructor)&&me.call(i)===ge)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?fe[de.call(e)]||"object":typeof e},globalEval:function(e){s(e)},camelCase:function(e){return e.replace(be,"ms-").replace(xe,Te)},each:function(e,t){var i,r=0;if(a(e))for(i=e.length;r<i&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(_e,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(a(Object(e))?ye.merge(i,"string"==typeof e?[e]:e):ce.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:ue.call(t,e,i)},merge:function(e,t){for(var i=+t.length,r=0,n=e.length;r<i;r++)e[n++]=t[r];return e.length=n,e},grep:function(e,t,i){for(var r=[],n=0,o=e.length,s=!i;n<o;n++)!t(e[n],n)!==s&&r.push(e[n]);return r},map:function(e,t,i){var r,n,o=0,s=[];if(a(e))for(r=e.length;o<r;o++)null!=(n=t(e[o],o,i))&&s.push(n);else for(o in e)null!=(n=t(e[o],o,i))&&s.push(n);return he.apply([],s)},guid:1,proxy:function(e,t){var i,r,n;if("string"==typeof t&&(i=e[t],t=e,e=i),ye.isFunction(e))return r=le.call(arguments,2),n=function(){return e.apply(t||this,r.concat(le.call(arguments)))},n.guid=e.guid=e.guid||ye.guid++,n},now:Date.now,support:ve}),"function"==typeof Symbol&&(ye.fn[Symbol.iterator]=oe[Symbol.iterator]),ye.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){fe["[object "+t+"]"]=t.toLowerCase()});var Ee=/*!
 * Sizzle CSS Selector Engine v2.3.3
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-08-08
 */
function(e){function t(e,t,i,r){var n,o,s,a,l,c,f,d=t&&t.ownerDocument,p=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==p&&9!==p&&11!==p)return i;if(!r&&((t?t.ownerDocument||t:V)!==D&&R(t),t=t||D,O)){if(11!==p&&(l=me.exec(e)))if(n=l[1]){if(9===p){if(!(s=t.getElementById(n)))return i;if(s.id===n)return i.push(s),i}else if(d&&(s=d.getElementById(n))&&N(t,s)&&s.id===n)return i.push(s),i}else{if(l[2])return Q.apply(i,t.getElementsByTagName(e)),i;if((n=l[3])&&b.getElementsByClassName&&t.getElementsByClassName)return Q.apply(i,t.getElementsByClassName(n)),i}if(b.qsa&&!j[e+" "]&&(!F||!F.test(e))){if(1!==p)d=t,f=e;else if("object"!==t.nodeName.toLowerCase()){for((a=t.getAttribute("id"))?a=a.replace(_e,be):t.setAttribute("id",a=k),c=S(e),o=c.length;o--;)c[o]="#"+a+" "+u(c[o]);f=c.join(","),d=ge.test(e)&&h(t.parentNode)||t}if(f)try{return Q.apply(i,d.querySelectorAll(f)),i}catch(e){}finally{a===k&&t.removeAttribute("id")}}}return M(e.replace(oe,"$1"),t,i,r)}function i(){function e(i,r){return t.push(i+" ")>x.cacheLength&&delete e[t.shift()],e[i+" "]=r}var t=[];return e}function r(e){return e[k]=!0,e}function n(e){var t=D.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var i=e.split("|"),r=i.length;r--;)x.attrHandle[i[r]]=t}function s(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function a(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&Te(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function l(e){return r(function(t){return t=+t,r(function(i,r){for(var n,o=e([],i.length,t),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))})})}function h(e){return e&&void 0!==e.getElementsByTagName&&e}function c(){}function u(e){for(var t=0,i=e.length,r="";t<i;t++)r+=e[t].value;return r}function f(e,t,i){var r=t.dir,n=t.next,o=n||r,s=i&&"parentNode"===o,a=z++;return t.first?function(t,i,n){for(;t=t[r];)if(1===t.nodeType||s)return e(t,i,n);return!1}:function(t,i,l){var h,c,u,f=[U,a];if(l){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,i,l))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if(u=t[k]||(t[k]={}),c=u[t.uniqueID]||(u[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[r]||t;else{if((h=c[o])&&h[0]===U&&h[1]===a)return f[2]=h[2];if(c[o]=f,f[2]=e(t,i,l))return!0}return!1}}function d(e){return e.length>1?function(t,i,r){for(var n=e.length;n--;)if(!e[n](t,i,r))return!1;return!0}:e[0]}function p(e,i,r){for(var n=0,o=i.length;n<o;n++)t(e,i[n],r);return r}function m(e,t,i,r,n){for(var o,s=[],a=0,l=e.length,h=null!=t;a<l;a++)(o=e[a])&&(i&&!i(o,r,n)||(s.push(o),h&&t.push(a)));return s}function g(e,t,i,n,o,s){return n&&!n[k]&&(n=g(n)),o&&!o[k]&&(o=g(o,s)),r(function(r,s,a,l){var h,c,u,f=[],d=[],g=s.length,v=r||p(t||"*",a.nodeType?[a]:a,[]),y=!e||!r&&t?v:m(v,f,e,a,l),_=i?o||(r?e:g||n)?[]:s:y;if(i&&i(y,_,a,l),n)for(h=m(_,d),n(h,[],a,l),c=h.length;c--;)(u=h[c])&&(_[d[c]]=!(y[d[c]]=u));if(r){if(o||e){if(o){for(h=[],c=_.length;c--;)(u=_[c])&&h.push(y[c]=u);o(null,_=[],h,l)}for(c=_.length;c--;)(u=_[c])&&(h=o?J(r,u):f[c])>-1&&(r[h]=!(s[h]=u))}}else _=m(_===s?_.splice(g,_.length):_),o?o(null,s,_,l):Q.apply(s,_)})}function v(e){for(var t,i,r,n=e.length,o=x.relative[e[0].type],s=o||x.relative[" "],a=o?1:0,l=f(function(e){return e===t},s,!0),h=f(function(e){return J(t,e)>-1},s,!0),c=[function(e,i,r){var n=!o&&(r||i!==A)||((t=i).nodeType?l(e,i,r):h(e,i,r));return t=null,n}];a<n;a++)if(i=x.relative[e[a].type])c=[f(d(c),i)];else{if(i=x.filter[e[a].type].apply(null,e[a].matches),i[k]){for(r=++a;r<n&&!x.relative[e[r].type];r++);return g(a>1&&d(c),a>1&&u(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(oe,"$1"),i,a<r&&v(e.slice(a,r)),r<n&&v(e=e.slice(r)),r<n&&u(e))}c.push(i)}return d(c)}function y(e,i){var n=i.length>0,o=e.length>0,s=function(r,s,a,l,h){var c,u,f,d=0,p="0",g=r&&[],v=[],y=A,_=r||o&&x.find.TAG("*",h),b=U+=null==y?1:Math.random()||.1,T=_.length;for(h&&(A=s===D||s||h);p!==T&&null!=(c=_[p]);p++){if(o&&c){for(u=0,s||c.ownerDocument===D||(R(c),a=!O);f=e[u++];)if(f(c,s||D,a)){l.push(c);break}h&&(U=b)}n&&((c=!f&&c)&&d--,r&&g.push(c))}if(d+=p,n&&p!==d){for(u=0;f=i[u++];)f(g,v,s,a);if(r){if(d>0)for(;p--;)g[p]||v[p]||(v[p]=K.call(l));v=m(v)}Q.apply(l,v),h&&!r&&v.length>0&&d+i.length>1&&t.uniqueSort(l)}return h&&(U=b,A=y),g};return n?r(s):s}var _,b,x,T,E,S,w,M,A,P,C,R,D,I,O,F,L,B,N,k="sizzle"+1*new Date,V=e.document,U=0,z=0,G=i(),H=i(),j=i(),W=function(e,t){return e===t&&(C=!0),0},X={}.hasOwnProperty,Y=[],K=Y.pop,q=Y.push,Q=Y.push,Z=Y.slice,J=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},$="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ie="\\["+ee+"*("+te+")(?:"+ee+"*([*^$|!~]?=)"+ee+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+te+"))|)"+ee+"*\\]",re=":("+te+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",ne=new RegExp(ee+"+","g"),oe=new RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),se=new RegExp("^"+ee+"*,"+ee+"*"),ae=new RegExp("^"+ee+"*([>+~]|"+ee+")"+ee+"*"),le=new RegExp("="+ee+"*([^\\]'\"]*?)"+ee+"*\\]","g"),he=new RegExp(re),ce=new RegExp("^"+te+"$"),ue={ID:new RegExp("^#("+te+")"),CLASS:new RegExp("^\\.("+te+")"),TAG:new RegExp("^("+te+"|[*])"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+re),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),bool:new RegExp("^(?:"+$+")$","i"),needsContext:new RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},fe=/^(?:input|select|textarea|button)$/i,de=/^h\d$/i,pe=/^[^{]+\{\s*\[native \w/,me=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ge=/[+~]/,ve=new RegExp("\\\\([\\da-f]{1,6}"+ee+"?|("+ee+")|.)","ig"),ye=function(e,t,i){var r="0x"+t-65536;return r!==r||i?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},_e=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,be=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},xe=function(){R()},Te=f(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{Q.apply(Y=Z.call(V.childNodes),V.childNodes),Y[V.childNodes.length].nodeType}catch(e){Q={apply:Y.length?function(e,t){q.apply(e,Z.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}b=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},R=t.setDocument=function(e){var t,i,r=e?e.ownerDocument||e:V;return r!==D&&9===r.nodeType&&r.documentElement?(D=r,I=D.documentElement,O=!E(D),V!==D&&(i=D.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",xe,!1):i.attachEvent&&i.attachEvent("onunload",xe)),b.attributes=n(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=n(function(e){return e.appendChild(D.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=pe.test(D.getElementsByClassName),b.getById=n(function(e){return I.appendChild(e).id=k,!D.getElementsByName||!D.getElementsByName(k).length}),b.getById?(x.filter.ID=function(e){var t=e.replace(ve,ye);return function(e){return e.getAttribute("id")===t}},x.find.ID=function(e,t){if(void 0!==t.getElementById&&O){var i=t.getElementById(e);return i?[i]:[]}}):(x.filter.ID=function(e){var t=e.replace(ve,ye);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},x.find.ID=function(e,t){if(void 0!==t.getElementById&&O){var i,r,n,o=t.getElementById(e);if(o){if((i=o.getAttributeNode("id"))&&i.value===e)return[o];for(n=t.getElementsByName(e),r=0;o=n[r++];)if((i=o.getAttributeNode("id"))&&i.value===e)return[o]}return[]}}),x.find.TAG=b.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,r=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},x.find.CLASS=b.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&O)return t.getElementsByClassName(e)},L=[],F=[],(b.qsa=pe.test(D.querySelectorAll))&&(n(function(e){I.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&F.push("[*^$]="+ee+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||F.push("\\["+ee+"*(?:value|"+$+")"),e.querySelectorAll("[id~="+k+"-]").length||F.push("~="),e.querySelectorAll(":checked").length||F.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||F.push(".#.+[+~]")}),n(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=D.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&F.push("name"+ee+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&F.push(":enabled",":disabled"),I.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&F.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),F.push(",.*:")})),(b.matchesSelector=pe.test(B=I.matches||I.webkitMatchesSelector||I.mozMatchesSelector||I.oMatchesSelector||I.msMatchesSelector))&&n(function(e){b.disconnectedMatch=B.call(e,"*"),B.call(e,"[s!='']:x"),L.push("!=",re)}),F=F.length&&new RegExp(F.join("|")),L=L.length&&new RegExp(L.join("|")),t=pe.test(I.compareDocumentPosition),N=t||pe.test(I.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},W=t?function(e,t){if(e===t)return C=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i||(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!b.sortDetached&&t.compareDocumentPosition(e)===i?e===D||e.ownerDocument===V&&N(V,e)?-1:t===D||t.ownerDocument===V&&N(V,t)?1:P?J(P,e)-J(P,t):0:4&i?-1:1)}:function(e,t){if(e===t)return C=!0,0;var i,r=0,n=e.parentNode,o=t.parentNode,a=[e],l=[t];if(!n||!o)return e===D?-1:t===D?1:n?-1:o?1:P?J(P,e)-J(P,t):0;if(n===o)return s(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)l.unshift(i);for(;a[r]===l[r];)r++;return r?s(a[r],l[r]):a[r]===V?-1:l[r]===V?1:0},D):D},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==D&&R(e),i=i.replace(le,"='$1']"),b.matchesSelector&&O&&!j[i+" "]&&(!L||!L.test(i))&&(!F||!F.test(i)))try{var r=B.call(e,i);if(r||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(i,D,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==D&&R(e),N(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==D&&R(e);var i=x.attrHandle[t.toLowerCase()],r=i&&X.call(x.attrHandle,t.toLowerCase())?i(e,t,!O):void 0;return void 0!==r?r:b.attributes||!O?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.escape=function(e){return(e+"").replace(_e,be)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],r=0,n=0;if(C=!b.detectDuplicates,P=!b.sortStable&&e.slice(0),e.sort(W),C){for(;t=e[n++];)t===e[n]&&(r=i.push(n));for(;r--;)e.splice(i[r],1)}return P=null,e},T=t.getText=function(e){var t,i="",r=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=T(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r++];)i+=T(t);return i},x=t.selectors={cacheLength:50,createPseudo:r,match:ue,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ve,ye),e[3]=(e[3]||e[4]||e[5]||"").replace(ve,ye),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return ue.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&he.test(i)&&(t=S(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ve,ye).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,r){return function(n){var o=t.attr(n,e);return null==o?"!="===i:!i||(o+="","="===i?o===r:"!="===i?o!==r:"^="===i?r&&0===o.indexOf(r):"*="===i?r&&o.indexOf(r)>-1:"$="===i?r&&o.slice(-r.length)===r:"~="===i?(" "+o.replace(ne," ")+" ").indexOf(r)>-1:"|="===i&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,i,r,n){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,l){var h,c,u,f,d,p,m=o!==s?"nextSibling":"previousSibling",g=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a,_=!1;if(g){if(o){for(;m;){for(f=t;f=f[m];)if(a?f.nodeName.toLowerCase()===v:1===f.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[s?g.firstChild:g.lastChild],s&&y){for(f=g,u=f[k]||(f[k]={}),c=u[f.uniqueID]||(u[f.uniqueID]={}),h=c[e]||[],d=h[0]===U&&h[1],_=d&&h[2],f=d&&g.childNodes[d];f=++d&&f&&f[m]||(_=d=0)||p.pop();)if(1===f.nodeType&&++_&&f===t){c[e]=[U,d,_];break}}else if(y&&(f=t,u=f[k]||(f[k]={}),c=u[f.uniqueID]||(u[f.uniqueID]={}),h=c[e]||[],d=h[0]===U&&h[1],_=d),!1===_)for(;(f=++d&&f&&f[m]||(_=d=0)||p.pop())&&((a?f.nodeName.toLowerCase()!==v:1!==f.nodeType)||!++_||(y&&(u=f[k]||(f[k]={}),c=u[f.uniqueID]||(u[f.uniqueID]={}),c[e]=[U,_]),f!==t)););return(_-=n)===r||_%r==0&&_/r>=0}}},PSEUDO:function(e,i){var n,o=x.pseudos[e]||x.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[k]?o(i):o.length>1?(n=[e,e,"",i],x.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,n=o(e,i),s=n.length;s--;)r=J(e,n[s]),e[r]=!(t[r]=n[s])}):function(e){return o(e,0,n)}):o}},pseudos:{not:r(function(e){var t=[],i=[],n=w(e.replace(oe,"$1"));return n[k]?r(function(e,t,i,r){for(var o,s=n(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,r,o){return t[0]=e,n(t,null,o,i),t[0]=null,!i.pop()}}),has:r(function(e){return function(i){return t(e,i).length>0}}),contains:r(function(e){return e=e.replace(ve,ye),function(t){return(t.textContent||t.innerText||T(t)).indexOf(e)>-1}}),lang:r(function(e){return ce.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ve,ye).toLowerCase(),function(t){var i;do{if(i=O?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===I},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:a(!1),disabled:a(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return de.test(e.nodeName)},input:function(e){return fe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,i){return[i<0?i+t:i]}),even:l(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:l(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:l(function(e,t,i){for(var r=i<0?i+t:i;--r>=0;)e.push(r);return e}),gt:l(function(e,t,i){for(var r=i<0?i+t:i;++r<t;)e.push(r);return e})}},x.pseudos.nth=x.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[_]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(_);for(_ in{submit:!0,reset:!0})x.pseudos[_]=function(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}(_);return c.prototype=x.filters=x.pseudos,x.setFilters=new c,S=t.tokenize=function(e,i){var r,n,o,s,a,l,h,c=H[e+" "];if(c)return i?0:c.slice(0);for(a=e,l=[],h=x.preFilter;a;){r&&!(n=se.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(o=[])),r=!1,(n=ae.exec(a))&&(r=n.shift(),o.push({value:r,type:n[0].replace(oe," ")}),a=a.slice(r.length));for(s in x.filter)!(n=ue[s].exec(a))||h[s]&&!(n=h[s](n))||(r=n.shift(),o.push({value:r,type:s,matches:n}),a=a.slice(r.length));if(!r)break}return i?a.length:a?t.error(e):H(e,l).slice(0)},w=t.compile=function(e,t){var i,r=[],n=[],o=j[e+" "];if(!o){for(t||(t=S(e)),i=t.length;i--;)o=v(t[i]),o[k]?r.push(o):n.push(o);o=j(e,y(n,r)),o.selector=e}return o},M=t.select=function(e,t,i,r){var n,o,s,a,l,c="function"==typeof e&&e,f=!r&&S(e=c.selector||e);if(i=i||[],1===f.length){if(o=f[0]=f[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&O&&x.relative[o[1].type]){if(!(t=(x.find.ID(s.matches[0].replace(ve,ye),t)||[])[0]))return i;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(n=ue.needsContext.test(e)?0:o.length;n--&&(s=o[n],!x.relative[a=s.type]);)if((l=x.find[a])&&(r=l(s.matches[0].replace(ve,ye),ge.test(o[0].type)&&h(t.parentNode)||t))){if(o.splice(n,1),!(e=r.length&&u(o)))return Q.apply(i,r),i;break}}return(c||w(e,f))(r,t,!O,i,!t||ge.test(e)&&h(t.parentNode)||t),i},b.sortStable=k.split("").sort(W).join("")===k,b.detectDuplicates=!!C,R(),b.sortDetached=n(function(e){return 1&e.compareDocumentPosition(D.createElement("fieldset"))}),n(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&n(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),n(function(e){return null==e.getAttribute("disabled")})||o($,function(e,t,i){var r;if(!i)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(i);ye.find=Ee,ye.expr=Ee.selectors,ye.expr[":"]=ye.expr.pseudos,ye.uniqueSort=ye.unique=Ee.uniqueSort,ye.text=Ee.getText,ye.isXMLDoc=Ee.isXML,ye.contains=Ee.contains,ye.escapeSelector=Ee.escape;var Se=function(e,t,i){for(var r=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&ye(e).is(i))break;r.push(e)}return r},we=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},Me=ye.expr.match.needsContext,Ae=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Pe=/^.[^:#\[\.,]*$/;ye.filter=function(e,t,i){var r=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ye.find.matchesSelector(r,e)?[r]:[]:ye.find.matches(e,ye.grep(t,function(e){return 1===e.nodeType}))},ye.fn.extend({find:function(e){var t,i,r=this.length,n=this;if("string"!=typeof e)return this.pushStack(ye(e).filter(function(){for(t=0;t<r;t++)if(ye.contains(n[t],this))return!0}));for(i=this.pushStack([]),t=0;t<r;t++)ye.find(e,n[t],i);return r>1?ye.uniqueSort(i):i},filter:function(e){return this.pushStack(h(this,e||[],!1))},not:function(e){return this.pushStack(h(this,e||[],!0))},is:function(e){return!!h(this,"string"==typeof e&&Me.test(e)?ye(e):e||[],!1).length}});var Ce,Re=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ye.fn.init=function(e,t,i){var r,n;if(!e)return this;if(i=i||Ce,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Re.exec(e))||!r[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ye?t[0]:t,ye.merge(this,ye.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:se,!0)),Ae.test(r[1])&&ye.isPlainObject(t))for(r in t)ye.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return n=se.getElementById(r[2]),n&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):ye.isFunction(e)?void 0!==i.ready?i.ready(e):e(ye):ye.makeArray(e,this)}).prototype=ye.fn,Ce=ye(se);var De=/^(?:parents|prev(?:Until|All))/,Ie={children:!0,contents:!0,next:!0,prev:!0};ye.fn.extend({has:function(e){var t=ye(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(ye.contains(this,t[e]))return!0})},closest:function(e,t){var i,r=0,n=this.length,o=[],s="string"!=typeof e&&ye(e);if(!Me.test(e))for(;r<n;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&ye.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?ye.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?ue.call(ye(e),this[0]):ue.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ye.uniqueSort(ye.merge(this.get(),ye(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ye.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return Se(e,"parentNode")},parentsUntil:function(e,t,i){return Se(e,"parentNode",i)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return Se(e,"nextSibling")},prevAll:function(e){return Se(e,"previousSibling")},nextUntil:function(e,t,i){return Se(e,"nextSibling",i)},prevUntil:function(e,t,i){return Se(e,"previousSibling",i)},siblings:function(e){return we((e.parentNode||{}).firstChild,e)},children:function(e){return we(e.firstChild)},contents:function(e){return l(e,"iframe")?e.contentDocument:(l(e,"template")&&(e=e.content||e),ye.merge([],e.childNodes))}},function(e,t){ye.fn[e]=function(i,r){var n=ye.map(this,t,i);return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=ye.filter(r,n)),this.length>1&&(Ie[e]||ye.uniqueSort(n),De.test(e)&&n.reverse()),this.pushStack(n)}});var Oe=/[^\x20\t\r\n\f]+/g;ye.Callbacks=function(e){e="string"==typeof e?u(e):ye.extend({},e);var t,i,r,n,o=[],s=[],a=-1,l=function(){for(n=n||e.once,r=t=!0;s.length;a=-1)for(i=s.shift();++a<o.length;)!1===o[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=o.length,i=!1);e.memory||(i=!1),t=!1,n&&(o=i?[]:"")},h={add:function(){return o&&(i&&!t&&(a=o.length-1,s.push(i)),function t(i){ye.each(i,function(i,r){ye.isFunction(r)?e.unique&&h.has(r)||o.push(r):r&&r.length&&"string"!==ye.type(r)&&t(r)})}(arguments),i&&!t&&l()),this},remove:function(){return ye.each(arguments,function(e,t){for(var i;(i=ye.inArray(t,o,i))>-1;)o.splice(i,1),i<=a&&a--}),this},has:function(e){return e?ye.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=s=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=s=[],i||t||(o=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=i||[],i=[e,i.slice?i.slice():i],s.push(i),t||l()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!r}};return h},ye.extend({Deferred:function(e){var t=[["notify","progress",ye.Callbacks("memory"),ye.Callbacks("memory"),2],["resolve","done",ye.Callbacks("once memory"),ye.Callbacks("once memory"),0,"resolved"],["reject","fail",ye.Callbacks("once memory"),ye.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return ye.Deferred(function(i){ye.each(t,function(t,r){var n=ye.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=n&&n.apply(this,arguments);e&&ye.isFunction(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this,n?[e]:arguments)})}),e=null}).promise()},then:function(e,r,n){function o(e,t,r,n){return function(){var a=this,l=arguments,h=function(){var i,h;if(!(e<s)){if((i=r.apply(a,l))===t.promise())throw new TypeError("Thenable self-resolution");h=i&&("object"==typeof i||"function"==typeof i)&&i.then,ye.isFunction(h)?n?h.call(i,o(s,t,f,n),o(s,t,d,n)):(s++,h.call(i,o(s,t,f,n),o(s,t,d,n),o(s,t,f,t.notifyWith))):(r!==f&&(a=void 0,l=[i]),(n||t.resolveWith)(a,l))}},c=n?h:function(){try{h()}catch(i){ye.Deferred.exceptionHook&&ye.Deferred.exceptionHook(i,c.stackTrace),e+1>=s&&(r!==d&&(a=void 0,l=[i]),t.rejectWith(a,l))}};e?c():(ye.Deferred.getStackHook&&(c.stackTrace=ye.Deferred.getStackHook()),i.setTimeout(c))}}var s=0;return ye.Deferred(function(i){t[0][3].add(o(0,i,ye.isFunction(n)?n:f,i.notifyWith)),t[1][3].add(o(0,i,ye.isFunction(e)?e:f)),t[2][3].add(o(0,i,ye.isFunction(r)?r:d))}).promise()},promise:function(e){return null!=e?ye.extend(e,n):n}},o={};return ye.each(t,function(e,i){var s=i[2],a=i[5];n[i[1]]=s.add,a&&s.add(function(){r=a},t[3-e][2].disable,t[0][2].lock),s.add(i[3].fire),o[i[0]]=function(){return o[i[0]+"With"](this===o?void 0:this,arguments),this},o[i[0]+"With"]=s.fireWith}),n.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,i=t,r=Array(i),n=le.call(arguments),o=ye.Deferred(),s=function(e){return function(i){r[e]=this,n[e]=arguments.length>1?le.call(arguments):i,--t||o.resolveWith(r,n)}};if(t<=1&&(p(e,o.done(s(i)).resolve,o.reject,!t),"pending"===o.state()||ye.isFunction(n[i]&&n[i].then)))return o.then();for(;i--;)p(n[i],s(i),o.reject);return o.promise()}});var Fe=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ye.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&Fe.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ye.readyException=function(e){i.setTimeout(function(){throw e})};var Le=ye.Deferred();ye.fn.ready=function(e){return Le.then(e).catch(function(e){ye.readyException(e)}),this},ye.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ye.readyWait:ye.isReady)||(ye.isReady=!0,!0!==e&&--ye.readyWait>0||Le.resolveWith(se,[ye]))}}),ye.ready.then=Le.then,"complete"===se.readyState||"loading"!==se.readyState&&!se.documentElement.doScroll?i.setTimeout(ye.ready):(se.addEventListener("DOMContentLoaded",m),i.addEventListener("load",m));var Be=function(e,t,i,r,n,o,s){var a=0,l=e.length,h=null==i;if("object"===ye.type(i)){n=!0;for(a in i)Be(e,t,a,i[a],!0,o,s)}else if(void 0!==r&&(n=!0,ye.isFunction(r)||(s=!0),h&&(s?(t.call(e,r),t=null):(h=t,t=function(e,t,i){return h.call(ye(e),i)})),t))for(;a<l;a++)t(e[a],i,s?r:r.call(e[a],a,t(e[a],i)));return n?e:h?t.call(e):l?t(e[0],i):o},Ne=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};g.uid=1,g.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Ne(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var r,n=this.cache(e);if("string"==typeof t)n[ye.camelCase(t)]=i;else for(r in t)n[ye.camelCase(r)]=t[r];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][ye.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,r=e[this.expando];if(void 0!==r){if(void 0!==t){Array.isArray(t)?t=t.map(ye.camelCase):(t=ye.camelCase(t),t=t in r?[t]:t.match(Oe)||[]),i=t.length;for(;i--;)delete r[t[i]]}(void 0===t||ye.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ye.isEmptyObject(t)}};var ke=new g,Ve=new g,Ue=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ze=/[A-Z]/g;ye.extend({hasData:function(e){return Ve.hasData(e)||ke.hasData(e)},data:function(e,t,i){return Ve.access(e,t,i)},removeData:function(e,t){Ve.remove(e,t)},_data:function(e,t,i){return ke.access(e,t,i)},_removeData:function(e,t){ke.remove(e,t)}}),ye.fn.extend({data:function(e,t){var i,r,n,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(n=Ve.get(o),1===o.nodeType&&!ke.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(r=s[i].name,0===r.indexOf("data-")&&(r=ye.camelCase(r.slice(5)),y(o,r,n[r])));ke.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){Ve.set(this,e)}):Be(this,function(t){var i;if(o&&void 0===t){if(void 0!==(i=Ve.get(o,e)))return i;if(void 0!==(i=y(o,e)))return i}else this.each(function(){Ve.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Ve.remove(this,e)})}}),ye.extend({queue:function(e,t,i){var r;if(e)return t=(t||"fx")+"queue",r=ke.get(e,t),i&&(!r||Array.isArray(i)?r=ke.access(e,t,ye.makeArray(i)):r.push(i)),r||[]},dequeue:function(e,t){t=t||"fx";var i=ye.queue(e,t),r=i.length,n=i.shift(),o=ye._queueHooks(e,t),s=function(){ye.dequeue(e,t)};"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return ke.get(e,i)||ke.access(e,i,{empty:ye.Callbacks("once memory").add(function(){ke.remove(e,[t+"queue",i])})})}}),ye.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?ye.queue(this[0],e):void 0===t?this:this.each(function(){var i=ye.queue(this,e,t);ye._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&ye.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ye.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=ye.Deferred(),o=this,s=this.length,a=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(i=ke.get(o[s],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(t)}});var Ge=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,He=new RegExp("^(?:([+-])=|)("+Ge+")([a-z%]*)$","i"),je=["Top","Right","Bottom","Left"],We=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&ye.contains(e.ownerDocument,e)&&"none"===ye.css(e,"display")},Xe=function(e,t,i,r){var n,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];n=i.apply(e,r||[]);for(o in t)e.style[o]=s[o];return n},Ye={};ye.fn.extend({show:function(){return x(this,!0)},hide:function(){return x(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){We(this)?ye(this).show():ye(this).hide()})}});var Ke=/^(?:checkbox|radio)$/i,qe=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Qe=/^$|\/(?:java|ecma)script/i,Ze={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ze.optgroup=Ze.option,Ze.tbody=Ze.tfoot=Ze.colgroup=Ze.caption=Ze.thead,Ze.th=Ze.td;var Je=/<|&#?\w+;/;!function(){var e=se.createDocumentFragment(),t=e.appendChild(se.createElement("div")),i=se.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),ve.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",ve.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var $e=se.documentElement,et=/^key/,tt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,it=/^([^.]*)(?:\.(.+)|)/;ye.event={global:{},add:function(e,t,i,r,n){var o,s,a,l,h,c,u,f,d,p,m,g=ke.get(e);if(g)for(i.handler&&(o=i,i=o.handler,n=o.selector),n&&ye.find.matchesSelector($e,n),i.guid||(i.guid=ye.guid++),(l=g.events)||(l=g.events={}),(s=g.handle)||(s=g.handle=function(t){return void 0!==ye&&ye.event.triggered!==t.type?ye.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Oe)||[""],h=t.length;h--;)a=it.exec(t[h])||[],d=m=a[1],p=(a[2]||"").split(".").sort(),d&&(u=ye.event.special[d]||{},d=(n?u.delegateType:u.bindType)||d,u=ye.event.special[d]||{},c=ye.extend({type:d,origType:m,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&ye.expr.match.needsContext.test(n),namespace:p.join(".")},o),(f=l[d])||(f=l[d]=[],f.delegateCount=0,u.setup&&!1!==u.setup.call(e,r,p,s)||e.addEventListener&&e.addEventListener(d,s)),u.add&&(u.add.call(e,c),c.handler.guid||(c.handler.guid=i.guid)),n?f.splice(f.delegateCount++,0,c):f.push(c),ye.event.global[d]=!0)},remove:function(e,t,i,r,n){var o,s,a,l,h,c,u,f,d,p,m,g=ke.hasData(e)&&ke.get(e);if(g&&(l=g.events)){for(t=(t||"").match(Oe)||[""],h=t.length;h--;)if(a=it.exec(t[h])||[],d=m=a[1],p=(a[2]||"").split(".").sort(),d){for(u=ye.event.special[d]||{},d=(r?u.delegateType:u.bindType)||d,f=l[d]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=f.length;o--;)c=f[o],!n&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,u.remove&&u.remove.call(e,c));s&&!f.length&&(u.teardown&&!1!==u.teardown.call(e,p,g.handle)||ye.removeEvent(e,d,g.handle),delete l[d])}else for(d in l)ye.event.remove(e,d+t[h],i,r,!0);ye.isEmptyObject(l)&&ke.remove(e,"handle events")}},dispatch:function(e){var t,i,r,n,o,s,a=ye.event.fix(e),l=new Array(arguments.length),h=(ke.get(this,"events")||{})[a.type]||[],c=ye.event.special[a.type]||{};for(l[0]=a,t=1;t<arguments.length;t++)l[t]=arguments[t];if(a.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,a)){for(s=ye.event.handlers.call(this,a,h),t=0;(n=s[t++])&&!a.isPropagationStopped();)for(a.currentTarget=n.elem,i=0;(o=n.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(o.namespace)||(a.handleObj=o,a.data=o.data,void 0!==(r=((ye.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,l))&&!1===(a.result=r)&&(a.preventDefault(),a.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,a),a.result}},handlers:function(e,t){var i,r,n,o,s,a=[],l=t.delegateCount,h=e.target;if(l&&h.nodeType&&!("click"===e.type&&e.button>=1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&("click"!==e.type||!0!==h.disabled)){for(o=[],s={},i=0;i<l;i++)r=t[i],n=r.selector+" ",void 0===s[n]&&(s[n]=r.needsContext?ye(n,this).index(h)>-1:ye.find(n,this,null,[h]).length),s[n]&&o.push(r);o.length&&a.push({elem:h,handlers:o})}return h=this,l<t.length&&a.push({elem:h,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(ye.Event.prototype,e,{enumerable:!0,configurable:!0,get:ye.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[ye.expando]?e:new ye.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==A()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===A()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&l(this,"input"))return this.click(),!1},_default:function(e){return l(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ye.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},ye.Event=function(e,t){if(!(this instanceof ye.Event))return new ye.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?w:M,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ye.extend(this,t),this.timeStamp=e&&e.timeStamp||ye.now(),this[ye.expando]=!0},ye.Event.prototype={constructor:ye.Event,isDefaultPrevented:M,isPropagationStopped:M,isImmediatePropagationStopped:M,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=w,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=w,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=w,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ye.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&et.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&tt.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},ye.event.addProp),ye.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ye.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,r=this,n=e.relatedTarget,o=e.handleObj;return n&&(n===r||ye.contains(r,n))||(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),ye.fn.extend({on:function(e,t,i,r){return P(this,e,t,i,r)},one:function(e,t,i,r){return P(this,e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ye(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=M),this.each(function(){ye.event.remove(this,e,i,t)})}});var rt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,nt=/<script|<style|<link/i,ot=/checked\s*(?:[^=]|=\s*.checked.)/i,st=/^true\/(.*)/,at=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ye.extend({htmlPrefilter:function(e){return e.replace(rt,"<$1></$2>")},clone:function(e,t,i){var r,n,o,s,a=e.cloneNode(!0),l=ye.contains(e.ownerDocument,e);if(!(ve.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ye.isXMLDoc(e)))for(s=T(a),o=T(e),r=0,n=o.length;r<n;r++)O(o[r],s[r]);if(t)if(i)for(o=o||T(e),s=s||T(a),r=0,n=o.length;r<n;r++)I(o[r],s[r]);else I(e,a);return s=T(a,"script"),s.length>0&&E(s,!l&&T(e,"script")),a},cleanData:function(e){for(var t,i,r,n=ye.event.special,o=0;void 0!==(i=e[o]);o++)if(Ne(i)){if(t=i[ke.expando]){if(t.events)for(r in t.events)n[r]?ye.event.remove(i,r):ye.removeEvent(i,r,t.handle);i[ke.expando]=void 0}i[Ve.expando]&&(i[Ve.expando]=void 0)}}}),ye.fn.extend({detach:function(e){return L(this,e,!0)},remove:function(e){return L(this,e)},text:function(e){return Be(this,function(e){return void 0===e?ye.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return F(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){C(this,e).appendChild(e)}})},prepend:function(){return F(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=C(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return F(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return F(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ye.cleanData(T(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ye.clone(this,e,t)})},html:function(e){return Be(this,function(e){var t=this[0]||{},i=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!nt.test(e)&&!Ze[(qe.exec(e)||["",""])[1].toLowerCase()]){e=ye.htmlPrefilter(e);try{for(;i<r;i++)t=this[i]||{},1===t.nodeType&&(ye.cleanData(T(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return F(this,arguments,function(t){var i=this.parentNode;ye.inArray(this,e)<0&&(ye.cleanData(T(this)),i&&i.replaceChild(t,this))},e)}}),ye.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ye.fn[e]=function(e){for(var i,r=[],n=ye(e),o=n.length-1,s=0;s<=o;s++)i=s===o?this:this.clone(!0),ye(n[s])[t](i),ce.apply(r,i.get());return this.pushStack(r)}});var lt=/^margin/,ht=new RegExp("^("+Ge+")(?!px)[a-z%]+$","i"),ct=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)};!function(){function e(){if(a){a.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",$e.appendChild(s);var e=i.getComputedStyle(a);t="1%"!==e.top,o="2px"===e.marginLeft,r="4px"===e.width,a.style.marginRight="50%",n="4px"===e.marginRight,$e.removeChild(s),a=null}}var t,r,n,o,s=se.createElement("div"),a=se.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",ve.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),ye.extend(ve,{pixelPosition:function(){return e(),t},boxSizingReliable:function(){return e(),r},pixelMarginRight:function(){return e(),n},reliableMarginLeft:function(){return e(),o}}))}();var ut=/^(none|table(?!-c[ea]).+)/,ft=/^--/,dt={position:"absolute",visibility:"hidden",display:"block"},pt={letterSpacing:"0",fontWeight:"400"},mt=["Webkit","Moz","ms"],gt=se.createElement("div").style;ye.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=B(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,s,a=ye.camelCase(t),l=ft.test(t),h=e.style;if(l||(t=V(a)),s=ye.cssHooks[t]||ye.cssHooks[a],void 0===i)return s&&"get"in s&&void 0!==(n=s.get(e,!1,r))?n:h[t];o=typeof i,"string"===o&&(n=He.exec(i))&&n[1]&&(i=_(e,t,n),o="number"),null!=i&&i===i&&("number"===o&&(i+=n&&n[3]||(ye.cssNumber[a]?"":"px")),ve.clearCloneStyle||""!==i||0!==t.indexOf("background")||(h[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,r))||(l?h.setProperty(t,i):h[t]=i))}},css:function(e,t,i,r){var n,o,s,a=ye.camelCase(t);return ft.test(t)||(t=V(a)),s=ye.cssHooks[t]||ye.cssHooks[a],s&&"get"in s&&(n=s.get(e,!0,i)),void 0===n&&(n=B(e,t,r)),"normal"===n&&t in pt&&(n=pt[t]),""===i||i?(o=parseFloat(n),!0===i||isFinite(o)?o||0:n):n}}),ye.each(["height","width"],function(e,t){ye.cssHooks[t]={get:function(e,i,r){if(i)return!ut.test(ye.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?G(e,t,r):Xe(e,dt,function(){return G(e,t,r)})},set:function(e,i,r){var n,o=r&&ct(e),s=r&&z(e,t,r,"border-box"===ye.css(e,"boxSizing",!1,o),o);return s&&(n=He.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=ye.css(e,t)),U(e,i,s)}}}),ye.cssHooks.marginLeft=N(ve.reliableMarginLeft,function(e,t){if(t)return(parseFloat(B(e,"marginLeft"))||e.getBoundingClientRect().left-Xe(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ye.each({margin:"",padding:"",border:"Width"},function(e,t){ye.cssHooks[e+t]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];r<4;r++)n[e+je[r]+t]=o[r]||o[r-2]||o[0];return n}},lt.test(e)||(ye.cssHooks[e+t].set=U)}),ye.fn.extend({css:function(e,t){return Be(this,function(e,t,i){var r,n,o={},s=0;if(Array.isArray(t)){for(r=ct(e),n=t.length;s<n;s++)o[t[s]]=ye.css(e,t[s],!1,r);return o}return void 0!==i?ye.style(e,t,i):ye.css(e,t)},e,t,arguments.length>1)}}),ye.Tween=H,H.prototype={constructor:H,init:function(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||ye.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ye.cssNumber[i]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var t,i=H.propHooks[this.prop];return this.options.duration?this.pos=t=ye.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ye.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){ye.fx.step[e.prop]?ye.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[ye.cssProps[e.prop]]&&!ye.cssHooks[e.prop]?e.elem[e.prop]=e.now:ye.style(e.elem,e.prop,e.now+e.unit)}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ye.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ye.fx=H.prototype.init,ye.fx.step={};var vt,yt,_t=/^(?:toggle|show|hide)$/,bt=/queueHooks$/;ye.Animation=ye.extend(Q,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return _(i.elem,e,He.exec(t),i),i}]},tweener:function(e,t){ye.isFunction(e)?(t=e,e=["*"]):e=e.match(Oe);for(var i,r=0,n=e.length;r<n;r++)i=e[r],Q.tweeners[i]=Q.tweeners[i]||[],Q.tweeners[i].unshift(t)},prefilters:[K],prefilter:function(e,t){t?Q.prefilters.unshift(e):Q.prefilters.push(e)}}),ye.speed=function(e,t,i){var r=e&&"object"==typeof e?ye.extend({},e):{complete:i||!i&&t||ye.isFunction(e)&&e,duration:e,easing:i&&t||t&&!ye.isFunction(t)&&t};return ye.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in ye.fx.speeds?r.duration=ye.fx.speeds[r.duration]:r.duration=ye.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){ye.isFunction(r.old)&&r.old.call(this),r.queue&&ye.dequeue(this,r.queue)},r},ye.fn.extend({fadeTo:function(e,t,i,r){return this.filter(We).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(e,t,i,r){var n=ye.isEmptyObject(e),o=ye.speed(t,i,r),s=function(){var t=Q(this,ye.extend({},e),o);(n||ke.get(this,"finish"))&&t.stop(!0)};return s.finish=s,n||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(e,t,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=ye.timers,s=ke.get(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&bt.test(n)&&r(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));!t&&i||ye.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=ke.get(this),r=i[e+"queue"],n=i[e+"queueHooks"],o=ye.timers,s=r?r.length:0;for(i.finish=!0,ye.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete i.finish})}}),ye.each(["toggle","show","hide"],function(e,t){var i=ye.fn[t];ye.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(X(t,!0),e,r,n)}}),ye.each({slideDown:X("show"),slideUp:X("hide"),slideToggle:X("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ye.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}}),ye.timers=[],ye.fx.tick=function(){var e,t=0,i=ye.timers;for(vt=ye.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||ye.fx.stop(),vt=void 0},ye.fx.timer=function(e){ye.timers.push(e),ye.fx.start()},ye.fx.interval=13,ye.fx.start=function(){yt||(yt=!0,j())},ye.fx.stop=function(){yt=null},ye.fx.speeds={slow:600,fast:200,_default:400},ye.fn.delay=function(e,t){return e=ye.fx?ye.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var n=i.setTimeout(t,e);r.stop=function(){i.clearTimeout(n)}})},function(){var e=se.createElement("input"),t=se.createElement("select"),i=t.appendChild(se.createElement("option"));e.type="checkbox",ve.checkOn=""!==e.value,ve.optSelected=i.selected,e=se.createElement("input"),e.value="t",e.type="radio",ve.radioValue="t"===e.value}();var xt,Tt=ye.expr.attrHandle;ye.fn.extend({attr:function(e,t){return Be(this,ye.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ye.removeAttr(this,e)})}}),ye.extend({attr:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?ye.prop(e,t,i):(1===o&&ye.isXMLDoc(e)||(n=ye.attrHooks[t.toLowerCase()]||(ye.expr.match.bool.test(t)?xt:void 0)),void 0!==i?null===i?void ye.removeAttr(e,t):n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(r=n.get(e,t))?r:(r=ye.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!ve.radioValue&&"radio"===t&&l(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,r=0,n=t&&t.match(Oe);if(n&&1===e.nodeType)for(;i=n[r++];)e.removeAttribute(i)}}),xt={set:function(e,t,i){return!1===t?ye.removeAttr(e,i):e.setAttribute(i,i),i}},ye.each(ye.expr.match.bool.source.match(/\w+/g),function(e,t){var i=Tt[t]||ye.find.attr;Tt[t]=function(e,t,r){var n,o,s=t.toLowerCase();return r||(o=Tt[s],Tt[s]=n,n=null!=i(e,t,r)?s:null,Tt[s]=o),n}});var Et=/^(?:input|select|textarea|button)$/i,St=/^(?:a|area)$/i;ye.fn.extend({prop:function(e,t){return Be(this,ye.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ye.propFix[e]||e]})}}),ye.extend({prop:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ye.isXMLDoc(e)||(t=ye.propFix[t]||t,n=ye.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ye.find.attr(e,"tabindex");return t?parseInt(t,10):Et.test(e.nodeName)||St.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ve.optSelected||(ye.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ye.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ye.propFix[this.toLowerCase()]=this}),ye.fn.extend({addClass:function(e){var t,i,r,n,o,s,a,l=0;if(ye.isFunction(e))return this.each(function(t){ye(this).addClass(e.call(this,t,J(this)))});if("string"==typeof e&&e)for(t=e.match(Oe)||[];i=this[l++];)if(n=J(i),r=1===i.nodeType&&" "+Z(n)+" "){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");a=Z(r),n!==a&&i.setAttribute("class",a)}return this},removeClass:function(e){var t,i,r,n,o,s,a,l=0;if(ye.isFunction(e))return this.each(function(t){ye(this).removeClass(e.call(this,t,J(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Oe)||[];i=this[l++];)if(n=J(i),r=1===i.nodeType&&" "+Z(n)+" "){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");a=Z(r),n!==a&&i.setAttribute("class",a)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):ye.isFunction(e)?this.each(function(i){ye(this).toggleClass(e.call(this,i,J(this),t),t)}):this.each(function(){var t,r,n,o;if("string"===i)for(r=0,n=ye(this),o=e.match(Oe)||[];t=o[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==e&&"boolean"!==i||(t=J(this),t&&ke.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":ke.get(this,"__className__")||""))})},hasClass:function(e){var t,i,r=0;for(t=" "+e+" ";i=this[r++];)if(1===i.nodeType&&(" "+Z(J(i))+" ").indexOf(t)>-1)return!0;return!1}});var wt=/\r/g;ye.fn.extend({val:function(e){var t,i,r,n=this[0];{if(arguments.length)return r=ye.isFunction(e),this.each(function(i){var n;1===this.nodeType&&(n=r?e.call(this,i,ye(this).val()):e,null==n?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=ye.map(n,function(e){return null==e?"":e+""})),(t=ye.valHooks[this.type]||ye.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))});if(n)return(t=ye.valHooks[n.type]||ye.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(wt,""):null==i?"":i)}}}),ye.extend({valHooks:{option:{get:function(e){var t=ye.find.attr(e,"value");return null!=t?t:Z(ye.text(e))}},select:{get:function(e){var t,i,r,n=e.options,o=e.selectedIndex,s="select-one"===e.type,a=s?null:[],h=s?o+1:n.length;for(r=o<0?h:s?o:0;r<h;r++)if(i=n[r],(i.selected||r===o)&&!i.disabled&&(!i.parentNode.disabled||!l(i.parentNode,"optgroup"))){if(t=ye(i).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var i,r,n=e.options,o=ye.makeArray(t),s=n.length;s--;)r=n[s],(r.selected=ye.inArray(ye.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),ye.each(["radio","checkbox"],function(){ye.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=ye.inArray(ye(e).val(),t)>-1}},ve.checkOn||(ye.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Mt=/^(?:focusinfocus|focusoutblur)$/;ye.extend(ye.event,{trigger:function(e,t,r,n){var o,s,a,l,h,c,u,f=[r||se],d=pe.call(e,"type")?e.type:e,p=pe.call(e,"namespace")?e.namespace.split("."):[];if(s=a=r=r||se,3!==r.nodeType&&8!==r.nodeType&&!Mt.test(d+ye.event.triggered)&&(d.indexOf(".")>-1&&(p=d.split("."),d=p.shift(),p.sort()),h=d.indexOf(":")<0&&"on"+d,e=e[ye.expando]?e:new ye.Event(d,"object"==typeof e&&e),e.isTrigger=n?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:ye.makeArray(t,[e]),u=ye.event.special[d]||{},n||!u.trigger||!1!==u.trigger.apply(r,t))){if(!n&&!u.noBubble&&!ye.isWindow(r)){for(l=u.delegateType||d,Mt.test(l+d)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(r.ownerDocument||se)&&f.push(a.defaultView||a.parentWindow||i)}for(o=0;(s=f[o++])&&!e.isPropagationStopped();)e.type=o>1?l:u.bindType||d,c=(ke.get(s,"events")||{})[e.type]&&ke.get(s,"handle"),c&&c.apply(s,t),(c=h&&s[h])&&c.apply&&Ne(s)&&(e.result=c.apply(s,t),!1===e.result&&e.preventDefault());return e.type=d,n||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.pop(),t)||!Ne(r)||h&&ye.isFunction(r[d])&&!ye.isWindow(r)&&(a=r[h],a&&(r[h]=null),ye.event.triggered=d,r[d](),ye.event.triggered=void 0,a&&(r[h]=a)),e.result}},simulate:function(e,t,i){var r=ye.extend(new ye.Event,i,{type:e,isSimulated:!0});ye.event.trigger(r,null,t)}}),ye.fn.extend({trigger:function(e,t){return this.each(function(){ye.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return ye.event.trigger(e,t,i,!0)}}),ye.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){ye.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),ye.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ve.focusin="onfocusin"in i,ve.focusin||ye.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){ye.event.simulate(t,e.target,ye.event.fix(e))};ye.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=ke.access(r,t);n||r.addEventListener(e,i,!0),ke.access(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=ke.access(r,t)-1;n?ke.access(r,t,n):(r.removeEventListener(e,i,!0),ke.remove(r,t))}}});var At=i.location,Pt=ye.now(),Ct=/\?/;ye.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||ye.error("Invalid XML: "+e),t};var Rt=/\[\]$/,Dt=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;ye.param=function(e,t){var i,r=[],n=function(e,t){var i=ye.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(e)||e.jquery&&!ye.isPlainObject(e))ye.each(e,function(){n(this.name,this.value)});else for(i in e)$(i,e[i],t,n);return r.join("&")},ye.fn.extend({serialize:function(){return ye.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ye.prop(this,"elements");return e?ye.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ye(this).is(":disabled")&&Ot.test(this.nodeName)&&!It.test(e)&&(this.checked||!Ke.test(e))}).map(function(e,t){var i=ye(this).val();return null==i?null:Array.isArray(i)?ye.map(i,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:i.replace(Dt,"\r\n")}}).get()}});var Ft=/%20/g,Lt=/#.*$/,Bt=/([?&])_=[^&]*/,Nt=/^(.*?):[ \t]*([^\r\n]*)$/gm,kt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Vt=/^(?:GET|HEAD)$/,Ut=/^\/\//,zt={},Gt={},Ht="*/".concat("*"),jt=se.createElement("a");jt.href=At.href,ye.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:At.href,type:"GET",isLocal:kt.test(At.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ye.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ie(ie(e,ye.ajaxSettings),t):ie(ye.ajaxSettings,e)},ajaxPrefilter:ee(zt),ajaxTransport:ee(Gt),ajax:function(e,t){function r(e,t,r,a){var h,f,d,b,x,T=t;c||(c=!0,l&&i.clearTimeout(l),n=void 0,s=a||"",E.readyState=e>0?4:0,h=e>=200&&e<300||304===e,r&&(b=re(p,E,r)),b=ne(p,b,E,h),h?(p.ifModified&&(x=E.getResponseHeader("Last-Modified"),x&&(ye.lastModified[o]=x),(x=E.getResponseHeader("etag"))&&(ye.etag[o]=x)),204===e||"HEAD"===p.type?T="nocontent":304===e?T="notmodified":(T=b.state,f=b.data,d=b.error,h=!d)):(d=T,!e&&T||(T="error",e<0&&(e=0))),E.status=e,E.statusText=(t||T)+"",h?v.resolveWith(m,[f,T,E]):v.rejectWith(m,[E,T,d]),E.statusCode(_),_=void 0,u&&g.trigger(h?"ajaxSuccess":"ajaxError",[E,p,h?f:d]),y.fireWith(m,[E,T]),u&&(g.trigger("ajaxComplete",[E,p]),--ye.active||ye.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,o,s,a,l,h,c,u,f,d,p=ye.ajaxSetup({},t),m=p.context||p,g=p.context&&(m.nodeType||m.jquery)?ye(m):ye.event,v=ye.Deferred(),y=ye.Callbacks("once memory"),_=p.statusCode||{},b={},x={},T="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(c){if(!a)for(a={};t=Nt.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?s:null},setRequestHeader:function(e,t){return null==c&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==c&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)E.always(e[E.status]);else for(t in e)_[t]=[_[t],e[t]];return this},abort:function(e){var t=e||T;return n&&n.abort(t),r(0,t),this}};if(v.promise(E),p.url=((e||p.url||At.href)+"").replace(Ut,At.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(Oe)||[""],null==p.crossDomain){h=se.createElement("a");try{h.href=p.url,h.href=h.href,p.crossDomain=jt.protocol+"//"+jt.host!=h.protocol+"//"+h.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=ye.param(p.data,p.traditional)),te(zt,p,t,E),c)return E;u=ye.event&&p.global,u&&0==ye.active++&&ye.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Vt.test(p.type),o=p.url.replace(Lt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(Ft,"+")):(d=p.url.slice(o.length),p.data&&(o+=(Ct.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(o=o.replace(Bt,"$1"),d=(Ct.test(o)?"&":"?")+"_="+Pt+++d),p.url=o+d),p.ifModified&&(ye.lastModified[o]&&E.setRequestHeader("If-Modified-Since",ye.lastModified[o]),ye.etag[o]&&E.setRequestHeader("If-None-Match",ye.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&E.setRequestHeader("Content-Type",p.contentType),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ht+"; q=0.01":""):p.accepts["*"]);for(f in p.headers)E.setRequestHeader(f,p.headers[f]);if(p.beforeSend&&(!1===p.beforeSend.call(m,E,p)||c))return E.abort();if(T="abort",y.add(p.complete),E.done(p.success),E.fail(p.error),n=te(Gt,p,t,E)){if(E.readyState=1,u&&g.trigger("ajaxSend",[E,p]),c)return E;p.async&&p.timeout>0&&(l=i.setTimeout(function(){E.abort("timeout")},p.timeout));try{c=!1,n.send(b,r)}catch(e){if(c)throw e;r(-1,e)}}else r(-1,"No Transport");return E},getJSON:function(e,t,i){return ye.get(e,t,i,"json")},getScript:function(e,t){return ye.get(e,void 0,t,"script")}}),ye.each(["get","post"],function(e,t){ye[t]=function(e,i,r,n){return ye.isFunction(i)&&(n=n||r,r=i,i=void 0),ye.ajax(ye.extend({url:e,type:t,dataType:n,data:i,success:r},ye.isPlainObject(e)&&e))}}),ye._evalUrl=function(e){return ye.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},ye.fn.extend({wrapAll:function(e){var t;return this[0]&&(ye.isFunction(e)&&(e=e.call(this[0])),t=ye(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return ye.isFunction(e)?this.each(function(t){ye(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ye(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=ye.isFunction(e);return this.each(function(i){ye(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ye(this).replaceWith(this.childNodes)}),this}}),ye.expr.pseudos.hidden=function(e){return!ye.expr.pseudos.visible(e)},ye.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ye.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Wt={0:200,1223:204},Xt=ye.ajaxSettings.xhr();ve.cors=!!Xt&&"withCredentials"in Xt,ve.ajax=Xt=!!Xt,ye.ajaxTransport(function(e){var t,r;if(ve.cors||Xt&&!e.crossDomain)return{send:function(n,o){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)a.setRequestHeader(s,n[s]);t=function(e){return function(){t&&(t=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Wt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),r=a.onerror=t("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout(function(){t&&r()})},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),ye.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ye.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ye.globalEval(e),e}}}),ye.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ye.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(r,n){t=ye("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),se.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Yt=[],Kt=/(=)\?(?=&|$)|\?\?/;ye.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||ye.expando+"_"+Pt++;return this[e]=!0,e}}),ye.ajaxPrefilter("json jsonp",function(e,t,r){var n,o,s,a=!1!==e.jsonp&&(Kt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=ye.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Kt,"$1"+n):!1!==e.jsonp&&(e.url+=(Ct.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return s||ye.error(n+" was not called"),s[0]},e.dataTypes[0]="json",o=i[n],i[n]=function(){s=arguments},r.always(function(){void 0===o?ye(i).removeProp(n):i[n]=o,e[n]&&(e.jsonpCallback=t.jsonpCallback,Yt.push(n)),s&&ye.isFunction(o)&&o(s[0]),s=o=void 0}),"script"}),ve.createHTMLDocument=function(){var e=se.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),ye.parseHTML=function(e,t,i){if("string"!=typeof e)return[];"boolean"==typeof t&&(i=t,t=!1);var r,n,o;return t||(ve.createHTMLDocument?(t=se.implementation.createHTMLDocument(""),r=t.createElement("base"),r.href=se.location.href,t.head.appendChild(r)):t=se),n=Ae.exec(e),o=!i&&[],n?[t.createElement(n[1])]:(n=S([e],t,o),o&&o.length&&ye(o).remove(),ye.merge([],n.childNodes))},ye.fn.load=function(e,t,i){var r,n,o,s=this,a=e.indexOf(" ");return a>-1&&(r=Z(e.slice(a)),e=e.slice(0,a)),ye.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),s.length>0&&ye.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?ye("<div>").append(ye.parseHTML(e)).find(r):e)}).always(i&&function(e,t){s.each(function(){i.apply(this,o||[e.responseText,t,e])})}),this},ye.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ye.fn[t]=function(e){return this.on(t,e)}}),ye.expr.pseudos.animated=function(e){return ye.grep(ye.timers,function(t){return e===t.elem}).length},ye.offset={setOffset:function(e,t,i){var r,n,o,s,a,l,h,c=ye.css(e,"position"),u=ye(e),f={};"static"===c&&(e.style.position="relative"),a=u.offset(),o=ye.css(e,"top"),l=ye.css(e,"left"),h=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,h?(r=u.position(),s=r.top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),ye.isFunction(t)&&(t=t.call(e,i,ye.extend({},a))),null!=t.top&&(f.top=t.top-a.top+s),null!=t.left&&(f.left=t.left-a.left+n),"using"in t?t.using.call(e,f):u.css(f)}},ye.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ye.offset.setOffset(this,e,t)});var t,i,r,n,o=this[0];if(o)return o.getClientRects().length?(r=o.getBoundingClientRect(),t=o.ownerDocument,i=t.documentElement,n=t.defaultView,{top:r.top+n.pageYOffset-i.clientTop,left:r.left+n.pageXOffset-i.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var e,t,i=this[0],r={top:0,left:0};return"fixed"===ye.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),l(e[0],"html")||(r=e.offset()),r={top:r.top+ye.css(e[0],"borderTopWidth",!0),left:r.left+ye.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-ye.css(i,"marginTop",!0),left:t.left-r.left-ye.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===ye.css(e,"position");)e=e.offsetParent;return e||$e})}}),ye.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;ye.fn[e]=function(r){return Be(this,function(e,r,n){var o;if(ye.isWindow(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===n)return o?o[t]:e[r];o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):e[r]=n},e,r,arguments.length)}}),ye.each(["top","left"],function(e,t){ye.cssHooks[t]=N(ve.pixelPosition,function(e,i){if(i)return i=B(e,t),ht.test(i)?ye(e).position()[t]+"px":i})}),ye.each({Height:"height",Width:"width"},function(e,t){ye.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,r){ye.fn[r]=function(n,o){var s=arguments.length&&(i||"boolean"!=typeof n),a=i||(!0===n||!0===o?"margin":"border");return Be(this,function(t,i,n){var o;return ye.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===n?ye.css(t,i,a):ye.style(t,i,n,a)},t,s?n:void 0,s)}})}),ye.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),ye.holdReady=function(e){e?ye.readyWait++:ye.ready(!0)},ye.isArray=Array.isArray,ye.parseJSON=JSON.parse,ye.nodeName=l,r=[],void 0!==(n=function(){return ye}.apply(t,r))&&(e.exports=n);var qt=i.jQuery,Qt=i.$;return ye.noConflict=function(e){return i.$===ye&&(i.$=Qt),e&&i.jQuery===ye&&(i.jQuery=qt),ye},o||(i.jQuery=i.$=ye),ye})},function(e,t,i){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function n(e){return 3*e.length/4-r(e)}function o(e){var t,i,n,o,s,a=e.length;o=r(e),s=new u(3*a/4-o),i=o>0?a-4:a;var l=0;for(t=0;t<i;t+=4)n=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],s[l++]=n>>16&255,s[l++]=n>>8&255,s[l++]=255&n;return 2===o?(n=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,s[l++]=255&n):1===o&&(n=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,s[l++]=n>>8&255,s[l++]=255&n),s}function s(e){return h[e>>18&63]+h[e>>12&63]+h[e>>6&63]+h[63&e]}function a(e,t,i){for(var r,n=[],o=t;o<i;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],n.push(s(r));return n.join("")}function l(e){for(var t,i=e.length,r=i%3,n="",o=[],s=0,l=i-r;s<l;s+=16383)o.push(a(e,s,s+16383>l?l:s+16383));return 1===r?(t=e[i-1],n+=h[t>>2],n+=h[t<<4&63],n+="=="):2===r&&(t=(e[i-2]<<8)+e[i-1],n+=h[t>>10],n+=h[t>>4&63],n+=h[t<<2&63],n+="="),o.push(n),o.join("")}t.byteLength=n,t.toByteArray=o,t.fromByteArray=l;for(var h=[],c=[],u="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=0,p=f.length;d<p;++d)h[d]=f[d],c[f.charCodeAt(d)]=d;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,n){var o,s,a=8*n-r-1,l=(1<<a)-1,h=l>>1,c=-7,u=i?n-1:0,f=i?-1:1,d=e[t+u];for(u+=f,o=d&(1<<-c)-1,d>>=-c,c+=a;c>0;o=256*o+e[t+u],u+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;c>0;s=256*s+e[t+u],u+=f,c-=8);if(0===o)o=1-h;else{if(o===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=h}return(d?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,i,r,n,o){var s,a,l,h=8*o-n-1,c=(1<<h)-1,u=c>>1,f=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),t+=s+u>=1?f/l:f*Math.pow(2,1-u),t*l>=2&&(s++,l/=2),s+u>=c?(a=0,s=c):s+u>=1?(a=(t*l-1)*Math.pow(2,n),s+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),s=0));n>=8;e[i+d]=255&a,d+=p,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;e[i+d]=255&s,d+=p,s/=256,h-=8);e[i+d-p]|=128*m}},function(e,t,i){"use strict";(function(t){function i(e){if(e.length%r!=0){var i=e.length+(r-e.length%r);e=t.concat([e,n],i)}for(var o=new Array(e.length>>>2),s=0,a=0;s<e.length;s+=r,a++)o[a]=e.readInt32LE(s);return o}var r=4,n=new t(r);n.fill(0);e.exports=function(e,r){var n=r(i(e),8*e.length);e=new t(16);for(var o=0;o<n.length;o++)e.writeInt32LE(n[o],o<<2,!0);return e}}).call(t,i(3).Buffer)},function(e,t,i){"use strict";(function(t){function r(e){n.call(this),this._block=new t(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}var n=i(19).Transform;i(0)(r,n),r.prototype._transform=function(e,i,r){var n=null;try{"buffer"!==i&&(e=new t(e,i)),this.update(e)}catch(e){n=e}r(n)},r.prototype._flush=function(e){var t=null;try{this.push(this._digest())}catch(e){t=e}e(t)},r.prototype.update=function(e,i){if(!t.isBuffer(e)&&"string"!=typeof e)throw new TypeError("Data must be a string or a buffer");if(this._finalized)throw new Error("Digest already called");t.isBuffer(e)||(e=new t(e,i||"binary"));for(var r=this._block,n=0;this._blockOffset+e.length-n>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)r[o++]=e[n++];this._update(),this._blockOffset=0}for(;n<e.length;)r[this._blockOffset++]=e[n++];for(var s=0,a=8*e.length;a>0;++s)this._length[s]+=a,(a=this._length[s]/4294967296|0)>0&&(this._length[s]-=4294967296*a);return this},r.prototype._update=function(e){throw new Error("_update is not implemented")},r.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();return void 0!==e&&(t=t.toString(e)),t},r.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=r}).call(t,i(3).Buffer)},function(e,t){},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t,i){e.copy(t,i)}var o=i(2).Buffer;e.exports=function(){function e(){r(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},e.prototype.concat=function(e){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var t=o.allocUnsafe(e>>>0),i=this.head,r=0;i;)n(i.data,t,r),r+=i.data.length,i=i.next;return t},e}()},function(e,t,i){(function(t){function i(e,t){function i(){if(!n){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}if(r("noDeprecation"))return e;var n=!1;return i}function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=i}).call(t,i(1))},function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}e.exports=r;var n=i(46),o=i(14);o.inherits=i(0),o.inherits(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},function(e,t,i){e.exports=i(31)},function(e,t,i){e.exports=i(10)},function(e,t,i){e.exports=i(20).Transform},function(e,t,i){e.exports=i(20).PassThrough},function(e,t,i){function r(){this.init(),this._w=u,l.call(this,64,56)}function n(e){return e<<5|e>>>27}function o(e){return e<<30|e>>>2}function s(e,t,i,r){return 0===e?t&i|~t&r:2===e?t&i|t&r|i&r:t^i^r}var a=i(0),l=i(12),h=i(2).Buffer,c=[1518500249,1859775393,-1894007588,-899497514],u=new Array(80);a(r,l),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,i=0|this._a,r=0|this._b,a=0|this._c,l=0|this._d,h=0|this._e,u=0;u<16;++u)t[u]=e.readInt32BE(4*u);for(;u<80;++u)t[u]=t[u-3]^t[u-8]^t[u-14]^t[u-16];for(var f=0;f<80;++f){var d=~~(f/20),p=n(i)+s(d,r,a,l)+h+t[f]+c[d]|0;h=l,l=a,a=o(r),r=i,i=p}this._a=i+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=l+this._d|0,this._e=h+this._e|0},r.prototype._hash=function(){var e=h.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r},function(e,t,i){function r(){this.init(),this._w=f,h.call(this,64,56)}function n(e){return e<<1|e>>>31}function o(e){return e<<5|e>>>27}function s(e){return e<<30|e>>>2}function a(e,t,i,r){return 0===e?t&i|~t&r:2===e?t&i|t&r|i&r:t^i^r}var l=i(0),h=i(12),c=i(2).Buffer,u=[1518500249,1859775393,-1894007588,-899497514],f=new Array(80);l(r,h),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,i=0|this._a,r=0|this._b,l=0|this._c,h=0|this._d,c=0|this._e,f=0;f<16;++f)t[f]=e.readInt32BE(4*f);for(;f<80;++f)t[f]=n(t[f-3]^t[f-8]^t[f-14]^t[f-16]);for(var d=0;d<80;++d){var p=~~(d/20),m=o(i)+a(p,r,l,h)+c+t[d]+u[p]|0;c=h,h=l,l=s(r),r=i,i=m}this._a=i+this._a|0,this._b=r+this._b|0,this._c=l+this._c|0,this._d=h+this._d|0,this._e=c+this._e|0},r.prototype._hash=function(){var e=c.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r},function(e,t,i){function r(){this.init(),this._w=l,s.call(this,64,56)}var n=i(0),o=i(47),s=i(12),a=i(2).Buffer,l=new Array(64);n(r,o),r.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},r.prototype._hash=function(){var e=a.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=r},function(e,t,i){function r(){this.init(),this._w=l,s.call(this,128,112)}var n=i(0),o=i(48),s=i(12),a=i(2).Buffer,l=new Array(160);n(r,o),r.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},r.prototype._hash=function(){function e(e,i,r){t.writeInt32BE(e,r),t.writeInt32BE(i,r+4)}var t=a.allocUnsafe(48);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t},e.exports=r},function(e,t,i){"use strict";function r(e,t){s.call(this,"digest"),"string"==typeof t&&(t=o.from(t)),this._alg=e,this._key=t,t.length>l?t=e(t):t.length<l&&(t=o.concat([t,a],l));for(var i=this._ipad=o.allocUnsafe(l),r=this._opad=o.allocUnsafe(l),n=0;n<l;n++)i[n]=54^t[n],r[n]=92^t[n];this._hash=[i]}var n=i(0),o=i(2).Buffer,s=i(9),a=o.alloc(128),l=64;n(r,s),r.prototype._update=function(e){this._hash.push(e)},r.prototype._final=function(){var e=this._alg(o.concat(this._hash));return this._alg(o.concat([this._opad,e]))},e.exports=r},function(e,t,i){e.exports=i(50)},function(e,t,i){(function(t,r){function n(e){if(t.process&&!t.process.browser)return Promise.resolve(!1);if(!f||!f.importKey||!f.deriveBits)return Promise.resolve(!1);if(void 0!==p[e])return p[e];a=a||u.alloc(8);var i=o(a,a,10,128,e).then(function(){return!0}).catch(function(){return!1});return p[e]=i,i}function o(e,t,i,r,n){return f.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return f.deriveBits({name:"PBKDF2",salt:t,iterations:i,hash:{name:n}},e,r<<3)}).then(function(e){return u.from(e)})}function s(e,t){e.then(function(e){r.nextTick(function(){t(null,e)})},function(e){r.nextTick(function(){t(e)})})}var a,l=i(52),h=i(53),c=i(54),u=i(2).Buffer,f=t.crypto&&t.crypto.subtle,d={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},p=[];e.exports=function(e,i,a,f,p,m){if(u.isBuffer(e)||(e=u.from(e,h)),u.isBuffer(i)||(i=u.from(i,h)),l(a,f),"function"==typeof p&&(m=p,p=void 0),"function"!=typeof m)throw new Error("No callback provided to pbkdf2");p=p||"sha1";var g=d[p.toLowerCase()];if(!g||"function"!=typeof t.Promise)return r.nextTick(function(){var t;try{t=c(e,i,a,f,p)}catch(e){return m(e)}m(null,t)});s(n(g).then(function(t){return t?o(e,i,a,f,g):c(e,i,a,f,p)}),m)}}).call(t,i(1),i(8))},function(e,t,i){function r(e,t){var i,r;if(e=e.toLowerCase(),f[e])i=f[e].key,r=f[e].iv;else{if(!u[e])throw new TypeError("invalid suite type");i=8*u[e].key,r=u[e].iv}var n=l(t,!1,i,r);return o(e,n.key,n.iv)}function n(e,t){var i,r;if(e=e.toLowerCase(),f[e])i=f[e].key,r=f[e].iv;else{if(!u[e])throw new TypeError("invalid suite type");i=8*u[e].key,r=u[e].iv}var n=l(t,!1,i,r);return s(e,n.key,n.iv)}function o(e,t,i){if(e=e.toLowerCase(),f[e])return h.createCipheriv(e,t,i);if(u[e])return new c({key:t,iv:i,mode:e});throw new TypeError("invalid suite type")}function s(e,t,i){if(e=e.toLowerCase(),f[e])return h.createDecipheriv(e,t,i);if(u[e])return new c({key:t,iv:i,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}function a(){return Object.keys(u).concat(h.getCiphers())}var l=i(22),h=i(34),c=i(116),u=i(122),f=i(35);t.createCipher=t.Cipher=r,t.createCipheriv=t.Cipheriv=o,t.createDecipher=t.Decipher=n,t.createDecipheriv=t.Decipheriv=s,t.listCiphers=t.getCiphers=a},function(e,t,i){"use strict";(function(t){function r(){c.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function n(e,t){return e<<t|e>>>32-t}function o(e,t,i,r,o,s,a){return n(e+(t&i|~t&r)+o+s|0,a)+t|0}function s(e,t,i,r,o,s,a){return n(e+(t&r|i&~r)+o+s|0,a)+t|0}function a(e,t,i,r,o,s,a){return n(e+(t^i^r)+o+s|0,a)+t|0}function l(e,t,i,r,o,s,a){return n(e+(i^(t|~r))+o+s|0,a)+t|0}var h=i(0),c=i(106),u=new Array(16);h(r,c),r.prototype._update=function(){for(var e=u,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var i=this._a,r=this._b,n=this._c,h=this._d;i=o(i,r,n,h,e[0],3614090360,7),h=o(h,i,r,n,e[1],3905402710,12),n=o(n,h,i,r,e[2],606105819,17),r=o(r,n,h,i,e[3],3250441966,22),i=o(i,r,n,h,e[4],4118548399,7),h=o(h,i,r,n,e[5],1200080426,12),n=o(n,h,i,r,e[6],2821735955,17),r=o(r,n,h,i,e[7],4249261313,22),i=o(i,r,n,h,e[8],1770035416,7),h=o(h,i,r,n,e[9],2336552879,12),n=o(n,h,i,r,e[10],4294925233,17),r=o(r,n,h,i,e[11],2304563134,22),i=o(i,r,n,h,e[12],1804603682,7),h=o(h,i,r,n,e[13],4254626195,12),n=o(n,h,i,r,e[14],2792965006,17),r=o(r,n,h,i,e[15],1236535329,22),i=s(i,r,n,h,e[1],4129170786,5),h=s(h,i,r,n,e[6],3225465664,9),n=s(n,h,i,r,e[11],643717713,14),r=s(r,n,h,i,e[0],3921069994,20),i=s(i,r,n,h,e[5],3593408605,5),h=s(h,i,r,n,e[10],38016083,9),n=s(n,h,i,r,e[15],3634488961,14),r=s(r,n,h,i,e[4],3889429448,20),i=s(i,r,n,h,e[9],568446438,5),h=s(h,i,r,n,e[14],3275163606,9),n=s(n,h,i,r,e[3],4107603335,14),r=s(r,n,h,i,e[8],1163531501,20),i=s(i,r,n,h,e[13],2850285829,5),h=s(h,i,r,n,e[2],4243563512,9),n=s(n,h,i,r,e[7],1735328473,14),r=s(r,n,h,i,e[12],2368359562,20),i=a(i,r,n,h,e[5],4294588738,4),h=a(h,i,r,n,e[8],2272392833,11),n=a(n,h,i,r,e[11],1839030562,16),r=a(r,n,h,i,e[14],4259657740,23),i=a(i,r,n,h,e[1],2763975236,4),h=a(h,i,r,n,e[4],1272893353,11),n=a(n,h,i,r,e[7],4139469664,16),r=a(r,n,h,i,e[10],3200236656,23),i=a(i,r,n,h,e[13],681279174,4),h=a(h,i,r,n,e[0],3936430074,11),n=a(n,h,i,r,e[3],3572445317,16),r=a(r,n,h,i,e[6],76029189,23),i=a(i,r,n,h,e[9],3654602809,4),h=a(h,i,r,n,e[12],3873151461,11),n=a(n,h,i,r,e[15],530742520,16),r=a(r,n,h,i,e[2],3299628645,23),i=l(i,r,n,h,e[0],4096336452,6),h=l(h,i,r,n,e[7],1126891415,10),n=l(n,h,i,r,e[14],2878612391,15),r=l(r,n,h,i,e[5],4237533241,21),i=l(i,r,n,h,e[12],1700485571,6),h=l(h,i,r,n,e[3],2399980690,10),n=l(n,h,i,r,e[10],4293915773,15),r=l(r,n,h,i,e[1],2240044497,21),i=l(i,r,n,h,e[8],1873313359,6),h=l(h,i,r,n,e[15],4264355552,10),n=l(n,h,i,r,e[6],2734768916,15),r=l(r,n,h,i,e[13],1309151649,21),i=l(i,r,n,h,e[4],4149444226,6),h=l(h,i,r,n,e[11],3174756917,10),n=l(n,h,i,r,e[2],718787259,15),r=l(r,n,h,i,e[9],3951481745,21),this._a=this._a+i|0,this._b=this._b+r|0,this._c=this._c+n|0,this._d=this._d+h|0},r.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=new t(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=r}).call(t,i(3).Buffer)},function(e,t,i){"use strict";function r(e,t){if(!o.isBuffer(e)&&"string"!=typeof e)throw new TypeError(t+" must be a string or a buffer")}function n(e){s.call(this),this._block=o.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}var o=i(2).Buffer,s=i(19).Transform;i(0)(n,s),n.prototype._transform=function(e,t,i){var r=null;try{this.update(e,t)}catch(e){r=e}i(r)},n.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},n.prototype.update=function(e,t){if(r(e,"Data"),this._finalized)throw new Error("Digest already called");o.isBuffer(e)||(e=o.from(e,t));for(var i=this._block,n=0;this._blockOffset+e.length-n>=this._blockSize;){for(var s=this._blockOffset;s<this._blockSize;)i[s++]=e[n++];this._update(),this._blockOffset=0}for(;n<e.length;)i[this._blockOffset++]=e[n++];for(var a=0,l=8*e.length;l>0;++a)this._length[a]+=l,(l=this._length[a]/4294967296|0)>0&&(this._length[a]-=4294967296*l);return this},n.prototype._update=function(){throw new Error("_update is not implemented")},n.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return t},n.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=n},function(e,t,i){function r(e,t,i){u.call(this),this._cache=new n,this._cipher=new f.AES(t),this._prev=h.from(i),this._mode=e,this._autopadding=!0}function n(){this.cache=h.allocUnsafe(0)}function o(e,t,i){var n=a[e.toLowerCase()];if(!n)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=h.from(t)),t.length!==n.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof i&&(i=h.from(i)),"GCM"!==n.mode&&i.length!==n.iv)throw new TypeError("invalid iv length "+i.length);return"stream"===n.type?new c(n.module,t,i):"auth"===n.type?new l(n.module,t,i):new r(n.module,t,i)}function s(e,t){var i=a[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var r=d(t,!1,i.key,i.iv);return o(e,r.key,r.iv)}var a=i(35),l=i(58),h=i(2).Buffer,c=i(59),u=i(9),f=i(23),d=i(22);i(0)(r,u),r.prototype._update=function(e){this._cache.add(e);for(var t,i,r=[];t=this._cache.get();)i=this._mode.encrypt(this,t),r.push(i);return h.concat(r)};var p=h.alloc(16,16);r.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(p))throw this._cipher.scrub(),new Error("data not multiple of block length")},r.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},n.prototype.add=function(e){this.cache=h.concat([this.cache,e])},n.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},n.prototype.flush=function(){for(var e=16-this.cache.length,t=h.allocUnsafe(e),i=-1;++i<e;)t.writeUInt8(e,i);return h.concat([this.cache,t])},t.createCipheriv=o,t.createCipher=s},function(e,t){t.encrypt=function(e,t){return e._cipher.encryptBlock(t)},t.decrypt=function(e,t){return e._cipher.decryptBlock(t)}},function(e,t,i){var r=i(15);t.encrypt=function(e,t){var i=r(t,e._prev);return e._prev=e._cipher.encryptBlock(i),e._prev},t.decrypt=function(e,t){var i=e._prev;e._prev=t;var n=e._cipher.decryptBlock(t);return r(n,i)}},function(e,t,i){function r(e,t,i){var r=t.length,s=o(t,e._cache);return e._cache=e._cache.slice(r),e._prev=n.concat([e._prev,i?t:s]),s}var n=i(2).Buffer,o=i(15);t.encrypt=function(e,t,i){for(var o,s=n.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=n.allocUnsafe(0)),!(e._cache.length<=t.length)){s=n.concat([s,r(e,t,i)]);break}o=e._cache.length,s=n.concat([s,r(e,t.slice(0,o),i)]),t=t.slice(o)}return s}},function(e,t,i){function r(e,t,i){var r=e._cipher.encryptBlock(e._prev),o=r[0]^t;return e._prev=n.concat([e._prev.slice(1),n.from([i?t:o])]),o}var n=i(2).Buffer;t.encrypt=function(e,t,i){for(var o=t.length,s=n.allocUnsafe(o),a=-1;++a<o;)s[a]=r(e,t[a],i);return s}},function(e,t,i){function r(e,t,i){for(var r,o,s,a=-1,l=0;++a<8;)r=e._cipher.encryptBlock(e._prev),o=t&1<<7-a?128:0,s=r[0]^o,l+=(128&s)>>a%8,e._prev=n(e._prev,i?o:s);return l}function n(e,t){var i=e.length,r=-1,n=o.allocUnsafe(e.length);for(e=o.concat([e,o.from([t])]);++r<i;)n[r]=e[r]<<1|e[r+1]>>7;return n}var o=i(2).Buffer;t.encrypt=function(e,t,i){for(var n=t.length,s=o.allocUnsafe(n),a=-1;++a<n;)s[a]=r(e,t[a],i);return s}},function(e,t,i){(function(e){function r(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}var n=i(15);t.encrypt=function(t,i){for(;t._cache.length<i.length;)t._cache=e.concat([t._cache,r(t)]);var o=t._cache.slice(0,i.length);return t._cache=t._cache.slice(i.length),n(i,o)}}).call(t,i(3).Buffer)},function(e,t,i){function r(e){return[e.readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)]}function n(e){var t=s.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function o(e){this.h=e,this.state=s.alloc(16,0),this.cache=s.allocUnsafe(0)}var s=i(2).Buffer,a=s.alloc(16,0);o.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},o.prototype._multiply=function(){for(var e,t,i,o=r(this.h),s=[0,0,0,0],a=-1;++a<128;){for(t=0!=(this.state[~~(a/8)]&1<<7-a%8),t&&(s[0]^=o[0],s[1]^=o[1],s[2]^=o[2],s[3]^=o[3]),i=0!=(1&o[3]),e=3;e>0;e--)o[e]=o[e]>>>1|(1&o[e-1])<<31;o[0]=o[0]>>>1,i&&(o[0]=o[0]^225<<24)}this.state=n(s)},o.prototype.update=function(e){this.cache=s.concat([this.cache,e]);for(var t;this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},o.prototype.final=function(e,t){return this.cache.length&&this.ghash(s.concat([this.cache,a],16)),this.ghash(n([0,e,0,t])),this.state},e.exports=o},function(e,t,i){function r(e,t,i){f.call(this),this._cache=new n,this._last=void 0,this._cipher=new d.AES(t),this._prev=h.from(i),this._mode=e,this._autopadding=!0}function n(){this.cache=h.allocUnsafe(0)}function o(e){for(var t=e[15],i=-1;++i<t;)if(e[i+(16-t)]!==t)throw new Error("unable to decrypt data");if(16!==t)return e.slice(0,16-t)}function s(e,t,i){var n=c[e.toLowerCase()];if(!n)throw new TypeError("invalid suite type");if("string"==typeof i&&(i=h.from(i)),"GCM"!==n.mode&&i.length!==n.iv)throw new TypeError("invalid iv length "+i.length);if("string"==typeof t&&(t=h.from(t)),t.length!==n.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===n.type?new u(n.module,t,i,!0):"auth"===n.type?new l(n.module,t,i,!0):new r(n.module,t,i)}function a(e,t){var i=c[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var r=p(t,!1,i.key,i.iv);return s(e,r.key,r.iv)}var l=i(58),h=i(2).Buffer,c=i(35),u=i(59),f=i(9),d=i(23),p=i(22);i(0)(r,f),r.prototype._update=function(e){this._cache.add(e);for(var t,i,r=[];t=this._cache.get(this._autopadding);)i=this._mode.decrypt(this,t),r.push(i);return h.concat(r)},r.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return o(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},r.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},n.prototype.add=function(e){this.cache=h.concat([this.cache,e])},n.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},n.prototype.flush=function(){if(this.cache.length)return this.cache},t.createDecipher=a,t.createDecipheriv=s},function(e,t,i){(function(t){function r(e){n.call(this);var i,r=e.mode.toLowerCase(),o=a[r];i=e.decrypt?"decrypt":"encrypt";var s=e.key;"des-ede"!==r&&"des-ede-cbc"!==r||(s=t.concat([s,s.slice(0,8)]));var l=e.iv;this._des=o.create({key:s,iv:l,type:i})}var n=i(9),o=i(36),s=i(0),a={"des-ede3-cbc":o.CBC.instantiate(o.EDE),"des-ede3":o.EDE,"des-ede-cbc":o.CBC.instantiate(o.EDE),"des-ede":o.EDE,"des-cbc":o.CBC.instantiate(o.DES),"des-ecb":o.DES};a.des=a["des-cbc"],a.des3=a["des-ede3-cbc"],e.exports=r,s(r,n),r.prototype._update=function(e){return new t(this._des.update(e))},r.prototype._final=function(){return new t(this._des.final())}}).call(t,i(3).Buffer)},function(e,t,i){"use strict";t.readUInt32BE=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},t.writeUInt32BE=function(e,t,i){e[0+i]=t>>>24,e[1+i]=t>>>16&255,e[2+i]=t>>>8&255,e[3+i]=255&t},t.ip=function(e,t,i,r){for(var n=0,o=0,s=6;s>=0;s-=2){for(var a=0;a<=24;a+=8)n<<=1,n|=t>>>a+s&1;for(var a=0;a<=24;a+=8)n<<=1,n|=e>>>a+s&1}for(var s=6;s>=0;s-=2){for(var a=1;a<=25;a+=8)o<<=1,o|=t>>>a+s&1;for(var a=1;a<=25;a+=8)o<<=1,o|=e>>>a+s&1}i[r+0]=n>>>0,i[r+1]=o>>>0},t.rip=function(e,t,i,r){for(var n=0,o=0,s=0;s<4;s++)for(var a=24;a>=0;a-=8)n<<=1,n|=t>>>a+s&1,n<<=1,n|=e>>>a+s&1;for(var s=4;s<8;s++)for(var a=24;a>=0;a-=8)o<<=1,o|=t>>>a+s&1,o<<=1,o|=e>>>a+s&1;i[r+0]=n>>>0,i[r+1]=o>>>0},t.pc1=function(e,t,i,r){for(var n=0,o=0,s=7;s>=5;s--){for(var a=0;a<=24;a+=8)n<<=1,n|=t>>a+s&1;for(var a=0;a<=24;a+=8)n<<=1,n|=e>>a+s&1}for(var a=0;a<=24;a+=8)n<<=1,n|=t>>a+s&1;for(var s=1;s<=3;s++){for(var a=0;a<=24;a+=8)o<<=1,o|=t>>a+s&1;for(var a=0;a<=24;a+=8)o<<=1,o|=e>>a+s&1}for(var a=0;a<=24;a+=8)o<<=1,o|=e>>a+s&1;i[r+0]=n>>>0,i[r+1]=o>>>0},t.r28shl=function(e,t){return e<<t&268435455|e>>>28-t};var r=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];t.pc2=function(e,t,i,n){for(var o=0,s=0,a=r.length>>>1,l=0;l<a;l++)o<<=1,o|=e>>>r[l]&1;for(var l=a;l<r.length;l++)s<<=1,s|=t>>>r[l]&1;i[n+0]=o>>>0,i[n+1]=s>>>0},t.expand=function(e,t,i){var r=0,n=0;r=(1&e)<<5|e>>>27;for(var o=23;o>=15;o-=4)r<<=6,r|=e>>>o&63;for(var o=11;o>=3;o-=4)n|=e>>>o&63,n<<=6;n|=(31&e)<<1|e>>>31,t[i+0]=r>>>0,t[i+1]=n>>>0};var n=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];t.substitute=function(e,t){for(var i=0,r=0;r<4;r++){var o=e>>>18-6*r&63,s=n[64*r+o];i<<=4,i|=s}for(var r=0;r<4;r++){var o=t>>>18-6*r&63,s=n[256+64*r+o];i<<=4,i|=s}return i>>>0};var o=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];t.permute=function(e){for(var t=0,i=0;i<o.length;i++)t<<=1,t|=e>>>o[i]&1;return t>>>0},t.padSplit=function(e,t,i){for(var r=e.toString(2);r.length<t;)r="0"+r;for(var n=[],o=0;o<t;o+=i)n.push(r.slice(o,o+i));return n.join(" ")}},function(e,t,i){"use strict";function r(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}var n=i(6);e.exports=r,r.prototype._init=function(){},r.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},r.prototype._buffer=function(e,t){for(var i=Math.min(this.buffer.length-this.bufferOff,e.length-t),r=0;r<i;r++)this.buffer[this.bufferOff+r]=e[t+r];return this.bufferOff+=i,i},r.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},r.prototype._updateEncrypt=function(e){var t=0,i=0,r=(this.bufferOff+e.length)/this.blockSize|0,n=new Array(r*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(i+=this._flushBuffer(n,i)));for(var o=e.length-(e.length-t)%this.blockSize;t<o;t+=this.blockSize)this._update(e,t,n,i),i+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return n},r.prototype._updateDecrypt=function(e){for(var t=0,i=0,r=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,n=new Array(r*this.blockSize);r>0;r--)t+=this._buffer(e,t),i+=this._flushBuffer(n,i);return t+=this._buffer(e,t),n},r.prototype.final=function(e){var t;e&&(t=this.update(e));var i;return i="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(i):i},r.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},r.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},r.prototype._unpad=function(e){return e},r.prototype._finalDecrypt=function(){n.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}},function(e,t,i){"use strict";function r(){this.tmp=new Array(2),this.keys=null}function n(e){h.call(this,e);var t=new r;this._desState=t,this.deriveKeys(t,e.key)}var o=i(6),s=i(0),a=i(36),l=a.utils,h=a.Cipher;s(n,h),e.exports=n,n.create=function(e){return new n(e)};var c=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];n.prototype.deriveKeys=function(e,t){e.keys=new Array(32),o.equal(t.length,this.blockSize,"Invalid key length");var i=l.readUInt32BE(t,0),r=l.readUInt32BE(t,4);l.pc1(i,r,e.tmp,0),i=e.tmp[0],r=e.tmp[1];for(var n=0;n<e.keys.length;n+=2){var s=c[n>>>1];i=l.r28shl(i,s),r=l.r28shl(r,s),l.pc2(i,r,e.keys,n)}},n.prototype._update=function(e,t,i,r){var n=this._desState,o=l.readUInt32BE(e,t),s=l.readUInt32BE(e,t+4);l.ip(o,s,n.tmp,0),o=n.tmp[0],s=n.tmp[1],"encrypt"===this.type?this._encrypt(n,o,s,n.tmp,0):this._decrypt(n,o,s,n.tmp,0),o=n.tmp[0],s=n.tmp[1],l.writeUInt32BE(i,o,r),l.writeUInt32BE(i,s,r+4)},n.prototype._pad=function(e,t){for(var i=e.length-t,r=t;r<e.length;r++)e[r]=i;return!0},n.prototype._unpad=function(e){for(var t=e[e.length-1],i=e.length-t;i<e.length;i++)o.equal(e[i],t);return e.slice(0,e.length-t)},n.prototype._encrypt=function(e,t,i,r,n){for(var o=t,s=i,a=0;a<e.keys.length;a+=2){var h=e.keys[a],c=e.keys[a+1];l.expand(s,e.tmp,0),h^=e.tmp[0],c^=e.tmp[1];var u=l.substitute(h,c),f=l.permute(u),d=s;s=(o^f)>>>0,o=d}l.rip(s,o,r,n)},n.prototype._decrypt=function(e,t,i,r,n){for(var o=i,s=t,a=e.keys.length-2;a>=0;a-=2){var h=e.keys[a],c=e.keys[a+1];l.expand(o,e.tmp,0),h^=e.tmp[0],c^=e.tmp[1];var u=l.substitute(h,c),f=l.permute(u),d=o;o=(s^f)>>>0,s=d}l.rip(o,s,r,n)}},function(e,t,i){"use strict";function r(e){o.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}function n(e){function t(t){e.call(this,t),this._cbcInit()}s(t,e);for(var i=Object.keys(a),r=0;r<i.length;r++){var n=i[r];t.prototype[n]=a[n]}return t.create=function(e){return new t(e)},t}var o=i(6),s=i(0),a={};t.instantiate=n,a._cbcInit=function(){var e=new r(this.options.iv);this._cbcState=e},a._update=function(e,t,i,r){var n=this._cbcState,o=this.constructor.super_.prototype,s=n.iv;if("encrypt"===this.type){for(var a=0;a<this.blockSize;a++)s[a]^=e[t+a];o._update.call(this,s,0,i,r);for(var a=0;a<this.blockSize;a++)s[a]=i[r+a]}else{o._update.call(this,e,t,i,r);for(var a=0;a<this.blockSize;a++)i[r+a]^=s[a];for(var a=0;a<this.blockSize;a++)s[a]=e[t+a]}}},function(e,t,i){"use strict";function r(e,t){o.equal(t.length,24,"Invalid key length");var i=t.slice(0,8),r=t.slice(8,16),n=t.slice(16,24);this.ciphers="encrypt"===e?[h.create({type:"encrypt",key:i}),h.create({type:"decrypt",key:r}),h.create({type:"encrypt",key:n})]:[h.create({type:"decrypt",key:n}),h.create({type:"encrypt",key:r}),h.create({type:"decrypt",key:i})]}function n(e){l.call(this,e);var t=new r(this.type,this.options.key);this._edeState=t}var o=i(6),s=i(0),a=i(36),l=a.Cipher,h=a.DES;s(n,l),e.exports=n,n.create=function(e){return new n(e)},n.prototype._update=function(e,t,i,r){var n=this._edeState;n.ciphers[0]._update(e,t,i,r),n.ciphers[1]._update(i,r,i,r),n.ciphers[2]._update(i,r,i,r)},n.prototype._pad=h.prototype._pad,n.prototype._unpad=h.prototype._unpad},function(e,t){t["des-ecb"]={key:8,iv:0},t["des-cbc"]=t.des={key:8,iv:8},t["des-ede3-cbc"]=t.des3={key:24,iv:8},t["des-ede3"]={key:24,iv:0},t["des-ede-cbc"]={key:16,iv:8},t["des-ede"]={key:16,iv:0}},function(e,t,i){(function(e){function r(t){var i=new e(s[t].prime,"hex"),r=new e(s[t].gen,"hex");return new a(i,r)}function n(t,i,r,s){return e.isBuffer(i)||void 0===l[i]?n(t,"binary",i,r):(i=i||"binary",s=s||"binary",r=r||new e([2]),e.isBuffer(r)||(r=new e(r,s)),"number"==typeof t?new a(o(t,r),r,!0):(e.isBuffer(t)||(t=new e(t,i)),new a(t,r,!0)))}var o=i(60),s=i(126),a=i(127),l={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=r,t.createDiffieHellman=t.DiffieHellman=n}).call(t,i(3).Buffer)},function(e,t){},function(e,t){},function(e,t){e.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},function(e,t,i){(function(t){function r(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._pub=new l(e),this}function n(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._priv=new l(e),this}function o(e,t){var i=t.toString("hex"),r=[i,e.toString(16)].join("_");if(r in y)return y[r];var n=0;if(e.isEven()||!g.simpleSieve||!g.fermatTest(e)||!c.test(e))return n+=1,n+="02"===i||"05"===i?8:4,y[r]=n,n;c.test(e.shrn(1))||(n+=2);var o;switch(i){case"02":e.mod(u).cmp(f)&&(n+=8);break;case"05":o=e.mod(d),o.cmp(p)&&o.cmp(m)&&(n+=8);break;default:n+=4}return y[r]=n,n}function s(e,t,i){this.setGenerator(t),this.__prime=new l(e),this._prime=l.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,i?(this.setPublicKey=r,this.setPrivateKey=n):this._primeCode=8}function a(e,i){var r=new t(e.toArray());return i?r.toString(i):r}var l=i(4),h=i(62),c=new h,u=new l(24),f=new l(11),d=new l(10),p=new l(3),m=new l(7),g=i(60),v=i(11);e.exports=s;var y={};Object.defineProperty(s.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=o(this.__prime,this.__gen)),this._primeCode}}),s.prototype.generateKeys=function(){return this._priv||(this._priv=new l(v(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},s.prototype.computeSecret=function(e){e=new l(e),e=e.toRed(this._prime);var i=e.redPow(this._priv).fromRed(),r=new t(i.toArray()),n=this.getPrime();if(r.length<n.length){var o=new t(n.length-r.length);o.fill(0),r=t.concat([o,r])}return r},s.prototype.getPublicKey=function(e){return a(this._pub,e)},s.prototype.getPrivateKey=function(e){return a(this._priv,e)},s.prototype.getPrime=function(e){return a(this.__prime,e)},s.prototype.getGenerator=function(e){return a(this._gen,e)},s.prototype.setGenerator=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.__gen=e,this._gen=new l(e),this}}).call(t,i(3).Buffer)},function(e,t,i){(function(t){function r(e){l.Writable.call(this);var t=f[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=a(t.hash),this._tag=t.id,this._signType=t.sign}function n(e){l.Writable.call(this);var t=f[e];if(!t)throw new Error("Unknown message digest");this._hash=a(t.hash),this._tag=t.id,this._signType=t.sign}function o(e){return new r(e)}function s(e){return new n(e)}var a=i(13),l=i(19),h=i(0),c=i(129),u=i(165),f=i(50);Object.keys(f).forEach(function(e){f[e].id=new t(f[e].id,"hex"),f[e.toLowerCase()]=f[e]}),h(r,l.Writable),r.prototype._write=function(e,t,i){this._hash.update(e),i()},r.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},r.prototype.sign=function(e,t){this.end();var i=this._hash.digest(),r=c(i,e,this._hashType,this._signType,this._tag);return t?r.toString(t):r},h(n,l.Writable),n.prototype._write=function(e,t,i){this._hash.update(e),i()},n.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},n.prototype.verify=function(e,i,r){"string"==typeof i&&(i=new t(i,r)),this.end();var n=this._hash.digest();return u(i,n,e,this._signType,this._tag)},e.exports={Sign:o,Verify:s,createSign:o,createVerify:s}}).call(t,i(3).Buffer)},function(e,t,i){(function(t){function r(e,i,r,s,a){var l=g(i);if(l.curve){if("ecdsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong private key type");return n(e,l)}if("dsa"===l.type){if("dsa"!==s)throw new Error("wrong private key type");return o(e,l,r)}if("rsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong private key type");e=t.concat([a,e]);for(var h=l.modulus.byteLength(),c=[0,1];e.length+c.length+1<h;)c.push(255);c.push(0);for(var u=-1;++u<e.length;)c.push(e[u]);return d(c,l)}function n(e,i){var r=v[i.curve.join(".")];if(!r)throw new Error("unknown curve "+i.curve.join("."));var n=new p(r),o=n.keyFromPrivate(i.privateKey),s=o.sign(e);return new t(s.toDER())}function o(e,t,i){for(var r,n=t.params.priv_key,o=t.params.p,h=t.params.q,f=t.params.g,d=new m(0),p=l(e,h).mod(h),g=!1,v=a(n,h,e,i);!1===g;)r=c(h,v,i),d=u(f,r,o,h),g=r.invm(h).imul(p.add(n.mul(d))).mod(h),0===g.cmpn(0)&&(g=!1,d=new m(0));return s(d,g)}function s(e,i){e=e.toArray(),i=i.toArray(),128&e[0]&&(e=[0].concat(e)),128&i[0]&&(i=[0].concat(i));var r=e.length+i.length+4,n=[48,r,2,e.length];return n=n.concat(e,[2,i.length],i),new t(n)}function a(e,i,r,n){if(e=new t(e.toArray()),e.length<i.byteLength()){var o=new t(i.byteLength()-e.length);o.fill(0),e=t.concat([o,e])}var s=r.length,a=h(r,i),l=new t(s);l.fill(1);var c=new t(s);return c.fill(0),c=f(n,c).update(l).update(new t([0])).update(e).update(a).digest(),l=f(n,c).update(l).digest(),c=f(n,c).update(l).update(new t([1])).update(e).update(a).digest(),l=f(n,c).update(l).digest(),{k:c,v:l}}function l(e,t){var i=new m(e),r=(e.length<<3)-t.bitLength();return r>0&&i.ishrn(r),i}function h(e,i){e=l(e,i),e=e.mod(i);var r=new t(e.toArray());if(r.length<i.byteLength()){var n=new t(i.byteLength()-r.length);n.fill(0),r=t.concat([n,r])}return r}function c(e,i,r){var n,o;do{for(n=new t(0);8*n.length<e.bitLength();)i.v=f(r,i.k).update(i.v).digest(),n=t.concat([n,i.v]);o=l(n,e),i.k=f(r,i.k).update(i.v).update(new t([0])).digest(),i.v=f(r,i.k).update(i.v).digest()}while(-1!==o.cmp(e));return o}function u(e,t,i,r){return e.toRed(m.mont(i)).redPow(t).fromRed().mod(r)}var f=i(49),d=i(37),p=i(5).ec,m=i(4),g=i(25),v=i(72);e.exports=r,e.exports.getKey=a,e.exports.makeKey=c}).call(t,i(3).Buffer)},function(e,t){e.exports={_args:[["elliptic@6.4.0","/Users/nobook-mac-001/Desktop/science/science-combine/src/science-new"]],_from:"elliptic@6.4.0",_id:"elliptic@6.4.0",_inBundle:!1,_integrity:"sha1-ysmvh2LIWDYYcAPI3+GT5eLq5d8=",_location:"/elliptic",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"elliptic@6.4.0",name:"elliptic",escapedName:"elliptic",rawSpec:"6.4.0",saveSpec:null,fetchSpec:"6.4.0"},_requiredBy:["/browserify-sign","/create-ecdh"],_resolved:"http://registry.npm.taobao.org/elliptic/download/elliptic-6.4.0.tgz",_spec:"6.4.0",_where:"/Users/nobook-mac-001/Desktop/science/science-combine/src/science-new",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0",inherits:"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^2.11.3",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2",istanbul:"^0.4.2",jscs:"^2.9.0",jshint:"^2.6.0",mocha:"^2.1.0"},files:["lib"],homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",name:"elliptic",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.4.0"}},function(e,t,i){"use strict";function r(e,t){for(var i=[],r=1<<t+1,n=e.clone();n.cmpn(1)>=0;){var o;if(n.isOdd()){var s=n.andln(r-1);o=s>(r>>1)-1?(r>>1)-s:s,n.isubn(o)}else o=0;i.push(o);for(var a=0!==n.cmpn(0)&&0===n.andln(r-1)?t+1:1,l=1;l<a;l++)i.push(0);n.iushrn(a)}return i}function n(e,t){var i=[[],[]];e=e.clone(),t=t.clone();for(var r=0,n=0;e.cmpn(-r)>0||t.cmpn(-n)>0;){var o=e.andln(3)+r&3,s=t.andln(3)+n&3;3===o&&(o=-1),3===s&&(s=-1);var a;if(0==(1&o))a=0;else{var l=e.andln(7)+r&7;a=3!==l&&5!==l||2!==s?o:-o}i[0].push(a);var h;if(0==(1&s))h=0;else{var l=t.andln(7)+n&7;h=3!==l&&5!==l||2!==o?s:-s}i[1].push(h),2*r===a+1&&(r=1-r),2*n===h+1&&(n=1-n),e.iushrn(1),t.iushrn(1)}return i}function o(e,t,i){var r="_"+t;e.prototype[t]=function(){return void 0!==this[r]?this[r]:this[r]=i.call(this)}}function s(e){return"string"==typeof e?l.toArray(e,"hex"):e}function a(e){return new h(e,"hex","le")}var l=t,h=i(4),c=i(6),u=i(64);l.assert=c,l.toArray=u.toArray,l.zero2=u.zero2,l.toHex=u.toHex,l.encode=u.encode,l.getNAF=r,l.getJSF=n,l.cachedProperty=o,l.parseBytes=s,l.intFromLE=a},function(e,t,i){"use strict";function r(e,t){this.type=e,this.p=new o(t.p,16),this.red=t.prime?o.red(t.prime):o.mont(this.p),this.zero=new o(0).toRed(this.red),this.one=new o(1).toRed(this.red),this.two=new o(2).toRed(this.red),this.n=t.n&&new o(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4);var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function n(e,t){this.curve=e,this.type=t,this.precomputed=null}var o=i(4),s=i(5),a=s.utils,l=a.getNAF,h=a.getJSF,c=a.assert;e.exports=r,r.prototype.point=function(){throw new Error("Not implemented")},r.prototype.validate=function(){throw new Error("Not implemented")},r.prototype._fixedNafMul=function(e,t){c(e.precomputed);var i=e._getDoubles(),r=l(t,1),n=(1<<i.step+1)-(i.step%2==0?2:1);n/=3;for(var o=[],s=0;s<r.length;s+=i.step){for(var a=0,t=s+i.step-1;t>=s;t--)a=(a<<1)+r[t];o.push(a)}for(var h=this.jpoint(null,null,null),u=this.jpoint(null,null,null),f=n;f>0;f--){for(var s=0;s<o.length;s++){var a=o[s];a===f?u=u.mixedAdd(i.points[s]):a===-f&&(u=u.mixedAdd(i.points[s].neg()))}h=h.add(u)}return h.toP()},r.prototype._wnafMul=function(e,t){var i=4,r=e._getNAFPoints(i);i=r.wnd;for(var n=r.points,o=l(t,i),s=this.jpoint(null,null,null),a=o.length-1;a>=0;a--){for(var t=0;a>=0&&0===o[a];a--)t++;if(a>=0&&t++,s=s.dblp(t),a<0)break;var h=o[a];c(0!==h),s="affine"===e.type?h>0?s.mixedAdd(n[h-1>>1]):s.mixedAdd(n[-h-1>>1].neg()):h>0?s.add(n[h-1>>1]):s.add(n[-h-1>>1].neg())}return"affine"===e.type?s.toP():s},r.prototype._wnafMulAdd=function(e,t,i,r,n){for(var o=this._wnafT1,s=this._wnafT2,a=this._wnafT3,c=0,u=0;u<r;u++){var f=t[u],d=f._getNAFPoints(e);o[u]=d.wnd,s[u]=d.points}for(var u=r-1;u>=1;u-=2){var p=u-1,m=u;if(1===o[p]&&1===o[m]){var g=[t[p],null,null,t[m]];0===t[p].y.cmp(t[m].y)?(g[1]=t[p].add(t[m]),g[2]=t[p].toJ().mixedAdd(t[m].neg())):0===t[p].y.cmp(t[m].y.redNeg())?(g[1]=t[p].toJ().mixedAdd(t[m]),g[2]=t[p].add(t[m].neg())):(g[1]=t[p].toJ().mixedAdd(t[m]),g[2]=t[p].toJ().mixedAdd(t[m].neg()));var v=[-3,-1,-5,-7,0,7,5,1,3],y=h(i[p],i[m]);c=Math.max(y[0].length,c),a[p]=new Array(c),a[m]=new Array(c);for(var _=0;_<c;_++){var b=0|y[0][_],x=0|y[1][_];a[p][_]=v[3*(b+1)+(x+1)],a[m][_]=0,s[p]=g}}else a[p]=l(i[p],o[p]),a[m]=l(i[m],o[m]),c=Math.max(a[p].length,c),c=Math.max(a[m].length,c)}for(var T=this.jpoint(null,null,null),E=this._wnafT4,u=c;u>=0;u--){for(var S=0;u>=0;){for(var w=!0,_=0;_<r;_++)E[_]=0|a[_][u],0!==E[_]&&(w=!1);if(!w)break;S++,u--}if(u>=0&&S++,T=T.dblp(S),u<0)break;for(var _=0;_<r;_++){var f,M=E[_];0!==M&&(M>0?f=s[_][M-1>>1]:M<0&&(f=s[_][-M-1>>1].neg()),T="affine"===f.type?T.mixedAdd(f):T.add(f))}}for(var u=0;u<r;u++)s[u]=null;return n?T:T.toP()},r.BasePoint=n,n.prototype.eq=function(){throw new Error("Not implemented")},n.prototype.validate=function(){return this.curve.validate(this)},r.prototype.decodePoint=function(e,t){e=a.toArray(e,t);var i=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*i){6===e[0]?c(e[e.length-1]%2==0):7===e[0]&&c(e[e.length-1]%2==1);return this.point(e.slice(1,1+i),e.slice(1+i,1+2*i))}if((2===e[0]||3===e[0])&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),3===e[0]);throw new Error("Unknown point format")},n.prototype.encodeCompressed=function(e){return this.encode(e,!0)},n.prototype._encode=function(e){var t=this.curve.p.byteLength(),i=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",t))},n.prototype.encode=function(e,t){return a.encode(this._encode(t),e)},n.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},n.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},n.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],r=this,n=0;n<t;n+=e){for(var o=0;o<e;o++)r=r.dbl();i.push(r)}return{step:e,points:i}},n.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],i=(1<<e)-1,r=1===i?null:this.dbl(),n=1;n<i;n++)t[n]=t[n-1].add(r);return{wnd:e,points:t}},n.prototype._getBeta=function(){return null},n.prototype.dblp=function(e){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}},function(e,t,i){"use strict";function r(e){c.call(this,"short",e),this.a=new l(e.a,16).toRed(this.red),this.b=new l(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function n(e,t,i,r){c.BasePoint.call(this,e,"affine"),null===t&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new l(t,16),this.y=new l(i,16),r&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function o(e,t,i,r){c.BasePoint.call(this,e,"jacobian"),null===t&&null===i&&null===r?(this.x=this.curve.one,this.y=this.curve.one,this.z=new l(0)):(this.x=new l(t,16),this.y=new l(i,16),this.z=new l(r,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}var s=i(24),a=i(5),l=i(4),h=i(0),c=s.base,u=a.utils.assert;h(r,c),e.exports=r,r.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,i;if(e.beta)t=new l(e.beta,16).toRed(this.red);else{var r=this._getEndoRoots(this.p);t=r[0].cmp(r[1])<0?r[0]:r[1],t=t.toRed(this.red)}if(e.lambda)i=new l(e.lambda,16);else{var n=this._getEndoRoots(this.n);0===this.g.mul(n[0]).x.cmp(this.g.x.redMul(t))?i=n[0]:(i=n[1],u(0===this.g.mul(i).x.cmp(this.g.x.redMul(t))))}var o;return o=e.basis?e.basis.map(function(e){return{a:new l(e.a,16),b:new l(e.b,16)}}):this._getEndoBasis(i),{beta:t,lambda:i,basis:o}}},r.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:l.mont(e),i=new l(2).toRed(t).redInvm(),r=i.redNeg(),n=new l(3).toRed(t).redNeg().redSqrt().redMul(i);return[r.redAdd(n).fromRed(),r.redSub(n).fromRed()]},r.prototype._getEndoBasis=function(e){for(var t,i,r,n,o,s,a,h,c,u=this.n.ushrn(Math.floor(this.n.bitLength()/2)),f=e,d=this.n.clone(),p=new l(1),m=new l(0),g=new l(0),v=new l(1),y=0;0!==f.cmpn(0);){var _=d.div(f);h=d.sub(_.mul(f)),c=g.sub(_.mul(p));var b=v.sub(_.mul(m));if(!r&&h.cmp(u)<0)t=a.neg(),i=p,r=h.neg(),n=c;else if(r&&2==++y)break;a=h,d=f,f=h,g=p,p=c,v=m,m=b}o=h.neg(),s=c;var x=r.sqr().add(n.sqr());return o.sqr().add(s.sqr()).cmp(x)>=0&&(o=t,s=i),r.negative&&(r=r.neg(),n=n.neg()),o.negative&&(o=o.neg(),s=s.neg()),[{a:r,b:n},{a:o,b:s}]},r.prototype._endoSplit=function(e){var t=this.endo.basis,i=t[0],r=t[1],n=r.b.mul(e).divRound(this.n),o=i.b.neg().mul(e).divRound(this.n),s=n.mul(i.a),a=o.mul(r.a),l=n.mul(i.b),h=o.mul(r.b);return{k1:e.sub(s).sub(a),k2:l.add(h).neg()}},r.prototype.pointFromX=function(e,t){e=new l(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),r=i.redSqrt();if(0!==r.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var n=r.fromRed().isOdd();return(t&&!n||!t&&n)&&(r=r.redNeg()),this.point(e,r)},r.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,i=e.y,r=this.a.redMul(t),n=t.redSqr().redMul(t).redIAdd(r).redIAdd(this.b);return 0===i.redSqr().redISub(n).cmpn(0)},r.prototype._endoWnafMulAdd=function(e,t,i){for(var r=this._endoWnafT1,n=this._endoWnafT2,o=0;o<e.length;o++){var s=this._endoSplit(t[o]),a=e[o],l=a._getBeta();s.k1.negative&&(s.k1.ineg(),a=a.neg(!0)),s.k2.negative&&(s.k2.ineg(),l=l.neg(!0)),r[2*o]=a,r[2*o+1]=l,n[2*o]=s.k1,n[2*o+1]=s.k2}for(var h=this._wnafMulAdd(1,r,n,2*o,i),c=0;c<2*o;c++)r[c]=null,n[c]=null;return h},h(n,c.BasePoint),r.prototype.point=function(e,t,i){return new n(this,e,t,i)},r.prototype.pointFromJSON=function(e,t){return n.fromJSON(this,e,t)},n.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,r=function(e){return i.point(e.x.redMul(i.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(r)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(r)}}}return t}},n.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},n.fromJSON=function(e,t,i){function r(t){return e.point(t[0],t[1],i)}"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],i);if(!t[2])return n;var o=t[2];return n.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[n].concat(o.doubles.points.map(r))},naf:o.naf&&{wnd:o.naf.wnd,points:[n].concat(o.naf.points.map(r))}},n},n.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},n.prototype.isInfinity=function(){return this.inf},n.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var i=t.redSqr().redISub(this.x).redISub(e.x),r=t.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,r)},n.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,i=this.x.redSqr(),r=e.redInvm(),n=i.redAdd(i).redIAdd(i).redIAdd(t).redMul(r),o=n.redSqr().redISub(this.x.redAdd(this.x)),s=n.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,s)},n.prototype.getX=function(){return this.x.fromRed()},n.prototype.getY=function(){return this.y.fromRed()},n.prototype.mul=function(e){return e=new l(e,16),this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},n.prototype.mulAdd=function(e,t,i){var r=[this,t],n=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(r,n):this.curve._wnafMulAdd(1,r,n,2)},n.prototype.jmulAdd=function(e,t,i){var r=[this,t],n=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(r,n,!0):this.curve._wnafMulAdd(1,r,n,2,!0)},n.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},n.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,r=function(e){return e.neg()};t.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(r)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(r)}}}return t},n.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},h(o,c.BasePoint),r.prototype.jpoint=function(e,t,i){return new o(this,e,t,i)},o.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),i=this.x.redMul(t),r=this.y.redMul(t).redMul(e);return this.curve.point(i,r)},o.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},o.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),i=this.z.redSqr(),r=this.x.redMul(t),n=e.x.redMul(i),o=this.y.redMul(t.redMul(e.z)),s=e.y.redMul(i.redMul(this.z)),a=r.redSub(n),l=o.redSub(s);if(0===a.cmpn(0))return 0!==l.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=a.redSqr(),c=h.redMul(a),u=r.redMul(h),f=l.redSqr().redIAdd(c).redISub(u).redISub(u),d=l.redMul(u.redISub(f)).redISub(o.redMul(c)),p=this.z.redMul(e.z).redMul(a);return this.curve.jpoint(f,d,p)},o.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),i=this.x,r=e.x.redMul(t),n=this.y,o=e.y.redMul(t).redMul(this.z),s=i.redSub(r),a=n.redSub(o);if(0===s.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var l=s.redSqr(),h=l.redMul(s),c=i.redMul(l),u=a.redSqr().redIAdd(h).redISub(c).redISub(c),f=a.redMul(c.redISub(u)).redISub(n.redMul(h)),d=this.z.redMul(s);return this.curve.jpoint(u,f,d)},o.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}for(var r=this.curve.a,n=this.curve.tinv,o=this.x,s=this.y,a=this.z,l=a.redSqr().redSqr(),h=s.redAdd(s),i=0;i<e;i++){var c=o.redSqr(),u=h.redSqr(),f=u.redSqr(),d=c.redAdd(c).redIAdd(c).redIAdd(r.redMul(l)),p=o.redMul(u),m=d.redSqr().redISub(p.redAdd(p)),g=p.redISub(m),v=d.redMul(g);v=v.redIAdd(v).redISub(f);var y=h.redMul(a);i+1<e&&(l=l.redMul(f)),o=m,a=y,h=v}return this.curve.jpoint(o,h.redMul(n),a)},o.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},o.prototype._zeroDbl=function(){var e,t,i;if(this.zOne){var r=this.x.redSqr(),n=this.y.redSqr(),o=n.redSqr(),s=this.x.redAdd(n).redSqr().redISub(r).redISub(o);s=s.redIAdd(s);var a=r.redAdd(r).redIAdd(r),l=a.redSqr().redISub(s).redISub(s),h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),e=l,t=a.redMul(s.redISub(l)).redISub(h),i=this.y.redAdd(this.y)}else{var c=this.x.redSqr(),u=this.y.redSqr(),f=u.redSqr(),d=this.x.redAdd(u).redSqr().redISub(c).redISub(f);d=d.redIAdd(d);var p=c.redAdd(c).redIAdd(c),m=p.redSqr(),g=f.redIAdd(f);g=g.redIAdd(g),g=g.redIAdd(g),e=m.redISub(d).redISub(d),t=p.redMul(d.redISub(e)).redISub(g),i=this.y.redMul(this.z),i=i.redIAdd(i)}return this.curve.jpoint(e,t,i)},o.prototype._threeDbl=function(){var e,t,i;if(this.zOne){var r=this.x.redSqr(),n=this.y.redSqr(),o=n.redSqr(),s=this.x.redAdd(n).redSqr().redISub(r).redISub(o);s=s.redIAdd(s);var a=r.redAdd(r).redIAdd(r).redIAdd(this.curve.a),l=a.redSqr().redISub(s).redISub(s);e=l;var h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),t=a.redMul(s.redISub(l)).redISub(h),i=this.y.redAdd(this.y)}else{var c=this.z.redSqr(),u=this.y.redSqr(),f=this.x.redMul(u),d=this.x.redSub(c).redMul(this.x.redAdd(c));d=d.redAdd(d).redIAdd(d);var p=f.redIAdd(f);p=p.redIAdd(p);var m=p.redAdd(p);e=d.redSqr().redISub(m),i=this.y.redAdd(this.z).redSqr().redISub(u).redISub(c);var g=u.redSqr();g=g.redIAdd(g),g=g.redIAdd(g),g=g.redIAdd(g),t=d.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,i)},o.prototype._dbl=function(){var e=this.curve.a,t=this.x,i=this.y,r=this.z,n=r.redSqr().redSqr(),o=t.redSqr(),s=i.redSqr(),a=o.redAdd(o).redIAdd(o).redIAdd(e.redMul(n)),l=t.redAdd(t);l=l.redIAdd(l);var h=l.redMul(s),c=a.redSqr().redISub(h.redAdd(h)),u=h.redISub(c),f=s.redSqr();f=f.redIAdd(f),f=f.redIAdd(f),f=f.redIAdd(f);var d=a.redMul(u).redISub(f),p=i.redAdd(i).redMul(r);return this.curve.jpoint(c,d,p)},o.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr(),r=t.redSqr(),n=e.redAdd(e).redIAdd(e),o=n.redSqr(),s=this.x.redAdd(t).redSqr().redISub(e).redISub(r);s=s.redIAdd(s),s=s.redAdd(s).redIAdd(s),s=s.redISub(o);var a=s.redSqr(),l=r.redIAdd(r);l=l.redIAdd(l),l=l.redIAdd(l),l=l.redIAdd(l);var h=n.redIAdd(s).redSqr().redISub(o).redISub(a).redISub(l),c=t.redMul(h);c=c.redIAdd(c),c=c.redIAdd(c);var u=this.x.redMul(a).redISub(c);u=u.redIAdd(u),u=u.redIAdd(u);var f=this.y.redMul(h.redMul(l.redISub(h)).redISub(s.redMul(a)));f=f.redIAdd(f),f=f.redIAdd(f),f=f.redIAdd(f);var d=this.z.redAdd(s).redSqr().redISub(i).redISub(a);return this.curve.jpoint(u,f,d)},o.prototype.mul=function(e,t){return e=new l(e,t),this.curve._wnafMul(this,e)},o.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),i=e.z.redSqr();if(0!==this.x.redMul(i).redISub(e.x.redMul(t)).cmpn(0))return!1;var r=t.redMul(this.z),n=i.redMul(e.z);return 0===this.y.redMul(n).redISub(e.y.redMul(r)).cmpn(0)},o.prototype.eqXToP=function(e){var t=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(i))return!0;for(var r=e.clone(),n=this.curve.redN.redMul(t);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(n),0===this.x.cmp(i))return!0}return!1},o.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},o.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},function(e,t,i){"use strict";function r(e){l.call(this,"mont",e),this.a=new s(e.a,16).toRed(this.red),this.b=new s(e.b,16).toRed(this.red),this.i4=new s(4).toRed(this.red).redInvm(),this.two=new s(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function n(e,t,i){l.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new s(t,16),this.z=new s(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}var o=i(24),s=i(4),a=i(0),l=o.base,h=i(5),c=h.utils;a(r,l),e.exports=r,r.prototype.validate=function(e){var t=e.normalize().x,i=t.redSqr(),r=i.redMul(t).redAdd(i.redMul(this.a)).redAdd(t);return 0===r.redSqrt().redSqr().cmp(r)},a(n,l.BasePoint),r.prototype.decodePoint=function(e,t){return this.point(c.toArray(e,t),1)},r.prototype.point=function(e,t){return new n(this,e,t)},r.prototype.pointFromJSON=function(e){return n.fromJSON(this,e)},n.prototype.precompute=function(){},n.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},n.fromJSON=function(e,t){return new n(e,t[0],t[1]||e.one)},n.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},n.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},n.prototype.dbl=function(){var e=this.x.redAdd(this.z),t=e.redSqr(),i=this.x.redSub(this.z),r=i.redSqr(),n=t.redSub(r),o=t.redMul(r),s=n.redMul(r.redAdd(this.curve.a24.redMul(n)));return this.curve.point(o,s)},n.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.diffAdd=function(e,t){var i=this.x.redAdd(this.z),r=this.x.redSub(this.z),n=e.x.redAdd(e.z),o=e.x.redSub(e.z),s=o.redMul(i),a=n.redMul(r),l=t.z.redMul(s.redAdd(a).redSqr()),h=t.x.redMul(s.redISub(a).redSqr());return this.curve.point(l,h)},n.prototype.mul=function(e){for(var t=e.clone(),i=this,r=this.curve.point(null,null),n=this,o=[];0!==t.cmpn(0);t.iushrn(1))o.push(t.andln(1));for(var s=o.length-1;s>=0;s--)0===o[s]?(i=i.diffAdd(r,n),r=r.dbl()):(r=i.diffAdd(r,n),i=i.dbl());return r},n.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},n.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},n.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},n.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},function(e,t,i){"use strict";function r(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,h.call(this,"edwards",e),this.a=new a(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new a(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new a(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),c(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function n(e,t,i,r,n){h.BasePoint.call(this,e,"projective"),null===t&&null===i&&null===r?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new a(t,16),this.y=new a(i,16),this.z=r?new a(r,16):this.curve.one,this.t=n&&new a(n,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}var o=i(24),s=i(5),a=i(4),l=i(0),h=o.base,c=s.utils.assert;l(r,h),e.exports=r,r.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},r.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},r.prototype.jpoint=function(e,t,i,r){return this.point(e,t,i,r)},r.prototype.pointFromX=function(e,t){e=new a(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),r=this.c2.redSub(this.a.redMul(i)),n=this.one.redSub(this.c2.redMul(this.d).redMul(i)),o=r.redMul(n.redInvm()),s=o.redSqrt();if(0!==s.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var l=s.fromRed().isOdd();return(t&&!l||!t&&l)&&(s=s.redNeg()),this.point(e,s)},r.prototype.pointFromY=function(e,t){e=new a(e,16),e.red||(e=e.toRed(this.red));var i=e.redSqr(),r=i.redSub(this.one),n=i.redMul(this.d).redAdd(this.one),o=r.redMul(n.redInvm());if(0===o.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var s=o.redSqrt();if(0!==s.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return s.isOdd()!==t&&(s=s.redNeg()),this.point(s,e)},r.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),i=e.y.redSqr(),r=t.redMul(this.a).redAdd(i),n=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(i)));return 0===r.cmp(n)},l(n,h.BasePoint),r.prototype.pointFromJSON=function(e){return n.fromJSON(this,e)},r.prototype.point=function(e,t,i,r){return new n(this,e,t,i,r)},n.fromJSON=function(e,t){return new n(e,t[0],t[1],t[2])},n.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},n.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&0===this.y.cmp(this.z)},n.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var r=this.curve._mulA(e),n=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),o=r.redAdd(t),s=o.redSub(i),a=r.redSub(t),l=n.redMul(s),h=o.redMul(a),c=n.redMul(a),u=s.redMul(o);return this.curve.point(l,h,u,c)},n.prototype._projDbl=function(){var e,t,i,r=this.x.redAdd(this.y).redSqr(),n=this.x.redSqr(),o=this.y.redSqr();if(this.curve.twisted){var s=this.curve._mulA(n),a=s.redAdd(o);if(this.zOne)e=r.redSub(n).redSub(o).redMul(a.redSub(this.curve.two)),t=a.redMul(s.redSub(o)),i=a.redSqr().redSub(a).redSub(a);else{var l=this.z.redSqr(),h=a.redSub(l).redISub(l);e=r.redSub(n).redISub(o).redMul(h),t=a.redMul(s.redSub(o)),i=a.redMul(h)}}else{var s=n.redAdd(o),l=this.curve._mulC(this.c.redMul(this.z)).redSqr(),h=s.redSub(l).redSub(l);e=this.curve._mulC(r.redISub(s)).redMul(h),t=this.curve._mulC(s).redMul(n.redISub(o)),i=s.redMul(h)}return this.curve.point(e,t,i)},n.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},n.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),r=this.t.redMul(this.curve.dd).redMul(e.t),n=this.z.redMul(e.z.redAdd(e.z)),o=i.redSub(t),s=n.redSub(r),a=n.redAdd(r),l=i.redAdd(t),h=o.redMul(s),c=a.redMul(l),u=o.redMul(l),f=s.redMul(a);return this.curve.point(h,c,f,u)},n.prototype._projAdd=function(e){var t,i,r=this.z.redMul(e.z),n=r.redSqr(),o=this.x.redMul(e.x),s=this.y.redMul(e.y),a=this.curve.d.redMul(o).redMul(s),l=n.redSub(a),h=n.redAdd(a),c=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(o).redISub(s),u=r.redMul(l).redMul(c);return this.curve.twisted?(t=r.redMul(h).redMul(s.redSub(this.curve._mulA(o))),i=l.redMul(h)):(t=r.redMul(h).redMul(s.redSub(o)),i=this.curve._mulC(l).redMul(h)),this.curve.point(u,t,i)},n.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},n.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},n.prototype.mulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!1)},n.prototype.jmulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!0)},n.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},n.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},n.prototype.getX=function(){return this.normalize(),this.x.fromRed()},n.prototype.getY=function(){return this.normalize(),this.y.fromRed()},n.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},n.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var i=e.clone(),r=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(r),0===this.x.cmp(t))return!0}return!1},n.prototype.toP=n.prototype.normalize,n.prototype.mixedAdd=n.prototype.add},function(e,t,i){"use strict";function r(e){"short"===e.type?this.curve=new a.curve.short(e):"edwards"===e.type?this.curve=new a.curve.edwards(e):this.curve=new a.curve.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,l(this.g.validate(),"Invalid curve"),l(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function n(e,t){Object.defineProperty(o,e,{configurable:!0,enumerable:!0,get:function(){var i=new r(t);return Object.defineProperty(o,e,{configurable:!0,enumerable:!0,value:i}),i}})}var o=t,s=i(38),a=i(5),l=a.utils.assert;o.PresetCurve=r,n("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),n("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),n("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),n("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),n("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),n("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),n("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var h;try{h=i(143)}catch(e){h=void 0}n("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",h]})},function(e,t,i){"use strict";t.sha1=i(138),t.sha224=i(139),t.sha256=i(66),t.sha384=i(140),t.sha512=i(67)},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}var n=i(7),o=i(16),s=i(65),a=n.rotl32,l=n.sum32,h=n.sum32_5,c=s.ft_1,u=o.BlockHash,f=[1518500249,1859775393,2400959708,3395469782];n.inherits(r,u),e.exports=r,r.blockSize=512,r.outSize=160,r.hmacStrength=80,r.padLength=64,r.prototype._update=function(e,t){for(var i=this.W,r=0;r<16;r++)i[r]=e[t+r];for(;r<i.length;r++)i[r]=a(i[r-3]^i[r-8]^i[r-14]^i[r-16],1);var n=this.h[0],o=this.h[1],s=this.h[2],u=this.h[3],d=this.h[4];for(r=0;r<i.length;r++){var p=~~(r/20),m=h(a(n,5),c(p,o,s,u),d,i[r],f[p]);d=u,u=s,s=a(o,30),o=n,n=m}this.h[0]=l(this.h[0],n),this.h[1]=l(this.h[1],o),this.h[2]=l(this.h[2],s),this.h[3]=l(this.h[3],u),this.h[4]=l(this.h[4],d)},r.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;o.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}var n=i(7),o=i(66);n.inherits(r,o),e.exports=r,r.blockSize=512,r.outSize=224,r.hmacStrength=192,r.padLength=64,r.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;o.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}var n=i(7),o=i(67);n.inherits(r,o),e.exports=r,r.blockSize=1024,r.outSize=384,r.hmacStrength=192,r.padLength=128,r.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function n(e,t,i,r){return e<=15?t^i^r:e<=31?t&i|~t&r:e<=47?(t|~i)^r:e<=63?t&r|i&~r:t^(i|~r)}function o(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function s(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}var a=i(7),l=i(16),h=a.rotl32,c=a.sum32,u=a.sum32_3,f=a.sum32_4,d=l.BlockHash;a.inherits(r,d),t.ripemd160=r,r.blockSize=512,r.outSize=160,r.hmacStrength=192,r.padLength=64,r.prototype._update=function(e,t){for(var i=this.h[0],r=this.h[1],a=this.h[2],l=this.h[3],d=this.h[4],y=i,_=r,b=a,x=l,T=d,E=0;E<80;E++){var S=c(h(f(i,n(E,r,a,l),e[p[E]+t],o(E)),g[E]),d);i=d,d=l,l=h(a,10),a=r,r=S,S=c(h(f(y,n(79-E,_,b,x),e[m[E]+t],s(E)),v[E]),T),y=T,T=x,x=h(b,10),b=_,_=S}S=u(this.h[1],a,x),this.h[1]=u(this.h[2],l,T),this.h[2]=u(this.h[3],d,y),this.h[3]=u(this.h[4],i,_),this.h[4]=u(this.h[0],r,b),this.h[0]=S},r.prototype._digest=function(e){return"hex"===e?a.toHex32(this.h,"little"):a.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],m=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],g=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],v=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},function(e,t,i){"use strict";function r(e,t,i){if(!(this instanceof r))return new r(e,t,i);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,i))}var n=i(7),o=i(6);e.exports=r,r.prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),o(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},r.prototype.update=function(e,t){return this.inner.update(e,t),this},r.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},function(e,t){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);"string"==typeof e&&(l(s.curves.hasOwnProperty(e),"Unknown curve "+e),e=s.curves[e]),e instanceof s.curves.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}var n=i(4),o=i(145),s=i(5),a=s.utils,l=a.assert,h=i(146),c=i(147);e.exports=r,r.prototype.keyPair=function(e){return new h(this,e)},r.prototype.keyFromPrivate=function(e,t){return h.fromPrivate(this,e,t)},r.prototype.keyFromPublic=function(e,t){return h.fromPublic(this,e,t)},r.prototype.genKeyPair=function(e){e||(e={});for(var t=new o({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||s.rand(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),r=this.n.sub(new n(2));;){var a=new n(t.generate(i));if(!(a.cmp(r)>0))return a.iaddn(1),this.keyFromPrivate(a)}},r.prototype._truncateToN=function(e,t){var i=8*e.byteLength()-this.n.bitLength();return i>0&&(e=e.ushrn(i)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},r.prototype.sign=function(e,t,i,r){"object"==typeof i&&(r=i,i=null),r||(r={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new n(e,16));for(var s=this.n.byteLength(),a=t.getPrivate().toArray("be",s),l=e.toArray("be",s),h=new o({hash:this.hash,entropy:a,nonce:l,pers:r.pers,persEnc:r.persEnc||"utf8"}),u=this.n.sub(new n(1)),f=0;!0;f++){var d=r.k?r.k(f):new n(h.generate(this.n.byteLength()));if(d=this._truncateToN(d,!0),!(d.cmpn(1)<=0||d.cmp(u)>=0)){var p=this.g.mul(d);if(!p.isInfinity()){var m=p.getX(),g=m.umod(this.n);if(0!==g.cmpn(0)){var v=d.invm(this.n).mul(g.mul(t.getPrivate()).iadd(e));if(v=v.umod(this.n),0!==v.cmpn(0)){var y=(p.getY().isOdd()?1:0)|(0!==m.cmp(g)?2:0);return r.canonical&&v.cmp(this.nh)>0&&(v=this.n.sub(v),y^=1),new c({r:g,s:v,recoveryParam:y})}}}}}},r.prototype.verify=function(e,t,i,r){e=this._truncateToN(new n(e,16)),i=this.keyFromPublic(i,r),t=new c(t,"hex");var o=t.r,s=t.s;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;var a=s.invm(this.n),l=a.mul(e).umod(this.n),h=a.mul(o).umod(this.n);if(!this.curve._maxwellTrick){var u=this.g.mulAdd(l,i.getPublic(),h);return!u.isInfinity()&&0===u.getX().umod(this.n).cmp(o)}var u=this.g.jmulAdd(l,i.getPublic(),h);return!u.isInfinity()&&u.eqXToP(o)},r.prototype.recoverPubKey=function(e,t,i,r){l((3&i)===i,"The recovery param is more than two bits"),t=new c(t,r);var o=this.n,s=new n(e),a=t.r,h=t.s,u=1&i,f=i>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&f)throw new Error("Unable to find sencond key candinate");a=f?this.curve.pointFromX(a.add(this.curve.n),u):this.curve.pointFromX(a,u);var d=t.r.invm(o),p=o.sub(s).mul(d).umod(o),m=h.mul(d).umod(o);return this.g.mulAdd(p,a,m)},r.prototype.getKeyRecoveryParam=function(e,t,i,r){if(t=new c(t,r),null!==t.recoveryParam)return t.recoveryParam;for(var n=0;n<4;n++){var o;try{o=this.recoverPubKey(e,t,n)}catch(e){continue}if(o.eq(i))return n}throw new Error("Unable to find valid recovery factor")}},function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=o.toArray(e.entropy,e.entropyEnc||"hex"),i=o.toArray(e.nonce,e.nonceEnc||"hex"),n=o.toArray(e.pers,e.persEnc||"hex");s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,i,n)}var n=i(38),o=i(64),s=i(6);e.exports=r,r.prototype._init=function(e,t,i){var r=e.concat(t).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(r),this._reseed=1,this.reseedInterval=281474976710656},r.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},r.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},r.prototype.reseed=function(e,t,i,r){"string"!=typeof t&&(r=i,i=t,t=null),e=o.toArray(e,t),i=o.toArray(i,r),s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},r.prototype.generate=function(e,t,i,r){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(r=i,i=t,t=null),i&&(i=o.toArray(i,r||"hex"),this._update(i));for(var n=[];n.length<e;)this.V=this._hmac().update(this.V).digest(),n=n.concat(this.V);var s=n.slice(0,e);return this._update(i),this._reseed++,o.encode(s,t)}},function(e,t,i){"use strict";function r(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var n=i(4),o=i(5),s=o.utils,a=s.assert;e.exports=r,r.fromPublic=function(e,t,i){return t instanceof r?t:new r(e,{pub:t,pubEnc:i})},r.fromPrivate=function(e,t,i){return t instanceof r?t:new r(e,{priv:t,privEnc:i})},r.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},r.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},r.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},r.prototype._importPrivate=function(e,t){this.priv=new n(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},r.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?a(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||a(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},r.prototype.derive=function(e){return e.mul(this.priv).getX()},r.prototype.sign=function(e,t,i){return this.ec.sign(e,this,t,i)},r.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},r.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},function(e,t,i){"use strict";function r(e,t){if(e instanceof r)return e;this._importDER(e,t)||(u(e.r&&e.s,"Signature without r or s"),this.r=new l(e.r,16),this.s=new l(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function n(){this.place=0}function o(e,t){var i=e[t.place++];if(!(128&i))return i;for(var r=15&i,n=0,o=0,s=t.place;o<r;o++,s++)n<<=8,n|=e[s];return t.place=s,n}function s(e){for(var t=0,i=e.length-1;!e[t]&&!(128&e[t+1])&&t<i;)t++;return 0===t?e:e.slice(t)}function a(e,t){if(t<128)return void e.push(t);var i=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|i);--i;)e.push(t>>>(i<<3)&255);e.push(t)}var l=i(4),h=i(5),c=h.utils,u=c.assert;e.exports=r,r.prototype._importDER=function(e,t){e=c.toArray(e,t);var i=new n;if(48!==e[i.place++])return!1;if(o(e,i)+i.place!==e.length)return!1;if(2!==e[i.place++])return!1;var r=o(e,i),s=e.slice(i.place,r+i.place);if(i.place+=r,2!==e[i.place++])return!1;var a=o(e,i);if(e.length!==a+i.place)return!1;var h=e.slice(i.place,a+i.place);return 0===s[0]&&128&s[1]&&(s=s.slice(1)),0===h[0]&&128&h[1]&&(h=h.slice(1)),this.r=new l(s),this.s=new l(h),this.recoveryParam=null,!0},r.prototype.toDER=function(e){var t=this.r.toArray(),i=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&i[0]&&(i=[0].concat(i)),t=s(t),i=s(i);!(i[0]||128&i[1]);)i=i.slice(1);var r=[2];a(r,t.length),r=r.concat(t),r.push(2),a(r,i.length);var n=r.concat(i),o=[48];return a(o,n.length),o=o.concat(n),c.encode(o,e)}},function(e,t,i){"use strict";function r(e){if(a("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof r))return new r(e);var e=o.curves[e].curve;this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=n.sha512}var n=i(38),o=i(5),s=o.utils,a=s.assert,l=s.parseBytes,h=i(149),c=i(150);e.exports=r,r.prototype.sign=function(e,t){e=l(e);var i=this.keyFromSecret(t),r=this.hashInt(i.messagePrefix(),e),n=this.g.mul(r),o=this.encodePoint(n),s=this.hashInt(o,i.pubBytes(),e).mul(i.priv()),a=r.add(s).umod(this.curve.n);return this.makeSignature({R:n,S:a,Rencoded:o})},r.prototype.verify=function(e,t,i){e=l(e),t=this.makeSignature(t);var r=this.keyFromPublic(i),n=this.hashInt(t.Rencoded(),r.pubBytes(),e),o=this.g.mul(t.S());return t.R().add(r.pub().mul(n)).eq(o)},r.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return s.intFromLE(e.digest()).umod(this.curve.n)},r.prototype.keyFromPublic=function(e){return h.fromPublic(this,e)},r.prototype.keyFromSecret=function(e){return h.fromSecret(this,e)},r.prototype.makeSignature=function(e){return e instanceof c?e:new c(this,e)},r.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},r.prototype.decodePoint=function(e){e=s.parseBytes(e);var t=e.length-1,i=e.slice(0,t).concat(-129&e[t]),r=0!=(128&e[t]),n=s.intFromLE(i);return this.curve.pointFromY(n,r)},r.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},r.prototype.decodeInt=function(e){return s.intFromLE(e)},r.prototype.isPoint=function(e){return e instanceof this.pointClass}},function(e,t,i){"use strict";function r(e,t){this.eddsa=e,this._secret=a(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=a(t.pub)}var n=i(5),o=n.utils,s=o.assert,a=o.parseBytes,l=o.cachedProperty;r.fromPublic=function(e,t){return t instanceof r?t:new r(e,{pub:t})},r.fromSecret=function(e,t){return t instanceof r?t:new r(e,{secret:t})},r.prototype.secret=function(){return this._secret},l(r,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),l(r,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),l(r,"privBytes",function(){var e=this.eddsa,t=this.hash(),i=e.encodingLength-1,r=t.slice(0,e.encodingLength);return r[0]&=248,r[i]&=127,r[i]|=64,r}),l(r,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),l(r,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),l(r,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),r.prototype.sign=function(e){return s(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},r.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},r.prototype.getSecret=function(e){return s(this._secret,"KeyPair is public only"),o.encode(this.secret(),e)},r.prototype.getPublic=function(e){return o.encode(this.pubBytes(),e)},e.exports=r},function(e,t,i){"use strict";function r(e,t){this.eddsa=e,"object"!=typeof t&&(t=h(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),a(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof n&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}var n=i(4),o=i(5),s=o.utils,a=s.assert,l=s.cachedProperty,h=s.parseBytes;l(r,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),l(r,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),l(r,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),l(r,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),r.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},r.prototype.toHex=function(){return s.encode(this.toBytes(),"hex").toUpperCase()},e.exports=r},function(e,t,i){"use strict";var r=i(17);t.certificate=i(162);var n=r.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});t.RSAPrivateKey=n;var o=r.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});t.RSAPublicKey=o;var s=r.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(a),this.key("subjectPublicKey").bitstr())});t.PublicKey=s;var a=r.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),l=r.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(a),this.key("subjectPrivateKey").octstr())});t.PrivateKey=l;var h=r.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});t.EncryptedPrivateKey=h;var c=r.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});t.DSAPrivateKey=c,t.DSAparam=r.define("DSAparam",function(){this.int()});var u=r.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(f),this.key("publicKey").optional().explicit(1).bitstr())});t.ECPrivateKey=u;var f=r.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});t.signature=r.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},function(e,t,i){function r(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}var n=i(17),o=i(0);t.define=function(e,t){return new r(e,t)},r.prototype._createNamed=function(e){var t;try{t=i(153).runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(e){t=function(e){this._initNamed(e)}}return o(t,e),t.prototype._initNamed=function(t){e.call(this,t)},new t(this)},r.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(n.decoders[e])),this.decoders[e]},r.prototype.decode=function(e,t,i){return this._getDecoder(t).decode(e,i)},r.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(n.encoders[e])),this.encoders[e]},r.prototype.encode=function(e,t,i){return this._getEncoder(t).encode(e,i)}},function(module,exports,__webpack_require__){function Context(){}var indexOf=__webpack_require__(154),Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var i in e)t.push(i);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i++)t(e[i],i,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,i){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:i})}}catch(e){return function(e,t,i){e[t]=i}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw new TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var i=t.contentWindow,r=i.eval,n=i.execScript;!r&&n&&(n.call(i,"null"),r=i.eval),forEach(Object_keys(e),function(t){i[t]=e[t]}),forEach(globals,function(t){e[t]&&(i[t]=e[t])});var o=Object_keys(i),s=r.call(i,this.code);return forEach(Object_keys(i),function(t){(t in e||-1===indexOf(o,t))&&(e[t]=i[t])}),forEach(globals,function(t){t in e||defineProp(e,t,i[t])}),document.body.removeChild(t),s},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),i=this.runInContext(t);return forEach(Object_keys(t),function(i){e[i]=t[i]}),i},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var i=Script(t);return i[e].apply(i,[].slice.call(arguments,1))}}),exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(i){t[i]=e[i]}),t}},function(e,t){var i=[].indexOf;e.exports=function(e,t){if(i)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,i){function r(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function n(e,t){this.path=e,this.rethrow(t)}var o=i(0);t.Reporter=r,r.prototype.isError=function(e){return e instanceof n},r.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},r.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},r.prototype.enterKey=function(e){return this._reporterState.path.push(e)},r.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},r.prototype.leaveKey=function(e,t,i){var r=this._reporterState;this.exitKey(e),null!==r.obj&&(r.obj[t]=i)},r.prototype.path=function(){return this._reporterState.path.join("/")},r.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},r.prototype.leaveObject=function(e){var t=this._reporterState,i=t.obj;return t.obj=e,i},r.prototype.error=function(e){var t,i=this._reporterState,r=e instanceof n;if(t=r?e:new n(i.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),e.message||e,e.stack),!i.options.partial)throw t;return r||i.errors.push(t),t},r.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},o(n,Error),n.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,n),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},function(e,t,i){function r(e,t){var i={};this._baseState=i,i.enc=e,i.parent=t||null,i.children=null,i.tag=null,i.args=null,i.reverseArgs=null,i.choice=null,i.optional=!1,i.any=!1,i.obj=!1,i.use=null,i.useDecoder=null,i.key=null,i.default=null,i.explicit=null,i.implicit=null,i.contains=null,i.parent||(i.children=[],this._wrap())}var n=i(18).Reporter,o=i(18).EncoderBuffer,s=i(18).DecoderBuffer,a=i(6),l=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],h=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(l),c=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];e.exports=r;var u=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];r.prototype.clone=function(){var e=this._baseState,t={};u.forEach(function(i){t[i]=e[i]});var i=new this.constructor(t.parent);return i._baseState=t,i},r.prototype._wrap=function(){var e=this._baseState;h.forEach(function(t){this[t]=function(){var i=new this.constructor(this);return e.children.push(i),i[t].apply(i,arguments)}},this)},r.prototype._init=function(e){var t=this._baseState;a(null===t.parent),e.call(this),t.children=t.children.filter(function(e){return e._baseState.parent===this},this),a.equal(t.children.length,1,"Root node can have only one child")},r.prototype._useArgs=function(e){var t=this._baseState,i=e.filter(function(e){return e instanceof this.constructor},this);e=e.filter(function(e){return!(e instanceof this.constructor)},this),0!==i.length&&(a(null===t.children),t.children=i,i.forEach(function(e){e._baseState.parent=this},this)),0!==e.length&&(a(null===t.args),t.args=e,t.reverseArgs=e.map(function(e){if("object"!=typeof e||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach(function(i){i==(0|i)&&(i|=0);var r=e[i];t[r]=i}),t}))},c.forEach(function(e){r.prototype[e]=function(){var t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}}),l.forEach(function(e){r.prototype[e]=function(){var t=this._baseState,i=Array.prototype.slice.call(arguments);return a(null===t.tag),t.tag=e,this._useArgs(i),this}}),r.prototype.use=function(e){a(e);var t=this._baseState;return a(null===t.use),t.use=e,this},r.prototype.optional=function(){return this._baseState.optional=!0,this},r.prototype.def=function(e){var t=this._baseState;return a(null===t.default),t.default=e,t.optional=!0,this},r.prototype.explicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.explicit=e,this},r.prototype.implicit=function(e){var t=this._baseState;return a(null===t.explicit&&null===t.implicit),t.implicit=e,this},r.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},r.prototype.key=function(e){var t=this._baseState;return a(null===t.key),t.key=e,this},r.prototype.any=function(){return this._baseState.any=!0,this},r.prototype.choice=function(e){var t=this._baseState;return a(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map(function(t){return e[t]})),this},r.prototype.contains=function(e){var t=this._baseState;return a(null===t.use),t.contains=e,this},r.prototype._decode=function(e,t){var i=this._baseState;if(null===i.parent)return e.wrapResult(i.children[0]._decode(e,t));var r=i.default,n=!0,o=null;if(null!==i.key&&(o=e.enterKey(i.key)),i.optional){var a=null;if(null!==i.explicit?a=i.explicit:null!==i.implicit?a=i.implicit:null!==i.tag&&(a=i.tag),null!==a||i.any){if(n=this._peekTag(e,a,i.any),e.isError(n))return n}else{var l=e.save();try{null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),n=!0}catch(e){n=!1}e.restore(l)}}var h;if(i.obj&&n&&(h=e.enterObject()),n){if(null!==i.explicit){var c=this._decodeTag(e,i.explicit);if(e.isError(c))return c;e=c}var u=e.offset;if(null===i.use&&null===i.choice){if(i.any)var l=e.save();var f=this._decodeTag(e,null!==i.implicit?i.implicit:i.tag,i.any);if(e.isError(f))return f;i.any?r=e.raw(l):e=f}if(t&&t.track&&null!==i.tag&&t.track(e.path(),u,e.length,"tagged"),t&&t.track&&null!==i.tag&&t.track(e.path(),e.offset,e.length,"content"),r=i.any?r:null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),e.isError(r))return r;if(i.any||null!==i.choice||null===i.children||i.children.forEach(function(i){i._decode(e,t)}),i.contains&&("octstr"===i.tag||"bitstr"===i.tag)){var d=new s(r);r=this._getUse(i.contains,e._reporterState.obj)._decode(d,t)}}return i.obj&&n&&(r=e.leaveObject(h)),null===i.key||null===r&&!0!==n?null!==o&&e.exitKey(o):e.leaveKey(o,i.key,r),r},r.prototype._decodeGeneric=function(e,t,i){var r=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,r.args[0],i):/str$/.test(e)?this._decodeStr(t,e,i):"objid"===e&&r.args?this._decodeObjid(t,r.args[0],r.args[1],i):"objid"===e?this._decodeObjid(t,null,null,i):"gentime"===e||"utctime"===e?this._decodeTime(t,e,i):"null_"===e?this._decodeNull(t,i):"bool"===e?this._decodeBool(t,i):"objDesc"===e?this._decodeStr(t,e,i):"int"===e||"enum"===e?this._decodeInt(t,r.args&&r.args[0],i):null!==r.use?this._getUse(r.use,t._reporterState.obj)._decode(t,i):t.error("unknown tag: "+e)},r.prototype._getUse=function(e,t){var i=this._baseState;return i.useDecoder=this._use(e,t),a(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},r.prototype._decodeChoice=function(e,t){var i=this._baseState,r=null,n=!1;return Object.keys(i.choice).some(function(o){var s=e.save(),a=i.choice[o];try{var l=a._decode(e,t);if(e.isError(l))return!1;r={type:o,value:l},n=!0}catch(t){return e.restore(s),!1}return!0},this),n?r:e.error("Choice not matched")},r.prototype._createEncoderBuffer=function(e){return new o(e,this.reporter)},r.prototype._encode=function(e,t,i){var r=this._baseState;if(null===r.default||r.default!==e){var n=this._encodeValue(e,t,i);if(void 0!==n&&!this._skipDefault(n,t,i))return n}},r.prototype._encodeValue=function(e,t,i){var r=this._baseState;if(null===r.parent)return r.children[0]._encode(e,t||new n);var o=null;if(this.reporter=t,r.optional&&void 0===e){if(null===r.default)return;e=r.default}var s=null,a=!1;if(r.any)o=this._createEncoderBuffer(e);else if(r.choice)o=this._encodeChoice(e,t);else if(r.contains)s=this._getUse(r.contains,i)._encode(e,t),a=!0;else if(r.children)s=r.children.map(function(i){if("null_"===i._baseState.tag)return i._encode(null,t,e);if(null===i._baseState.key)return t.error("Child should have a key");var r=t.enterKey(i._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");var n=i._encode(e[i._baseState.key],t,e);return t.leaveKey(r),n},this).filter(function(e){return e}),s=this._createEncoderBuffer(s);else if("seqof"===r.tag||"setof"===r.tag){if(!r.args||1!==r.args.length)return t.error("Too many args for : "+r.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var l=this.clone();l._baseState.implicit=null,s=this._createEncoderBuffer(e.map(function(i){var r=this._baseState;return this._getUse(r.args[0],e)._encode(i,t)},l))}else null!==r.use?o=this._getUse(r.use,i)._encode(e,t):(s=this._encodePrimitive(r.tag,e),a=!0);var o;if(!r.any&&null===r.choice){var h=null!==r.implicit?r.implicit:r.tag,c=null===r.implicit?"universal":"context";null===h?null===r.use&&t.error("Tag could be omitted only for .use()"):null===r.use&&(o=this._encodeComposite(h,a,c,s))}return null!==r.explicit&&(o=this._encodeComposite(r.explicit,!1,"context",o)),o},r.prototype._encodeChoice=function(e,t){var i=this._baseState,r=i.choice[e.type];return r||a(!1,e.type+" not found in "+JSON.stringify(Object.keys(i.choice))),r._encode(e.value,t)},r.prototype._encodePrimitive=function(e,t){var i=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&i.args)return this._encodeObjid(t,i.reverseArgs[0],i.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,i.args&&i.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},r.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},r.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(e)}},function(e,t,i){var r=i(69);t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=r._reverse(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=r._reverse(t.tag)},function(e,t,i){var r=t;r.der=i(70),r.pem=i(159)},function(e,t,i){function r(e){s.call(this,e),this.enc="pem"}var n=i(0),o=i(3).Buffer,s=i(70);n(r,s),e.exports=r,r.prototype.decode=function(e,t){for(var i=e.toString().split(/[\r\n]+/g),r=t.label.toUpperCase(),n=/^-----(BEGIN|END) ([^-]+)-----$/,a=-1,l=-1,h=0;h<i.length;h++){var c=i[h].match(n);if(null!==c&&c[2]===r){if(-1!==a){if("END"!==c[1])break;l=h;break}if("BEGIN"!==c[1])break;a=h}}if(-1===a||-1===l)throw new Error("PEM section not found for: "+r);var u=i.slice(a+1,l).join("");u.replace(/[^a-z0-9\+\/=]+/gi,"");var f=new o(u,"base64");return s.prototype.decode.call(this,f,t)}},function(e,t,i){var r=t;r.der=i(71),r.pem=i(161)},function(e,t,i){function r(e){o.call(this,e),this.enc="pem"}var n=i(0),o=i(71);n(r,o),e.exports=r,r.prototype.encode=function(e,t){for(var i=o.prototype.encode.call(this,e),r=i.toString("base64"),n=["-----BEGIN "+t.label+"-----"],s=0;s<r.length;s+=64)n.push(r.slice(s,s+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}},function(e,t,i){"use strict";var r=i(17),n=r.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),o=r.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),s=r.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional())}),a=r.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(s),this.key("subjectPublicKey").bitstr())}),l=r.define("RelativeDistinguishedName",function(){this.setof(o)}),h=r.define("RDNSequence",function(){this.seqof(l)}),c=r.define("Name",function(){this.choice({rdnSequence:this.use(h)})}),u=r.define("Validity",function(){this.seq().obj(this.key("notBefore").use(n),this.key("notAfter").use(n))}),f=r.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),d=r.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int(),this.key("serialNumber").int(),this.key("signature").use(s),this.key("issuer").use(c),this.key("validity").use(u),this.key("subject").use(c),this.key("subjectPublicKeyInfo").use(a),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(f).optional())}),p=r.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(d),this.key("signatureAlgorithm").use(s),this.key("signatureValue").bitstr())});e.exports=p},function(e,t){e.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},function(e,t,i){(function(t){var r=/Proc-Type: 4,ENCRYPTED\n\r?DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)\n\r?\n\r?([0-9A-z\n\r\+\/\=]+)\n\r?/m,n=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----\n/m,o=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----\n\r?([0-9A-z\n\r\+\/\=]+)\n\r?-----END \1-----$/m,s=i(22),a=i(34);e.exports=function(e,i){var l,h=e.toString(),c=h.match(r);if(c){var u="aes"+c[1],f=new t(c[2],"hex"),d=new t(c[3].replace(/\r?\n/g,""),"base64"),p=s(i,f.slice(0,8),parseInt(c[1],10)).key,m=[],g=a.createDecipheriv(u,p,f);m.push(g.update(d)),m.push(g.final()),l=t.concat(m)}else{var v=h.match(o);l=new t(v[2].replace(/\r?\n/g,""),"base64")}return{tag:h.match(n)[1],data:l}}}).call(t,i(3).Buffer)},function(e,t,i){(function(t){function r(e,i,r,s,l){var c=h(r);if("ec"===c.type){if("ecdsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong public key type");return n(e,i,c)}if("dsa"===c.type){if("dsa"!==s)throw new Error("wrong public key type");return o(e,i,c)}if("rsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong public key type");i=t.concat([l,i]);for(var u=c.modulus.byteLength(),f=[1],d=0;i.length+f.length+2<u;)f.push(255),d++;f.push(0);for(var p=-1;++p<i.length;)f.push(i[p]);f=new t(f);var m=a.mont(c.modulus);e=new a(e).toRed(m),e=e.redPow(new a(c.publicExponent)),e=new t(e.fromRed().toArray());var g=d<8?1:0;for(u=Math.min(e.length,f.length),e.length!==f.length&&(g=1),p=-1;++p<u;)g|=e[p]^f[p];return 0===g}function n(e,t,i){var r=c[i.data.algorithm.curve.join(".")];if(!r)throw new Error("unknown curve "+i.data.algorithm.curve.join("."));var n=new l(r),o=i.data.subjectPrivateKey.data;return n.verify(t,e,o)}function o(e,t,i){var r=i.data.p,n=i.data.q,o=i.data.g,l=i.data.pub_key,c=h.signature.decode(e,"der"),u=c.s,f=c.r;s(u,n),s(f,n);var d=a.mont(r),p=u.invm(n);return 0===o.toRed(d).redPow(new a(t).mul(p).mod(n)).fromRed().mul(l.toRed(d).redPow(f.mul(p).mod(n)).fromRed()).mod(r).mod(n).cmp(f)}function s(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}var a=i(4),l=i(5).ec,h=i(25),c=i(72);e.exports=r}).call(t,i(3).Buffer)},function(e,t,i){(function(t){function r(e){this.curveType=a[e],this.curveType||(this.curveType={name:e}),this.curve=new o.ec(this.curveType.name),this.keys=void 0}function n(e,i,r){Array.isArray(e)||(e=e.toArray());var n=new t(e);if(r&&n.length<r){var o=new t(r-n.length);o.fill(0),n=t.concat([o,n])}return i?n.toString(i):n}var o=i(5),s=i(4);e.exports=function(e){return new r(e)};var a={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};a.p224=a.secp224r1,a.p256=a.secp256r1=a.prime256v1,a.p192=a.secp192r1=a.prime192v1,a.p384=a.secp384r1,a.p521=a.secp521r1,r.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},r.prototype.computeSecret=function(e,i,r){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),n(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),r,this.curveType.byteLength)},r.prototype.getPublicKey=function(e,t){var i=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(i[i.length-1]%2?i[0]=7:i[0]=6),n(i,e)},r.prototype.getPrivateKey=function(e){return n(this.keys.getPrivate(),e)},r.prototype.setPublicKey=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.keys._importPublic(e),this},r.prototype.setPrivateKey=function(e,i){i=i||"utf8",t.isBuffer(e)||(e=new t(e,i));var r=new s(e);return r=r.toString(16),this.keys._importPrivate(r),this}}).call(t,i(3).Buffer)},function(e,t,i){t.publicEncrypt=i(168),t.privateDecrypt=i(169),t.privateEncrypt=function(e,i){return t.publicEncrypt(e,i,!0)},t.publicDecrypt=function(e,i){return t.privateDecrypt(e,i,!0)}},function(e,t,i){(function(t){function r(e,i){var r=e.modulus.byteLength(),n=i.length,o=l("sha1").update(new t("")).digest(),s=o.length,f=2*s;if(n>r-f-2)throw new Error("message too long");var d=new t(r-n-f-2);d.fill(0);var p=r-s-1,m=a(s),g=c(t.concat([o,d,new t([1]),i],p),h(m,p)),v=c(m,h(g,s));return new u(t.concat([new t([0]),v,g],r))}function n(e,i,r){var n=i.length,s=e.modulus.byteLength();if(n>s-11)throw new Error("message too long");var a;return r?(a=new t(s-n-3),a.fill(255)):a=o(s-n-3),new u(t.concat([new t([0,r?1:2]),a,new t([0]),i],s))}function o(e,i){for(var r,n=new t(e),o=0,s=a(2*e),l=0;o<e;)l===s.length&&(s=a(2*e),l=0),(r=s[l++])&&(n[o++]=r);return n}var s=i(25),a=i(11),l=i(13),h=i(73),c=i(74),u=i(4),f=i(75),d=i(37);e.exports=function(e,t,i){var o;o=e.padding?e.padding:i?1:4;var a,l=s(e);if(4===o)a=r(l,t);else if(1===o)a=n(l,t,i);else{if(3!==o)throw new Error("unknown padding");if(a=new u(t),a.cmp(l.modulus)>=0)throw new Error("data too long for modulus")}return i?d(a,l):f(a,l)}}).call(t,i(3).Buffer)},function(e,t,i){(function(t){function r(e,i){var r=(e.modulus,e.modulus.byteLength()),n=(i.length,u("sha1").update(new t("")).digest()),s=n.length;if(0!==i[0])throw new Error("decryption error");var h=i.slice(1,s+1),c=i.slice(s+1),f=l(h,a(c,s)),d=l(c,a(f,r-s-1));if(o(n,d.slice(0,s)))throw new Error("decryption error");for(var p=s;0===d[p];)p++;if(1!==d[p++])throw new Error("decryption error");return d.slice(p)}function n(e,t,i){for(var r=t.slice(0,2),n=2,o=0;0!==t[n++];)if(n>=t.length){o++;break}var s=t.slice(2,n-1);t.slice(n-1,n);if(("0002"!==r.toString("hex")&&!i||"0001"!==r.toString("hex")&&i)&&o++,s.length<8&&o++,o)throw new Error("decryption error");return t.slice(n)}function o(e,i){e=new t(e),i=new t(i);var r=0,n=e.length;e.length!==i.length&&(r++,n=Math.min(e.length,i.length));for(var o=-1;++o<n;)r+=e[o]^i[o];return r}var s=i(25),a=i(73),l=i(74),h=i(4),c=i(37),u=i(13),f=i(75);e.exports=function(e,i,o){var a;a=e.padding?e.padding:o?1:4;var l=s(e),u=l.modulus.byteLength();if(i.length>u||new h(i).cmp(l.modulus)>=0)throw new Error("decryption error");var d;d=o?f(new h(i),l):c(i,l);var p=new t(u-d.length);if(p.fill(0),d=t.concat([p,d],u),4===a)return r(l,d);if(1===a)return n(l,d,o);if(3===a)return d;throw new Error("unknown padding")}}).call(t,i(3).Buffer)},function(e,t,i){"use strict";(function(e,r){function n(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}function o(e,t){if("number"!=typeof e||e!==e)throw new TypeError("offset must be a number");if(e>m||e<0)throw new TypeError("offset must be a uint32");if(e>d||e>t)throw new RangeError("offset out of range")}function s(e,t,i){if("number"!=typeof e||e!==e)throw new TypeError("size must be a number");if(e>m||e<0)throw new TypeError("size must be a uint32");if(e+t>i||e>d)throw new RangeError("buffer too small")}function a(t,i,r,n){if(!(f.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof i)n=i,i=0,r=t.length;else if("function"==typeof r)n=r,r=t.length-i;else if("function"!=typeof n)throw new TypeError('"cb" argument must be a function');return o(i,t.length),s(r,i,t.length),l(t,i,r,n)}function l(e,t,i,n){if(r.browser){var o=e.buffer,s=new Uint8Array(o,t,i);return p.getRandomValues(s),n?void r.nextTick(function(){n(null,e)}):e}return n?void u(i,function(i,r){if(i)return n(i);r.copy(e,t),n(null,e)}):(u(i).copy(e,t),e)}function h(t,i,r){if(void 0===i&&(i=0),!(f.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return o(i,t.length),void 0===r&&(r=t.length-i),s(r,i,t.length),l(t,i,r)}var c=i(2),u=i(11),f=c.Buffer,d=c.kMaxLength,p=e.crypto||e.msCrypto,m=Math.pow(2,32)-1;p&&p.getRandomValues||!r.browser?(t.randomFill=a,t.randomFillSync=h):(t.randomFill=n,t.randomFillSync=n)}).call(t,i(1),i(8))},function(e,t,i){"use strict";function r(e,t){function i(){o||(e&&(this.super=e.prototype),void 0!=this.init&&this.init.apply(this,arguments))}"object"===(void 0===e?"undefined":n(e))&&(t=e,e=null),e&&(o=!0,i.prototype=new e,i.prototype.constructor=i,o=!1);for(var r in t)t.hasOwnProperty(r)&&(e&&"function"==typeof t[r]&&"function"==typeof i.prototype[r]?i.prototype[r]=function(t,i){return function(){return this.base=e.prototype[t],i.apply(this,arguments)}}(r,t[r]):i.prototype[r]=t[r]);return i.prototypeDefine=t,i}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=!1;e.exports=r},function(e,t,i){"use strict";var r={},n=i(39);r.event={STOP_DRAG:"stopDrag",START_DRAG:"startDrag",DRAG_MOVE:"dragMove"};var o=!1;r.isDragging=function(){return o},r.addDrag=function(e,t,i){if(i=i||{},r.removeDrag(e),void 0!=t){e.parent.parent&&e.parent.parent.updateTransform(),e.dragRect=new PIXI.Rectangle(t.x,t.y,t.width,t.height);var s=e.parent.toGlobal(t);t={x:s.x,y:s.y,width:t.width,height:t.height}}var a=function(s){if(!s.data.isPropagationStopped){if(s.stopPropagation(),e.dragRect){var a=e.parent.toGlobal(e.dragRect);t={x:a.x,y:a.y,width:t.width,height:t.height}}o=!0;var l={x:s.data.global.x,y:s.data.global.y},h=this.toLocal(l,instance.stage),c={x:h.x-this.pivot.x,y:h.y-this.pivot.y},u=e.rotation;c=NBMath.rotaPoint(c,{x:0,y:0},u),c.x*=this.scale.x,c.y*=this.scale.y,i.bringToFront&&this.parent.addChild(this);var f=function(e){if(!e.data.isPropagationStopped){var i=this.getLocalBounds(),o=e.data.global,s={},a={left:-i.width/2-i.x+c.x,right:n.W-i.width/2-i.x+c.x};null!=t&&(a.left=t.x+c.x,a.right=t.x+t.width+c.x),l.x<a.left?s.x=a.left:l.x>a.right?s.x=a.right:s.x=l.x;var h={up:-i.height/2-i.y+c.y,down:n.H-i.height/2-i.y+c.y};null!=t&&(h.up=t.y+c.y,h.down=t.y+t.height+c.y),l.y<h.up?s.y=h.up:l.y>h.down?s.y=h.down:s.y=l.y;var u=this.parent.toLocal(s,instance.stage);this.x=u.x-c.x,this.y=u.y-c.y,this.updateTransform(),this.emit(r.event.DRAG_MOVE,{target:this,data:e.data}),l.x=o.x,l.y=o.y}},d=function(e){m.apply(this,e)},p=function(e){m.apply(this,e)},m=function(){delete this.__touchEnd__,this.removeListener(TouchEvent.TOUCH_MOVE,f),this.removeListener(TouchEvent.TOUCH_END,p),this.removeListener(TouchEvent.TOUCH_END_OUDSIDE,d),this.isDragging=!1,o=!1,s.data.isPropagationStopped||this.emit(r.event.STOP_DRAG,{target:this,data:s.data})};this.addEventListener(TouchEvent.TOUCH_MOVE,f),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,d),this.addEventListener(TouchEvent.TOUCH_END,p),this.emit(r.event.START_DRAG,{target:this,data:s.data}),this.isDragging=!0,this.__touchEnd__=p}};e.addEventListener(TouchEvent.TOUCH_BEGIN,a),e.__touchBegin__=a},r.removeDrag=function(e){e.removeListener(TouchEvent.TOUCH_BEGIN,e.__touchBegin__),e.__touchEnd__&&e.__touchEnd__(),delete e.__touchBegin__,delete e.dragRect},r.hasDrag=function(e){return void 0!==e.__touchBegin__},e.exports=r},function(e,t,i){(function(t){var r,n=this&&this.__decorate||function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e){var t=function(){function e(){}return Object.defineProperty(e,"KEYDOWN",{get:function(){return e._KEYDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"KEYUP",{get:function(){return e._KEYUP},enumerable:!0,configurable:!0}),e}();t._KEYDOWN=1,t._KEYUP=2,e.KeyboardEventTypes=t;var i=function(){function e(e,t){this.type=e,this.event=t}return e}();e.KeyboardInfo=i;var r=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.skipOnPointerObservable=!1,r}return o(t,e),t}(i);e.KeyboardInfoPre=r}(r||(r={}));var r;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"POINTERDOWN",{get:function(){return e._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERUP",{get:function(){return e._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERMOVE",{get:function(){return e._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERWHEEL",{get:function(){return e._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERPICK",{get:function(){return e._POINTERPICK},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERTAP",{get:function(){return e._POINTERTAP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERDOUBLETAP",{get:function(){return e._POINTERDOUBLETAP},enumerable:!0,configurable:!0}),e}();t._POINTERDOWN=1,t._POINTERUP=2,t._POINTERMOVE=4,t._POINTERWHEEL=8,t._POINTERPICK=16,t._POINTERTAP=32,t._POINTERDOUBLETAP=64,e.PointerEventTypes=t;var i=function(){function e(e,t){this.type=e,this.event=t}return e}();e.PointerInfoBase=i;var r=function(t){function i(i,r,n,o){var s=t.call(this,i,r)||this;return s.skipOnPointerObservable=!1,s.localPosition=new e.Vector2(n,o),s}return o(i,t),i}(i);e.PointerInfoPre=r;var n=function(e){function t(t,i,r){var n=e.call(this,t,i)||this;return n.pickInfo=r,n}return o(t,e),t}(i);e.PointerInfo=n}(r||(r={}));var r;!function(e){e.ToGammaSpace=1/2.2,e.ToLinearSpace=2.2,e.Epsilon=.001;var t=function(){function t(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.r=e,this.g=t,this.b=i}return t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},t.prototype.getClassName=function(){return"Color3"},t.prototype.getHashCode=function(){var e=this.r||0;return e=397*e^(this.g||0),e=397*e^(this.b||0)},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},t.prototype.toColor4=function(e){return void 0===e&&(e=1),new i(this.r,this.g,this.b,e)},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},t.prototype.multiply=function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b)},t.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},t.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},t.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b)},t.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},t.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},t.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},t.prototype.toHexString=function(){var t=255*this.r|0,i=255*this.g|0,r=255*this.b|0;return"#"+e.Scalar.ToHex(t)+e.Scalar.ToHex(i)+e.Scalar.ToHex(r)},t.prototype.toLinearSpace=function(){var e=new t;return this.toLinearSpaceToRef(e),e},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToLinearSpace),t.g=Math.pow(this.g,e.ToLinearSpace),t.b=Math.pow(this.b,e.ToLinearSpace),this},t.prototype.toGammaSpace=function(){var e=new t;return this.toGammaSpaceToRef(e),e},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToGammaSpace),t.g=Math.pow(this.g,e.ToGammaSpace),t.b=Math.pow(this.b,e.ToGammaSpace),this},t.FromHexString=function(e){if("#"!==e.substring(0,1)||7!==e.length)return new t(0,0,0);var i=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);return t.FromInts(i,r,n)},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[i],e[i+1],e[i+2])},t.FromInts=function(e,i,r){return new t(e/255,i/255,r/255)},t.Lerp=function(e,i,r){return new t(e.r+(i.r-e.r)*r,e.g+(i.g-e.g)*r,e.b+(i.b-e.b)*r)},t.Red=function(){return new t(1,0,0)},t.Green=function(){return new t(0,1,0)},t.Blue=function(){return new t(0,0,1)},t.Black=function(){return new t(0,0,0)},t.White=function(){return new t(1,1,1)},t.Purple=function(){return new t(.5,0,.5)},t.Magenta=function(){return new t(1,0,1)},t.Yellow=function(){return new t(1,1,0)},t.Gray=function(){return new t(.5,.5,.5)},t.Teal=function(){return new t(0,1,1)},t.Random=function(){return new t(Math.random(),Math.random(),Math.random())},t}();e.Color3=t;var i=function(){function t(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.r=e,this.g=t,this.b=i,this.a=r}return t.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},t.prototype.add=function(e){return new t(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},t.prototype.subtract=function(e){return new t(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},t.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},t.prototype.scale=function(e){return new t(this.r*e,this.g*e,this.b*e,this.a*e)},t.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},t.prototype.multiply=function(e){return new t(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},t.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var e=this.r||0;return e=397*e^(this.g||0),e=397*e^(this.b||0),e=397*e^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},t.prototype.copyFromFloats=function(e,t,i,r){return this.r=e,this.g=t,this.b=i,this.a=r,this},t.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},t.prototype.toHexString=function(){var t=255*this.r|0,i=255*this.g|0,r=255*this.b|0,n=255*this.a|0;return"#"+e.Scalar.ToHex(t)+e.Scalar.ToHex(i)+e.Scalar.ToHex(r)+e.Scalar.ToHex(n)},t.prototype.toLinearSpace=function(){var e=new t;return this.toLinearSpaceToRef(e),e},t.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToLinearSpace),t.g=Math.pow(this.g,e.ToLinearSpace),t.b=Math.pow(this.b,e.ToLinearSpace),t.a=this.a,this},t.prototype.toGammaSpace=function(){var e=new t;return this.toGammaSpaceToRef(e),e},t.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToGammaSpace),t.g=Math.pow(this.g,e.ToGammaSpace),t.b=Math.pow(this.b,e.ToGammaSpace),t.a=this.a,this},t.FromHexString=function(e){if("#"!==e.substring(0,1)||9!==e.length)return new t(0,0,0,0);var i=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),o=parseInt(e.substring(7,9),16);return t.FromInts(i,r,n,o)},t.Lerp=function(e,i,r){var n=new t(0,0,0,0);return t.LerpToRef(e,i,r,n),n},t.LerpToRef=function(e,t,i,r){r.r=e.r+(t.r-e.r)*i,r.g=e.g+(t.g-e.g)*i,r.b=e.b+(t.b-e.b)*i,r.a=e.a+(t.a-e.a)*i},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.FromInts=function(e,i,r,n){return new t(e/255,i/255,r/255,n/255)},t.CheckColors4=function(e,t){if(e.length===3*t){for(var i=[],r=0;r<e.length;r+=3){var n=r/3*4;i[n]=e[r],i[n+1]=e[r+1],i[n+2]=e[r+2],i[n+3]=1}return i}return e},t}();e.Color4=i;var r=function(){function t(e,t){this.x=e,this.y=t}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0)},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},t.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},t.prototype.set=function(e,t){return this.copyFromFloats(e,t)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},t.prototype.addVector3=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},t.prototype.multiplyByFloats=function(e,i){return new t(this.x*e,this.y*i)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e)},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.FromArray=function(e,i){return void 0===i&&(i=0),new t(e[i],e[i+1])},t.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},t.CatmullRom=function(e,i,r,n,o){var s=o*o,a=o*s;return new t(.5*(2*i.x+(-e.x+r.x)*o+(2*e.x-5*i.x+4*r.x-n.x)*s+(-e.x+3*i.x-3*r.x+n.x)*a),.5*(2*i.y+(-e.y+r.y)*o+(2*e.y-5*i.y+4*r.y-n.y)*s+(-e.y+3*i.y-3*r.y+n.y)*a))},t.Clamp=function(e,i,r){var n=e.x;n=n>r.x?r.x:n,n=n<i.x?i.x:n;var o=e.y;return o=o>r.y?r.y:o,o=o<i.y?i.y:o,new t(n,o)},t.Hermite=function(e,i,r,n,o){var s=o*o,a=o*s,l=2*a-3*s+1,h=-2*a+3*s,c=a-2*s+o,u=a-s;return new t(e.x*l+r.x*h+i.x*c+n.x*u,e.y*l+r.y*h+i.y*c+n.y*u)},t.Lerp=function(e,i,r){return new t(e.x+(i.x-e.x)*r,e.y+(i.y-e.y)*r)},t.Dot=function(e,t){return e.x*t.x+e.y*t.y},t.Normalize=function(e){var t=e.clone();return t.normalize(),t},t.Minimize=function(e,i){return new t(e.x<i.x?e.x:i.x,e.y<i.y?e.y:i.y)},t.Maximize=function(e,i){return new t(e.x>i.x?e.x:i.x,e.y>i.y?e.y:i.y)},t.Transform=function(e,i){var r=t.Zero();return t.TransformToRef(e,i,r),r},t.TransformToRef=function(e,t,i){var r=e.x*t.m[0]+e.y*t.m[4]+t.m[12],n=e.x*t.m[1]+e.y*t.m[5]+t.m[13];i.x=r,i.y=n},t.PointInTriangle=function(e,t,i,r){var n=.5*(-i.y*r.x+t.y*(-i.x+r.x)+t.x*(i.y-r.y)+i.x*r.y),o=n<0?-1:1,s=(t.y*r.x-t.x*r.y+(r.y-t.y)*e.x+(t.x-r.x)*e.y)*o,a=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return s>0&&a>0&&s+a<2*n*o},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.DistanceOfPointFromSegment=function(e,i,r){var n=t.DistanceSquared(i,r);if(0===n)return t.Distance(e,i);var o=r.subtract(i),s=Math.max(0,Math.min(1,t.Dot(e.subtract(i),o)/n)),a=i.add(o.multiplyByFloats(s,s));return t.Distance(e,a)},t}();e.Vector2=r;var n=function(){function t(e,t,i){this.x=e,this.y=t,this.z=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0)},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},t.prototype.toQuaternion=function(){var e=new a(0,0,0,1),t=Math.cos(.5*(this.x+this.z)),i=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),n=Math.sin(.5*(this.z-this.x)),o=Math.cos(.5*this.y),s=Math.sin(.5*this.y);return e.x=r*s,e.y=-n*s,e.z=i*o,e.w=t*o,e},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,this},t.prototype.subtractFromFloats=function(e,i,r){return new t(this.x-e,this.y-i,this.z-r)},t.prototype.subtractFromFloatsToRef=function(e,t,i,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)&&e.Scalar.WithinEpsilon(this.z,t.z,i)},t.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,this},t.prototype.multiplyByFloats=function(e,i,r){return new t(this.x*e,this.y*i,this.z*r)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,this},t.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),this},t.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this},Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var e=Math.abs(this.x),t=Math.abs(this.y);if(e!==t)return!0;var i=Math.abs(this.z);return e!==i||t!==i},enumerable:!0,configurable:!0}),t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var e=this.length();if(0===e||1===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.normalizeToNew=function(){var e=new t(0,0,0);return this.normalizeToRef(e),e},t.prototype.normalizeToRef=function(e){var t=this.length();if(0===t||1===t)return e.set(this.x,this.y,this.z),e;var i=1/t;return this.scaleToRef(i,e),e},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},t.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},t.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},t.GetClipFactor=function(e,i,r,n){var o=t.Dot(e,r)-n;return o/(o-(t.Dot(i,r)-n))},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2])},t.FromFloatArray=function(e,i){return t.FromArray(e,i)},t.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},t.FromFloatArrayToRef=function(e,i,r){return t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,t,i,r){r.x=e,r.y=t,r.z=i},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},t.Forward=function(){return new t(0,0,1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(e,i){var r=t.Zero();return t.TransformCoordinatesToRef(e,i,r),r},t.TransformCoordinatesToRef=function(e,t,i){var r=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8]+t.m[12],n=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9]+t.m[13],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]+t.m[14],s=e.x*t.m[3]+e.y*t.m[7]+e.z*t.m[11]+t.m[15];i.x=r/s,i.y=n/s,i.z=o/s},t.TransformCoordinatesFromFloatsToRef=function(e,t,i,r,n){var o=e*r.m[0]+t*r.m[4]+i*r.m[8]+r.m[12],s=e*r.m[1]+t*r.m[5]+i*r.m[9]+r.m[13],a=e*r.m[2]+t*r.m[6]+i*r.m[10]+r.m[14],l=e*r.m[3]+t*r.m[7]+i*r.m[11]+r.m[15];n.x=o/l,n.y=s/l,n.z=a/l},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,t,i){var r=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],n=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10];i.x=r,i.y=n,i.z=o},t.TransformNormalFromFloatsToRef=function(e,t,i,r,n){n.x=e*r.m[0]+t*r.m[4]+i*r.m[8],n.y=e*r.m[1]+t*r.m[5]+i*r.m[9],n.z=e*r.m[2]+t*r.m[6]+i*r.m[10]},t.CatmullRom=function(e,i,r,n,o){var s=o*o,a=o*s;return new t(.5*(2*i.x+(-e.x+r.x)*o+(2*e.x-5*i.x+4*r.x-n.x)*s+(-e.x+3*i.x-3*r.x+n.x)*a),.5*(2*i.y+(-e.y+r.y)*o+(2*e.y-5*i.y+4*r.y-n.y)*s+(-e.y+3*i.y-3*r.y+n.y)*a),.5*(2*i.z+(-e.z+r.z)*o+(2*e.z-5*i.z+4*r.z-n.z)*s+(-e.z+3*i.z-3*r.z+n.z)*a))},t.Clamp=function(e,i,r){var n=e.x;n=n>r.x?r.x:n,n=n<i.x?i.x:n;var o=e.y;o=o>r.y?r.y:o,o=o<i.y?i.y:o;var s=e.z;return s=s>r.z?r.z:s,s=s<i.z?i.z:s,new t(n,o,s)},t.Hermite=function(e,i,r,n,o){var s=o*o,a=o*s,l=2*a-3*s+1,h=-2*a+3*s,c=a-2*s+o,u=a-s;return new t(e.x*l+r.x*h+i.x*c+n.x*u,e.y*l+r.y*h+i.y*c+n.y*u,e.z*l+r.z*h+i.z*c+n.z*u)},t.Lerp=function(e,i,r){var n=new t(0,0,0);return t.LerpToRef(e,i,r,n),n},t.LerpToRef=function(e,t,i,r){r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i,r.z=e.z+(t.z-e.z)*i},t.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},t.Cross=function(e,i){var r=t.Zero();return t.CrossToRef(e,i,r),r},t.CrossToRef=function(e,t,i){E.Vector3[0].x=e.y*t.z-e.z*t.y,E.Vector3[0].y=e.z*t.x-e.x*t.z,E.Vector3[0].z=e.x*t.y-e.y*t.x,i.copyFrom(E.Vector3[0])},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Project=function(e,i,r,n){var o=n.width,s=n.height,a=n.x,h=n.y,c=t._viewportMatrixCache?t._viewportMatrixCache:t._viewportMatrixCache=new l;l.FromValuesToRef(o/2,0,0,0,0,-s/2,0,0,0,0,.5,0,a+o/2,s/2+h,.5,1,c);var u=E.Matrix[0];return i.multiplyToRef(r,u),u.multiplyToRef(c,u),t.TransformCoordinates(e,u)},t.UnprojectFromTransform=function(i,r,n,o,s){var a=E.Matrix[0];o.multiplyToRef(s,a),a.invert(),i.x=i.x/r*2-1,i.y=-(i.y/n*2-1);var l=t.TransformCoordinates(i,a),h=i.x*a.m[3]+i.y*a.m[7]+i.z*a.m[11]+a.m[15];return e.Scalar.WithinEpsilon(h,1)&&(l=l.scale(1/h)),l},t.Unproject=function(e,i,r,n,o,s){var a=t.Zero();return t.UnprojectToRef(e,i,r,n,o,s,a),a},t.UnprojectToRef=function(e,i,r,n,o,s,a){t.UnprojectFloatsToRef(e.x,e.y,e.z,i,r,n,o,s,a)},t.UnprojectFloatsToRef=function(i,r,n,o,s,a,l,h,c){var u=E.Matrix[0];a.multiplyToRef(l,u),u.multiplyToRef(h,u),u.invert();var f=E.Vector3[0];f.x=i/o*2-1,f.y=-(r/s*2-1),f.z=2*n-1,t.TransformCoordinatesToRef(f,u,c);var d=f.x*u.m[3]+f.y*u.m[7]+f.z*u.m[11]+u.m[15];e.Scalar.WithinEpsilon(d,1)&&c.scaleInPlace(1/d)},t.Minimize=function(e,t){var i=e.clone();return i.MinimizeInPlace(t),i},t.Maximize=function(e,t){var i=e.clone();return i.MaximizeInPlace(t),i},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return i*i+r*r+n*n},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.RotationFromAxis=function(e,i,r){var n=t.Zero();return t.RotationFromAxisToRef(e,i,r,n),n},t.RotationFromAxisToRef=function(e,t,i,r){var n=E.Quaternion[0];a.RotationQuaternionFromAxisToRef(e,t,i,n),n.toEulerAnglesToRef(r)},t}();e.Vector3=n;var o=function(){function t(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0),e=397*e^(this.w||0)},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},t.prototype.subtractFromFloats=function(e,i,r,n){return new t(this.x-e,this.y-i,this.z-r,this.w-n)},t.prototype.subtractFromFloatsToRef=function(e,t,i,r,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,n.w=this.w-r,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},t.prototype.equalsWithEpsilon=function(t,i){return void 0===i&&(i=e.Epsilon),t&&e.Scalar.WithinEpsilon(this.x,t.x,i)&&e.Scalar.WithinEpsilon(this.y,t.y,i)&&e.Scalar.WithinEpsilon(this.z,t.z,i)&&e.Scalar.WithinEpsilon(this.w,t.w,i)},t.prototype.equalsToFloats=function(e,t,i,r){return this.x===e&&this.y===t&&this.z===i&&this.w===r},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},t.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},t.prototype.multiplyByFloats=function(e,i,r,n){return new t(this.x*e,this.y*i,this.z*r,this.w*n)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},t.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},t.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},t.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toVector3=function(){return new n(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},t.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},t.FromFloatArrayToRef=function(e,i,r){t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,t,i,r,n){n.x=e,n.y=t,n.z=i,n.w=r},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},t.Minimize=function(e,t){var i=e.clone();return i.MinimizeInPlace(t),i},t.Maximize=function(e,t){var i=e.clone();return i.MaximizeInPlace(t),i},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,t){var i=e.x-t.x,r=e.y-t.y,n=e.z-t.z,o=e.w-t.w;return i*i+r*r+n*n+o*o},t.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,t,i){var r=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],n=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10];i.x=r,i.y=n,i.z=o,i.w=e.w},t.TransformNormalFromFloatsToRef=function(e,t,i,r,n,o){o.x=e*n.m[0]+t*n.m[4]+i*n.m[8],o.y=e*n.m[1]+t*n.m[5]+i*n.m[9],o.z=e*n.m[2]+t*n.m[6]+i*n.m[10],o.w=r},t}();e.Vector4=o;var s=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=this.width||0;return e=397*e^(this.height||0)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,i){return new e(this.width*t,this.height*i)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&(this.width===e.width&&this.height===e.height)},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,i,r){return new e(t.width+(i.width-t.width)*r,t.height+(i.height-t.height)*r)},e}();e.Size=s;var a=function(){function t(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=e,this.y=t,this.z=i,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0),e=397*e^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.copyFromFloats=function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},t.prototype.set=function(e,t,i,r){return this.copyFromFloats(e,t,i,r)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.multiply=function(e){var i=new t(0,0,0,1);return this.multiplyToRef(e,i),i},t.prototype.multiplyToRef=function(e,t){var i=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,r=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,n=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(i,r,n,o),this},t.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},t.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){return new t(-this.x,-this.y,-this.z,this.w)},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=n.Zero();return this.toEulerAnglesToRef(t,e),t},t.prototype.toEulerAnglesToRef=function(e,t){void 0===t&&(t="YZX");var i=this.z,r=this.x,n=this.y,o=this.w,s=o*o,a=i*i,l=r*r,h=n*n,c=n*i-r*o;return c<-.4999999?(e.y=2*Math.atan2(n,o),e.x=Math.PI/2,e.z=0):c>.4999999?(e.y=2*Math.atan2(n,o),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(r*n+i*o),-a-l+h+s),e.x=Math.asin(-2*(i*n-r*o)),e.y=Math.atan2(2*(i*r+n*o),a-l-h+s)),this},t.prototype.toRotationMatrix=function(e){var t=this.x*this.x,i=this.y*this.y,r=this.z*this.z,n=this.x*this.y,o=this.z*this.w,s=this.z*this.x,a=this.y*this.w,l=this.y*this.z,h=this.x*this.w;return e.m[0]=1-2*(i+r),e.m[1]=2*(n+o),e.m[2]=2*(s-a),e.m[3]=0,e.m[4]=2*(n-o),e.m[5]=1-2*(r+t),e.m[6]=2*(l+h),e.m[7]=0,e.m[8]=2*(s+a),e.m[9]=2*(l-h),e.m[10]=1-2*(i+t),e.m[11]=0,e.m[12]=0,e.m[13]=0,e.m[14]=0,e.m[15]=1,e._markAsUpdated(),this},t.prototype.fromRotationMatrix=function(e){return t.FromRotationMatrixToRef(e,this),this},t.FromRotationMatrix=function(e){var i=new t;return t.FromRotationMatrixToRef(e,i),i},t.FromRotationMatrixToRef=function(e,t){var i,r=e.m,n=r[0],o=r[4],s=r[8],a=r[1],l=r[5],h=r[9],c=r[2],u=r[6],f=r[10],d=n+l+f;d>0?(i=.5/Math.sqrt(d+1),t.w=.25/i,t.x=(u-h)*i,t.y=(s-c)*i,t.z=(a-o)*i):n>l&&n>f?(i=2*Math.sqrt(1+n-l-f),t.w=(u-h)/i,t.x=.25*i,t.y=(o+a)/i,t.z=(s+c)/i):l>f?(i=2*Math.sqrt(1+l-n-f),t.w=(s-c)/i,t.x=(o+a)/i,t.y=.25*i,t.z=(h+u)/i):(i=2*Math.sqrt(1+f-n-l),t.w=(a-o)/i,t.x=(s+c)/i,t.y=(h+u)/i,t.z=.25*i)},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(e){return new t(-e.x,-e.y,-e.z,e.w)},t.Identity=function(){return new t(0,0,0,1)},t.IsIdentity=function(e){return e&&0===e.x&&0===e.y&&0===e.z&&1===e.w},t.RotationAxis=function(e,i){return t.RotationAxisToRef(e,i,new t)},t.RotationAxisToRef=function(e,t,i){var r=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e.x*r,i.y=e.y*r,i.z=e.z*r,i},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){var n=.5*i,o=.5*t,s=.5*e,a=Math.sin(n),l=Math.cos(n),h=Math.sin(o),c=Math.cos(o),u=Math.sin(s),f=Math.cos(s);r.x=f*h*l+u*c*a,r.y=u*c*l-f*h*a,r.z=f*c*a-u*h*l,r.w=f*c*l+u*h*a},t.RotationAlphaBetaGamma=function(e,i,r){var n=new t;return t.RotationAlphaBetaGammaToRef(e,i,r,n),n},t.RotationAlphaBetaGammaToRef=function(e,t,i,r){var n=.5*(i+e),o=.5*(i-e),s=.5*t;r.x=Math.cos(o)*Math.sin(s),r.y=Math.sin(o)*Math.sin(s),r.z=Math.sin(n)*Math.cos(s),r.w=Math.cos(n)*Math.cos(s)},t.RotationQuaternionFromAxis=function(e,i,r,n){var o=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(e,i,r,o),o},t.RotationQuaternionFromAxisToRef=function(t,i,r,n){var o=E.Matrix[0];e.Matrix.FromXYZAxesToRef(t.normalize(),i.normalize(),r.normalize(),o),e.Quaternion.FromRotationMatrixToRef(o,n)},t.Slerp=function(e,i,r){var n=t.Identity();return t.SlerpToRef(e,i,r,n),n},t.SlerpToRef=function(e,t,i,r){var n,o,s=i,a=e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,l=!1;if(a<0&&(l=!0,a=-a),a>.999999)o=1-s,n=l?-s:s;else{var h=Math.acos(a),c=1/Math.sin(h);o=Math.sin((1-s)*h)*c,n=l?-Math.sin(s*h)*c:Math.sin(s*h)*c}r.x=o*e.x+n*t.x,r.y=o*e.y+n*t.y,r.z=o*e.z+n*t.z,r.w=o*e.w+n*t.w},t.Hermite=function(e,i,r,n,o){var s=o*o,a=o*s,l=2*a-3*s+1,h=-2*a+3*s,c=a-2*s+o,u=a-s;return new t(e.x*l+r.x*h+i.x*c+n.x*u,e.y*l+r.y*h+i.y*c+n.y*u,e.z*l+r.z*h+i.z*c+n.z*u,e.w*l+r.w*h+i.w*c+n.w*u)},t}();e.Quaternion=a;var l=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this.m=new Float32Array(16),this._markAsUpdated()}return t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentityDirty=!0},t.prototype.isIdentity=function(e){return void 0===e&&(e=!1),this._isIdentityDirty&&(this._isIdentityDirty=!1,1!==this.m[0]||1!==this.m[5]||1!==this.m[15]?this._isIdentity=!1:0!==this.m[1]||0!==this.m[2]||0!==this.m[3]||0!==this.m[4]||0!==this.m[6]||0!==this.m[7]||0!==this.m[8]||0!==this.m[9]||0!==this.m[11]||0!==this.m[12]||0!==this.m[13]||0!==this.m[14]?this._isIdentity=!1:this._isIdentity=!0,e||1===this.m[10]||(this._isIdentity=!1)),this._isIdentity},t.prototype.determinant=function(){var e=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],i=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],n=this.m[8]*this.m[14]-this.m[10]*this.m[12],o=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*e-this.m[6]*t+this.m[7]*i)-this.m[1]*(this.m[4]*e-this.m[6]*r+this.m[7]*n)+this.m[2]*(this.m[4]*t-this.m[5]*r+this.m[7]*o)-this.m[3]*(this.m[4]*i-this.m[5]*n+this.m[6]*o)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var e=0;e<16;e++)this.m[e]=0;return this._markAsUpdated(),this},t.prototype.add=function(e){var i=new t;return this.addToRef(e,i),i},t.prototype.addToRef=function(e,t){for(var i=0;i<16;i++)t.m[i]=this.m[i]+e.m[i];return t._markAsUpdated(),this},t.prototype.addToSelf=function(e){for(var t=0;t<16;t++)this.m[t]+=e.m[t];return this._markAsUpdated(),this},t.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],a=this.m[6],l=this.m[7],h=this.m[8],c=this.m[9],u=this.m[10],f=this.m[11],d=this.m[12],p=this.m[13],m=this.m[14],g=this.m[15],v=u*g-f*m,y=c*g-f*p,_=c*m-u*p,b=h*g-f*d,x=h*m-u*d,T=h*p-c*d,E=s*v-a*y+l*_,S=-(o*v-a*b+l*x),w=o*y-s*b+l*T,M=-(o*_-s*x+a*T),A=1/(t*E+i*S+r*w+n*M),P=a*g-l*m,C=s*g-l*p,R=s*m-a*p,D=o*g-l*d,I=o*m-a*d,O=o*p-s*d,F=a*f-l*u,L=s*f-l*c,B=s*u-a*c,N=o*f-l*h,k=o*u-a*h,V=o*c-s*h;return e.m[0]=E*A,e.m[4]=S*A,e.m[8]=w*A,e.m[12]=M*A,e.m[1]=-(i*v-r*y+n*_)*A,e.m[5]=(t*v-r*b+n*x)*A,e.m[9]=-(t*y-i*b+n*T)*A,e.m[13]=(t*_-i*x+r*T)*A,e.m[2]=(i*P-r*C+n*R)*A,e.m[6]=-(t*P-r*D+n*I)*A,e.m[10]=(t*C-i*D+n*O)*A,e.m[14]=-(t*R-i*I+r*O)*A,e.m[3]=-(i*F-r*L+n*B)*A,e.m[7]=(t*F-r*N+n*k)*A,e.m[11]=-(t*L-i*N+n*V)*A,e.m[15]=(t*B-i*k+r*V)*A,e._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(e,t,i){return this.m[12]=e,this.m[13]=t,this.m[14]=i,this._markAsUpdated(),this},t.prototype.setTranslation=function(e){return this.m[12]=e.x,this.m[13]=e.y,this.m[14]=e.z,this._markAsUpdated(),this},t.prototype.getTranslation=function(){return new n(this.m[12],this.m[13],this.m[14])},t.prototype.getTranslationToRef=function(e){return e.x=this.m[12],e.y=this.m[13],e.z=this.m[14],this},t.prototype.removeRotationAndScaling=function(){return this.setRowFromFloats(0,1,0,0,0),this.setRowFromFloats(1,0,1,0,0),this.setRowFromFloats(2,0,0,1,0),this},t.prototype.multiply=function(e){var i=new t;return this.multiplyToRef(e,i),i},t.prototype.copyFrom=function(e){for(var t=0;t<16;t++)this.m[t]=e.m[t];return this._markAsUpdated(),this},t.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)e[t+i]=this.m[i];return this},t.prototype.multiplyToRef=function(e,t){return this.multiplyToArray(e,t.m,0),t._markAsUpdated(),this},t.prototype.multiplyToArray=function(e,t,i){var r=this.m[0],n=this.m[1],o=this.m[2],s=this.m[3],a=this.m[4],l=this.m[5],h=this.m[6],c=this.m[7],u=this.m[8],f=this.m[9],d=this.m[10],p=this.m[11],m=this.m[12],g=this.m[13],v=this.m[14],y=this.m[15],_=e.m[0],b=e.m[1],x=e.m[2],T=e.m[3],E=e.m[4],S=e.m[5],w=e.m[6],M=e.m[7],A=e.m[8],P=e.m[9],C=e.m[10],R=e.m[11],D=e.m[12],I=e.m[13],O=e.m[14],F=e.m[15];return t[i]=r*_+n*E+o*A+s*D,t[i+1]=r*b+n*S+o*P+s*I,t[i+2]=r*x+n*w+o*C+s*O,t[i+3]=r*T+n*M+o*R+s*F,t[i+4]=a*_+l*E+h*A+c*D,t[i+5]=a*b+l*S+h*P+c*I,t[i+6]=a*x+l*w+h*C+c*O,t[i+7]=a*T+l*M+h*R+c*F,t[i+8]=u*_+f*E+d*A+p*D,t[i+9]=u*b+f*S+d*P+p*I,t[i+10]=u*x+f*w+d*C+p*O,t[i+11]=u*T+f*M+d*R+p*F,t[i+12]=m*_+g*E+v*A+y*D,t[i+13]=m*b+g*S+v*P+y*I,t[i+14]=m*x+g*w+v*C+y*O,t[i+15]=m*T+g*M+v*R+y*F,this},t.prototype.equals=function(e){return e&&this.m[0]===e.m[0]&&this.m[1]===e.m[1]&&this.m[2]===e.m[2]&&this.m[3]===e.m[3]&&this.m[4]===e.m[4]&&this.m[5]===e.m[5]&&this.m[6]===e.m[6]&&this.m[7]===e.m[7]&&this.m[8]===e.m[8]&&this.m[9]===e.m[9]&&this.m[10]===e.m[10]&&this.m[11]===e.m[11]&&this.m[12]===e.m[12]&&this.m[13]===e.m[13]&&this.m[14]===e.m[14]&&this.m[15]===e.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var e=this.m[0]||0,t=1;t<16;t++)e=397*e^(this.m[t]||0);return e},t.prototype.decompose=function(e,i,r){return r.x=this.m[12],r.y=this.m[13],r.z=this.m[14],e.x=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),e.y=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),e.z=Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),this.determinant()<=0&&(e.y*=-1),0===e.x||0===e.y||0===e.z?(i.x=0,i.y=0,i.z=0,i.w=1,!1):(t.FromValuesToRef(this.m[0]/e.x,this.m[1]/e.x,this.m[2]/e.x,0,this.m[4]/e.y,this.m[5]/e.y,this.m[6]/e.y,0,this.m[8]/e.z,this.m[9]/e.z,this.m[10]/e.z,0,0,0,0,1,E.Matrix[0]),a.FromRotationMatrixToRef(E.Matrix[0],i),!0)},t.prototype.getRotationMatrix=function(){var e=t.Identity();return this.getRotationMatrixToRef(e),e},t.prototype.getRotationMatrixToRef=function(e){var i=this.m,r=i[0]*i[1]*i[2]*i[3]<0?-1:1,n=i[4]*i[5]*i[6]*i[7]<0?-1:1,o=i[8]*i[9]*i[10]*i[11]<0?-1:1,s=r*Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),a=n*Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),l=o*Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]);return t.FromValuesToRef(i[0]/s,i[1]/s,i[2]/s,0,i[4]/a,i[5]/a,i[6]/a,0,i[8]/l,i[9]/l,i[10]/l,0,0,0,0,1,e),this},t.FromArray=function(e,i){var r=new t;return i||(i=0),t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,t,i){for(var r=0;r<16;r++)i.m[r]=e[r+t];i._markAsUpdated()},t.FromFloat32ArrayToRefScaled=function(e,t,i,r){for(var n=0;n<16;n++)r.m[n]=e[n+t]*i;r._markAsUpdated()},t.FromValuesToRef=function(e,t,i,r,n,o,s,a,l,h,c,u,f,d,p,m,g){g.m[0]=e,g.m[1]=t,g.m[2]=i,g.m[3]=r,g.m[4]=n,g.m[5]=o,g.m[6]=s,g.m[7]=a,g.m[8]=l,g.m[9]=h,g.m[10]=c,g.m[11]=u,g.m[12]=f,g.m[13]=d,g.m[14]=p,g.m[15]=m,g._markAsUpdated()},t.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new o(this.m[t+0],this.m[t+1],this.m[t+2],this.m[t+3])},t.prototype.setRow=function(e,t){if(e<0||e>3)return this;var i=4*e;return this.m[i+0]=t.x,this.m[i+1]=t.y,this.m[i+2]=t.z,this.m[i+3]=t.w,this._markAsUpdated(),this},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(e){return t.TransposeToRef(this,e),this},t.prototype.setRowFromFloats=function(e,t,i,r,n){if(e<0||e>3)return this;var o=4*e;return this.m[o+0]=t,this.m[o+1]=i,this.m[o+2]=r,this.m[o+3]=n,this._markAsUpdated(),this},Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!0,configurable:!0}),t.FromValues=function(e,i,r,n,o,s,a,l,h,c,u,f,d,p,m,g){var v=new t;return v.m[0]=e,v.m[1]=i,v.m[2]=r,v.m[3]=n,v.m[4]=o,v.m[5]=s,v.m[6]=a,v.m[7]=l,v.m[8]=h,v.m[9]=c,v.m[10]=u,v.m[11]=f,v.m[12]=d,v.m[13]=p,v.m[14]=m,v.m[15]=g,v},t.Compose=function(e,i,r){var n=t.Identity();return t.ComposeToRef(e,i,r,n),n},t.ComposeToRef=function(e,i,r,n){t.FromValuesToRef(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1,E.Matrix[1]),i.toRotationMatrix(E.Matrix[0]),E.Matrix[1].multiplyToRef(E.Matrix[0],n),n.setTranslation(r)},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=r,t.m[10]=r,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t._markAsUpdated()},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=r,t.m[2]=-i,t.m[8]=i,t.m[10]=r,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t._markAsUpdated()},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=r,t.m[1]=i,t.m[4]=-i,t.m[5]=r,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t._markAsUpdated()},t.RotationAxis=function(e,i){var r=t.Zero();return t.RotationAxisToRef(e,i,r),r},t.RotationAxisToRef=function(e,t,i){var r=Math.sin(-t),n=Math.cos(-t),o=1-n;e.normalize(),i.m[0]=e.x*e.x*o+n,i.m[1]=e.x*e.y*o-e.z*r,i.m[2]=e.x*e.z*o+e.y*r,i.m[3]=0,i.m[4]=e.y*e.x*o+e.z*r,i.m[5]=e.y*e.y*o+n,i.m[6]=e.y*e.z*o-e.x*r,i.m[7]=0,i.m[8]=e.z*e.x*o-e.y*r,i.m[9]=e.z*e.y*o+e.x*r,i.m[10]=e.z*e.z*o+n,i.m[11]=0,i.m[15]=1,i._markAsUpdated()},t.RotationYawPitchRoll=function(e,i,r){var n=new t;return t.RotationYawPitchRollToRef(e,i,r,n),n},t.RotationYawPitchRollToRef=function(e,t,i,r){a.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(e,i,r){var n=t.Zero();return t.ScalingToRef(e,i,r,n),n},t.ScalingToRef=function(e,t,i,r){r.m[0]=e,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=t,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=i,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1,r._markAsUpdated()},t.Translation=function(e,i,r){var n=t.Identity();return t.TranslationToRef(e,i,r,n),n},t.TranslationToRef=function(e,i,r,n){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,n)},t.Lerp=function(e,i,r){for(var n=t.Zero(),o=0;o<16;o++)n.m[o]=e.m[o]*(1-r)+i.m[o]*r;return n._markAsUpdated(),n},t.DecomposeLerp=function(e,i,r){var o=new n(0,0,0),s=new a,l=new n(0,0,0);e.decompose(o,s,l);var h=new n(0,0,0),c=new a,u=new n(0,0,0);i.decompose(h,c,u);var f=n.Lerp(o,h,r),d=a.Slerp(s,c,r),p=n.Lerp(l,u,r);return t.Compose(f,d,p)},t.LookAtLH=function(e,i,r){var n=t.Zero();return t.LookAtLHToRef(e,i,r,n),n},t.LookAtLHToRef=function(e,i,r,o){i.subtractToRef(e,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),l=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,l,1,o)},t.LookAtRH=function(e,i,r){var n=t.Zero();return t.LookAtRHToRef(e,i,r,n),n},t.LookAtRHToRef=function(e,i,r,o){e.subtractToRef(i,this._zAxis),this._zAxis.normalize(),n.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),n.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-n.Dot(this._xAxis,e),a=-n.Dot(this._yAxis,e),l=-n.Dot(this._zAxis,e);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,l,1,o)},t.OrthoLH=function(e,i,r,n){var o=t.Zero();return t.OrthoLHToRef(e,i,r,n,o),o},t.OrthoLHToRef=function(t,i,r,n,o){var s=r,a=n,l=2/t,h=2/i,c=2/(a-s),u=-(a+s)/(a-s);e.Matrix.FromValuesToRef(l,0,0,0,0,h,0,0,0,0,c,0,0,0,u,1,o)},t.OrthoOffCenterLH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterLHToRef=function(t,i,r,n,o,s,a){var l=o,h=s,c=2/(i-t),u=2/(n-r),f=2/(h-l),d=-(h+l)/(h-l),p=(t+i)/(t-i),m=(n+r)/(r-n);e.Matrix.FromValuesToRef(c,0,0,0,0,u,0,0,0,0,f,0,p,m,d,1,a)},t.OrthoOffCenterRH=function(e,i,r,n,o,s){var a=t.Zero();return t.OrthoOffCenterRHToRef(e,i,r,n,o,s,a),a},t.OrthoOffCenterRHToRef=function(e,i,r,n,o,s,a){t.OrthoOffCenterLHToRef(e,i,r,n,o,s,a),a.m[10]*=-1},t.PerspectiveLH=function(i,r,n,o){var s=t.Zero(),a=n,l=o,h=2*a/i,c=2*a/r,u=(l+a)/(l-a),f=-2*l*a/(l-a);return e.Matrix.FromValuesToRef(h,0,0,0,0,c,0,0,0,0,u,1,0,0,f,0,s),s},t.PerspectiveFovLH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovLHToRef(e,i,r,n,o),o},t.PerspectiveFovLHToRef=function(t,i,r,n,o,s){void 0===s&&(s=!0);var a=r,l=n,h=1/Math.tan(.5*t),c=s?h/i:h,u=s?h:h*i,f=(l+a)/(l-a),d=-2*l*a/(l-a);e.Matrix.FromValuesToRef(c,0,0,0,0,u,0,0,0,0,f,1,0,0,d,0,o)},t.PerspectiveFovRH=function(e,i,r,n){var o=t.Zero();return t.PerspectiveFovRHToRef(e,i,r,n,o),o},t.PerspectiveFovRHToRef=function(t,i,r,n,o,s){void 0===s&&(s=!0);var a=r,l=n,h=1/Math.tan(.5*t),c=s?h/i:h,u=s?h:h*i,f=-(l+a)/(l-a),d=-2*l*a/(l-a);e.Matrix.FromValuesToRef(c,0,0,0,0,u,0,0,0,0,f,-1,0,0,d,0,o)},t.PerspectiveFovWebVRToRef=function(e,t,i,r,n){void 0===n&&(n=!1);var o=n?-1:1,s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),h=Math.tan(e.rightDegrees*Math.PI/180),c=2/(l+h),u=2/(s+a);r.m[0]=c,r.m[1]=r.m[2]=r.m[3]=r.m[4]=0,r.m[5]=u,r.m[6]=r.m[7]=0,r.m[8]=(l-h)*c*.5,r.m[9]=-(s-a)*u*.5,r.m[10]=-i/(t-i),r.m[11]=1*o,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=-2*i*t/(i-t),r._markAsUpdated()},t.GetFinalMatrix=function(e,i,r,n,o,s){var a=e.width,l=e.height,h=e.x,c=e.y,u=t.FromValues(a/2,0,0,0,0,-l/2,0,0,0,0,s-o,0,h+a/2,l/2+c,o,1);return i.multiply(r).multiply(n).multiply(u)},t.GetAsMatrix2x2=function(e){return new Float32Array([e.m[0],e.m[1],e.m[4],e.m[5]])},t.GetAsMatrix3x3=function(e){return new Float32Array([e.m[0],e.m[1],e.m[2],e.m[4],e.m[5],e.m[6],e.m[8],e.m[9],e.m[10]])},t.Transpose=function(e){var i=new t;return t.TransposeToRef(e,i),i},t.TransposeToRef=function(e,t){t.m[0]=e.m[0],t.m[1]=e.m[4],t.m[2]=e.m[8],t.m[3]=e.m[12],t.m[4]=e.m[1],t.m[5]=e.m[5],t.m[6]=e.m[9],t.m[7]=e.m[13],t.m[8]=e.m[2],t.m[9]=e.m[6],t.m[10]=e.m[10],t.m[11]=e.m[14],t.m[12]=e.m[3],t.m[13]=e.m[7],t.m[14]=e.m[11],t.m[15]=e.m[15]},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,r=e.normal.y,n=e.normal.z,o=-2*i,s=-2*r,a=-2*n;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*r,t.m[5]=s*r+1,t.m[6]=a*r,t.m[7]=0,t.m[8]=o*n,t.m[9]=s*n,t.m[10]=a*n+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1,t._markAsUpdated()},t.FromXYZAxesToRef=function(e,t,i,r){r.m[0]=e.x,r.m[1]=e.y,r.m[2]=e.z,r.m[3]=0,r.m[4]=t.x,r.m[5]=t.y,r.m[6]=t.z,r.m[7]=0,r.m[8]=i.x,r.m[9]=i.y,r.m[10]=i.z,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1,r._markAsUpdated()},t.FromQuaternionToRef=function(e,t){var i=e.x*e.x,r=e.y*e.y,n=e.z*e.z,o=e.x*e.y,s=e.z*e.w,a=e.z*e.x,l=e.y*e.w,h=e.y*e.z,c=e.x*e.w;t.m[0]=1-2*(r+n),t.m[1]=2*(o+s),t.m[2]=2*(a-l),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(n+i),t.m[6]=2*(h+c),t.m[7]=0,t.m[8]=2*(a+l),t.m[9]=2*(h-c),t.m[10]=1-2*(r+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,t._markAsUpdated()},t}();l._tempQuaternion=new a,l._xAxis=n.Zero(),l._yAxis=n.Zero(),l._zAxis=n.Zero(),l._updateFlagSeed=0,l._identityReadOnly=l.Identity(),e.Matrix=l;var h=function(){function e(e,t,i,r){this.normal=new n(e,t,i),this.d=r}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(this.d||0)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=l.Transpose(t),r=this.normal.x,n=this.normal.y,o=this.normal.z,s=this.d;return new e(r*i.m[0]+n*i.m[1]+o*i.m[2]+s*i.m[3],r*i.m[4]+n*i.m[5]+o*i.m[6]+s*i.m[7],r*i.m[8]+n*i.m[9]+o*i.m[10]+s*i.m[11],r*i.m[12]+n*i.m[13]+o*i.m[14]+s*i.m[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var r,n=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,l=i.y-e.y,h=i.z-e.z,c=o*h-s*l,u=s*a-n*h,f=n*l-o*a,d=Math.sqrt(c*c+u*u+f*f);return r=0!==d?1/d:0,this.normal.x=c*r,this.normal.y=u*r,this.normal.z=f*r,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return n.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return n.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,r){var n=new e(0,0,0,0);return n.copyFromPoints(t,i,r),n},e.FromPositionAndNormal=function(t,i){var r=new e(0,0,0,0);return i.normalize(),r.normal=i,r.d=-(i.x*t.x+i.y*t.y+i.z*t.z),r},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var r=-(t.x*e.x+t.y*e.y+t.z*e.z);return n.Dot(i,t)+r},e}();e.Plane=h;var c=function(){function e(e,t,i,r){this.x=e,this.y=t,this.width=i,this.height=r}return e.prototype.toGlobal=function(t,i){if(t.getRenderWidth){var r=t;return this.toGlobal(r.getRenderWidth(),r.getRenderHeight())}var n=t;return new e(this.x*n,this.y*i,this.width*n,this.height*i)},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}();e.Viewport=c;var u=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],r=0;r<6;r++)i.push(new h(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetNearPlaneToRef=function(e,t){t.normal.x=e.m[3]+e.m[2],t.normal.y=e.m[7]+e.m[6],t.normal.z=e.m[11]+e.m[10],t.d=e.m[15]+e.m[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){t.normal.x=e.m[3]-e.m[2],t.normal.y=e.m[7]-e.m[6],t.normal.z=e.m[11]-e.m[10],t.d=e.m[15]-e.m[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){t.normal.x=e.m[3]+e.m[0],t.normal.y=e.m[7]+e.m[4],t.normal.z=e.m[11]+e.m[8],t.d=e.m[15]+e.m[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){t.normal.x=e.m[3]-e.m[0],t.normal.y=e.m[7]-e.m[4],t.normal.z=e.m[11]-e.m[8],t.d=e.m[15]-e.m[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){t.normal.x=e.m[3]-e.m[1],t.normal.y=e.m[7]-e.m[5],t.normal.z=e.m[11]-e.m[9],t.d=e.m[15]-e.m[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){t.normal.x=e.m[3]+e.m[1],t.normal.y=e.m[7]+e.m[5],t.normal.z=e.m[11]+e.m[9],t.d=e.m[15]+e.m[13],t.normalize()},e.GetPlanesToRef=function(t,i){e.GetNearPlaneToRef(t,i[0]),e.GetFarPlaneToRef(t,i[1]),e.GetLeftPlaneToRef(t,i[2]),e.GetRightPlaneToRef(t,i[3]),e.GetTopPlaneToRef(t,i[4]),e.GetBottomPlaneToRef(t,i[5])},e}();e.Frustum=u;!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(e.Space||(e.Space={}));var f=function(){function e(){}return e}();f.X=new n(1,0,0),f.Y=new n(0,1,0),f.Z=new n(0,0,1),e.Axis=f;var d=function(){function e(){}return e.interpolate=function(e,t,i,r,n){for(var o=1-3*r+3*t,s=3*r-6*t,a=3*t,l=e,h=0;h<5;h++){var c=l*l;l-=(o*(c*l)+s*c+a*l-e)*(1/(3*o*c+2*s*l+a)),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*n+Math.pow(l,3)},e}();e.BezierCurve=d;var p;!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(p=e.Orientation||(e.Orientation={}));var m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var r=i.subtract(t);return new e(Math.atan2(r.y,r.x))},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var l=this.startAngle.degrees(),h=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();h-l>180&&(h-=360),h-l<-180&&(h+=360),c-h>180&&(c-=360),c-h<-180&&(c+=360),this.orientation=h-l<0?p.CW:p.CCW,this.angle=m.FromDegrees(this.orientation===p.CW?l-c:c-l)}return e}();e.Arc2=g;var v=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return e.prototype.addLineTo=function(e,t){if(this.closed)return this;var i=new r(e,t),n=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(n).length(),this},e.prototype.addArcTo=function(e,t,i,n,o){if(void 0===o&&(o=36),this.closed)return this;var s=this._points[this._points.length-1],a=new r(e,t),l=new r(i,n),h=new g(s,a,l),c=h.angle.radians()/o;h.orientation===p.CW&&(c*=-1);for(var u=h.startAngle.radians()+c,f=0;f<o;f++){var d=Math.cos(u)*h.radius+h.centerPoint.x,m=Math.sin(u)*h.radius+h.centerPoint.y;this.addLineTo(d,m),u+=c}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(e<0||e>1)return r.Zero();for(var t=e*this.length(),i=0,n=0;n<this._points.length;n++){var o=(n+1)%this._points.length,s=this._points[n],a=this._points[o],l=a.subtract(s),h=l.length()+i;if(t>=i&&t<=h){var c=l.normalize(),u=t-i;return new r(s.x+c.x*u,s.y+c.y*u)}i=h}return r.Zero()},e.StartingAt=function(t,i){return new e(t,i)},e}();e.Path2=v;var y=function(){function t(e,t,i){void 0===t&&(t=null),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<e.length;r++)this._curve[r]=e[r].clone();this._raw=i||!1,this._compute(t)}return t.prototype.getCurve=function(){return this._curve},t.prototype.getTangents=function(){return this._tangents},t.prototype.getNormals=function(){return this._normals},t.prototype.getBinormals=function(){return this._binormals},t.prototype.getDistances=function(){return this._distances},t.prototype.update=function(e,t){void 0===t&&(t=null);for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},t.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._raw||this._tangents[t-1].normalize();var i=this._tangents[0],r=this._normalVector(this._curve[0],i,e);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=n.Cross(i,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,s,a,l,h=1;h<t;h++)o=this._getLastNonNullVector(h),h<t-1&&(s=this._getFirstNonNullVector(h),this._tangents[h]=o.add(s),this._tangents[h].normalize()),this._distances[h]=this._distances[h-1]+o.length(),a=this._tangents[h],l=this._binormals[h-1],this._normals[h]=n.Cross(l,a),this._raw||this._normals[h].normalize(),this._binormals[h]=n.Cross(a,this._normals[h]),this._raw||this._binormals[h].normalize()},t.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},t.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},t.prototype._normalVector=function(t,i,r){var o,s=i.length();if(0===s&&(s=1),void 0===r||null===r){var a;a=e.Scalar.WithinEpsilon(Math.abs(i.y)/s,1,e.Epsilon)?e.Scalar.WithinEpsilon(Math.abs(i.x)/s,1,e.Epsilon)?e.Scalar.WithinEpsilon(Math.abs(i.z)/s,1,e.Epsilon)?n.Zero():new n(0,0,1):new n(1,0,0):new n(0,-1,0),o=n.Cross(i,a)}else o=n.Cross(i,r),n.CrossToRef(o,i,o);return o.normalize(),o},t}();e.Path3D=y;var _=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,r,o){o=o>2?o:3;for(var s=new Array,a=function(e,t,i,r){return(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*r},l=0;l<=o;l++)s.push(new n(a(l/o,t.x,i.x,r.x),a(l/o,t.y,i.y,r.y),a(l/o,t.z,i.z,r.z)));return new e(s)},e.CreateCubicBezier=function(t,i,r,o,s){s=s>3?s:4;for(var a=new Array,l=function(e,t,i,r,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*r+e*e*e*n},h=0;h<=s;h++)a.push(new n(l(h/s,t.x,i.x,r.x,o.x),l(h/s,t.y,i.y,r.y,o.y),l(h/s,t.z,i.z,r.z,o.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,r,o,s){for(var a=new Array,l=1/s,h=0;h<=s;h++)a.push(n.Hermite(t,i,r,o,h*l));return new e(a)},e.CreateCatmullRomSpline=function(t,i){var r=new Array;r.push(t[0].clone()),Array.prototype.push.apply(r,t),r.push(t[t.length-1].clone());for(var o=new Array,s=1/i,a=0,l=0;l<r.length-3;l++){a=0;for(var h=0;h<i;h++)o.push(n.CatmullRom(r[l],r[l+1],r[l+2],r[l+3],a)),a+=s}return l--,o.push(n.CatmullRom(r[l],r[l+1],r[l+2],r[l+3],a)),new e(o)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var i=this._points[this._points.length-1],r=this._points.slice(),n=t.getPoints(),o=1;o<n.length;o++)r.push(n[o].subtract(n[0]).add(i));return new e(r)},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=_;var b=function(){function e(e,t){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=b;var x=function(){function e(e,t,i){void 0===e&&(e=n.Zero()),void 0===t&&(t=n.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=x;var T=function(){function e(){}return e}();T.Color3=[t.Black(),t.Black(),t.Black()],T.Vector2=[r.Zero(),r.Zero(),r.Zero()],T.Vector3=[n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero(),n.Zero()],T.Vector4=[o.Zero(),o.Zero(),o.Zero()],T.Quaternion=[a.Zero(),a.Zero()],T.Matrix=[l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero()],e.Tmp=T;var E=function(){function e(){}return e}();E.Vector3=[n.Zero()],E.Matrix=[l.Zero(),l.Zero()],E.Quaternion=[a.Zero()]}(r||(r={}));var r;!function(e){var t=function(){function e(){}return e.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var r=e-t;return-i<=r&&r<=i},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,i){return(e-t)/(i-t)},e.Denormalize=function(e,t,i){return e*(i-t)+t},e.DeltaAngle=function(t,i){var r=e.Repeat(i-t,360);return r>180&&(r-=360),r},e.PingPong=function(t,i){var r=e.Repeat(t,2*i);return i-Math.abs(r-i)},e.SmoothStep=function(t,i,r){var n=e.Clamp(r);return n=-2*n*n*n+3*n*n,i*n+t*(1-n)},e.MoveTowards=function(t,i,r){return Math.abs(i-t)<=r?i:t+e.Sign(i-t)*r},e.MoveTowardsAngle=function(t,i,r){var n=e.DeltaAngle(t,i),o=0;return-r<n&&n<r?o=i:(i=t+n,o=e.MoveTowards(t,i,r)),o},e.Lerp=function(e,t,i){return e+(t-e)*i},e.LerpAngle=function(t,i,r){var n=e.Repeat(i-t,360);return n>180&&(n-=360),t+n*e.Clamp(r)},e.InverseLerp=function(t,i,r){return t!=i?e.Clamp((r-t)/(i-t)):0},e.Hermite=function(e,t,i,r,n){var o=n*n,s=n*o;return e*(2*s-3*o+1)+i*(-2*s+3*o)+t*(s-2*o+n)+r*(s-o)},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},e.PercentToRange=function(e,t,i){return(i-t)*e+t},e.NormalizeRadians=function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e}();t.TwoPi=2*Math.PI,e.Scalar=t}(r||(r={}));var r;!function(e){function t(e){var t=e.getClassName();return v[t]||(v[t]={}),v[t]}function i(e){var t=e.getClassName();if(y[t])return y[t];y[t]={};for(var i=y[t],r=e,n=t;n;){var o=v[n];for(var s in o)i[s]=o[s];var a=void 0,l=!1;do{if(a=Object.getPrototypeOf(r),!a.getClassName){l=!0;break}if(a.getClassName()!==n)break;r=a}while(a);if(l)break;n=a.getClassName(),r=a}return i}function r(e,i){return function(r,n){var o=t(r);o[n]||(o[n]={type:e,sourceName:i})}}function n(e,t){return void 0===t&&(t=null),function(i,r){var n=t||"_"+r;Object.defineProperty(i,r,{get:function(){return this[n]},set:function(t){this[n]!==t&&(this[n]=t,i[e].apply(this))},enumerable:!0,configurable:!0})}}function o(e,t){return void 0===t&&(t=null),n(e,t)}function s(e){return r(0,e)}function a(e){return r(1,e)}function l(e){return r(2,e)}function h(e){return r(3,e)}function c(e){return r(4,e)}function u(e){return r(5,e)}function f(e){return r(6,e)}function d(e){return r(7,e)}function p(e){return r(8,e)}function m(e){return r(9,e)}function g(e){return r(10,e)}var v={},y={},_=function(t,r,n){var o=t();e.Tags&&e.Tags.AddTagsTo(o,r.tags);var s=i(o);for(var a in s){var l=s[a],h=r[a],c=l.type;if(void 0!==h&&null!==h)switch(c){case 0:case 6:o[a]=h;break;case 1:o[a]=n||h.isRenderTarget?h:h.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:o[a]=n?h:h.clone()}}return o};e.expandToProperty=o,e.serialize=s,e.serializeAsTexture=a,e.serializeAsColor3=l,e.serializeAsFresnelParameters=h,e.serializeAsVector2=c,e.serializeAsVector3=u,e.serializeAsMeshReference=f,e.serializeAsColorCurves=d,e.serializeAsColor4=p,e.serializeAsImageProcessingConfiguration=m,e.serializeAsQuaternion=g;var b=function(){function t(){}return t.Serialize=function(t,r){r||(r={}),e.Tags&&(r.tags=e.Tags.GetTags(t));var n=i(t);for(var o in n){var s=n[o],a=s.sourceName||o,l=s.type,h=t[o];if(void 0!==h&&null!==h)switch(l){case 0:r[a]=h;break;case 1:r[a]=h.serialize();break;case 2:r[a]=h.asArray();break;case 3:r[a]=h.serialize();break;case 4:case 5:r[a]=h.asArray();break;case 6:r[a]=h.id;break;case 7:r[a]=h.serialize();break;case 8:r[a]=h.asArray();break;case 9:r[a]=h.serialize()}}return r},t.Parse=function(t,r,n,o){void 0===o&&(o=null);var s=t();o||(o=""),e.Tags&&e.Tags.AddTagsTo(s,r.tags);var a=i(s);for(var l in a){var h=a[l],c=r[h.sourceName||l],u=h.type;if(void 0!==c&&null!==c){var f=s;switch(u){case 0:f[l]=c;break;case 1:n&&(f[l]=e.Texture.Parse(c,n,o));break;case 2:f[l]=e.Color3.FromArray(c);break;case 3:f[l]=e.FresnelParameters.Parse(c);break;case 4:f[l]=e.Vector2.FromArray(c);break;case 5:f[l]=e.Vector3.FromArray(c);break;case 6:n&&(f[l]=n.getLastMeshByID(c));break;case 7:f[l]=e.ColorCurves.Parse(c);break;case 8:f[l]=e.Color4.FromArray(c);break;case 9:f[l]=e.ImageProcessingConfiguration.Parse(c)}}}return s},t.Clone=function(e,t){return _(e,t,!1)},t.Instanciate=function(e,t){return _(e,t,!0)},t}();e.SerializationHelper=b}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i,r){void 0===t&&(t=!1),this.initalize(e,t,i,r)}return e.prototype.initalize=function(e,t,i,r){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=r,this},e}();e.EventState=t;var i=function(){function e(e,t,i){void 0===i&&(i=null),this.callback=e,this.mask=t,this.scope=i}return e}();e.Observer=i;var r=function(){function e(){}return e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,i,r,n){void 0===r&&(r=-1),void 0===n&&(n=null);var o=new e;o._observers=new Array,o._observables=t;for(var s=0,a=t;s<a.length;s++){var l=a[s],h=l.add(i,r,!1,n);h&&o._observers.push(h)}return o},e}();e.MultiObserver=r;var n=function(){function e(e){this._observers=new Array,this._eventState=new t(0),e&&(this._onObserverAdded=e)}return e.prototype.add=function(e,t,r,n){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===n&&(n=null),!e)return null;var o=new i(e,t,n);return r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},e.prototype.remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.removeCallback=function(e){for(var t=0;t<this._observers.length;t++)if(this._observers[t].callback===e)return this._observers.splice(t,1),!0;return!1},e.prototype.notifyObservers=function(e,t,i,r){if(void 0===t&&(t=-1),!this._observers.length)return!0;var n=this._eventState;n.mask=t,n.target=i,n.currentTarget=r,n.skipNextObservers=!1;for(var o=0,s=this._observers;o<s.length;o++){var a=s[o];if(a.mask&t&&(a.scope?a.callback.apply(a.scope,[e,n]):a.callback(e,n)),n.skipNextObservers)return!1}return!0},e.prototype.notifyObserver=function(e,t,i){void 0===i&&(i=-1);var r=this._eventState;r.mask=i,r.skipNextObservers=!1,e.callback(t,r)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var r=i[t];if(r.mask&e||r.mask===e)return!0}return!1},e}();e.Observable=n}(r||(r={}));var r;!function(e){var t=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.data.indexOf(e)},e}();t._GlobalId=0,e.SmartArray=t;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return o(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},t}(t);e.SmartArrayNoDuplicate=i}(r||(r={}));var r;!function(e){function t(e,t){return function(i){i.__bjsclassName__=e,i.__bjsmoduleName__=null!=t?t:null}}var i,r=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},n=function(){function t(){}return t.Mix=function(e,t,i){return e*(1-i)+t*i},t.Instantiate=function(e){if(t.RegisteredExternalClasses&&t.RegisteredExternalClasses[e])return t.RegisteredExternalClasses[e];for(var i=e.split("."),r=window||this,n=0,o=i.length;n<o;n++)r=r[i[n]];return"function"!=typeof r?null:r},t.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},t.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},t.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},t.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},t.NearestPOT=function(e){var i=t.CeilingPOT(e),r=t.FloorPOT(e);return i-e>e-r?r:i},t.GetExponentOfTwo=function(i,r,n){void 0===n&&(n=e.Engine.SCALEMODE_NEAREST);var o;switch(n){case e.Engine.SCALEMODE_FLOOR:o=t.FloorPOT(i);break;case e.Engine.SCALEMODE_NEAREST:o=t.NearestPOT(i);break;case e.Engine.SCALEMODE_CEILING:default:o=t.CeilingPOT(i)}return Math.min(o,r)},t.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},t.GetFolderPath=function(e){var t=e.lastIndexOf("/");return t<0?"":e.substring(0,t+1)},t.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},t.ToDegrees=function(e){return 180*e/Math.PI},t.ToRadians=function(e){return e*Math.PI/180},t.EncodeArrayBufferTobase64=function(e){for(var t,i,r,n,o,s,a,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",c=0,u=new Uint8Array(e);c<u.length;)t=u[c++],i=c<u.length?u[c++]:Number.NaN,r=c<u.length?u[c++]:Number.NaN,n=t>>2,o=(3&t)<<4|i>>4,s=(15&i)<<2|r>>6,a=63&r,isNaN(i)?s=a=64:isNaN(r)&&(a=64),h+=l.charAt(n)+l.charAt(o)+l.charAt(s)+l.charAt(a);return"data:image/png;base64,"+h},t.ExtractMinAndMaxIndexed=function(t,i,r,n,o){void 0===o&&(o=null);for(var s=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=r;l<r+n;l++){var h=new e.Vector3(t[3*i[l]],t[3*i[l]+1],t[3*i[l]+2]);s=e.Vector3.Minimize(h,s),a=e.Vector3.Maximize(h,a)}return o&&(s.x-=s.x*o.x+o.y,s.y-=s.y*o.x+o.y,s.z-=s.z*o.x+o.y,a.x+=a.x*o.x+o.y,a.y+=a.y*o.x+o.y,a.z+=a.z*o.x+o.y),{minimum:s,maximum:a}},t.ExtractMinAndMax=function(t,i,r,n,o){void 0===n&&(n=null);var s=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);o||(o=3);for(var l=i;l<i+r;l++){var h=new e.Vector3(t[l*o],t[l*o+1],t[l*o+2]);s=e.Vector3.Minimize(h,s),a=e.Vector3.Maximize(h,a)}return n&&(s.x-=s.x*n.x+n.y,s.y-=s.y*n.x+n.y,s.z-=s.z*n.x+n.y,a.x+=a.x*n.x+n.y,a.y+=a.y*n.x+n.y,a.z+=a.z*n.x+n.y),{minimum:s,maximum:a}},t.Vector2ArrayFeeder=function(t){return function(i){var r=void 0!==t.BYTES_PER_ELEMENT;if(i>=(r?t.length/2:t.length))return null;if(r){var n=t;return new e.Vector2(n[2*i+0],n[2*i+1])}return t[i]}},t.ExtractMinAndMaxVector2=function(t,i){void 0===i&&(i=null);for(var r=new e.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),n=new e.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),o=0,s=t(o++);s;)r=e.Vector2.Minimize(s,r),n=e.Vector2.Maximize(s,n),s=t(o++);return i&&(r.x-=r.x*i.x+i.y,r.y-=r.y*i.x+i.y,n.x+=n.x*i.x+i.y,n.y+=n.y*i.x+i.y),{minimum:r,maximum:n}},t.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},t.GetPointerPrefix=function(){var e="pointer";return!t.IsWindowObjectExist()||window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},t.QueueNewFrame=function(e,i){return t.IsWindowObjectExist()?(i||(i=window),i.requestAnimationFrame?i.requestAnimationFrame(e):i.msRequestAnimationFrame?i.msRequestAnimationFrame(e):i.webkitRequestAnimationFrame?i.webkitRequestAnimationFrame(e):i.mozRequestAnimationFrame?i.mozRequestAnimationFrame(e):i.oRequestAnimationFrame?i.oRequestAnimationFrame(e):window.setTimeout(e,16)):setTimeout(e,16)},t.RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},t.SetCorsBehavior=function(e,i){if((!e||0!==e.indexOf("data:"))&&t.CorsBehavior)if("string"==typeof t.CorsBehavior||t.CorsBehavior instanceof String)i.crossOrigin=t.CorsBehavior;else{var r=t.CorsBehavior(e);r&&(i.crossOrigin=r)}},t.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},t.LoadImage=function(i,r,n,o){i instanceof ArrayBuffer&&(i=t.EncodeArrayBufferTobase64(i)),i=t.CleanUrl(i),i=t.PreprocessUrl(i);var s=new Image;t.SetCorsBehavior(i,s),s.onload=function(){r(s)},s.onerror=function(e){t.Error("Error while trying to load image: "+i),n&&n("Error while trying to load image: "+i,e)};var a=function(){s.src=i},l=function(){o&&o.loadImageFromDB(i,s)};if("data:"!==i.substr(0,5)&&o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(l,a);else{if(-1!==i.indexOf("file:")){var h=decodeURIComponent(i.substring(5).toLowerCase());if(e.FilesInput.FilesToLoad[h]){try{var c;try{c=URL.createObjectURL(e.FilesInput.FilesToLoad[h],{oneTimeOnly:!0})}catch(t){c=URL.createObjectURL(e.FilesInput.FilesToLoad[h])}s.src=c}catch(e){s.src=""}return s}}a()}return s},t.LoadFile=function(i,r,n,o,s,a){i=t.CleanUrl(i),i=t.PreprocessUrl(i);var l=null,h=function(){l=new XMLHttpRequest;var e=t.BaseUrl+i;l.open("GET",e,!0),s&&(l.responseType="arraybuffer"),n&&(l.onprogress=n),l.onreadystatechange=function(){var i=l;if(i.readyState===(XMLHttpRequest.DONE||4))if(i.onreadystatechange=function(){},i.status>=200&&i.status<300||!t.IsWindowObjectExist()&&0===i.status)r(s?i.response:i.responseText,i.responseURL);else{var n=new Error("Error status: "+i.status+" - Unable to load "+e);if(!a)throw n;a(i,n)}},l.send(null)},c=function(){o&&o.loadFileFromDB(i,r,n,h,s)};if(-1!==i.indexOf("file:")){var u=decodeURIComponent(i.substring(5).toLowerCase());if(e.FilesInput.FilesToLoad[u])return t.ReadFile(e.FilesInput.FilesToLoad[u],r,n,s),l}return o&&o.enableSceneOffline?o.openAsync(c,h):h(),l},t.LoadScript=function(e,t,i){var r=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=function(){t&&t()},n.onerror=function(e){i&&i("Unable to load script",e)},r.appendChild(n)},t.ReadFileAsDataURL=function(e,t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onprogress=i,r.readAsDataURL(e)},t.ReadFile=function(e,i,r,n){var o=new FileReader;o.onerror=function(r){t.Log("Error while reading file: "+e.name),i(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){i(e.target.result)},r&&(o.onprogress=r),n?o.readAsArrayBuffer(e):o.readAsText(e)},t.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},t.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},t.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},t.DeepCopy=function(e,t,i,n){for(var o in e)if(("_"!==o[0]||n&&-1!==n.indexOf(o))&&(!i||-1===i.indexOf(o))){var s=e[o],a=typeof s;if("function"!==a)if("object"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if("object"==typeof s[0])for(var l=0;l<s.length;l++){var h=r(s[l],t);-1===t[o].indexOf(h)&&t[o].push(h)}else t[o]=s.slice(0)}else t[o]=r(s,t);else t[o]=s}},t.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(e){}}},t.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(e){}}},t.DumpFramebuffer=function(e,r,n,o,s,a){void 0===s&&(s="image/png");for(var l=4*e,h=r/2,c=n.readPixels(0,0,e,r),u=0;u<h;u++)for(var f=0;f<l;f++){var d=f+u*l,p=r-u-1,m=f+p*l,g=c[d];c[d]=c[m],c[m]=g}i||(i=document.createElement("canvas")),i.width=e,i.height=r;var v=i.getContext("2d");if(v){var y=v.createImageData(e,r);y.data.set(c),v.putImageData(y,0,0),t.EncodeScreenshotCanvasData(o,s,a)}},t.EncodeScreenshotCanvasData=function(e,t,r){void 0===t&&(t="image/png");var n=i.toDataURL(t);e?e(n):(i.toBlob||(i.toBlob=function(e,t,i){var r=this;setTimeout(function(){for(var n=atob(r.toDataURL(t,i).split(",")[1]),o=n.length,s=new Uint8Array(o),a=0;a<o;a++)s[a]=n.charCodeAt(a);e(new Blob([s],{type:t||"image/png"}))})}),i.toBlob(function(e){var t=URL.createObjectURL(e);if("download"in document.createElement("a")){var i=window.document.createElement("a");if(i.href=t,r)i.setAttribute("download",r);else{var n=new Date,o=(n.getFullYear()+"-"+(n.getMonth()+1)).slice(-2)+"-"+n.getDate()+"_"+n.getHours()+"-"+("0"+n.getMinutes()).slice(-2);i.setAttribute("download","screenshot_"+o+".png")}window.document.body.appendChild(i),i.addEventListener("click",function(){i.parentElement&&i.parentElement.removeChild(i)}),i.click()}else{var s=window.open("");if(!s)return;var a=s.document.createElement("img");a.onload=function(){URL.revokeObjectURL(t)},a.src=t,s.document.body.appendChild(a)}}))},t.CreateScreenshot=function(e,r,n,o,s){void 0===s&&(s="image/png");var a,l;if(n.precision)a=Math.round(e.getRenderWidth()*n.precision),l=Math.round(a/e.getAspectRatio(r));else if(n.width&&n.height)a=n.width,l=n.height;else if(n.width&&!n.height)a=n.width,l=Math.round(a/e.getAspectRatio(r));else if(n.height&&!n.width)l=n.height,a=Math.round(l*e.getAspectRatio(r));else{if(isNaN(n))return void t.Error("Invalid 'size' parameter !");l=n,a=n}i||(i=document.createElement("canvas")),i.width=a,i.height=l;var h=i.getContext("2d"),c=e.getRenderWidth()/e.getRenderHeight(),u=a,f=u/c;f>l&&(f=l,u=f*c);var d=Math.max(0,a-u)/2,p=Math.max(0,l-f)/2,m=e.getRenderingCanvas();h&&m&&h.drawImage(m,d,p,u,f),t.EncodeScreenshotCanvasData(o,s)},t.CreateScreenshotUsingRenderTarget=function(i,r,n,o,s,a,l,h){void 0===s&&(s="image/png"),void 0===a&&(a=1),void 0===l&&(l=!1);var c,u;if(n.precision)c=Math.round(i.getRenderWidth()*n.precision),u=Math.round(c/i.getAspectRatio(r)),n={width:c,height:u};else if(n.width&&n.height)c=n.width,u=n.height;else if(n.width&&!n.height)c=n.width,u=Math.round(c/i.getAspectRatio(r)),n={width:c,height:u};else if(n.height&&!n.width)u=n.height,c=Math.round(u*i.getAspectRatio(r)),n={width:c,height:u};else{if(isNaN(n))return void t.Error("Invalid 'size' parameter !");u=n,c=n}var f=r.getScene(),d=null;f.activeCamera!==r&&(d=f.activeCamera,f.activeCamera=r);var p=new e.RenderTargetTexture("screenShot",n,f,!1,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT,!1,e.Texture.NEAREST_SAMPLINGMODE);p.renderList=null,p.samples=a,l&&p.addPostProcess(new e.FxaaPostProcess("antialiasing",1,f.activeCamera)),p.onAfterRenderObservable.add(function(){t.DumpFramebuffer(c,u,i,o,s,h)}),f.incrementRenderId(),f.resetCachedMaterial(),p.render(!0),p.dispose(),d&&(f.activeCamera=d),r.getProjectionMatrix(!0)},t.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var r=e.Internals.TGATools.GetTGAHeader(t.response);if(r.width&&r.height&&r.width>0&&r.height>0)return!0;if(2===i)return!1}if(4&i){var n=new Uint8Array(t.response,0,3);return 68===n[0]&&68===n[1]&&83===n[2]}}catch(e){}return!1},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},Object.defineProperty(t,"NoneLogLevel",{get:function(){return t._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MessageLogLevel",{get:function(){return t._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WarningLogLevel",{get:function(){return t._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorLogLevel",{get:function(){return t._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AllLogLevel",{get:function(){return t._MessageLogLevel|t._WarningLogLevel|t._ErrorLogLevel},enumerable:!0,configurable:!0}),t._AddLogEntry=function(e){t._LogCache=e+t._LogCache,t.OnNewCacheEntry&&t.OnNewCacheEntry(e)},t._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},t._LogDisabled=function(e){},t._LogEnabled=function(e){var i=t._FormatMessage(e);console.log("BJS - "+i);var r="<div style='color:white'>"+i+"</div><br>";t._AddLogEntry(r)},t._WarnDisabled=function(e){},t._WarnEnabled=function(e){var i=t._FormatMessage(e);console.warn("BJS - "+i);var r="<div style='color:orange'>"+i+"</div><br>";t._AddLogEntry(r)},t._ErrorDisabled=function(e){},t._ErrorEnabled=function(e){t.errorsCount++;var i=t._FormatMessage(e);console.error("BJS - "+i);var r="<div style='color:red'>"+i+"</div><br>";t._AddLogEntry(r)},Object.defineProperty(t,"LogCache",{get:function(){return t._LogCache},enumerable:!0,configurable:!0}),t.ClearLogCache=function(){t._LogCache="",t.errorsCount=0},Object.defineProperty(t,"LogLevels",{set:function(e){(e&t.MessageLogLevel)===t.MessageLogLevel?t.Log=t._LogEnabled:t.Log=t._LogDisabled,(e&t.WarningLogLevel)===t.WarningLogLevel?t.Warn=t._WarnEnabled:t.Warn=t._WarnDisabled,(e&t.ErrorLogLevel)===t.ErrorLogLevel?t.Error=t._ErrorEnabled:t.Error=t._ErrorDisabled},enumerable:!0,configurable:!0}),t.IsWindowObjectExist=function(){return"undefined"!=typeof window},Object.defineProperty(t,"PerformanceNoneLogLevel",{get:function(){return t._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceUserMarkLogLevel",{get:function(){return t._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceConsoleLogLevel",{get:function(){return t._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceLogLevel",{set:function(e){return(e&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t._StartUserMark,void(t.EndPerformanceCounter=t._EndUserMark)):(e&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t._StartPerformanceConsole,void(t.EndPerformanceCounter=t._EndPerformanceConsole)):(t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,void(t.EndPerformanceCounter=t._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),t._StartPerformanceCounterDisabled=function(e,t){},t._EndPerformanceCounterDisabled=function(e,t){},t._StartUserMark=function(e,i){if(void 0===i&&(i=!0),!t._performance){if(!t.IsWindowObjectExist())return;t._performance=window.performance}i&&t._performance.mark&&t._performance.mark(e+"-Begin")},t._EndUserMark=function(e,i){void 0===i&&(i=!0),i&&t._performance.mark&&(t._performance.mark(e+"-End"),t._performance.measure(e,e+"-Begin",e+"-End"))},t._StartPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._StartUserMark(e,i),console.time&&console.time(e))},t._EndPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._EndUserMark(e,i),console.time&&console.timeEnd(e))},Object.defineProperty(t,"Now",{get:function(){return t.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),t.GetClassName=function(e,t){void 0===t&&(t=!1);var i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){i=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__}i||(i=typeof e)}return i},t.First=function(e,t){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t(n))return n}return null},t.getFullClassName=function(e,t){void 0===t&&(t=!1);var i=null,r=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__,r=n.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(null!=r?r+".":"")+i:null},t.arrayOrStringFeeder=function(e){return function(i){if(i>=e.length)return null;var r=e.charCodeAt?e.charCodeAt(i):e[i];return r&&r.getHashCode&&(r=r.getHashCode()),"string"==typeof r?t.hashCodeFromStream(t.arrayOrStringFeeder(r)):r}},t.hashCodeFromStream=function(e){for(var t=0,i=0,r=e(i++);null!=r;)t=(t<<5)-t+r,t|=0,r=e(i++);return t},t}();n.BaseUrl="",n.CorsBehavior="anonymous",n.UseFallbackTexture=!0,n.RegisteredExternalClasses={},n.fallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",n.PreprocessUrl=function(e){return e},n._NoneLogLevel=0,n._MessageLogLevel=1,n._WarningLogLevel=2,n._ErrorLogLevel=4,n._LogCache="",n.errorsCount=0,n.Log=n._LogEnabled,n.Warn=n._WarnEnabled,n.Error=n._ErrorEnabled,n._PerformanceNoneLogLevel=0,n._PerformanceUserMarkLogLevel=1,n._PerformanceConsoleLogLevel=2,n.StartPerformanceCounter=n._StartPerformanceCounterDisabled,n.EndPerformanceCounter=n._EndPerformanceCounterDisabled,e.Tools=n;var o=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!0,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,i){e.Enabled&&(this._current+=t,i&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=n.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var i=n.Now;this._current=i-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=n.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e}();o.Enabled=!0,e.PerfCounter=o,e.className=t;var s=function(){function e(e,t,i,r){void 0===r&&(r=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=r-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,r,n){void 0===n&&(n=0);var o=new e(t,i,r,n);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,r,n,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var n=0;n<i;++n){var s=e.index*i+n;if(s>=t)break;if(r(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},n)},e}();e.AsyncLoop=s}(r||(r={}));var r;!function(e){!function(e){var t=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,i,r){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===r||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=r,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,r){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===r||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=r,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._isBlendEquationParametersDirty[0],this._isBlendEquationParametersDirty[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}();e._AlphaState=t}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.Engine.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.Engine.KEEP,this._stencilOpDepthFail=e.Engine.KEEP,this._stencilOpStencilDepthPass=e.Engine.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},t.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},t}();t._StencilState=i}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(e,t,r,n,o){return i(e,o+(n?n+"\n":"")+t,r)},i=function(e,t,i){var r=e.createShader("vertex"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var n=e.getShaderInfoLog(r);if(n)throw new Error(n)}if(!r)throw new Error("Something went wrong while compile the shader.");return r},r=function(t,i,r){var n=r.NEAREST,o=r.NEAREST;switch(t){case e.Texture.BILINEAR_SAMPLINGMODE:n=r.LINEAR,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case e.Texture.TRILINEAR_SAMPLINGMODE:n=r.LINEAR,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case e.Texture.NEAREST_SAMPLINGMODE:n=r.NEAREST,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case e.Texture.NEAREST_NEAREST_MIPNEAREST:n=r.NEAREST,o=i?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case e.Texture.NEAREST_LINEAR_MIPNEAREST:n=r.NEAREST,o=i?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case e.Texture.NEAREST_LINEAR_MIPLINEAR:n=r.NEAREST,o=i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case e.Texture.NEAREST_LINEAR:n=r.NEAREST,o=r.LINEAR;break;case e.Texture.NEAREST_NEAREST:n=r.NEAREST,o=r.NEAREST;break;case e.Texture.LINEAR_NEAREST_MIPNEAREST:n=r.LINEAR,o=i?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case e.Texture.LINEAR_NEAREST_MIPLINEAR:n=r.LINEAR,o=i?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case e.Texture.LINEAR_LINEAR:n=r.LINEAR,o=r.LINEAR;break;case e.Texture.LINEAR_NEAREST:n=r.LINEAR,o=r.NEAREST}return{min:o,mag:n}},n=function(t,i,r,n,o,s){void 0===s&&(s=null);var a,l=function(){r[i]=a,r._internalCount++,n&&n._removePendingData(a),6===r._internalCount&&o(r)},h=function(e,t){n&&n._removePendingData(a),s&&s(e,t)};a=e.Tools.LoadImage(t,l,h,n?n.database:null),n&&n._addPendingData(a)},o=function(e,t,i,r,o){void 0===o&&(o=null);var s=[];s._internalCount=0;for(var a=0;a<6;a++)n(r[a],a,s,t,i,o)},s=function(t,i,r,n,o,s){void 0===s&&(s=null);var a=function(e){r[i]=e,6===++r._internalCount&&o(r)},l=function(e,t){s&&e&&s(e.status+" "+e.statusText,t)};e.Tools.LoadFile(t,a,void 0,void 0,!0,l)},a=function(e,t,i,r,n){void 0===n&&(n=null);var o=[];o._internalCount=0;for(var a=0;a<6;a++)s(r[a],a,o,0,i,n)},l=function(){function e(){}return e}(),h=function(){function e(){}return e}();e.InstancingAttributeInfo=h;var c=function(){function e(){}return e}();e.RenderTargetCreationOptions=c;var u=function(){function e(){}return e}();e.EngineCapabilities=u;var f=function(){function n(t,i,r,o){void 0===o&&(o=!1);var s=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.enableOfflineSupport=!1,this.scenes=new Array,this.postProcesses=new Array,this.onResizeObservable=new e.Observable,this.onCanvasBlurObservable=new e.Observable,this.onCanvasFocusObservable=new e.Observable,this.onCanvasPointerOutObservable=new e.Observable,this.onBeforeTextureInitObservable=new e.Observable,this._vrDisplay=void 0,this._vrSupported=!1,this._vrExclusivePointerMode=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this.onBeginFrameObservable=new e.Observable,this.onEndFrameObservable=new e.Observable,this.onBeforeShaderCompilationObservable=new e.Observable,this.onAfterShaderCompilationObservable=new e.Observable,this._windowIsBackground=!1,this._webGLVersion=1,this._badOS=!1,this._badDesktopOS=!1,this.onVRDisplayChangedObservable=new e.Observable,this.onVRRequestPresentComplete=new e.Observable,this.onVRRequestPresentStart=new e.Observable,this._colorWrite=!0,this._drawCalls=new e.PerfCounter,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this.onContextLostObservable=new e.Observable,this.onContextRestoredObservable=new e.Observable,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this._performanceMonitor=new e.PerformanceMonitor,this._fps=60,this._deltaTime=0,this.disablePerformanceMonitorInBackground=!1,this._depthCullingState=new e.Internals._DepthCullingState,this._stencilState=new e.Internals._StencilState,this._alphaState=new e.Internals._AlphaState,this._alphaMode=n.ALPHA_DISABLE,this._internalTexturesCache=new Array,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._texturesSupported=new Array,this._onVRFullScreenTriggered=function(){if(s._vrDisplay&&s._vrDisplay.isPresenting){s._oldSize=new e.Size(s.getRenderWidth(),s.getRenderHeight()),s._oldHardwareScaleFactor=s.getHardwareScalingLevel();var t=s._vrDisplay.getEyeParameters("left");s.setHardwareScalingLevel(1),s.setSize(2*t.renderWidth,t.renderHeight)}else s.setHardwareScalingLevel(s._oldHardwareScaleFactor),s.setSize(s._oldSize.width,s._oldSize.height)};var a=null;if(n.Instances.push(this),t){if(r=r||{},t.getContext){if(a=t,this._renderingCanvas=a,null!=i&&(r.antialias=i),void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.preserveDrawingBuffer&&(r.preserveDrawingBuffer=!1),void 0===r.audioEngine&&(r.audioEngine=!0),void 0===r.stencil&&(r.stencil=!0),this._deterministicLockstep=r.deterministicLockstep,this._lockstepMaxSteps=r.lockstepMaxSteps,this._doNotHandleContextLost=!!r.doNotHandleContextLost,!r.disableWebGL2Support&&navigator&&navigator.userAgent)for(var h=navigator.userAgent,c=0,u=n.WebGL2UniformBuffersExceptionList;c<u.length;c++){var f=u[c];if(h.indexOf(f)>-1){this.disableUniformBuffers=!0;break}}if(!r.disableWebGL2Support)try{this._gl=a.getContext("webgl2",r)||a.getContext("experimental-webgl2",r),this._gl&&(this._webGLVersion=2)}catch(e){}if(!this._gl){if(!a)throw new Error("The provided canvas is null or undefined.");try{this._gl=a.getContext("webgl",r)||a.getContext("experimental-webgl",r)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported");this._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},this._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},a.addEventListener("focus",this._onCanvasFocus),a.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},this._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},this._onCanvasPointerOut=function(){s.onCanvasPointerOutObservable.notifyObservers(s)},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),a.addEventListener("pointerout",this._onCanvasPointerOut),this._doNotHandleContextLost||(this._onContextLost=function(t){t.preventDefault(),s._contextWasLost=!0,e.Tools.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(t){setTimeout(function(){s._initGLContext(),s._rebuildEffects(),s._rebuildInternalTextures(),s._rebuildBuffers(),s.wipeCaches(!0),e.Tools.Warn("WebGL context successfully restored."),s.onContextRestoredObservable.notifyObservers(s),s._contextWasLost=!1},0)},a.addEventListener("webglcontextlost",this._onContextLost,!1),a.addEventListener("webglcontextrestored",this._onContextRestored,!1))}else this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2),r.stencil=this._gl.getContextAttributes().stencil;var d=r.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=o?1/Math.min(d,window.devicePixelRatio||1):1,this.resize(),this._isStencilEnable=!!r.stencil,this._initGLContext(),a&&(this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&a&&(a.requestPointerLock=a.requestPointerLock||a.msRequestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock&&a.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===a||document.webkitPointerLockElement===a||document.msPointerLockElement===a||document.pointerLockElement===a},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),this._onVRDisplayPointerRestricted=function(){a&&a.requestPointerLock()},this._onVRDisplayPointerUnrestricted=function(){document.exitPointerLock()},window.addEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted,!1),window.addEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted,!1)),r.audioEngine&&e.AudioEngine&&!n.audioEngine&&(n.audioEngine=new e.AudioEngine);for(var p=0;p<this._caps.maxVertexAttribs;p++)this._currentBufferPointers[p]=new l;r.autoEnableWebVR&&this.initWebVR(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),e.Tools.Log("Babylon.js engine (v"+n.Version+") launched"),this.enableOfflineSupport=void 0!==e.Database}}return Object.defineProperty(n,"LastCreatedEngine",{get:function(){return 0===n.Instances.length?null:n.Instances[n.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LastCreatedScene",{get:function(){var e=n.LastCreatedEngine;return e?0===e.scenes.length?null:e.scenes[e.scenes.length-1]:null},enumerable:!0,configurable:!0}),n.MarkAllMaterialsAsDirty=function(e,t){for(var i=0;i<n.Instances.length;i++)for(var r=n.Instances[i],o=0;o<r.scenes.length;o++)r.scenes[o].markAllMaterialsAsDirty(e,t)},Object.defineProperty(n,"NEVER",{get:function(){return n._NEVER},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALWAYS",{get:function(){return n._ALWAYS},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LESS",{get:function(){return n._LESS},enumerable:!0,configurable:!0}),Object.defineProperty(n,"EQUAL",{get:function(){return n._EQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(n,"LEQUAL",{get:function(){return n._LEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(n,"GREATER",{get:function(){return n._GREATER},enumerable:!0,configurable:!0}),Object.defineProperty(n,"GEQUAL",{get:function(){return n._GEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(n,"NOTEQUAL",{get:function(){return n._NOTEQUAL},enumerable:!0,configurable:!0}),Object.defineProperty(n,"KEEP",{get:function(){return n._KEEP},enumerable:!0,configurable:!0}),Object.defineProperty(n,"REPLACE",{get:function(){return n._REPLACE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"INCR",{get:function(){return n._INCR},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DECR",{get:function(){return n._DECR},enumerable:!0,configurable:!0}),Object.defineProperty(n,"INVERT",{get:function(){return n._INVERT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"INCR_WRAP",{get:function(){return n._INCR_WRAP},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DECR_WRAP",{get:function(){return n._DECR_WRAP},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_DISABLE",{get:function(){return n._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_ONEONE",{get:function(){return n._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_ADD",{get:function(){return n._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_COMBINE",{get:function(){return n._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_SUBTRACT",{get:function(){return n._ALPHA_SUBTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_MULTIPLY",{get:function(){return n._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_MAXIMIZED",{get:function(){return n._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_PREMULTIPLIED",{get:function(){return n._ALPHA_PREMULTIPLIED},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_PREMULTIPLIED_PORTERDUFF",{get:function(){return n._ALPHA_PREMULTIPLIED_PORTERDUFF},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_INTERPOLATE",{get:function(){return n._ALPHA_INTERPOLATE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"ALPHA_SCREENMODE",{get:function(){return n._ALPHA_SCREENMODE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DELAYLOADSTATE_NONE",{get:function(){return n._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DELAYLOADSTATE_LOADED",{get:function(){return n._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DELAYLOADSTATE_LOADING",{get:function(){return n._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DELAYLOADSTATE_NOTLOADED",{get:function(){return n._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTUREFORMAT_ALPHA",{get:function(){return n._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTUREFORMAT_LUMINANCE",{get:function(){return n._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return n._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTUREFORMAT_RGB",{get:function(){return n._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTUREFORMAT_RGBA",{get:function(){return n._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return n._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTURETYPE_FLOAT",{get:function(){return n._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"TEXTURETYPE_HALF_FLOAT",{get:function(){return n._TEXTURETYPE_HALF_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SCALEMODE_FLOOR",{get:function(){return n._SCALEMODE_FLOOR},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SCALEMODE_NEAREST",{get:function(){return n._SCALEMODE_NEAREST},enumerable:!0,configurable:!0}),Object.defineProperty(n,"SCALEMODE_CEILING",{get:function(){return n._SCALEMODE_CEILING},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Version",{get:function(){return"3.1"},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isInVRExclusivePointerMode",{get:function(){return this._vrExclusivePointerMode},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"badOS",{get:function(){return this._badOS},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"badDesktopOS",{get:function(){return this._badDesktopOS},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var t=new Uint8Array(4),i=[t,t,t,t,t,t];this._emptyCubeTexture=this.createRawCubeTexture(i,1,e.Engine.TEXTUREFORMAT_RGBA,e.Engine.TEXTURETYPE_UNSIGNED_INT,!1,!1,e.Texture.NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),n.prototype._rebuildInternalTextures=function(){for(var e=this._internalTexturesCache.slice(),t=0,i=e;t<i.length;t++){i[t]._rebuild()}},n.prototype._rebuildEffects=function(){for(var t in this._compiledEffects){this._compiledEffects[t]._prepareEffect()}e.Effect.ResetCache()},n.prototype._rebuildBuffers=function(){for(var e=0,t=this.scenes;e<t.length;e++){var i=t[e];i.resetCachedMaterial(),i._rebuildGeometries(),i._rebuildTextures()}for(var r=0,n=this._uniformBuffers;r<n.length;r++){n[r]._rebuild()}},n.prototype._initGLContext=function(){this._caps=new u,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureImageUnits=this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._caps.maxVertexAttribs=this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),this._caps.maxVaryingVectors=this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),this._caps.maxFragmentUniformVectors=this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxVertexUniformVectors=this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.standardDerivatives=this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.astc=this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this._caps.pvrtc=this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this._caps.etc1=this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),this._caps.etc2=this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.uintIndices=this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.timerQuery=this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.colorBufferFloat=this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),this._caps.textureFloat=this._webGLVersion>1||this._gl.getExtension("OES_texture_float"),this._caps.textureFloatLinearFiltering=this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear"),this._caps.textureFloatRender=this._caps.textureFloat&&this._canRenderToFloatFramebuffer(),this._caps.textureHalfFloat=this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float"),this._caps.textureHalfFloatLinearFiltering=this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear"),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._caps.textureLOD=this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod"),this._webGLVersion>1)this._caps.drawBuffersExtension=!0;else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}else this._caps.drawBuffersExtension=!1}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{null!=this._gl.getExtension("WEBGL_depth_texture")&&(this._caps.depthTextureExtension=!0)}if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var r=this._gl.getExtension("OES_vertex_array_object");null!=r?(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=r.createVertexArrayOES.bind(r),this._gl.bindVertexArray=r.bindVertexArrayOES.bind(r),this._gl.deleteVertexArray=r.deleteVertexArrayOES.bind(r)):this._caps.vertexArrayObject=!1}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var n=this._gl.getExtension("ANGLE_instanced_arrays");null!=n?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=n.drawArraysInstancedANGLE.bind(n),this._gl.drawElementsInstanced=n.drawElementsInstancedANGLE.bind(n),this._gl.vertexAttribDivisor=n.vertexAttribDivisorANGLE.bind(n)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&(this._caps.highPrecisionShaderSupported=0!==o.precision)}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0)},Object.defineProperty(n.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),n.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=document.createElement("canvas");var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},n.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache[e]=null},n.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},n.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},n.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},n.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},n.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},n.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},n.prototype.getRenderingCanvas=function(){return this._renderingCanvas},n.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},n.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},n.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},n.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},n.prototype.getCaps=function(){return this._caps},Object.defineProperty(n.prototype,"drawCalls",{get:function(){return e.Tools.Warn("drawCalls is deprecated. Please use SceneInstrumentation class"),0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"drawCallsPerfCounter",{get:function(){return e.Tools.Warn("drawCallsPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),n.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},n.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},n.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},n.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},n.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},n.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},n.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},n.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},n.prototype.getStencilMask=function(){return this._stencilState.stencilMask},n.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},n.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},n.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},n.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},n.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},n.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},n.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},n.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},n.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},n.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},n.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},n.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},n.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},n.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},n.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},n.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},n.prototype._renderLoop=function(){if(!this._contextWasLost){var t=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1),t){this.beginFrame();for(var i=0;i<this._activeRenderLoops.length;i++){(0,this._activeRenderLoops[i])()}this.endFrame()}}if(this._activeRenderLoops.length>0){var r=null;this._vrDisplay&&this._vrDisplay.isPresenting&&(r=this._vrDisplay),this._frameHandler=e.Tools.QueueNewFrame(this._bindedRenderFunction,r)}else this._renderingQueueLaunched=!1},n.prototype.runRenderLoop=function(t){-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),this._frameHandler=e.Tools.QueueNewFrame(this._bindedRenderFunction)))},n.prototype.switchFullscreen=function(t){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,this._renderingCanvas&&e.Tools.RequestFullscreen(this._renderingCanvas))},n.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1),this.applyStates();var n=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),n|=this._gl.COLOR_BUFFER_BIT),i&&(this._gl.clearDepth(1),n|=this._gl.DEPTH_BUFFER_BIT),r&&(this._gl.clearStencil(0),n|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(n)},n.prototype.scissorClear=function(e,t,i,r,n){var o=this._gl,s=o.getParameter(o.SCISSOR_TEST),a=o.getParameter(o.SCISSOR_BOX);o.enable(o.SCISSOR_TEST),o.scissor(e,t,i,r),this.clear(n,!0,!0,!0),o.scissor(a[0],a[1],a[2],a[3]),!0===s?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST)},n.prototype.setViewport=function(e,t,i){var r=t||this.getRenderWidth(),n=i||this.getRenderHeight(),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*r,s*n,r*e.width,n*e.height)},n.prototype.setDirectViewport=function(e,t,i,r){var n=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(e,t,i,r),n},n.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this),this._measureFps()},n.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame(),this.onEndFrameObservable.notifyObservers(this)},n.prototype.resize=function(){if(!this._vrDisplay||!this._vrDisplay.isPresenting){var e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)}},n.prototype.setSize=function(e,t){if(this._renderingCanvas&&(this._renderingCanvas.width!==e||this._renderingCanvas.height!==t)){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var r=this.scenes[i],n=0;n<r.cameras.length;n++){var o=r.cameras[n];o._currentRenderId=0}this.onResizeObservable.hasObservers&&this.onResizeObservable.notifyObservers(this)}},n.prototype.isVRDevicePresent=function(){return!!this._vrDisplay},n.prototype.getVRDevice=function(){return this._vrDisplay},n.prototype.initWebVR=function(){var t=this,i=function(){var e={vrDisplay:t._vrDisplay,vrSupported:t._vrSupported};t.onVRDisplayChangedObservable.notifyObservers(e)};return this._onVrDisplayConnect||(this._onVrDisplayConnect=function(e){t._vrDisplay=e.display,i()},this._onVrDisplayDisconnect=function(){t._vrDisplay.cancelAnimationFrame(t._frameHandler),t._vrDisplay=void 0,t._frameHandler=e.Tools.QueueNewFrame(t._bindedRenderFunction),i()},this._onVrDisplayPresentChange=function(){t._vrExclusivePointerMode=t._vrDisplay&&t._vrDisplay.isPresenting},window.addEventListener("vrdisplayconnect",this._onVrDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange)),this._getVRDisplays(i),this.onVRDisplayChangedObservable},n.prototype.enableVR=function(){var e=this;if(this._vrDisplay&&!this._vrDisplay.isPresenting){var t=function(){e.onVRRequestPresentComplete.notifyObservers(!0),e._onVRFullScreenTriggered()},i=function(){e.onVRRequestPresentComplete.notifyObservers(!1)};this.onVRRequestPresentStart.notifyObservers(this),this._vrDisplay.requestPresent([{source:this.getRenderingCanvas()}]).then(t).catch(i)}},n.prototype.disableVR=function(){this._vrDisplay&&this._vrDisplay.isPresenting&&this._vrDisplay.exitPresent().then(this._onVRFullScreenTriggered).catch(this._onVRFullScreenTriggered)},n.prototype._getVRDisplays=function(e){var t=this,i=function(e){return t._vrSupported=!0,t._vrDisplay=e[0]};navigator.getVRDisplays?navigator.getVRDisplays().then(i).then(e).catch(function(i){t._vrSupported=!1,e()}):(this._vrDisplay=void 0,this._vrSupported=!1,e())},n.prototype.bindFramebuffer=function(e,t,i,r,n){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this.bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var o=this._gl;e.isCube&&(void 0===t&&(t=0),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,0)),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,i,r):o.viewport(0,0,i||e.width,r||e.height),this.wipeCaches()},n.prototype.bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},n.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null;var r=this._gl;e._MSAAFramebuffer&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,e._MSAAFramebuffer),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,e._framebuffer),r.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,r.COLOR_BUFFER_BIT,r.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(r.TEXTURE_2D,e),r.generateMipmap(r.TEXTURE_2D),this._bindTextureDirectly(r.TEXTURE_2D,null)),i&&(e._MSAAFramebuffer&&this.bindUnboundFramebuffer(e._framebuffer),i()),this.bindUnboundFramebuffer(null)},n.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,e),t.generateMipmap(t.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}},n.prototype.flushFramebuffer=function(){this._gl.flush()},n.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this.bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},n.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},n.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");return this.bindUniformBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t},n.prototype.updateUniformBuffer=function(e,t,i,r){this.bindUniformBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this.bindUniformBuffer(null)},n.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},n.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");return this.bindArrayBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},n.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic vertex buffer");return this.bindArrayBuffer(t),e instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},n.prototype.updateDynamicIndexBuffer=function(e,t,i){void 0===i&&(i=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e);var r;r=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},n.prototype.updateDynamicVertexBuffer=function(e,t,i,r){this.bindArrayBuffer(e),void 0===i&&(i=0),void 0===r?t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t.subarray(i,i+r)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+r)),this._resetVertexBufferBinding()},n.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},n.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var r,n=!1;if(e instanceof Uint16Array)r=e;else if(this._caps.uintIndices)if(e instanceof Uint32Array)r=e,n=!0;else{for(var o=0;o<e.length;o++)if(e[o]>65535){n=!0;break}r=n?new Uint32Array(e):new Uint16Array(e)}else r=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,r,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=n,i},n.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},n.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e)},n.prototype.bindUniformBufferBase=function(e,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e)},n.prototype.bindUniformBlock=function(e,t,i){var r=this._gl.getUniformBlockIndex(e,t);this._gl.uniformBlockBinding(e,r,i)},n.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},n.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e),this._currentBoundBuffer[t]=e)},n.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},n.prototype.vertexAttribPointer=function(e,t,i,r,n,o,s){var a=this._currentBufferPointers[t],l=!1;a.active?(a.buffer!==e&&(a.buffer=e,l=!0),a.size!==i&&(a.size=i,l=!0),a.type!==r&&(a.type=r,l=!0),a.normalized!==n&&(a.normalized=n,l=!0),a.stride!==o&&(a.stride=o,l=!0),a.offset!==s&&(a.offset=s,l=!0)):(l=!0,a.active=!0,a.index=t,a.size=i,a.type=r,a.normalized=n,a.stride=o,a.offset=s,a.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,r,n,o,s))},n.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},n.prototype._bindVertexBuffersAttributes=function(e,t){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var r=0;r<i.length;r++){var n=t.getAttributeLocation(r);if(n>=0){var o=e[i[r]];if(!o)continue;this._gl.enableVertexAttribArray(n),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[n]=!0);var s=o.getBuffer();s&&(this.vertexAttribPointer(s,n,o.getSize(),this._gl.FLOAT,!1,4*o.getStrideSize(),4*o.getOffset()),o.getIsInstanced()&&(this._gl.vertexAttribDivisor(n,o.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(s))))}}},n.prototype.recordVertexArrayObject=function(e,t,i){var r=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(r),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),r},n.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},n.prototype.bindBuffersDirectly=function(e,t,i,r,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var o=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var s=0,a=0;a<o;a++)if(a<i.length){var l=n.getAttributeLocation(a);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this.vertexAttribPointer(e,l,i[a],this._gl.FLOAT,!1,r,s)),s+=4*i[a]}}this._bindIndexBufferWithCache(t)},n.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},n.prototype.bindBuffers=function(e,t,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===i||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i)),this._bindIndexBufferWithCache(t)},n.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var r=this._currentInstanceBuffers[t];e!=r&&r.references&&(e=r,this.bindArrayBuffer(r));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},n.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},n.prototype._releaseBuffer=function(e){return 0===--e.references&&(this._gl.deleteBuffer(e),!0)},n.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");return t.capacity=e,this.bindArrayBuffer(t),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},n.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},n.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index){for(var r=0,n=0;n<i.length;n++){var o=i[n];r+=4*o.attributeSize}for(var n=0;n<i.length;n++){var o=i[n];this._vertexAttribArraysEnabled[o.index]||(this._gl.enableVertexAttribArray(o.index),this._vertexAttribArraysEnabled[o.index]=!0),this.vertexAttribPointer(e,o.index,o.attributeSize,o.attribyteType||this._gl.FLOAT,o.normalized||!1,r,o.offset),this._gl.vertexAttribDivisor(o.index,1),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}}else for(var s=0;s<4;s++){var a=i[s];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this.vertexAttribPointer(e,a,4,this._gl.FLOAT,!1,64,16*s),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}},n.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl)},n.prototype.draw=function(e,t,i,r){this.applyStates(),this._drawCalls.addCount(1,!1);var n=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;if(r)return void this._gl.drawElementsInstanced(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o,r);this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,n,t*o)},n.prototype.drawPointClouds=function(e,t,i){if(this.applyStates(),this._drawCalls.addCount(1,!1),i)return void this._gl.drawArraysInstanced(this._gl.POINTS,e,t,i);this._gl.drawArrays(this._gl.POINTS,e,t)},n.prototype.drawUnIndexed=function(e,t,i,r){if(this.applyStates(),this._drawCalls.addCount(1,!1),r)return void this._gl.drawArraysInstanced(e?this._gl.TRIANGLES:this._gl.LINES,t,i,r);this._gl.drawArrays(e?this._gl.TRIANGLES:this._gl.LINES,t,i)},n.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deleteProgram(e.getProgram()))},n.prototype._deleteProgram=function(e){e&&(e.__SPECTOR_rebuildProgram=null,e.transformFeedback&&(this.deleteTransformFeedback(e.transformFeedback),e.transformFeedback=null),this._gl.deleteProgram(e))},n.prototype.createEffect=function(t,i,r,n,o,s,a,l,h){var c=t.vertexElement||t.vertex||t,u=t.fragmentElement||t.fragment||t,f=c+"+"+u+"@"+(o||i.defines);if(this._compiledEffects[f]){var d=this._compiledEffects[f];return a&&d.isReady()&&a(d),d}var p=new e.Effect(t,i,r,n,this,o,s,a,l,h);return p._key=f,this._compiledEffects[f]=p,p},n.prototype.createEffectForParticles=function(e,t,i,r,n,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r=""),this.createEffect({vertex:"particles",fragmentElement:e},["position","color","options"],["view","projection"].concat(t),["diffuseSampler"].concat(i),r,n,o,s)},n.prototype.createRawShaderProgram=function(e,t,r,n){void 0===n&&(n=null),r=r||this._gl;var o=i(r,e,"vertex"),s=i(r,t,"fragment");return this._createShaderProgram(o,s,r,n)},n.prototype.createShaderProgram=function(e,i,r,n,o){void 0===o&&(o=null),n=n||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var s=this._webGLVersion>1?"#version 300 es\n":"",a=t(n,e,"vertex",r,s),l=t(n,i,"fragment",r,s),h=this._createShaderProgram(a,l,n,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),h},n.prototype._createShaderProgram=function(e,t,i,r){void 0===r&&(r=null);var n=i.createProgram();if(!n)throw new Error("Unable to create program");if(i.attachShader(n,e),i.attachShader(n,t),this.webGLVersion>1&&r){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(n,r),n.transformFeedback=o}if(i.linkProgram(n),this.webGLVersion>1&&r&&this.bindTransformFeedback(null),!i.getProgramParameter(n,i.LINK_STATUS)){i.validateProgram(n);var s=i.getProgramInfoLog(n);if(s)throw new Error(s)}return i.deleteShader(e),i.deleteShader(t),n},n.prototype.getUniforms=function(e,t){for(var i=new Array,r=0;r<t.length;r++)i.push(this._gl.getUniformLocation(e,t[r]));return i},n.prototype.getAttributes=function(e,t){for(var i=[],r=0;r<t.length;r++)try{i.push(this._gl.getAttribLocation(e,t[r]))}catch(e){i.push(-1)}return i},n.prototype.enableEffect=function(e){e&&(this.setProgram(e.getProgram()),this._currentEffect=e,e.onBind&&e.onBind(e),e.onBindObservable.notifyObservers(e))},n.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},n.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},n.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},n.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},n.prototype.setFloatArray=function(e,t){e&&this._gl.uniform1fv(e,t)},n.prototype.setFloatArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},n.prototype.setFloatArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},n.prototype.setFloatArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},n.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},n.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},n.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},n.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},n.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},n.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},n.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},n.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},n.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},n.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},n.prototype.setFloat3=function(e,t,i,r){e&&this._gl.uniform3f(e,t,i,r)},n.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},n.prototype.setFloat4=function(e,t,i,r,n){e&&this._gl.uniform4f(e,t,i,r,n)},n.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},n.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},n.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1);var n=r?this._gl.FRONT:this._gl.BACK,o=r?this._gl.BACK:this._gl.FRONT,s=this.cullBackFaces?n:o;(this._depthCullingState.cull!==e||i||this._depthCullingState.cullFace!==s)&&(e?(this._depthCullingState.cullFace=s,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this.setZOffset(t)},n.prototype.setZOffset=function(e){this._depthCullingState.zOffset=e},n.prototype.getZOffset=function(){return this._depthCullingState.zOffset},n.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},n.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},n.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},n.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e),this._colorWrite=e},n.prototype.getColorWrite=function(){return this._colorWrite},n.prototype.setAlphaConstants=function(e,t,i,r){this._alphaState.setAlphaBlendConstants(e,t,i,r)},n.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case n.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case n.ALPHA_PREMULTIPLIED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_PREMULTIPLIED_PORTERDUFF:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case n.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case n.ALPHA_INTERPOLATE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case n.ALPHA_SCREENMODE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||this.setDepthWrite(e===n.ALPHA_DISABLE),this._alphaMode=e}},n.prototype.getAlphaMode=function(){return this._alphaMode},n.prototype.setAlphaTesting=function(e){this._alphaTest=e},n.prototype.getAlphaTesting=function(){return!!this._alphaTest},n.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this._unbindVertexArrayObject(),this.bindIndexBuffer(null),this.bindArrayBuffer(null))},n.prototype.setTextureFormatToUse=function(e){for(var t=0,i=this.texturesSupported.length;t<i;t++)for(var r=0,n=e.length;r<n;r++)if(this._texturesSupported[t]===e[r].toLowerCase())return this._textureFormatInUse=this._texturesSupported[t];return this._textureFormatInUse=null,null},n.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},n.prototype.createTexture=function(t,i,r,n,o,s,a,l,h,c){var u=this;void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null);var f=String(t),d="data:"===f.substr(0,5),p="blob:"===f.substr(0,5),m=d&&-1!==f.indexOf("base64"),g=h||new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL),v=f.lastIndexOf("."),y=v>0?f.substring(v).toLowerCase():"",_=this.getCaps().s3tc&&".dds"===y,b=".tga"===y,x=!1;!this._textureFormatInUse||m||h||(f=f.substring(0,v)+this._textureFormatInUse,x=!0),n&&n._addPendingData(g),g.url=f,g.generateMipMaps=!i,g.samplingMode=o,g.invertY=r,this._doNotHandleContextLost||(g._buffer=l);var T=null;s&&!h&&(T=g.onLoadedObservable.add(s)),h||this._internalTexturesCache.push(g);var E=function(s,h){n&&n._removePendingData(g),T&&g.onLoadedObservable.remove(T),x?u.createTexture(t,i,r,n,o,null,a,l,g):e.Tools.UseFallbackTexture&&u.createTexture(e.Tools.fallbackTexture,i,r,n,o,null,a,l,g),a&&a(s||"Unknown error",h)},S=null;if(x||b||_)x?S=function(t){var s=new e.Internals.KhronosTextureContainer(t,1);u._prepareWebGLTexture(g,n,s.pixelWidth,s.pixelHeight,r,!1,!0,function(){return s.uploadLevels(u._gl,!i),!1},o)}:b?S=function(t){var s=new Uint8Array(t),a=e.Internals.TGATools.GetTGAHeader(s);u._prepareWebGLTexture(g,n,a.width,a.height,r,i,!1,function(){return e.Internals.TGATools.UploadContent(u._gl,s),!1},o)}:_&&(S=function(t){var s=e.Internals.DDSTools.GetDDSInfo(t),a=(s.isRGB||s.isLuminance||s.mipmapCount>1)&&!i&&s.width>>s.mipmapCount-1==1;u._prepareWebGLTexture(g,n,s.width,s.height,r,!a,s.isFourCC,function(){return e.Internals.DDSTools.UploadDDSLevels(u,u._gl,t,s,a,1),!1},o)}),l?S&&S(l):e.Tools.LoadFile(f,function(e){S&&S(e)},void 0,n?n.database:void 0,!0,function(e,t){E("Unable to load "+(e&&e.responseURL,t))});else{var w=function(t){p&&!u._doNotHandleContextLost&&(g._buffer=t),u._prepareWebGLTexture(g,n,t.width,t.height,r,i,!1,function(i,r,o){var s=u._gl,a=t.width===i&&t.height===r,l=c?u._getInternalFormat(c):".jpg"===y?s.RGB:s.RGBA;if(a)return s.texImage2D(s.TEXTURE_2D,0,l,l,s.UNSIGNED_BYTE,t),!1;var h=new e.InternalTexture(u,e.InternalTexture.DATASOURCE_TEMP);return u._bindTextureDirectly(s.TEXTURE_2D,h),s.texImage2D(s.TEXTURE_2D,0,l,l,s.UNSIGNED_BYTE,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),u._rescaleTexture(h,g,n,l,function(){u._releaseTexture(h),u._bindTextureDirectly(s.TEXTURE_2D,g),o()}),!0},o)};!d||m?l instanceof HTMLImageElement?w(l):e.Tools.LoadImage(f,w,E,n?n.database:null):l instanceof Array||"string"==typeof l||l instanceof ArrayBuffer?e.Tools.LoadImage(l,w,E,n?n.database:null):w(l)}return g},n.prototype._rescaleTexture=function(t,i,r,o,s){var a=this,l=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:n.TEXTURETYPE_UNSIGNED_INT,samplingMode:e.Texture.BILINEAR_SAMPLINGMODE,generateDepthBuffer:!1,generateStencilBuffer:!1});this._rescalePostProcess||(this._rescalePostProcess=new e.PassPostProcess("rescale",1,null,e.Texture.BILINEAR_SAMPLINGMODE,this,!1,n.TEXTURETYPE_UNSIGNED_INT)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){a._rescalePostProcess.onApply=function(e){e._bindTexture("textureSampler",t)};var e=r;e||(e=a.scenes[a.scenes.length-1]),e.postProcessManager.directRender([a._rescalePostProcess],l,!0),a._bindTextureDirectly(a._gl.TEXTURE_2D,i),a._gl.copyTexImage2D(a._gl.TEXTURE_2D,0,o,0,0,i.width,i.height,0),a.unBindFramebuffer(l),a._releaseTexture(l),s&&s()})},n.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case n.TEXTUREFORMAT_ALPHA:t=this._gl.ALPHA;break;case n.TEXTUREFORMAT_LUMINANCE:t=this._gl.LUMINANCE;break;case n.TEXTUREFORMAT_LUMINANCE_ALPHA:t=this._gl.LUMINANCE_ALPHA;break;case n.TEXTUREFORMAT_RGB:t=this._gl.RGB;break;case n.TEXTUREFORMAT_RGBA:t=this._gl.RGBA}return t},n.prototype.updateRawTexture=function(e,t,i,r,o,s){if(void 0===o&&(o=null),void 0===s&&(s=n.TEXTURETYPE_UNSIGNED_INT),e){var a=this._getInternalFormat(i),l=this._getRGBABufferInternalSizedFormat(s),h=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===r?1:r?1:0),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.type=s,e.invertY=r,e._compression=o),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),o&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[o],e.width,e.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,l,e.width,e.height,0,a,h,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this.resetTextureCache(),e.isReady=!0}},n.prototype.createRawTexture=function(t,i,n,o,s,a,l,h,c){void 0===h&&(h=null),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW);u.baseWidth=i,u.baseHeight=n,u.width=i,u.height=n,u.format=o,u.generateMipMaps=s,u.samplingMode=l,u.invertY=a,u._compression=h,u.type=c,this._doNotHandleContextLost||(u._bufferView=t),this.updateRawTexture(u,t,o,a,h,c),this._bindTextureDirectly(this._gl.TEXTURE_2D,u);var f=r(l,s,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,f.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},n.prototype.createDynamicTexture=function(t,i,r,n){var o=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_DYNAMIC);return o.baseWidth=t,o.baseHeight=i,r&&(t=this.needPOTTextures?e.Tools.GetExponentOfTwo(t,this._caps.maxTextureSize):t,i=this.needPOTTextures?e.Tools.GetExponentOfTwo(i,this._caps.maxTextureSize):i),this.resetTextureCache(),o.width=t,o.height=i,o.isReady=!1,o.generateMipMaps=r,o.samplingMode=n,this.updateTextureSamplingMode(n,o),this._internalTexturesCache.push(o),o},n.prototype.updateTextureSamplingMode=function(e,t){var i=r(e,t.generateMipMaps,this._gl);t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):t.is3D?(this._bindTextureDirectly(this._gl.TEXTURE_3D,t),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_3D,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t.samplingMode=e},n.prototype.updateDynamicTexture=function(e,t,i,r,n){if(void 0===r&&(r=!1),e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var o=n?this._getInternalFormat(n):this._gl.RGBA;this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,o,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),r&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.resetTextureCache(),e.isReady=!0}},n.prototype.updateVideoTexture=function(e,t,i){if(e&&!e._isDisabled){this._bindTextureDirectly(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1);try{if(void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported)this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);else{if(!e._workingCanvas){e._workingCanvas=document.createElement("canvas");var r=e._workingCanvas.getContext("2d");if(!r)throw new Error("Unable to get 2d context");e._workingContext=r,e._workingCanvas.width=e.width,e._workingCanvas.height=e.height}e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e.width,e.height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)}e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this.resetTextureCache(),e.isReady=!0}catch(t){e._isDisabled=!0}}},n.prototype.createRenderTargetTexture=function(t,i){var o=new c;void 0!==i&&"object"==typeof i?(o.generateMipMaps=i.generateMipMaps,o.generateDepthBuffer=void 0===i.generateDepthBuffer||i.generateDepthBuffer,o.generateStencilBuffer=o.generateDepthBuffer&&i.generateStencilBuffer,o.type=void 0===i.type?n.TEXTURETYPE_UNSIGNED_INT:i.type,o.samplingMode=void 0===i.samplingMode?e.Texture.TRILINEAR_SAMPLINGMODE:i.samplingMode):(o.generateMipMaps=i,o.generateDepthBuffer=!0,o.generateStencilBuffer=!1,o.type=n.TEXTURETYPE_UNSIGNED_INT,o.samplingMode=e.Texture.TRILINEAR_SAMPLINGMODE),o.type!==n.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering?o.type!==n.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering||(o.samplingMode=e.Texture.NEAREST_SAMPLINGMODE):o.samplingMode=e.Texture.NEAREST_SAMPLINGMODE;var s=this._gl,a=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET);this._bindTextureDirectly(s.TEXTURE_2D,a);var l=t.width||t,h=t.height||t,u=r(o.samplingMode,!!o.generateMipMaps,s);o.type!==n.TEXTURETYPE_FLOAT||this._caps.textureFloat||(o.type=n.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,u.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,u.min),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(o.type),l,h,0,s.RGBA,this._getWebGLTextureType(o.type),null);var f=s.createFramebuffer();return this.bindUnboundFramebuffer(f),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,a._webGLTexture,0),a._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!o.generateStencilBuffer,o.generateDepthBuffer,l,h),o.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),s.bindRenderbuffer(s.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),a._framebuffer=f,a.baseWidth=l,a.baseHeight=h,a.width=l,a.height=h,a.isReady=!0,a.samples=1,a.generateMipMaps=!!o.generateMipMaps,a.samplingMode=o.samplingMode,a.type=o.type,a._generateDepthBuffer=o.generateDepthBuffer,a._generateStencilBuffer=!!o.generateStencilBuffer,this.resetTextureCache(),this._internalTexturesCache.push(a),a},n.prototype.createMultipleRenderTarget=function(t,i){var o=!1,s=!0,a=!1,l=!1,h=1,c=n.TEXTURETYPE_UNSIGNED_INT,u=e.Texture.TRILINEAR_SAMPLINGMODE,f=[],d=[];void 0!==i&&(o=i.generateMipMaps,s=void 0===i.generateDepthBuffer||i.generateDepthBuffer,a=i.generateStencilBuffer,l=i.generateDepthTexture,h=i.textureCount||1,i.types&&(f=i.types),i.samplingModes&&(d=i.samplingModes));var p=this._gl,m=p.createFramebuffer();this.bindUnboundFramebuffer(m);for(var g=t.width||t,v=t.height||t,y=[],_=[],b=this._setupFramebufferDepthAttachments(a,s,g,v),x=0;x<h;x++){var T=d[x]||u,E=f[x]||c;E!==n.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering?E!==n.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering||(T=e.Texture.NEAREST_SAMPLINGMODE):T=e.Texture.NEAREST_SAMPLINGMODE;var S=r(T,o,p);E!==n.TEXTURETYPE_FLOAT||this._caps.textureFloat||(E=n.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var w=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET),M=p[this.webGLVersion>1?"COLOR_ATTACHMENT"+x:"COLOR_ATTACHMENT"+x+"_WEBGL"];y.push(w),_.push(M),p.activeTexture(p["TEXTURE"+x]),p.bindTexture(p.TEXTURE_2D,w._webGLTexture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,S.mag),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,S.min),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(E),g,v,0,p.RGBA,this._getWebGLTextureType(E),null),p.framebufferTexture2D(p.DRAW_FRAMEBUFFER,M,p.TEXTURE_2D,w._webGLTexture,0),o&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null),w._framebuffer=m,w._depthStencilBuffer=b,w.baseWidth=g,w.baseHeight=v,w.width=g,w.height=v,w.isReady=!0,w.samples=1,w.generateMipMaps=o,w.samplingMode=T,w.type=E,w._generateDepthBuffer=s,w._generateStencilBuffer=a,this._internalTexturesCache.push(w)}if(l&&this._caps.depthTextureExtension){var A=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_MULTIRENDERTARGET);p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,A._webGLTexture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,this.webGLVersion<2?p.DEPTH_COMPONENT:p.DEPTH_COMPONENT16,g,v,0,p.DEPTH_COMPONENT,p.UNSIGNED_SHORT,null),p.framebufferTexture2D(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.TEXTURE_2D,A._webGLTexture,0),A._framebuffer=m,A.baseWidth=g,A.baseHeight=v,A.width=g,A.height=v,A.isReady=!0,A.samples=1,A.generateMipMaps=o,A.samplingMode=p.NEAREST,A._generateDepthBuffer=s,A._generateStencilBuffer=a,y.push(A),this._internalTexturesCache.push(A)}return p.drawBuffers(_),p.bindRenderbuffer(p.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),this.resetTextureCache(),y},n.prototype._setupFramebufferDepthAttachments=function(e,t,i,r,n){void 0===n&&(n=1);var o=null,s=this._gl;return e?(o=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,o),n>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,i,r):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,r),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,o)):t&&(o=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,o),n>1?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH_COMPONENT16,i,r):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,i,r),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o)),o},n.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var i=this._gl;if(t=Math.min(t,i.getParameter(i.MAX_SAMPLES)),e._depthStencilBuffer&&i.deleteRenderbuffer(e._depthStencilBuffer),e._MSAAFramebuffer&&i.deleteFramebuffer(e._MSAAFramebuffer),e._MSAARenderBuffer&&i.deleteRenderbuffer(e._MSAARenderBuffer),t>1){var r=i.createFramebuffer();if(!r)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=r,this.bindUnboundFramebuffer(e._MSAAFramebuffer);var n=i.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorageMultisample(i.RENDERBUFFER,t,i.RGBA8,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this.bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),i.bindRenderbuffer(i.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),t},n.prototype._uploadDataToTexture=function(e,t,i,r,n,o,s,a){this._gl.texImage2D(e,t,i,r,n,0,o,s,a)},n.prototype._uploadCompressedDataToTexture=function(e,t,i,r,n,o){this._gl.compressedTexImage2D(e,t,i,r,n,0,o)},n.prototype.createRenderTargetCubeTexture=function(t,i){var n=this._gl,o=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET),s=!0,a=!0,l=!1,h=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(s=void 0===i.generateMipMaps||i.generateMipMaps,a=void 0===i.generateDepthBuffer||i.generateDepthBuffer,l=!(!a||!i.generateStencilBuffer),void 0!==i.samplingMode&&(h=i.samplingMode)),o.isCube=!0,o.generateMipMaps=s,o.samples=1,o.samplingMode=h;var c=r(h,s,n);this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,o);for(var u=0;u<6;u++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,n.RGBA,t,t,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,c.mag),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,c.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var f=n.createFramebuffer();return this.bindUnboundFramebuffer(f),o._depthStencilBuffer=this._setupFramebufferDepthAttachments(l,a,t,t),o.generateMipMaps&&(this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,o),n.generateMipmap(n.TEXTURE_CUBE_MAP)),this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null),n.bindRenderbuffer(n.RENDERBUFFER,null),this.bindUnboundFramebuffer(null),o._framebuffer=f,o.width=t,o.height=t,o.isReady=!0,this.resetTextureCache(),this._internalTexturesCache.push(o),o},n.prototype.createPrefilteredCubeTexture=function(t,i,r,n,o,s,a,l){var h=this;void 0===o&&(o=null),void 0===s&&(s=null),void 0===l&&(l=null);var c=function(t){if(!t)return void(o&&o(null));var s=t.texture;if(s._dataSource=e.InternalTexture.DATASOURCE_CUBEPREFILTERED,s._lodGenerationScale=r,s._lodGenerationOffset=n,h._caps.textureLOD)return void(o&&o(s));var a=h._gl,l=t.width;if(l){for(var c=[],u=0;u<3;u++){var f=u/2,d=1-f,p=n,m=e.Scalar.Log2(l)*r+n,g=p+(m-p)*d,v=Math.round(Math.min(Math.max(g,0),m)),y=new e.InternalTexture(h,e.InternalTexture.DATASOURCE_TEMP);if(y.isCube=!0,h._bindTextureDirectly(a.TEXTURE_CUBE_MAP,y),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),t.isDDS){var _=t.info,b=t.data;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,_.isCompressed?1:0),e.Internals.DDSTools.UploadDDSLevels(h,h._gl,b,_,!0,6,v)}else e.Tools.Warn("DDS is the only prefiltered cube map supported so far.");h._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null);var x=new e.BaseTexture(i);x.isCube=!0,x._texture=y,y.isReady=!0,c.push(x)}s._lodTextureHigh=c[2],s._lodTextureMid=c[1],s._lodTextureLow=c[0],o&&o(s)}};return this.createCubeTexture(t,i,null,!1,c,s,a,l)},n.prototype.createCubeTexture=function(t,i,r,n,s,l,h,c){var u=this;void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=null);var f=this._gl,d=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBE);d.isCube=!0,d.url=t,d.generateMipMaps=!n,this._doNotHandleContextLost||(d._extension=c,d._files=r);var p=!1,m=!1,g=t.lastIndexOf("."),v=c||(g>-1?t.substring(g).toLowerCase():"");this._textureFormatInUse?(v=this._textureFormatInUse,t=(g>-1?t.substring(0,g):t)+this._textureFormatInUse,p=!0):m=".dds"===v;var y=function(e,t){l&&e&&l(e.status+" "+e.statusText,t)};if(p)e.Tools.LoadFile(t,function(t){var i=new e.Internals.KhronosTextureContainer(t,6),r=i.numberOfMipmapLevels>1&&!n;u._bindTextureDirectly(f.TEXTURE_CUBE_MAP,d),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1),i.uploadLevels(u._gl,!n),u.setCubeMapTextureParams(f,r),d.width=i.pixelWidth,d.height=i.pixelHeight,d.isReady=!0},void 0,void 0,!0,y);else if(m)r&&6===r.length?a(0,0,function(t){for(var i,r=!1,o=0,a=0;a<t.length;a++){var l=t[a];i=e.Internals.DDSTools.GetDDSInfo(l),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n,u._bindTextureDirectly(f.TEXTURE_CUBE_MAP,d),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,i.isCompressed?1:0),e.Internals.DDSTools.UploadDDSLevels(u,u._gl,l,i,r,6,-1,a),n||i.isFourCC||1!==i.mipmapCount||f.generateMipmap(f.TEXTURE_CUBE_MAP),d.width=i.width,d.height=i.height,d.type=i.textureType,o=i.width}u.setCubeMapTextureParams(f,r),d.isReady=!0,s&&s({isDDS:!0,width:o,info:i,imgs:t,texture:d})},r,l):e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),r=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!n;u._bindTextureDirectly(f.TEXTURE_CUBE_MAP,d),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,i.isCompressed?1:0),e.Internals.DDSTools.UploadDDSLevels(u,u._gl,t,i,r,6),n||i.isFourCC||1!==i.mipmapCount||f.generateMipmap(f.TEXTURE_CUBE_MAP),u.setCubeMapTextureParams(f,r),d.width=i.width,d.height=i.height,d.isReady=!0,d.type=i.textureType,s&&s({isDDS:!0,width:i.width,info:i,data:t,texture:d})},void 0,void 0,!0,y);else{if(!r)throw new Error("Cannot load cubemap because files were not defined");o(0,i,function(t){var i=u.needPOTTextures?e.Tools.GetExponentOfTwo(t[0].width,u._caps.maxCubemapTextureSize):t[0].width,r=i;if(u._prepareWorkingCanvas(),u._workingCanvas&&u._workingContext){u._workingCanvas.width=i,u._workingCanvas.height=r;var o=[f.TEXTURE_CUBE_MAP_POSITIVE_X,f.TEXTURE_CUBE_MAP_POSITIVE_Y,f.TEXTURE_CUBE_MAP_POSITIVE_Z,f.TEXTURE_CUBE_MAP_NEGATIVE_X,f.TEXTURE_CUBE_MAP_NEGATIVE_Y,f.TEXTURE_CUBE_MAP_NEGATIVE_Z];u._bindTextureDirectly(f.TEXTURE_CUBE_MAP,d),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0);for(var a=h?u._getInternalFormat(h):u._gl.RGBA,l=0;l<o.length;l++)u._workingContext.drawImage(t[l],0,0,t[l].width,t[l].height,0,0,i,r),f.texImage2D(o[l],0,a,a,f.UNSIGNED_BYTE,u._workingCanvas);n||f.generateMipmap(f.TEXTURE_CUBE_MAP),u.setCubeMapTextureParams(f,!n),d.width=i,d.height=r,d.isReady=!0,h&&(d.format=h),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),s&&s()}},r,l)}return this._internalTexturesCache.push(d),d},n.prototype.setCubeMapTextureParams=function(e,t){e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,t?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null),this.resetTextureCache()},n.prototype.updateRawCubeTexture=function(t,i,r,n,o,s,a){void 0===s&&(s=null),void 0===a&&(a=0),t._bufferViewArray=i,t.format=r,t.type=n,t.invertY=o,t._compression=s;var l=this._gl,h=this._getWebGLTextureType(n),c=this._getInternalFormat(r),u=this._getRGBABufferInternalSizedFormat(n),f=!1;c===l.RGB&&(c=l.RGBA,f=!0),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,t),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,void 0===o?1:o?1:0),t.width%4!=0&&l.pixelStorei(l.UNPACK_ALIGNMENT,1);for(var d=0;d<6;d++){var p=i[d];s?l.compressedTexImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,this.getCaps().s3tc[s],t.width,t.height,0,p):(f&&(p=this._convertRGBtoRGBATextureData(p,t.width,t.height,n)),l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+d,a,u,t.width,t.height,0,c,h,p))}(!this.needPOTTextures||e.Tools.IsExponentOfTwo(t.width)&&e.Tools.IsExponentOfTwo(t.height))&&t.generateMipMaps&&0===a&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.resetTextureCache(),t.isReady=!0},n.prototype.createRawCubeTexture=function(t,i,n,o,s,a,l,h){void 0===h&&(h=null);var c=this._gl,u=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_CUBERAW);u.isCube=!0,u.generateMipMaps=s,u.format=n,u.type=o,this._doNotHandleContextLost||(u._bufferViewArray=t);var f=this._getWebGLTextureType(o),d=this._getInternalFormat(n);d===c.RGB&&(d=c.RGBA);var p=i,m=p;if(u.width=p,u.height=m,!this.needPOTTextures||e.Tools.IsExponentOfTwo(u.width)&&e.Tools.IsExponentOfTwo(u.height)||(s=!1),t&&this.updateRawCubeTexture(u,t,n,o,a,h),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u),t&&s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),f!==c.FLOAT||this._caps.textureFloatLinearFiltering)if(f!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering){var g=r(l,s,c);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,g.mag),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,g.min)}else c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.NEAREST);else c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.NEAREST);return c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),this._bindTextureDirectly(c.TEXTURE_CUBE_MAP,null),u},n.prototype.createRawCubeTextureFromUrl=function(t,i,r,n,o,s,a,l,h,c,u,f){var d=this;void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===f&&(f=!1);var p=this._gl,m=this.createRawCubeTexture(null,r,n,o,!s,f,u);i._addPendingData(m),m.url=t,this._internalTexturesCache.push(m);var g=function(e,t){i._removePendingData(m),c&&e&&c(e.status+" "+e.statusText,t)},v=function(e){var t=m.width,r=a(e);if(r){if(l){var c=d._getWebGLTextureType(o),u=d._getInternalFormat(n),g=d._getRGBABufferInternalSizedFormat(o),v=!1;u===p.RGB&&(u=p.RGBA,v=!0),d._bindTextureDirectly(p.TEXTURE_CUBE_MAP,m),p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,0);for(var y=l(r),_=0;_<y.length;_++)for(var b=t>>_,x=0;x<6;x++){var T=y[_][x];v&&(T=d._convertRGBtoRGBATextureData(T,b,b,o)),p.texImage2D(x,_,g,b,b,0,u,c,T)}d._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null)}else m.generateMipMaps=!s,d.updateRawCubeTexture(m,r,n,o,f);m.isReady=!0,d.resetTextureCache(),i._removePendingData(m),h&&h()}};return e.Tools.LoadFile(t,function(e){v(e)},void 0,i.database,!0,g),m},n.prototype.updateRawTexture3D=function(e,t,i,r,n){void 0===n&&(n=null);var o=this._getInternalFormat(i);this._bindTextureDirectly(this._gl.TEXTURE_3D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===r?1:r?1:0),this._doNotHandleContextLost||(e._bufferView=t,e.format=i,e.invertY=r,e._compression=n),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&t?this._gl.compressedTexImage3D(this._gl.TEXTURE_3D,0,this.getCaps().s3tc[n],e.width,e.height,e.depth,0,t):this._gl.texImage3D(this._gl.TEXTURE_3D,0,o,e.width,e.height,e.depth,0,o,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this.resetTextureCache(),e.isReady=!0},n.prototype.createRawTexture3D=function(t,i,n,o,s,a,l,h,c){void 0===c&&(c=null);var u=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RAW3D);u.baseWidth=i,u.baseHeight=n,u.baseDepth=o,u.width=i,u.height=n,u.depth=o,u.format=s,u.generateMipMaps=a,u.samplingMode=h,u.is3D=!0,this._doNotHandleContextLost||(u._bufferView=t),this.updateRawTexture3D(u,t,s,l,c),this._bindTextureDirectly(this._gl.TEXTURE_3D,u);var f=r(h,a,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MAG_FILTER,f.mag),this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_MIN_FILTER,f.min),a&&this._gl.generateMipmap(this._gl.TEXTURE_3D),this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._internalTexturesCache.push(u),u},n.prototype._prepareWebGLTextureContinuation=function(e,t,i,n,o){var s=this._gl;if(s){var a=r(o,!i,s);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,a.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,a.min),i||n||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),this.resetTextureCache(),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},n.prototype._prepareWebGLTexture=function(t,i,r,n,o,s,a,l,h){var c=this;void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE);var u=this.needPOTTextures?e.Tools.GetExponentOfTwo(r,this.getCaps().maxTextureSize):r,f=this.needPOTTextures?e.Tools.GetExponentOfTwo(n,this.getCaps().maxTextureSize):n,d=this._gl;if(d){if(!t._webGLTexture)return this.resetTextureCache(),void(i&&i._removePendingData(t));this._bindTextureDirectly(d.TEXTURE_2D,t),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,void 0===o?1:o?1:0),t.baseWidth=r,t.baseHeight=n,t.width=u,t.height=f,t.isReady=!0,l(u,f,function(){c._prepareWebGLTextureContinuation(t,i,s,a,h)})||this._prepareWebGLTextureContinuation(t,i,s,a,h)}},n.prototype._convertRGBtoRGBATextureData=function(e,t,i,r){var o;o=r===n.TEXTURETYPE_FLOAT?new Float32Array(t*i*4):new Uint32Array(t*i*4);for(var s=0;s<t;s++)for(var a=0;a<i;a++){var l=3*(a*t+s),h=4*(a*t+s);o[h+0]=e[l+0],o[h+1]=e[l+1],o[h+2]=e[l+2],o[h+3]=1}return o},n.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},n.prototype._releaseTexture=function(e){var t=this._gl;this._releaseFramebufferObjects(e),t.deleteTexture(e._webGLTexture),this.unbindAllTextures();var i=this._internalTexturesCache.indexOf(e);-1!==i&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose()},n.prototype.setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},n.prototype.bindSamplers=function(e){this.setProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var r=e.getUniform(t[i]);this._gl.uniform1i(r,i)}this._currentEffect=null},n.prototype.activateTextureChannel=function(e){this._activeTextureChannel!==e&&(this._gl.activeTexture(e),this._activeTextureChannel=e)},n.prototype._bindTextureDirectly=function(e,t){this._boundTexturesCache[this._activeTextureChannel]!==t&&(this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeTextureChannel]=t)},n.prototype._bindTexture=function(e,t){e<0||(this.activateTextureChannel(this._gl.TEXTURE0+e),this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},n.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t?t._textures.data[t._currentRenderTextureInd]:null)},n.prototype.unbindAllTextures=function(){for(var e=0;e<this._caps.maxTexturesImageUnits;e++)this.activateTextureChannel(this._gl.TEXTURE0+e),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)},n.prototype.setTexture=function(e,t,i){e<0||this._setTexture(e,i)&&this._gl.uniform1i(t,e)},n.prototype._setTexture=function(t,i){if(!i)return null!=this._boundTexturesCache[t]&&(this.activateTextureChannel(this._gl.TEXTURE0+t),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&this._bindTextureDirectly(this._gl.TEXTURE_3D,null)),!1;var r=!1;if(i.video)this.activateTextureChannel(this._gl.TEXTURE0+t),r=!0,i.update();else if(i.delayLoadState===n.DELAYLOADSTATE_NOTLOADED)return i.delayLoad(),!1;var o;if(o=i.isReady()?i.getInternalTexture():i.isCube?this.emptyCubeTexture:i.is3D?this.emptyTexture3D:this.emptyTexture,r||this.activateTextureChannel(this._gl.TEXTURE0+t),this._boundTexturesCache[this._activeTextureChannel]===o)return!1;if(o&&o.is3D){if(this._bindTextureDirectly(this._gl.TEXTURE_3D,o),o&&o._cachedWrapU!==i.wrapU)switch(o._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(o&&o._cachedWrapV!==i.wrapV)switch(o._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}if(o&&o._cachedWrapR!==i.wrapR)switch(o._cachedWrapR=i.wrapR,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_3D,this._gl.TEXTURE_WRAP_R,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_3D,i)}else if(o&&o.isCube){if(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o),o._cachedCoordinatesMode!==i.coordinatesMode){o._cachedCoordinatesMode=i.coordinatesMode;var s=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._bindTextureDirectly(this._gl.TEXTURE_2D,o),o&&o._cachedWrapU!==i.wrapU)switch(o._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(o&&o._cachedWrapV!==i.wrapV)switch(o._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}return!0},n.prototype.setTextureArray=function(e,t,i){if(!(e<0)&&t){this._textureUnits&&this._textureUnits.length===i.length||(this._textureUnits=new Int32Array(i.length));for(var r=0;r<i.length;r++)this._textureUnits[r]=e+r;this._gl.uniform1iv(t,this._textureUnits);for(var n=0;n<i.length;n++)this._setTexture(e+n,i[n])}},n.prototype._setAnisotropicLevel=function(t,i){var r=i.getInternalTexture();if(r){var n=this._caps.textureAnisotropicFilterExtension,o=i.anisotropicFilteringLevel;r.samplingMode!==e.Texture.LINEAR_LINEAR_MIPNEAREST&&r.samplingMode!==e.Texture.LINEAR_LINEAR_MIPLINEAR&&r.samplingMode!==e.Texture.LINEAR_LINEAR&&(o=1),n&&r._cachedAnisotropicFilteringLevel!==o&&(this._gl.texParameterf(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o,this._caps.maxAnisotropy)),r._cachedAnisotropicFilteringLevel=o)}},n.prototype.readPixels=function(e,t,i,r){var n=new Uint8Array(r*i*4);return this._gl.readPixels(e,t,i,r,this._gl.RGBA,this._gl.UNSIGNED_BYTE,n),n},n.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,i)},n.prototype.getExternalData=function(t){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.get(t)},n.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,i)},n.prototype.removeExternalData=function(t){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.remove(t)},n.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1}else for(var e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||(this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1)},n.prototype.releaseEffects=function(){for(var e in this._compiledEffects)this._deleteProgram(this._compiledEffects[e]._program);this._compiledEffects={}},n.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();n.audioEngine&&n.audioEngine.dispose(),this.releaseEffects(),this.unbindAllAttributes(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.disableVR(),e.Tools.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),window.removeEventListener("vrdisplaypointerrestricted",this._onVRDisplayPointerRestricted),window.removeEventListener("vrdisplaypointerunrestricted",this._onVRDisplayPointerUnrestricted),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasBlur),this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange),this._onVrDisplayConnect&&(window.removeEventListener("vrdisplayconnect",this._onVrDisplayConnect),this._onVrDisplayDisconnect&&window.removeEventListener("vrdisplaydisconnect",this._onVrDisplayDisconnect),this._onVrDisplayPresentChange&&window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._onVrDisplayConnect=null,this._onVrDisplayDisconnect=null));var t=n.Instances.indexOf(this);t>=0&&n.Instances.splice(t,1),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear(),e.Effect.ResetCache()},n.prototype.displayLoadingUI=function(){if(e.Tools.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.displayLoadingUI()}},n.prototype.hideLoadingUI=function(){if(e.Tools.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.hideLoadingUI()}},Object.defineProperty(n.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&e.DefaultLoadingScreen&&this._renderingCanvas&&(this._loadingScreen=new e.DefaultLoadingScreen(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),n.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},n.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},n.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},n.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},n.prototype.getError=function(){return this._gl.getError()},n.prototype.getFps=function(){return this._fps},n.prototype.getDeltaTime=function(){return this._deltaTime},n.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},n.prototype._readTexturePixels=function(e,t,i,r){void 0===r&&(r=-1);var n=this._gl;if(!this._dummyFramebuffer){var o=n.createFramebuffer();if(!o)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=o}n.bindFramebuffer(n.FRAMEBUFFER,this._dummyFramebuffer),r>-1?n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+r,e._webGLTexture,0):n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e._webGLTexture,0);var s,a=void 0!==e.type?this._getWebGLTextureType(e.type):n.UNSIGNED_BYTE;switch(a){case n.UNSIGNED_BYTE:s=new Uint8Array(4*t*i),a=n.UNSIGNED_BYTE;break;default:s=new Float32Array(4*t*i),a=n.FLOAT}return n.readPixels(0,0,t,i,n.RGBA,a,s),n.bindFramebuffer(n.FRAMEBUFFER,this._currentFramebuffer),s},n.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.Engine.TEXTURETYPE_FLOAT)},n.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(e.Engine.TEXTURETYPE_HALF_FLOAT)},n.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&o===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var s=t.RGBA,a=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,s,a,l),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(r),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},n.prototype._getWebGLTextureType=function(e){return e===n.TEXTURETYPE_FLOAT?this._gl.FLOAT:e===n.TEXTURETYPE_HALF_FLOAT?this._gl.HALF_FLOAT_OES:this._gl.UNSIGNED_BYTE},n.prototype._getRGBABufferInternalSizedFormat=function(e){return 1===this._webGLVersion?this._gl.RGBA:e===n.TEXTURETYPE_FLOAT?this._gl.RGBA32F:e===n.TEXTURETYPE_HALF_FLOAT?this._gl.RGBA16F:this._gl.RGBA},n.prototype.createQuery=function(){return this._gl.createQuery()},n.prototype.deleteQuery=function(e){return this._gl.deleteQuery(e),this},n.prototype.isQueryResultAvailable=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE)},n.prototype.getQueryResult=function(e){return this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)},n.prototype.beginOcclusionQuery=function(e,t){var i=this.getGlAlgorithmType(e);return this._gl.beginQuery(i,t),this},n.prototype.endOcclusionQuery=function(e){var t=this.getGlAlgorithmType(e);return this._gl.endQuery(t),this},n.prototype._createTimeQuery=function(){var e=this._caps.timerQuery;return e.createQueryEXT?e.createQueryEXT():this.createQuery()},n.prototype._deleteTimeQuery=function(e){var t=this._caps.timerQuery;if(t.deleteQueryEXT)return void t.deleteQueryEXT(e);this.deleteQuery(e)},n.prototype._getTimeQueryResult=function(e){var t=this._caps.timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_EXT):this.getQueryResult(e)},n.prototype._getTimeQueryAvailability=function(e){var t=this._caps.timerQuery;return t.getQueryObjectEXT?t.getQueryObjectEXT(e,t.QUERY_RESULT_AVAILABLE_EXT):this.isQueryResultAvailable(e)},n.prototype.startTimeQuery=function(){var t=this._caps.timerQuery;if(!t)return null;var i=new e._TimeToken;if(this._gl.getParameter(t.GPU_DISJOINT_EXT),this._caps.canUseTimestampForTimerQuery)i._startTimeQuery=this._createTimeQuery(),t.queryCounterEXT(i._startTimeQuery,t.TIMESTAMP_EXT);else{if(this._currentNonTimestampToken)return this._currentNonTimestampToken;i._timeElapsedQuery=this._createTimeQuery(),t.beginQueryEXT?t.beginQueryEXT(t.TIME_ELAPSED_EXT,i._timeElapsedQuery):this._gl.beginQuery(t.TIME_ELAPSED_EXT,i._timeElapsedQuery),this._currentNonTimestampToken=i}return i},n.prototype.endTimeQuery=function(e){var t=this._caps.timerQuery;if(!t||!e)return-1;if(this._caps.canUseTimestampForTimerQuery){if(!e._startTimeQuery)return-1;e._endTimeQuery||(e._endTimeQuery=this._createTimeQuery(),t.queryCounterEXT(e._endTimeQuery,t.TIMESTAMP_EXT))}else if(!e._timeElapsedQueryEnded){if(!e._timeElapsedQuery)return-1;t.endQueryEXT?t.endQueryEXT(t.TIME_ELAPSED_EXT):this._gl.endQuery(t.TIME_ELAPSED_EXT),e._timeElapsedQueryEnded=!0}var i=this._gl.getParameter(t.GPU_DISJOINT_EXT),r=!1;if(e._endTimeQuery?r=this._getTimeQueryAvailability(e._endTimeQuery):e._timeElapsedQuery&&(r=this._getTimeQueryAvailability(e._timeElapsedQuery)),r&&!i){var n=0;if(this._caps.canUseTimestampForTimerQuery){if(!e._startTimeQuery||!e._endTimeQuery)return-1;var o=this._getTimeQueryResult(e._startTimeQuery);n=this._getTimeQueryResult(e._endTimeQuery)-o,this._deleteTimeQuery(e._startTimeQuery),this._deleteTimeQuery(e._endTimeQuery),e._startTimeQuery=null,e._endTimeQuery=null}else{if(!e._timeElapsedQuery)return-1;n=this._getTimeQueryResult(e._timeElapsedQuery),this._deleteTimeQuery(e._timeElapsedQuery),e._timeElapsedQuery=null,e._timeElapsedQueryEnded=!1,this._currentNonTimestampToken=null}return n}return-1},n.prototype.getGlAlgorithmType=function(t){return t===e.AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE?this._gl.ANY_SAMPLES_PASSED_CONSERVATIVE:this._gl.ANY_SAMPLES_PASSED},n.prototype.createTransformFeedback=function(){return this._gl.createTransformFeedback()},n.prototype.deleteTransformFeedback=function(e){this._gl.deleteTransformFeedback(e)},n.prototype.bindTransformFeedback=function(e){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,e)},n.prototype.beginTransformFeedback=function(e){void 0===e&&(e=!0),this._gl.beginTransformFeedback(e?this._gl.POINTS:this._gl.TRIANGLES)},n.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},n.prototype.setTranformFeedbackVaryings=function(e,t){this._gl.transformFeedbackVaryings(e,t,this._gl.INTERLEAVED_ATTRIBS)},n.prototype.bindTransformFeedbackBuffer=function(e){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,e)},n.isSupported=function(){try{var e=document.createElement("canvas");return null!=(e.getContext("webgl")||e.getContext("experimental-webgl"))&&!!window.WebGLRenderingContext}catch(e){return!1}},n}();f.WebGL2UniformBuffersExceptionList=["Chrome/63"],f.Instances=new Array,f._ALPHA_DISABLE=0,f._ALPHA_ADD=1,f._ALPHA_COMBINE=2,f._ALPHA_SUBTRACT=3,f._ALPHA_MULTIPLY=4,f._ALPHA_MAXIMIZED=5,f._ALPHA_ONEONE=6,f._ALPHA_PREMULTIPLIED=7,f._ALPHA_PREMULTIPLIED_PORTERDUFF=8,f._ALPHA_INTERPOLATE=9,f._ALPHA_SCREENMODE=10,f._DELAYLOADSTATE_NONE=0,f._DELAYLOADSTATE_LOADED=1,f._DELAYLOADSTATE_LOADING=2,f._DELAYLOADSTATE_NOTLOADED=4,f._TEXTUREFORMAT_ALPHA=0,f._TEXTUREFORMAT_LUMINANCE=1,f._TEXTUREFORMAT_LUMINANCE_ALPHA=2,f._TEXTUREFORMAT_RGB=4,f._TEXTUREFORMAT_RGBA=5,f._TEXTURETYPE_UNSIGNED_INT=0,f._TEXTURETYPE_FLOAT=1,f._TEXTURETYPE_HALF_FLOAT=2,f._NEVER=512,f._ALWAYS=519,f._LESS=513,f._EQUAL=514,f._LEQUAL=515,f._GREATER=516,f._GEQUAL=518,f._NOTEQUAL=517,f._KEEP=7680,f._REPLACE=7681,f._INCR=7682,f._DECR=7683,f._INVERT=5386,f._INCR_WRAP=34055,f._DECR_WRAP=34056,f._SCALEMODE_FLOOR=1,f._SCALEMODE_NEAREST=2,f._SCALEMODE_CEILING=3,f.CollisionsEpsilon=.001,f.CodeRepository="src/",f.ShadersRepository="src/Shaders/",e.Engine=f}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){void 0===i&&(i=null),this.state="",this.metadata=null,this.doNotSerialize=!1,this.animations=new Array,this._ranges={},this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.onDisposeObservable=new e.Observable,this._behaviors=new Array,this.name=t,this.id=t,this._scene=i||e.Engine.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return Object.defineProperty(t.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){if(this._parentNode){var t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1)}this._parentNode=e,this._parentNode&&(this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"Node"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.addBehavior=function(e){var t=this;if(-1!==this._behaviors.indexOf(e))return this;if(e.init(),this._scene.isLoading)var i=this._scene.onDataLoadedObservable.add(function(){e.attach(t),setTimeout(function(){t._scene.onDataLoadedObservable.remove(i)},0)});else e.attach(this);return this._behaviors.push(e),this},t.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(t.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),t.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this.parent&&(this._parentRenderId=this.parent._currentRenderId)},t.prototype.isSynchronizedWithParent=function(){return!this.parent||this._parentRenderId===this.parent._currentRenderId&&this.parent.isSynchronized()},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent!==this.parent&&(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return!!this._isEnabled&&(!this.parent||this.parent.isEnabled())},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},t.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var r=0;r<this._children.length;r++){var n=this._children[r];i&&!i(n)||e.push(n),t||n._getDescendants(e,!1,i)}},t.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},t.prototype.getChildMeshes=function(t,i){var r=[];return this._getDescendants(r,t,function(t){return(!i||i(t))&&t instanceof e.AbstractMesh}),r},t.prototype.getChildTransformNodes=function(t,i){var r=[];return this._getDescendants(r,t,function(t){return(!i||i(t))&&t instanceof e.TransformNode}),r},t.prototype.getChildren=function(e){return this.getDescendants(!0,e)},t.prototype._setReady=function(e){if(e!==this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},t.prototype.createAnimationRange=function(t,i,r){if(!this._ranges[t]){this._ranges[t]=new e.AnimationRange(t,i,r);for(var n=0,o=this.animations.length;n<o;n++)this.animations[n]&&this.animations[n].createRange(t,i,r)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.animations.length;i<r;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},t.prototype.getAnimationRange=function(e){return this._ranges[e]},t.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);n&&this._scene.beginAnimation(this,n.from,n.to,t,i,r)},t.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[t];if(i){var r={};r.name=t,r.from=i.from,r.to=i.to,e.push(r)}}return e},t.prototype.computeWorldMatrix=function(t){return e.Matrix.Identity()},t.prototype.dispose=function(){this.parent=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var e=0,t=this._behaviors;e<t.length;e++){t[e].detach()}this._behaviors=[]},t.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var r=0;r<t.ranges.length;r++){var n=t.ranges[r];e.createAnimationRange(n.name,n.from,n.to)}},t}();n([e.serialize()],t.prototype,"name",void 0),n([e.serialize()],t.prototype,"id",void 0),n([e.serialize()],t.prototype,"uniqueId",void 0),n([e.serialize()],t.prototype,"state",void 0),n([e.serialize()],t.prototype,"metadata",void 0),e.Node=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var r=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*r,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;t<6;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,r=this.centerWorld.y-t.y,n=this.centerWorld.z-t.z,o=Math.sqrt(i*i+r*r+n*n);return!(Math.abs(this.radiusWorld-o)<e.Epsilon)},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,r=e.centerWorld.y-t.centerWorld.y,n=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+r*r+n*n);return!(e.radiusWorld+t.radiusWorld<o)},t}();e.BoundingSphere=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var r=0;r<this.vectors.length;r++)this.vectorsWorld[r]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this.centerWorld=e.Vector3.Zero(),this.extendSizeWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype.setWorldMatrix=function(e){return this._worldMatrix.copyFrom(e),this},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var r=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,r),r.x<this.minimumWorld.x&&(this.minimumWorld.x=r.x),r.y<this.minimumWorld.y&&(this.minimumWorld.y=r.y),r.z<this.minimumWorld.z&&(this.minimumWorld.z=r.z),r.x>this.maximumWorld.x&&(this.maximumWorld.x=r.x),r.y>this.maximumWorld.y&&(this.maximumWorld.y=r.y),r.z>this.maximumWorld.z&&(this.maximumWorld.z=r.z)}this.maximumWorld.subtractToRef(this.minimumWorld,this.extendSizeWorld),this.extendSizeWorld.scaleInPlace(.5),this.maximumWorld.addToRef(this.minimumWorld,this.centerWorld),this.centerWorld.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Epsilon;return!(this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x)&&(!(this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y)&&!(this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z))},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return!(this.maximumWorld.x<e.x||this.minimumWorld.x>t.x)&&(!(this.maximumWorld.y<e.y||this.minimumWorld.y>t.y)&&!(this.maximumWorld.z<e.z||this.minimumWorld.z>t.z))},t.Intersects=function(e,t){return!(e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x)&&(!(e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y)&&!(e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z))},t.IntersectsSphere=function(t,i,r,n){var o=e.Vector3.Clamp(r,t,i);return e.Vector3.DistanceSquared(r,o)<=n*n},t.IsCompletelyInFrustum=function(e,t){for(var i=0;i<6;i++)for(var r=0;r<8;r++)if(t[i].dotCoordinate(e[r])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;i<6;i++){for(var r=8,n=0;n<8&&t[i].dotCoordinate(e[n])<0;n++)--r;if(0===r)return!1}return!0},t}();e.BoundingBox=t}(r||(r={}));var r;!function(e){var t=function(t,i){var r=e.Vector3.Dot(i.centerWorld,t),n=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=n+o+s;return{min:r-a,max:r+a}},i=function(e,t,i,r){return!(e>r||i>t)},r=function(e,r,n){var o=t(e,r),s=t(e,n);return i(o.min,o.max,s.min,s.max)},n=function(){function t(t,i){this.minimum=t,this.maximum=i,this._isLocked=!1,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return Object.defineProperty(t.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},t.prototype.centerOn=function(t,i){return this.minimum=t.subtract(i),this.maximum=t.add(i),this.boundingBox=new e.BoundingBox(this.minimum,this.maximum),this.boundingSphere=new e.BoundingSphere(this.minimum,this.maximum),this},t.prototype.isInFrustum=function(e){return!!this.boundingSphere.isInFrustum(e)&&this.boundingBox.isInFrustum(e)},Object.defineProperty(t.prototype,"diagonalLength",{get:function(){var e=this.boundingBox;return e.maximumWorld.subtract(e.minimumWorld).length()},enumerable:!0,configurable:!0}),t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var n=this.boundingBox,o=t.boundingBox;return!!r(n.directions[0],n,o)&&(!!r(n.directions[1],n,o)&&(!!r(n.directions[2],n,o)&&(!!r(o.directions[0],n,o)&&(!!r(o.directions[1],n,o)&&(!!r(o.directions[2],n,o)&&(!!r(e.Vector3.Cross(n.directions[0],o.directions[0]),n,o)&&(!!r(e.Vector3.Cross(n.directions[0],o.directions[1]),n,o)&&(!!r(e.Vector3.Cross(n.directions[0],o.directions[2]),n,o)&&(!!r(e.Vector3.Cross(n.directions[1],o.directions[0]),n,o)&&(!!r(e.Vector3.Cross(n.directions[1],o.directions[1]),n,o)&&(!!r(e.Vector3.Cross(n.directions[1],o.directions[2]),n,o)&&(!!r(e.Vector3.Cross(n.directions[2],o.directions[0]),n,o)&&(!!r(e.Vector3.Cross(n.directions[2],o.directions[1]),n,o)&&!!r(e.Vector3.Cross(n.directions[2],o.directions[2]),n,o))))))))))))))},t}();e.BoundingInfo=n}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n){void 0===r&&(r=null),void 0===n&&(n=!0);var o=t.call(this,i,r)||this;return o._rotation=e.Vector3.Zero(),o._scaling=e.Vector3.One(),o._isDirty=!1,o.billboardMode=e.AbstractMesh.BILLBOARDMODE_NONE,o.scalingDeterminant=1,o.infiniteDistance=!1,o.position=e.Vector3.Zero(),o._localWorld=e.Matrix.Zero(),o._worldMatrix=e.Matrix.Zero(),o._absolutePosition=e.Vector3.Zero(),o._pivotMatrix=e.Matrix.Identity(),o._postMultiplyPivotMatrix=!1,o._isWorldMatrixFrozen=!1,o.onAfterWorldMatrixUpdateObservable=new e.Observable,o._nonUniformScaling=!1,n&&o.getScene().addTransformNode(o),o}return o(i,t),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),i.prototype.getWorldMatrix=function(){return this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},Object.defineProperty(i.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),i.prototype.updatePoseMatrix=function(e){return this._poseMatrix.copyFrom(e),this},i.prototype.getPoseMatrix=function(){return this._poseMatrix},i.prototype._isSynchronized=function(){return!this._isDirty&&(this.billboardMode===this._cache.billboardMode&&this.billboardMode===e.AbstractMesh.BILLBOARDMODE_NONE&&(!this._cache.pivotMatrixUpdated&&(!this.infiniteDistance&&(!!this._cache.position.equals(this.position)&&(!(this.rotationQuaternion&&!this._cache.rotationQuaternion.equals(this.rotationQuaternion))&&(!!this._cache.rotation.equals(this.rotation)&&!!this._cache.scaling.equals(this.scaling)))))))},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0),this._cache.billboardMode=-1},i.prototype.markAsDirty=function(e){return"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.setPivotMatrix=function(t,i){return void 0===i&&(i=!1),this._pivotMatrix=t.clone(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse=e.Matrix.Invert(t)),this},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype.freezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0,this},i.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(i.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,r,n;if(void 0===t.x){if(arguments.length<3)return this;i=arguments[0],r=arguments[1],n=arguments[2]}else i=t.x,r=t.y,n=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,r,n);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=r,this.position.z=n;return this},i.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld),this},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld),this},i.prototype.lookAt=function(t,i,r,n,o){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=e.Space.LOCAL);var s=e.AbstractMesh._lookAtVectorCache,a=o===e.Space.LOCAL?this.position:this.getAbsolutePosition();t.subtractToRef(a,s);var l=-Math.atan2(s.z,s.x)-Math.PI/2,h=Math.sqrt(s.x*s.x+s.z*s.z),c=Math.atan2(s.y,h);return this.rotationQuaternion?e.Quaternion.RotationYawPitchRollToRef(l+i,c+r,n,this.rotationQuaternion):(this.rotation.x=c+r,this.rotation.y=l+i,this.rotation.z=n),this},i.prototype.getDirection=function(t){var i=e.Vector3.Zero();return this.getDirectionToRef(t,i),i},i.prototype.getDirectionToRef=function(t,i){return e.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i),this},i.prototype.setPivotPoint=function(t,i){void 0===i&&(i=e.Space.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var r=this.getWorldMatrix();if(i==e.Space.WORLD){var n=e.Tmp.Matrix[0];r.invertToRef(n),t=e.Vector3.TransformCoordinates(t,n)}return e.Vector3.TransformCoordinatesToRef(t,r,this.position),this._pivotMatrix.m[12]=-t.x,this._pivotMatrix.m[13]=-t.y,this._pivotMatrix.m[14]=-t.z,this._cache.pivotMatrixUpdated=!0,this},i.prototype.getPivotPoint=function(){var t=e.Vector3.Zero();return this.getPivotPointToRef(t),t},i.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},i.prototype.getAbsolutePivotPoint=function(){var t=e.Vector3.Zero();return this.getAbsolutePivotPointToRef(t),t},i.prototype.getAbsolutePivotPointToRef=function(t){return t.x=this._pivotMatrix.m[12],t.y=this._pivotMatrix.m[13],t.z=this._pivotMatrix.m[14],this.getPivotPointToRef(t),e.Vector3.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},i.prototype.setParent=function(t){if(null==t){var i=e.Tmp.Quaternion[0],r=e.Tmp.Vector3[0],n=e.Tmp.Vector3[1];this.parent&&this.parent.computeWorldMatrix&&this.parent.computeWorldMatrix(!0),this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(n,i,r),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.x=n.x,this.scaling.y=n.y,this.scaling.z=n.z,this.position.x=r.x,this.position.y=r.y,this.position.z=r.z}else{var i=e.Tmp.Quaternion[0],r=e.Tmp.Vector3[0],n=e.Tmp.Vector3[1],o=e.Tmp.Matrix[0],s=e.Tmp.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(s),this.getWorldMatrix().multiplyToRef(s,o),o.decompose(n,i,r),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.position.x=r.x,this.position.y=r.y,this.position.z=r.z,this.scaling.x=n.x,this.scaling.y=n.y,this.scaling.z=n.z}return this.parent=t,this},Object.defineProperty(i.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!0,configurable:!0}),i.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=!0,!0)},i.prototype.attachToBone=function(e,t){return this._transformToBoneReferal=t,this.parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},i.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},i.prototype.rotate=function(t,i,r){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero());var n;if(r&&r!==e.Space.LOCAL){if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert(),t=e.Vector3.TransformNormal(t,o)}n=e.Quaternion.RotationAxisToRef(t,i,e.AbstractMesh._rotationAxisCache),n.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=e.Quaternion.RotationAxisToRef(t,i,e.AbstractMesh._rotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},i.prototype.rotateAround=function(t,i,r){return i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.copyFromFloats(0,0,0)),t.subtractToRef(this.position,e.Tmp.Vector3[0]),e.Matrix.TranslationToRef(e.Tmp.Vector3[0].x,e.Tmp.Vector3[0].y,e.Tmp.Vector3[0].z,e.Tmp.Matrix[0]),e.Tmp.Matrix[0].invertToRef(e.Tmp.Matrix[2]),e.Matrix.RotationAxisToRef(i,r,e.Tmp.Matrix[1]),e.Tmp.Matrix[2].multiplyToRef(e.Tmp.Matrix[1],e.Tmp.Matrix[2]),e.Tmp.Matrix[2].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[2]),e.Tmp.Matrix[2].decompose(e.Tmp.Vector3[0],e.Tmp.Quaternion[0],e.Tmp.Vector3[1]),this.position.addInPlace(e.Tmp.Vector3[1]),e.Tmp.Quaternion[0].multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},i.prototype.translate=function(t,i,r){var n=t.scale(i);if(r&&r!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(n));else{var o=this.getPositionExpressedInLocalSpace().add(n);this.setPositionWithLocalVector(o)}return this},i.prototype.addRotation=function(t,i,r){var n;this.rotationQuaternion?n=this.rotationQuaternion:(n=e.Tmp.Quaternion[1],e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,n));var o=e.Tmp.Quaternion[0];return e.Quaternion.RotationYawPitchRollToRef(i,t,r,o),n.multiplyInPlace(o),this.rotationQuaternion||n.toEulerAnglesToRef(this.rotation),this},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&this.isSynchronized(!0))return this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,e.Tmp.Matrix[1]),this.rotationQuaternion){this.rotation.length()&&(this.rotationQuaternion.multiplyInPlace(e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0))}this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(e.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation));var i=this.getScene().activeCamera;if(this.infiniteDistance&&!this.parent&&i){var r=i.getWorldMatrix(),n=new e.Vector3(r.m[12],r.m[13],r.m[14]);e.Matrix.TranslationToRef(this.position.x+n.x,this.position.y+n.y,this.position.z+n.z,e.Tmp.Matrix[2])}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,e.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(e.Tmp.Matrix[1],e.Tmp.Matrix[4]),e.Tmp.Matrix[4].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[5]),this.billboardMode!==e.AbstractMesh.BILLBOARDMODE_NONE&&i){if((this.billboardMode&e.AbstractMesh.BILLBOARDMODE_ALL)!==e.AbstractMesh.BILLBOARDMODE_ALL){var o=e.Tmp.Vector3[3];this.parent&&this.parent.getWorldMatrix?this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[6]),e.Vector3.TransformCoordinatesToRef(this.position,e.Tmp.Matrix[6],o)):e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),o):o.copyFrom(this.position),o.subtractInPlace(i.globalPosition);var s=e.Tmp.Vector3[4].copyFromFloats(0,0,0);(this.billboardMode&e.AbstractMesh.BILLBOARDMODE_X)===e.AbstractMesh.BILLBOARDMODE_X&&(s.x=Math.atan2(-o.y,o.z)),(this.billboardMode&e.AbstractMesh.BILLBOARDMODE_Y)===e.AbstractMesh.BILLBOARDMODE_Y&&(s.y=Math.atan2(o.x,o.z)),(this.billboardMode&e.AbstractMesh.BILLBOARDMODE_Z)===e.AbstractMesh.BILLBOARDMODE_Z&&(s.z=Math.atan2(o.y,o.x)),e.Matrix.RotationYawPitchRollToRef(s.y,s.x,s.z,e.Tmp.Matrix[0])}else e.Tmp.Matrix[1].copyFrom(i.getViewMatrix()),e.Tmp.Matrix[1].setTranslationFromFloats(0,0,0),e.Tmp.Matrix[1].invertToRef(e.Tmp.Matrix[0]);e.Tmp.Matrix[1].copyFrom(e.Tmp.Matrix[5]),e.Tmp.Matrix[1].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[5])}return e.Tmp.Matrix[5].multiplyToRef(e.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix?(this.billboardMode!==e.AbstractMesh.BILLBOARDMODE_NONE?(this._transformToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[6]),e.Tmp.Matrix[5].copyFrom(e.Tmp.Matrix[6])):e.Tmp.Matrix[5].copyFrom(this.parent.getWorldMatrix()),this._localWorld.getTranslationToRef(e.Tmp.Vector3[5]),e.Vector3.TransformCoordinatesToRef(e.Tmp.Vector3[5],e.Tmp.Matrix[5],e.Tmp.Vector3[5]),this._worldMatrix.copyFrom(this._localWorld),this._worldMatrix.setTranslation(e.Tmp.Vector3[5])):this._transformToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),e.Tmp.Matrix[6]),e.Tmp.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()):this._worldMatrix.copyFrom(this._localWorld),this._postMultiplyPivotMatrix&&this._worldMatrix.multiplyToRef(this._pivotMatrixInverse,this._worldMatrix),this.scaling.isNonUniform?this._updateNonUniformScalingState(!0):this.parent&&this.parent._nonUniformScaling?this._updateNonUniformScalingState(this.parent._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=e.Matrix.Invert(this._worldMatrix)),this._worldMatrix},i.prototype._afterComputeWorldMatrix=function(){},i.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},i.prototype.clone=function(t,r,n){var o=this,s=e.SerializationHelper.Clone(function(){return new i(t,o.getScene())},this);if(s.name=t,s.id=t,r&&(s.parent=r),!n)for(var a=this.getDescendants(!0),l=0;l<a.length;l++){var h=a[l];h.clone&&h.clone(t+"."+h.name,s)}return s},i.prototype.serialize=function(t){var i=e.SerializationHelper.Serialize(this,t);return i.type=this.getClassName(),this.parent&&(i.parentId=this.parent.id),e.Tags&&e.Tags.HasTags(this)&&(i.tags=e.Tags.GetTags(this)),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),this.parent&&(i.parentId=this.parent.id),i},i.Parse=function(t,r,n){var o=e.SerializationHelper.Parse(function(){return new i(t.name,r)},t,r,n);return e.Tags&&e.Tags.AddTagsTo(o,t.tags),t.localMatrix?o.setPivotMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),o.setEnabled(t.isEnabled),t.parentId&&(o._waitingParentId=t.parentId),o},i.prototype.dispose=function(e){if(this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._cache={},e){var i=this.getChildMeshes(!0);for(o=0;o<i.length;o++){var r=i[o];r.parent=null,r.computeWorldMatrix(!0)}}else for(var n=this.getDescendants(!0),o=0;o<n.length;o++)n[o].dispose();this.onAfterWorldMatrixUpdateObservable.clear(),t.prototype.dispose.call(this)},i}(e.Node);t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t._lookAtVectorCache=new e.Vector3(0,0,0),t._rotationAxisCache=new e.Quaternion,n([e.serializeAsVector3()],t.prototype,"_rotation",void 0),n([e.serializeAsQuaternion()],t.prototype,"_rotationQuaternion",void 0),n([e.serializeAsVector3()],t.prototype,"_scaling",void 0),n([e.serialize()],t.prototype,"billboardMode",void 0),n([e.serialize()],t.prototype,"scalingDeterminant",void 0),n([e.serialize()],t.prototype,"infiniteDistance",void 0),n([e.serializeAsVector3()],t.prototype,"position",void 0),e.TransformNode=t}(r||(r={}));var r;!function(e){var t=function(t){function i(r,n){void 0===n&&(n=null);var o=t.call(this,r,n,!1)||this;return o._facetNb=0,o._partitioningSubdivisions=10,o._partitioningBBoxRatio=1.01,o._facetDataEnabled=!1,o._facetParameters={},o._bbSize=e.Vector3.Zero(),o._subDiv={max:1,X:1,Y:1,Z:1},o._facetDepthSort=!1,o._facetDepthSortEnabled=!1,o.onCollideObservable=new e.Observable,o.onCollisionPositionChangeObservable=new e.Observable,o.onMaterialChangedObservable=new e.Observable,o.definedFacingForward=!0,o.occlusionQueryAlgorithmType=i.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE,o.occlusionType=i.OCCLUSION_TYPE_NONE,o.occlusionRetryCount=-1,o._occlusionInternalRetryCounter=0,o._isOccluded=!1,o._isOcclusionQueryInProgress=!1,o.visibility=1,o.alphaIndex=Number.MAX_VALUE,o.isVisible=!0,o.isPickable=!0,o.showBoundingBox=!1,o.showSubMeshesBoundingBox=!1,o.isBlocker=!1,o.enablePointerMoveEvents=!1,o.renderingGroupId=0,o._receiveShadows=!1,o.renderOutline=!1,o.outlineColor=e.Color3.Red(),o.outlineWidth=.02,o.renderOverlay=!1,o.overlayColor=e.Color3.Red(),o.overlayAlpha=.5,o._hasVertexAlpha=!1,o._useVertexColors=!0,o._computeBonesUsingShaders=!0,o._numBoneInfluencers=4,o._applyFog=!0,o.useOctreeForRenderingSelection=!0,o.useOctreeForPicking=!0,o.useOctreeForCollisions=!0,o._layerMask=268435455,o.alwaysSelectAsActiveMesh=!1,o._checkCollisions=!1,o._collisionMask=-1,o._collisionGroup=-1,o.ellipsoid=new e.Vector3(.5,1,.5),o.ellipsoidOffset=new e.Vector3(0,0,0),o._oldPositionForCollisions=new e.Vector3(0,0,0),o._diffPositionForCollisions=new e.Vector3(0,0,0),o.edgesWidth=1,o.edgesColor=new e.Color4(1,0,0,1),o._collisionsTransformMatrix=e.Matrix.Zero(),o._collisionsScalingMatrix=e.Matrix.Zero(),o._isDisposed=!1,o._renderId=0,o._intersectionsInProgress=new Array,o._unIndexed=!1,o._lightSources=new Array,o._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider._radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions),r&&o.onCollideObservable.notifyObservers(r),o.onCollisionPositionChangeObservable.notifyObservers(o.position)},o.getScene().addMesh(o),o._resyncLightSources(),o}return o(i,t),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return e.TransformNode.BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return e.TransformNode.BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return e.TransformNode.BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return e.TransformNode.BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return e.TransformNode.BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"facetNb",{get:function(){return this._facetNb},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"partitioningSubdivisions",{get:function(){return this._partitioningSubdivisions},set:function(e){this._partitioningSubdivisions=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"partitioningBBoxRatio",{get:function(){return this._partitioningBBoxRatio},set:function(e){this._partitioningBBoxRatio=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mustDepthSortFacets",{get:function(){return this._facetDepthSort},set:function(e){this._facetDepthSort=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"facetDepthSortFrom",{get:function(){return this._facetDepthSortFrom},set:function(e){this._facetDepthSortFrom=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isFacetDataEnabled",{get:function(){return this._facetDataEnabled},enumerable:!0,configurable:!0}),i.prototype._updateNonUniformScalingState=function(e){return!!t.prototype._updateNonUniformScalingState.call(this,e)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(i.prototype,"onCollide",{set:function(e){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onCollisionPositionChange",{set:function(e){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isOccluded",{get:function(){return this._isOccluded},set:function(e){this._isOccluded=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isOcclusionQueryInProgress",{get:function(){return this._isOcclusionQueryInProgress},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._material},set:function(e){if(this._material!==e&&(this._material=e,this.onMaterialChangedObservable.hasObservers&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes))for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[t];r.setEffect(null)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(e){this._receiveShadows!==e&&(this._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasVertexAlpha",{get:function(){return this._hasVertexAlpha},set:function(e){this._hasVertexAlpha!==e&&(this._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useVertexColors",{get:function(){return this._useVertexColors},set:function(e){this._useVertexColors!==e&&(this._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"computeBonesUsingShaders",{get:function(){return this._computeBonesUsingShaders},set:function(e){this._computeBonesUsingShaders!==e&&(this._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"numBoneInfluencers",{get:function(){return this._numBoneInfluencers},set:function(e){this._numBoneInfluencers!==e&&(this._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"applyFog",{get:function(){return this._applyFog},set:function(e){this._applyFog!==e&&(this._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerMask",{get:function(){return this._layerMask},set:function(e){e!==this._layerMask&&(this._layerMask=e,this._resyncLightSources())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroup",{get:function(){return this._collisionGroup},set:function(e){this._collisionGroup=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_positions",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},set:function(e){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._skeleton=e,this._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!0,configurable:!0}),i.prototype.isDisposed=function(){return this._isDisposed},i.prototype.getClassName=function(){return"AbstractMesh"},i.prototype.toString=function(t){var i="Name: "+this.name+", isInstance: "+(this instanceof e.InstancedMesh?"YES":"NO");return i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(i+=", skeleton: "+this._skeleton.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),i},i.prototype._rebuild=function(){if(this._occlusionQuery&&(this._occlusionQuery=null),this._edgesRenderer&&this._edgesRenderer._rebuild(),this.subMeshes)for(var e=0,t=this.subMeshes;e<t.length;e++){var i=t[e];i._rebuild()}},i.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,t=this.getScene().lights;e<t.length;e++){var i=t[e];i.isEnabled()&&(i.canAffectMesh(this)&&this._lightSources.push(i))}this._markSubMeshesAsLightDirty()},i.prototype._resyncLighSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),i=this._lightSources.indexOf(e);if(-1===i){if(!t)return;this._lightSources.push(e)}else{if(t)return;this._lightSources.splice(i,1)}this._markSubMeshesAsLightDirty()},i.prototype._removeLightSource=function(e){var t=this._lightSources.indexOf(e);-1!==t&&this._lightSources.splice(t,1)},i.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[t];r._materialDefines&&e(r._materialDefines)}},i.prototype._markSubMeshesAsLightDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsLightDirty()})},i.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},i.prototype._markSubMeshesAsMiscDirty=function(){if(this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var r=i[t],n=r.getMaterial();n&&n.markAsDirty(e.Material.MiscDirtyFlag)}},Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),i.prototype.disableEdgesRendering=function(){return this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this},i.prototype.enableEdgesRendering=function(t,i){return void 0===t&&(t=.95),void 0===i&&(i=!1),this.disableEdgesRendering(),this._edgesRenderer=new e.EdgesRenderer(this,t,i),this},Object.defineProperty(i.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.setVerticesData=function(e,t,i,r){return this},i.prototype.updateVerticesData=function(e,t,i,r){return this},i.prototype.setIndices=function(e,t){return this},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},i.prototype.normalizeToUnitCube=function(e){void 0===e&&(e=!0);var t=this.getHierarchyBoundingVectors(e),i=t.max.subtract(t.min),r=Math.max(i.x,i.y,i.z);if(0===r)return this;var n=1/r;return this.scaling.scaleInPlace(n),this},i.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(i.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._preActivateForIntermediateRendering=function(e){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():t.prototype.getWorldMatrix.call(this)},i.prototype.movePOV=function(e,t,i){return this.position.addInPlace(this.calcMovePOV(e,t,i)),this},i.prototype.calcMovePOV=function(t,i,r){var n=new e.Matrix;(this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(n);var o=e.Vector3.Zero(),s=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*s,i,r*s,n,o),o},i.prototype.rotatePOV=function(e,t,i){return this.rotation.addInPlace(this.calcRotatePOV(e,t,i)),this},i.prototype.calcRotatePOV=function(t,i,r){var n=this.definedFacingForward?1:-1;return new e.Vector3(t*n,i,r*n)},i.prototype.getHierarchyBoundingVectors=function(t){void 0===t&&(t=!0),this.computeWorldMatrix(!0);var i,r,n=this.getBoundingInfo();if(this.subMeshes?(i=n.boundingBox.minimumWorld,r=n.boundingBox.maximumWorld):(i=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)),t)for(var o=this.getDescendants(!1),s=0,a=o;s<a.length;s++){var l=a[s],h=l;h.computeWorldMatrix(!0);var c=h.getBoundingInfo();if(0!==h.getTotalVertices()){var u=c.boundingBox,f=u.minimumWorld,d=u.maximumWorld;e.Tools.CheckExtends(f,i,r),e.Tools.CheckExtends(d,i,r)}}return{min:i,max:r}},i.prototype._updateBoundingInfo=function(){return this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},i.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.IsGlobal||i.updateBoundingInfo(e)}return this},i.prototype._afterComputeWorldMatrix=function(){this._updateBoundingInfo()},i.prototype.isInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(e){return null!==this._boundingInfo&&this._boundingInfo.isCompletelyInFrustum(e)},i.prototype.intersectsMesh=function(e,t,i){if(void 0===t&&(t=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,t))return!0;if(i)for(var r=0,n=this.getChildMeshes();r<n.length;r++){var o=n[r];if(o.intersectsMesh(e,t,!0))return!0}return!1},i.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},i.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},i.prototype.getPositionInCameraSpace=function(t){return void 0===t&&(t=null),t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(e,t),this):this},i.prototype.setPhysicsLinkWith=function(t,i,r,n){return this.physicsImpostor&&t.physicsImpostor?(this.physicsImpostor.createJoint(t.physicsImpostor,e.PhysicsJoint.HingeJoint,{mainPivot:i,connectedPivot:r,nativeParams:n}),this):this},Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collider",{get:function(){return this._collider},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(t){return this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._oldPositionForCollisions),this._collider||(this._collider=new e.Collider),this._collider._radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,t,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var r=this.getBoundingInfo(),n=r.boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,r){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var n=t.verticesStart,o=t.verticesStart+t.verticesCount,s=n;s<o;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}return r._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),r.collisionFound&&(r.collidedMesh=this),this},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,r;if(this._submeshesOctree&&this.useOctreeForCollisions){var n=e._velocityWorldLength+Math.max(e._radius.x,e._radius.y,e._radius.z),o=this._submeshesOctree.intersects(e._basePointWorld,n);r=o.length,i=o.data}else i=this.subMeshes,r=i.length;for(var s=0;s<r;s++){var a=i[s];r>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}return this},i.prototype._checkCollision=function(t){return this._boundingInfo&&this._boundingInfo._checkCollision(t)?(e.Matrix.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix),this):this},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var r=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return r;if(!this._generatePointsArray())return r;var n,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),l=this._submeshesOctree.intersectsRay(a);o=l.length,n=l.data}else n=this.subMeshes,o=n.length;for(var h=0;h<o;h++){var c=n[h];if(!(o>1)||c.canIntersects(t)){var u=c.intersects(t,this._positions,this.getIndices(),i);if(u&&(i||!s||u.distance<s.distance)&&(s=u,s.subMeshId=h,i))break}}if(s){var f=this.getWorldMatrix(),d=e.Vector3.TransformCoordinates(t.origin,f),p=t.direction.clone();p=p.scale(s.distance);var m=e.Vector3.TransformNormal(p,f),g=d.add(m);return r.hit=!0,r.distance=e.Vector3.Distance(d,g),r.pickedPoint=g,r.pickedMesh=this,r.bu=s.bu||0,r.bv=s.bv||0,r.faceId=s.faceId,r.subMeshId=s.subMeshId,r}return r},i.prototype.clone=function(e,t,i){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},i.prototype.dispose=function(e,i){var r=this;void 0===i&&(i=!1);var n;for(this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this.skeleton=null,this.physicsImpostor&&this.physicsImpostor.dispose(),n=0;n<this._intersectionsInProgress.length;n++){var o=this._intersectionsInProgress[n],s=o._intersectionsInProgress.indexOf(this);o._intersectionsInProgress.splice(s,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(r);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(r))&&e.excludedMeshes.splice(t,1);var i=e.getShadowGenerator();if(i){var n=i.getShadowMap();n&&n.renderList&&-1!==(t=n.renderList.indexOf(r))&&n.renderList.splice(t,1)}}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),"InstancedMesh"!==this.getClassName()&&this.releaseSubMeshes();var a=this.getScene().selectionOctree;if(a){var n=a.dynamicContent.indexOf(this);-1!==n&&a.dynamicContent.splice(n,1)}var l=this.getScene().getEngine();if(this._occlusionQuery&&(this._isOcclusionQueryInProgress=!1,l.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),l.wipeCaches(),this.getScene().removeMesh(this),i&&this.material&&this.material.dispose(!1,!0),!e)for(n=0;n<this.getScene().particleSystems.length;n++)this.getScene().particleSystems[n].emitter===this&&(this.getScene().particleSystems[n].dispose(),n--);this._facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this._isDisposed=!0,t.prototype.dispose.call(this,e)},i.prototype.addChild=function(e){return e.setParent(this),this},i.prototype.removeChild=function(e){return e.setParent(null),this},i.prototype._initFacetData=function(){this._facetNormals||(this._facetNormals=new Array),this._facetPositions||(this._facetPositions=new Array),this._facetPartitioning||(this._facetPartitioning=new Array),this._facetNb=this.getIndices().length/3|0,this._partitioningSubdivisions=this._partitioningSubdivisions?this._partitioningSubdivisions:10,this._partitioningBBoxRatio=this._partitioningBBoxRatio?this._partitioningBBoxRatio:1.01;for(var t=0;t<this._facetNb;t++)this._facetNormals[t]=e.Vector3.Zero(),this._facetPositions[t]=e.Vector3.Zero();return this._facetDataEnabled=!0,this},i.prototype.updateFacetData=function(){this._facetDataEnabled||this._initFacetData();var t=this.getVerticesData(e.VertexBuffer.PositionKind),i=this.getIndices(),r=this.getVerticesData(e.VertexBuffer.NormalKind),n=this.getBoundingInfo();if(this._facetDepthSort&&!this._facetDepthSortEnabled){if(this._facetDepthSortEnabled=!0,i instanceof Uint16Array)this._depthSortedIndices=new Uint16Array(i);else if(i instanceof Uint32Array)this._depthSortedIndices=new Uint32Array(i);else{for(var o=!1,s=0;s<i.length;s++)if(i[s]>65535){o=!0;break}this._depthSortedIndices=o?new Uint32Array(i):new Uint16Array(i)}if(this._facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!this._facetDepthSortFrom){var a=this.getScene().activeCamera;this._facetDepthSortFrom=a?a.position:e.Vector3.Zero()}this._depthSortedFacets=[];for(var l=0;l<this._facetNb;l++){var h={ind:3*l,sqDistance:0};this._depthSortedFacets.push(h)}this._invertedMatrix=e.Matrix.Identity(),this._facetDepthSortOrigin=e.Vector3.Zero()}this._bbSize.x=n.maximum.x-n.minimum.x>e.Epsilon?n.maximum.x-n.minimum.x:e.Epsilon,this._bbSize.y=n.maximum.y-n.minimum.y>e.Epsilon?n.maximum.y-n.minimum.y:e.Epsilon,this._bbSize.z=n.maximum.z-n.minimum.z>e.Epsilon?n.maximum.z-n.minimum.z:e.Epsilon;var c=this._bbSize.x>this._bbSize.y?this._bbSize.x:this._bbSize.y;if(c=c>this._bbSize.z?c:this._bbSize.z,this._subDiv.max=this._partitioningSubdivisions,this._subDiv.X=Math.floor(this._subDiv.max*this._bbSize.x/c),this._subDiv.Y=Math.floor(this._subDiv.max*this._bbSize.y/c),this._subDiv.Z=Math.floor(this._subDiv.max*this._bbSize.z/c),this._subDiv.X=this._subDiv.X<1?1:this._subDiv.X,this._subDiv.Y=this._subDiv.Y<1?1:this._subDiv.Y,this._subDiv.Z=this._subDiv.Z<1?1:this._subDiv.Z,this._facetParameters.facetNormals=this.getFacetLocalNormals(),this._facetParameters.facetPositions=this.getFacetLocalPositions(),this._facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),this._facetParameters.bInfo=n,this._facetParameters.bbSize=this._bbSize,this._facetParameters.subDiv=this._subDiv,this._facetParameters.ratio=this.partitioningBBoxRatio,this._facetParameters.depthSort=this._facetDepthSort,this._facetDepthSort&&this._facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(this._invertedMatrix),e.Vector3.TransformCoordinatesToRef(this._facetDepthSortFrom,this._invertedMatrix,this._facetDepthSortOrigin),this._facetParameters.distanceTo=this._facetDepthSortOrigin),this._facetParameters.depthSortedFacets=this._depthSortedFacets,e.VertexData.ComputeNormals(t,i,r,this._facetParameters),this._facetDepthSort&&this._facetDepthSortEnabled){this._depthSortedFacets.sort(this._facetDepthSortFunction);for(var u=this._depthSortedIndices.length/3|0,l=0;l<u;l++){var f=this._depthSortedFacets[l].ind;this._depthSortedIndices[3*l]=i[f],this._depthSortedIndices[3*l+1]=i[f+1],this._depthSortedIndices[3*l+2]=i[f+2]}this.updateIndices(this._depthSortedIndices)}return this},i.prototype.getFacetLocalNormals=function(){return this._facetNormals||this.updateFacetData(),this._facetNormals},i.prototype.getFacetLocalPositions=function(){return this._facetPositions||this.updateFacetData(),this._facetPositions},i.prototype.getFacetLocalPartitioning=function(){return this._facetPartitioning||this.updateFacetData(),this._facetPartitioning},i.prototype.getFacetPosition=function(t){var i=e.Vector3.Zero();return this.getFacetPositionToRef(t,i),i},i.prototype.getFacetPositionToRef=function(t,i){var r=this.getFacetLocalPositions()[t],n=this.getWorldMatrix();return e.Vector3.TransformCoordinatesToRef(r,n,i),this},i.prototype.getFacetNormal=function(t){var i=e.Vector3.Zero();return this.getFacetNormalToRef(t,i),i},i.prototype.getFacetNormalToRef=function(t,i){var r=this.getFacetLocalNormals()[t];return e.Vector3.TransformNormalToRef(r,this.getWorldMatrix(),i),this},i.prototype.getFacetsAtLocalCoordinates=function(e,t,i){var r=this.getBoundingInfo(),n=Math.floor((e-r.minimum.x*this._partitioningBBoxRatio)*this._subDiv.X*this._partitioningBBoxRatio/this._bbSize.x),o=Math.floor((t-r.minimum.y*this._partitioningBBoxRatio)*this._subDiv.Y*this._partitioningBBoxRatio/this._bbSize.y),s=Math.floor((i-r.minimum.z*this._partitioningBBoxRatio)*this._subDiv.Z*this._partitioningBBoxRatio/this._bbSize.z);return n<0||n>this._subDiv.max||o<0||o>this._subDiv.max||s<0||s>this._subDiv.max?null:this._facetPartitioning[n+this._subDiv.max*o+this._subDiv.max*this._subDiv.max*s]},i.prototype.getClosestFacetAtCoordinates=function(t,i,r,n,o,s){void 0===o&&(o=!1),void 0===s&&(s=!0);var a=this.getWorldMatrix(),l=e.Tmp.Matrix[5];a.invertToRef(l);var h=e.Tmp.Vector3[8];e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,r,l,h);var c=this.getClosestFacetAtLocalCoordinates(h.x,h.y,h.z,n,o,s);return n&&e.Vector3.TransformCoordinatesFromFloatsToRef(n.x,n.y,n.z,a,n),c},i.prototype.getClosestFacetAtLocalCoordinates=function(e,t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0);var s=null,a=0,l=0,h=0,c=0,u=0,f=0,d=0,p=0,m=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),v=this.getFacetsAtLocalCoordinates(e,t,i);if(!v)return null;for(var y,_,b,x=Number.MAX_VALUE,T=x,E=0;E<v.length;E++)y=v[E],_=g[y],b=m[y],c=(e-b.x)*_.x+(t-b.y)*_.y+(i-b.z)*_.z,(!n||n&&o&&c>=0||n&&!o&&c<=0)&&(c=_.x*b.x+_.y*b.y+_.z*b.z,u=-(_.x*e+_.y*t+_.z*i-c)/(_.x*_.x+_.y*_.y+_.z*_.z),f=e+_.x*u,d=t+_.y*u,p=i+_.z*u,a=f-e,l=d-t,h=p-i,(T=a*a+l*l+h*h)<x&&(x=T,s=y,r&&(r.x=f,r.y=d,r.z=p)));return s},i.prototype.getFacetDataParameters=function(){return this._facetParameters},i.prototype.disableFacetData=function(){return this._facetDataEnabled&&(this._facetDataEnabled=!1,this._facetPositions=new Array,this._facetNormals=new Array,this._facetPartitioning=new Array,this._facetParameters=null,this._depthSortedIndices=new Uint32Array(0)),this},i.prototype.updateIndices=function(e){return this},i.prototype.createNormals=function(t){var i,r=this.getVerticesData(e.VertexBuffer.PositionKind),n=this.getIndices();i=this.isVerticesDataPresent(e.VertexBuffer.NormalKind)?this.getVerticesData(e.VertexBuffer.NormalKind):[],e.VertexData.ComputeNormals(r,n,i,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(e.VertexBuffer.NormalKind,i,t)},i.prototype.alignWithNormal=function(t,i){i||(i=e.Axis.Y);var r=e.Tmp.Vector3[0],n=e.Tmp.Vector3[1];return e.Vector3.CrossToRef(i,t,n),e.Vector3.CrossToRef(t,n,r),this.rotationQuaternion?e.Quaternion.RotationQuaternionFromAxisToRef(r,t,n,this.rotationQuaternion):e.Vector3.RotationFromAxisToRef(r,t,n,this.rotation),this},i.prototype.checkOcclusionQuery=function(){var e=this.getEngine();if(e.webGLVersion<2||this.occlusionType===i.OCCLUSION_TYPE_NONE)return void(this._isOccluded=!1);if(this.isOcclusionQueryInProgress&&this._occlusionQuery){if(e.isQueryResultAvailable(this._occlusionQuery)){var t=e.getQueryResult(this._occlusionQuery);this._isOcclusionQueryInProgress=!1,this._occlusionInternalRetryCounter=0,this._isOccluded=1!==t}else{if(this._occlusionInternalRetryCounter++,!(-1!==this.occlusionRetryCount&&this._occlusionInternalRetryCounter>this.occlusionRetryCount))return;this._isOcclusionQueryInProgress=!1,this._occlusionInternalRetryCounter=0,this._isOccluded=this.occlusionType!==i.OCCLUSION_TYPE_OPTIMISTIC&&this._isOccluded}}var r=this.getScene(),n=r.getBoundingBoxRenderer();this._occlusionQuery||(this._occlusionQuery=e.createQuery()),e.beginOcclusionQuery(this.occlusionQueryAlgorithmType,this._occlusionQuery),n.renderOcclusionBoundingBox(this),e.endOcclusionQuery(this.occlusionQueryAlgorithmType),this._isOcclusionQueryInProgress=!0},i}(e.TransformNode);t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.AbstractMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function i(r,n){var o=t.call(this,r,n)||this;return o.diffuse=new e.Color3(1,1,1),o.specular=new e.Color3(1,1,1),o.intensity=1,o.range=Number.MAX_VALUE,o._photometricScale=1,o._intensityMode=i.INTENSITYMODE_AUTOMATIC,o._radius=1e-5,o.renderPriority=0,o.shadowEnabled=!0,o._excludeWithLayerMask=0,o._includeOnlyWithLayerMask=0,o._lightmapMode=0,o._excludedMeshesIds=new Array,o._includedOnlyMeshesIds=new Array,o.getScene().addLight(o),o._uniformBuffer=new e.UniformBuffer(o.getScene().getEngine()),o._buildUniformLayout(),o.includedOnlyMeshes=new Array,o.excludedMeshes=new Array,o._resyncMeshes(),o}return o(i,t),Object.defineProperty(i,"LIGHTMAP_DEFAULT",{get:function(){return i._LIGHTMAP_DEFAULT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTMAP_SPECULAR",{get:function(){return i._LIGHTMAP_SPECULAR},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTMAP_SHADOWSONLY",{get:function(){return i._LIGHTMAP_SHADOWSONLY},enumerable:!0,configurable:!0}),Object.defineProperty(i,"INTENSITYMODE_AUTOMATIC",{get:function(){return i._INTENSITYMODE_AUTOMATIC},enumerable:!0,configurable:!0}),Object.defineProperty(i,"INTENSITYMODE_LUMINOUSPOWER",{get:function(){return i._INTENSITYMODE_LUMINOUSPOWER},enumerable:!0,configurable:!0}),Object.defineProperty(i,"INTENSITYMODE_LUMINOUSINTENSITY",{get:function(){return i._INTENSITYMODE_LUMINOUSINTENSITY},enumerable:!0,configurable:!0}),Object.defineProperty(i,"INTENSITYMODE_ILLUMINANCE",{get:function(){return i._INTENSITYMODE_ILLUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"INTENSITYMODE_LUMINANCE",{get:function(){return i._INTENSITYMODE_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTTYPEID_POINTLIGHT",{get:function(){return i._LIGHTTYPEID_POINTLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTTYPEID_DIRECTIONALLIGHT",{get:function(){return i._LIGHTTYPEID_DIRECTIONALLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTTYPEID_SPOTLIGHT",{get:function(){return i._LIGHTTYPEID_SPOTLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LIGHTTYPEID_HEMISPHERICLIGHT",{get:function(){return i._LIGHTTYPEID_HEMISPHERICLIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),i.prototype._buildUniformLayout=function(){},i.prototype.getClassName=function(){return"Light"},i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},i.prototype.setEnabled=function(e){t.prototype.setEnabled.call(this,e),this._resyncMeshes()},i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},i.prototype.transferToEffect=function(e,t){},i.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},i.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!=(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):t},i.compareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var e=0,i=this.getScene().meshes;e<i.length;e++){i[e]._removeLightSource(this)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),t.prototype.dispose.call(this)},i.prototype.getTypeID=function(){return 0},i.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},i.prototype.clone=function(t){var r=i.GetConstructorFromName(this.getTypeID(),t,this.getScene());return r?e.SerializationHelper.Clone(r,this):null},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(function(e){t.excludedMeshesIds.push(e.id)})),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(e){t.includedOnlyMeshesIds.push(e.id)})),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.GetConstructorFromName=function(t,i,r){switch(t){case 0:return function(){return new e.PointLight(i,e.Vector3.Zero(),r)};case 1:return function(){return new e.DirectionalLight(i,e.Vector3.Zero(),r)};case 2:return function(){return new e.SpotLight(i,e.Vector3.Zero(),e.Vector3.Zero(),0,0,r)};case 3:return function(){return new e.HemisphericLight(i,e.Vector3.Zero(),r)}}return null},i.Parse=function(t,r){var n=i.GetConstructorFromName(t.type,t.name,r);if(!n)return null;var o=e.SerializationHelper.Parse(n,t,r);if(t.excludedMeshesIds&&(o._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.parentId&&(o._waitingParentId=t.parentId),t.animations){for(var s=0;s<t.animations.length;s++){var a=t.animations[s];o.animations.push(e.Animation.Parse(a))}e.Node.ParseAnimationRanges(o,t,r)}return t.autoAnimate&&r.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),o},i.prototype._hookArrayForExcluded=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];for(var o=i.apply(e,r),s=0,a=r;s<a.length;s++){a[s]._resyncLighSource(t)}return o};var r=e.splice;e.splice=function(i,n){for(var o=r.apply(e,[i,n]),s=0,a=o;s<a.length;s++){a[s]._resyncLighSource(t)}return o};for(var n=0,o=e;n<o.length;n++){o[n]._resyncLighSource(this)}},i.prototype._hookArrayForIncludedOnly=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=i.apply(e,r);return t._resyncMeshes(),o};var r=e.splice;e.splice=function(i,n){var o=r.apply(e,[i,n]);return t._resyncMeshes(),o},this._resyncMeshes()},i.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLighSource(this)}},i.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var i=t[e];-1!==i._lightSources.indexOf(this)&&i._markSubMeshesAsLightDirty()}},i.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},i.prototype._getPhotometricScale=function(){var e=0,t=this.getTypeID(),r=this.intensityMode;switch(r===i.INTENSITYMODE_AUTOMATIC&&(r=t===i.LIGHTTYPEID_DIRECTIONALLIGHT?i.INTENSITYMODE_ILLUMINANCE:i.INTENSITYMODE_LUMINOUSINTENSITY),t){case i.LIGHTTYPEID_POINTLIGHT:case i.LIGHTTYPEID_SPOTLIGHT:switch(r){case i.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case i.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case i.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case i.LIGHTTYPEID_DIRECTIONALLIGHT:switch(r){case i.INTENSITYMODE_ILLUMINANCE:e=1;break;case i.INTENSITYMODE_LUMINANCE:var n=this.radius;n=Math.max(n,.001);e=2*Math.PI*(1-Math.cos(n))}break;case i.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},i.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},i}(e.Node);t._LIGHTMAP_DEFAULT=0,t._LIGHTMAP_SPECULAR=1,t._LIGHTMAP_SHADOWSONLY=2,t._INTENSITYMODE_AUTOMATIC=0,t._INTENSITYMODE_LUMINOUSPOWER=1,t._INTENSITYMODE_LUMINOUSINTENSITY=2,t._INTENSITYMODE_ILLUMINANCE=3,t._INTENSITYMODE_LUMINANCE=4,t._LIGHTTYPEID_POINTLIGHT=0,t._LIGHTTYPEID_DIRECTIONALLIGHT=1,t._LIGHTTYPEID_SPOTLIGHT=2,t._LIGHTTYPEID_HEMISPHERICLIGHT=3,n([e.serializeAsColor3()],t.prototype,"diffuse",void 0),n([e.serializeAsColor3()],t.prototype,"specular",void 0),n([e.serialize()],t.prototype,"intensity",void 0),n([e.serialize()],t.prototype,"range",void 0),n([e.serialize()],t.prototype,"intensityMode",null),n([e.serialize()],t.prototype,"radius",null),n([e.serialize()],t.prototype,"_renderPriority",void 0),n([e.expandToProperty("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),n([e.serialize()],t.prototype,"shadowEnabled",void 0),n([e.serialize("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),n([e.serialize("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),n([e.serialize("lightmapMode")],t.prototype,"_lightmapMode",void 0),e.Light=t}(r||(r={}));var r;!function(e){var t=function(t){function i(r,n,o){var s=t.call(this,r,o)||this;return s.upVector=e.Vector3.Up(),s.orthoLeft=null,s.orthoRight=null,s.orthoBottom=null,s.orthoTop=null,s.fov=.8,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s.mode=i.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new e.Viewport(0,0,1,1),s.layerMask=268435455,s.fovMode=i.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=i.RIG_MODE_NONE,s._rigCameras=new Array,s._webvrViewMatrix=e.Matrix.Identity(),s._skipRendering=!1,s.customRenderTargets=new Array,s.onViewMatrixChangedObservable=new e.Observable,s.onProjectionMatrixChangedObservable=new e.Observable,s.onAfterCheckInputsObservable=new e.Observable,s.onRestoreStateObservable=new e.Observable,s._computedViewMatrix=e.Matrix.Identity(),s._projectionMatrix=new e.Matrix,s._doNotComputeProjectionMatrix=!1,s._postProcesses=new Array,s._transformMatrix=e.Matrix.Zero(),s._activeMeshes=new e.SmartArray(256),s._globalPosition=e.Vector3.Zero(),s._refreshFrustumPlanes=!0,s.getScene().addCamera(s),s.getScene().activeCamera||(s.getScene().activeCamera=s),s.position=n,s}return o(i,t),Object.defineProperty(i,"PERSPECTIVE_CAMERA",{get:function(){return i._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ORTHOGRAPHIC_CAMERA",{get:function(){return i._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_VERTICAL_FIXED",{get:function(){return i._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return i._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_NONE",{get:function(){return i._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return i._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return i._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_VR",{get:function(){return i._RIG_MODE_VR},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_WEBVR",{get:function(){return i._RIG_MODE_WEBVR},enumerable:!0,configurable:!0}),i.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},i.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},i.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},i.prototype.getClassName=function(){return"Camera"},i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},i.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===i.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},i.prototype.attachControl=function(e,t){},i.prototype.detachControl=function(e){},i.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==i.RIG_MODE_NONE&&this._updateRigCameras()},i.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(i.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!0,configurable:!0}),i.prototype._cascadePostProcessesToRigCams=function(){this._postProcesses.length>0&&this._postProcesses[0].markTextureDirty();for(var t=0,i=this._rigCameras.length;t<i;t++){var r=this._rigCameras[t],n=r._rigPostProcess;if(n){n instanceof e.PassPostProcess&&(r.isIntermediate=0===this._postProcesses.length),r._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty()}else r._postProcesses=this._postProcesses.slice(0)}},i.prototype.attachPostProcess=function(t,i){return void 0===i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(e.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==i||i<0?this._postProcesses.push(t):this._postProcesses.splice(i,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},i.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&this._postProcesses.splice(t,1),this._cascadePostProcessesToRigCams()},i.prototype.getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this.getViewMatrix().invertToRef(this._worldMatrix),this._worldMatrix},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._refreshFrustumPlanes=!0,this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix)},i.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},i.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},i.prototype.getProjectionMatrix=function(t){if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var r=this.getEngine(),n=this.getScene();if(this.mode===i.PERSPECTIVE_CAMERA)this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=r.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1),n.useRightHandedSystem?e.Matrix.PerspectiveFovRHToRef(this.fov,r.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED):e.Matrix.PerspectiveFovLHToRef(this.fov,r.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED);else{var o=r.getRenderWidth()/2,s=r.getRenderHeight()/2;n.useRightHandedSystem?e.Matrix.OrthoOffCenterRHToRef(this.orthoLeft||-o,this.orthoRight||o,this.orthoBottom||-s,this.orthoTop||s,this.minZ,this.maxZ,this._projectionMatrix):e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-o,this.orthoRight||o,this.orthoBottom||-s,this.orthoTop||s,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=r.getRenderWidth(),this._cache.renderHeight=r.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},i.prototype.getTranformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},i.prototype.updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTranformationMatrix(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},i.prototype.isInFrustum=function(e){return this.updateFrustumPlanes(),e.isInFrustum(this._frustumPlanes)},i.prototype.isCompletelyInFrustum=function(e){return this.updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},i.prototype.getForwardRay=function(t,i,r){void 0===t&&(t=100),i||(i=this.getWorldMatrix()),r||(r=this.position);var n=new e.Vector3(0,0,1),o=e.Vector3.TransformNormal(n,i),s=e.Vector3.Normalize(o);return new e.Ray(r,s,t)},i.prototype.dispose=function(){for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var e=this._rigCameras.pop();e&&e.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==i.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var r=this._postProcesses.length;--r>=0;)this._postProcesses[r].dispose(this);for(var r=this.customRenderTargets.length;--r>=0;)this.customRenderTargets[r].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),t.prototype.dispose.call(this)},Object.defineProperty(i.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!0,configurable:!0}),i.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},i.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},i.prototype.setCameraRigMode=function(t,r){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=r.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==i.RIG_MODE_NONE){var o=this.createRigCamera(this.name+"_L",0),s=this.createRigCamera(this.name+"_R",1);o&&s&&(this._rigCameras.push(o),this._rigCameras.push(s))}switch(this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new e.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:var a=this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new e.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,a);break;case i.RIG_MODE_VR:var l=r.vrCameraMetrics||e.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=l,this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=l.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=l.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=l,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=l.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=l.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,l.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,l),this._rigCameras[1]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,l));break;case i.RIG_MODE_WEBVR:if(r.vrDisplay){var h=r.vrDisplay.getEyeParameters("left"),c=r.vrDisplay.getEyeParameters("right");this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0].setCameraRigParameter("left",!0),this._rigCameras[0].setCameraRigParameter("specs",r.specs),this._rigCameras[0].setCameraRigParameter("eyeParameters",h),this._rigCameras[0].setCameraRigParameter("frameData",r.frameData),this._rigCameras[0].setCameraRigParameter("parentCamera",r.parentCamera),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[0].parent=this,this._rigCameras[0]._getViewMatrix=this._getWebVRViewMatrix,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1].setCameraRigParameter("eyeParameters",c),this._rigCameras[1].setCameraRigParameter("specs",r.specs),this._rigCameras[1].setCameraRigParameter("frameData",r.frameData),this._rigCameras[1].setCameraRigParameter("parentCamera",r.parentCamera),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1].getProjectionMatrix=this._getWebVRProjectionMatrix,this._rigCameras[1].parent=this,this._rigCameras[1]._getViewMatrix=this._getWebVRViewMatrix,i.UseAlternateWebVRRendering&&(this._rigCameras[1]._skipRendering=!0,this._rigCameras[0]._alternateCamera=this._rigCameras[1])}}this._cascadePostProcessesToRigCams(),this.update()}},i.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},i.prototype._updateCameraRotationMatrix=function(){},i.prototype._updateWebVRCameraRotationMatrix=function(){},i.prototype._getWebVRProjectionMatrix=function(){return e.Matrix.Identity()},i.prototype._getWebVRViewMatrix=function(){return e.Matrix.Identity()},i.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=i,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(i/.0637))},i.prototype.createRigCamera=function(e,t){return null},i.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov;this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},i.prototype._setupInputs=function(){},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.prototype.clone=function(t){return e.SerializationHelper.Clone(i.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},i.prototype.getDirection=function(t){var i=e.Vector3.Zero();return this.getDirectionToRef(t,i),i},i.prototype.getDirectionToRef=function(t,i){e.Vector3.TransformNormalToRef(t,this.getWorldMatrix(),i)},i.GetConstructorFromName=function(t,i,r,n,o){switch(void 0===n&&(n=0),void 0===o&&(o=!0),t){case"ArcRotateCamera":return function(){return new e.ArcRotateCamera(i,0,0,1,e.Vector3.Zero(),r)};case"DeviceOrientationCamera":return function(){return new e.DeviceOrientationCamera(i,e.Vector3.Zero(),r)};case"FollowCamera":return function(){return new e.FollowCamera(i,e.Vector3.Zero(),r)};case"ArcFollowCamera":return function(){return new e.ArcFollowCamera(i,0,0,1,null,r)};case"GamepadCamera":return function(){return new e.GamepadCamera(i,e.Vector3.Zero(),r)};case"TouchCamera":return function(){return new e.TouchCamera(i,e.Vector3.Zero(),r)};case"VirtualJoysticksCamera":return function(){return new e.VirtualJoysticksCamera(i,e.Vector3.Zero(),r)};case"WebVRFreeCamera":case"WebVRGamepadCamera":return function(){return new e.WebVRFreeCamera(i,e.Vector3.Zero(),r)};case"VRDeviceOrientationFreeCamera":return function(){return new e.VRDeviceOrientationFreeCamera(i,e.Vector3.Zero(),r)};case"VRDeviceOrientationGamepadCamera":return function(){return new e.VRDeviceOrientationGamepadCamera(i,e.Vector3.Zero(),r)};case"AnaglyphArcRotateCamera":return function(){return new e.AnaglyphArcRotateCamera(i,0,0,1,e.Vector3.Zero(),n,r)};case"AnaglyphFreeCamera":return function(){return new e.AnaglyphFreeCamera(i,e.Vector3.Zero(),n,r)};case"AnaglyphGamepadCamera":return function(){return new e.AnaglyphGamepadCamera(i,e.Vector3.Zero(),n,r)};case"AnaglyphUniversalCamera":return function(){return new e.AnaglyphUniversalCamera(i,e.Vector3.Zero(),n,r)};case"StereoscopicArcRotateCamera":return function(){return new e.StereoscopicArcRotateCamera(i,0,0,1,e.Vector3.Zero(),n,o,r)};case"StereoscopicFreeCamera":return function(){return new e.StereoscopicFreeCamera(i,e.Vector3.Zero(),n,o,r)};case"StereoscopicGamepadCamera":return function(){return new e.StereoscopicGamepadCamera(i,e.Vector3.Zero(),n,o,r)};case"StereoscopicUniversalCamera":return function(){return new e.StereoscopicUniversalCamera(i,e.Vector3.Zero(),n,o,r)};case"FreeCamera":default:return function(){return new e.UniversalCamera(i,e.Vector3.Zero(),r)}}},i.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},i.Parse=function(t,r){var n=t.type,o=i.GetConstructorFromName(n,t.name,r,t.interaxial_distance,t.isStereoscopicSideBySide),s=e.SerializationHelper.Parse(o,t,r);if(t.parentId&&(s._waitingParentId=t.parentId),s.inputs&&(s.inputs.parse(t),s._setupInputs()),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(e.Vector3.FromArray(t.position))),t.target&&s.setTarget&&s.setTarget(e.Vector3.FromArray(t.target)),t.cameraRigMode){var a=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,a)}if(t.animations){for(var l=0;l<t.animations.length;l++){var h=t.animations[l];s.animations.push(e.Animation.Parse(h))}e.Node.ParseAnimationRanges(s,t,r)}return t.autoAnimate&&r.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s},i}(e.Node);t._PERSPECTIVE_CAMERA=0,t._ORTHOGRAPHIC_CAMERA=1,t._FOVMODE_VERTICAL_FIXED=0,t._FOVMODE_HORIZONTAL_FIXED=1,t._RIG_MODE_NONE=0,t._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t._RIG_MODE_VR=20,t._RIG_MODE_WEBVR=21,t.ForceAttachControlToAlwaysPreventDefault=!1,t.UseAlternateWebVRRendering=!1,n([e.serializeAsVector3()],t.prototype,"position",void 0),n([e.serializeAsVector3()],t.prototype,"upVector",void 0),n([e.serialize()],t.prototype,"orthoLeft",void 0),n([e.serialize()],t.prototype,"orthoRight",void 0),n([e.serialize()],t.prototype,"orthoBottom",void 0),n([e.serialize()],t.prototype,"orthoTop",void 0),n([e.serialize()],t.prototype,"fov",void 0),n([e.serialize()],t.prototype,"minZ",void 0),n([e.serialize()],t.prototype,"maxZ",void 0),n([e.serialize()],t.prototype,"inertia",void 0),n([e.serialize()],t.prototype,"mode",void 0),n([e.serialize()],t.prototype,"layerMask",void 0),n([e.serialize()],t.prototype,"fovMode",void 0),n([e.serialize()],t.prototype,"cameraRigMode",void 0),n([e.serialize()],t.prototype,"interaxialDistance",void 0),n([e.serialize()],t.prototype,"isStereoscopicSideBySide",void 0),e.Camera=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderinGroupInfo=null,this._scene=e;for(var i=t.MIN_RENDERINGGROUPS;i<t.MAX_RENDERINGGROUPS;i++)this._autoClearDepthStencil[i]={autoClear:!0,depth:!0,stencil:!0}}return t.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},t.prototype.render=function(i,r,n,o){var s=this._scene.onRenderingGroupObservable.hasObservers()?this._scene.onRenderingGroupObservable:null,a=null;if(s&&(this._renderinGroupInfo||(this._renderinGroupInfo=new e.RenderingGroupInfo),a=this._renderinGroupInfo,a.scene=this._scene,a.camera=this._scene.activeCamera),o)for(var l=0;l<this._scene.spriteManagers.length;l++){var h=this._scene.spriteManagers[l];this.dispatchSprites(h)}for(var l=t.MIN_RENDERINGGROUPS;l<t.MAX_RENDERINGGROUPS;l++){this._depthStencilBufferAlreadyCleaned=l===t.MIN_RENDERINGGROUPS;var c=this._renderingGroups[l];if(c||s){var u=0;if(s&&a&&(u=Math.pow(2,l),a.renderStage=e.RenderingGroupInfo.STAGE_PRECLEAR,a.renderingGroupId=l,s.notifyObservers(a,u)),t.AUTOCLEAR){var f=this._autoClearDepthStencil[l];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}s&&a&&(a.renderStage=e.RenderingGroupInfo.STAGE_PREOPAQUE,s.notifyObservers(a,u),a.renderStage=e.RenderingGroupInfo.STAGE_PRETRANSPARENT,s.notifyObservers(a,u)),c&&c.render(i,o,n,r),s&&a&&(a.renderStage=e.RenderingGroupInfo.STAGE_POSTTRANSPARENT,s.notifyObservers(a,u))}}},t.prototype.reset=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var i=this._renderingGroups[e];i&&i.prepare()}},t.prototype.dispose=function(){for(var e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){var i=this._renderingGroups[e];i&&i.dispose()}this._renderingGroups.length=0},t.prototype._prepareRenderingGroup=function(t){this._renderingGroups[t]||(this._renderingGroups[t]=new e.RenderingGroup(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))},t.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},t.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},t.prototype.dispatch=function(e){var t=e.getMesh(),i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e)},t.prototype.setRenderingOrder=function(e,t,i,r){if(void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=r,this._renderingGroups[e]){var n=this._renderingGroups[e];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],n.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:r}},t}();t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0,e.RenderingManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._depthOnlySubMeshes=new e.SmartArray(256),this._particleSystems=new e.SmartArray(256),this._spriteManagers=new e.SmartArray(256),this._edgesRenderers=new e.SmartArray(16),this._scene=i,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=o}return Object.defineProperty(t.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,this._renderOpaque=e?this.renderOpaqueSorted:t.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,this._renderAlphaTest=e?this.renderAlphaTestSorted:t.renderUnsorted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparentSortCompareFn",{set:function(e){this._transparentSortCompareFn=e||t.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!0,configurable:!0}),t.prototype.render=function(t,i,r,n){if(t)return void t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);var o=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(o.setAlphaTesting(!0),o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setAlphaTesting(!1),o.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&(o.setAlphaTesting(!0),this._renderAlphaTest(this._alphaTestSubMeshes),o.setAlphaTesting(!1));var s=o.getStencilBuffer();o.setStencilBuffer(!1),i&&this._renderSprites(),r&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(this._renderTransparent(this._transparentSubMeshes),o.setAlphaMode(e.Engine.ALPHA_DISABLE)),o.setStencilBuffer(!1);for(var a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();o.setStencilBuffer(s)},t.prototype.renderOpaqueSorted=function(e){return t.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},t.prototype.renderAlphaTestSorted=function(e){return t.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},t.prototype.renderTransparentSorted=function(e){return t.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},t.renderSorted=function(t,i,r,n){for(var o,s=0,a=r?r.globalPosition:e.Vector3.Zero();s<t.length;s++)o=t.data[s],o._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=o.getBoundingInfo().boundingSphere.centerWorld.subtract(a).length();var l=t.data.slice(0,t.length);for(i&&l.sort(i),s=0;s<l.length;s++){if(o=l[s],n){var h=o.getMaterial();if(h&&h.needDepthPrePass){var c=h.getScene().getEngine();c.setColorWrite(!1),c.setAlphaTesting(!0),c.setAlphaMode(e.Engine.ALPHA_DISABLE),o.render(!1),c.setAlphaTesting(!1),c.setColorWrite(!0)}}o.render(n)}},t.renderUnsorted=function(e){for(var t=0;t<e.length;t++){e.data[t].render(!1)}},t.defaultTransparentSortCompare=function(e,i){return e._alphaIndex>i._alphaIndex?1:e._alphaIndex<i._alphaIndex?-1:t.backToFrontSortCompare(e,i)},t.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},t.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},t.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},t.prototype.dispatch=function(e){var t=e.getMaterial(),i=e.getMesh();t&&(t.needAlphaBlendingForMesh(i)?this._transparentSubMeshes.push(e):t.needAlphaTesting()?(t.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(t.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),i._edgesRenderer&&this._edgesRenderers.push(i._edgesRenderer))},t.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},t.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},t.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._scene._activeParticleSystems.length;i++){var r=this._scene._activeParticleSystems.data[i];if(0!==(t&&t.layerMask&r.layerMask)){var n=r.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(r.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},t.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];0!==(e&&e.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},t}();e.RenderingGroup=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!0,configurable:!0}),e}(),i=function(){function e(){}return e}();i.STAGE_PRECLEAR=1,i.STAGE_PREOPAQUE=2,i.STAGE_PRETRANSPARENT=3,i.STAGE_POSTTRANSPARENT=4,e.RenderingGroupInfo=i;var r=function(){function i(t){this.autoClear=!0,this.autoClearDepthAndStencil=!0,this.clearColor=new e.Color4(.2,.2,.3,1),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this._forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.preventDefaultOnPointerDown=!0,this.metadata=null,this.onDisposeObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.onBeforeAnimationsObservable=new e.Observable,this.onAfterAnimationsObservable=new e.Observable,this.onBeforeDrawPhaseObservable=new e.Observable,this.onAfterDrawPhaseObservable=new e.Observable,this.onBeforePhysicsObservable=new e.Observable,this.onAfterPhysicsObservable=new e.Observable,this.onReadyObservable=new e.Observable,this.onBeforeCameraRenderObservable=new e.Observable,this.onAfterCameraRenderObservable=new e.Observable,this.onBeforeActiveMeshesEvaluationObservable=new e.Observable,this.onAfterActiveMeshesEvaluationObservable=new e.Observable,this.onBeforeParticlesRenderingObservable=new e.Observable,this.onAfterParticlesRenderingObservable=new e.Observable,this.onBeforeSpritesRenderingObservable=new e.Observable,this.onAfterSpritesRenderingObservable=new e.Observable,this.onDataLoadedObservable=new e.Observable,this.onNewCameraAddedObservable=new e.Observable,this.onCameraRemovedObservable=new e.Observable,this.onNewLightAddedObservable=new e.Observable,this.onLightRemovedObservable=new e.Observable,this.onNewGeometryAddedObservable=new e.Observable,this.onGeometryRemovedObservable=new e.Observable,this.onNewTransformNodeAddedObservable=new e.Observable,this.onTransformNodeRemovedObservable=new e.Observable,this.onNewMeshAddedObservable=new e.Observable,this.onMeshRemovedObservable=new e.Observable,this.OnBeforeRenderTargetsRenderObservable=new e.Observable,this.OnAfterRenderTargetsRenderObservable=new e.Observable,this.onBeforeStepObservable=new e.Observable,this.onAfterStepObservable=new e.Observable,this.onRenderingGroupObservable=new e.Observable,this.animations=[],this.onPrePointerObservable=new e.Observable,this.onPointerObservable=new e.Observable,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this.cameraToUseForPointers=null,this._startingPointerPosition=new e.Vector2(0,0),this._previousStartingPointerPosition=new e.Vector2(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this.onPreKeyboardObservable=new e.Observable,this.onKeyboardObservable=new e.Observable,this._useRightHandedSystem=!1,this._fogEnabled=!0,this._fogMode=i.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this._shadowsEnabled=!0,this._lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.transformNodes=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this._texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.highlightLayers=new Array,this._skeletonsEnabled=!0,this.skeletons=new Array,this.morphTargetManagers=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9.807,0),this.postProcesses=new Array,this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this.interactiveCanvas=null,this.probesEnabled=!0,this.reflectionProbes=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArrayNoDuplicate(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=new e.PerfCounter,this._activeIndices=new e.PerfCounter,this._activeParticles=new e.PerfCounter,this._activeBones=new e.PerfCounter,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._intermediateRendering=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._alternateViewUpdateFlag=-1,this._alternateProjectionUpdateFlag=-1,this._toBeDisposed=new e.SmartArray(256),this._pendingData=new Array,this._isDisposed=!1,this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArrayNoDuplicate(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArrayNoDuplicate(32),this._softwareSkinnedMeshes=new e.SmartArrayNoDuplicate(32),this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._useAlternateCameraConfiguration=!1,this._alternateRendering=!1,this.requireLightSorting=!1,this._activeMeshesFrozen=!1,this._tempPickingRay=e.Ray?e.Ray.Zero():null,this._engine=t||e.Engine.LastCreatedEngine,this._engine.scenes.push(this),this._uid=null,this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),e.OutlineRenderer&&(this._outlineRenderer=new e.OutlineRenderer(this)),e.Tools.IsWindowObjectExist()&&this.attachControl(),e.SimplificationQueue&&(this.simplificationQueue=new e.SimplificationQueue),this.workerCollisions=!1,this._createUbo(),this._imageProcessingConfiguration=new e.ImageProcessingConfiguration}return Object.defineProperty(i,"FOGMODE_NONE",{get:function(){return i._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_EXP",{get:function(){return i._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_EXP2",{get:function(){return i._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_LINEAR",{get:function(){return i._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gamepadManager",{get:function(){return this._gamepadManager||(this._gamepadManager=new e.GamepadManager(this)),this._gamepadManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"unTranslatedPointer",{get:function(){return new e.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),i.prototype.setStepId=function(e){this._currentStepId=e},i.prototype.getStepId=function(){return this._currentStepId},i.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fogMode",{get:function(){return this._fogMode},set:function(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(e.Material.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(e.Material.LightDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=new e.StandardMaterial("default material",this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(e.Material.AttributesDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"postProcessRenderPipelineManager",{get:function(){return this._postProcessRenderPipelineManager||(this._postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager),this._postProcessRenderPipelineManager},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mainSoundTrack",{get:function(){return this._mainSoundTrack||(this._mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_isAlternateRenderingEnabled",{get:function(){return this._alternateRendering},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new e.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(t){e.CollisionCoordinatorLegacy&&(t=t&&!!Worker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),i.prototype.getCachedMaterial=function(){return this._cachedMaterial},i.prototype.getCachedEffect=function(){return this._cachedEffect},i.prototype.getCachedVisibility=function(){return this._cachedVisibility},i.prototype.isCachedMaterialInvalid=function(e,t,i){return void 0===i&&(i=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==i},i.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer||(this._boundingBoxRenderer=new e.BoundingBoxRenderer(this)),this._boundingBoxRenderer},i.prototype.getOutlineRenderer=function(){return this._outlineRenderer},i.prototype.getEngine=function(){return this._engine},i.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(i.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!0,configurable:!0}),i.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(i.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!0,configurable:!0}),i.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(i.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!0,configurable:!0}),i.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(i.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!0,configurable:!0}),i.prototype.getInterFramePerfCounter=function(){return e.Tools.Warn("getInterFramePerfCounter is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"interFramePerfCounter",{get:function(){return e.Tools.Warn("interFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getLastFrameDuration=function(){return e.Tools.Warn("getLastFrameDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"lastFramePerfCounter",{get:function(){return e.Tools.Warn("lastFramePerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getEvaluateActiveMeshesDuration=function(){return e.Tools.Warn("getEvaluateActiveMeshesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"evaluateActiveMeshesDurationPerfCounter",{get:function(){return e.Tools.Warn("evaluateActiveMeshesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.getRenderTargetsDuration=function(){return e.Tools.Warn("getRenderTargetsDuration is deprecated. Please use SceneInstrumentation class"),0},i.prototype.getRenderDuration=function(){return e.Tools.Warn("getRenderDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"renderDurationPerfCounter",{get:function(){return e.Tools.Warn("renderDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getParticlesDuration=function(){return e.Tools.Warn("getParticlesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"particlesDurationPerfCounter",{get:function(){return e.Tools.Warn("particlesDurationPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getSpritesDuration=function(){return e.Tools.Warn("getSpritesDuration is deprecated. Please use SceneInstrumentation class"),0},Object.defineProperty(i.prototype,"spriteDuractionPerfCounter",{get:function(){return e.Tools.Warn("spriteDuractionPerfCounter is deprecated. Please use SceneInstrumentation class"),null},enumerable:!0,configurable:!0}),i.prototype.getAnimationRatio=function(){return this._animationRatio},i.prototype.getRenderId=function(){return this._renderId},i.prototype.incrementRenderId=function(){this._renderId++},i.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},i.prototype._createUbo=function(){this._sceneUbo=new e.UniformBuffer(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},i.prototype._createAlternateUbo=function(){this._alternateSceneUbo=new e.UniformBuffer(this._engine,void 0,!0),this._alternateSceneUbo.addUniform("viewProjection",16),this._alternateSceneUbo.addUniform("view",16)},i.prototype.simulatePointerMove=function(e){var t=new PointerEvent("pointermove");return this._processPointerMove(e,t)},i.prototype._processPointerMove=function(t,i){var r=this._engine.getRenderingCanvas();if(!r)return this;if(t&&t.hit&&t.pickedMesh?(this.setPointerOverSprite(null),this.setPointerOverMesh(t.pickedMesh),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers?this._pointerOverMesh.actionManager.hoverCursor?r.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:r.style.cursor=this.hoverCursor:r.style.cursor=this.defaultCursor):(this.setPointerOverMesh(null),t=this.pickSprite(this._unTranslatedPointerX,this._unTranslatedPointerY,this._spritePredicate,!1,this.cameraToUseForPointers||void 0),t&&t.hit&&t.pickedSprite?(this.setPointerOverSprite(t.pickedSprite),this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.hoverCursor?r.style.cursor=this._pointerOverSprite.actionManager.hoverCursor:r.style.cursor=this.hoverCursor):(this.setPointerOverSprite(null),r.style.cursor=this.defaultCursor)),t&&(this.onPointerMove&&this.onPointerMove(i,t),this.onPointerObservable.hasObservers())){var n="mousewheel"===i.type||"DOMMouseScroll"===i.type?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE,o=new e.PointerInfo(n,i,t);this.onPointerObservable.notifyObservers(o,n)}return this},i.prototype.simulatePointerDown=function(e){var t=new PointerEvent("pointerdown");return this._processPointerDown(e,t)},i.prototype._processPointerDown=function(t,r){var n=this;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh.actionManager;if(o){if(o.hasPickTriggers)switch(o.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNew(t.pickedMesh,r)),r.button){case 0:o.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,r));break;case 1:o.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,r));break;case 2:o.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,r))}o.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var t=n.pick(n._unTranslatedPointerX,n._unTranslatedPointerY,function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&t==n._pickedDownMesh},!1,n.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&o&&0!==n._totalPointersPressed&&(new Date).getTime()-n._startingPointerTime>i.LongPressDelay&&Math.abs(n._startingPointerPosition.x-n._pointerX)<i.DragMovementThreshold&&Math.abs(n._startingPointerPosition.y-n._pointerY)<i.DragMovementThreshold&&(n._startingPointerTime=0,o.processTrigger(e.ActionManager.OnLongPressTrigger,e.ActionEvent.CreateNew(t.pickedMesh,r)))},i.LongPressDelay)}}if(t&&(this.onPointerDown&&this.onPointerDown(r,t),this.onPointerObservable.hasObservers())){var s=e.PointerEventTypes.POINTERDOWN,a=new e.PointerInfo(s,r,t);this.onPointerObservable.notifyObservers(a,s)}return this},i.prototype.simulatePointerUp=function(e){var i=new PointerEvent("pointerup"),r=new t;return r.singleClick=!0,r.ignore=!0,this._processPointerUp(e,i,r)},i.prototype._processPointerUp=function(t,i,r){if(t&&t&&t.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(this.onPointerPick&&this.onPointerPick(i,t),r.singleClick&&!r.ignore&&this.onPointerObservable.hasObservers())){var n=e.PointerEventTypes.POINTERPICK,o=new e.PointerInfo(n,i,t);this.onPointerObservable.notifyObservers(o,n)}t.pickedMesh.actionManager&&(r.ignore&&t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)),r.hasSwiped||r.ignore||!r.singleClick||t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)),r.doubleClick&&!r.ignore&&t.pickedMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnDoublePickTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)))}if(this._pickedDownMesh&&this._pickedDownMesh.actionManager&&this._pickedDownMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnPickOutTrigger)&&this._pickedDownMesh!==this._pickedUpMesh&&this._pickedDownMesh.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNew(this._pickedDownMesh,i)),this.onPointerUp&&this.onPointerUp(i,t),this.onPointerObservable.hasObservers())if(r.ignore){var n=e.PointerEventTypes.POINTERUP,o=new e.PointerInfo(n,i,t);this.onPointerObservable.notifyObservers(o,n)}else if(!r.hasSwiped){if(r.singleClick&&this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)){var n=e.PointerEventTypes.POINTERTAP,o=new e.PointerInfo(n,i,t);this.onPointerObservable.notifyObservers(o,n)}if(r.doubleClick&&this.onPointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)){var n=e.PointerEventTypes.POINTERDOUBLETAP,o=new e.PointerInfo(n,i,t);this.onPointerObservable.notifyObservers(o,n)}}return this},i.prototype.attachControl=function(r,n,o){var s=this;void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===o&&(o=!0),this._initActionManager=function(e,t){if(!s._meshPickProceed){var i=s.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);s._currentPickResult=i,i&&(e=i.hit&&i.pickedMesh?i.pickedMesh.actionManager:null),s._meshPickProceed=!0}return e},this._delayedSimpleClick=function(e,t,r){((new Date).getTime()-s._previousStartingPointerTime>i.DoubleClickDelay&&!s._doubleClickOccured||e!==s._previousButtonPressed)&&(s._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,r(t,s._currentPickResult))},this._initClickEvent=function(r,n,o,a){var l=new t;s._currentPickResult=null;var h=null,c=r.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||n.hasSpecificMask(e.PointerEventTypes.POINTERPICK)||r.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERTAP)||r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);if(!c&&e.ActionManager&&e.ActionManager.HasPickTriggers&&(h=s._initActionManager(h,l))&&(c=h.hasPickTriggers),c){var u=o.button;if(l.hasSwiped=Math.abs(s._startingPointerPosition.x-s._pointerX)>i.DragMovementThreshold||Math.abs(s._startingPointerPosition.y-s._pointerY)>i.DragMovementThreshold,!l.hasSwiped){var f=!i.ExclusiveDoubleClickMode;f||(f=!r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)&&!n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP))&&!e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&(h=s._initActionManager(h,l))&&(f=!h.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),f?((new Date).getTime()-s._previousStartingPointerTime>i.DoubleClickDelay||u!==s._previousButtonPressed)&&(l.singleClick=!0,a(l,s._currentPickResult)):(s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,s._delayedSimpleClickTimeout=window.setTimeout(s._delayedSimpleClick.bind(s,u,l,a),i.DoubleClickDelay));var d=r.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)||n.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP);!d&&e.ActionManager.HasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)&&(h=s._initActionManager(h,l))&&(d=h.hasSpecificTrigger(e.ActionManager.OnDoublePickTrigger)),d&&(u===s._previousButtonPressed&&(new Date).getTime()-s._previousStartingPointerTime<i.DoubleClickDelay&&!s._doubleClickOccured?!l.hasSwiped&&Math.abs(s._previousStartingPointerPosition.x-s._startingPointerPosition.x)<i.DragMovementThreshold&&Math.abs(s._previousStartingPointerPosition.y-s._startingPointerPosition.y)<i.DragMovementThreshold?(s._previousStartingPointerTime=0,s._doubleClickOccured=!0,l.doubleClick=!0,l.ignore=!1,i.ExclusiveDoubleClickMode&&s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,a(l,s._currentPickResult)):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=u,i.ExclusiveDoubleClickMode?(s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,a(l,s._previousPickResult)):a(l,s._currentPickResult)):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=u))}}l.ignore=!0,a(l,s._currentPickResult)},this._spritePredicate=function(e){return e.isPickable&&e.actionManager&&e.actionManager.hasPointerTriggers},this._onPointerMove=function(t){if(s._updatePointerPosition(t),s.onPrePointerObservable.hasObservers()){var i="mousewheel"===t.type||"DOMMouseScroll"===t.type?e.PointerEventTypes.POINTERWHEEL:e.PointerEventTypes.POINTERMOVE,r=new e.PointerInfoPre(i,t,s._unTranslatedPointerX,s._unTranslatedPointerY);if(s.onPrePointerObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(s.cameraToUseForPointers||s.activeCamera){s.pointerMovePredicate||(s.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||null!==e.actionManager&&void 0!==e.actionManager)});var n=s.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,s.pointerMovePredicate,!1,s.cameraToUseForPointers);s._processPointerMove(n,t)}},this._onPointerDown=function(t){if(s._totalPointersPressed++,s._pickedDownMesh=null,s._meshPickProceed=!1,s._updatePointerPosition(t),s.preventDefaultOnPointerDown&&h&&(t.preventDefault(),h.focus()),s.onPrePointerObservable.hasObservers()){var i=e.PointerEventTypes.POINTERDOWN,r=new e.PointerInfoPre(i,t,s._unTranslatedPointerX,s._unTranslatedPointerY);if(s.onPrePointerObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(s.cameraToUseForPointers||s.activeCamera){s._startingPointerPosition.x=s._pointerX,s._startingPointerPosition.y=s._pointerY,s._startingPointerTime=(new Date).getTime(),s.pointerDownPredicate||(s.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),s._pickedDownMesh=null;var n=s.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);if(s._processPointerDown(n,t),s._pickedDownSprite=null,s.spriteManagers.length>0&&(n=s.pickSprite(s._unTranslatedPointerX,s._unTranslatedPointerY,s._spritePredicate,!1,s.cameraToUseForPointers||void 0))&&n.hit&&n.pickedSprite&&n.pickedSprite.actionManager){switch(s._pickedDownSprite=n.pickedSprite,t.button){case 0:n.pickedSprite.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNewFromSprite(n.pickedSprite,s,t));break;case 1:n.pickedSprite.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNewFromSprite(n.pickedSprite,s,t));break;case 2:n.pickedSprite.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNewFromSprite(n.pickedSprite,s,t))}n.pickedSprite.actionManager&&n.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNewFromSprite(n.pickedSprite,s,t))}}},this._onPointerUp=function(t){0!==s._totalPointersPressed&&(s._totalPointersPressed--,s._pickedUpMesh=null,s._meshPickProceed=!1,s._updatePointerPosition(t),s._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,t,function(r,n){if(s.onPrePointerObservable.hasObservers())if(r.ignore){var o=e.PointerEventTypes.POINTERUP,a=new e.PointerInfoPre(o,t,s._unTranslatedPointerX,s._unTranslatedPointerY);if(s.onPrePointerObservable.notifyObservers(a,o),a.skipOnPointerObservable)return}else if(!r.hasSwiped){if(r.singleClick&&s.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERTAP)){var o=e.PointerEventTypes.POINTERTAP,a=new e.PointerInfoPre(o,t,s._unTranslatedPointerX,s._unTranslatedPointerY);if(s.onPrePointerObservable.notifyObservers(a,o),a.skipOnPointerObservable)return}if(r.doubleClick&&s.onPrePointerObservable.hasSpecificMask(e.PointerEventTypes.POINTERDOUBLETAP)){var o=e.PointerEventTypes.POINTERDOUBLETAP,a=new e.PointerInfoPre(o,t,s._unTranslatedPointerX,s._unTranslatedPointerY);if(s.onPrePointerObservable.notifyObservers(a,o),a.skipOnPointerObservable)return}}if(s.cameraToUseForPointers||s.activeCamera){if(s.pointerUpPredicate||(s.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()}),!s._meshPickProceed&&(e.ActionManager&&e.ActionManager.HasTriggers||s.onPointerObservable.hasObservers())&&s._initActionManager(null,r),n||(n=s._currentPickResult),s._processPointerUp(n,t,r),s.spriteManagers.length>0){var l=s.pickSprite(s._unTranslatedPointerX,s._unTranslatedPointerY,s._spritePredicate,!1,s.cameraToUseForPointers||void 0);l&&(l.hit&&l.pickedSprite&&l.pickedSprite.actionManager&&(l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,s,t)),l.pickedSprite.actionManager&&Math.abs(s._startingPointerPosition.x-s._pointerX)<i.DragMovementThreshold&&Math.abs(s._startingPointerPosition.y-s._pointerY)<i.DragMovementThreshold&&l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,s,t))),s._pickedDownSprite&&s._pickedDownSprite.actionManager&&s._pickedDownSprite!==l.pickedSprite&&s._pickedDownSprite.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNewFromSprite(s._pickedDownSprite,s,t)))}s._previousPickResult=s._currentPickResult}}))},this._onKeyDown=function(t){var i=e.KeyboardEventTypes.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){var r=new e.KeyboardInfoPre(i,t);if(s.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var r=new e.KeyboardInfo(i,t);s.onKeyboardObservable.notifyObservers(r,i)}s.actionManager&&s.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(s,t))},this._onKeyUp=function(t){var i=e.KeyboardEventTypes.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){var r=new e.KeyboardInfoPre(i,t);if(s.onPreKeyboardObservable.notifyObservers(r,i),r.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var r=new e.KeyboardInfo(i,t);s.onKeyboardObservable.notifyObservers(r,i)}s.actionManager&&s.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(s,t))};var a=this.getEngine();this._onCanvasFocusObserver=a.onCanvasFocusObservable.add(function(){h&&(h.addEventListener("keydown",s._onKeyDown,!1),h.addEventListener("keyup",s._onKeyUp,!1))}),this._onCanvasBlurObserver=a.onCanvasBlurObservable.add(function(){h&&(h.removeEventListener("keydown",s._onKeyDown),h.removeEventListener("keyup",s._onKeyUp))});var l=e.Tools.GetPointerPrefix(),h=this.interactiveCanvas||this._engine.getRenderingCanvas();h&&(o&&(h.addEventListener(l+"move",this._onPointerMove,!1),h.addEventListener("mousewheel",this._onPointerMove,!1),h.addEventListener("DOMMouseScroll",this._onPointerMove,!1)),n&&h.addEventListener(l+"down",this._onPointerDown,!1),r&&window.addEventListener(l+"up",this._onPointerUp,!1),h.tabIndex=1)},i.prototype.detachControl=function(){var t=this.getEngine(),i=e.Tools.GetPointerPrefix(),r=this.interactiveCanvas||this._engine.getRenderingCanvas();r&&(r.removeEventListener(i+"move",this._onPointerMove),r.removeEventListener(i+"down",this._onPointerDown),window.removeEventListener(i+"up",this._onPointerUp),this._onCanvasBlurObserver&&t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),r.removeEventListener("mousewheel",this._onPointerMove),r.removeEventListener("DOMMouseScroll",this._onPointerMove),r.removeEventListener("keydown",this._onKeyDown),r.removeEventListener("keyup",this._onKeyUp),this.onKeyboardObservable.clear(),this.onPreKeyboardObservable.clear(),this.onPointerObservable.clear(),this.onPrePointerObservable.clear())},i.prototype.isReady=function(){if(this._isDisposed)return!1;if(this._pendingData.length>0)return!1;var t;for(t=0;t<this._geometries.length;t++){if(this._geometries[t].delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var i=this.meshes[t];if(i.isEnabled()&&(i.subMeshes&&0!==i.subMeshes.length)){if(!i.isReady())return!1;var r=i.material;if(r&&!r.isReady(i))return!1}}return!0},i.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},i.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},i.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},i.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},i.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},i.prototype._addPendingData=function(e){this._pendingData.push(e)},i.prototype._removePendingData=function(e){var t=this.isLoading,i=this._pendingData.indexOf(e);-1!==i&&this._pendingData.splice(i,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},i.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(i.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!0,configurable:!0}),i.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},i.prototype._checkIsReady=function(){var e=this;if(this.isReady())return this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1);this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},i.prototype.beginAnimation=function(t,i,r,n,o,s,a){if(void 0===o&&(o=1),i>r&&o>0&&(o*=-1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,i,r,n,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var l=t.getAnimatables(),h=0;h<l.length;h++)this.beginAnimation(l[h],i,r,n,o,s,a);return a.reset(),a},i.prototype.beginDirectAnimation=function(t,i,r,n,o,s,a){return void 0===s&&(s=1),new e.Animatable(this,t,r,n,o,s,a,i)},i.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},Object.defineProperty(i.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),i.prototype.stopAnimation=function(e,t){var i=this.getAnimatableByTarget(e);i&&i.stop(t)},i.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}},i.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){var t=e.Tools.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=t}var i=this.useConstantAnimationDeltaTime?16:(t-this._animationTimeLast)*this.animationTimeScale;this._animationTime+=i,this._animationTimeLast=t;for(var r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r]._animate(this._animationTime)}},i.prototype._switchToAlternateCameraConfiguration=function(e){this._useAlternateCameraConfiguration=e},i.prototype.getViewMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateViewMatrix:this._viewMatrix},i.prototype.getProjectionMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateProjectionMatrix:this._projectionMatrix},i.prototype.getTransformMatrix=function(){return this._useAlternateCameraConfiguration?this._alternateTransformMatrix:this._transformMatrix},i.prototype.setTransformMatrix=function(t,i){if(this._viewUpdateFlag!==t.updateFlag||this._projectionUpdateFlag!==i.updateFlag){if(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=t,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix),this.activeCamera&&this.activeCamera._alternateCamera){var r=this.activeCamera._alternateCamera;r.getViewMatrix().multiplyToRef(r.getProjectionMatrix(),e.Tmp.Matrix[0]),e.Frustum.GetRightPlaneToRef(e.Tmp.Matrix[0],this._frustumPlanes[3])}this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update())}},i.prototype._setAlternateTransformMatrix=function(t,i){this._alternateViewUpdateFlag===t.updateFlag&&this._alternateProjectionUpdateFlag===i.updateFlag||(this._alternateViewUpdateFlag=t.updateFlag,this._alternateProjectionUpdateFlag=i.updateFlag,this._alternateViewMatrix=t,this._alternateProjectionMatrix=i,this._alternateTransformMatrix||(this._alternateTransformMatrix=e.Matrix.Zero()),this._alternateViewMatrix.multiplyToRef(this._alternateProjectionMatrix,this._alternateTransformMatrix),this._alternateSceneUbo||this._createAlternateUbo(),this._alternateSceneUbo.useUbo&&(this._alternateSceneUbo.updateMatrix("viewProjection",this._alternateTransformMatrix),this._alternateSceneUbo.updateMatrix("view",this._alternateViewMatrix),this._alternateSceneUbo.update()))},i.prototype.getSceneUniformBuffer=function(){return this._useAlternateCameraConfiguration?this._alternateSceneUbo:this._sceneUbo},i.prototype.getUniqueId=function(){var e=i._uniqueIdCounter;return i._uniqueIdCounter++,e},i.prototype.addMesh=function(e){this.meshes.push(e),this.collisionCoordinator&&this.collisionCoordinator.onMeshAdded(e),this.onNewMeshAddedObservable.notifyObservers(e)},i.prototype.removeMesh=function(e){var t=this.meshes.indexOf(e);return-1!==t&&this.meshes.splice(t,1),this.onMeshRemovedObservable.notifyObservers(e),t},i.prototype.addTransformNode=function(e){this.transformNodes.push(e),this.onNewTransformNodeAddedObservable.notifyObservers(e)},i.prototype.removeTransformNode=function(e){var t=this.transformNodes.indexOf(e);return-1!==t&&this.transformNodes.splice(t,1),this.onTransformNodeRemovedObservable.notifyObservers(e),t},i.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&this.skeletons.splice(t,1),t},i.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},i.prototype.removeLight=function(e){var t=this.lights.indexOf(e);return-1!==t&&(this.lights.splice(t,1),this.sortLightsByPriority()),this.onLightRemovedObservable.notifyObservers(e),t},i.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},i.prototype.addLight=function(e){this.lights.push(e),this.sortLightsByPriority(),this.onNewLightAddedObservable.notifyObservers(e)},i.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(e.Light.compareLightsPriority)},i.prototype.addCamera=function(e){this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},i.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0);var i=this._engine.getRenderingCanvas();i&&(this.activeCamera&&this.activeCamera.detachControl(i),this.activeCamera=e,t&&e.attachControl(i))},i.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},i.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},i.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},i.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},i.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},i.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},i.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},i.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},i.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},i.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].id===e)return i.bones[r];return null},i.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],r=0;r<i.bones.length;r++)if(i.bones[r].name===e)return i.bones[r];return null},i.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},i.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},i.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},i.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},i.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},i.prototype.pushGeometry=function(e,t){return!(!t&&this.getGeometryByID(e.id))&&(this._geometries.push(e),this.collisionCoordinator&&this.collisionCoordinator.onGeometryAdded(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},i.prototype.removeGeometry=function(e){var t=this._geometries.indexOf(e);return t>-1&&(this._geometries.splice(t,1),this.collisionCoordinator&&this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemovedObservable.notifyObservers(e),!0)},i.prototype.getGeometries=function(){return this._geometries},i.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},i.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},i.prototype.getTransformNodeByID=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},i.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(t){return t.id===e})},i.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},i.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},i.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},i.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var i=this.getLightByID(e);if(i)return i;var r=this.getCameraByID(e);return r||this.getBoneByID(e)},i.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getLightByName(e);if(i)return i;var r=this.getCameraByName(e);return r||this.getBoneByName(e)},i.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},i.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},i.prototype.getSoundByName=function(t){var i;if(e.AudioEngine){for(i=0;i<this.mainSoundTrack.soundCollection.length;i++)if(this.mainSoundTrack.soundCollection[i].name===t)return this.mainSoundTrack.soundCollection[i];for(var r=0;r<this.soundTracks.length;r++)for(i=0;i<this.soundTracks[r].soundCollection.length;i++)if(this.soundTracks[r].soundCollection[i].name===t)return this.soundTracks[r].soundCollection[i]}return null},i.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},i.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},i.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},i.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype.getHighlightLayerByName=function(e){for(var t=0;t<this.highlightLayers.length;t++)if(this.highlightLayers[t].name===e)return this.highlightLayers[t];return null},Object.defineProperty(i.prototype,"uid",{get:function(){return this._uid||(this._uid=e.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),i.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,i)},i.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},i.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,i)},i.prototype.removeExternalData=function(e){return this._externalData.remove(e)},i.prototype._evaluateSubMesh=function(e,t){if(t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var i=e.getMaterial();if(t.showSubMeshesBoundingBox){var r=e.getBoundingInfo();this.getBoundingBoxRenderer().renderList.push(r.boundingBox)}i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._activeIndices.addCount(e.indexCount,!1),this._renderingManager.dispatch(e))}},i.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},i.prototype.freezeActiveMeshes=function(){return this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this},i.prototype.unfreezeActiveMeshes=function(){return this._activeMeshesFrozen=!1,this},i.prototype._evaluateActiveMeshes=function(){if((!this._activeMeshesFrozen||!this._activeMeshes.length)&&this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._boundingBoxRenderer&&this._boundingBoxRenderer.reset();var t,i;if(this._selectionOctree){var r=this._selectionOctree.select(this._frustumPlanes);t=r.data,i=r.length}else i=this.meshes.length,t=this.meshes;for(var n=0;n<i;n++){var o=t[n];if(!o.isBlocked&&(this._totalVertices.addCount(o.getTotalVertices(),!1),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);s&&(o._preActivate(),(o.alwaysSelectAsActiveMesh||o.isVisible&&o.visibility>0&&0!=(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),s!==o&&s._activate(this._renderId),this._activeMesh(o,s)))}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var a=0;a<this.particleSystems.length;a++){var l=this.particleSystems[a];if(l.isStarted()&&l.emitter){var h=l.emitter;h.position&&!h.isEnabled()||(this._activeParticleSystems.push(l),l.animate(),this._renderingManager.dispatchParticles(l))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},i.prototype._activeMesh=function(e,t){if(t.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&t.skeleton.prepare(),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)),e.showBoundingBox||this.forceShowBoundingBoxes){var i=e.getBoundingInfo();this.getBoundingBoxRenderer().renderList.push(i.boundingBox)}if(t&&t.subMeshes){var r,n;if(t._submeshesOctree&&t.useOctreeForRenderingSelection){var o=t._submeshesOctree.select(this._frustumPlanes);r=o.length,n=o.data}else n=t.subMeshes,r=n.length;for(var s=0;s<r;s++){var a=n[s];this._evaluateSubMesh(a,t)}}},i.prototype.updateTransformMatrix=function(e){this.activeCamera&&this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},i.prototype.updateAlternateTransformMatrix=function(e){this._setAlternateTransformMatrix(e.getViewMatrix(),e.getProjectionMatrix())},i.prototype._renderForCamera=function(t){if(!t||!t._skipRendering){var i=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");e.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name),i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.activeCamera.update(),this.updateTransformMatrix(),t._alternateCamera&&(this.updateAlternateTransformMatrix(t._alternateCamera),this._alternateRendering=!0),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var r=0;r<this._softwareSkinnedMeshes.length;r++){var n=this._softwareSkinnedMeshes.data[r];n.applySkeleton(n.skeleton)}this.OnBeforeRenderTargetsRenderObservable.notifyObservers(this);var o=!1;if(t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.renderTargetsEnabled&&this._renderTargets.length>0){this._intermediateRendering=!0,e.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var s=0;s<this._renderTargets.length;s++){var a=this._renderTargets.data[s];if(a._shouldRender()){this._renderId++;var l=a.activeCamera&&a.activeCamera!==this.activeCamera;a.render(l,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._intermediateRendering=!1,this._renderId++,o=!0}var h=this._engine.getStencilBuffer(),c=!1;if(this.renderTargetsEnabled&&this.highlightLayers&&this.highlightLayers.length>0){this._intermediateRendering=!0;for(var u=0;u<this.highlightLayers.length;u++){var f=this.highlightLayers[u];if(f.shouldRender()&&(!f.camera||f.camera.cameraRigMode===e.Camera.RIG_MODE_NONE&&t===f.camera||f.camera.cameraRigMode!==e.Camera.RIG_MODE_NONE&&f.camera._rigCameras.indexOf(t)>-1)){c=!0;var a=f._mainTexture;a._shouldRender()&&(this._renderId++,a.render(!1,!1),o=!0)}}this._intermediateRendering=!1,this._renderId++}o&&i.restoreDefaultFramebuffer(),this.OnAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager._prepareFrame();var d,p;if(this.layers.length){for(i.setDepthBuffer(!1),d=0;d<this.layers.length;d++)p=this.layers[d],p.isBackground&&0!=(p.layerMask&this.activeCamera.layerMask)&&p.render();i.setDepthBuffer(!0)}if(c&&this._engine.setStencilBuffer(!0),this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this),c&&this._engine.setStencilBuffer(h),this._boundingBoxRenderer&&this._boundingBoxRenderer.render(),this.lensFlaresEnabled){e.Tools.StartPerformanceCounter("Lens flares",this.lensFlareSystems.length>0);for(var m=0;m<this.lensFlareSystems.length;m++){var g=this.lensFlareSystems[m];0!=(t.layerMask&g.layerMask)&&g.render()}e.Tools.EndPerformanceCounter("Lens flares",this.lensFlareSystems.length>0)}if(this.layers.length){for(i.setDepthBuffer(!1),d=0;d<this.layers.length;d++)p=this.layers[d],p.isBackground||0==(p.layerMask&this.activeCamera.layerMask)||p.render();i.setDepthBuffer(!0)}if(c){i.setDepthBuffer(!1);for(var u=0;u<this.highlightLayers.length;u++)this.highlightLayers[u].shouldRender()&&this.highlightLayers[u].render();i.setDepthBuffer(!0)}this.postProcessManager._finalizeFrame(t.isIntermediate),this._renderTargets.reset(),this._alternateRendering=!1,this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera),e.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)}},i.prototype._processSubCameras=function(t){if(t.cameraRigMode===e.Camera.RIG_MODE_NONE)return void this._renderForCamera(t);this.activeCamera&&this.activeCamera.update();for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i]);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix())},i.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++){var i=this._meshesForIntersections.data[t];if(i.actionManager)for(var r=0;r<i.actionManager.actions.length;r++){var n=i.actionManager.actions[r];if(n.trigger===e.ActionManager.OnIntersectionEnterTrigger||n.trigger===e.ActionManager.OnIntersectionExitTrigger){var o=n.getTriggerParameter(),s=o instanceof e.AbstractMesh?o:o.mesh,a=s.intersectsMesh(i,o.usePreciseIntersection),l=i._intersectionsInProgress.indexOf(s);a&&-1===l?n.trigger===e.ActionManager.OnIntersectionEnterTrigger?(n._executeCurrent(e.ActionEvent.CreateNew(i,void 0,s)),i._intersectionsInProgress.push(s)):n.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._intersectionsInProgress.push(s):!a&&l>-1&&(n.trigger===e.ActionManager.OnIntersectionExitTrigger&&n._executeCurrent(e.ActionEvent.CreateNew(i,void 0,s)),i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger)&&n.trigger!==e.ActionManager.OnIntersectionExitTrigger||i._intersectionsInProgress.splice(l,1))}}}},i.prototype.render=function(){if(!this.isDisposed){if(this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger),this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext(),this._engine.isDeterministicLockStep()){var t=Math.max(i.MinDeltaTime,Math.min(this._engine.getDeltaTime(),i.MaxDeltaTime))+this._timeAccumulator,r=1e3/60;this._physicsEngine&&(r=1e3*this._physicsEngine.getTimeStep());var n=0,o=this._engine.getLockstepMaxSteps(),s=Math.floor(t/60);s=Math.min(s,o);do{this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=.06*r,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(r/1e3),this.onAfterPhysicsObservable.notifyObservers(this)),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,t-=r}while(t>0&&n<s);this._timeAccumulator=t<0?0:t}else{var t=this.useConstantAnimationDeltaTime?16:Math.max(i.MinDeltaTime,Math.min(this._engine.getDeltaTime(),i.MaxDeltaTime));this._animationRatio=.06*t,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this._physicsEngine&&(this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this))}this._gamepadManager&&this._gamepadManager._isMonitoring&&this._gamepadManager._checkGamepadsStatus(),this.onBeforeRenderObservable.notifyObservers(this),this.OnBeforeRenderTargetsRenderObservable.notifyObservers(this);var a=this.getEngine(),l=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var h=0;h<this.customRenderTargets.length;h++){var c=this.customRenderTargets[h];if(c._shouldRender()){if(this._renderId++,this.activeCamera=c.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");a.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),c.render(l!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}if(this.customRenderTargets.length>0&&a.restoreDefaultFramebuffer(),this.OnAfterRenderTargetsRenderObservable.notifyObservers(this),this.activeCamera=l,this.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter("Procedural textures",this._proceduralTextures.length>0);for(var u=0;u<this._proceduralTextures.length;u++){var f=this._proceduralTextures[u];f._shouldRender()&&f.render()}e.Tools.EndPerformanceCounter("Procedural textures",this._proceduralTextures.length>0)}if((this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil),this.shadowsEnabled)for(var d=0;d<this.lights.length;d++){var p=this.lights[d],m=p.getShadowGenerator();if(p.isEnabled()&&p.shadowEnabled&&m){var g=m.getShadowMap();-1!==this.textures.indexOf(g)&&this._renderTargets.push(g)}}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this._geometryBufferRenderer&&this._renderTargets.push(this._geometryBufferRenderer.getGBuffer()),this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var v=0;v<this.activeCameras.length;v++)v>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[v]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections(),e.AudioEngine&&this._updateAudioParameters(),this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this);for(var y=0;y<this._toBeDisposed.length;y++){var _=this._toBeDisposed.data[y];_&&_.dispose(),this._toBeDisposed[y]=null}this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},i.prototype._updateAudioParameters=function(){if(this.audioEnabled&&this._mainSoundTrack&&(0!==this._mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var t,i=e.Engine.audioEngine;if((t=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera)&&i.canUseWebAudio&&i.audioContext){i.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z),t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]);var r=e.Matrix.Invert(t.getViewMatrix()),n=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),r);n.normalize(),isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||i.audioContext.listener.setOrientation(n.x,n.y,n.z,0,1,0);var o;for(o=0;o<this.mainSoundTrack.soundCollection.length;o++){var s=this.mainSoundTrack.soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}for(o=0;o<this.soundTracks.length;o++)for(var a=0;a<this.soundTracks[o].soundCollection.length;a++)s=this.soundTracks[o].soundCollection[a],s.useCustomAttenuation&&s.updateDistanceFromListener()}}},Object.defineProperty(i.prototype,"audioEnabled",{get:function(){return this._audioEnabled},set:function(t){this._audioEnabled=t,e.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),i.prototype._disableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].pause();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].pause()},i.prototype._enableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].isPaused&&this.mainSoundTrack.soundCollection[e].play();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].isPaused&&this.soundTracks[e].soundCollection[t].play()},Object.defineProperty(i.prototype,"headphone",{get:function(){return this._headphone},set:function(t){this._headphone=t,e.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),i.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToHRTF()},i.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToEqualPower()},i.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new e.DepthRenderer(this),this._depthRenderer)},i.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},i.prototype.enableGeometryBufferRenderer=function(t){return void 0===t&&(t=1),this._geometryBufferRenderer?this._geometryBufferRenderer:(this._geometryBufferRenderer=new e.GeometryBufferRenderer(this,t),this._geometryBufferRenderer.isSupported||(this._geometryBufferRenderer=null),this._geometryBufferRenderer)},i.prototype.disableGeometryBufferRenderer=function(){this._geometryBufferRenderer&&(this._geometryBufferRenderer.dispose(),this._geometryBufferRenderer=null)},i.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},i.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},i.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this.morphTargetManagers=[],this.importedMeshesFiles=new Array,this.stopAllAnimations(),this.resetCachedMaterial(),this._depthRenderer&&this._depthRenderer.dispose(),this._gamepadManager&&(this._gamepadManager.dispose(),this._gamepadManager=null),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._boundingBoxRenderer&&this._boundingBoxRenderer.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.dispose(),this._debugLayer&&this._debugLayer.hide(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.OnBeforeRenderTargetsRenderObservable.clear(),this.OnAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeSpritesRenderingObservable.clear(),this.onAfterSpritesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforePhysicsObservable.clear(),this.onAfterPhysicsObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.detachControl(),e.AudioEngine&&this.disposeSounds(),this.VRHelper&&this.VRHelper.dispose();var t=this._engine.getRenderingCanvas();if(t){var i;for(i=0;i<this.cameras.length;i++)this.cameras[i].detachControl(t)}for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.removeTransformNode(this.transformNodes[0]);for(;this.cameras.length;)this.cameras[0].dispose();for(this.defaultMaterial&&this.defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.highlightLayers.length;)this.highlightLayers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._alternateSceneUbo&&this._alternateSceneUbo.dispose(),this.postProcessManager.dispose(),this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),i=this._engine.scenes.indexOf(this),i>-1&&this._engine.scenes.splice(i,1),this._engine.wipeCaches(),this._isDisposed=!0},Object.defineProperty(i.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),i.prototype.disposeSounds=function(){if(this._mainSoundTrack){this.mainSoundTrack.dispose();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].dispose()}},i.prototype.getWorldExtends=function(){for(var t=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=0;r<this.meshes.length;r++){var n=this.meshes[r];if(n.subMeshes&&0!==n.subMeshes.length&&!n.infiniteDistance){n.computeWorldMatrix(!0);var o=n.getBoundingInfo(),s=o.boundingBox.minimumWorld,a=o.boundingBox.maximumWorld;e.Tools.CheckExtends(s,t,i),e.Tools.CheckExtends(a,t,i)}}return{min:t,max:i}},i.prototype.createOrUpdateSelectionOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,i));var r=this.getWorldExtends();return this._selectionOctree.update(r.min,r.max,this.meshes),this._selectionOctree},i.prototype.createPickingRay=function(t,i,r,n,o){void 0===o&&(o=!1);var s=e.Ray.Zero();return this.createPickingRayToRef(t,i,r,s,n,o),s},i.prototype.createPickingRayToRef=function(t,i,r,n,o,s){void 0===s&&(s=!1);var a=this._engine;if(!o){if(!this.activeCamera)throw new Error("Active camera not set");o=this.activeCamera}var l=o.viewport,h=l.toGlobal(a.getRenderWidth(),a.getRenderHeight());return t=t/this._engine.getHardwareScalingLevel()-h.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-h.y-h.height),n.update(t,i,h.width,h.height,r||e.Matrix.Identity(),s?e.Matrix.Identity():o.getViewMatrix(),o.getProjectionMatrix()),this},i.prototype.createPickingRayInCameraSpace=function(t,i,r){var n=e.Ray.Zero();return this.createPickingRayInCameraSpaceToRef(t,i,n,r),n},i.prototype.createPickingRayInCameraSpaceToRef=function(t,i,r,n){if(!e.PickingInfo)return this;var o=this._engine;if(!n){if(!this.activeCamera)throw new Error("Active camera not set");n=this.activeCamera}var s=n.viewport,a=s.toGlobal(o.getRenderWidth(),o.getRenderHeight()),l=e.Matrix.Identity();return t=t/this._engine.getHardwareScalingLevel()-a.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-a.y-a.height),r.update(t,i,a.width,a.height,l,l,n.getProjectionMatrix()),this},i.prototype._internalPick=function(t,i,r){if(!e.PickingInfo)return null;for(var n=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(i){if(!i(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),l=t(a),h=s.intersects(l,r);if(h&&h.hit&&((r||null==n||!(h.distance>=n.distance))&&(n=h,r)))break}return n||new e.PickingInfo},i.prototype._internalMultiPick=function(t,i){if(!e.PickingInfo)return null;for(var r=new Array,n=0;n<this.meshes.length;n++){var o=this.meshes[n];if(i){if(!i(o))continue}else if(!o.isEnabled()||!o.isVisible||!o.isPickable)continue;var s=o.getWorldMatrix(),a=t(s),l=o.intersects(a,!1);l&&l.hit&&r.push(l)}return r},i.prototype._internalPickSprites=function(t,i,r,n){if(!e.PickingInfo)return null;var o=null;if(!n){if(!this.activeCamera)return null;n=this.activeCamera}if(this.spriteManagers.length>0)for(var s=0;s<this.spriteManagers.length;s++){var a=this.spriteManagers[s];if(a.isPickable){var l=a.intersects(t,n,i,r);if(l&&l.hit&&(r||null==o||!(l.distance>=o.distance))&&(o=l,r))break}}return o||new e.PickingInfo},i.prototype.pick=function(t,i,r,n,o){var s=this;return e.PickingInfo?this._internalPick(function(e){return s.createPickingRayToRef(t,i,e,s._tempPickingRay,o||null),s._tempPickingRay},r,n):null},i.prototype.pickSprite=function(e,t,i,r,n){return this.createPickingRayInCameraSpaceToRef(e,t,this._tempPickingRay,n),this._internalPickSprites(this._tempPickingRay,i,r,n)},i.prototype.pickWithRay=function(t,i,r){var n=this;return this._internalPick(function(i){return n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=e.Ray.Zero()),e.Ray.TransformToRef(t,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform},i,r)},i.prototype.multiPick=function(e,t,i,r){var n=this;return this._internalMultiPick(function(i){return n.createPickingRay(e,t,i,r||null)},i)},i.prototype.multiPickWithRay=function(t,i){var r=this;return this._internalMultiPick(function(i){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(r._pickWithRayInverseMatrix),r._cachedRayForTransform||(r._cachedRayForTransform=e.Ray.Zero()),e.Ray.TransformToRef(t,r._pickWithRayInverseMatrix,r._cachedRayForTransform),r._cachedRayForTransform},i)},i.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},i.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},i.prototype.setPointerOverSprite=function(t){this._pointerOverSprite!==t&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=t,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},i.prototype.getPointerOverSprite=function(){return this._pointerOverSprite},i.prototype.getPhysicsEngine=function(){return this._physicsEngine},i.prototype.enablePhysics=function(t,i){if(void 0===t&&(t=null),this._physicsEngine)return!0;try{return this._physicsEngine=new e.PhysicsEngine(t,i),!0}catch(t){return e.Tools.Error(t.message),!1}},i.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},i.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},i.prototype.deleteCompoundImpostor=function(e){var t=e.parts[0].mesh;t.physicsImpostor&&(t.physicsImpostor.dispose(),t.physicsImpostor=null)},i.prototype._rebuildGeometries=function(){for(var e=0,t=this._geometries;e<t.length;e++){t[e]._rebuild()}for(var i=0,r=this.meshes;i<r.length;i++){r[i]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,o=this.layers;n<o.length;n++){o[n]._rebuild()}for(var s=0,a=this.highlightLayers;s<a.length;s++){a[s]._rebuild()}this._boundingBoxRenderer&&this._boundingBoxRenderer._rebuild();for(var l=0,h=this.particleSystems;l<h.length;l++){h[l].rebuild()}this._postProcessRenderPipelineManager&&this._postProcessRenderPipelineManager._rebuild()},i.prototype._rebuildTextures=function(){for(var t=0,i=this.textures;t<i.length;t++){i[t]._rebuild()}this.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag)},i.prototype.createDefaultCameraOrLight=function(t,i,r){if(void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===r&&(r=!1),i&&(this.activeCamera&&(this.activeCamera.dispose(),this.activeCamera=null),this.lights))for(var n=0;n<this.lights.length;n++)this.lights[n].dispose();if(0===this.lights.length&&new e.HemisphericLight("default light",e.Vector3.Up(),this),!this.activeCamera){var o,s=this.getWorldExtends(),a=s.max.subtract(s.min),l=s.min.add(a.scale(.5)),h=1.5*a.length();if(t){var c=new e.ArcRotateCamera("default camera",-Math.PI/2,Math.PI/2,h,l,this);c.lowerRadiusLimit=.01*h,c.wheelPrecision=100/h,o=c}else{var u=new e.FreeCamera("default camera",new e.Vector3(l.x,l.y,-h),this);u.setTarget(l),o=u}o.minZ=.01*h,o.maxZ=100*h,o.speed=.2*h,this.activeCamera=o;var f=this.getEngine().getRenderingCanvas();r&&f&&o.attachControl(f)}},i.prototype.createDefaultSkybox=function(t,i,r,n){if(void 0===i&&(i=!1),void 0===r&&(r=1e3),void 0===n&&(n=0),t&&(this.environmentTexture=t),!this.environmentTexture)return e.Tools.Warn("Can not create default skybox without environment texture."),null;var o=e.Mesh.CreateBox("hdrSkyBox",r,this);if(i){var s=new e.PBRMaterial("skyBox",this);s.backFaceCulling=!1,s.reflectionTexture=this.environmentTexture.clone(),s.reflectionTexture&&(s.reflectionTexture.coordinatesMode=e.Texture.SKYBOX_MODE),s.microSurface=1-n,s.disableLighting=!0,s.twoSidedLighting=!0,o.infiniteDistance=!0,o.material=s}else{var a=new e.StandardMaterial("skyBox",this);a.backFaceCulling=!1,a.reflectionTexture=this.environmentTexture.clone(),a.reflectionTexture&&(a.reflectionTexture.coordinatesMode=e.Texture.SKYBOX_MODE),a.disableLighting=!0,o.infiniteDistance=!0,o.material=a}return o},i.prototype.createDefaultEnvironment=function(t){return e.EnvironmentHelper?new e.EnvironmentHelper(t,this):null},i.prototype.createDefaultVRExperience=function(t){return void 0===t&&(t={}),new e.VRExperienceHelper(this,t)},i.prototype._getByTags=function(t,i,r){if(void 0===i)return t;var n=[];r=r||function(e){};for(var o in t){var s=t[o];e.Tags&&e.Tags.MatchesQuery(s,i)&&(n.push(s),r(s))}return n},i.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},i.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},i.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},i.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},i.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},i.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,i,r)},i.prototype.markAllMaterialsAsDirty=function(e,t){for(var i=0,r=this.materials;i<r.length;i++){var n=r[i];t&&!t(n)||n.markAsDirty(e)}},i}();r._FOGMODE_NONE=0,r._FOGMODE_EXP=1,r._FOGMODE_EXP2=2,r._FOGMODE_LINEAR=3,r._uniqueIdCounter=0,r.MinDeltaTime=1,r.MaxDeltaTime=1e3,r.DragMovementThreshold=10,r.LongPressDelay=500,r.DoubleClickDelay=300,r.ExclusiveDoubleClickMode=!1,e.Scene=r}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o,s){void 0===s&&(s=!1),t instanceof e.Mesh?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._data=i,this._strideSize=n,o||this.create(),this._instanced=s,this._instanceDivisor=s?1:0}return t.prototype.createVertexBuffer=function(t,i,r,n){return new e.VertexBuffer(this._engine,this,t,this._updatable,!0,n||this._strideSize,this._instanced,i,r)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.getIsInstanced=function(){return this._instanced},Object.defineProperty(t.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e},enumerable:!0,configurable:!0}),t.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},t.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t,i){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,t,i?i*this.getStrideSize():void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}();e.Buffer=t}(r||(r={}));var r;!function(e){var t=function(){function t(i,r,n,o,s,a,l,h,c){if(!a)switch(n){case t.PositionKind:case t.NormalKind:a=3;break;case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:a=2;break;case t.TangentKind:case t.ColorKind:a=4;break;case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:a=4;break;case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:default:a=4}r instanceof e.Buffer?(a||(a=r.getStrideSize()),this._buffer=r,this._ownsBuffer=!1):(this._buffer=new e.Buffer(i,r,o,a,s,l),this._ownsBuffer=!0),this._stride=a,this._offset=h||0,this._size=c||a,this._kind=n}return t.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},t.prototype.getKind=function(){return this._kind},t.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},t.prototype.getData=function(){return this._buffer.getData()},t.prototype.getBuffer=function(){return this._buffer.getBuffer()},t.prototype.getStrideSize=function(){return this._stride},t.prototype.getOffset=function(){return this._offset},t.prototype.getSize=function(){return this._size},t.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},t.prototype.getInstanceDivisor=function(){return this._buffer.instanceDivisor},t.prototype.create=function(e){return this._buffer.create(e)},t.prototype.update=function(e){return this._buffer.update(e)},t.prototype.updateDirectly=function(e,t){return this._buffer.updateDirectly(e,t)},t.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(t,"PositionKind",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NormalKind",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TangentKind",{get:function(){return t._TangentKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UVKind",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV2Kind",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV3Kind",{get:function(){return t._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV4Kind",{get:function(){return t._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV5Kind",{get:function(){return t._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV6Kind",{get:function(){return t._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorKind",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesKind",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsKind",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesExtraKind",{get:function(){return t._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsExtraKind",{get:function(){return t._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),t}();t._PositionKind="position",t._NormalKind="normal",t._TangentKind="tangent",t._UVKind="uv",t._UV2Kind="uv2",t._UV3Kind="uv3",t._UV4Kind="uv4",t._UV5Kind="uv5",t._UV6Kind="uv6",t._ColorKind="color",t._MatricesIndicesKind="matricesIndices",t._MatricesWeightsKind="matricesWeights",t._MatricesIndicesExtraKind="matricesIndicesExtra",t._MatricesWeightsExtraKind="matricesWeightsExtra",e.VertexBuffer=t}(r||(r={}));var r;!function(e){var t=function(){function t(i,r){this.onLoadedObservable=new e.Observable,this._dataSource=t.DATASOURCE_UNKNOWN,this._references=1,this._engine=i,this._dataSource=r,this._webGLTexture=i._createTexture()}return Object.defineProperty(t.prototype,"dataSource",{get:function(){return this._dataSource},enumerable:!0,configurable:!0}),t.prototype.incrementReferences=function(){this._references++},t.prototype.updateSize=function(e,t,i){void 0===i&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},t.prototype._rebuild=function(){var i,r=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this._dataSource){case t.DATASOURCE_TEMP:return;case t.DATASOURCE_URL:return i=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){r.isReady=!0},null,this._buffer,void 0,this.format),void i._swapAndDie(this);case t.DATASOURCE_RAW:return i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),i._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_RAW3D:return i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_DYNAMIC:return i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),void i._swapAndDie(this);case t.DATASOURCE_RENDERTARGET:var n=new e.RenderTargetCreationOptions;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)i=this._engine.createRenderTargetCubeTexture(this.width,n);else{var o={width:this.width,height:this.height};i=this._engine.createRenderTargetTexture(o,n)}return i._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_CUBE:return i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){r.isReady=!0},null,this.format,this._extension),void i._swapAndDie(this);case t.DATASOURCE_CUBERAW:return i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),void(this.isReady=!0);case t.DATASOURCE_CUBEPREFILTERED:return void(i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(r),r.isReady=!0},null,this.format,this._extension))}},t.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow);var t=this._engine.getLoadedTexturesCache(),i=t.indexOf(this);-1!==i&&t.splice(i,1)},t.prototype.dispose=function(){this._webGLTexture&&0===--this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null)},t}();t.DATASOURCE_UNKNOWN=0,t.DATASOURCE_URL=1,t.DATASOURCE_TEMP=2,t.DATASOURCE_RAW=3,t.DATASOURCE_DYNAMIC=4,t.DATASOURCE_RENDERTARGET=5,t.DATASOURCE_MULTIRENDERTARGET=6,t.DATASOURCE_CUBE=7,t.DATASOURCE_CUBERAW=8,t.DATASOURCE_CUBEPREFILTERED=9,t.DATASOURCE_RAW3D=10,e.InternalTexture=t}(r||(r={}));var r;!function(e){var t=function(){function t(i){this._hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this._coordinatesMode=e.Texture.EXPLICIT_MODE,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE,this.wrapR=e.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this.isCube=!1,this.is3D=!1,this.gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.lodGenerationOffset=0,this.lodGenerationScale=.8,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new e.Observable,this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._scene=i||e.Engine.LastCreatedScene,this._scene&&this._scene.textures.push(this),this._uid=null}return Object.defineProperty(t.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=e.Tools.RandomId()),this._uid},enumerable:!0,configurable:!0}),t.prototype.toString=function(){return this.name},t.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return e.Matrix.IdentityReadOnly},t.prototype.getReflectionTextureMatrix=function(){return e.Matrix.IdentityReadOnly},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},t.prototype.getSize=function(){return this._texture&&this._texture.width?new e.Size(this._texture.width,this._texture.height):this._texture&&this._texture._size?new e.Size(this._texture._size,this._texture._size):e.Size.Zero()},t.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?new e.Size(this._texture._size,this._texture._size):new e.Size(this._texture.baseWidth,this._texture.baseHeight):e.Size.Zero()},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._getFromCache=function(e,t,i){if(!this._scene)return null;for(var r=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<r.length;n++){var o=r[n];if(o.url===e&&o.generateMipMaps===!t&&(!i||i===o.samplingMode))return o.incrementReferences(),o}return null},t.prototype._rebuild=function(){},t.prototype.delayLoad=function(){},t.prototype.clone=function(){return null},Object.defineProperty(t.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:e.Engine.TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:e.Engine.TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),t.prototype.readPixels=function(e){if(void 0===e&&(e=0),!this._texture)return null;var t=this.getSize(),i=this.getScene();if(!i)return null;var r=i.getEngine();return this._texture.isCube?r._readTexturePixels(this._texture,t.width,t.height,e):r._readTexturePixels(this._texture,t.width,t.height,-1)},t.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},Object.defineProperty(t.prototype,"sphericalPolynomial",{get:function(){return this._texture&&e.Internals.CubeMapToSphericalPolynomialTools&&this.isReady()?(this._texture._sphericalPolynomial||(this._texture._sphericalPolynomial=e.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this)),this._texture._sphericalPolynomial):null},set:function(e){this._texture&&(this._texture._sphericalPolynomial=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation(this),this._scene._removePendingData(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())}},t.prototype.serialize=function(){if(!this.name)return null;var t=e.SerializationHelper.Serialize(this);return e.Animation.AppendSerializedAnimations(this,t),t},t.WhenAllReady=function(e,t){var i=e.length;if(0===i)return void t();for(var r,n,o=0;o<e.length;o++)!function(){if(r=e[o],r.isReady())0==--i&&t();else{n=r.onLoadObservable;var s=function(){n.removeCallback(s),0==--i&&t()};n.add(s)}}()},t}();t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,n([e.serialize()],t.prototype,"name",void 0),n([e.serialize("hasAlpha")],t.prototype,"_hasAlpha",void 0),n([e.serialize()],t.prototype,"getAlphaFromRGB",void 0),n([e.serialize()],t.prototype,"level",void 0),n([e.serialize()],t.prototype,"coordinatesIndex",void 0),n([e.serialize("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),n([e.serialize()],t.prototype,"wrapU",void 0),n([e.serialize()],t.prototype,"wrapV",void 0),n([e.serialize()],t.prototype,"wrapR",void 0),n([e.serialize()],t.prototype,"anisotropicFilteringLevel",void 0),n([e.serialize()],t.prototype,"isCube",void 0),n([e.serialize()],t.prototype,"is3D",void 0),n([e.serialize()],t.prototype,"gammaSpace",void 0),n([e.serialize()],t.prototype,"invertZ",void 0),n([e.serialize()],t.prototype,"lodLevelInAlpha",void 0),n([e.serialize()],t.prototype,"lodGenerationOffset",void 0),n([e.serialize()],t.prototype,"lodGenerationScale",void 0),n([e.serialize()],t.prototype,"isRenderTarget",void 0),e.BaseTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(r,n,o,s,a,l,h,c,u,f){void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===a&&(a=i.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=!1);var d=t.call(this,n)||this;if(d.uOffset=0,d.vOffset=0,d.uScale=1,d.vScale=1,d.uAng=0,d.vAng=0,d.wAng=0,d._isBlocking=!0,d.name=r||"",d.url=r,d._noMipmap=o,d._invertY=s,d._samplingMode=a,d._buffer=c,d._deleteBuffer=u,f&&(d._format=f),!(n=d.getScene()))return d;n.getEngine().onBeforeTextureInitObservable.notifyObservers(d);var p=function(){d._onLoadObservable&&d._onLoadObservable.hasObservers()&&d.onLoadObservable.notifyObservers(d),l&&l(),!d.isBlocking&&n&&n.resetCachedMaterial()};return d.url?(d._texture=d._getFromCache(d.url,o,a),d._texture?d._texture.isReady?e.Tools.SetImmediate(function(){return p()}):d._texture.onLoadedObservable.add(p):n.useDelayedTextureLoading?(d.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,d._delayedOnLoad=p,d._delayedOnError=h):(d._texture=n.getEngine().createTexture(d.url,o,s,n,d._samplingMode,p,h,d._buffer,void 0,d._format),u&&delete d._buffer),d):(d._delayedOnLoad=p,d._delayedOnError=h,d)}return o(i,t),Object.defineProperty(i.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"samplingMode",{get:function(){return this._samplingMode},enumerable:!0,configurable:!0}),i.prototype.updateURL=function(t){this.url=t,this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,this.delayLoad()},i.prototype.delayLoad=function(){var t=this;if(this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){var i=this.getScene();i&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture?this._texture.isReady?e.Tools.SetImmediate(function(){t._delayedOnLoad&&t._delayedOnLoad()}):this._delayedOnLoad&&this._texture.onLoadedObservable.add(this._delayedOnLoad):(this._texture=i.getEngine().createTexture(this.url,this._noMipmap,this._invertY,i,this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format),this._deleteBuffer&&delete this._buffer))}},i.prototype.updateSamplingMode=function(e){if(this._texture){var t=this.getScene();t&&(this._samplingMode=e,t.getEngine().updateTextureSamplingMode(e,this._texture))}},i.prototype._prepareRowForTextureGeneration=function(t,i,r,n){t*=this.uScale,i*=this.vScale,t-=.5*this.uScale,i-=.5*this.vScale,r-=.5,e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,r,this._rowGenerationMatrix,n),n.x+=.5*this.uScale+this.uOffset,n.y+=.5*this.vScale+this.vOffset,n.z+=.5},i.prototype.getTextureMatrix=function(){var t=this;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._rowGenerationMatrix=new e.Matrix,this._t0=e.Vector3.Zero(),this._t1=e.Vector3.Zero(),this._t2=e.Vector3.Zero()),e.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z;var i=this.getScene();return i?(i.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag,function(e){return e.hasTexture(t)}),this._cachedTextureMatrix):this._cachedTextureMatrix},i.prototype.getReflectionTextureMatrix=function(){var t=this,r=this.getScene();if(!r)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==i.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===r.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=e.Matrix.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case i.PLANAR_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case i.PROJECTION_MODE:e.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1;var n=r.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:e.Matrix.IdentityToRef(this._cachedTextureMatrix)}return r.markAllMaterialsAsDirty(e.Material.TextureDirtyFlag,function(e){return-1!==e.getActiveTextures().indexOf(t)}),this._cachedTextureMatrix},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone(function(){return new i(t._texture?t._texture.url:null,t.getScene(),t._noMipmap,t._invertY,t._samplingMode)},this)},Object.defineProperty(i.prototype,"onLoadObservable",{get:function(){return this._onLoadObservable||(this._onLoadObservable=new e.Observable),this._onLoadObservable},enumerable:!0,configurable:!0}),i.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return"string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)&&(e.base64String=this._buffer,e.name=e.name.replace("data:","")),e},i.prototype.getClassName=function(){return"Texture"},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.onLoadObservable&&(this.onLoadObservable.clear(),this._onLoadObservable=null),this._delayedOnLoad=null,this._delayedOnError=null},i.CreateFromBase64String=function(t,r,n,o,s,a,l,h,c){return void 0===a&&(a=i.TRILINEAR_SAMPLINGMODE),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=e.Engine.TEXTUREFORMAT_RGBA),new i("data:"+r,n,o,s,a,l,h,t,!1,c)},i.Parse=function(t,r,n){if(t.customType){var o=e.Tools.Instantiate(t.customType),s=o.Parse(t,r,n);return t.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==t.samplingMode&&s.updateSamplingMode(t.samplingMode),s}if(t.isCube)return e.CubeTexture.Parse(t,r,n);if(!t.name&&!t.isRenderTarget)return null;var a=e.SerializationHelper.Parse(function(){var o=!0;if(t.noMipmap&&(o=!1),t.mirrorPlane){var s=new e.MirrorTexture(t.name,t.renderTargetSize,r,o);return s._waitingRenderList=t.renderList,s.mirrorPlane=e.Plane.FromArray(t.mirrorPlane),s}if(t.isRenderTarget){var a=new e.RenderTargetTexture(t.name,t.renderTargetSize,r,o);return a._waitingRenderList=t.renderList,a}return t.base64String?i.CreateFromBase64String(t.base64String,t.name,r,!o):new i(n+t.name,r,!o)},t,r);if(t.samplingMode){var l=t.samplingMode;a._samplingMode!==l&&a.updateSamplingMode(l)}if(t.animations)for(var h=0;h<t.animations.length;h++){var c=t.animations[h];a.animations.push(e.Animation.Parse(c))}return a},i.LoadFromDataString=function(t,r,n,o,s,a,l,h,c,u){return void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=!0),void 0===l&&(l=i.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===c&&(c=null),void 0===u&&(u=e.Engine.TEXTUREFORMAT_RGBA),"data:"!==t.substr(0,5)&&(t="data:"+t),new i(t,n,s,a,l,h,c,r,o,u)},i}(e.BaseTexture);t.NEAREST_SAMPLINGMODE=1,t.NEAREST_NEAREST_MIPLINEAR=1,t.BILINEAR_SAMPLINGMODE=2,t.LINEAR_LINEAR_MIPNEAREST=2,t.TRILINEAR_SAMPLINGMODE=3,t.LINEAR_LINEAR_MIPLINEAR=3,t.NEAREST_NEAREST_MIPNEAREST=4,t.NEAREST_LINEAR_MIPNEAREST=5,t.NEAREST_LINEAR_MIPLINEAR=6,t.NEAREST_LINEAR=7,t.NEAREST_NEAREST=8,t.LINEAR_NEAREST_MIPNEAREST=9,t.LINEAR_NEAREST_MIPLINEAR=10,t.LINEAR_LINEAR=11,t.LINEAR_NEAREST=12,t.EXPLICIT_MODE=0,t.SPHERICAL_MODE=1,t.PLANAR_MODE=2,t.CUBIC_MODE=3,t.PROJECTION_MODE=4,t.SKYBOX_MODE=5,t.INVCUBIC_MODE=6,t.EQUIRECTANGULAR_MODE=7,t.FIXED_EQUIRECTANGULAR_MODE=8,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.CLAMP_ADDRESSMODE=0,t.WRAP_ADDRESSMODE=1,t.MIRROR_ADDRESSMODE=2,n([e.serialize()],t.prototype,"url",void 0),n([e.serialize()],t.prototype,"uOffset",void 0),n([e.serialize()],t.prototype,"vOffset",void 0),n([e.serialize()],t.prototype,"uScale",void 0),n([e.serialize()],t.prototype,"vScale",void 0),n([e.serialize()],t.prototype,"uAng",void 0),n([e.serialize()],t.prototype,"vAng",void 0),n([e.serialize()],t.prototype,"wAng",void 0),n([e.serialize()],t.prototype,"isBlocking",null),e.Texture=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var i=function(i){function r(n,o,s,a,l,h){void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===h&&(h=!0);var c=i.call(this,n,o)||this;if(c.onBeforeRenderObservable=new e.Observable,c.onAfterRenderObservable=new e.Observable,c.onBeforeDrawObservable=new e.Observable,c.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,c.instances=new Array,c._LODLevels=new Array,c._visibleInstances={},c._renderIdForInstances=new Array,c._batchCache=new t,c._instancesBufferSize=2048,c._originalBuilderSideOrientation=r._DEFAULTSIDE,c.overrideMaterialSideOrientation=null,c._areNormalsFrozen=!1,c._source=null,o=c.getScene(),a){c._source=a,a._geometry&&a._geometry.applyToMesh(c),e.Tools.DeepCopy(a,c,["name","material","skeleton","instances","parent","uniqueId","source"],["_poseMatrix","_source"]),e.Tags&&e.Tags.HasTags(a)&&e.Tags.AddTagsTo(c,e.Tags.GetTags(a,!0)),c.metadata=a.metadata,c.parent=a.parent,c.setPivotMatrix(a.getPivotMatrix()),c.id=n+"."+a.id,c.material=a.material;var u;if(!l)for(var f=a.getDescendants(!0),d=0;d<f.length;d++){var p=f[d];p.clone&&p.clone(n+"."+p.name,c)}var m=c.getScene().getPhysicsEngine();if(h&&m){var g=m.getImpostorForPhysicsObject(a);g&&(c.physicsImpostor=g.clone(c))}for(u=0;u<o.particleSystems.length;u++){var v=o.particleSystems[u];v.emitter===a&&v.clone(v.name,c)}c.computeWorldMatrix(!0)}return null!==s&&(c.parent=s),c}return o(r,i),Object.defineProperty(r,"FRONTSIDE",{get:function(){return r._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BACKSIDE",{get:function(){return r._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"DOUBLESIDE",{get:function(){return r._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"DEFAULTSIDE",{get:function(){return r._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(r,"NO_CAP",{get:function(){return r._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(r,"CAP_START",{get:function(){return r._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(r,"CAP_END",{get:function(){return r._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(r,"CAP_ALL",{get:function(){return r._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"morphTargetManager",{get:function(){return this._morphTargetManager},set:function(e){this._morphTargetManager!==e&&(this._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"Mesh"},r.prototype.toString=function(t){var r=i.prototype.toString.call(this,t);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var n=0;n<this.animations.length;n++)r+=", animation[0]: "+this.animations[n].toString(t);if(t)if(this._geometry){var o=this.getIndices(),s=this.getVerticesData(e.VertexBuffer.PositionKind);s&&o&&(r+=", flat shading: "+(s.length/3===o.length?"YES":"NO"))}else r+=", flat shading: UNKNOWN";return r},Object.defineProperty(r.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),r.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},r.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return e.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var r=new e.Internals.MeshLODLevel(t,i);return this._LODLevels.push(r),i&&(i._masterMesh=this),this._sortLODLevels(),this},r.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var i=this._LODLevels[t];if(i.distance===e)return i.mesh}return null},r.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},r.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var i;if(t)i=t;else{i=this.getBoundingInfo().boundingSphere}var r=i.centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>r)return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var o=this._LODLevels[n];if(o.distance<r)return o.mesh&&(o.mesh._preActivate(),o.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(r,this,o.mesh),o.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(r,this,this),this},Object.defineProperty(r.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),r.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},r.prototype.getVerticesData=function(e,t,i){return this._geometry?this._geometry.getVerticesData(e,t,i):null},r.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},r.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},r.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},r.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(t,i,r){e.push(t)}),e}return this._geometry.getVerticesDataKinds()},r.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},r.prototype.getIndices=function(e){return this._geometry?this._geometry.getIndices(e):[]},Object.defineProperty(r.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),r.prototype.isReady=function(){return this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&i.prototype.isReady.call(this)},Object.defineProperty(r.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),r.prototype.freezeNormals=function(){return this._areNormalsFrozen=!0,this},r.prototype.unfreezeNormals=function(){return this._areNormalsFrozen=!1,this},Object.defineProperty(r.prototype,"overridenInstanceCount",{set:function(e){this._overridenInstanceCount=e},enumerable:!0,configurable:!0}),r.prototype._preActivate=function(){var e=this.getScene().getRenderId();return this._preActivateId===e?this:(this._preActivateId=e,this._visibleInstances=null,this)},r.prototype._preActivateForIntermediateRendering=function(e){return this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=e),this},r.prototype._registerInstanceForRenderId=function(e,t){return this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e),this},r.prototype.refreshBoundingInfo=function(){return this._refreshBoundingInfo(!1)},r.prototype._refreshBoundingInfo=function(t){if(this._boundingInfo&&this._boundingInfo.isLocked)return this;var i=this._getPositionData(t);if(i){var r=e.Tools.ExtractMinAndMax(i,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(r.minimum,r.maximum)}if(this.subMeshes)for(var n=0;n<this.subMeshes.length;n++)this.subMeshes[n].refreshBoundingInfo();return this._updateBoundingInfo(),this},r.prototype._getPositionData=function(t){var i=this.getVerticesData(e.VertexBuffer.PositionKind);if(i&&t&&this.skeleton){i=i.slice();var r=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),n=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);if(n&&r)for(var o=this.numBoneInfluencers>4,s=o?this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind):null,a=o?this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind):null,l=this.skeleton.getTransformMatrices(this),h=e.Tmp.Vector3[0],c=e.Tmp.Matrix[0],u=e.Tmp.Matrix[1],f=0,d=0;d<i.length;d+=3,f+=4){c.reset();var p,m;for(p=0;p<4&&!((m=n[f+p])<=0);p++)e.Matrix.FromFloat32ArrayToRefScaled(l,16*r[f+p],m,u),c.addToSelf(u);if(o)for(p=0;p<4&&!((m=a[f+p])<=0);p++)e.Matrix.FromFloat32ArrayToRefScaled(l,16*s[f+p],m,u),c.addToSelf(u);e.Vector3.TransformCoordinatesFromFloatsToRef(i[d],i[d+1],i[d+2],c,h),h.toArray(i,d)}}return i},r.prototype._createGlobalSubMesh=function(t){var i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var n=r.length,o=!1;if(t)o=!0;else for(var s=0,a=this.subMeshes;s<a.length;s++){var l=a[s];if(l.indexStart+l.indexCount>=n){o=!0;break}if(l.verticesStart+l.verticesCount>=i){o=!0;break}}if(!o)return this.subMeshes[0]}return this.releaseSubMeshes(),new e.SubMesh(0,0,i,0,this.getTotalIndices(),this)},r.prototype.subdivide=function(t){if(!(t<1)){for(var i=this.getTotalIndices(),r=i/t|0,n=0;r%3!=0;)r++;this.releaseSubMeshes();for(var o=0;o<t&&!(n>=i);o++)e.SubMesh.CreateFromIndices(0,n,Math.min(r,i-n),this),n+=r;this.synchronizeInstances()}},r.prototype.setVerticesData=function(t,i,r,n){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(t,i,r,n);else{var o=new e.VertexData;o.set(i,t);var s=this.getScene();new e.Geometry(e.Geometry.RandomId(),s,o,r,this)}return this},r.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var i=this.getVertexBuffer(e);i&&i.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},r.prototype.setVerticesBuffer=function(t){return this._geometry||(this._geometry=e.Geometry.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t),this},r.prototype.updateVerticesData=function(e,t,i,r){return this._geometry?(r?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i),this):this},r.prototype.updateMeshPositions=function(t,i){void 0===i&&(i=!0);var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(!r)return this;if(t(r),this.updateVerticesData(e.VertexBuffer.PositionKind,r,!1,!1),i){var n=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.NormalKind);if(!o)return this;e.VertexData.ComputeNormals(r,n,o),this.updateVerticesData(e.VertexBuffer.NormalKind,o,!1,!1)}return this},r.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;var t=this._geometry,i=this._geometry.copy(e.Geometry.RandomId());return t.releaseForMesh(this,!0),i.applyToMesh(this),this},r.prototype.setIndices=function(t,i,r){if(void 0===i&&(i=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(t,i,r);else{var n=new e.VertexData;n.indices=t;var o=this.getScene();new e.Geometry(e.Geometry.RandomId(),o,n,r,this)}return this},r.prototype.updateIndices=function(e,t){return this._geometry?(this._geometry.updateIndices(e,t),this):this},r.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},r.prototype._bind=function(t,i,r){if(!this._geometry)return this;var n,o=this.getScene().getEngine();if(this._unIndexed)n=null;else switch(r){case e.Material.PointFillMode:n=null;break;case e.Material.WireFrameFillMode:n=t.getLinesIndexBuffer(this.getIndices(),o);break;default:case e.Material.TriangleFillMode:n=this._unIndexed?null:this._geometry.getIndexBuffer()}return this._geometry._bind(i,n),this},r.prototype._draw=function(t,i,r,n){if(void 0===n&&(n=!1),!this._geometry||!this._geometry.getVertexBuffers()||!this._geometry.getIndexBuffer())return this;this.onBeforeDrawObservable.notifyObservers(this);var o=this.getScene(),s=o.getEngine();switch(i){case e.Material.PointFillMode:s.drawPointClouds(t.verticesStart,t.verticesCount,r);break;case e.Material.WireFrameFillMode:this._unIndexed?s.drawUnIndexed(!1,t.verticesStart,t.verticesCount,r):s.draw(!1,0,t.linesIndexCount,r);break;default:this._unIndexed?s.drawUnIndexed(!0,t.verticesStart,t.verticesCount,r):s.draw(!0,t.indexStart,t.indexCount,r)}if(o._isAlternateRenderingEnabled&&!n){var a=t.effect||this._effectiveMaterial.getEffect();if(!a||!o.activeCamera)return this;o._switchToAlternateCameraConfiguration(!0),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a),s.setViewport(o.activeCamera._alternateCamera.viewport),this._draw(t,i,r,!0),s.setViewport(o.activeCamera.viewport),o._switchToAlternateCameraConfiguration(!1),this._effectiveMaterial.bindView(a),this._effectiveMaterial.bindViewProjection(a)}return this},r.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},r.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},r.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},r.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},r.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var i=t.getRenderId(),r=t._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[e]=this._visibleInstances[i];var n=this._renderId;!this._batchCache.visibleInstances[e]&&r&&(this._batchCache.visibleInstances[e]=this._visibleInstances[r],i=Math.max(r,i),n=Math.max(this._visibleInstances.selfDefaultRenderId,i));var o=this._batchCache.visibleInstances[e];if(o&&o.length){if(this._renderIdForInstances[e]===i)return this._batchCache.mustReturn=!0,this._batchCache;i!==n&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},r.prototype._renderWithInstances=function(t,i,r,n,o){var s=r.visibleInstances[t._id];if(!s)return this;for(var a=s.length+1,l=16*a*4,h=this._instancesBufferSize,c=this._instancesBuffer;this._instancesBufferSize<l;)this._instancesBufferSize*=2;this._instancesData&&h==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var u=0,f=0,d=this.getWorldMatrix();if(r.renderSelf[t._id]&&(d.copyToArray(this._instancesData,u),u+=16,f++),s)for(var p=0;p<s.length;p++){var m=s[p];m.getWorldMatrix().copyToArray(this._instancesData,u),u+=16,f++}return c&&h==this._instancesBufferSize?c.updateDirectly(this._instancesData,0,f):(c&&c.dispose(),c=new e.Buffer(o,this._instancesData,!0,16,!1,!0),this._instancesBuffer=c,this.setVerticesBuffer(c.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(c.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(c.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(c.createVertexBuffer("world3",12,4))),this._bind(t,n,i),this._draw(t,i,f),o.unbindInstanceAttributes(),this},r.prototype._processRendering=function(e,t,i,r,n,o,s){var a=this.getScene(),l=a.getEngine();if(n)this._renderWithInstances(e,i,r,t,l);else{r.renderSelf[e._id]&&(o&&o(!1,this.getWorldMatrix(),s),this._draw(e,i,this._overridenInstanceCount));var h=r.visibleInstances[e._id];if(h)for(var c=0;c<h.length;c++){var u=h[c],f=u.getWorldMatrix();o&&o(!0,f,s),this._draw(e,i)}}return this},r.prototype.render=function(t,i){if(this.checkOcclusionQuery(),this._isOccluded)return this;var r=this.getScene(),n=this._getInstancesRenderList(t._id);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._geometry.getIndexBuffer())return this;this.onBeforeRenderObservable.notifyObservers(this);var o=r.getEngine(),s=o.getCaps().instancedArrays&&null!==n.visibleInstances[t._id]&&void 0!==n.visibleInstances[t._id],a=t.getMaterial();if(!a)return this;if(this._effectiveMaterial=a,this._effectiveMaterial.storeEffectOnSubMeshes){if(!this._effectiveMaterial.isReadyForSubMesh(this,t,s))return this}else if(!this._effectiveMaterial.isReady(this,s))return this;i&&o.setAlphaMode(this._effectiveMaterial.alphaMode);var l=o.getDepthWrite();this.renderOutline&&(o.setDepthWrite(!1),r.getOutlineRenderer().render(t,n),o.setDepthWrite(l));var h;if(!(h=this._effectiveMaterial.storeEffectOnSubMeshes?t.effect:this._effectiveMaterial.getEffect()))return this;var c=this._effectiveMaterial._preBind(h,this.overrideMaterialSideOrientation);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var u=r.forcePointsCloud?e.Material.PointFillMode:r.forceWireframe?e.Material.WireFrameFillMode:this._effectiveMaterial.fillMode;s||this._bind(t,h,u);var f=this.getWorldMatrix();if(this._effectiveMaterial.storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(f,this,t):this._effectiveMaterial.bind(f,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!c),this._processRendering(t,h,u,n,s,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,c)),this._processRendering(t,h,u,n,s,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind(),this.renderOutline&&l&&(o.setDepthWrite(!0),o.setColorWrite(!1),r.getOutlineRenderer().render(t,n),o.setColorWrite(!0)),this.renderOverlay){var d=o.getAlphaMode();o.setAlphaMode(e.Engine.ALPHA_COMBINE),r.getOutlineRenderer().render(t,n,!0),o.setAlphaMode(d)}return this.onAfterRenderObservable.notifyObservers(this),this},r.prototype._onBeforeDraw=function(e,t,i){e&&i&&i.bindOnlyWorldMatrix(t)},r.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[t];i.emitter===this&&e.push(i)}return e},r.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var r=this.getScene().particleSystems[i],n=r.emitter;n.position&&-1!==t.indexOf(n)&&e.push(r)}return e},r.prototype._checkDelayState=function(){var t=this.getScene();return this._geometry?this._geometry.load(t):this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(t)),this},r.prototype._queueLoad=function(t){var i=this;t._addPendingData(this);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return e.Tools.LoadFile(this.delayLoadingFile,function(r){r instanceof ArrayBuffer?i._delayLoadingFunction(r,i):i._delayLoadingFunction(JSON.parse(r),i),i.instances.forEach(function(e){e._syncSubMeshes()}),i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,t._removePendingData(i)},function(){},t.database,r),this},r.prototype.isInFrustum=function(t){return this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&(!!i.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},r.prototype.setMaterialByID=function(e){var t,i=this.getScene().materials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;var r=this.getScene().multiMaterials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;return this},r.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},r.prototype.bakeTransformIntoVertices=function(t){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,n=this.getVerticesData(e.VertexBuffer.PositionKind),o=new Array;for(r=0;r<n.length;r+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(n,r),t).toArray(o,r);if(this.setVerticesData(e.VertexBuffer.PositionKind,o,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))return this;for(n=this.getVerticesData(e.VertexBuffer.NormalKind),o=[],r=0;r<n.length;r+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(n,r),t).normalize().toArray(o,r);return this.setVerticesData(e.VertexBuffer.NormalKind,o,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()),t.m[0]*t.m[5]*t.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this},r.prototype.bakeCurrentTransformIntoVertices=function(){return this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=e.Quaternion.Identity()),this._worldMatrix=e.Matrix.Identity(),this},Object.defineProperty(r.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!0,configurable:!0}),r.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},r.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},r.prototype.clone=function(e,t,i,n){return void 0===n&&(n=!0),new r(e,this.getScene(),t,this,i,n)},r.prototype.dispose=function(e,t){var r=this;void 0===t&&(t=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var n=this.getScene().meshes;for(n.forEach(function(e){var t=e;t._source&&t._source===r&&(t._source=null)}),this._source=null,this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var o=this.getScene().highlightLayers,s=0;s<o.length;s++){var a=o[s];a&&(a.removeMesh(this),a.removeExcludedMesh(this))}i.prototype.dispose.call(this,e,t)},r.prototype.applyDisplacementMap=function(t,i,r,n,o,s){var a=this,l=this.getScene(),h=function(e){var t=document.createElement("canvas"),l=t.getContext("2d"),h=e.width,c=e.height;t.width=h,t.height=c,l.drawImage(e,0,0);var u=l.getImageData(0,0,h,c).data;a.applyDisplacementMapFromBuffer(u,h,c,i,r,o,s),n&&n(a)};return e.Tools.LoadImage(t,h,function(){},l.database),this},r.prototype.applyDisplacementMapFromBuffer=function(t,i,r,n,o,s,a){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var l=this.getVerticesData(e.VertexBuffer.PositionKind),h=this.getVerticesData(e.VertexBuffer.NormalKind),c=this.getVerticesData(e.VertexBuffer.UVKind),u=e.Vector3.Zero(),f=e.Vector3.Zero(),d=e.Vector2.Zero();s=s||e.Vector2.Zero(),a=a||new e.Vector2(1,1);for(var p=0;p<l.length;p+=3){e.Vector3.FromArrayToRef(l,p,u),e.Vector3.FromArrayToRef(h,p,f),e.Vector2.FromArrayToRef(c,p/3*2,d);var m=Math.abs(d.x*a.x+s.x)*i%i|0,g=Math.abs(d.y*a.y+s.y)*r%r|0,v=4*(m+g*i),y=t[v]/255,_=t[v+1]/255,b=t[v+2]/255,x=.3*y+.59*_+.11*b;f.normalize(),f.scaleInPlace(n+(o-n)*x),u=u.add(f),u.toArray(l,p)}return e.VertexData.ComputeNormals(l,this.getIndices(),h),this.updateVerticesData(e.VertexBuffer.PositionKind,l),this.updateVerticesData(e.VertexBuffer.NormalKind,h),this},r.prototype.convertToFlatShadedMesh=function(){var t,i,r=this.getVerticesDataKinds(),n={},o={},s={},a=!1;for(t=0;t<r.length;t++){i=r[t];var l=this.getVertexBuffer(i);i!==e.VertexBuffer.NormalKind?(n[i]=l,o[i]=n[i].getData(),s[i]=[]):(a=l.isUpdatable(),r.splice(t,1),t--)}var h,c=this.subMeshes.slice(0),u=this.getIndices(),f=this.getTotalIndices();for(h=0;h<f;h++){var d=u[h];for(t=0;t<r.length;t++){i=r[t];for(var p=n[i].getStrideSize(),m=0;m<p;m++)s[i].push(o[i][d*p+m])}}var g=[],v=s[e.VertexBuffer.PositionKind];for(h=0;h<f;h+=3){u[h]=h,u[h+1]=h+1,u[h+2]=h+2;for(var y=e.Vector3.FromArray(v,3*h),_=e.Vector3.FromArray(v,3*(h+1)),b=e.Vector3.FromArray(v,3*(h+2)),x=y.subtract(_),T=b.subtract(_),E=e.Vector3.Normalize(e.Vector3.Cross(x,T)),S=0;S<3;S++)g.push(E.x),g.push(E.y),g.push(E.z)}for(this.setIndices(u),this.setVerticesData(e.VertexBuffer.NormalKind,g,a),t=0;t<r.length;t++)i=r[t],this.setVerticesData(i,s[i],n[i].isUpdatable());this.releaseSubMeshes();for(var w=0;w<c.length;w++){var M=c[w];e.SubMesh.AddToMesh(M.materialIndex,M.indexStart,M.indexCount,M.indexStart,M.indexCount,this)}return this.synchronizeInstances(),this},r.prototype.convertToUnIndexedMesh=function(){var t,i,r=this.getVerticesDataKinds(),n={},o={},s={};for(t=0;t<r.length;t++){i=r[t];var a=this.getVertexBuffer(i);n[i]=a,o[i]=n[i].getData(),s[i]=[]}var l,h=this.subMeshes.slice(0),c=this.getIndices(),u=this.getTotalIndices();for(l=0;l<u;l++){var f=c[l];for(t=0;t<r.length;t++){i=r[t];for(var d=n[i].getStrideSize(),p=0;p<d;p++)s[i].push(o[i][f*d+p])}}for(l=0;l<u;l+=3)c[l]=l,c[l+1]=l+1,c[l+2]=l+2;for(this.setIndices(c),t=0;t<r.length;t++)i=r[t],this.setVerticesData(i,s[i],n[i].isUpdatable());this.releaseSubMeshes();for(var m=0;m<h.length;m++){var g=h[m];e.SubMesh.AddToMesh(g.materialIndex,g.indexStart,g.indexCount,g.indexStart,g.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},r.prototype.flipFaces=function(t){void 0===t&&(t=!1);var i,r=e.VertexData.ExtractFromMesh(this);if(t&&this.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&r.normals)for(i=0;i<r.normals.length;i++)r.normals[i]*=-1;if(r.indices){var n;for(i=0;i<r.indices.length;i+=3)n=r.indices[i+1],r.indices[i+1]=r.indices[i+2],r.indices[i+2]=n}return r.applyToMesh(this),this},r.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},r.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},r.prototype.simplify=function(t,i,r,n){return void 0===i&&(i=!0),void 0===r&&(r=e.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:i,mesh:this,simplificationType:r,successCallback:n}),this},r.prototype.optimizeIndices=function(t){var i=this,r=this.getIndices(),n=this.getVerticesData(e.VertexBuffer.PositionKind);if(!n||!r)return this;for(var o=new Array,s=0;s<n.length;s+=3)o.push(e.Vector3.FromArray(n,s));var a=new Array;return e.AsyncLoop.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],r=0;r<t;++r){var n=o[r];if(i.equals(n)){a[t]=r;break}}},function(){for(var e=0;e<r.length;++e)r[e]=a[r[e]]||r[e];var n=i.subMeshes.slice(0);i.setIndices(r),i.subMeshes=n,t&&t(i)}),this},r.prototype.serialize=function(t){t.name=this.name,t.id=this.id,t.type=this.getClassName(),e.Tags&&e.Tags.HasTags(this)&&(t.tags=e.Tags.GetTags(this)),t.position=this.position.asArray(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(t.rotation=this.rotation.asArray()),t.scaling=this.scaling.asArray(),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.isPickable,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.checkCollisions=this.checkCollisions,t.isBlocker=this.isBlocker,this.parent&&(t.parentId=this.parent.id);var i=this._geometry;if(i){var r=i.id;t.geometryId=r,t.subMeshes=[];for(var n=0;n<this.subMeshes.length;n++){var o=this.subMeshes[n];t.subMeshes.push({materialIndex:o.materialIndex,verticesStart:o.verticesStart,verticesCount:o.verticesCount,indexStart:o.indexStart,indexCount:o.indexCount})}}this.material?t.materialId=this.material.id:this.material=null,this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id);var s=this.getPhysicsImpostor();s&&(t.physicsMass=s.getParam("mass"),t.physicsFriction=s.getParam("friction"),t.physicsRestitution=s.getParam("mass"),t.physicsImpostor=s.type),this.metadata&&(t.metadata=this.metadata),t.instances=[];for(var a=0;a<this.instances.length;a++){var l=this.instances[a],h={name:l.name,id:l.id,position:l.position.asArray(),scaling:l.scaling.asArray()};l.rotationQuaternion?h.rotationQuaternion=l.rotationQuaternion.asArray():l.rotation&&(h.rotation=l.rotation.asArray()),t.instances.push(h),e.Animation.AppendSerializedAnimations(l,h),h.ranges=l.serializeAnimationRanges()}e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.asArray(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name))},r.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var t=this._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices())return e.Tools.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);for(var i=0;i<t.numInfluencers;i++){var r=t.getActiveTarget(i),n=r.getPositions();if(!n)return void e.Tools.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(e.VertexBuffer.PositionKind+i,n,!1,3);var o=r.getNormals();o&&this.geometry.setVerticesData(e.VertexBuffer.NormalKind+i,o,!1,3);var s=r.getTangents();s&&this.geometry.setVerticesData(e.VertexBuffer.TangentKind+i,s,!1,3)}}else for(var i=0;this.geometry.isVerticesDataPresent(e.VertexBuffer.PositionKind+i);)this.geometry.removeVerticesData(e.VertexBuffer.PositionKind+i),this.geometry.isVerticesDataPresent(e.VertexBuffer.NormalKind+i)&&this.geometry.removeVerticesData(e.VertexBuffer.NormalKind+i),this.geometry.isVerticesDataPresent(e.VertexBuffer.TangentKind+i)&&this.geometry.removeVerticesData(e.VertexBuffer.TangentKind+i),i++}},r.Parse=function(t,i,n){var o;if(o=t.type&&"GroundMesh"===t.type?e.GroundMesh.Parse(t,i):new r(t.name,i),o.id=t.id,e.Tags&&e.Tags.AddTagsTo(o,t.tags),o.position=e.Vector3.FromArray(t.position),void 0!==t.metadata&&(o.metadata=t.metadata),t.rotationQuaternion?o.rotationQuaternion=e.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(o.rotation=e.Vector3.FromArray(t.rotation)),o.scaling=e.Vector3.FromArray(t.scaling),t.localMatrix?o.setPivotMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),o.setEnabled(t.isEnabled),o.isVisible=t.isVisible,o.infiniteDistance=t.infiniteDistance,o.showBoundingBox=t.showBoundingBox,o.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(o.applyFog=t.applyFog),void 0!==t.pickable&&(o.isPickable=t.pickable),void 0!==t.alphaIndex&&(o.alphaIndex=t.alphaIndex),o.receiveShadows=t.receiveShadows,o.billboardMode=t.billboardMode,void 0!==t.visibility&&(o.visibility=t.visibility),o.checkCollisions=t.checkCollisions,void 0!==t.isBlocker&&(o.isBlocker=t.isBlocker),o._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(o._waitingFreezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.actions&&(o._waitingActions=t.actions),void 0!==t.overlayAlpha&&(o.overlayAlpha=t.overlayAlpha),void 0!==t.overlayColor&&(o.overlayColor=e.Color3.FromArray(t.overlayColor)),void 0!==t.renderOverlay&&(o.renderOverlay=t.renderOverlay),o.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(o.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=n+t.delayLoadingFile,o._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(o._binaryInfo=t._binaryInfo),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&o._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasUVs3&&o._delayInfo.push(e.VertexBuffer.UV3Kind),t.hasUVs4&&o._delayInfo.push(e.VertexBuffer.UV4Kind),t.hasUVs5&&o._delayInfo.push(e.VertexBuffer.UV5Kind),t.hasUVs6&&o._delayInfo.push(e.VertexBuffer.UV6Kind),t.hasColors&&o._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=e.Geometry.ImportGeometry,e.SceneLoader.ForceFullSceneLoadingForIncremental&&o._checkDelayState()):e.Geometry.ImportGeometry(t,o),t.materialId?o.setMaterialByID(t.materialId):o.material=null,t.morphTargetManagerId>-1&&(o.morphTargetManager=i.getMorphTargetManagerById(t.morphTargetManagerId)),t.skeletonId>-1&&(o.skeleton=i.getLastSkeletonByID(t.skeletonId),t.numBoneInfluencers&&(o.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(var s=0;s<t.animations.length;s++){var a=t.animations[s];o.animations.push(e.Animation.Parse(a))}e.Node.ParseAnimationRanges(o,t,i)}if(t.autoAnimate&&i.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?o.layerMask=Math.abs(parseInt(t.layerMask)):o.layerMask=268435455,t.physicsImpostor&&(o.physicsImpostor=new e.PhysicsImpostor(o,t.physicsImpostor,{mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution},i)),t.instances)for(var l=0;l<t.instances.length;l++){var h=t.instances[l],c=o.createInstance(h.name);if(h.id&&(c.id=h.id),e.Tags&&e.Tags.AddTagsTo(c,h.tags),c.position=e.Vector3.FromArray(h.position),h.parentId&&(c._waitingParentId=h.parentId),h.rotationQuaternion?c.rotationQuaternion=e.Quaternion.FromArray(h.rotationQuaternion):h.rotation&&(c.rotation=e.Vector3.FromArray(h.rotation)),c.scaling=e.Vector3.FromArray(h.scaling),c.checkCollisions=o.checkCollisions,t.animations){for(s=0;s<t.animations.length;s++)a=t.animations[s],c.animations.push(e.Animation.Parse(a));e.Node.ParseAnimationRanges(c,t,i)}}return o},r.CreateRibbon=function(t,i,r,n,o,s,a,l,h){return void 0===r&&(r=!1),void 0===a&&(a=!1),e.MeshBuilder.CreateRibbon(t,{pathArray:i,closeArray:r,closePath:n,offset:o,updatable:a,sideOrientation:l,instance:h},s)},r.CreateDisc=function(t,i,r,n,o,s){void 0===n&&(n=null);var a={radius:i,tessellation:r,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateDisc(t,a,n)},r.CreateBox=function(t,i,r,n,o){void 0===r&&(r=null);var s={size:i,sideOrientation:o,updatable:n};return e.MeshBuilder.CreateBox(t,s,r)},r.CreateSphere=function(t,i,r,n,o,s){var a={segments:i,diameterX:r,diameterY:r,diameterZ:r,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateSphere(t,a,n)},r.CreateCylinder=function(t,i,n,o,s,a,l,h,c){void 0!==l&&l instanceof e.Scene||(void 0!==l&&(c=h||r.DEFAULTSIDE,h=l),l=a,a=1);var u={height:i,diameterTop:n,diameterBottom:o,tessellation:s,subdivisions:a,sideOrientation:c,updatable:h};return e.MeshBuilder.CreateCylinder(t,u,l)},r.CreateTorus=function(t,i,r,n,o,s,a){var l={diameter:i,thickness:r,tessellation:n,sideOrientation:a,updatable:s};return e.MeshBuilder.CreateTorus(t,l,o)},r.CreateTorusKnot=function(t,i,r,n,o,s,a,l,h,c){var u={radius:i,tube:r,radialSegments:n,tubularSegments:o,p:s,q:a,sideOrientation:c,updatable:h};return e.MeshBuilder.CreateTorusKnot(t,u,l)},r.CreateLines=function(t,i,r,n,o){void 0===r&&(r=null),void 0===n&&(n=!1),void 0===o&&(o=null);var s={points:i,updatable:n,instance:o};return e.MeshBuilder.CreateLines(t,s,r)},r.CreateDashedLines=function(t,i,r,n,o,s,a,l){void 0===s&&(s=null);var h={points:i,dashSize:r,gapSize:n,dashNb:o,updatable:a,instance:l};return e.MeshBuilder.CreateDashedLines(t,h,s)},r.CreatePolygon=function(t,i,r,n,o,s){var a={shape:i,holes:n,updatable:o,sideOrientation:s};return e.MeshBuilder.CreatePolygon(t,a,r)},r.ExtrudePolygon=function(t,i,r,n,o,s,a){var l={shape:i,holes:o,depth:r,updatable:s,sideOrientation:a};return e.MeshBuilder.ExtrudePolygon(t,l,n)},r.ExtrudeShape=function(t,i,n,o,s,a,l,h,c,u){void 0===l&&(l=null);var f={shape:i,path:n,scale:o,rotation:s,cap:0===a?0:a||r.NO_CAP,sideOrientation:c,instance:u,updatable:h};return e.MeshBuilder.ExtrudeShape(t,f,l)},r.ExtrudeShapeCustom=function(t,i,n,o,s,a,l,h,c,u,f,d){var p={shape:i,path:n,scaleFunction:o,rotationFunction:s,ribbonCloseArray:a,ribbonClosePath:l,cap:0===h?0:h||r.NO_CAP,sideOrientation:f,instance:d,updatable:u};return e.MeshBuilder.ExtrudeShapeCustom(t,p,c)},r.CreateLathe=function(t,i,r,n,o,s,a){var l={shape:i,radius:r,tessellation:n,sideOrientation:a,updatable:s};return e.MeshBuilder.CreateLathe(t,l,o)},r.CreatePlane=function(t,i,r,n,o){var s={size:i,width:i,height:i,sideOrientation:o,updatable:n};return e.MeshBuilder.CreatePlane(t,s,r)},r.CreateGround=function(t,i,r,n,o,s){var a={width:i,height:r,subdivisions:n,updatable:s};return e.MeshBuilder.CreateGround(t,a,o)},r.CreateTiledGround=function(t,i,r,n,o,s,a,l,h){var c={xmin:i,zmin:r,xmax:n,zmax:o,subdivisions:s,precision:a,updatable:h};return e.MeshBuilder.CreateTiledGround(t,c,l)},r.CreateGroundFromHeightMap=function(t,i,r,n,o,s,a,l,h,c){var u={width:r,height:n,subdivisions:o,minHeight:s,maxHeight:a,updatable:h,onReady:c};return e.MeshBuilder.CreateGroundFromHeightMap(t,i,u,l)},r.CreateTube=function(t,i,r,n,o,s,a,l,h,c){var u={path:i,radius:r,tessellation:n,radiusFunction:o,arc:1,cap:s,updatable:l,sideOrientation:h,instance:c};return e.MeshBuilder.CreateTube(t,u,a)},r.CreatePolyhedron=function(t,i,r){return e.MeshBuilder.CreatePolyhedron(t,i,r)},r.CreateIcoSphere=function(t,i,r){return e.MeshBuilder.CreateIcoSphere(t,i,r)},r.CreateDecal=function(t,i,r,n,o,s){var a={position:r,normal:n,size:o,angle:s};return e.MeshBuilder.CreateDecal(t,i,a)},r.prototype.setPositionsForCPUSkinning=function(){if(!this._sourcePositions){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this._sourcePositions;this._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind)||this.setVerticesData(e.VertexBuffer.PositionKind,t,!0)}return this._sourcePositions},r.prototype.setNormalsForCPUSkinning=function(){if(!this._sourceNormals){var t=this.getVerticesData(e.VertexBuffer.NormalKind);if(!t)return this._sourceNormals;this._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind)||this.setVerticesData(e.VertexBuffer.NormalKind,t,!0)}return this._sourceNormals},r.prototype.applySkeleton=function(t){if(!this.geometry)return this;if(this.geometry._softwareSkinningRenderId==this.getScene().getRenderId())return this;if(this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind))return this;if(!this._sourcePositions){var i=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=i}this._sourceNormals||this.setNormalsForCPUSkinning();var r=this.getVerticesData(e.VertexBuffer.PositionKind);if(!r)return this;r instanceof Float32Array||(r=new Float32Array(r));var n=this.getVerticesData(e.VertexBuffer.NormalKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var o=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind);if(!s||!o)return this;for(var a,l=this.numBoneInfluencers>4,h=l?this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind):null,c=l?this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind):null,u=t.getTransformMatrices(this),f=e.Vector3.Zero(),d=new e.Matrix,p=new e.Matrix,m=0,g=0;g<r.length;g+=3,m+=4){var v;for(a=0;a<4&&(v=s[m+a])>0;a++)e.Matrix.FromFloat32ArrayToRefScaled(u,16*o[m+a],v,p),d.addToSelf(p);if(l)for(a=0;a<4&&(v=c[m+a])>0;a++)e.Matrix.FromFloat32ArrayToRefScaled(u,16*h[m+a],v,p),d.addToSelf(p);e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[g],this._sourcePositions[g+1],this._sourcePositions[g+2],d,f),f.toArray(r,g),e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[g],this._sourceNormals[g+1],this._sourceNormals[g+2],d,f),f.toArray(n,g),d.reset()}return this.updateVerticesData(e.VertexBuffer.PositionKind,r),this.updateVerticesData(e.VertexBuffer.NormalKind,n),this},r.MinMax=function(t){var i=null,r=null;return t.forEach(function(e,t,n){var o=e.getBoundingInfo(),s=o.boundingBox;i&&r?(i.MinimizeInPlace(s.minimumWorld),r.MaximizeInPlace(s.maximumWorld)):(i=s.minimumWorld,r=s.maximumWorld)}),i&&r?{min:i,max:r}:{min:e.Vector3.Zero(),max:e.Vector3.Zero()}},r.Center=function(t){var i=t instanceof Array?e.Mesh.MinMax(t):t;return e.Vector3.Center(i.min,i.max)},r.MergeMeshes=function(t,i,n,o,s){void 0===i&&(i=!0);var a;if(!n){var l=0;for(a=0;a<t.length;a++)if(t[a]&&(l+=t[a].getTotalVertices())>65536)return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var h,c=null,u=new Array,f=null;for(a=0;a<t.length;a++)t[a]&&(t[a].computeWorldMatrix(!0),h=e.VertexData.ExtractFromMesh(t[a],!0),h.transform(t[a].getWorldMatrix()),c?c.merge(h):(c=h,f=t[a]),s&&u.push(t[a].getTotalIndices()));if(f=f,o||(o=new r(f.name+"_merged",f.getScene())),c.applyToMesh(o),o.material=f.material,o.checkCollisions=f.checkCollisions,i)for(a=0;a<t.length;a++)t[a]&&t[a].dispose();if(s){o.releaseSubMeshes(),a=0;for(var d=0;a<u.length;)e.SubMesh.CreateFromIndices(0,d,u[a],o),d+=u[a],a++}return o},r}(e.AbstractMesh);i._FRONTSIDE=0,i._BACKSIDE=1,i._DOUBLESIDE=2,i._DEFAULTSIDE=0,i._NO_CAP=0,i._CAP_START=1,i._CAP_END=2,i._CAP_ALL=3,e.Mesh=i}(r||(r={}));var r;!function(e){var t=function(){function e(){}return Object.defineProperty(e.prototype,"effect",{get:function(){return this._materialEffect},enumerable:!0,configurable:!0}),e.prototype.setEffect=function(e,t){if(void 0===t&&(t=null),this._materialEffect===e)return void(e||(this._materialDefines=null));this._materialDefines=t,this._materialEffect=e},e}();e.BaseSubMesh=t;var i=function(t){function i(e,i,r,n,o,s,a,l){void 0===l&&(l=!0);var h=t.call(this)||this;return h.materialIndex=e,h.verticesStart=i,h.verticesCount=r,h.indexStart=n,h.indexCount=o,h._renderId=0,h._mesh=s,h._renderingMesh=a||s,s.subMeshes.push(h),h._trianglePlanes=[],h._id=s.subMeshes.length-1,l&&(h.refreshBoundingInfo(),s.computeWorldMatrix(!0)),h}return o(i,t),i.AddToMesh=function(e,t,r,n,o,s,a,l){return void 0===l&&(l=!0),new i(e,t,r,n,o,s,a,l)},Object.defineProperty(i.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),i.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},i.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},i.prototype.getMesh=function(){return this._mesh},i.prototype.getRenderingMesh=function(){return this._renderingMesh},i.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(e&&e.getSubMaterial){var t=e,i=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this._materialDefines=null),i}return e||this._mesh.getScene().defaultMaterial},i.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;var t=this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var i,r=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===r.length){var n=this._renderingMesh.getBoundingInfo();i={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else i=e.Tools.ExtractMinAndMaxIndexed(t,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum),this},i.prototype._checkCollision=function(e){return this._renderingMesh.getBoundingInfo()._checkCollision(e)},i.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t.update(e),this},i.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},i.prototype.render=function(e){return this._renderingMesh.render(this,e),this},i.prototype.getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],r=this.indexStart;r<this.indexStart+this.indexCount;r+=3)i.push(e[r],e[r+1],e[r+1],e[r+2],e[r+2],e[r]);this._linesIndexBuffer=t.createIndexBuffer(i),this.linesIndexCount=i.length}return this._linesIndexBuffer},i.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},i.prototype.intersects=function(t,i,r,n){var o=null;if(e.LinesMesh&&this._mesh instanceof e.LinesMesh)for(var s=this._mesh,a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){var l=i[r[a]],h=i[r[a+1]],c=t.intersectionSegment(l,h,s.intersectionThreshold);if(!(c<0)&&((n||!o||c<o.distance)&&(o=new e.IntersectionInfo(null,null,c),n)))break}else for(var a=this.indexStart;a<this.indexStart+this.indexCount;a+=3){var l=i[r[a]],h=i[r[a+1]],u=i[r[a+2]],f=t.intersectsTriangle(l,h,u);if(f){if(f.distance<0)continue;if((n||!o||f.distance<o.distance)&&(o=f,o.faceId=a/3,n))break}}return o},i.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},i.prototype.clone=function(t,r){var n=new i(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,r,!1);if(!this.IsGlobal){var o=this.getBoundingInfo();if(!o)return n;n._boundingInfo=new e.BoundingInfo(o.minimum,o.maximum)}return n},i.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},i.CreateFromIndices=function(e,t,r,n,o){var s=Number.MAX_VALUE,a=-Number.MAX_VALUE;o=o||n;for(var l=o.getIndices(),h=t;h<t+r;h++){var c=l[h];c<s&&(s=c),c>a&&(a=c)}return new i(e,s,a-s+1,t,r,n,o)},i}(t);e.SubMesh=i}(r||(r={}));var r;!function(e){var t=function(){function t(){this._defines={},this._currentRank=32,this._maxRank=-1}return t.prototype.unBindMesh=function(){this._mesh=null},t.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},t.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(t.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),t.prototype.reduce=function(t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),e.Tools.Log("Falling back to CPU skinning for "+this._mesh.name);for(var i=this._mesh.getScene(),r=0;r<i.meshes.length;r++){var n=i.meshes[r];n.material===this._mesh.material&&n.computeBonesUsingShaders&&n.numBoneInfluencers>0&&(n.computeBonesUsingShaders=!1)}}else{var o=this._defines[this._currentRank];if(o)for(var r=0;r<o.length;r++)t=t.replace("#define "+o[r],"");this._currentRank++}return t},t}();e.EffectFallbacks=t;var i=function(){function e(){}return e}();e.EffectCreationOptions=i;var r=function(){function t(i,r,n,o,s,a,l,h,c,u){void 0===o&&(o=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=null),void 0===c&&(c=null);var f=this;if(this.uniqueId=0,this.onCompileObservable=new e.Observable,this.onErrorObservable=new e.Observable,this.onBindObservable=new e.Observable,this._uniformBuffersNames={},this._isReady=!1,this._compilationError="",this.name=i,r.attributes){var d=r;if(this._engine=n,this._attributesNames=d.attributes,this._uniformsNames=d.uniformsNames.concat(d.samplers),this._samplers=d.samplers,this.defines=d.defines,this.onError=d.onError,this.onCompiled=d.onCompiled,this._fallbacks=d.fallbacks,this._indexParameters=d.indexParameters,this._transformFeedbackVaryings=d.transformFeedbackVaryings,d.uniformBuffersNames)for(var p=0;p<d.uniformBuffersNames.length;p++)this._uniformBuffersNames[d.uniformBuffersNames[p]]=p}else this._engine=s,this.defines=a,this._uniformsNames=n.concat(o),this._samplers=o,this._attributesNames=r,this.onError=c,this.onCompiled=h,this._indexParameters=u,this._fallbacks=l;this.uniqueId=t._uniqueIdSeed++;var m,g;i.vertexElement?(m=document.getElementById(i.vertexElement))||(m=i.vertexElement):m=i.vertex||i,i.fragmentElement?(g=document.getElementById(i.fragmentElement))||(g=i.fragmentElement):g=i.fragment||i,this._loadVertexShader(m,function(e){f._processIncludes(e,function(e){f._processShaderConversion(e,!1,function(e){f._loadFragmentShader(g,function(t){f._processIncludes(t,function(t){f._processShaderConversion(t,!0,function(t){if(i){var r=i.vertexElement||i.vertex||i,n=i.fragmentElement||i.fragment||i;f._vertexSourceCode="#define SHADER_NAME vertex:"+r+"\n"+e,f._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else f._vertexSourceCode=e,f._fragmentSourceCode=t;f._prepareEffect()})})})})})})}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),t.prototype.isReady=function(){return this._isReady},t.prototype.getEngine=function(){return this._engine},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(e){return this._attributes[e]},t.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},t.prototype.getUniform=function(e){return this._uniforms[this._uniformsNames.indexOf(e)]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype.executeWhenCompiled=function(e){if(this.isReady())return void e(this);this.onCompileObservable.add(function(t){e(t)})},t.prototype._loadVertexShader=function(i,r){if(e.Tools.IsWindowObjectExist()&&i instanceof HTMLElement){return void r(e.Tools.GetDOMTextContent(i))}if("base64:"===i.substr(0,7)){return void r(window.atob(i.substr(7)))}if(t.ShadersStore[i+"VertexShader"])return void r(t.ShadersStore[i+"VertexShader"]);var n;n="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,e.Tools.LoadFile(n+".vertex.fx",r)},t.prototype._loadFragmentShader=function(i,r){if(e.Tools.IsWindowObjectExist()&&i instanceof HTMLElement){return void r(e.Tools.GetDOMTextContent(i))}if("base64:"===i.substr(0,7)){return void r(window.atob(i.substr(7)))}if(t.ShadersStore[i+"PixelShader"])return void r(t.ShadersStore[i+"PixelShader"]);if(t.ShadersStore[i+"FragmentShader"])return void r(t.ShadersStore[i+"FragmentShader"]);var n;n="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,e.Tools.LoadFile(n+".fragment.fx",r)},t.prototype._dumpShadersSource=function(t,i,r){var n=this._engine.webGLVersion>1?"#version 300 es\n":"",o=n+(r?r+"\n":"");t=o+t,i=o+i;var s=2,a=/\n/gm,l="\n1\t"+t.replace(a,function(){return"\n"+s+++"\t"});s=2;var h="\n1\t"+i.replace(a,function(){return"\n"+s+++"\t"});this.name.vertexElement?(e.Tools.Error("Vertex shader: "+this.name.vertexElement+l),e.Tools.Error("Fragment shader: "+this.name.fragmentElement+h)):this.name.vertex?(e.Tools.Error("Vertex shader: "+this.name.vertex+l),e.Tools.Error("Fragment shader: "+this.name.fragment+h)):(e.Tools.Error("Vertex shader: "+this.name+l),e.Tools.Error("Fragment shader: "+this.name+h))},t.prototype._processShaderConversion=function(e,t,i){var r=this._processPrecision(e);if(1==this._engine.webGLVersion)return void i(r);if(-1!==r.indexOf("#version 3"))return void i(r.replace("#version 300 es",""));var n=-1!==r.search(/#extension.+GL_EXT_draw_buffers.+require/),o=/#extension.+(GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,s=r.replace(o,"");s=s.replace(/varying(?![\n\r])\s/g,t?"in ":"out "),s=s.replace(/attribute[ \t]/g,"in "),s=s.replace(/[ \t]attribute/g," in"),t&&(s=s.replace(/texture2DLodEXT\s*\(/g,"textureLod("),s=s.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),s=s.replace(/texture2D\s*\(/g,"texture("),s=s.replace(/textureCube\s*\(/g,"texture("),s=s.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),s=s.replace(/gl_FragColor/g,"glFragColor"),s=s.replace(/gl_FragData/g,"glFragData"),s=s.replace(/void\s+?main\s*\(/g,(n?"":"out vec4 glFragColor;\n")+"void main(")),i(s)},t.prototype._processIncludes=function(i,r){for(var n=this,o=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=o.exec(i),a=new String(i);null!=s;){var l=s[1];if(-1!==l.indexOf("__decl__")&&(l=l.replace(/__decl__/,""),this._engine.supportsUniformBuffers&&(l=l.replace(/Vertex/,"Ubo"),l=l.replace(/Fragment/,"Ubo")),l+="Declaration"),!t.IncludesShadersStore[l]){var h=e.Engine.ShadersRepository+"ShadersInclude/"+l+".fx";return void e.Tools.LoadFile(h,function(e){t.IncludesShadersStore[l]=e,n._processIncludes(a,r)})}var c=t.IncludesShadersStore[l];if(s[2])for(var u=s[3].split(","),f=0;f<u.length;f+=2){var d=new RegExp(u[f],"g"),p=u[f+1];c=c.replace(d,p)}if(s[4]){var m=s[5];if(-1!==m.indexOf("..")){var g=m.split(".."),v=parseInt(g[0]),y=parseInt(g[1]),_=c.slice(0);c="",isNaN(y)&&(y=this._indexParameters[g[1]]);for(var b=v;b<y;b++)this._engine.supportsUniformBuffers||(_=_.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),c+=_.replace(/\{X\}/g,b.toString())+"\n"}else this._engine.supportsUniformBuffers||(c=c.replace(/light\{X\}.(\w*)/g,function(e,t){return t+"{X}"})),c=c.replace(/\{X\}/g,m)}a=a.replace(s[0],c),s=o.exec(i)}r(a)},t.prototype._processPrecision=function(e){return-1===e.indexOf("precision highp float")?e=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+e:"precision mediump float;\n"+e:this._engine.getCaps().highPrecisionShaderSupported||(e=e.replace("precision highp float","precision mediump float")),e},t.prototype._rebuildProgram=function(t,i,r,n){var o=this;this._isReady=!1,this._vertexSourceCodeOverride=t,this._fragmentSourceCodeOverride=i,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){for(var t=o.getEngine().scenes,i=0;i<t.length;i++)t[i].markAllMaterialsAsDirty(e.Material.TextureDirtyFlag);r&&r(o._program)},this._fallbacks=null,this._prepareEffect()},t.prototype._prepareEffect=function(){var t=this._attributesNames,i=this.defines,r=this._fallbacks;this._valueCache={};var n=this._program;try{var o=this._engine;if(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._program=o.createRawShaderProgram(this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,void 0,this._transformFeedbackVaryings):this._program=o.createShaderProgram(this._vertexSourceCode,this._fragmentSourceCode,i,void 0,this._transformFeedbackVaryings),this._program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this),o.supportsUniformBuffers)for(var s in this._uniformBuffersNames)this.bindUniformBlock(s,this._uniformBuffersNames[s]);this._uniforms=o.getUniforms(this._program,this._uniformsNames),this._attributes=o.getAttributes(this._program,t);var a;for(a=0;a<this._samplers.length;a++){null==this.getUniform(this._samplers[a])&&(this._samplers.splice(a,1),a--)}o.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),n&&this.getEngine()._deleteProgram(n)}catch(o){this._compilationError=o.message,e.Tools.Error("Unable to compile effect:"),e.Tools.Error("Uniforms: "+this._uniformsNames.map(function(e){return" "+e})),e.Tools.Error("Attributes: "+t.map(function(e){return" "+e})),this._dumpShadersSource(this._vertexSourceCode,this._fragmentSourceCode,i),e.Tools.Error("Error: "+this._compilationError),n&&(this._program=n,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),r&&r.isMoreFallbacks?(e.Tools.Error("Trying next fallback."),this.defines=r.reduce(this.defines),this._prepareEffect()):(this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())}},Object.defineProperty(t.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),t.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},t.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),this.getUniform(e),t)},t.prototype.setTextureArray=function(e,t){if(-1===this._samplers.indexOf(e+"Ex"))for(var i=this._samplers.indexOf(e),r=1;r<t.length;r++)this._samplers.splice(i+r,0,e+"Ex");this._engine.setTextureArray(this._samplers.indexOf(e),this.getUniform(e),t)},t.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},t.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],r=t.updateFlag;return(void 0===i||i!==r)&&(this._valueCache[e]=r,!0)},t.prototype._cacheFloat2=function(e,t,i){var r=this._valueCache[e];if(!r)return r=[t,i],this._valueCache[e]=r,!0;var n=!1;return r[0]!==t&&(r[0]=t,n=!0),r[1]!==i&&(r[1]=i,n=!0),n},t.prototype._cacheFloat3=function(e,t,i,r){var n=this._valueCache[e];if(!n)return n=[t,i,r],this._valueCache[e]=n,!0;var o=!1;return n[0]!==t&&(n[0]=t,o=!0),n[1]!==i&&(n[1]=i,o=!0),n[2]!==r&&(n[2]=r,o=!0),o},t.prototype._cacheFloat4=function(e,t,i,r,n){var o=this._valueCache[e];if(!o)return o=[t,i,r,n],this._valueCache[e]=o,!0;var s=!1;return o[0]!==t&&(o[0]=t,s=!0),o[1]!==i&&(o[1]=i,s=!0),o[2]!==r&&(o[2]=r,s=!0),o[3]!==n&&(o[3]=n,s=!0),s},t.prototype.bindUniformBuffer=function(e,i){var r=this._uniformBuffersNames[i];t._baseCache[r]!==e&&(t._baseCache[r]=e,this._engine.bindUniformBufferBase(e,r))},t.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._program,e,t)},t.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this.getUniform(e),t),this},t.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this.getUniform(e),t),this},t.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this.getUniform(e),t),this},t.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this.getUniform(e),t),this},t.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray(this.getUniform(e),t),this},t.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray2(this.getUniform(e),t),this},t.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray3(this.getUniform(e),t),this},t.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setFloatArray4(this.getUniform(e),t),this},t.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this.getUniform(e),t),this},t.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this.getUniform(e),t),this},t.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this.getUniform(e),t),this},t.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this.getUniform(e),t),this},t.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this.getUniform(e),t),this):this},t.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrix(this.getUniform(e),t),this},t.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this.getUniform(e),t),this},t.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this.getUniform(e),t),this},t.prototype.setFloat=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t?this:(this._valueCache[e]=t,this._engine.setFloat(this.getUniform(e),t),this)},t.prototype.setBool=function(e,t){var i=this._valueCache[e];return void 0!==i&&i===t?this:(this._valueCache[e]=t,this._engine.setBool(this.getUniform(e),t?1:0),this)},t.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this.getUniform(e),t.x,t.y),this},t.prototype.setFloat2=function(e,t,i){return this._cacheFloat2(e,t,i)&&this._engine.setFloat2(this.getUniform(e),t,i),this},t.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this},t.prototype.setFloat3=function(e,t,i,r){return this._cacheFloat3(e,t,i,r)&&this._engine.setFloat3(this.getUniform(e),t,i,r),this},t.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this.getUniform(e),t.x,t.y,t.z,t.w),this},t.prototype.setFloat4=function(e,t,i,r,n){return this._cacheFloat4(e,t,i,r,n)&&this._engine.setFloat4(this.getUniform(e),t,i,r,n),this},t.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setColor3(this.getUniform(e),t),this},t.prototype.setColor4=function(e,t,i){return this._cacheFloat4(e,t.r,t.g,t.b,i)&&this._engine.setColor4(this.getUniform(e),t,i),this},t.ResetCache=function(){t._baseCache={}},t}();r._uniqueIdSeed=0,r._baseCache={},r.ShadersStore={},r.IncludesShadersStore={},e.Effect=r}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.BindEyePosition=function(e,t){if(t._forcedViewPosition)return void e.setVector3("vEyePosition",t._forcedViewPosition);e.setVector3("vEyePosition",t._mirroredCameraPosition?t._mirroredCameraPosition:t.activeCamera.globalPosition)},t.PrepareDefinesForMergedUV=function(e,t,i){t._needUVs=!0,t[i]=!0,e.getTextureMatrix().isIdentity(!0)?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,0===e.coordinatesIndex?t.MAINUV1=!0:t.MAINUV2=!0):t[i+"DIRECTUV"]=0},t.BindTextureMatrix=function(e,t,i){var r=e.getTextureMatrix();r.isIdentity(!0)||t.updateMatrix(i+"Matrix",r)},t.PrepareDefinesForMisc=function(t,i,r,n,o,s){s._areMiscDirty&&(s.LOGARITHMICDEPTH=r,s.POINTSIZE=n||i.forcePointsCloud,s.FOG=i.fogEnabled&&t.applyFog&&i.fogMode!==e.Scene.FOGMODE_NONE&&o,s.NONUNIFORMSCALING=t.nonUniformScaling)},t.PrepareDefinesForFrameBoundValues=function(e,t,i,r,n){void 0===n&&(n=!1);var o=!1;i.CLIPPLANE!==(void 0!==e.clipPlane&&null!==e.clipPlane)&&(i.CLIPPLANE=!i.CLIPPLANE,o=!0),i.ALPHATEST!==(t.getAlphaTesting()||n)&&(i.ALPHATEST=!i.ALPHATEST,o=!0),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,o=!0),i.INSTANCES!==r&&(i.INSTANCES=r,o=!0),o&&i.markAsUnprocessed()},t.PrepareDefinesForAttributes=function(t,i,r,n,o,s){if(void 0===o&&(o=!1),void 0===s&&(s=!0),!i._areAttributesDirty&&i._needNormals===i._normals&&i._needUVs===i._uvs)return!1;if(i._normals=i._needNormals,i._uvs=i._needUVs,i.NORMAL=i._needNormals&&t.isVerticesDataPresent(e.VertexBuffer.NormalKind),i._needNormals&&t.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&(i.TANGENT=!0),i._needUVs?(i.UV1=t.isVerticesDataPresent(e.VertexBuffer.UVKind),i.UV2=t.isVerticesDataPresent(e.VertexBuffer.UV2Kind)):(i.UV1=!1,i.UV2=!1),r){var a=t.useVertexColors&&t.isVerticesDataPresent(e.VertexBuffer.ColorKind);i.VERTEXCOLOR=a,i.VERTEXALPHA=t.hasVertexAlpha&&a&&s}if(n&&(t.useBones&&t.computeBonesUsingShaders&&t.skeleton?(i.NUM_BONE_INFLUENCERS=t.numBoneInfluencers,i.BonesPerMesh=t.skeleton.bones.length+1):(i.NUM_BONE_INFLUENCERS=0,i.BonesPerMesh=0)),o){var l=t.morphTargetManager;l?(i.MORPHTARGETS_TANGENT=l.supportsTangents&&i.TANGENT,i.MORPHTARGETS_NORMAL=l.supportsNormals&&i.NORMAL,i.MORPHTARGETS=l.numInfluencers>0,i.NUM_MORPH_INFLUENCERS=l.numInfluencers):(i.MORPHTARGETS_TANGENT=!1,i.MORPHTARGETS_NORMAL=!1,i.MORPHTARGETS=!1,i.NUM_MORPH_INFLUENCERS=0)}return!0},t.PrepareDefinesForLights=function(t,i,r,n,o,s){if(void 0===o&&(o=4),void 0===s&&(s=!1),!r._areLightsDirty)return r._needNormals;var a=0,l=!1,h=!1,c=!1,u=!1,f=!1;if(t.lightsEnabled&&!s)for(var d=0,p=i._lightSources;d<p.length;d++){var m=p[d];l=!0,void 0===r["LIGHT"+a]&&(h=!0),r["LIGHT"+a]=!0,r["SPOTLIGHT"+a]=!1,r["HEMILIGHT"+a]=!1,r["POINTLIGHT"+a]=!1,r["DIRLIGHT"+a]=!1;var g;if(g=m.getTypeID()===e.Light.LIGHTTYPEID_SPOTLIGHT?"SPOTLIGHT"+a:m.getTypeID()===e.Light.LIGHTTYPEID_HEMISPHERICLIGHT?"HEMILIGHT"+a:m.getTypeID()===e.Light.LIGHTTYPEID_POINTLIGHT?"POINTLIGHT"+a:"DIRLIGHT"+a,r[g]=!0,n&&!m.specular.equalsFloats(0,0,0)&&(f=!0),r["SHADOW"+a]=!1,r["SHADOWPCF"+a]=!1,r["SHADOWESM"+a]=!1,r["SHADOWCUBE"+a]=!1,i&&i.receiveShadows&&t.shadowsEnabled&&m.shadowEnabled){var v=m.getShadowGenerator();v&&(u=!0,v.prepareDefines(r,a))}if(m.lightmapMode!=e.Light.LIGHTMAP_DEFAULT?(c=!0,r["LIGHTMAPEXCLUDED"+a]=!0,r["LIGHTMAPNOSPECULAR"+a]=m.lightmapMode==e.Light.LIGHTMAP_SHADOWSONLY):(r["LIGHTMAPEXCLUDED"+a]=!1,r["LIGHTMAPNOSPECULAR"+a]=!1),++a===o)break}r.SPECULARTERM=f,r.SHADOWS=u;for(var y=a;y<o;y++)void 0!==r["LIGHT"+y]&&(r["LIGHT"+y]=!1,r["HEMILIGHT"+a]=!1,r["POINTLIGHT"+a]=!1,r["DIRLIGHT"+a]=!1,r["SPOTLIGHT"+a]=!1,r["SHADOW"+a]=!1);var _=t.getEngine().getCaps();return void 0===r.SHADOWFLOAT&&(h=!0),r.SHADOWFLOAT=u&&(_.textureFloatRender&&_.textureFloatLinearFiltering||_.textureHalfFloatRender&&_.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=c,h&&r.rebuild(),l},t.PrepareUniformsAndSamplersList=function(e,t,i,r){void 0===r&&(r=4);var n,o=null;if(e.uniformsNames){var s=e;n=s.uniformsNames,o=s.uniformBuffersNames,t=s.samplers,i=s.defines,r=s.maxSimultaneousLights}else n=e,t||(t=[]);for(var a=0;a<r&&i["LIGHT"+a];a++)n.push("vLightData"+a,"vLightDiffuse"+a,"vLightSpecular"+a,"vLightDirection"+a,"vLightGround"+a,"lightMatrix"+a,"shadowsInfo"+a,"depthValues"+a),o&&o.push("Light"+a),t.push("shadowSampler"+a);i.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences")},t.HandleFallbacksForShadows=function(e,t,i,r){void 0===i&&(i=4),void 0===r&&(r=0);for(var n=0,o=0;o<i&&e["LIGHT"+o];o++)o>0&&(n=r+o,t.addFallback(n,"LIGHT"+o)),e.SHADOWS||(e["SHADOW"+o]&&t.addFallback(r,"SHADOW"+o),e["SHADOWPCF"+o]&&t.addFallback(r,"SHADOWPCF"+o),e["SHADOWESM"+o]&&t.addFallback(r,"SHADOWESM"+o));return n++},t.PrepareAttributesForMorphTargets=function(t,i,r){var n=r.NUM_MORPH_INFLUENCERS;if(n>0&&e.Engine.LastCreatedEngine)for(var o=e.Engine.LastCreatedEngine.getCaps().maxVertexAttribs,s=i.morphTargetManager,a=s&&s.supportsNormals&&r.NORMAL,l=s&&s.supportsTangents&&r.TANGENT,h=0;h<n;h++)t.push(e.VertexBuffer.PositionKind+h),a&&t.push(e.VertexBuffer.NormalKind+h),l&&t.push(e.VertexBuffer.TangentKind+h),t.length>o&&e.Tools.Error("Cannot add more vertex attributes for mesh "+i.name)},t.PrepareAttributesForBones=function(t,i,r,n){r.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,i),t.push(e.VertexBuffer.MatricesIndicesKind),t.push(e.VertexBuffer.MatricesWeightsKind),r.NUM_BONE_INFLUENCERS>4&&(t.push(e.VertexBuffer.MatricesIndicesExtraKind),t.push(e.VertexBuffer.MatricesWeightsExtraKind)))},t.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},t.BindLightShadow=function(e,t,i,r,n){if(e.shadowEnabled&&i.receiveShadows){var o=e.getShadowGenerator();o&&o.bindShadowLight(r,n)}},t.BindLightProperties=function(e,t,i){e.transferToEffect(t,i+"")},t.BindLights=function(i,r,n,o,s,a){void 0===s&&(s=4),void 0===a&&(a=!1);for(var l=0,h=0,c=r._lightSources;h<c.length;h++){var u=c[h],f=u.getScaledIntensity();if(u._uniformBuffer.bindToEffect(n,"Light"+l),t.BindLightProperties(u,n,l),u.diffuse.scaleToRef(f,e.Tmp.Color3[0]),u._uniformBuffer.updateColor4("vLightDiffuse",e.Tmp.Color3[0],a?u.radius:u.range,l+""),o.SPECULARTERM&&(u.specular.scaleToRef(f,e.Tmp.Color3[1]),u._uniformBuffer.updateColor3("vLightSpecular",e.Tmp.Color3[1],l+"")),i.shadowsEnabled&&this.BindLightShadow(u,i,r,l+"",n),u._uniformBuffer.update(),++l===s)break}},t.BindFogParameters=function(t,i,r){t.fogEnabled&&i.applyFog&&t.fogMode!==e.Scene.FOGMODE_NONE&&(r.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),r.setColor3("vFogColor",t.fogColor))},t.BindBonesParameters=function(e,t){if(e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){var i=e.skeleton.getTransformMatrices(e);i&&t&&t.setMatrices("mBones",i)}},t.BindMorphTargetParameters=function(e,t){var i=e.morphTargetManager;e&&i&&t.setFloatArray("morphTargetInfluences",i.influences)},t.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},t.BindClipPlane=function(e,t){if(t.clipPlane){var i=t.clipPlane;e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)}},t}();e.MaterialHelper=t}(r||(r={}));var r,s=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};!function(e){var t=function(){function e(){this._isDirty=!0,this._areLightsDirty=!0,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areMiscDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(){this._areLightsDirty=!0,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];"_"!==i[0]&&this._keys.push(i)}},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];"number"==typeof this[t]?this[t]=0:this[t]=!1}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],r=this[i];"number"==typeof r?e+="#define "+i+" "+this[i]+"\n":r&&(e+="#define "+i+"\n")}return e},e}();e.MaterialDefines=t;var i=function(){function t(i,r,n){this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this._backFaceCulling=!0,this.doNotSerialize=!1,this.storeEffectOnSubMeshes=!1,this.onDisposeObservable=new e.Observable,this.onBindObservable=new e.Observable,this.onUnBindObservable=new e.Observable,this._alphaMode=e.Engine.ALPHA_COMBINE,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.forceDepthWrite=!1,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=t.TriangleFillMode,this.name=i,this.id=i||e.Tools.RandomId(),this._scene=r||e.Engine.LastCreatedScene,this._scene.useRightHandedSystem?this.sideOrientation=t.ClockWiseSideOrientation:this.sideOrientation=t.CounterClockWiseSideOrientation,this._uniformBuffer=new e.UniformBuffer(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,n||this._scene.materials.push(this)}return Object.defineProperty(t,"TriangleFillMode",{get:function(){return t._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WireFrameFillMode",{get:function(){return t._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointFillMode",{get:function(){return t._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClockWiseSideOrientation",{get:function(){return t._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CounterClockWiseSideOrientation",{get:function(){return t._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TextureDirtyFlag",{get:function(){return t._TextureDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LightDirtyFlag",{get:function(){return t._LightDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FresnelDirtyFlag",{get:function(){return t._FresnelDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AttributesDirtyFlag",{get:function(){return t._AttributesDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MiscDirtyFlag",{get:function(){return t._MiscDirtyFlag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(t.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){return this._fillMode===t.WireFrameFillMode},set:function(e){this._fillMode=e?t.WireFrameFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointsCloud",{get:function(){return this._fillMode===t.PointFillMode},set:function(e){this._fillMode=e?t.PointFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(t.MiscDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){return"Name: "+this.name},t.prototype.getClassName=function(){return"Material"},Object.defineProperty(t.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),t.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},t.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},t.prototype.isReady=function(e,t){return!0},t.prototype.isReadyForSubMesh=function(e,t,i){return!1},t.prototype.getEffect=function(){return this._effect},t.prototype.getScene=function(){return this._scene},t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.markDirty=function(){this._wasPreviouslyReady=!1},t.prototype._preBind=function(e,i){void 0===i&&(i=null);var r=this._scene.getEngine(),n=null==i?this.sideOrientation:i,o=n===t.ClockWiseSideOrientation;return r.enableEffect(e||this._effect),r.setState(this.backFaceCulling,this.zOffset,!1,o),o},t.prototype.bind=function(e,t){},t.prototype.bindForSubMesh=function(e,t,i){},t.prototype.bindOnlyWorldMatrix=function(e){},t.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},t.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},t.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},t.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,this._scene._cachedVisibility=e?e.visibility:1,e&&this.onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}},t.prototype.unbind=function(){if(this.onUnBindObservable.notifyObservers(this),this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}},t.prototype.getActiveTextures=function(){return[]},t.prototype.hasTexture=function(e){return!1},t.prototype.clone=function(e){return null},t.prototype.getBindedMeshes=function(){for(var e=new Array,t=0;t<this._scene.meshes.length;t++){var i=this._scene.meshes[t];i.material===this&&e.push(i)}return e},t.prototype.forceCompilation=function(t,i,r){var n=this,o=s({alphaTest:null,clipPlane:!1},r),a=new e.BaseSubMesh,l=this.getScene(),h=l.getEngine(),c=function(){if(n._scene&&n._scene.getEngine()){a._materialDefines&&(a._materialDefines._renderId=-1);var s=h.getAlphaTesting(),u=l.clipPlane;h.setAlphaTesting(o.alphaTest||!n.needAlphaBlendingForMesh(t)&&n.needAlphaTesting()),o.clipPlane&&(l.clipPlane=new e.Plane(0,0,0,1)),n.storeEffectOnSubMeshes?n.isReadyForSubMesh(t,a)?i&&i(n):setTimeout(c,16):n.isReady(t)?i&&i(n):setTimeout(c,16),h.setAlphaTesting(s),r&&r.clipPlane&&(l.clipPlane=u)}};c()},t.prototype.markAsDirty=function(e){e&t.TextureDirtyFlag&&this._markAllSubMeshesAsTexturesDirty(),e&t.LightDirtyFlag&&this._markAllSubMeshesAsLightsDirty(),e&t.FresnelDirtyFlag&&this._markAllSubMeshesAsFresnelDirty(),e&t.AttributesDirtyFlag&&this._markAllSubMeshesAsAttributesDirty(),e&t.MiscDirtyFlag&&this._markAllSubMeshesAsMiscDirty(),this.getScene().resetCachedMaterial()},t.prototype._markAllSubMeshesAsDirty=function(e){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var n=0,o=r.subMeshes;n<o.length;n++){var s=o[n];s.getMaterial()===this&&(s._materialDefines&&e(s._materialDefines))}}},t.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsImageProcessingDirty()})},t.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsTexturesDirty()})},t.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsFresnelDirty()})},t.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsLightDirty()})},t.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},t.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsMiscDirty()})},t.prototype.dispose=function(e,t){this.getScene().stopAnimation(this);var i=this._scene.materials.indexOf(this);for(i>=0&&this._scene.materials.splice(i,1),i=0;i<this._scene.meshes.length;i++){var r=this._scene.meshes[i];if(r.material===this&&(r.material=null,r.geometry)){var n=r.geometry;if(this.storeEffectOnSubMeshes)for(var o=0,s=r.subMeshes;o<s.length;o++){var a=s[o];n._releaseVertexArrayObject(a._materialEffect),e&&a._materialEffect&&this._scene.getEngine()._releaseEffect(a._materialEffect)}else n._releaseVertexArrayObject(this._effect)}}this._uniformBuffer.dispose(),e&&this._effect&&(this.storeEffectOnSubMeshes||this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBindObservable.clear(),this.onUnBindObservable.clear()},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.ParseMultiMaterial=function(t,i){var r=new e.MultiMaterial(t.name,i);r.id=t.id,e.Tags&&e.Tags.AddTagsTo(r,t.tags);for(var n=0;n<t.materials.length;n++){var o=t.materials[n];o?r.subMaterials.push(i.getMaterialByID(o)):r.subMaterials.push(null)}return r},t.Parse=function(t,i,r){return t.customType?"BABYLON.PBRMaterial"===t.customType&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!e.LegacyPBRMaterial)?void e.Tools.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."):e.Tools.Instantiate(t.customType).Parse(t,i,r):e.StandardMaterial.Parse(t,i,r)},t}();i._TriangleFillMode=0,i._WireFrameFillMode=1,i._PointFillMode=2,i._ClockWiseSideOrientation=0,i._CounterClockWiseSideOrientation=1,i._TextureDirtyFlag=1,i._LightDirtyFlag=2,i._FresnelDirtyFlag=4,i._AttributesDirtyFlag=8,i._MiscDirtyFlag=16,n([e.serialize()],i.prototype,"id",void 0),n([e.serialize()],i.prototype,"name",void 0),n([e.serialize()],i.prototype,"checkReadyOnEveryCall",void 0),n([e.serialize()],i.prototype,"checkReadyOnlyOnce",void 0),n([e.serialize()],i.prototype,"state",void 0),n([e.serialize()],i.prototype,"alpha",void 0),n([e.serialize("backFaceCulling")],i.prototype,"_backFaceCulling",void 0),n([e.serialize()],i.prototype,"sideOrientation",void 0),n([e.serialize("alphaMode")],i.prototype,"_alphaMode",void 0),n([e.serialize()],i.prototype,"_needDepthPrePass",void 0),n([e.serialize()],i.prototype,"disableDepthWrite",void 0),n([e.serialize()],i.prototype,"forceDepthWrite",void 0),n([e.serialize()],i.prototype,"separateCullingPass",void 0),n([e.serialize("fogEnabled")],i.prototype,"_fogEnabled",void 0),n([e.serialize()],i.prototype,"pointSize",void 0),n([e.serialize()],i.prototype,"zOffset",void 0),n([e.serialize()],i.prototype,"wireframe",null),n([e.serialize()],i.prototype,"pointsCloud",null),n([e.serialize()],i.prototype,"fillMode",null),e.Material=i}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i){this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=i,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(t.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!0,configurable:!0}),t.prototype.isDynamic=function(){return void 0!==this._dynamic},t.prototype.getData=function(){return this._bufferData},t.prototype.getBuffer=function(){return this._buffer},t.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var r=this._uniformLocationPointer-i,n=0;n<r;n++)this._data.push(0)}},t.prototype.addUniform=function(e,t){if(!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(t instanceof Array)i=t,t=i.length;else{t=t,i=[];for(var r=0;r<t;r++)i.push(0)}this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(var r=0;r<t;r++)this._data.push(i[r]);this._needSync=!0}},t.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},t.prototype.addFloat2=function(e,t,i){var r=[t,i];this.addUniform(e,r)},t.prototype.addFloat3=function(e,t,i,r){var n=[t,i,r];this.addUniform(e,n)},t.prototype.addColor3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},t.prototype.addColor4=function(e,t,i){var r=new Array;t.toArray(r),r.push(i),this.addUniform(e,r)},t.prototype.addVector3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},t.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},t.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},t.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},t.prototype._rebuild=function(){this._noUBO||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},t.prototype.update=function(){if(!this._buffer)return void this.create();(this._dynamic||this._needSync)&&(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1)},t.prototype.updateUniform=function(t,i,r){var n=this._uniformLocations[t];if(void 0===n){if(this._buffer)return void e.Tools.Error("Cannot add an uniform after UBO has been created.");this.addUniform(t,r),n=this._uniformLocations[t]}if(this._buffer||this.create(),this._dynamic)for(var o=0;o<r;o++)this._bufferData[n+o]=i[o];else{for(var s=!1,o=0;o<r;o++)this._bufferData[n+o]!==i[o]&&(s=!0,this._bufferData[n+o]=i[o]);this._needSync=this._needSync||s}},t.prototype._updateMatrix3x3ForUniform=function(e,i){for(var r=0;r<3;r++)t._tempBuffer[4*r]=i[3*r],t._tempBuffer[4*r+1]=i[3*r+1],t._tempBuffer[4*r+2]=i[3*r+2],t._tempBuffer[4*r+3]=0;this.updateUniform(e,t._tempBuffer,12)},t.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},t.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},t.prototype._updateMatrix2x2ForUniform=function(e,i){for(var r=0;r<2;r++)t._tempBuffer[4*r]=i[2*r],t._tempBuffer[4*r+1]=i[2*r+1],t._tempBuffer[4*r+2]=0,t._tempBuffer[4*r+3]=0;this.updateUniform(e,t._tempBuffer,8)},t.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},t.prototype._updateFloatForUniform=function(e,i){t._tempBuffer[0]=i,this.updateUniform(e,t._tempBuffer,1)},t.prototype._updateFloat2ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setFloat2(e+r,t,i)},t.prototype._updateFloat2ForUniform=function(e,i,r,n){void 0===n&&(n=""),t._tempBuffer[0]=i,t._tempBuffer[1]=r,this.updateUniform(e,t._tempBuffer,2)},t.prototype._updateFloat3ForEffect=function(e,t,i,r,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,i,r)},t.prototype._updateFloat3ForUniform=function(e,i,r,n,o){void 0===o&&(o=""),t._tempBuffer[0]=i,t._tempBuffer[1]=r,t._tempBuffer[2]=n,this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateFloat4ForEffect=function(e,t,i,r,n,o){void 0===o&&(o=""),this._currentEffect.setFloat4(e+o,t,i,r,n)},t.prototype._updateFloat4ForUniform=function(e,i,r,n,o,s){void 0===s&&(s=""),t._tempBuffer[0]=i,t._tempBuffer[1]=r,t._tempBuffer[2]=n,t._tempBuffer[3]=o,this.updateUniform(e,t._tempBuffer,4)},t.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},t.prototype._updateMatrixForUniform=function(e,t){this.updateUniform(e,t.toArray(),16)},t.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},t.prototype._updateVector3ForUniform=function(e,i){i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},t.prototype._updateVector4ForUniform=function(e,i){i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,4)},t.prototype._updateColor3ForEffect=function(e,t,i){void 0===i&&(i=""),this._currentEffect.setColor3(e+i,t)},t.prototype._updateColor3ForUniform=function(e,i,r){void 0===r&&(r=""),i.toArray(t._tempBuffer),this.updateUniform(e,t._tempBuffer,3)},t.prototype._updateColor4ForEffect=function(e,t,i,r){void 0===r&&(r=""),this._currentEffect.setColor4(e+r,t,i)},t.prototype._updateColor4ForUniform=function(e,i,r,n){void 0===n&&(n=""),i.toArray(t._tempBuffer),t._tempBuffer[3]=r,this.updateUniform(e,t._tempBuffer,4)},t.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},t.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},t.prototype.bindToEffect=function(e,t){this._currentEffect=e,!this._noUBO&&this._buffer&&e.bindUniformBuffer(this._buffer,t)},t.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers.indexOf(this);-1!==e&&this._engine._uniformBuffers.splice(e,1),this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},t}();t._MAX_UNIFORM_SIZE=256,t._tempBuffer=new Float32Array(t._MAX_UNIFORM_SIZE),e.UniformBuffer=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.storeEffectOnSubMeshes=!0,r}return o(i,t),i.prototype.getEffect=function(){return this._activeEffect},i.prototype.isReady=function(e,t){return!!e&&(!e.subMeshes||0===e.subMeshes.length||this.isReadyForSubMesh(e,e.subMeshes[0],t))},i.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},i.prototype.bind=function(e,t){t&&this.bindForSubMesh(e,t,t.subMeshes[0])},i.prototype._afterBind=function(e,i){void 0===i&&(i=null),t.prototype._afterBind.call(this,e),this.getScene()._cachedEffect=i},i.prototype._mustRebind=function(e,t,i){return void 0===i&&(i=1),e.isCachedMaterialInvalid(this,t,i)},i.prototype.markAsDirty=function(t){t&e.Material.TextureDirtyFlag&&this._markAllSubMeshesAsTexturesDirty(),t&e.Material.LightDirtyFlag&&this._markAllSubMeshesAsLightsDirty(),t&e.Material.FresnelDirtyFlag&&this._markAllSubMeshesAsFresnelDirty(),t&e.Material.AttributesDirtyFlag&&this._markAllSubMeshesAsAttributesDirty(),t&e.Material.MiscDirtyFlag&&this._markAllSubMeshesAsMiscDirty(),this.getScene().resetCachedMaterial()},i.prototype._markAllSubMeshesAsDirty=function(e){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var r=i[t];if(r.subMeshes)for(var n=0,o=r.subMeshes;n<o.length;n++){var s=o[n];if(s.getMaterial()===this){if(!s._materialDefines)return;e(s._materialDefines)}}}},i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsTexturesDirty()})},i.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsFresnelDirty()})},i.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsLightDirty()})},i.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},i.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(function(e){return e.markAsMiscDirty()})},i}(e.Material);e.PushMaterial=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.prototype.set=function(t,i){switch(i){case e.VertexBuffer.PositionKind:this.positions=t;break;case e.VertexBuffer.NormalKind:this.normals=t;break;case e.VertexBuffer.TangentKind:this.tangents=t;break;case e.VertexBuffer.UVKind:this.uvs=t;break;case e.VertexBuffer.UV2Kind:this.uvs2=t;break;case e.VertexBuffer.UV3Kind:this.uvs3=t;break;case e.VertexBuffer.UV4Kind:this.uvs4=t;break;case e.VertexBuffer.UV5Kind:this.uvs5=t;break;case e.VertexBuffer.UV6Kind:this.uvs6=t;break;case e.VertexBuffer.ColorKind:this.colors=t;break;case e.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case e.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t;break;case e.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case e.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}},t.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},t.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},t.prototype.updateMesh=function(e,t,i){return this._update(e),this},t.prototype.updateGeometry=function(e,t,i){return this._update(e),this},t.prototype._applyTo=function(t,i){return void 0===i&&(i=!1),this.positions&&t.setVerticesData(e.VertexBuffer.PositionKind,this.positions,i),this.normals&&t.setVerticesData(e.VertexBuffer.NormalKind,this.normals,i),this.tangents&&t.setVerticesData(e.VertexBuffer.TangentKind,this.tangents,i),this.uvs&&t.setVerticesData(e.VertexBuffer.UVKind,this.uvs,i),this.uvs2&&t.setVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i),this.uvs3&&t.setVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i),this.uvs4&&t.setVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i),this.uvs5&&t.setVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i),this.uvs6&&t.setVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i),this.colors&&t.setVerticesData(e.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&t.setVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&t.setVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&t.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&t.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices&&t.setIndices(this.indices,null,i),this},t.prototype._update=function(t,i,r){return this.positions&&t.updateVerticesData(e.VertexBuffer.PositionKind,this.positions,i,r),this.normals&&t.updateVerticesData(e.VertexBuffer.NormalKind,this.normals,i,r),this.tangents&&t.updateVerticesData(e.VertexBuffer.TangentKind,this.tangents,i,r),this.uvs&&t.updateVerticesData(e.VertexBuffer.UVKind,this.uvs,i,r),this.uvs2&&t.updateVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i,r),this.uvs3&&t.updateVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i,r),this.uvs4&&t.updateVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i,r),this.uvs5&&t.updateVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i,r),this.uvs6&&t.updateVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i,r),this.colors&&t.updateVerticesData(e.VertexBuffer.ColorKind,this.colors,i,r),this.matricesIndices&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,r),this.matricesWeights&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,r),this.matricesIndicesExtra&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,r),this.matricesWeightsExtra&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,r),this.indices&&t.setIndices(this.indices,null),this},t.prototype.transform=function(t){var i,r=e.Vector3.Zero();if(this.positions){var n=e.Vector3.Zero();for(i=0;i<this.positions.length;i+=3)e.Vector3.FromArrayToRef(this.positions,i,n),e.Vector3.TransformCoordinatesToRef(n,t,r),this.positions[i]=r.x,this.positions[i+1]=r.y,this.positions[i+2]=r.z}if(this.normals){var o=e.Vector3.Zero();for(i=0;i<this.normals.length;i+=3)e.Vector3.FromArrayToRef(this.normals,i,o),e.Vector3.TransformNormalToRef(o,t,r),this.normals[i]=r.x,this.normals[i+1]=r.y,this.normals[i+2]=r.z}if(this.tangents){var s=e.Vector4.Zero(),a=e.Vector4.Zero();for(i=0;i<this.tangents.length;i+=4)e.Vector4.FromArrayToRef(this.tangents,i,s),e.Vector4.TransformNormalToRef(s,t,a),this.tangents[i]=a.x,this.tangents[i+1]=a.y,this.tangents[i+2]=a.z,this.tangents[i+3]=a.w}return this},t.prototype.merge=function(e,t){if(t=t||{},e.indices){this.indices||(this.indices=[]);for(var i=this.positions?this.positions.length/3:0,r=0;r<e.indices.length;r++)this.indices.push(e.indices[r]+i)}if(this.positions=this._mergeElement(this.positions,e.positions),!this.positions)return this;var n=this.positions.length/3;return this.normals=this._mergeElement(this.normals,e.normals,3*n),this.tangents=this._mergeElement(this.tangents,e.tangents,n*(t.tangentLength||4)),this.uvs=this._mergeElement(this.uvs,e.uvs,2*n),this.uvs2=this._mergeElement(this.uvs2,e.uvs2,2*n),this.uvs3=this._mergeElement(this.uvs3,e.uvs3,2*n),this.uvs4=this._mergeElement(this.uvs4,e.uvs4,2*n),this.uvs5=this._mergeElement(this.uvs5,e.uvs5,2*n),this.uvs6=this._mergeElement(this.uvs6,e.uvs6,2*n),this.colors=this._mergeElement(this.colors,e.colors,4*n,1),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices,4*n),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights,4*n),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra,4*n),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra,4*n),this},t.prototype._mergeElement=function(e,t,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),!t&&!e)return null;if(!t){var n=new Float32Array(e.length);return n.fill(r),this._mergeElement(e,n,i)}if(!e){if(0===i||i===t.length)return t;var n=new Float32Array(i-t.length);return n.fill(r),this._mergeElement(n,t,i)}var o=t.length+e.length,s=e instanceof Float32Array,a=t instanceof Float32Array;if(s){var l=new Float32Array(o);return l.set(e),l.set(t,e.length),l}if(a){for(var h=e.slice(0),c=0,o=t.length;c<o;c++)h.push(t[c]);return h}return e.concat(t)},t.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},t.ExtractFromMesh=function(e,i,r){return t._ExtractFrom(e,i,r)},t.ExtractFromGeometry=function(e,i,r){return t._ExtractFrom(e,i,r)},t._ExtractFrom=function(i,r,n){var o=new t;return i.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(o.positions=i.getVerticesData(e.VertexBuffer.PositionKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(o.normals=i.getVerticesData(e.VertexBuffer.NormalKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&(o.tangents=i.getVerticesData(e.VertexBuffer.TangentKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.uvs=i.getVerticesData(e.VertexBuffer.UVKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.uvs2=i.getVerticesData(e.VertexBuffer.UV2Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(o.uvs3=i.getVerticesData(e.VertexBuffer.UV3Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(o.uvs4=i.getVerticesData(e.VertexBuffer.UV4Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(o.uvs5=i.getVerticesData(e.VertexBuffer.UV5Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(o.uvs6=i.getVerticesData(e.VertexBuffer.UV6Kind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(o.colors=i.getVerticesData(e.VertexBuffer.ColorKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(o.matricesIndices=i.getVerticesData(e.VertexBuffer.MatricesIndicesKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(o.matricesWeights=i.getVerticesData(e.VertexBuffer.MatricesWeightsKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesExtraKind)&&(o.matricesIndicesExtra=i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,r,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind)&&(o.matricesWeightsExtra=i.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,r,n)),o.indices=i.getIndices(r),o},t.CreateRibbon=function(i){var r=i.pathArray,n=i.closeArray||!1,o=i.closePath||!1,s=i.invertUV||!1,a=Math.floor(r[0].length/2),l=i.offset||a;l=l>a?a:Math.floor(l);var h,c,u,f,d=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,p=i.uvs,m=i.colors,g=[],v=[],y=[],_=[],b=[],x=[],T=[],E=[],S=[],w=[];if(r.length<2){var M=[],A=[];for(u=0;u<r[0].length-l;u++)M.push(r[0][u]),A.push(r[0][u+l]);r=[M,A]}var P,C,R=0,D=o?1:0;h=r[0].length;var I,O;for(c=0;c<r.length;c++){for(T[c]=0,b[c]=[0],P=r[c],C=P.length,h=h<C?h:C,f=0;f<C;)g.push(P[f].x,P[f].y,P[f].z),f>0&&(I=P[f].subtract(P[f-1]).length(),O=I+T[c],b[c].push(O),T[c]=O),f++;o&&(f--,g.push(P[0].x,P[0].y,P[0].z),I=P[f].subtract(P[0]).length(),O=I+T[c],b[c].push(O),T[c]=O),S[c]=C+D,w[c]=R,R+=C+D}var F,L,B=null,N=null;for(u=0;u<h+D;u++){for(E[u]=0,x[u]=[0],c=0;c<r.length-1;c++)F=r[c],L=r[c+1],u===h?(B=F[0],N=L[0]):(B=F[u],N=L[u]),I=N.subtract(B).length(),O=I+E[u],x[u].push(O),E[u]=O;n&&N&&B&&(F=r[c],L=r[0],u===h&&(N=L[0]),I=N.subtract(B).length(),O=I+E[u],E[u]=O)}var k,V;if(p)for(c=0;c<p.length;c++)_.push(p[c].x,p[c].y);else for(c=0;c<r.length;c++)for(u=0;u<h+D;u++)k=0!=T[c]?b[c][u]/T[c]:0,V=0!=E[u]?x[u][c]/E[u]:0,s?_.push(V,k):_.push(k,V);c=0;for(var U=0,z=S[c]-1,G=S[c+1]-1,H=z<G?z:G,j=w[1]-w[0],W=n?S.length:S.length-1;U<=H&&c<W;)v.push(U,U+j,U+1),v.push(U+j+1,U+1,U+j),(U+=1)===H&&(c++,c===S.length-1?(j=w[0]-w[c],z=S[c]-1,G=S[0]-1):(j=w[c+1]-w[c],z=S[c]-1,G=S[c+1]-1),U=w[c],H=z<G?z+U:G+U);if(t.ComputeNormals(g,v,y),o){var X=0,Y=0;for(c=0;c<r.length;c++)X=3*w[c],Y=c+1<r.length?3*(w[c+1]-1):y.length-3,y[X]=.5*(y[X]+y[Y]),y[X+1]=.5*(y[X+1]+y[Y+1]),y[X+2]=.5*(y[X+2]+y[Y+2]),y[Y]=y[X],y[Y+1]=y[X+1],y[Y+2]=y[X+2]}t._ComputeSides(d,g,v,y,_,i.frontUVs,i.backUVs);var K=null;if(m){K=new Float32Array(4*m.length);for(var q=0;q<m.length;q++)K[4*q]=m[q].r,K[4*q+1]=m[q].g,K[4*q+2]=m[q].b,K[4*q+3]=m[q].a}var Q=new t,Z=new Float32Array(g),J=new Float32Array(y),$=new Float32Array(_);return Q.indices=v,Q.positions=Z,Q.normals=J,Q.uvs=$,K&&Q.set(K,e.VertexBuffer.ColorKind),o&&(Q._idx=w),Q},t.CreateBox=function(i){for(var r=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],n=[],o=[],s=[],a=[],l=i.width||i.size||1,h=i.height||i.size||1,c=i.depth||i.size||1,u=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,f=i.faceUV||new Array(6),d=i.faceColors,p=[],m=0;m<6;m++)void 0===f[m]&&(f[m]=new e.Vector4(0,0,1,1)),d&&void 0===d[m]&&(d[m]=new e.Color4(1,1,1,1));for(var g=new e.Vector3(l/2,h/2,c/2),v=0;v<r.length;v++){var y=r[v],_=new e.Vector3(y.y,y.z,y.x),b=e.Vector3.Cross(y,_),x=o.length/3;n.push(x),n.push(x+1),n.push(x+2),n.push(x),n.push(x+2),n.push(x+3);var T=y.subtract(_).subtract(b).multiply(g);o.push(T.x,T.y,T.z),s.push(y.x,y.y,y.z),a.push(f[v].z,f[v].w),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),T=y.subtract(_).add(b).multiply(g),o.push(T.x,T.y,T.z),s.push(y.x,y.y,y.z),a.push(f[v].x,f[v].w),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),T=y.add(_).add(b).multiply(g),o.push(T.x,T.y,T.z),s.push(y.x,y.y,y.z),a.push(f[v].x,f[v].y),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a),T=y.add(_).subtract(b).multiply(g),o.push(T.x,T.y,T.z),s.push(y.x,y.y,y.z),a.push(f[v].z,f[v].y),d&&p.push(d[v].r,d[v].g,d[v].b,d[v].a)}t._ComputeSides(u,o,n,s,a,i.frontUVs,i.backUVs);var E=new t;if(E.indices=n,E.positions=o,E.normals=s,E.uvs=a,d){var S=u===e.Mesh.DOUBLESIDE?p.concat(p):p;E.colors=S}return E},t.CreateSphere=function(i){for(var r=i.segments||32,n=i.diameterX||i.diameter||1,o=i.diameterY||i.diameter||1,s=i.diameterZ||i.diameter||1,a=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,l=i.slice&&i.slice<=0?1:i.slice||1,h=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,c=new e.Vector3(n/2,o/2,s/2),u=2+r,f=2*u,d=[],p=[],m=[],g=[],v=0;v<=u;v++){for(var y=v/u,_=y*Math.PI*l,b=0;b<=f;b++){var x=b/f,T=x*Math.PI*2*a,E=e.Matrix.RotationZ(-_),S=e.Matrix.RotationY(T),w=e.Vector3.TransformCoordinates(e.Vector3.Up(),E),M=e.Vector3.TransformCoordinates(w,S),A=M.multiply(c),P=M.divide(c).normalize();p.push(A.x,A.y,A.z),m.push(P.x,P.y,P.z),g.push(x,y)}if(v>0)for(var C=p.length/3,R=C-2*(f+1);R+f+2<C;R++)d.push(R),d.push(R+1),d.push(R+f+1),d.push(R+f+1),d.push(R+1),d.push(R+f+2)}t._ComputeSides(h,p,d,m,g,i.frontUVs,i.backUVs);var D=new t;return D.indices=d,D.positions=p,D.normals=m,D.uvs=g,D},t.CreateCylinder=function(i){var r,n=i.height||2,o=0===i.diameterTop?0:i.diameterTop||i.diameter||1,s=0===i.diameterBottom?0:i.diameterBottom||i.diameter||1,a=i.tessellation||24,l=i.subdivisions||1,h=!!i.hasRings,c=!!i.enclose,u=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,f=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,d=i.faceUV||new Array(3),p=i.faceColors,m=1!==u&&c?2:0,g=h?l:1,v=2+(1+m)*g;for(r=0;r<v;r++)p&&void 0===p[r]&&(p[r]=new e.Color4(1,1,1,1));for(r=0;r<v;r++)d&&void 0===d[r]&&(d[r]=new e.Vector4(0,0,1,1));var y,_,b,x,T,E,S=new Array,w=new Array,M=new Array,A=new Array,P=new Array,C=2*Math.PI*u/a,R=(s-o)/2/n,D=e.Vector3.Zero(),I=e.Vector3.Zero(),O=e.Vector3.Zero(),F=e.Vector3.Zero(),L=e.Vector3.Zero(),B=e.Axis.Y,N=1,k=1,V=0,U=0;for(x=0;x<=l;x++)for(_=x/l,b=(_*(o-s)+s)/2,N=h&&0!==x&&x!==l?2:1,E=0;E<N;E++){for(h&&(k+=E),c&&(k+=2*E),T=0;T<=a;T++)y=T*C,D.x=Math.cos(-y)*b,D.y=-n/2+_*n,D.z=Math.sin(-y)*b,0===o&&x===l?(I.x=M[M.length-3*(a+1)],I.y=M[M.length-3*(a+1)+1],I.z=M[M.length-3*(a+1)+2]):(I.x=D.x,I.z=D.z,I.y=Math.sqrt(I.x*I.x+I.z*I.z)*R,I.normalize()),0===T&&(O.copyFrom(D),F.copyFrom(I)),w.push(D.x,D.y,D.z),M.push(I.x,I.y,I.z),U=h?V!==k?d[k].y:d[k].w:d[k].y+(d[k].w-d[k].y)*_,A.push(d[k].x+(d[k].z-d[k].x)*T/a,U),p&&P.push(p[k].r,p[k].g,p[k].b,p[k].a);1!==u&&c&&(w.push(D.x,D.y,D.z),w.push(0,D.y,0),w.push(0,D.y,0),w.push(O.x,O.y,O.z),e.Vector3.CrossToRef(B,I,L),L.normalize(),M.push(L.x,L.y,L.z,L.x,L.y,L.z),e.Vector3.CrossToRef(F,B,L),L.normalize(),M.push(L.x,L.y,L.z,L.x,L.y,L.z),U=h?V!==k?d[k+1].y:d[k+1].w:d[k+1].y+(d[k+1].w-d[k+1].y)*_,A.push(d[k+1].x,U),A.push(d[k+1].z,U),U=h?V!==k?d[k+2].y:d[k+2].w:d[k+2].y+(d[k+2].w-d[k+2].y)*_,A.push(d[k+2].x,U),A.push(d[k+2].z,U),p&&(P.push(p[k+1].r,p[k+1].g,p[k+1].b,p[k+1].a),P.push(p[k+1].r,p[k+1].g,p[k+1].b,p[k+1].a),P.push(p[k+2].r,p[k+2].g,p[k+2].b,p[k+2].a),P.push(p[k+2].r,p[k+2].g,p[k+2].b,p[k+2].a))),V!==k&&(V=k)}var k,z=1!==u&&c?a+4:a;for(x=0,k=0;k<l;k++){var G=0,H=0,j=0,W=0;for(T=0;T<a;T++)G=x*(z+1)+T,H=(x+1)*(z+1)+T,j=x*(z+1)+(T+1),W=(x+1)*(z+1)+(T+1),S.push(G,H,j),S.push(W,j,H);1!==u&&c&&(S.push(G+2,H+2,j+2),S.push(W+2,j+2,H+2),S.push(G+4,H+4,j+4),S.push(W+4,j+4,H+4)),x=h?x+2:x+1}var X=function(t){var i=t?o/2:s/2;if(0!==i){var r,l,h,c=t?d[v-1]:d[0],f=null;p&&(f=t?p[v-1]:p[0]);var m=w.length/3,g=t?n/2:-n/2,y=new e.Vector3(0,g,0);w.push(y.x,y.y,y.z),M.push(0,t?1:-1,0),A.push(c.x+.5*(c.z-c.x),c.y+.5*(c.w-c.y)),f&&P.push(f.r,f.g,f.b,f.a);var _=new e.Vector2(.5,.5);for(h=0;h<=a;h++){r=2*Math.PI*h*u/a;var b=Math.cos(-r),x=Math.sin(-r);l=new e.Vector3(b*i,g,x*i);var T=new e.Vector2(b*_.x+.5,x*_.y+.5);w.push(l.x,l.y,l.z),M.push(0,t?1:-1,0),A.push(c.x+(c.z-c.x)*T.x,c.y+(c.w-c.y)*T.y),f&&P.push(f.r,f.g,f.b,f.a)}for(h=0;h<a;h++)t?(S.push(m),S.push(m+(h+2)),S.push(m+(h+1))):(S.push(m),S.push(m+(h+1)),S.push(m+(h+2)))}};X(!1),X(!0),t._ComputeSides(f,w,S,M,A,i.frontUVs,i.backUVs);var Y=new t;return Y.indices=S,Y.positions=w,Y.normals=M,Y.uvs=A,p&&(Y.colors=P),Y},t.CreateTorus=function(i){for(var r=[],n=[],o=[],s=[],a=i.diameter||1,l=i.thickness||.5,h=i.tessellation||16,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,u=h+1,f=0;f<=h;f++)for(var d=f/h,p=f*Math.PI*2/h-Math.PI/2,m=e.Matrix.Translation(a/2,0,0).multiply(e.Matrix.RotationY(p)),g=0;g<=h;g++){var v=1-g/h,y=g*Math.PI*2/h+Math.PI,_=Math.cos(y),b=Math.sin(y),x=new e.Vector3(_,b,0),T=x.scale(l/2),E=new e.Vector2(d,v);T=e.Vector3.TransformCoordinates(T,m),x=e.Vector3.TransformNormal(x,m),n.push(T.x,T.y,T.z),o.push(x.x,x.y,x.z),s.push(E.x,E.y);var S=(f+1)%u,w=(g+1)%u;r.push(f*u+g),r.push(f*u+w),r.push(S*u+g),r.push(f*u+w),r.push(S*u+w),r.push(S*u+g)}t._ComputeSides(c,n,r,o,s,i.frontUVs,i.backUVs);var M=new t;return M.indices=r,M.positions=n,M.normals=o,M.uvs=s,M},t.CreateLineSystem=function(e){for(var i=[],r=[],n=e.lines,o=e.colors,s=[],a=0,l=0;l<n.length;l++)for(var h=n[l],c=0;c<h.length;c++){if(r.push(h[c].x,h[c].y,h[c].z),o){var u=o[l];s.push(u[c].r,u[c].g,u[c].b,u[c].a)}c>0&&(i.push(a-1),i.push(a)),a++}var f=new t;return f.indices=i,f.positions=r,o&&(f.colors=s),f},t.CreateDashedLines=function(i){var r=i.dashSize||3,n=i.gapSize||1,o=i.dashNb||200,s=i.points,a=new Array,l=new Array,h=e.Vector3.Zero(),c=0,u=0,f=0,d=0,p=0,m=0,g=0;for(g=0;g<s.length-1;g++)s[g+1].subtractToRef(s[g],h),c+=h.length();for(f=c/o,d=r*f/(r+n),g=0;g<s.length-1;g++){s[g+1].subtractToRef(s[g],h),u=Math.floor(h.length()/f),h.normalize();for(var v=0;v<u;v++)p=f*v,a.push(s[g].x+p*h.x,s[g].y+p*h.y,s[g].z+p*h.z),a.push(s[g].x+(p+d)*h.x,s[g].y+(p+d)*h.y,s[g].z+(p+d)*h.z),l.push(m,m+1),m+=2}var y=new t;return y.positions=a,y.indices=l,y},t.CreateGround=function(i){var r,n,o=[],s=[],a=[],l=[],h=i.width||1,c=i.height||1,u=i.subdivisionsX||i.subdivisions||1,f=i.subdivisionsY||i.subdivisions||1;for(r=0;r<=f;r++)for(n=0;n<=u;n++){var d=new e.Vector3(n*h/u-h/2,0,(f-r)*c/f-c/2),p=new e.Vector3(0,1,0);s.push(d.x,d.y,d.z),a.push(p.x,p.y,p.z),l.push(n/u,1-r/f)}for(r=0;r<f;r++)for(n=0;n<u;n++)o.push(n+1+(r+1)*(u+1)),o.push(n+1+r*(u+1)),o.push(n+r*(u+1)),o.push(n+(r+1)*(u+1)),o.push(n+1+(r+1)*(u+1)),o.push(n+r*(u+1));var m=new t;return m.indices=o,m.positions=s,m.normals=a,m.uvs=l,m},t.CreateTiledGround=function(i){var r,n,o,s,a=i.xmin||-1,l=i.zmin||-1,h=i.xmax||1,c=i.zmax||1,u=i.subdivisions||{w:1,h:1},f=i.precision||{w:1,h:1},d=new Array,p=new Array,m=new Array,g=new Array;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,f.w=f.w<1?1:f.w,f.h=f.h<1?1:f.h;var v={w:(h-a)/u.w,h:(c-l)/u.h};for(o=0;o<u.h;o++)for(s=0;s<u.w;s++)!function(t,i,o,s){var a=p.length/3,l=f.w+1;for(r=0;r<f.h;r++)for(n=0;n<f.w;n++){var h=[a+n+r*l,a+(n+1)+r*l,a+(n+1)+(r+1)*l,a+n+(r+1)*l];d.push(h[1]),d.push(h[2]),d.push(h[3]),d.push(h[0]),d.push(h[1]),d.push(h[3])}var c=e.Vector3.Zero(),u=new e.Vector3(0,1,0);for(r=0;r<=f.h;r++)for(c.z=r*(s-i)/f.h+i,n=0;n<=f.w;n++)c.x=n*(o-t)/f.w+t,c.y=0,p.push(c.x,c.y,c.z),m.push(u.x,u.y,u.z),g.push(n/f.w,r/f.h)}(a+s*v.w,l+o*v.h,a+(s+1)*v.w,l+(o+1)*v.h);var y=new t;return y.indices=d,y.positions=p,y.normals=m,y.uvs=g,y},t.CreateGroundFromHeightMap=function(i){var r,n,o=[],s=[],a=[],l=[],h=i.colorFilter||new e.Color3(.3,.59,.11);for(r=0;r<=i.subdivisions;r++)for(n=0;n<=i.subdivisions;n++){var c=new e.Vector3(n*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-r)*i.height/i.subdivisions-i.height/2),u=(c.x+i.width/2)/i.width*(i.bufferWidth-1)|0,f=(1-(c.z+i.height/2)/i.height)*(i.bufferHeight-1)|0,d=4*(u+f*i.bufferWidth),p=i.buffer[d]/255,m=i.buffer[d+1]/255,g=i.buffer[d+2]/255,v=p*h.r+m*h.g+g*h.b;c.y=i.minHeight+(i.maxHeight-i.minHeight)*v,s.push(c.x,c.y,c.z),a.push(0,0,0),l.push(n/i.subdivisions,1-r/i.subdivisions)}for(r=0;r<i.subdivisions;r++)for(n=0;n<i.subdivisions;n++)o.push(n+1+(r+1)*(i.subdivisions+1)),o.push(n+1+r*(i.subdivisions+1)),o.push(n+r*(i.subdivisions+1)),o.push(n+(r+1)*(i.subdivisions+1)),o.push(n+1+(r+1)*(i.subdivisions+1)),o.push(n+r*(i.subdivisions+1));t.ComputeNormals(s,o,a);var y=new t;return y.indices=o,y.positions=s,y.normals=a,y.uvs=l,y},t.CreatePlane=function(i){var r=[],n=[],o=[],s=[],a=i.width||i.size||1,l=i.height||i.size||1,h=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,c=a/2,u=l/2;n.push(-c,-u,0),o.push(0,0,-1),s.push(0,0),n.push(c,-u,0),o.push(0,0,-1),s.push(1,0),n.push(c,u,0),o.push(0,0,-1),s.push(1,1),n.push(-c,u,0),o.push(0,0,-1),s.push(0,1),r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),t._ComputeSides(h,n,r,o,s,i.frontUVs,i.backUVs);var f=new t;return f.indices=r,f.positions=n,f.normals=o,f.uvs=s,f},t.CreateDisc=function(i){var r=new Array,n=new Array,o=new Array,s=new Array,a=i.radius||.5,l=i.tessellation||64,h=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE;r.push(0,0,0),s.push(.5,.5);for(var u=2*Math.PI*h,f=u/l,d=0;d<u;d+=f){var p=Math.cos(d),m=Math.sin(d),g=(p+1)/2,v=(1-m)/2;r.push(a*p,a*m,0),s.push(g,v)}1===h&&(r.push(r[3],r[4],r[5]),s.push(s[2],s[3]));for(var y=r.length/3,_=1;_<y-1;_++)n.push(_+1,0,_);t.ComputeNormals(r,n,o),t._ComputeSides(c,r,n,o,s,i.frontUVs,i.backUVs);var b=new t;return b.indices=n,b.positions=r,b.normals=o,b.uvs=s,b},t.CreatePolygon=function(i,r,n,o,s,a){for(var l=n||new Array(3),h=o,c=[],u=0;u<3;u++)void 0===l[u]&&(l[u]=new e.Vector4(0,0,1,1)),h&&void 0===h[u]&&(h[u]=new e.Color4(1,1,1,1));for(var f=i.getVerticesData(e.VertexBuffer.PositionKind),d=i.getVerticesData(e.VertexBuffer.NormalKind),p=i.getVerticesData(e.VertexBuffer.UVKind),m=i.getIndices(),g=0,v=0,y=0;y<d.length;y+=3)Math.abs(d[y+1])<.001&&(v=1),Math.abs(d[y+1]-1)<.001&&(v=0),Math.abs(d[y+1]+1)<.001&&(v=2),g=y/3,p[2*g]=(1-p[2*g])*l[v].x+p[2*g]*l[v].z,p[2*g+1]=(1-p[2*g+1])*l[v].y+p[2*g+1]*l[v].w,h&&c.push(h[v].r,h[v].g,h[v].b,h[v].a);t._ComputeSides(r,f,m,d,p,s,a);var _=new t;if(_.indices=m,_.positions=f,_.normals=d,_.uvs=p,h){var b=r===e.Mesh.DOUBLESIDE?c.concat(c):c;_.colors=b}return _},t.CreateIcoSphere=function(i){var r,n=i.sideOrientation||e.Mesh.DEFAULTSIDE,o=i.radius||1,s=void 0===i.flat||i.flat,a=i.subdivisions||4,l=i.radiusX||o,h=i.radiusY||o,c=i.radiusZ||o,u=(1+Math.sqrt(5))/2,f=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],d=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],m=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],v=new Array,y=new Array,_=new Array,b=new Array,x=0,T=new Array(3),E=new Array(3);for(r=0;r<3;r++)T[r]=e.Vector3.Zero(),E[r]=e.Vector2.Zero();for(var S=0;S<20;S++){for(r=0;r<3;r++){var w=d[3*S+r];T[r].copyFromFloats(f[3*p[w]],f[3*p[w]+1],f[3*p[w]+2]),T[r].normalize().scaleInPlace(o),E[r].copyFromFloats(m[2*w]*(138/1024)+60/1024+g[S]*(-40/1024),m[2*w+1]*(239/1024)+26/1024+g[S]*(20/1024))}for(var M=function(t,i,r,n){var o=e.Vector3.Lerp(T[0],T[2],i/a),u=e.Vector3.Lerp(T[1],T[2],i/a),f=a===i?T[2]:e.Vector3.Lerp(o,u,t/(a-i));f.normalize();var d;if(s){var p=e.Vector3.Lerp(T[0],T[2],n/a),m=e.Vector3.Lerp(T[1],T[2],n/a);d=e.Vector3.Lerp(p,m,r/(a-n))}else d=new e.Vector3(f.x,f.y,f.z);d.x/=l,d.y/=h,d.z/=c,d.normalize();var g=e.Vector2.Lerp(E[0],E[2],i/a),S=e.Vector2.Lerp(E[1],E[2],i/a),w=a===i?E[2]:e.Vector2.Lerp(g,S,t/(a-i));y.push(f.x*l,f.y*h,f.z*c),_.push(d.x,d.y,d.z),b.push(w.x,w.y),v.push(x),x++},A=0;A<a;A++)for(var P=0;P+A<a;P++)M(P,A,P+1/3,A+1/3),M(P+1,A,P+1/3,A+1/3),M(P,A+1,P+1/3,A+1/3),P+A+1<a&&(M(P+1,A,P+2/3,A+2/3),M(P+1,A+1,P+2/3,A+2/3),M(P,A+1,P+2/3,A+2/3))}t._ComputeSides(n,y,v,_,b,i.frontUVs,i.backUVs);var C=new t;return C.indices=v,C.positions=y,C.normals=_,C.uvs=b,C},t.CreatePolyhedron=function(i){var r=[];r[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},r[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},r[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},r[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},r[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},r[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},r[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},r[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},r[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},r[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},r[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},r[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},r[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},r[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},r[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var n,o,s,a,l,h,c=i.type&&(i.type<0||i.type>=r.length)?0:i.type||0,u=i.size,f=i.sizeX||u||1,d=i.sizeY||u||1,p=i.sizeZ||u||1,m=i.custom||r[c],g=m.face.length,v=i.faceUV||new Array(g),y=i.faceColors,_=void 0===i.flat||i.flat,b=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,x=new Array,T=new Array,E=new Array,S=new Array,w=new Array,M=0,A=0,P=new Array,C=0,R=0;if(_)for(R=0;R<g;R++)y&&void 0===y[R]&&(y[R]=new e.Color4(1,1,1,1)),v&&void 0===v[R]&&(v[R]=new e.Vector4(0,0,1,1));if(_)for(R=0;R<g;R++){var D=m.face[R].length;for(s=2*Math.PI/D,a=.5*Math.tan(s/2),l=.5,C=0;C<D;C++)x.push(m.vertex[m.face[R][C]][0]*f,m.vertex[m.face[R][C]][1]*d,m.vertex[m.face[R][C]][2]*p),P.push(M),M++,n=v[R].x+(v[R].z-v[R].x)*(.5+a),o=v[R].y+(v[R].w-v[R].y)*(l-.5),S.push(n,o),h=a*Math.cos(s)-l*Math.sin(s),l=a*Math.sin(s)+l*Math.cos(s),a=h,y&&w.push(y[R].r,y[R].g,y[R].b,y[R].a);for(C=0;C<D-2;C++)T.push(P[0+A],P[C+2+A],P[C+1+A]);A+=D}else{for(C=0;C<m.vertex.length;C++)x.push(m.vertex[C][0]*f,m.vertex[C][1]*d,m.vertex[C][2]*p),S.push(0,0);for(R=0;R<g;R++)for(C=0;C<m.face[R].length-2;C++)T.push(m.face[R][0],m.face[R][C+2],m.face[R][C+1])}t.ComputeNormals(x,T,E),t._ComputeSides(b,x,T,E,S,i.frontUVs,i.backUVs);var I=new t;return I.positions=x,I.indices=T,I.normals=E,I.uvs=S,y&&_&&(I.colors=w),I},t.CreateTorusKnot=function(i){var r,n,o=new Array,s=new Array,a=new Array,l=new Array,h=i.radius||2,c=i.tube||.5,u=i.radialSegments||32,f=i.tubularSegments||32,d=i.p||2,p=i.q||3,m=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,g=function(t){var i=Math.cos(t),r=Math.sin(t),n=p/d*t,o=Math.cos(n),s=h*(2+o)*.5*i,a=h*(2+o)*r*.5,l=h*Math.sin(n)*.5;return new e.Vector3(s,a,l)};for(r=0;r<=u;r++){var v=r%u,y=v/u*2*d*Math.PI,_=g(y),b=g(y+.01),x=b.subtract(_),T=b.add(_),E=e.Vector3.Cross(x,T);for(T=e.Vector3.Cross(E,x),E.normalize(),T.normalize(),n=0;n<f;n++){var S=n%f,w=S/f*2*Math.PI,M=-c*Math.cos(w),A=c*Math.sin(w);s.push(_.x+M*T.x+A*E.x),s.push(_.y+M*T.y+A*E.y),s.push(_.z+M*T.z+A*E.z),l.push(r/u),l.push(n/f)}}for(r=0;r<u;r++)for(n=0;n<f;n++){var P=(n+1)%f,C=r*f+n,R=(r+1)*f+n,D=(r+1)*f+P,I=r*f+P;o.push(I),o.push(R),o.push(C),o.push(I),o.push(D),o.push(R)}t.ComputeNormals(s,o,a),t._ComputeSides(m,s,o,a,l,i.frontUVs,i.backUVs);var O=new t;return O.indices=o,O.positions=s,O.normals=a,O.uvs=l,O},t.ComputeNormals=function(t,i,r,n){var o=0,s=0,a=0,l=0,h=0,c=0,u=0,f=0,d=0,p=0,m=0,g=0,v=0,y=0,_=0,b=0,x=0,T=0,E=0,S=0,w=!1,M=!1,A=!1,P=!1,C=1,R=0,D=null;if(n&&(w=!!n.facetNormals,M=!!n.facetPositions,A=!!n.facetPartitioning,C=!0===n.useRightHandedSystem?-1:1,R=n.ratio||0,P=!!n.depthSort,D=n.distanceTo,P)){void 0===D&&(D=e.Vector3.Zero());var I=n.depthSortedFacets}var O=0,F=0,L=0,B=0;if(A&&n&&n.bbSize){var N=0,k=0,V=0,U=0,z=0,G=0,H=0,j=0,W=0,X=0,Y=0,K=0,q=0,Q=0,Z=0,J=0,$=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;$=$>n.bbSize.z?$:n.bbSize.z,O=n.subDiv.X*R/n.bbSize.x,F=n.subDiv.Y*R/n.bbSize.y,L=n.subDiv.Z*R/n.bbSize.z,B=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(o=0;o<t.length;o++)r[o]=0;var ee=i.length/3|0;for(o=0;o<ee;o++){if(g=3*i[3*o],v=g+1,y=g+2,_=3*i[3*o+1],b=_+1,x=_+2,T=3*i[3*o+2],E=T+1,S=T+2,s=t[g]-t[_],a=t[v]-t[b],l=t[y]-t[x],h=t[T]-t[_],c=t[E]-t[b],u=t[S]-t[x],f=C*(a*u-l*c),d=C*(l*h-s*u),p=C*(s*c-a*h),m=Math.sqrt(f*f+d*d+p*p),m=0===m?1:m,f/=m,d/=m,p/=m,w&&n&&(n.facetNormals[o].x=f,n.facetNormals[o].y=d,n.facetNormals[o].z=p),M&&n&&(n.facetPositions[o].x=(t[g]+t[_]+t[T])/3,n.facetPositions[o].y=(t[v]+t[b]+t[E])/3,n.facetPositions[o].z=(t[y]+t[x]+t[S])/3),A&&n&&(N=Math.floor((n.facetPositions[o].x-n.bInfo.minimum.x*R)*O),k=Math.floor((n.facetPositions[o].y-n.bInfo.minimum.y*R)*F),V=Math.floor((n.facetPositions[o].z-n.bInfo.minimum.z*R)*L),U=Math.floor((t[g]-n.bInfo.minimum.x*R)*O),z=Math.floor((t[v]-n.bInfo.minimum.y*R)*F),G=Math.floor((t[y]-n.bInfo.minimum.z*R)*L),H=Math.floor((t[_]-n.bInfo.minimum.x*R)*O),j=Math.floor((t[b]-n.bInfo.minimum.y*R)*F),W=Math.floor((t[x]-n.bInfo.minimum.z*R)*L),X=Math.floor((t[T]-n.bInfo.minimum.x*R)*O),Y=Math.floor((t[E]-n.bInfo.minimum.y*R)*F),K=Math.floor((t[S]-n.bInfo.minimum.z*R)*L),Q=U+n.subDiv.max*z+B*G,Z=H+n.subDiv.max*j+B*W,J=X+n.subDiv.max*Y+B*K,q=N+n.subDiv.max*k+B*V,n.facetPartitioning[q]=n.facetPartitioning[q]?n.facetPartitioning[q]:new Array,n.facetPartitioning[Q]=n.facetPartitioning[Q]?n.facetPartitioning[Q]:new Array,n.facetPartitioning[Z]=n.facetPartitioning[Z]?n.facetPartitioning[Z]:new Array,n.facetPartitioning[J]=n.facetPartitioning[J]?n.facetPartitioning[J]:new Array,n.facetPartitioning[Q].push(o),Z!=Q&&n.facetPartitioning[Z].push(o),J!=Z&&J!=Q&&n.facetPartitioning[J].push(o),q!=Q&&q!=Z&&q!=J&&n.facetPartitioning[q].push(o)),P&&n&&n.facetPositions){var te=I[o];te.ind=3*o,te.sqDistance=e.Vector3.DistanceSquared(n.facetPositions[o],D)}r[g]+=f,r[v]+=d,r[y]+=p,r[_]+=f,r[b]+=d,r[x]+=p,r[T]+=f,r[E]+=d,r[S]+=p}for(o=0;o<r.length/3;o++)f=r[3*o],d=r[3*o+1],p=r[3*o+2],m=Math.sqrt(f*f+d*d+p*p),m=0===m?1:m,f/=m,d/=m,p/=m,r[3*o]=f,r[3*o+1]=d,r[3*o+2]=p},t._ComputeSides=function(t,i,r,n,o,s,a){var l,h,c=r.length,u=n.length;switch(t=t||e.Mesh.DEFAULTSIDE){case e.Mesh.FRONTSIDE:break;case e.Mesh.BACKSIDE:var f;for(l=0;l<c;l+=3)f=r[l],r[l]=r[l+2],r[l+2]=f;for(h=0;h<u;h++)n[h]=-n[h];break;case e.Mesh.DOUBLESIDE:for(var d=i.length,p=d/3,m=0;m<d;m++)i[d+m]=i[m];for(l=0;l<c;l+=3)r[l+c]=r[l+2]+p,r[l+1+c]=r[l+1]+p,r[l+2+c]=r[l]+p;for(h=0;h<u;h++)n[u+h]=-n[h];var g=o.length,v=0;for(v=0;v<g;v++)o[v+g]=o[v];for(s=s||new e.Vector4(0,0,1,1),a=a||new e.Vector4(0,0,1,1),v=0,l=0;l<g/2;l++)o[v]=s.x+(s.z-s.x)*o[v],o[v+1]=s.y+(s.w-s.y)*o[v+1],o[v+g]=a.x+(a.z-a.x)*o[v+g],o[v+g+1]=a.y+(a.w-a.y)*o[v+g+1],v+=2}},t.ImportVertexData=function(i,r){var n=new t,o=i.positions;o&&n.set(o,e.VertexBuffer.PositionKind);var s=i.normals;s&&n.set(s,e.VertexBuffer.NormalKind);var a=i.tangents;a&&n.set(a,e.VertexBuffer.TangentKind);var l=i.uvs;l&&n.set(l,e.VertexBuffer.UVKind);var h=i.uv2s;h&&n.set(h,e.VertexBuffer.UV2Kind);var c=i.uv3s;c&&n.set(c,e.VertexBuffer.UV3Kind);var u=i.uv4s;u&&n.set(u,e.VertexBuffer.UV4Kind);var f=i.uv5s;f&&n.set(f,e.VertexBuffer.UV5Kind);var d=i.uv6s;d&&n.set(d,e.VertexBuffer.UV6Kind);var p=i.colors;p&&n.set(e.Color4.CheckColors4(p,o.length/3),e.VertexBuffer.ColorKind);var m=i.matricesIndices;m&&n.set(m,e.VertexBuffer.MatricesIndicesKind);var g=i.matricesWeights;g&&n.set(g,e.VertexBuffer.MatricesWeightsKind);var v=i.indices;v&&(n.indices=v),r.setAllVerticesData(n,i.updatable)},t}();e.VertexData=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=null),this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,this._vertexBuffers={},this._indices=[],this._updatable=n,r?this.setAllVerticesData(r,n):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&("LinesMesh"===o.getClassName()&&(this.boundingBias=new e.Vector2(0,o.intersectionThreshold),this.updateExtend()),this.applyToMesh(o),o.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias&&this._boundingBias.equals(e)||(this._boundingBias=e.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),t.CreateGeometryForMesh=function(e){var i=new t(t.RandomId(),e.getScene());return i.applyToMesh(e),i},Object.defineProperty(t.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},Object.defineProperty(t.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var e in this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,r,n){void 0===r&&(r=!1);var o=new e.VertexBuffer(this._engine,i,t,r,0===this._meshes.length,n);this.setVerticesBuffer(o)},t.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},t.prototype.setVerticesBuffer=function(t){var i=t.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=t,i===e.VertexBuffer.PositionKind){var r=t.getData(),n=t.getStrideSize();this._totalVertices=r.length/n,this.updateExtend(r,n),this._resetPointsArrayCache();for(var o=this._meshes,s=o.length,a=0;a<s;a++){var l=o[a];l._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),l._createGlobalSubMesh(!1),l.computeWorldMatrix(!0)}}this.notifyUpdate(i),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},t.prototype.updateVerticesDataDirectly=function(e,t,i){var r=this.getVertexBuffer(e);r&&(r.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,r){void 0===r&&(r=!1);var n=this.getVertexBuffer(t);if(n){if(n.update(i),t===e.VertexBuffer.PositionKind){var o=n.getStrideSize();this._totalVertices=i.length/o,this.updateBoundingInfo(r,i)}this.notifyUpdate(t)}},t.prototype.updateBoundingInfo=function(t,i){t&&this.updateExtend(i);var r=this._meshes,n=r.length;this._resetPointsArrayCache();for(var o=0;o<n;o++){var s=r[o];if(t){s._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var a=0;a<s.subMeshes.length;a++){s.subMeshes[a].refreshBoundingInfo()}}}},t.prototype._bind=function(e,t){if(e){void 0===t&&(t=this._indexBuffer);var i=this.getVertexBuffers();if(i){if(t!=this._indexBuffer||!this._vertexArrayObjects)return void this._engine.bindBuffers(i,t,e);this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(i,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)}}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t,i){var r=this.getVertexBuffer(e);if(!r)return null;var n=r.getData();if(i||t&&1!==this._meshes.length){for(var o=n.length,s=[],a=0;a<o;a++)s.push(n[a]);return s}return n},t.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},t.prototype.updateIndices=function(e,t){this._indexBuffer&&(this._indexBufferIsUpdatable?this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t):this.setIndices(e,null,!0))},t.prototype.setIndices=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=i,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),void 0!=t&&(this._totalVertices=t);for(var r=this._meshes,n=r.length,o=0;o<n;o++)r[o]._createGlobalSubMesh(!0);this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,r=[],n=0;n<i;n++)r.push(t[n]);return r}return t},t.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},t.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,r=i.indexOf(e);-1!==r&&(i.splice(r,1),e._geometry=null,0===i.length&&t&&this.dispose())},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype.updateExtend=function(t,i){void 0===t&&(t=null),t||(t=this._vertexBuffers[e.VertexBuffer.PositionKind].getData()),this._extend=e.Tools.ExtractMinAndMax(t,0,this._totalVertices,this.boundingBias,i)},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var r in this._vertexBuffers){1===i&&this._vertexBuffers[r].create();var n=this._vertexBuffers[r].getBuffer();n&&(n.references=i),r===e.VertexBuffer.PositionKind&&(this._extend||this.updateExtend(this._vertexBuffers[r].getData()),t._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(!1),t._updateBoundingInfo())}1===i&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,i=this._meshes;t<i.length;t++){i[t]._markSubMeshesAsAttributesDirty()}},t.prototype.load=function(t,i){if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,this._queueLoad(t,i)}},t.prototype._queueLoad=function(t,i){var r=this;this.delayLoadingFile&&(t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(n){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(n),r),r.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,r._delayInfo=[],t._removePendingData(r);for(var o=r._meshes,s=o.length,a=0;a<s;a++)r._applyToMesh(o[a]);i&&i()}},function(){},t.database))},t.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(null!=t&&t.length>0){for(var i=0;i<t.length;i+=3){var r=t[i+0];t[i+0]=t[i+2],t[i+2]=r}this.setIndices(t)}var n=this.getVerticesData(e.VertexBuffer.PositionKind,!1);if(null!=n&&n.length>0){for(var i=0;i<n.length;i+=3)n[i+2]=-n[i+2];this.setVerticesData(e.VertexBuffer.PositionKind,n,!1)}var o=this.getVerticesData(e.VertexBuffer.NormalKind,!1);if(null!=o&&o.length>0){for(var i=0;i<o.length;i+=3)o[i+2]=-o[i+2];this.setVerticesData(e.VertexBuffer.NormalKind,o,!1)}},t.prototype._resetPointsArrayCache=function(){this._positions=null},t.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},t.prototype.dispose=function(){var t,i=this._meshes,r=i.length;for(t=0;t<r;t++)this.releaseForMesh(i[t]);this._meshes=[],this._disposeVertexArrayObjects();for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var r=new e.VertexData;r.indices=[];var n=this.getIndices();if(n)for(var o=0;o<n.length;o++)r.indices.push(n[o]);var s,a=!1,l=!1;for(s in this._vertexBuffers){var h=this.getVerticesData(s);if(h instanceof Float32Array?r.set(new Float32Array(h),s):r.set(h.slice(0),s),!l){var c=this.getVertexBuffer(s);c&&(a=c.isUpdatable(),l=!a)}}var u=new t(i,this._scene,r,a);u.delayLoadState=this.delayLoadState,u.delayLoadingFile=this.delayLoadingFile,u._delayLoadingFunction=this._delayLoadingFunction;for(s in this._delayInfo)u._delayInfo=u._delayInfo||[],u._delayInfo.push(s);return u._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),u},t.prototype.serialize=function(){var t={};return t.id=this.id,t.updatable=this._updatable,e.Tags&&e.Tags.HasTags(this)&&(t.tags=e.Tags.GetTags(this)),t},t.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},t.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(t.positions=this.toNumberArray(this.getVerticesData(e.VertexBuffer.PositionKind)),this.isVertexBufferUpdatable(e.VertexBuffer.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(t.normals=this.toNumberArray(this.getVerticesData(e.VertexBuffer.NormalKind)),this.isVertexBufferUpdatable(e.VertexBuffer.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(t.uvs=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UVKind)),this.isVertexBufferUpdatable(e.VertexBuffer.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(t.uv2s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV2Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV2Kind)&&(t.uv2s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(t.uv3s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV3Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV3Kind)&&(t.uv3s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(t.uv4s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV4Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV4Kind)&&(t.uv4s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(t.uv5s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV5Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV5Kind)&&(t.uv5s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(t.uv6s=this.toNumberArray(this.getVerticesData(e.VertexBuffer.UV6Kind)),this.isVertexBufferUpdatable(e.VertexBuffer.UV6Kind)&&(t.uv6s._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(t.colors=this.toNumberArray(this.getVerticesData(e.VertexBuffer.ColorKind)),this.isVertexBufferUpdatable(e.VertexBuffer.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(t.matricesIndices=this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(e.VertexBuffer.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(t.matricesWeights=this.toNumberArray(this.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),this.isVertexBufferUpdatable(e.VertexBuffer.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this.toNumberArray(this.getIndices()),t},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return e.Tools.RandomId()},t.ImportGeometry=function(i,r){var n=r.getScene(),o=i.geometryId;if(o){var s=n.getGeometryByID(o);s&&s.applyToMesh(r)}else if(i instanceof ArrayBuffer){var a=r._binaryInfo;if(a.positionsAttrDesc&&a.positionsAttrDesc.count>0){var l=new Float32Array(i,a.positionsAttrDesc.offset,a.positionsAttrDesc.count);r.setVerticesData(e.VertexBuffer.PositionKind,l,!1)}if(a.normalsAttrDesc&&a.normalsAttrDesc.count>0){var h=new Float32Array(i,a.normalsAttrDesc.offset,a.normalsAttrDesc.count);r.setVerticesData(e.VertexBuffer.NormalKind,h,!1)}if(a.uvsAttrDesc&&a.uvsAttrDesc.count>0){var c=new Float32Array(i,a.uvsAttrDesc.offset,a.uvsAttrDesc.count);r.setVerticesData(e.VertexBuffer.UVKind,c,!1)}if(a.uvs2AttrDesc&&a.uvs2AttrDesc.count>0){var u=new Float32Array(i,a.uvs2AttrDesc.offset,a.uvs2AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV2Kind,u,!1)}if(a.uvs3AttrDesc&&a.uvs3AttrDesc.count>0){var f=new Float32Array(i,a.uvs3AttrDesc.offset,a.uvs3AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV3Kind,f,!1)}if(a.uvs4AttrDesc&&a.uvs4AttrDesc.count>0){var d=new Float32Array(i,a.uvs4AttrDesc.offset,a.uvs4AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV4Kind,d,!1)}if(a.uvs5AttrDesc&&a.uvs5AttrDesc.count>0){var p=new Float32Array(i,a.uvs5AttrDesc.offset,a.uvs5AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV5Kind,p,!1)}if(a.uvs6AttrDesc&&a.uvs6AttrDesc.count>0){var m=new Float32Array(i,a.uvs6AttrDesc.offset,a.uvs6AttrDesc.count);r.setVerticesData(e.VertexBuffer.UV6Kind,m,!1)}if(a.colorsAttrDesc&&a.colorsAttrDesc.count>0){var g=new Float32Array(i,a.colorsAttrDesc.offset,a.colorsAttrDesc.count);r.setVerticesData(e.VertexBuffer.ColorKind,g,!1,a.colorsAttrDesc.stride)}if(a.matricesIndicesAttrDesc&&a.matricesIndicesAttrDesc.count>0){var v=new Int32Array(i,a.matricesIndicesAttrDesc.offset,a.matricesIndicesAttrDesc.count);r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,v,!1)}if(a.matricesWeightsAttrDesc&&a.matricesWeightsAttrDesc.count>0){var y=new Float32Array(i,a.matricesWeightsAttrDesc.offset,a.matricesWeightsAttrDesc.count);r.setVerticesData(e.VertexBuffer.MatricesWeightsKind,y,!1)}if(a.indicesAttrDesc&&a.indicesAttrDesc.count>0){var _=new Int32Array(i,a.indicesAttrDesc.offset,a.indicesAttrDesc.count);r.setIndices(_,null)}if(a.subMeshesAttrDesc&&a.subMeshesAttrDesc.count>0){var b=new Int32Array(i,a.subMeshesAttrDesc.offset,5*a.subMeshesAttrDesc.count);r.subMeshes=[];for(var x=0;x<a.subMeshesAttrDesc.count;x++){var T=b[5*x+0],E=b[5*x+1],S=b[5*x+2],w=b[5*x+3],M=b[5*x+4];e.SubMesh.AddToMesh(T,E,S,w,M,r)}}}else if(i.positions&&i.normals&&i.indices){if(r.setVerticesData(e.VertexBuffer.PositionKind,i.positions,i.positions._updatable),r.setVerticesData(e.VertexBuffer.NormalKind,i.normals,i.normals._updatable),i.uvs&&r.setVerticesData(e.VertexBuffer.UVKind,i.uvs,i.uvs._updatable),i.uvs2&&r.setVerticesData(e.VertexBuffer.UV2Kind,i.uvs2,i.uvs2._updatable),i.uvs3&&r.setVerticesData(e.VertexBuffer.UV3Kind,i.uvs3,i.uvs3._updatable),i.uvs4&&r.setVerticesData(e.VertexBuffer.UV4Kind,i.uvs4,i.uvs4._updatable),i.uvs5&&r.setVerticesData(e.VertexBuffer.UV5Kind,i.uvs5,i.uvs5._updatable),i.uvs6&&r.setVerticesData(e.VertexBuffer.UV6Kind,i.uvs6,i.uvs6._updatable),i.colors&&r.setVerticesData(e.VertexBuffer.ColorKind,e.Color4.CheckColors4(i.colors,i.positions.length/3),i.colors._updatable),i.matricesIndices)if(i.matricesIndices._isExpanded)delete i.matricesIndices._isExpanded,r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,i.matricesIndices,i.matricesIndices._updatable);else{for(var A=[],x=0;x<i.matricesIndices.length;x++){var P=i.matricesIndices[x];A.push(255&P),A.push((65280&P)>>8),A.push((16711680&P)>>16),A.push(P>>24)}r.setVerticesData(e.VertexBuffer.MatricesIndicesKind,A,i.matricesIndices._updatable)}if(i.matricesIndicesExtra)if(i.matricesIndicesExtra._isExpanded)delete i.matricesIndices._isExpanded,r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,i.matricesIndicesExtra,i.matricesIndicesExtra._updatable);else{for(var A=[],x=0;x<i.matricesIndicesExtra.length;x++){var P=i.matricesIndicesExtra[x];A.push(255&P),A.push((65280&P)>>8),A.push((16711680&P)>>16),A.push(P>>24)}r.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,A,i.matricesIndicesExtra._updatable)}i.matricesWeights&&(t._CleanMatricesWeights(i,r),r.setVerticesData(e.VertexBuffer.MatricesWeightsKind,i.matricesWeights,i.matricesWeights._updatable)),i.matricesWeightsExtra&&r.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,i.matricesWeightsExtra,i.matricesWeights._updatable),r.setIndices(i.indices,null)}if(i.subMeshes){r.subMeshes=[];for(var C=0;C<i.subMeshes.length;C++){var R=i.subMeshes[C];e.SubMesh.AddToMesh(R.materialIndex,R.verticesStart,R.verticesCount,R.indexStart,R.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),delete r._shouldGenerateFlatShading),r.computeWorldMatrix(!0),n._selectionOctree&&n._selectionOctree.addMesh(r)},t._CleanMatricesWeights=function(t,i){if(e.SceneLoader.CleanBoneMatrixWeights){var r=0;if(t.skeletonId>-1){var n=i.getScene().getLastSkeletonByID(t.skeletonId);if(n){r=n.bones.length;for(var o=i.getVerticesData(e.VertexBuffer.MatricesIndicesKind),s=i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind),a=t.matricesWeights,l=t.matricesWeightsExtra,h=t.numBoneInfluencer,c=a.length,u=0;u<c;u+=4){for(var f=0,d=-1,p=0;p<4;p++){var m=a[u+p];f+=m,m<.001&&d<0&&(d=p)}if(l)for(var p=0;p<4;p++){var m=l[u+p];f+=m,m<.001&&d<0&&(d=p+4)}if((d<0||d>h-1)&&(d=h-1),f>.001){for(var g=1/f,p=0;p<4;p++)a[u+p]*=g;if(l)for(var p=0;p<4;p++)l[u+p]*=g}else d>=4?(l[u+d-4]=1-f,s[u+d-4]=r):(a[u+d]=1-f,o[u+d]=r)}i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,o),t.matricesWeightsExtra&&i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,s)}}}},t.Parse=function(i,r,n){if(r.getGeometryByID(i.id))return null;var o=new t(i.id,r,void 0,i.updatable);return e.Tags&&e.Tags.AddTagsTo(o,i.tags),i.delayLoadingFile?(o.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=n+i.delayLoadingFile,o._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(i.boundingBoxMinimum),e.Vector3.FromArray(i.boundingBoxMaximum)),o._delayInfo=[],i.hasUVs&&o._delayInfo.push(e.VertexBuffer.UVKind),i.hasUVs2&&o._delayInfo.push(e.VertexBuffer.UV2Kind),i.hasUVs3&&o._delayInfo.push(e.VertexBuffer.UV3Kind),i.hasUVs4&&o._delayInfo.push(e.VertexBuffer.UV4Kind),i.hasUVs5&&o._delayInfo.push(e.VertexBuffer.UV5Kind),i.hasUVs6&&o._delayInfo.push(e.VertexBuffer.UV6Kind),i.hasColors&&o._delayInfo.push(e.VertexBuffer.ColorKind),i.hasMatricesIndices&&o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),i.hasMatricesWeights&&o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=e.VertexData.ImportVertexData):e.VertexData.ImportVertexData(i,o),r.pushGeometry(o,!0),o},t}();e.Geometry=t,function(t){!function(i){var r=function(e){function t(t,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=null);var o=e.call(this,t,i,void 0,!1,n)||this;return o._canBeRegenerated=r,o._beingRegenerated=!0,o.regenerate(),o._beingRegenerated=!1,o}return o(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,r){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.canBeRegenerated=this.canBeRegenerated(),t},t}(t);i._Primitive=r;var n=function(t){function i(i,r,n,o,s,a,l,h,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE);var u=t.call(this,i,r,l,h)||this;return u.pathArray=n,u.closeArray=o,u.closePath=s,u.offset=a,u.side=c,u}return o(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),void 0,this.side)},i}(r);i.Ribbon=n;var s=function(i){function r(t,r,n,o,s,a){void 0===s&&(s=null),void 0===a&&(a=e.Mesh.DEFAULTSIDE);var l=i.call(this,t,r,o,s)||this;return l.size=n,l.side=a,l}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.size,this.canBeRegenerated(),void 0,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.size=this.size,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Box(i.id,r,i.size,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Box=s;var a=function(i){function r(t,r,n,o,s,a,l){void 0===a&&(a=null),void 0===l&&(l=e.Mesh.DEFAULTSIDE);var h=i.call(this,t,r,s,a)||this;return h.segments=n,h.diameter=o,h.side=l,h}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.segments=this.segments,e.diameter=this.diameter,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Sphere(i.id,r,i.segments,i.diameter,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Sphere=a;var l=function(t){function i(i,r,n,o,s,a,l){void 0===a&&(a=null),void 0===l&&(l=e.Mesh.DEFAULTSIDE);var h=t.call(this,i,r,s,a)||this;return h.radius=n,h.tessellation=o,h.side=l,h}return o(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(r);i.Disc=l;var h=function(i){function r(t,r,n,o,s,a,l,h,c,u){void 0===l&&(l=1),void 0===c&&(c=null),void 0===u&&(u=e.Mesh.DEFAULTSIDE);var f=i.call(this,t,r,h,c)||this;return f.height=n,f.diameterTop=o,f.diameterBottom=s,f.tessellation=a,f.subdivisions=l,f.side=u,f}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.height=this.height,e.diameterTop=this.diameterTop,e.diameterBottom=this.diameterBottom,e.tessellation=this.tessellation,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Cylinder(i.id,r,i.height,i.diameterTop,i.diameterBottom,i.tessellation,i.subdivisions,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Cylinder=h;var c=function(i){function r(t,r,n,o,s,a,l,h){void 0===l&&(l=null),void 0===h&&(h=e.Mesh.DEFAULTSIDE);var c=i.call(this,t,r,a,l)||this;return c.diameter=n,c.thickness=o,c.tessellation=s,c.side=h,c}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.diameter=this.diameter,e.thickness=this.thickness,e.tessellation=this.tessellation,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Torus(i.id,r,i.diameter,i.thickness,i.tessellation,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Torus=c;var u=function(i){function r(e,t,r,n,o,s,a){void 0===a&&(a=null);var l=i.call(this,e,t,s,a)||this;return l.width=r,l.height=n,l.subdivisions=o,l}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.width=this.width,e.height=this.height,e.subdivisions=this.subdivisions,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Ground(i.id,r,i.width,i.height,i.subdivisions,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Ground=u;var f=function(t){function i(e,i,r,n,o,s,a,l,h,c){void 0===c&&(c=null);var u=t.call(this,e,i,h,c)||this;return u.xmin=r,u.zmin=n,u.xmax=o,u.zmax=s,u.subdivisions=a,u.precision=l,u}return o(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(r);i.TiledGround=f;var d=function(i){function r(t,r,n,o,s,a){void 0===s&&(s=null),void 0===a&&(a=e.Mesh.DEFAULTSIDE);var l=i.call(this,t,r,o,s)||this;return l.size=n,l.side=a,l}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.size=this.size,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.Plane(i.id,r,i.size,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.Plane=d;var p=function(i){function r(t,r,n,o,s,a,l,h,c,u,f){void 0===u&&(u=null),void 0===f&&(f=e.Mesh.DEFAULTSIDE);var d=i.call(this,t,r,c,u)||this;return d.radius=n,d.tube=o,d.radialSegments=s,d.tubularSegments=a,d.p=l,d.q=h,d.side=f,d}return o(r,i),r.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},r.prototype.copy=function(e){return new r(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.radius=this.radius,e.tube=this.tube,e.radialSegments=this.radialSegments,e.tubularSegments=this.tubularSegments,e.p=this.p,e.q=this.q,e},r.Parse=function(i,r){if(r.getGeometryByID(i.id))return null;var n=new t.Primitives.TorusKnot(i.id,r,i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.canBeRegenerated,null);return e.Tags&&e.Tags.AddTagsTo(n,i.tags),r.pushGeometry(n,!0),n},r}(r);i.TorusKnot=p}(t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(r||(r={}));var r;!function(e){var t=function(){function t(e){this._vertexBuffers={},this._scene=e}return t.prototype._prepareBuffers=function(){if(!this._vertexBuffers[e.VertexBuffer.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(this._scene.getEngine(),t,e.VertexBuffer.PositionKind,!1,!1,2),this._buildIndexBuffer()}},t.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},t.prototype._rebuild=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t._rebuild(),this._buildIndexBuffer())},t.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=this._scene.activeCamera;if(!i)return!1;var t=t||i._postProcesses;return!(!t||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(i,e,null!==t&&void 0!==t),!0)},t.prototype.directRender=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1);for(var r=this._scene.getEngine(),n=0;n<e.length;n++){n<e.length-1?e[n+1].activate(this._scene.activeCamera,t):t?r.bindFramebuffer(t,0,void 0,void 0,i):r.restoreDefaultFramebuffer();var o=e[n],s=o.apply();s&&(o.onBeforeRenderObservable.notifyObservers(s),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,s),r.draw(!0,0,6),o.onAfterRenderObservable.notifyObservers(s))}r.setDepthBuffer(!0),r.setDepthWrite(!0)},t.prototype._finalizeFrame=function(t,i,r,n,o){void 0===o&&(o=!1);var s=this._scene.activeCamera;if(s&&(n=n||s._postProcesses,0!==n.length&&this._scene.postProcessesEnabled)){for(var a=this._scene.getEngine(),l=0,h=n.length;l<h&&(l<h-1?n[l+1].activate(s,i):i?a.bindFramebuffer(i,r,void 0,void 0,o):a.restoreDefaultFramebuffer(),!t);l++){var c=n[l],u=c.apply();u&&(c.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,u),a.draw(!0,0,6),c.onAfterRenderObservable.notifyObservers(u))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},t}();e.PostProcessManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new i(e)}return t.prototype.sampleFrame=function(t){if(void 0===t&&(t=e.Tools.Now),this._enabled){if(null!=this._lastFrameTimeMs){var i=t-this._lastFrameTimeMs;this._rollingFrameTime.add(i)}this._lastFrameTimeMs=t}},Object.defineProperty(t.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!0,configurable:!0}),t.prototype.enable=function(){this._enabled=!0},t.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},t}();e.PerformanceMonitor=t;var i=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}();e.RollingAverage=i}(r||(r={}));var r;!function(e){var t=function(){function t(){this.colorCurves=new e.ColorCurves,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new e.Color4(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=t.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new e.Observable}return Object.defineProperty(t.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!0,configurable:!0}),t.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},t.prototype.getClassName=function(){return"ImageProcessingConfiguration"},t.PrepareUniforms=function(t,i){i.EXPOSURE&&t.push("exposureLinear"),i.CONTRAST&&t.push("contrast"),i.COLORGRADING&&t.push("colorTransformSettings"),i.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),i.COLORCURVES&&e.ColorCurves.PrepareUniforms(t)},t.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},t.prototype.prepareDefines=function(e,i){if(void 0===i&&(i=!1),i!==this.applyByPostProcess||!this._isEnabled)return e.VIGNETTE=!1,e.TONEMAPPING=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,void(e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===t._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,e.CONTRAST=1!==this.contrast,e.EXPOSURE=1!==this.exposure,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},t.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},t.prototype.bind=function(t,i){if(void 0===i&&(i=1),this._colorCurvesEnabled&&this.colorCurves&&e.ColorCurves.Bind(this.colorCurves,t),this._vignetteEnabled){var r=1/t.getEngine().getRenderWidth(),n=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",r,n);var o=Math.tan(.5*this.vignetteCameraFov),s=o*i,a=Math.sqrt(s*o);s=e.Tools.Mix(s,a,this.vignetteStretch),o=e.Tools.Mix(o,a,this.vignetteStretch),t.setFloat4("vignetteSettings1",s,o,-s*this.vignetteCentreX,-o*this.vignetteCentreY);var l=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var h=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(h-1)/h,.5/h,h,this.colorGradingTexture.level)}},t.prototype.clone=function(){return e.SerializationHelper.Clone(function(){return new t},this)},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.Parse=function(i){return e.SerializationHelper.Parse(function(){return new t},i,null,null)},Object.defineProperty(t,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!0,configurable:!0}),t}();t._VIGNETTEMODE_MULTIPLY=0,t._VIGNETTEMODE_OPAQUE=1,n([e.serializeAsColorCurves()],t.prototype,"colorCurves",void 0),n([e.serialize()],t.prototype,"_colorCurvesEnabled",void 0),n([e.serializeAsTexture()],t.prototype,"colorGradingTexture",void 0),n([e.serialize()],t.prototype,"_colorGradingEnabled",void 0),n([e.serialize()],t.prototype,"_colorGradingWithGreenDepth",void 0),n([e.serialize()],t.prototype,"_colorGradingBGR",void 0),n([e.serialize()],t.prototype,"_exposure",void 0),n([e.serialize()],t.prototype,"_toneMappingEnabled",void 0),n([e.serialize()],t.prototype,"_contrast",void 0),n([e.serialize()],t.prototype,"vignetteStretch",void 0),n([e.serialize()],t.prototype,"vignetteCentreX",void 0),n([e.serialize()],t.prototype,"vignetteCentreY",void 0),n([e.serialize()],t.prototype,"vignetteWeight",void 0),n([e.serializeAsColor4()],t.prototype,"vignetteColor",void 0),n([e.serialize()],t.prototype,"vignetteCameraFov",void 0),n([e.serialize()],t.prototype,"_vignetteBlendMode",void 0),n([e.serialize()],t.prototype,"_vignetteEnabled",void 0),n([e.serialize()],t.prototype,"_applyByPostProcess",void 0),n([e.serialize()],t.prototype,"_isEnabled",void 0),e.ImageProcessingConfiguration=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r){var n=t.call(this,r)||this;return i?(n._engine=r.getEngine(),n._textureMatrix=e.Matrix.Identity(),n.name=i,n.url=i,n.hasAlpha=!1,n.isCube=!1,n.is3D=n._engine.webGLVersion>1,n.wrapU=e.Texture.CLAMP_ADDRESSMODE,n.wrapV=e.Texture.CLAMP_ADDRESSMODE,n.wrapR=e.Texture.CLAMP_ADDRESSMODE,n.anisotropicFilteringLevel=1,n._texture=n._getFromCache(i,!0),n._texture||(r.useDelayedTextureLoading?n.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:n.loadTexture()),n):n}return o(i,t),i.prototype.getTextureMatrix=function(){return this._textureMatrix},i.prototype.load3dlTexture=function(){var t,r=this._engine;t=1===r.webGLVersion?r.createRawTexture(null,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE):r.createRawTexture3D(null,1,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._texture=t;var n=function(n){if("string"==typeof n){for(var o,s=null,a=null,l=n.split("\n"),h=0,c=0,u=0,f=0,d=0,p=0;p<l.length;p++)if(o=l[p],i._noneEmptyLineRegex.test(o)&&0!==o.indexOf("#")){var m=o.split(" ");if(0!==h){if(0!=h){var g=Math.max(parseInt(m[0]),0),v=Math.max(parseInt(m[1]),0),y=Math.max(parseInt(m[2]),0);d=Math.max(g,d),d=Math.max(v,d),d=Math.max(y,d);var _=4*(c+f*h+u*h*h);a&&(a[_+0]=g,a[_+1]=v,a[_+2]=y),f++,f%h==0&&(u++,f=0,u%h==0&&(c++,u=0))}}else h=m.length,s=new Uint8Array(h*h*h*4),a=new Float32Array(h*h*h*4)}if(a&&s)for(var p=0;p<a.length;p++)if(p>0&&(p+1)%4==0)s[p]=255;else{var b=a[p];s[p]=b/d*255}t.is3D?(t.updateSize(h,h,h),r.updateRawTexture3D(t,s,e.Engine.TEXTUREFORMAT_RGBA,!1)):(t.updateSize(h*h,h),r.updateRawTexture(t,s,e.Engine.TEXTUREFORMAT_RGBA,!1))}};return e.Tools.LoadFile(this.url,n),this._texture},i.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},i.prototype.clone=function(){var e=new i(this.url,this.getScene());return e.level=this.level,e},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},i.Parse=function(t,i,r){var n=null;return t.name&&!t.isRenderTarget&&(n=new e.ColorGradingTexture(t.name,i),n.name=t.name,n.level=t.level),n},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e.customType="BABYLON.ColorGradingTexture",e},i}(e.BaseTexture);t._noneEmptyLineRegex=/\S+/,e.ColorGradingTexture=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._dirty=!0,this._tempColor=new e.Color4(0,0,0,0),this._globalCurve=new e.Color4(0,0,0,0),this._highlightsCurve=new e.Color4(0,0,0,0),this._midtonesCurve=new e.Color4(0,0,0,0),this._shadowsCurve=new e.Color4(0,0,0,0),this._positiveCurve=new e.Color4(0,0,0,0),this._negativeCurve=new e.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(t.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ColorCurves"},t.Bind=function(e,t,i,r,n){void 0===i&&(i="vCameraColorCurvePositive"),void 0===r&&(r="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(r,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},t.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},t.prototype.getColorGradingDataToRef=function(e,i,r,n,o){null!=e&&(e=t.clamp(e,0,360),i=t.clamp(i,-100,100),r=t.clamp(r,-100,100),n=t.clamp(n,-100,100),i=t.applyColorGradingSliderNonlinear(i),i*=.5,n=t.applyColorGradingSliderNonlinear(n),i<0&&(i*=-1,e=(e+180)%360),t.fromHSBToRef(e,i,50+.25*n,o),o.scaleToRef(2,o),o.a=1+.01*r)},t.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},t.fromHSBToRef=function(e,i,r,n){var o=t.clamp(e,0,360),s=t.clamp(i/100,0,1),a=t.clamp(r/100,0,1);if(0===s)n.r=a,n.g=a,n.b=a;else{o/=60;var l=Math.floor(o),h=o-l,c=a*(1-s),u=a*(1-s*h),f=a*(1-s*(1-h));switch(l){case 0:n.r=a,n.g=f,n.b=c;break;case 1:n.r=u,n.g=a,n.b=c;break;case 2:n.r=c,n.g=a,n.b=f;break;case 3:n.r=c,n.g=u,n.b=a;break;case 4:n.r=f,n.g=c,n.b=a;break;default:n.r=a,n.g=c,n.b=u}}n.a=1},t.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},t.prototype.clone=function(){return e.SerializationHelper.Clone(function(){return new t},this)},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.Parse=function(i){return e.SerializationHelper.Parse(function(){return new t},i,null,null)},t}();n([e.serialize()],t.prototype,"_globalHue",void 0),n([e.serialize()],t.prototype,"_globalDensity",void 0),n([e.serialize()],t.prototype,"_globalSaturation",void 0),n([e.serialize()],t.prototype,"_globalExposure",void 0),n([e.serialize()],t.prototype,"_highlightsHue",void 0),n([e.serialize()],t.prototype,"_highlightsDensity",void 0),n([e.serialize()],t.prototype,"_highlightsSaturation",void 0),n([e.serialize()],t.prototype,"_highlightsExposure",void 0),n([e.serialize()],t.prototype,"_midtonesHue",void 0),n([e.serialize()],t.prototype,"_midtonesDensity",void 0),n([e.serialize()],t.prototype,"_midtonesSaturation",void 0),n([e.serialize()],t.prototype,"_midtonesExposure",void 0),e.ColorCurves=t}(r||(r={}));var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return o(t,e),t.prototype.setReflectionMode=function(e){for(var t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"],i=0,r=t;i<r.length;i++){var n=r[i];this[n]=n===e}},t}(e.MaterialDefines);e.StandardMaterialDefines=t;var i=function(i){function r(t,n){var o=i.call(this,t,n)||this;return o.ambientColor=new e.Color3(0,0,0),o.diffuseColor=new e.Color3(1,1,1),o.specularColor=new e.Color3(1,1,1),o.emissiveColor=new e.Color3(0,0,0),o.specularPower=64,o._useAlphaFromDiffuseTexture=!1,o._useEmissiveAsIllumination=!1,o._linkEmissiveWithDiffuse=!1,o._useSpecularOverAlpha=!1,o._useReflectionOverAlpha=!1,o._disableLighting=!1,o._useParallax=!1,o._useParallaxOcclusion=!1,o.parallaxScaleBias=.05,o._roughness=0,o.indexOfRefraction=.98,o.invertRefractionY=!0,o._useLightmapAsShadowmap=!1,o._useReflectionFresnelFromSpecular=!1,o._useGlossinessFromSpecularMapAlpha=!1,o._maxSimultaneousLights=4,o._invertNormalMapX=!1,o._invertNormalMapY=!1,o._twoSidedLighting=!1,o._renderTargets=new e.SmartArray(16),o._worldViewProjectionMatrix=e.Matrix.Zero(),o._globalAmbientColor=new e.Color3(0,0,0),o._attachImageProcessingConfiguration(null),o.getRenderTargetTextures=function(){return o._renderTargets.reset(),r.ReflectionTextureEnabled&&o._reflectionTexture&&o._reflectionTexture.isRenderTarget&&o._renderTargets.push(o._reflectionTexture),r.RefractionTextureEnabled&&o._refractionTexture&&o._refractionTexture.isRenderTarget&&o._renderTargets.push(o._refractionTexture),o._renderTargets},o}return o(r,i),Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(e){t._markAllSubMeshesAsImageProcessingDirty()}))},Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},r.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},r.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},r.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},r.prototype.isReadyForSubMesh=function(i,n,o){if(void 0===o&&(o=!1),n.effect&&this.isFrozen&&this._wasPreviouslyReady&&n.effect)return!0;n._materialDefines||(n._materialDefines=new t);var s=this.getScene(),a=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&a._renderId===s.getRenderId())return!0;var l=s.getEngine();if(a._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,a,!0,this._maxSimultaneousLights,this._disableLighting),a._areTexturesDirty){if(a._needUVs=!1,a.MAINUV1=!1,a.MAINUV2=!1,s.texturesEnabled){if(this._diffuseTexture&&r.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,a,"DIFFUSE")}else a.DIFFUSE=!1;if(this._ambientTexture&&r.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,a,"AMBIENT")}else a.AMBIENT=!1;if(this._opacityTexture&&r.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&r.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===e.Texture.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:a.setReflectionMode("REFLECTIONMAP_CUBIC");break;case e.Texture.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case e.Texture.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case e.Texture.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case e.Texture.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case e.Texture.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case e.Texture.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED")}}else a.REFLECTION=!1;if(this._emissiveTexture&&r.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(this._lightmapTexture&&r.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else a.LIGHTMAP=!1;if(this._specularTexture&&r.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,a,"SPECULAR"),a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&r.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,a,"BUMP"),a.PARALLAX=this._useParallax,a.PARALLAXOCCLUSION=this._useParallaxOcclusion}else a.BUMP=!1;if(this._refractionTexture&&r.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF}if(a._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a)}if(a._areFresnelDirty&&(r.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),e.MaterialHelper.PrepareDefinesForMisc(i,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,a),e.MaterialHelper.PrepareDefinesForAttributes(i,a,!0,!0,!0),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,l,a,o),a.isDirty){a.markAsProcessed(),s.resetCachedMaterial();var h=new e.EffectFallbacks;a.REFLECTION&&h.addFallback(0,"REFLECTION"),a.SPECULAR&&h.addFallback(0,"SPECULAR"),a.BUMP&&h.addFallback(0,"BUMP"),a.PARALLAX&&h.addFallback(1,"PARALLAX"),a.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&h.addFallback(1,"FOG"),a.POINTSIZE&&h.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(a,h,this._maxSimultaneousLights),a.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&h.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&h.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&h.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&h.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&h.addFallback(4,"FRESNEL");var c=[e.VertexBuffer.PositionKind];a.NORMAL&&c.push(e.VertexBuffer.NormalKind),a.UV1&&c.push(e.VertexBuffer.UVKind),a.UV2&&c.push(e.VertexBuffer.UV2Kind),a.VERTEXCOLOR&&c.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(c,i,a,h),e.MaterialHelper.PrepareAttributesForInstances(c,a),e.MaterialHelper.PrepareAttributesForMorphTargets(c,i,a);var u="default",f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","logarithmicDepthConstant","vTangentSpaceParams"],d=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"],p=["Material","Scene"];e.ImageProcessingConfiguration.PrepareUniforms(f,a),e.ImageProcessingConfiguration.PrepareSamplers(d,a),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,f,p,d,a));var m=a.toString();n.setEffect(s.getEngine().createEffect(u,{attributes:c,uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:m,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS}},l),a),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(a._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},r.prototype.unbind=function(){this._activeEffect&&(this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._activeEffect.setTexture("reflection2DSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._activeEffect.setTexture("refraction2DSampler",null)),i.prototype.unbind.call(this)},r.prototype.bindForSubMesh=function(t,i,n){var o=this.getScene(),s=n._materialDefines;if(s){var a=n.effect;if(a){this._activeEffect=a,this.bindOnlyWorldMatrix(t);var l=this._mustRebind(o,a,i.visibility);if(e.MaterialHelper.BindBonesParameters(i,a),l){if(this._uniformBuffer.bindToEffect(a,"Material"),this.bindViewProjection(a),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(r.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),o.texturesEnabled&&(this._diffuseTexture&&r.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),e.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),this._ambientTexture&&r.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),e.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&r.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),e.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix())),this._emissiveTexture&&r.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),e.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&r.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),e.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),this._specularTexture&&r.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),e.MaterialHelper.BindTextureMatrix(this._specularTexture,this._uniformBuffer,"specular")),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),e.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),o._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&r.RefractionTextureEnabled)){var h=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(h=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,h,this.invertRefractionY?-1:1)}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",this.emissiveColor),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility)}if(o.texturesEnabled&&(this._diffuseTexture&&r.DiffuseTextureEnabled&&a.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&r.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&r.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?a.setTexture("reflectionCubeSampler",this._reflectionTexture):a.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&r.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&r.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&r.SpecularTextureEnabled&&a.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&a.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&r.RefractionTextureEnabled)){var h=1;this._refractionTexture.isCube?a.setTexture("refractionCubeSampler",this._refractionTexture):a.setTexture("refraction2DSampler",this._refractionTexture)}e.MaterialHelper.BindClipPlane(a,o),o.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),e.MaterialHelper.BindEyePosition(a,o),a.setColor3("vAmbientColor",this._globalAmbientColor)}!l&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&e.MaterialHelper.BindLights(o,i,a,s,this._maxSimultaneousLights),(o.fogEnabled&&i.applyFog&&o.fogMode!==e.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(a),e.MaterialHelper.BindFogParameters(o,i,a),s.NUM_MORPH_INFLUENCERS&&e.MaterialHelper.BindMorphTargetParameters(i,a),e.MaterialHelper.BindLogDepth(s,a,o),this._imageProcessingConfiguration.applyByPostProcess||this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this._diffuseTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._emissiveTexture===e||(this._specularTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e))))))))},r.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,t)},r.prototype.clone=function(t){var i=this,n=e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this);return n.name=t,n.id=t,n},r.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},Object.defineProperty(r,"DiffuseTextureEnabled",{get:function(){return r._DiffuseTextureEnabled},set:function(t){r._DiffuseTextureEnabled!==t&&(r._DiffuseTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"AmbientTextureEnabled",{get:function(){return r._AmbientTextureEnabled},set:function(t){r._AmbientTextureEnabled!==t&&(r._AmbientTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"OpacityTextureEnabled",{get:function(){return r._OpacityTextureEnabled},set:function(t){r._OpacityTextureEnabled!==t&&(r._OpacityTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ReflectionTextureEnabled",{get:function(){return r._ReflectionTextureEnabled},set:function(t){r._ReflectionTextureEnabled!==t&&(r._ReflectionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"EmissiveTextureEnabled",{get:function(){return r._EmissiveTextureEnabled},set:function(t){r._EmissiveTextureEnabled!==t&&(r._EmissiveTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SpecularTextureEnabled",{get:function(){return r._SpecularTextureEnabled},set:function(t){r._SpecularTextureEnabled!==t&&(r._SpecularTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BumpTextureEnabled",{get:function(){return r._BumpTextureEnabled},set:function(t){r._BumpTextureEnabled!==t&&(r._BumpTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LightmapTextureEnabled",{get:function(){return r._LightmapTextureEnabled},set:function(t){r._LightmapTextureEnabled!==t&&(r._LightmapTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RefractionTextureEnabled",{get:function(){return r._RefractionTextureEnabled},set:function(t){r._RefractionTextureEnabled!==t&&(r._RefractionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ColorGradingTextureEnabled",{get:function(){return r._ColorGradingTextureEnabled},set:function(t){r._ColorGradingTextureEnabled!==t&&(r._ColorGradingTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"FresnelEnabled",{get:function(){return r._FresnelEnabled},set:function(t){r._FresnelEnabled!==t&&(r._FresnelEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),r}(e.PushMaterial);i._DiffuseTextureEnabled=!0,i._AmbientTextureEnabled=!0,i._OpacityTextureEnabled=!0,i._ReflectionTextureEnabled=!0,i._EmissiveTextureEnabled=!0,i._SpecularTextureEnabled=!0,i._BumpTextureEnabled=!0,i._LightmapTextureEnabled=!0,i._RefractionTextureEnabled=!0,i._ColorGradingTextureEnabled=!0,i._FresnelEnabled=!0,n([e.serializeAsTexture("diffuseTexture")],i.prototype,"_diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"diffuseTexture",void 0),n([e.serializeAsTexture("ambientTexture")],i.prototype,"_ambientTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),n([e.serializeAsTexture("opacityTexture")],i.prototype,"_opacityTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"opacityTexture",void 0),n([e.serializeAsTexture("reflectionTexture")],i.prototype,"_reflectionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),n([e.serializeAsTexture("emissiveTexture")],i.prototype,"_emissiveTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),n([e.serializeAsTexture("specularTexture")],i.prototype,"_specularTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularTexture",void 0),n([e.serializeAsTexture("bumpTexture")],i.prototype,"_bumpTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),n([e.serializeAsTexture("lightmapTexture")],i.prototype,"_lightmapTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"lightmapTexture",void 0),n([e.serializeAsTexture("refractionTexture")],i.prototype,"_refractionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),n([e.serializeAsColor3("ambient")],i.prototype,"ambientColor",void 0),n([e.serializeAsColor3("diffuse")],i.prototype,"diffuseColor",void 0),n([e.serializeAsColor3("specular")],i.prototype,"specularColor",void 0),n([e.serializeAsColor3("emissive")],i.prototype,"emissiveColor",void 0),n([e.serialize()],i.prototype,"specularPower",void 0),n([e.serialize("useAlphaFromDiffuseTexture")],i.prototype,"_useAlphaFromDiffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useAlphaFromDiffuseTexture",void 0),n([e.serialize("useEmissiveAsIllumination")],i.prototype,"_useEmissiveAsIllumination",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useEmissiveAsIllumination",void 0),n([e.serialize("linkEmissiveWithDiffuse")],i.prototype,"_linkEmissiveWithDiffuse",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkEmissiveWithDiffuse",void 0),n([e.serialize("useSpecularOverAlpha")],i.prototype,"_useSpecularOverAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),n([e.serialize("useReflectionOverAlpha")],i.prototype,"_useReflectionOverAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useReflectionOverAlpha",void 0),n([e.serialize("disableLighting")],i.prototype,"_disableLighting",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),n([e.serialize("useParallax")],i.prototype,"_useParallax",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),n([e.serialize("useParallaxOcclusion")],i.prototype,"_useParallaxOcclusion",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),n([e.serialize()],i.prototype,"parallaxScaleBias",void 0),n([e.serialize("roughness")],i.prototype,"_roughness",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),n([e.serialize()],i.prototype,"indexOfRefraction",void 0),n([e.serialize()],i.prototype,"invertRefractionY",void 0),n([e.serialize("useLightmapAsShadowmap")],i.prototype,"_useLightmapAsShadowmap",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),n([e.serializeAsFresnelParameters("diffuseFresnelParameters")],i.prototype,"_diffuseFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"diffuseFresnelParameters",void 0),n([e.serializeAsFresnelParameters("opacityFresnelParameters")],i.prototype,"_opacityFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"opacityFresnelParameters",void 0),n([e.serializeAsFresnelParameters("reflectionFresnelParameters")],i.prototype,"_reflectionFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"reflectionFresnelParameters",void 0),n([e.serializeAsFresnelParameters("refractionFresnelParameters")],i.prototype,"_refractionFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"refractionFresnelParameters",void 0),n([e.serializeAsFresnelParameters("emissiveFresnelParameters")],i.prototype,"_emissiveFresnelParameters",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"emissiveFresnelParameters",void 0),n([e.serialize("useReflectionFresnelFromSpecular")],i.prototype,"_useReflectionFresnelFromSpecular",void 0),n([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],i.prototype,"useReflectionFresnelFromSpecular",void 0),n([e.serialize("useGlossinessFromSpecularMapAlpha")],i.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useGlossinessFromSpecularMapAlpha",void 0),n([e.serialize("maxSimultaneousLights")],i.prototype,"_maxSimultaneousLights",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),n([e.serialize("invertNormalMapX")],i.prototype,"_invertNormalMapX",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),n([e.serialize("invertNormalMapY")],i.prototype,"_invertNormalMapY",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),n([e.serialize("twoSidedLighting")],i.prototype,"_twoSidedLighting",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),n([e.serialize()],i.prototype,"useLogarithmicDepth",null),e.StandardMaterial=i}(r||(r={}));var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.PBR=!0,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.ALBEDO=!1,t.ALBEDODIRECTUV=0,t.VERTEXCOLOR=!1,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.AMBIENTINGRAYSCALE=!1,t.OPACITY=!1,t.VERTEXALPHA=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHABLEND=!1,t.ALPHAFROMALBEDO=!1,t.ALPHATESTVALUE=.5,t.SPECULAROVERALPHA=!1,t.RADIANCEOVERALPHA=!1,t.ALPHAFRESNEL=!1,t.LINEARALPHAFRESNEL=!1,t.PREMULTIPLYALPHA=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITY=!1,t.REFLECTIVITYDIRECTUV=0,t.SPECULARTERM=!1,t.MICROSURFACEFROMREFLECTIVITYMAP=!1,t.MICROSURFACEAUTOMATIC=!1,t.LODBASEDMICROSFURACE=!1,t.MICROSURFACEMAP=!1,t.MICROSURFACEMAPDIRECTUV=0,t.METALLICWORKFLOW=!1,t.ROUGHNESSSTOREINMETALMAPALPHA=!1,t.ROUGHNESSSTOREINMETALMAPGREEN=!1,t.METALLNESSSTOREINMETALMAPBLUE=!1,t.AOSTOREINMETALMAPRED=!1,t.ENVIRONMENTBRDF=!1,t.NORMAL=!1,t.TANGENT=!1,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.NORMALXYSCALE=!0,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RADIANCEOCCLUSION=!1,t.HORIZONOCCLUSION=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFRACTIONMAP_OPPOSITEZ=!1,t.LODINREFRACTIONALPHA=!1,t.GAMMAREFRACTION=!1,t.LINKREFRACTIONTOTRANSPARENCY=!1,t.INSTANCES=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.NONUNIFORMSCALING=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.USEPHYSICALLIGHTFALLOFF=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.CLIPPLANE=!1,t.POINTSIZE=!1,t.FOG=!1,t.LOGARITHMICDEPTH=!1,t.FORCENORMALFORWARD=!1,t.rebuild(),t}return o(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.ALPHATESTVALUE=.5,this.PBR=!0},t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n._directIntensity=1,n._emissiveIntensity=1,n._environmentIntensity=1,n._specularIntensity=1,n._lightingInfos=new e.Vector4(n._directIntensity,n._emissiveIntensity,n._environmentIntensity,n._specularIntensity),n._disableBumpMap=!1,n._ambientTextureStrength=1,n._ambientColor=new e.Color3(0,0,0),n._albedoColor=new e.Color3(1,1,1),n._reflectivityColor=new e.Color3(1,1,1),n._reflectionColor=new e.Color3(1,1,1),n._emissiveColor=new e.Color3(0,0,0),n._microSurface=.9,n._indexOfRefraction=.66,n._invertRefractionY=!1,n._linkRefractionWithTransparency=!1,n._useLightmapAsShadowmap=!1,n._useHorizonOcclusion=!0,n._useRadianceOcclusion=!0,n._useAlphaFromAlbedoTexture=!1,n._useSpecularOverAlpha=!0,n._useMicroSurfaceFromReflectivityMapAlpha=!1,n._useRoughnessFromMetallicTextureAlpha=!0,n._useRoughnessFromMetallicTextureGreen=!1,n._useMetallnessFromMetallicTextureBlue=!1,n._useAmbientOcclusionFromMetallicTextureRed=!1,n._useAmbientInGrayScale=!1,n._useAutoMicroSurfaceFromReflectivityMap=!1,n._usePhysicalLightFalloff=!0,n._useRadianceOverAlpha=!0,n._useParallax=!1,n._useParallaxOcclusion=!1,n._parallaxScaleBias=.05,n._disableLighting=!1,n._maxSimultaneousLights=4,n._invertNormalMapX=!1,n._invertNormalMapY=!1,n._twoSidedLighting=!1,n._alphaCutOff=.4,n._forceAlphaTest=!1,n._useAlphaFresnel=!1,n._useLinearAlphaFresnel=!1,n._transparencyMode=null,n._environmentBRDFTexture=null,n._forceIrradianceInFragment=!1,n._forceNormalForward=!1,n._renderTargets=new e.SmartArray(16),n._globalAmbientColor=new e.Color3(0,0,0),n._attachImageProcessingConfiguration(null),n.getRenderTargetTextures=function(){return n._renderTargets.reset(),e.StandardMaterial.ReflectionTextureEnabled&&n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),e.StandardMaterial.RefractionTextureEnabled&&n._refractionTexture&&n._refractionTexture.isRenderTarget&&n._renderTargets.push(n._refractionTexture),n._renderTargets},n._environmentBRDFTexture=e.TextureTools.GetEnvironmentBRDFTexture(r),n}return o(r,i),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(e){t._markAllSubMeshesAsImageProcessingDirty()}))},r.prototype.getClassName=function(){return"PBRBaseMaterial"},Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"_disableAlphaBlending",{get:function(){return this._linkRefractionWithTransparency||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_OPAQUE||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())},r.prototype.needAlphaBlendingForMesh=function(e){return!this._disableAlphaBlending&&i.prototype.needAlphaBlendingForMesh.call(this,e)},r.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||!this._linkRefractionWithTransparency&&(null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&(null==this._transparencyMode||this._transparencyMode===e.PBRMaterial.PBRMATERIAL_ALPHATEST))},r.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this._albedoTexture&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==e.PBRMaterial.PBRMATERIAL_OPAQUE},r.prototype.getAlphaTestTexture=function(){return this._albedoTexture},r.prototype.isReadyForSubMesh=function(i,r,n){var o=this;if(r.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;r._materialDefines||(r._materialDefines=new t);var s=this.getScene(),a=r._materialDefines;if(!this.checkReadyOnEveryCall&&r.effect&&a._renderId===s.getRenderId())return!0;var l=s.getEngine();if(e.MaterialHelper.PrepareDefinesForLights(s,i,a,!0,this._maxSimultaneousLights,this._disableLighting),a._needNormals=!0,a._areTexturesDirty){if(a._needUVs=!1,s.texturesEnabled){if(s.getEngine().getCaps().textureLOD&&(a.LODBASEDMICROSFURACE=!0),this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,a,"ALBEDO")}else a.ALBEDO=!1;if(this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,a,"AMBIENT"),a.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale}else a.AMBIENT=!1;if(this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,a,"OPACITY"),a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;var h=this._getReflectionTexture();if(h&&e.StandardMaterial.ReflectionTextureEnabled){if(!h.isReadyOrNotBlocking())return!1;switch(a.REFLECTION=!0,a.GAMMAREFLECTION=h.gammaSpace,a.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!h.invertZ:h.invertZ,a.LODINREFLECTIONALPHA=h.lodLevelInAlpha,h.coordinatesMode===e.Texture.INVCUBIC_MODE&&(a.INVERTCUBICMAP=!0),a.REFLECTIONMAP_3D=h.isCube,h.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:a.REFLECTIONMAP_CUBIC=!0;break;case e.Texture.EXPLICIT_MODE:a.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:a.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:a.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:a.REFLECTIONMAP_SKYBOX=!0;break;case e.Texture.SPHERICAL_MODE:a.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0}h.coordinatesMode!==e.Texture.SKYBOX_MODE&&h.sphericalPolynomial&&(a.USESPHERICALFROMREFLECTIONMAP=!0,this._forceIrradianceInFragment||s.getEngine().getCaps().maxVaryingVectors<=8?a.USESPHERICALINVERTEX=!1:a.USESPHERICALINVERTEX=!0)}else a.REFLECTION=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.USESPHERICALFROMREFLECTIONMAP=!1,a.USESPHERICALINVERTEX=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1;if(this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,a,"LIGHTMAP"),a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else a.LIGHTMAP=!1;if(this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,a,"EMISSIVE")}else a.EMISSIVE=!1;if(e.StandardMaterial.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,a,"REFLECTIVITY"),a.METALLICWORKFLOW=!0,a.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,a.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,a.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,a.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed}else if(this._reflectivityTexture){if(!this._reflectivityTexture.isReadyOrNotBlocking())return!1;a.METALLICWORKFLOW=!1,e.MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,a,"REFLECTIVITY"),a.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,a.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap}else a.METALLICWORKFLOW=!1,a.REFLECTIVITY=!1;if(this._microSurfaceTexture){if(!this._microSurfaceTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,a,"MICROSURFACEMAP")}else a.MICROSURFACEMAP=!1}else a.REFLECTIVITY=!1,a.MICROSURFACEMAP=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap){if(!this._bumpTexture.isReady())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,a,"BUMP"),this._useParallax&&this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled?(a.PARALLAX=!0,a.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):a.PARALLAX=!1}else a.BUMP=!1;var c=this._getRefractionTexture();if(c&&e.StandardMaterial.RefractionTextureEnabled){if(!c.isReadyOrNotBlocking())return!1;a.REFRACTION=!0,a.REFRACTIONMAP_3D=c.isCube,a.GAMMAREFRACTION=c.gammaSpace,a.REFRACTIONMAP_OPPOSITEZ=h.invertZ,a.LODINREFRACTIONALPHA=h.lodLevelInAlpha,this._linkRefractionWithTransparency&&(a.LINKREFRACTIONTOTRANSPARENCY=!0)}else a.REFRACTION=!1;if(this._environmentBRDFTexture&&e.StandardMaterial.ReflectionTextureEnabled){if(!this._environmentBRDFTexture.isReady())return!1;a.ENVIRONMENTBRDF=!0}else a.ENVIRONMENTBRDF=!1;this._shouldUseAlphaFromAlbedoTexture()?a.ALPHAFROMALBEDO=!0:a.ALPHAFROMALBEDO=!1}a.SPECULAROVERALPHA=this._useSpecularOverAlpha,a.USEPHYSICALLIGHTFALLOFF=this._usePhysicalLightFalloff,a.RADIANCEOVERALPHA=this._useRadianceOverAlpha,void 0!==this._metallic&&null!==this._metallic||void 0!==this._roughness&&null!==this._roughness?a.METALLICWORKFLOW=!0:a.METALLICWORKFLOW=!1,!this.backFaceCulling&&this._twoSidedLighting?a.TWOSIDEDLIGHTING=!0:a.TWOSIDEDLIGHTING=!1,a.ALPHATESTVALUE=this._alphaCutOff,a.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,a.ALPHABLEND=this.needAlphaBlendingForMesh(i),a.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,a.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel}if(a._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a)}if(a.FORCENORMALFORWARD=this._forceNormalForward,a.RADIANCEOCCLUSION=this._useRadianceOcclusion,a.HORIZONOCCLUSION=this._useHorizonOcclusion,e.MaterialHelper.PrepareDefinesForMisc(i,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,a),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,l,a,!!n,this._forceAlphaTest),e.MaterialHelper.PrepareDefinesForAttributes(i,a,!0,!0,!0,this._transparencyMode!==e.PBRMaterial.PBRMATERIAL_OPAQUE)&&i){var u=null;if(i instanceof e.InstancedMesh?u=i.sourceMesh:i instanceof e.Mesh&&(u=i),u)if(u.isVerticesDataPresent(e.VertexBuffer.NormalKind)){var f=u.getVertexBuffer(e.VertexBuffer.NormalKind),d=f.getData(),p=f.getOffset(),m=f.getStrideSize(),g=p+r.indexStart*m;if(0===d[g]&&0===d[g+1]&&0===d[g+2]&&(a.NORMAL=!1),u.isVerticesDataPresent(e.VertexBuffer.TangentKind)){var v=u.getVertexBuffer(e.VertexBuffer.TangentKind),y=v.getData(),_=v.getOffset(),b=v.getStrideSize(),x=_+r.indexStart*b;0===y[x]&&0===y[x+1]&&0===y[x+2]&&(a.TANGENT=!1)}}else s.getEngine().getCaps().standardDerivatives||(u.createNormals(!0),e.Tools.Warn("PBRMaterial: Normals have been created for the mesh: "+u.name))}if(a.isDirty){a.markAsProcessed(),s.resetCachedMaterial();var T=new e.EffectFallbacks,E=0;a.USESPHERICALINVERTEX&&T.addFallback(E++,"USESPHERICALINVERTEX"),a.FOG&&T.addFallback(E,"FOG"),a.POINTSIZE&&T.addFallback(E,"POINTSIZE"),a.LOGARITHMICDEPTH&&T.addFallback(E,"LOGARITHMICDEPTH"),a.PARALLAX&&T.addFallback(E,"PARALLAX"),a.PARALLAXOCCLUSION&&T.addFallback(E++,"PARALLAXOCCLUSION"),a.ENVIRONMENTBRDF&&T.addFallback(E++,"ENVIRONMENTBRDF"),a.TANGENT&&T.addFallback(E++,"TANGENT"),a.BUMP&&T.addFallback(E++,"BUMP"),E=e.MaterialHelper.HandleFallbacksForShadows(a,T,this._maxSimultaneousLights,E++),a.SPECULARTERM&&T.addFallback(E++,"SPECULARTERM"),a.USESPHERICALFROMREFLECTIONMAP&&T.addFallback(E++,"USESPHERICALFROMREFLECTIONMAP"),a.LIGHTMAP&&T.addFallback(E++,"LIGHTMAP"),a.NORMAL&&T.addFallback(E++,"NORMAL"),a.AMBIENT&&T.addFallback(E++,"AMBIENT"),a.EMISSIVE&&T.addFallback(E++,"EMISSIVE"),a.VERTEXCOLOR&&T.addFallback(E++,"VERTEXCOLOR"),a.NUM_BONE_INFLUENCERS>0&&T.addCPUSkinningFallback(E++,i),a.MORPHTARGETS&&T.addFallback(E++,"MORPHTARGETS");var S=[e.VertexBuffer.PositionKind];a.NORMAL&&S.push(e.VertexBuffer.NormalKind),a.TANGENT&&S.push(e.VertexBuffer.TangentKind),a.UV1&&S.push(e.VertexBuffer.UVKind),a.UV2&&S.push(e.VertexBuffer.UV2Kind),a.VERTEXCOLOR&&S.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(S,i,a,T),e.MaterialHelper.PrepareAttributesForInstances(S,a),e.MaterialHelper.PrepareAttributesForMorphTargets(S,i,a);var w=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vReflectivityInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vReflectionMicrosurfaceInfos","vRefractionMicrosurfaceInfos","vTangentSpaceParams"],M=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","microSurfaceSampler","environmentBrdfSampler"],A=["Material","Scene"];e.ImageProcessingConfiguration.PrepareUniforms(w,a),e.ImageProcessingConfiguration.PrepareSamplers(M,a),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:w,uniformBuffersNames:A,samplers:M,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});var P=function(e){o.onCompiled&&o.onCompiled(e),o.bindSceneUniformBuffer(e,s.getSceneUniformBuffer())},C=a.toString();r.setEffect(s.getEngine().createEffect("pbr",{attributes:S,uniformsNames:w,uniformBuffersNames:A,samplers:M,defines:C,fallbacks:T,onCompiled:P,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS}},l),a),this.buildUniformLayout()}return!(!r.effect||!r.effect.isReady())&&(a._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vAlbedoInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",3),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vReflectivityInfos",3),this._uniformBuffer.addUniform("vMicroSurfaceSamplerInfos",2),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("albedoMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("reflectivityMatrix",16),this._uniformBuffer.addUniform("microSurfaceSamplerMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionColor",3),this._uniformBuffer.addUniform("vAlbedoColor",4),this._uniformBuffer.addUniform("vLightingIntensity",4),this._uniformBuffer.addUniform("vRefractionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("vReflectivityColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},r.prototype.unbind=function(){this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._uniformBuffer.setTexture("refractionSampler",null),i.prototype.unbind.call(this)},r.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;if(s){this._activeEffect=s,this.bindOnlyWorldMatrix(t);var a=this._mustRebind(n,s,i.visibility);e.MaterialHelper.BindBonesParameters(i,this._activeEffect);var l=null;if(a){this._uniformBuffer.bindToEffect(s,"Material"),this.bindViewProjection(s),l=this._getReflectionTexture();var h=this._getRefractionTexture();if(!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(n.texturesEnabled){if(this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),e.MaterialHelper.BindTextureMatrix(this._albedoTexture,this._uniformBuffer,"albedo")),this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat3("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength),e.MaterialHelper.BindTextureMatrix(this._ambientTexture,this._uniformBuffer,"ambient")),this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),e.MaterialHelper.BindTextureMatrix(this._opacityTexture,this._uniformBuffer,"opacity")),l&&e.StandardMaterial.ReflectionTextureEnabled){this._uniformBuffer.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",l.level,0);var c=l.sphericalPolynomial;o.USESPHERICALFROMREFLECTIONMAP&&c&&(this._activeEffect.setFloat3("vSphericalX",c.x.x,c.x.y,c.x.z),this._activeEffect.setFloat3("vSphericalY",c.y.x,c.y.y,c.y.z),this._activeEffect.setFloat3("vSphericalZ",c.z.x,c.z.y,c.z.z),this._activeEffect.setFloat3("vSphericalXX_ZZ",c.xx.x-c.zz.x,c.xx.y-c.zz.y,c.xx.z-c.zz.z),this._activeEffect.setFloat3("vSphericalYY_ZZ",c.yy.x-c.zz.x,c.yy.y-c.zz.y,c.yy.z-c.zz.z),this._activeEffect.setFloat3("vSphericalZZ",c.zz.x,c.zz.y,c.zz.z),this._activeEffect.setFloat3("vSphericalXY",c.xy.x,c.xy.y,c.xy.z),this._activeEffect.setFloat3("vSphericalYZ",c.yz.x,c.yz.y,c.yz.z),this._activeEffect.setFloat3("vSphericalZX",c.zx.x,c.zx.y,c.zx.z)),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset)}if(this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),e.MaterialHelper.BindTextureMatrix(this._emissiveTexture,this._uniformBuffer,"emissive")),this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),e.MaterialHelper.BindTextureMatrix(this._lightmapTexture,this._uniformBuffer,"lightmap")),e.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),e.MaterialHelper.BindTextureMatrix(this._metallicTexture,this._uniformBuffer,"reflectivity")):this._reflectivityTexture&&(this._uniformBuffer.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),e.MaterialHelper.BindTextureMatrix(this._reflectivityTexture,this._uniformBuffer,"reflectivity")),this._microSurfaceTexture&&(this._uniformBuffer.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),e.MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,this._uniformBuffer,"microSurfaceSampler"))),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),e.MaterialHelper.BindTextureMatrix(this._bumpTexture,this._uniformBuffer,"bump"),n._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),h&&e.StandardMaterial.RefractionTextureEnabled){this._uniformBuffer.updateMatrix("refractionMatrix",h.getReflectionTextureMatrix());var u=1;h.isCube||h.depth&&(u=h.depth),this._uniformBuffer.updateFloat4("vRefractionInfos",h.level,this._indexOfRefraction,u,this._invertRefractionY?-1:1),this._uniformBuffer.updateFloat3("vRefractionMicrosurfaceInfos",h.getSize().width,h.lodGenerationScale,h.lodGenerationOffset)}}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),o.METALLICWORKFLOW?(e.PBRMaterial._scaledReflectivity.r=void 0===this._metallic||null===this._metallic?1:this._metallic,e.PBRMaterial._scaledReflectivity.g=void 0===this._roughness||null===this._roughness?1:this._roughness,this._uniformBuffer.updateColor4("vReflectivityColor",e.PBRMaterial._scaledReflectivity,0)):this._uniformBuffer.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface),this._uniformBuffer.updateColor3("vEmissiveColor",this._emissiveColor),this._uniformBuffer.updateColor3("vReflectionColor",this._reflectionColor),this._uniformBuffer.updateColor4("vAlbedoColor",this._albedoColor,this.alpha*i.visibility),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity,this._lightingInfos.w=this._specularIntensity,this._uniformBuffer.updateVector4("vLightingIntensity",this._lightingInfos)}n.texturesEnabled&&(this._albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&this._uniformBuffer.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&this._uniformBuffer.setTexture("opacitySampler",this._opacityTexture),l&&e.StandardMaterial.ReflectionTextureEnabled&&(o.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("reflectionSampler",l):(this._uniformBuffer.setTexture("reflectionSampler",l._lodTextureMid||l),this._uniformBuffer.setTexture("reflectionSamplerLow",l._lodTextureLow||l),this._uniformBuffer.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l))),o.ENVIRONMENTBRDF&&this._uniformBuffer.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),h&&e.StandardMaterial.RefractionTextureEnabled&&(o.LODBASEDMICROSFURACE?this._uniformBuffer.setTexture("refractionSampler",h):(this._uniformBuffer.setTexture("refractionSampler",h._lodTextureMid||h),this._uniformBuffer.setTexture("refractionSamplerLow",h._lodTextureLow||h),this._uniformBuffer.setTexture("refractionSamplerHigh",h._lodTextureHigh||h))),this._emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&this._uniformBuffer.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&this._uniformBuffer.setTexture("lightmapSampler",this._lightmapTexture),e.StandardMaterial.SpecularTextureEnabled&&(this._metallicTexture?this._uniformBuffer.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&this._uniformBuffer.setTexture("reflectivitySampler",this._reflectivityTexture),this._microSurfaceTexture&&this._uniformBuffer.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&!this._disableBumpMap&&this._uniformBuffer.setTexture("bumpSampler",this._bumpTexture)),e.MaterialHelper.BindClipPlane(this._activeEffect,n),n.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);var f=n._forcedViewPosition?n._forcedViewPosition:n._mirroredCameraPosition?n._mirroredCameraPosition:n.activeCamera.globalPosition,d=n.useRightHandedSystem===(null!=n._mirroredCameraPosition);s.setFloat4("vEyePosition",f.x,f.y,f.z,d?-1:1),s.setColor3("vAmbientColor",this._globalAmbientColor)}!a&&this.isFrozen||(n.lightsEnabled&&!this._disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this._maxSimultaneousLights,this._usePhysicalLightFalloff),(n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE||l)&&this.bindView(s),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),o.NUM_MORPH_INFLUENCERS&&e.MaterialHelper.BindMorphTargetParameters(i,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect),e.MaterialHelper.BindLogDepth(o,this._activeEffect,n)),this._uniformBuffer.update(),this._afterBind(i)}}},r.prototype.getAnimatables=function(){var e=[];return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&e.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?e.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&e.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},r.prototype._getReflectionTexture=function(){return this._reflectionTexture?this._reflectionTexture:this.getScene().environmentTexture},r.prototype._getRefractionTexture=function(){return this._refractionTexture?this._refractionTexture:this._linkRefractionWithTransparency?this.getScene().environmentTexture:null},r.prototype.dispose=function(e,t){t&&(this._albedoTexture&&this._albedoTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._environmentBRDFTexture&&this.getScene()._environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._metallicTexture&&this._metallicTexture.dispose(),this._reflectivityTexture&&this._reflectivityTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,t)},r}(e.PushMaterial);i._scaledReflectivity=new e.Color3,n([e.serializeAsImageProcessingConfiguration()],i.prototype,"_imageProcessingConfiguration",void 0),n([e.serialize()],i.prototype,"useLogarithmicDepth",null),n([e.serialize()],i.prototype,"transparencyMode",null),e.PBRBaseMaterial=i}(r||(r={}));var r;!function(e){!function(t){var i=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n.maxSimultaneousLights=4,n.disableLighting=!1,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.emissiveColor=new e.Color3(0,0,0),n.occlusionStrength=1,n.useLightmapAsShadowmap=!1,n._useAlphaFromAlbedoTexture=!0,n._useAmbientInGrayScale=!0,n}return o(i,t),Object.defineProperty(i.prototype,"doubleSided",{get:function(){return this._twoSidedLighting},set:function(e){this._twoSidedLighting!==e&&(this._twoSidedLighting=e,this.backFaceCulling=!e,this._markAllSubMeshesAsTexturesDirty())},enumerable:!0,configurable:!0}),i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.environmentTexture&&e.push(this.environmentTexture),this.normalTexture&&e.push(this.normalTexture),this.emissiveTexture&&e.push(this.emissiveTexture),this.occlusionTexture&&e.push(this.occlusionTexture),this.lightmapTexture&&e.push(this.lightmapTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||this.lightmapTexture===e},i.prototype.getClassName=function(){return"PBRBaseSimpleMaterial"},i}(e.PBRBaseMaterial);n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectionTexture")],i.prototype,"environmentTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_bumpTexture")],i.prototype,"normalTexture",void 0),n([e.serializeAsColor3("emissive"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTextureStrength")],i.prototype,"occlusionStrength",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_ambientTexture")],i.prototype,"occlusionTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_alphaCutOff")],i.prototype,"alphaCutOff",void 0),n([e.serialize()],i.prototype,"doubleSided",null),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],i.prototype,"lightmapTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),t.PBRBaseSimpleMaterial=i}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r){var n=t.call(this,i,r)||this;return n.directIntensity=1,n.emissiveIntensity=1,n.environmentIntensity=1,n.specularIntensity=1,n.disableBumpMap=!1,n.ambientTextureStrength=1,n.ambientColor=new e.Color3(0,0,0),n.albedoColor=new e.Color3(1,1,1),n.reflectivityColor=new e.Color3(1,1,1),n.reflectionColor=new e.Color3(1,1,1),n.emissiveColor=new e.Color3(0,0,0),n.microSurface=1,n.indexOfRefraction=.66,n.invertRefractionY=!1,n.linkRefractionWithTransparency=!1,n.useLightmapAsShadowmap=!1,n.useAlphaFromAlbedoTexture=!1,n.forceAlphaTest=!1,n.alphaCutOff=.4,n.useSpecularOverAlpha=!0,n.useMicroSurfaceFromReflectivityMapAlpha=!1,n.useRoughnessFromMetallicTextureAlpha=!0,n.useRoughnessFromMetallicTextureGreen=!1,n.useMetallnessFromMetallicTextureBlue=!1,n.useAmbientOcclusionFromMetallicTextureRed=!1,n.useAmbientInGrayScale=!1,n.useAutoMicroSurfaceFromReflectivityMap=!1,n.usePhysicalLightFalloff=!0,n.useRadianceOverAlpha=!0,n.useParallax=!1,n.useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n.disableLighting=!1,n.forceIrradianceInFragment=!1,n.maxSimultaneousLights=4,n.invertNormalMapX=!1,n.invertNormalMapY=!1,n.twoSidedLighting=!1,n.useAlphaFresnel=!1,n.useLinearAlphaFresnel=!1,n.environmentBRDFTexture=null,n.forceNormalForward=!1,n.useHorizonOcclusion=!0,n.useRadianceOcclusion=!0,n._environmentBRDFTexture=e.TextureTools.GetEnvironmentBRDFTexture(r),n}return o(i,t),Object.defineProperty(i,"PBRMATERIAL_OPAQUE",{get:function(){return this._PBRMATERIAL_OPAQUE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"PBRMATERIAL_ALPHATEST",{get:function(){return this._PBRMATERIAL_ALPHATEST},enumerable:!0,configurable:!0}),Object.defineProperty(i,"PBRMATERIAL_ALPHABLEND",{get:function(){return this._PBRMATERIAL_ALPHABLEND},enumerable:!0,configurable:!0}),Object.defineProperty(i,"PBRMATERIAL_ALPHATESTANDBLEND",{get:function(){return this._PBRMATERIAL_ALPHATESTANDBLEND},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"PBRMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this._albedoTexture&&e.push(this._albedoTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._reflectivityTexture&&e.push(this._reflectivityTexture),this._metallicTexture&&e.push(this._metallicTexture),this._microSurfaceTexture&&e.push(this._microSurfaceTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this._albedoTexture===e||(this._ambientTexture===e||(this._opacityTexture===e||(this._reflectionTexture===e||(this._reflectivityTexture===e||(this._metallicTexture===e||(this._microSurfaceTexture===e||(this._bumpTexture===e||(this._lightmapTexture===e||this._refractionTexture===e)))))))))},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone(function(){return new i(t,r.getScene())},this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse(function(){return new i(t.name,r)},t,r,n)},i}(e.PBRBaseMaterial);t._PBRMATERIAL_OPAQUE=0,t._PBRMATERIAL_ALPHATEST=1,t._PBRMATERIAL_ALPHABLEND=2,t._PBRMATERIAL_ALPHATESTANDBLEND=3,n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"directIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"specularIntensity",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"disableBumpMap",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientTextureStrength",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallicTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurfaceTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],t.prototype,"lightmapTexture",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"refractionTexture",void 0),n([e.serializeAsColor3("ambient"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"ambientColor",void 0),n([e.serializeAsColor3("albedo"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"albedoColor",void 0),n([e.serializeAsColor3("reflectivity"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectivityColor",void 0),n([e.serializeAsColor3("reflection"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"reflectionColor",void 0),n([e.serializeAsColor3("emissive"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"emissiveColor",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"microSurface",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"indexOfRefraction",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertRefractionY",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"linkRefractionWithTransparency",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLightmapAsShadowmap",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFromAlbedoTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceAlphaTest",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"alphaCutOff",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useSpecularOverAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRoughnessFromMetallicTextureGreen",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useMetallnessFromMetallicTextureBlue",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAmbientInGrayScale",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"usePhysicalLightFalloff",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOverAlpha",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallax",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useParallaxOcclusion",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"parallaxScaleBias",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceIrradianceInFragment",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapX",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"invertNormalMapY",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"twoSidedLighting",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useAlphaFresnel",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useLinearAlphaFresnel",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"environmentBRDFTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"forceNormalForward",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useHorizonOcclusion",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"useRadianceOcclusion",void 0),e.PBRMaterial=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r._useRoughnessFromMetallicTextureAlpha=!1,r._useRoughnessFromMetallicTextureGreen=!0,r._useMetallnessFromMetallicTextureBlue=!0,r}return o(i,t),i.prototype.getClassName=function(){return"PBRMetallicRoughnessMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.baseTexture&&e.push(this.baseTexture),this.metallicRoughnessTexture&&e.push(this.metallicRoughnessTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this.baseTexture===e||this.metallicRoughnessTexture===e)},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone(function(){return new i(t,r.getScene())},this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRMetallicRoughnessMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse(function(){return new i(t.name,r)},t,r,n)},i}(e.Internals.PBRBaseSimpleMaterial);n([e.serializeAsColor3(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"baseColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"baseTexture",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"metallic",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],t.prototype,"roughness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_metallicTexture")],t.prototype,"metallicRoughnessTexture",void 0),e.PBRMetallicRoughnessMaterial=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r._useMicroSurfaceFromReflectivityMapAlpha=!0,r}return o(i,t),i.prototype.getClassName=function(){return"PBRSpecularGlossinessMaterial"},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);return this.diffuseTexture&&e.push(this.diffuseTexture),this.specularGlossinessTexture&&e.push(this.specularGlossinessTexture),e},i.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)||(this.diffuseTexture===e||this.specularGlossinessTexture===e)},i.prototype.clone=function(t){var r=this,n=e.SerializationHelper.Clone(function(){return new i(t,r.getScene())},this);return n.id=t,n.name=t,n},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRSpecularGlossinessMaterial",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse(function(){return new i(t.name,r)},t,r,n)},i}(e.Internals.PBRBaseSimpleMaterial);n([e.serializeAsColor3("diffuse"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoColor")],t.prototype,"diffuseColor",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_albedoTexture")],t.prototype,"diffuseTexture",void 0),n([e.serializeAsColor3("specular"),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityColor")],t.prototype,"specularColor",void 0),n([e.serialize(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_microSurface")],t.prototype,"glossiness",void 0),n([e.serializeAsTexture(),e.expandToProperty("_markAllSubMeshesAsTexturesDirty","_reflectivityTexture")],t.prototype,"specularGlossinessTexture",void 0),e.PBRSpecularGlossinessMaterial=t}(r||(r={}));var r;!function(e){e.CameraInputTypes={};var t=function(){function t(e){this.attached={},this.camera=e,this.checkInputs=function(){}}return t.prototype.add=function(t){var i=t.getSimpleName();if(this.attached[i])return void e.Tools.Warn("camera input of type "+i+" already exists on camera");this.attached[i]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedElement&&t.attachControl(this.attachedElement)},t.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[t];i===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},t.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[t];i.getClassName()===e&&(i.detachControl(this.attachedElement),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},t.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},t.prototype.attachInput=function(e){this.attachedElement&&e.attachControl(this.attachedElement,this.noPreventDefault)},t.prototype.attachElement=function(t,i){if(void 0===i&&(i=!1),!this.attachedElement){i=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&i,this.attachedElement=t,this.noPreventDefault=i;for(var r in this.attached)this.attached[r].attachControl(t,i)}},t.prototype.detachElement=function(e,t){if(void 0===t&&(t=!1),this.attachedElement===e){for(var i in this.attached)this.attached[i].detachControl(e),t&&(this.attached[i].camera=null);this.attachedElement=null}},t.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var e in this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},t.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement,!0),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},t.prototype.serialize=function(t){var i={};for(var r in this.attached){var n=this.attached[r],o=e.SerializationHelper.Serialize(n);i[n.getClassName()]=o}t.inputsmgr=i},t.prototype.parse=function(t){var i=t.inputsmgr;if(i){this.clear();for(var r in i){var n=e.CameraInputTypes[r];if(n){var o=i[r],s=e.SerializationHelper.Parse(function(){return new n},o,null);this.add(s)}}}else for(var r in this.attached){var n=e.CameraInputTypes[this.attached[r].getClassName()];if(n){var s=e.SerializationHelper.Parse(function(){return new n},t,null);this.remove(this.attached[r]),this.add(s)}}},t}();e.CameraInputsManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){void 0===e&&(e=!0),this.touchEnabled=e,this.buttons=[0,1,2],this.angularSensibility=2e3,this.previousPosition=null}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getEngine();this._pointerInput||(this._pointerInput=function(o,s){var a=o.event;if(!n.isInVRExclusivePointerMode&&(r.touchEnabled||"touch"!==a.pointerType)&&(o.type===e.PointerEventTypes.POINTERMOVE||-1!==r.buttons.indexOf(a.button))){var l=a.srcElement||a.target;if(o.type===e.PointerEventTypes.POINTERDOWN&&l){try{l.setPointerCapture(a.pointerId)}catch(e){}r.previousPosition={x:a.clientX,y:a.clientY},i||(a.preventDefault(),t.focus())}else if(o.type===e.PointerEventTypes.POINTERUP&&l){try{l.releasePointerCapture(a.pointerId)}catch(e){}r.previousPosition=null,i||a.preventDefault()}else if(o.type===e.PointerEventTypes.POINTERMOVE){if(!r.previousPosition||n.isPointerLock)return;var h=a.clientX-r.previousPosition.x,c=a.clientY-r.previousPosition.y;r.camera.getScene().useRightHandedSystem?r.camera.cameraRotation.y-=h/r.angularSensibility:r.camera.cameraRotation.y+=h/r.angularSensibility,r.camera.cameraRotation.x+=c/r.angularSensibility,r.previousPosition={x:a.clientX,y:a.clientY},i||a.preventDefault()}}}),this._onMouseMove=function(e){if(n.isPointerLock&&!n.isInVRExclusivePointerMode){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,o=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;r.camera.getScene().useRightHandedSystem?r.camera.cameraRotation.y-=t/r.angularSensibility:r.camera.cameraRotation.y+=t/r.angularSensibility,r.camera.cameraRotation.x+=o/r.angularSensibility,r.previousPosition=null,i||e.preventDefault()}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),t.addEventListener("mousemove",this._onMouseMove,!1)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._onMouseMove&&e.removeEventListener("mousemove",this._onMouseMove),this._observer=null,this._onMouseMove=null,this.previousPosition=null)},t.prototype.getClassName=function(){return"FreeCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},t}();n([e.serialize()],t.prototype,"buttons",void 0),n([e.serialize()],t.prototype,"angularSensibility",void 0),e.FreeCameraMouseInput=t,e.CameraInputTypes.FreeCameraMouseInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._keys=new Array,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return t.prototype.attachControl=function(t,i){var r=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){r._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var n=t.event;if(t.type===e.KeyboardEventTypes.KEYDOWN){if(-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)){var o=r._keys.indexOf(n.keyCode);-1===o&&r._keys.push(n.keyCode),i||n.preventDefault()}}else if(-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)){var o=r._keys.indexOf(n.keyCode);o>=0&&r._keys.splice(o,1),i||n.preventDefault()}}))},t.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,i=0;i<this._keys.length;i++){var r=this._keys[i],n=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(r)?t._localDirection.copyFromFloats(-n,0,0):-1!==this.keysUp.indexOf(r)?t._localDirection.copyFromFloats(0,0,n):-1!==this.keysRight.indexOf(r)?t._localDirection.copyFromFloats(n,0,0):-1!==this.keysDown.indexOf(r)&&t._localDirection.copyFromFloats(0,0,-n),t.getScene().useRightHandedSystem&&(t._localDirection.z*=-1),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),e.Vector3.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},t.prototype.getClassName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(e){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},t}();n([e.serialize()],t.prototype,"keysUp",void 0),n([e.serialize()],t.prototype,"keysDown",void 0),n([e.serialize()],t.prototype,"keysLeft",void 0),n([e.serialize()],t.prototype,"keysRight",void 0),e.FreeCameraKeyboardMoveInput=t,e.CameraInputTypes.FreeCameraKeyboardMoveInput=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e){return t.call(this,e)||this}return o(i,t),i.prototype.addKeyboard=function(){return this.add(new e.FreeCameraKeyboardMoveInput),this},i.prototype.addMouse=function(t){return void 0===t&&(t=!0),this.add(new e.FreeCameraMouseInput(t)),this},i.prototype.addGamepad=function(){return this.add(new e.FreeCameraGamepadInput),this},i.prototype.addDeviceOrientation=function(){return this.add(new e.FreeCameraDeviceOrientationInput),this},i.prototype.addTouch=function(){return this.add(new e.FreeCameraTouchInput),this},i.prototype.addVirtualJoystick=function(){return this.add(new e.FreeCameraVirtualJoystickInput),this},i}(e.CameraInputsManager);e.FreeCameraInputsManager=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n){var o=t.call(this,i,r,n)||this;return o.cameraDirection=new e.Vector3(0,0,0),o.cameraRotation=new e.Vector2(0,0),o.rotation=new e.Vector3(0,0,0),o.speed=2,o.noRotationConstraint=!1,o.lockedTarget=null,o._currentTarget=e.Vector3.Zero(),o._viewMatrix=e.Matrix.Zero(),o._camMatrix=e.Matrix.Zero(),o._cameraTransformMatrix=e.Matrix.Zero(),o._cameraRotationMatrix=e.Matrix.Zero(),o._referencePoint=new e.Vector3(0,0,1),o._currentUpVector=new e.Vector3(0,1,0),o._transformedReferencePoint=e.Vector3.Zero(),o._lookAtTemp=e.Matrix.Zero(),o._tempMatrix=e.Matrix.Zero(),o}return o(i,t),i.prototype.getFrontPosition=function(e){var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},i.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),t.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new e.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},i.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(100*e.getFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this.upVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(e.Tmp.Matrix[0]),e.Vector3.TransformNormalToRef(this.cameraDirection,e.Tmp.Matrix[0],e.Tmp.Vector3[0]),void this.position.addInPlace(e.Tmp.Vector3[0]);this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),r=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),r){if(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,this.rotationQuaternion){this.rotation.lengthSquared()&&e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}if(!this.noRotationConstraint){var n=Math.PI/2*.95;this.rotation.x>n&&(this.rotation.x=n),this.rotation.x<-n&&(this.rotation.x=-n)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*e.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*e.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*e.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),r&&(Math.abs(this.cameraRotation.x)<this.speed*e.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*e.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},i.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix),e.Vector3.TransformNormalToRef(this.upVector,this._cameraRotationMatrix,this._currentUpVector)},i.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.getScene().useRightHandedSystem?e.Matrix.LookAtRHToRef(this.position,this._currentTarget,this._currentUpVector,this._viewMatrix):e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this._currentUpVector,this._viewMatrix),this._viewMatrix},i.prototype.createRigCamera=function(t,r){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var n=new i(t,this.position.clone(),this.getScene());return this.cameraRigMode!==e.Camera.RIG_MODE_VR&&this.cameraRigMode!==e.Camera.RIG_MODE_WEBVR||(this.rotationQuaternion||(this.rotationQuaternion=new e.Quaternion),n._cameraRigParams={},n.rotationQuaternion=new e.Quaternion),n}return null},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],r=this._rigCameras[1];switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var n=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*n,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*o,r.position),i.setTarget(this.getTarget()),r.setTarget(this.getTarget());break;case e.Camera.RIG_MODE_VR:i.rotationQuaternion?(i.rotationQuaternion.copyFrom(this.rotationQuaternion),r.rotationQuaternion.copyFrom(this.rotationQuaternion)):(i.rotation.copyFrom(this.rotation),r.rotation.copyFrom(this.rotation)),i.position.copyFrom(this.position),r.position.copyFrom(this.position)}t.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPosition=function(t,i){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var r=this.getTarget();e.Matrix.Translation(-r.x,-r.y,-r.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(r.x,r.y,r.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,i)},i.prototype.getClassName=function(){return"TargetCamera"},i}(e.Camera);n([e.serializeAsVector3()],t.prototype,"rotation",void 0),n([e.serialize()],t.prototype,"speed",void 0),n([e.serializeAsMeshReference("lockedTargetId")],t.prototype,"lockedTarget",void 0),e.TargetCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n){var o=t.call(this,i,r,n)||this;return o.ellipsoid=new e.Vector3(.5,1,.5),o.ellipsoidOffset=new e.Vector3(0,0,0),o.checkCollisions=!1,o.applyGravity=!1,o._needMoveForGravity=!1,o._oldPosition=e.Vector3.Zero(),o._diffPosition=e.Vector3.Zero(),o._newPosition=e.Vector3.Zero(),o._collisionMask=-1,o._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider._radius);!function(t){o._newPosition.copyFrom(t),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&r&&o.onCollide(r))}(i)},o.inputs=new e.FreeCameraInputsManager(o),o.inputs.addKeyboard().addMouse(),o}return o(i,t),Object.defineProperty(i.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),i.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},i.prototype.detachControl=function(t){this.inputs.detachElement(t),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0)},Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),i.prototype._collideWithWorld=function(t){var i;i=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset),this._collider||(this._collider=new e.Collider),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;var r=t;this.applyGravity&&(r=t.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,r,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):t.prototype._updatePosition.call(this)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"FreeCamera"},i}(e.TargetCamera);n([e.serializeAsVector3()],t.prototype,"ellipsoid",void 0),n([e.serializeAsVector3()],t.prototype,"ellipsoidOffset",void 0),n([e.serialize()],t.prototype,"checkCollisions",void 0),n([e.serialize()],t.prototype,"applyGravity",void 0),e.FreeCamera=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._keys=new Array,this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0}return t.prototype.attachControl=function(t,i){var r=this;this._onCanvasBlurObserver||(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){r._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(t){var n=t.event;if(t.type===e.KeyboardEventTypes.KEYDOWN){if(r._ctrlPressed=n.ctrlKey,r._altPressed=n.altKey,-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)||-1!==r.keysReset.indexOf(n.keyCode)){var o=r._keys.indexOf(n.keyCode);-1===o&&r._keys.push(n.keyCode),n.preventDefault&&(i||n.preventDefault())}}else if(-1!==r.keysUp.indexOf(n.keyCode)||-1!==r.keysDown.indexOf(n.keyCode)||-1!==r.keysLeft.indexOf(n.keyCode)||-1!==r.keysRight.indexOf(n.keyCode)||-1!==r.keysReset.indexOf(n.keyCode)){var o=r._keys.indexOf(n.keyCode);o>=0&&r._keys.splice(o,1),n.preventDefault&&(i||n.preventDefault())}}))},t.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},t.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(i)?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=.01:-1!==this.keysReset.indexOf(i)&&e.restoreState()}},t.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},t}();n([e.serialize()],t.prototype,"keysUp",void 0),n([e.serialize()],t.prototype,"keysDown",void 0),n([e.serialize()],t.prototype,"keysLeft",void 0),n([e.serialize()],t.prototype,"keysRight",void 0),n([e.serialize()],t.prototype,"keysReset",void 0),n([e.serialize()],t.prototype,"panningSensibility",void 0),n([e.serialize()],t.prototype,"zoomingSensibility",void 0),n([e.serialize()],t.prototype,"useAltToZoom",void 0),e.ArcRotateCameraKeyboardMoveInput=t,e.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return t.prototype.attachControl=function(t,i){var r=this;this._wheel=function(t,n){if(t.type===e.PointerEventTypes.POINTERWHEEL){var o=t.event,s=0;o.wheelDelta?s=r.wheelDeltaPercentage?.01*o.wheelDelta*r.camera.radius*r.wheelDeltaPercentage:o.wheelDelta/(40*r.wheelPrecision):o.detail&&(s=-o.detail/r.wheelPrecision),s&&(r.camera.inertialRadiusOffset+=s),o.preventDefault&&(i||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,e.PointerEventTypes.POINTERWHEEL)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},t}();n([e.serialize()],t.prototype,"wheelPrecision",void 0),n([e.serialize()],t.prototype,"wheelDeltaPercentage",void 0),e.ArcRotateCameraMouseWheelInput=t,e.CameraInputTypes.ArcRotateCameraMouseWheelInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.panningSensibility=150,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this._isPanClick=!1,this.pinchInwards=!0,this.points={}}return t.prototype.attachControl=function(t,i){var r,n=this,o=this.camera.getEngine(),s=null,a=null,l=0,h=0,c=0,u=0,f=0,d={x:0,y:0,isPaning:!1,isPinching:!1};this._pointerInput=function(p,m){var g=p.event,v="touch"===p.event.pointerType;if(!o.isInVRExclusivePointerMode&&(p.type===e.PointerEventTypes.POINTERMOVE||-1!==n.buttons.indexOf(g.button))){var y=g.srcElement||g.target;if(p.type===e.PointerEventTypes.POINTERDOWN&&y){0===n.getSizeOfPoints()&&(window.addEventListener("touchend",n.onTouchUp,!0),window.addEventListener("pointerup",n.onPointerUp,!0));var _=g.pointerId||g.identifier;_&&(n.points[_]=g);try{y.setPointerCapture(g.pointerId)}catch(e){}n._isPanClick=g.button===n.camera._panningMouseButton,r={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType},null===s?s=r:null===a&&(a=r),i||(g.preventDefault(),t.focus())}else if(p.type===e.PointerEventTypes.POINTERDOUBLETAP)n.camera.restoreState();else if(p.type===e.PointerEventTypes.POINTERUP&&y){try{y.releasePointerCapture(g.pointerId)}catch(e){}r=null,l=0,d.isPaning=!1,d.isPinching=!1,f=0,u=0,v||(a=null),n.getSizeOfPoints()<=1&&(h=0,c=0),o.badOS?s=a=null:a&&s&&s.pointerId==g.pointerId?(s=a,a=null,r={x:s.x,y:s.y,pointerId:s.pointerId,type:g.pointerType}):s&&a&&a.pointerId==g.pointerId?(a=null,r={x:s.x,y:s.y,pointerId:s.pointerId,type:g.pointerType}):s=a=null,i||g.preventDefault()}else if(p.type===e.PointerEventTypes.POINTERMOVE){i||g.preventDefault();var b=(Math.tan(n.camera.fov),e.Vector3.Distance(n.camera.getTarget(),n.camera.position)),x=n.camera.viewport.width*b/75;if(s&&null===a&&r){if(0!==n.panningSensibility&&(g.ctrlKey&&n.camera._useCtrlForPanning||!n.camera._useCtrlForPanning&&n._isPanClick))n.camera.inertialPanningX+=-(g.clientX-r.x)/n.panningSensibility*x,n.camera.inertialPanningY+=(g.clientY-r.y)/n.panningSensibility*x;else{var T=g.clientX-r.x,E=g.clientY-r.y;n.camera.inertialAlphaOffset-=T/n.angularSensibilityX,n.camera.inertialBetaOffset-=E/n.angularSensibilityY}r.x=g.clientX,r.y=g.clientY}else if(s&&a&&s.pointerId){if(s.pointerId===a.pointerId)return void(a=void 0);if(n.getSizeOfPoints()>2){var _=g.pointerId||g.identifier;r.pointerId===_&&(n.camera.inertialPanningX+=-(g.clientX-r.x)/n.panningSensibility*x,n.camera.inertialPanningY+=(g.clientY-r.y)/n.panningSensibility*x,r.x=g.clientX,r.y=g.clientY)}else if(2===n.getSizeOfPoints()){var S=s.pointerId===g.pointerId?s:a;S.x=g.clientX,S.y=g.clientY;var w=n.pinchInwards?1:-1,M=s.x-a.x,A=s.y-a.y,P=M*M+A*A,C=Math.sqrt(P);if(0===h)return h=P,c=n.camera.radius,void(n.camera.targetRadius=c);var R=P/h;n.camera.targetRadius=(n.camera.targetRadius||n.camera.radius)/R,h=P}else{if(s={x:g.clientX,y:g.clientY,pointerId:g.pointerId,type:g.pointerType},a=void 0,f++,d.isPinching||f<20&&Math.abs(C-u)>n.camera.pinchToPanMaxDistance)n.pinchDeltaPercentage?n.camera.inertialRadiusOffset+=.001*(P-l)*n.camera.radius*n.pinchDeltaPercentage:n.camera.inertialRadiusOffset+=(P-l)/(n.pinchPrecision*((n.angularSensibilityX+n.angularSensibilityY)/2)*w),d.isPaning=!1,d.isPinching=!0;else if(r&&r.pointerId===S.pointerId&&0!==n.panningSensibility&&n.multiTouchPanning){if(!d.isPaning)return d.isPaning=!0,d.isPinching=!1,d.x=S.x,void(d.y=S.y);n.camera.inertialPanningX+=-(S.x-d.x)/n.panningSensibility,n.camera.inertialPanningY+=(S.y-d.y)/n.panningSensibility}r&&r.pointerId===g.pointerId&&(d.x=S.x,d.y=S.y)}l=P}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE|e.PointerEventTypes._POINTERDOUBLETAP),this._onContextMenu=function(e){e.preventDefault()},this.camera._useCtrlForPanning||t.addEventListener("contextmenu",this._onContextMenu,!1),this.onTouchUp=function(e){for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t],r=i.pointerId||i.identifier;delete n.points[r]}},this.onPointerUp=function(e){var t=e.pointerId;delete n.points[t]},this._onLostFocus=function(){s=a=null,l=0,d.isPaning=!1,d.isPinching=!1,f=0,r=null,u=0},this._onMouseMove=function(e){if(o.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,r=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;n.camera.inertialAlphaOffset-=t/n.angularSensibilityX,n.camera.inertialBetaOffset-=r/n.angularSensibilityY,i||e.preventDefault()}},this._onGestureStart=function(e){void 0!==window.MSGesture&&(n._MSGestureHandler||(n._MSGestureHandler=new MSGesture,n._MSGestureHandler.target=t),n._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){n.camera.radius*=e.scale,e.preventDefault&&(i||(e.stopPropagation(),e.preventDefault()))},t.addEventListener("mousemove",this._onMouseMove,!1),t.addEventListener("MSPointerDown",this._onGestureStart,!1),t.addEventListener("MSGestureChange",this._onGesture,!1),e.Tools.RegisterTopRootEvents([{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(t){this._onLostFocus&&e.Tools.UnregisterTopRootEvents([{name:"blur",handler:this._onLostFocus}]),t&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._onContextMenu&&t.removeEventListener("contextmenu",this._onContextMenu),this._onMouseMove&&t.removeEventListener("mousemove",this._onMouseMove),this._onGestureStart&&t.removeEventListener("MSPointerDown",this._onGestureStart),this._onGesture&&t.removeEventListener("MSGestureChange",this._onGesture),this._isPanClick=!1,this.pinchInwards=!0,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null)},t.prototype.getSizeOfPoints=function(){var e=0;for(var t in this.points)e++;return e},t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.getSimpleName=function(){return"pointers"},t}();n([e.serialize()],t.prototype,"buttons",void 0),n([e.serialize()],t.prototype,"angularSensibilityX",void 0),n([e.serialize()],t.prototype,"angularSensibilityY",void 0),n([e.serialize()],t.prototype,"pinchPrecision",void 0),n([e.serialize()],t.prototype,"pinchDeltaPercentage",void 0),n([e.serialize()],t.prototype,"panningSensibility",void 0),n([e.serialize()],t.prototype,"multiTouchPanAndZoom",void 0),e.ArcRotateCameraPointersInput=t,e.CameraInputTypes.ArcRotateCameraPointersInput=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a){var l=t.call(this,i,e.Vector3.Zero(),a)||this;return l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=e.Vector3.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=e.Vector2.Zero(),l.allowUpsideDown=!0,l._viewMatrix=new e.Matrix,l.panningAxis=new e.Vector3(1,1,0),l.onMeshTargetChangedObservable=new e.Observable,l.checkCollisions=!1,l.collisionRadius=new e.Vector3(.5,.5,.5),l._previousPosition=e.Vector3.Zero(),l._collisionVelocity=e.Vector3.Zero(),l._newPosition=e.Vector3.Zero(),l._onCollisionPositionChange=function(t,i,r){void 0===r&&(r=null),l.getScene().workerCollisions&&l.checkCollisions&&i.multiplyInPlace(l._collider._radius),r?(l.setPosition(i),l.onCollide&&l.onCollide(r)):l._previousPosition.copyFrom(l.position);var n=Math.cos(l.alpha),o=Math.sin(l.alpha),s=Math.cos(l.beta),a=Math.sin(l.beta);0===a&&(a=1e-4);var h=l._getTargetPosition();h.addToRef(new e.Vector3(l.radius*n*a,l.radius*s,l.radius*o*a),l._newPosition),l.position.copyFrom(l._newPosition);var c=l.upVector;l.allowUpsideDown&&l.beta<0&&(c=c.clone(),c=c.negate()),e.Matrix.LookAtLHToRef(l.position,h,c,l._viewMatrix),l._viewMatrix.m[12]+=l.targetScreenOffset.x,l._viewMatrix.m[13]+=l.targetScreenOffset.y,l._collisionTriggered=!1},l._target=e.Vector3.Zero(),s&&l.setTarget(s),l.alpha=r,l.beta=n,l.radius=o,l.getViewMatrix(),l.inputs=new e.ArcRotateCameraInputsManager(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return o(i,t),Object.defineProperty(i.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useBouncingBehavior",{get:function(){return null!=this._bouncingBehavior},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new e.BouncingBehavior,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useFramingBehavior",{get:function(){return null!=this._framingBehavior},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new e.FramingBehavior,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"useAutoRotationBehavior",{get:function(){return null!=this._autoRotationBehavior},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new e.AutoRotationBehavior,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!0,configurable:!0}),i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache._target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=e.Vector2.Zero()},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},i.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}return this._target},i.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),t.prototype.storeState.call(this)},i.prototype._restoreStateValues=function(){return!!t.prototype._restoreStateValues.call(this)&&(this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.setTarget(this._storedTarget.clone()),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},i.prototype.attachControl=function(e,t,i,r){var n=this;void 0===i&&(i=!0),void 0===r&&(r=2),this._useCtrlForPanning=i,this._panningMouseButton=r,this.inputs.attachElement(e,t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0,n.inertialPanningX=0,n.inertialPanningY=0}},i.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},i.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.getScene().useRightHandedSystem?this.alpha-=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset:this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.Epsilon&&(this.inertialRadiusOffset=0)),0!==this.inertialPanningX||0!==this.inertialPanningY){if(this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var i=e.Vector3.DistanceSquared(this._transformedDirection,this.panningOriginTarget);i<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.Epsilon&&(this.inertialPanningY=0)}this._checkLimits(),t.prototype._checkInputs.call(this)}},i.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},i.prototype.rebuildAnglesAndRadius=function(){var e=this.position.subtract(this._getTargetPosition());this.radius=e.length(),0===this.radius&&(this.radius=1e-4),this.alpha=Math.acos(e.x/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2))),e.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(e.y/this.radius),this._checkLimits()},i.prototype.setPosition=function(e){this.position.equals(e)||(this.position.copyFrom(e),this.rebuildAnglesAndRadius())},i.prototype.setTarget=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),e.getBoundingInfo)this._targetBoundingCenter=t?e.getBoundingInfo().boundingBox.centerWorld.clone():null,this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var r=e,n=this._getTargetPosition();if(n&&!i&&n.equals(r))return;this._targetHost=null,this._target=r,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},i.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),r=Math.cos(this.beta),n=Math.sin(this.beta);0===n&&(n=1e-4);var o=this._getTargetPosition();if(o.addToRef(new e.Vector3(this.radius*t*n,this.radius*r,this.radius*i*n),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider||(this._collider=new e.Collider),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&n<0&&(s=s.clone(),s=s.negate()),this.getScene().useRightHandedSystem?e.Matrix.LookAtRHToRef(this.position,o,s,this._viewMatrix):e.Matrix.LookAtLHToRef(this.position,o,s,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._currentTarget=o,this._viewMatrix},i.prototype.zoomOn=function(t,i){void 0===i&&(i=!1),t=t||this.getScene().meshes;var r=e.Mesh.MinMax(t),n=e.Vector3.Distance(r.min,r.max);this.radius=n*this.zoomOnFactor,this.focusOn({min:r.min,max:r.max,distance:n},i)},i.prototype.focusOn=function(t,i){void 0===i&&(i=!1);var r,n;if(void 0===t.min){var o=t||this.getScene().meshes;r=e.Mesh.MinMax(o),n=e.Vector3.Distance(r.min,r.max)}else{var s=t;r=s,n=s.distance}this._target=e.Mesh.Center(r),i||(this.maxZ=2*n)},i.prototype.createRigCamera=function(t,r){var n=0;switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(0===r?1:-1);break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(0===r?-1:1)}var o=new i(t,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return o._cameraRigParams={},o},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],r=this._rigCameras[1];switch(i.beta=r.beta=this.beta,i.radius=r.radius=this.radius,this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,r.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}t.prototype._updateRigCameras.call(this)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getClassName=function(){return"ArcRotateCamera"},i}(e.TargetCamera);n([e.serialize()],t.prototype,"alpha",void 0),n([e.serialize()],t.prototype,"beta",void 0),n([e.serialize()],t.prototype,"radius",void 0),n([e.serializeAsVector3("target")],t.prototype,"_target",void 0),n([e.serialize()],t.prototype,"inertialAlphaOffset",void 0),n([e.serialize()],t.prototype,"inertialBetaOffset",void 0),n([e.serialize()],t.prototype,"inertialRadiusOffset",void 0),n([e.serialize()],t.prototype,"lowerAlphaLimit",void 0),n([e.serialize()],t.prototype,"upperAlphaLimit",void 0),n([e.serialize()],t.prototype,"lowerBetaLimit",void 0),n([e.serialize()],t.prototype,"upperBetaLimit",void 0),n([e.serialize()],t.prototype,"lowerRadiusLimit",void 0),n([e.serialize()],t.prototype,"upperRadiusLimit",void 0),n([e.serialize()],t.prototype,"inertialPanningX",void 0),n([e.serialize()],t.prototype,"inertialPanningY",void 0),n([e.serialize()],t.prototype,"pinchToPanMaxDistance",void 0),n([e.serialize()],t.prototype,"panningDistanceLimit",void 0),n([e.serializeAsVector3()],t.prototype,"panningOriginTarget",void 0),n([e.serialize()],t.prototype,"panningInertia",void 0),n([e.serialize()],t.prototype,"zoomOnFactor",void 0),n([e.serialize()],t.prototype,"allowUpsideDown",void 0),e.ArcRotateCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e){return t.call(this,e)||this}return o(i,t),i.prototype.addMouseWheel=function(){return this.add(new e.ArcRotateCameraMouseWheelInput),this},i.prototype.addPointers=function(){return this.add(new e.ArcRotateCameraPointersInput),this},i.prototype.addKeyboard=function(){return this.add(new e.ArcRotateCameraKeyboardMoveInput),this},i.prototype.addGamepad=function(){return this.add(new e.ArcRotateCameraGamepadInput),this},i.prototype.addVRDeviceOrientation=function(){return this.add(new e.ArcRotateCameraVRDeviceOrientationInput),this},i}(e.CameraInputsManager);e.ArcRotateCameraInputsManager=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n){var o=t.call(this,i,n)||this;return o.groundColor=new e.Color3(0,0,0),o.direction=r||e.Vector3.Up(),o}return o(i,t),i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.getClassName=function(){return"HemisphericLight"},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i){var r=e.Vector3.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",r.x,r.y,r.z,0,i),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),i),this},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_HEMISPHERICLIGHT},i}(e.Light);n([e.serializeAsColor3()],t.prototype,"groundColor",void 0),n([e.serializeAsVector3()],t.prototype,"direction",void 0),e.HemisphericLight=t}(r||(r={}));var r;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._needProjectionMatrixCompute=!0,e}return o(i,t),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(e){this._direction=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowMinZ",{get:function(){return this._shadowMinZ},set:function(e){this._shadowMinZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowMaxZ",{get:function(){return this._shadowMaxZ},set:function(e){this._shadowMaxZ=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),i.prototype.computeTransformedInformation=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)},i.prototype.getDepthScale=function(){return 50},i.prototype.getShadowDirection=function(e){return this.transformedDirection?this.transformedDirection:this.direction},i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.getRotation=function(){this.direction.normalize();var t=e.Vector3.Cross(this.direction,e.Axis.Y),i=e.Vector3.Cross(t,this.direction);return e.Vector3.RotationFromAxis(t,i,this.direction)},i.prototype.needCube=function(){return!1},i.prototype.needProjectionMatrixCompute=function(){return this._needProjectionMatrixCompute},i.prototype.forceProjectionMatrixCompute=function(){this._needProjectionMatrixCompute=!0},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i.prototype.getDepthMinZ=function(e){return void 0!==this.shadowMinZ?this.shadowMinZ:e.minZ},i.prototype.getDepthMaxZ=function(e){return void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ},i.prototype.setShadowProjectionMatrix=function(e,t,i){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,i,e):this._setDefaultShadowProjectionMatrix(e,t,i),this},i}(e.Light);n([e.serializeAsVector3()],t.prototype,"position",void 0),n([e.serializeAsVector3()],t.prototype,"direction",null),n([e.serialize()],t.prototype,"shadowMinZ",null),n([e.serialize()],t.prototype,"shadowMaxZ",null),e.ShadowLight=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._shadowAngle=Math.PI/2,n.position=i,n}return o(i,t),Object.defineProperty(i.prototype,"shadowAngle",{get:function(){return this._shadowAngle},set:function(e){this._shadowAngle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this.needCube();this._direction=e,this.needCube()!==t&&this._shadowGenerator&&this._shadowGenerator.recreateShadowMap()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"PointLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_POINTLIGHT},i.prototype.needCube=function(){return!this.direction},i.prototype.getShadowDirection=function(i){if(this.direction)return t.prototype.getShadowDirection.call(this,i);switch(i){case 0:return new e.Vector3(1,0,0);case 1:return new e.Vector3(-1,0,0);case 2:return new e.Vector3(0,-1,0);case 3:return new e.Vector3(0,1,0);case 4:return new e.Vector3(0,0,1);case 5:return new e.Vector3(0,0,-1)}return e.Vector3.Zero()},i.prototype._setDefaultShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;n&&e.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,this.getDepthMinZ(n),this.getDepthMaxZ(n),t)},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this)},i}(e.ShadowLight);n([e.serialize()],t.prototype,"shadowAngle",null),e.PointLight=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._shadowFrustumSize=0,n._shadowOrthoScale=.5,n.autoUpdateExtends=!0,n._orthoLeft=Number.MAX_VALUE,n._orthoRight=Number.MIN_VALUE,n._orthoTop=Number.MIN_VALUE,n._orthoBottom=Number.MAX_VALUE,n.position=i.scale(-1),n.direction=i,n}return o(i,t),Object.defineProperty(i.prototype,"shadowFrustumSize",{get:function(){return this._shadowFrustumSize},set:function(e){this._shadowFrustumSize=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowOrthoScale",{get:function(){return this._shadowOrthoScale},set:function(e){this._shadowOrthoScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"DirectionalLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_DIRECTIONALLIGHT},i.prototype._setDefaultShadowProjectionMatrix=function(e,t,i){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(e,t):this._setDefaultAutoExtendShadowProjectionMatrix(e,t,i)},i.prototype._setDefaultFixedFrustumShadowProjectionMatrix=function(t,i){var r=this.getScene().activeCamera;r&&e.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:r.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:r.maxZ,t)},i.prototype._setDefaultAutoExtendShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;if(n){if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var o=e.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var s=0;s<r.length;s++){var a=r[s];if(a)for(var l=a.getBoundingInfo(),h=l.boundingBox,c=0;c<h.vectorsWorld.length;c++)e.Vector3.TransformCoordinatesToRef(h.vectorsWorld[c],i,o),o.x<this._orthoLeft&&(this._orthoLeft=o.x),o.y<this._orthoBottom&&(this._orthoBottom=o.y),o.x>this._orthoRight&&(this._orthoRight=o.x),o.y>this._orthoTop&&(this._orthoTop=o.y)}}var u=this._orthoRight-this._orthoLeft,f=this._orthoTop-this._orthoBottom;e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-f*this.shadowOrthoScale,this._orthoTop+f*this.shadowOrthoScale,void 0!==this.shadowMinZ?this.shadowMinZ:n.minZ,void 0!==this.shadowMaxZ?this.shadowMaxZ:n.maxZ,t)}},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(e,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)},i.prototype.getDepthMinZ=function(e){return 1},i.prototype.getDepthMaxZ=function(e){return 1},i}(e.ShadowLight);n([e.serialize()],t.prototype,"shadowFrustumSize",null),n([e.serialize()],t.prototype,"shadowOrthoScale",null),n([e.serialize()],t.prototype,"autoUpdateExtends",void 0),e.DirectionalLight=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r,n,o,s){var a=t.call(this,e,s)||this;return a.position=i,a.direction=r,a.angle=n,a.exponent=o,a}return o(i,t),Object.defineProperty(i.prototype,"angle",{get:function(){return this._angle},set:function(e){this._angle=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"shadowAngleScale",{get:function(){return this._shadowAngleScale},set:function(e){this._shadowAngleScale=e,this.forceProjectionMatrixCompute()},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"SpotLight"},i.prototype.getTypeID=function(){return e.Light.LIGHTTYPEID_SPOTLIGHT},i.prototype._setDefaultShadowProjectionMatrix=function(t,i,r){var n=this.getScene().activeCamera;if(n){this._shadowAngleScale=this._shadowAngleScale||1;var o=this._shadowAngleScale*this._angle;e.Matrix.PerspectiveFovLHToRef(o,1,this.getDepthMinZ(n),this.getDepthMaxZ(n),t)}},i.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",3),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},i.prototype.transferToEffect=function(t,i){var r;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,i),r=e.Vector3.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,i),r=e.Vector3.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",r.x,r.y,r.z,Math.cos(.5*this.angle),i),this},i}(e.ShadowLight);n([e.serialize()],t.prototype,"angle",null),n([e.serialize()],t.prototype,"shadowAngleScale",null),n([e.serialize()],t.prototype,"exponent",void 0),e.SpotLight=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i){this.name=e,this.from=t,this.to=i}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}();e.AnimationRange=t;var i=function(){function e(e,t,i){this.frame=e,this.action=t,this.onlyOnce=i,this.isDone=!1}return e}();e.AnimationEvent=i;var r=function(){function t(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new e.Vector3(t.x,0,t.y)},t.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},t.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},t.prototype.move=function(e){if(Math.abs(e)>1)throw"step size should be less than 1.";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},t.prototype.onchange=function(e){return this._onchange.push(e),this},t}();e.PathCursor=r;var n=function(){function i(e,t,r,n,o,s){this.name=e,this.targetProperty=t,this.framePerSecond=r,this.dataType=n,this.loopMode=o,this.enableBlending=s,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=n,this.loopMode=void 0===o?i.ANIMATIONLOOPMODE_CYCLE:o}return i._PrepareAnimation=function(t,r,n,o,s,a,l,h){var c=void 0;if(!isNaN(parseFloat(s))&&isFinite(s)?c=i.ANIMATIONTYPE_FLOAT:s instanceof e.Quaternion?c=i.ANIMATIONTYPE_QUATERNION:s instanceof e.Vector3?c=i.ANIMATIONTYPE_VECTOR3:s instanceof e.Vector2?c=i.ANIMATIONTYPE_VECTOR2:s instanceof e.Color3?c=i.ANIMATIONTYPE_COLOR3:s instanceof e.Size&&(c=i.ANIMATIONTYPE_SIZE),void 0==c)return null;var u=new i(t,r,n,c,l),f=[{frame:0,value:s},{frame:o,value:a}];return u.setKeys(f),void 0!==h&&u.setEasingFunction(h),u},i.CreateAnimation=function(t,i,r,n){var o=new e.Animation(t+"Animation",t,r,i,e.Animation.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(n),o},i.CreateAndStartAnimation=function(e,t,r,n,o,s,a,l,h,c){var u=i._PrepareAnimation(e,r,n,o,s,a,l,h);return u?t.getScene().beginDirectAnimation(t,[u],0,o,1===u.loopMode,1,c):null},i.CreateMergeAndStartAnimation=function(e,t,r,n,o,s,a,l,h,c){var u=i._PrepareAnimation(e,r,n,o,s,a,l,h);return u?(t.animations.push(u),t.getScene().beginAnimation(t,0,o,1===u.loopMode,1,c)):null},i.TransitionTo=function(e,t,i,r,n,o,s,a){if(void 0===a&&(a=null),s<=0)return i[e]=t,a&&a(),null;var l=n*(s/1e3);o.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(o);var h=r.beginAnimation(i,0,l,!1);return h.onAnimationEnd=a,h},Object.defineProperty(i.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){if(!t[e].isStopped)return!0}return!1},enumerable:!0,configurable:!0}),i.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},i.prototype.addEvent=function(e){this._events.push(e)},i.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},i.prototype.getEvents=function(){return this._events},i.prototype.createRange=function(e,i,r){this._ranges[e]||(this._ranges[e]=new t(e,i,r))},i.prototype.deleteRange=function(e,t){void 0===t&&(t=!0);var i=this._ranges[e];if(i){if(t)for(var r=i.from,n=i.to,o=this._keys.length-1;o>=0;o--)this._keys[o].frame>=r&&this._keys[o].frame<=n&&this._keys.splice(o,1);this._ranges[e]=null}},i.prototype.getRange=function(e){return this._ranges[e]},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(e){this._easingFunction=e},i.prototype.floatInterpolateFunction=function(t,i,r){return e.Scalar.Lerp(t,i,r)},i.prototype.floatInterpolateFunctionWithTangents=function(t,i,r,n,o){return e.Scalar.Hermite(t,i,r,n,o)},i.prototype.quaternionInterpolateFunction=function(t,i,r){return e.Quaternion.Slerp(t,i,r)},i.prototype.quaternionInterpolateFunctionWithTangents=function(t,i,r,n,o){return e.Quaternion.Hermite(t,i,r,n,o).normalize()},i.prototype.vector3InterpolateFunction=function(t,i,r){return e.Vector3.Lerp(t,i,r)},i.prototype.vector3InterpolateFunctionWithTangents=function(t,i,r,n,o){return e.Vector3.Hermite(t,i,r,n,o)},i.prototype.vector2InterpolateFunction=function(t,i,r){return e.Vector2.Lerp(t,i,r)},i.prototype.vector2InterpolateFunctionWithTangents=function(t,i,r,n,o){return e.Vector2.Hermite(t,i,r,n,o)},i.prototype.sizeInterpolateFunction=function(t,i,r){return e.Size.Lerp(t,i,r)},i.prototype.color3InterpolateFunction=function(t,i,r){return e.Color3.Lerp(t,i,r)},i.prototype.matrixInterpolateFunction=function(t,i,r){return e.Matrix.Lerp(t,i,r)},i.prototype.clone=function(){var e=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(var t in this._ranges){var r=this._ranges[t];r&&(e._ranges[t]=r.clone())}}return e},i.prototype.setKeys=function(e){this._keys=e.slice(0)},i.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var r=this.getKeys(),n=0;n<r.length;n++){var o=r[n],s={};switch(s.frame=o.frame,t){case i.ANIMATIONTYPE_FLOAT:s.values=[o.value];break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:s.values=o.value.asArray()}e.keys.push(s)}e.ranges=[];for(var a in this._ranges){var l=this._ranges[a];if(l){var h={};h.name=a,h.from=l.from,h.to=l.to,e.ranges.push(h)}}return e},Object.defineProperty(i,"ANIMATIONTYPE_FLOAT",{get:function(){return i._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR3",{get:function(){return i._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR2",{get:function(){return i._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_SIZE",{get:function(){return i._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_QUATERNION",{get:function(){return i._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_MATRIX",{get:function(){return i._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_COLOR3",{get:function(){return i._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return i._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return i._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return i._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),i.Parse=function(t){var r,n,o=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),s=t.dataType,a=[];for(t.enableBlending&&(o.enableBlending=t.enableBlending),t.blendingSpeed&&(o.blendingSpeed=t.blendingSpeed),n=0;n<t.keys.length;n++){var l,h,c=t.keys[n];switch(s){case i.ANIMATIONTYPE_FLOAT:r=c.values[0],c.values.length>=1&&(l=c.values[1]),c.values.length>=2&&(h=c.values[2]);break;case i.ANIMATIONTYPE_QUATERNION:if(r=e.Quaternion.FromArray(c.values),c.values.length>=8){var u=e.Quaternion.FromArray(c.values.slice(4,8));u.equals(e.Quaternion.Zero())||(l=u)}if(c.values.length>=12){var f=e.Quaternion.FromArray(c.values.slice(8,12));f.equals(e.Quaternion.Zero())||(h=f)}break;case i.ANIMATIONTYPE_MATRIX:r=e.Matrix.FromArray(c.values);break;case i.ANIMATIONTYPE_COLOR3:r=e.Color3.FromArray(c.values);break;case i.ANIMATIONTYPE_VECTOR3:default:r=e.Vector3.FromArray(c.values)}var d={};d.frame=c.frame,d.value=r,void 0!=l&&(d.inTangent=l),void 0!=h&&(d.outTangent=h),a.push(d)}if(o.setKeys(a),t.ranges)for(n=0;n<t.ranges.length;n++)r=t.ranges[n],o.createRange(r.name,r.from,r.to);return o},i.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var r=e.animations[i];t.animations.push(r.serialize())}}},i}();n.AllowMatricesInterpolation=!1,n._ANIMATIONTYPE_FLOAT=0,n._ANIMATIONTYPE_VECTOR3=1,n._ANIMATIONTYPE_QUATERNION=2,n._ANIMATIONTYPE_MATRIX=3,n._ANIMATIONTYPE_COLOR3=4,n._ANIMATIONTYPE_VECTOR2=5,n._ANIMATIONTYPE_SIZE=6,n._ANIMATIONLOOPMODE_RELATIVE=0,n._ANIMATIONLOOPMODE_CYCLE=1,n._ANIMATIONLOOPMODE_CONSTANT=2,e.Animation=n}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._ratioOffset=0,this._animation=t,this._target=e,t._runtimeAnimations.push(this)}return Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._offsetsCache={},this._highLimitsCache={},this.currentFrame=0,this._blendingFactor=0,this._originalBlendValue=null},t.prototype.isStopped=function(){return this._stopped},t.prototype.dispose=function(){var e=this._animation.runtimeAnimations.indexOf(this);e>-1&&this._animation.runtimeAnimations.splice(e,1)},t.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},t.prototype._interpolate=function(t,i,r,n,o){if(r===e.Animation.ANIMATIONLOOPMODE_CONSTANT&&i>0)return o.clone?o.clone():o;this.currentFrame=t;var s=this._animation.getKeys(),a=Math.max(0,Math.min(s.length-1,Math.floor(s.length*(t-s[0].frame)/(s[s.length-1].frame-s[0].frame))-1));if(s[a].frame>=t)for(;a-1>=0&&s[a].frame>=t;)a--;for(var l=a;l<s.length;l++){var h=s[l+1];if(h.frame>=t){var c=s[l],u=this._getKeyValue(c.value),f=this._getKeyValue(h.value),d=void 0!==c.outTangent&&void 0!==h.inTangent,p=h.frame-c.frame,m=(t-c.frame)/p,g=this._animation.getEasingFunction();switch(null!=g&&(m=g.ease(m)),this._animation.dataType){case e.Animation.ANIMATIONTYPE_FLOAT:var v=d?this._animation.floatInterpolateFunctionWithTangents(u,c.outTangent*p,f,h.inTangent*p,m):this._animation.floatInterpolateFunction(u,f,m);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return v;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return n*i+v}break;case e.Animation.ANIMATIONTYPE_QUATERNION:var y=d?this._animation.quaternionInterpolateFunctionWithTangents(u,c.outTangent.scale(p),f,h.inTangent.scale(p),m):this._animation.quaternionInterpolateFunction(u,f,m);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return y;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return y.add(n.scale(i))}return y;case e.Animation.ANIMATIONTYPE_VECTOR3:var _=d?this._animation.vector3InterpolateFunctionWithTangents(u,c.outTangent.scale(p),f,h.inTangent.scale(p),m):this._animation.vector3InterpolateFunction(u,f,m);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return _;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return _.add(n.scale(i))}case e.Animation.ANIMATIONTYPE_VECTOR2:var b=d?this._animation.vector2InterpolateFunctionWithTangents(u,c.outTangent.scale(p),f,h.inTangent.scale(p),m):this._animation.vector2InterpolateFunction(u,f,m);switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return b;case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return b.add(n.scale(i))}case e.Animation.ANIMATIONTYPE_SIZE:switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return this._animation.sizeInterpolateFunction(u,f,m);case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return this._animation.sizeInterpolateFunction(u,f,m).add(n.scale(i))}case e.Animation.ANIMATIONTYPE_COLOR3:switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:return this._animation.color3InterpolateFunction(u,f,m);case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return this._animation.color3InterpolateFunction(u,f,m).add(n.scale(i))}case e.Animation.ANIMATIONTYPE_MATRIX:switch(r){case e.Animation.ANIMATIONLOOPMODE_CYCLE:case e.Animation.ANIMATIONLOOPMODE_CONSTANT:if(e.Animation.AllowMatricesInterpolation)return this._animation.matrixInterpolateFunction(u,f,m);case e.Animation.ANIMATIONLOOPMODE_RELATIVE:return u}}break}}return this._getKeyValue(s[s.length-1].value)},t.prototype.setValue=function(t,i){void 0===i&&(i=!1);var r,n,o=this._animation.targetPropertyPath;if(o.length>1){for(var s=this._target[o[0]],a=1;a<o.length-1;a++)s=s[o[a]];r=o[o.length-1],n=s}else r=o[0],n=this._target;this._animation.enableBlending&&this._blendingFactor<=1?(this._originalBlendValue||(n[r].clone?this._originalBlendValue=n[r].clone():this._originalBlendValue=n[r]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?n[r]=this._originalBlendValue.construtor.prototype.Lerp(t,this._originalBlendValue,this._blendingFactor):n[r]=t:this._originalBlendValue.m?n[r]=e.Matrix.Lerp(this._originalBlendValue,t,this._blendingFactor):n[r]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*t,this._blendingFactor+=this._animation.blendingSpeed):n[r]=t,this._target.markAsDirty&&this._target.markAsDirty(this._animation.targetProperty)},t.prototype.goToFrame=function(e){var t=this._animation.getKeys();e<t[0].frame?e=t[0].frame:e>t[t.length-1].frame&&(e=t[t.length-1].frame);var i=this._interpolate(e,0,this._animation.loopMode);this.setValue(i)},t.prototype._prepareForSpeedRatioChange=function(e){var t=this._previousDelay*(this._animation.framePerSecond*e)/1e3;this._ratioOffset=this._previousRatio-t},t.prototype.animate=function(t,i,r,n,o,s){void 0===s&&(s=!1);var a=this._animation.targetPropertyPath;if(!a||a.length<1)return this._stopped=!0,!1;var l=!0,h=this._animation.getKeys();if(0!==h[0].frame){var c={frame:0,value:h[0].value};h.splice(0,0,c)}(i<h[0].frame||i>h[h.length-1].frame)&&(i=h[0].frame),(r<h[0].frame||r>h[h.length-1].frame)&&(r=h[h.length-1].frame),i===r&&(i>h[0].frame?i--:r<h[h.length-1].frame&&r++);var u,f=r-i,d=t*(this._animation.framePerSecond*o)/1e3+this._ratioOffset,p=0;if(this._previousDelay=t,this._previousRatio=d,(r>i&&d>f||i>r&&d<f)&&!n)l=!1,p=this._getKeyValue(h[h.length-1].value);else if(this._animation.loopMode!==e.Animation.ANIMATIONLOOPMODE_CYCLE){var m=r.toString()+i.toString();if(!this._offsetsCache[m]){var g=this._interpolate(i,0,e.Animation.ANIMATIONLOOPMODE_CYCLE),v=this._interpolate(r,0,e.Animation.ANIMATIONLOOPMODE_CYCLE);switch(this._animation.dataType){case e.Animation.ANIMATIONTYPE_FLOAT:this._offsetsCache[m]=v-g;break;case e.Animation.ANIMATIONTYPE_QUATERNION:this._offsetsCache[m]=v.subtract(g);break;case e.Animation.ANIMATIONTYPE_VECTOR3:this._offsetsCache[m]=v.subtract(g);case e.Animation.ANIMATIONTYPE_VECTOR2:this._offsetsCache[m]=v.subtract(g);case e.Animation.ANIMATIONTYPE_SIZE:this._offsetsCache[m]=v.subtract(g);case e.Animation.ANIMATIONTYPE_COLOR3:this._offsetsCache[m]=v.subtract(g)}this._highLimitsCache[m]=v}p=this._highLimitsCache[m],u=this._offsetsCache[m]}if(void 0===u)switch(this._animation.dataType){case e.Animation.ANIMATIONTYPE_FLOAT:u=0;break;case e.Animation.ANIMATIONTYPE_QUATERNION:u=new e.Quaternion(0,0,0,0);break;case e.Animation.ANIMATIONTYPE_VECTOR3:u=e.Vector3.Zero();break;case e.Animation.ANIMATIONTYPE_VECTOR2:u=e.Vector2.Zero();break;case e.Animation.ANIMATIONTYPE_SIZE:u=e.Size.Zero();break;case e.Animation.ANIMATIONTYPE_COLOR3:u=e.Color3.Black()}var y=d/f>>0,_=l?i+d%f:r,b=this._interpolate(_,y,this._animation.loopMode,u,p);this.setValue(b);for(var x=this._animation.getEvents(),T=0;T<x.length;T++)if(f>0&&_>=x[T].frame&&x[T].frame>=i||f<0&&_<=x[T].frame&&x[T].frame<=i){var E=x[T];E.isDone||(E.onlyOnce&&(x.splice(T,1),T--),E.isDone=!0,E.action())}else x[T].isDone&&!x[T].onlyOnce&&(x[T].isDone=!1);return l||(this._stopped=!0),l},t}();e.RuntimeAnimation=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a){void 0===i&&(i=0),void 0===r&&(r=100),void 0===n&&(n=!1),void 0===o&&(o=1),this.target=t,this.fromFrame=i,this.toFrame=r,this.loopAnimation=n,this.onAnimationEnd=s,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this.animationStarted=!1,a&&this.appendAnimations(t,a),this._speedRatio=o,this._scene=e,e._activeAnimatables.push(this)}return Object.defineProperty(t.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(e){for(var t=0;t<this._runtimeAnimations.length;t++){this._runtimeAnimations[t]._prepareForSpeedRatioChange(e)}this._speedRatio=e},enumerable:!0,configurable:!0}),t.prototype.getAnimations=function(){return this._runtimeAnimations},t.prototype.appendAnimations=function(t,i){for(var r=0;r<i.length;r++){var n=i[r];this._runtimeAnimations.push(new e.RuntimeAnimation(t,n))}},t.prototype.getAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i].animation;return null},t.prototype.getRuntimeAnimationByTargetProperty=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)if(t[i].animation.targetProperty===e)return t[i];return null},t.prototype.reset=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].reset();this._localDelayOffset=null,this._pausedDelay=null},t.prototype.enableBlending=function(e){for(var t=this._runtimeAnimations,i=0;i<t.length;i++)t[i].animation.enableBlending=!0,t[i].animation.blendingSpeed=e},t.prototype.disableBlending=function(){for(var e=this._runtimeAnimations,t=0;t<e.length;t++)e[t].animation.enableBlending=!1},t.prototype.goToFrame=function(e){var t=this._runtimeAnimations;if(t[0]){var i=t[0].animation.framePerSecond,r=t[0].currentFrame,n=e-r,o=1e3*n/i;null===this._localDelayOffset&&(this._localDelayOffset=0),this._localDelayOffset-=o}for(var s=0;s<t.length;s++)t[s].goToFrame(e)},t.prototype.pause=function(){this._paused||(this._paused=!0)},t.prototype.restart=function(){this._paused=!1},t.prototype.stop=function(e){if(e){var t=this._scene._activeAnimatables.indexOf(this);if(t>-1){for(var i=this._runtimeAnimations,r=i.length-1;r>=0;r--)"string"==typeof e&&i[r].animation.name!=e||(i[r].dispose(),i.splice(r,1));0==i.length&&(this._scene._activeAnimatables.splice(t,1),this.onAnimationEnd&&this.onAnimationEnd())}}else{var r=this._scene._activeAnimatables.indexOf(this);if(r>-1){this._scene._activeAnimatables.splice(r,1);for(var i=this._runtimeAnimations,r=0;r<i.length;r++)i[r].dispose();this.onAnimationEnd&&this.onAnimationEnd()}}},t.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=e),!0;null===this._localDelayOffset?this._localDelayOffset=e:null!==this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null);var t,i=!1,r=this._runtimeAnimations;for(t=0;t<r.length;t++){var n=r[t],o=n.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio);i=i||o}if(this.animationStarted=i,!i)for(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1),t=0;t<r.length;t++)r[t].dispose();return!i&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),i},t}();e.Animatable=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){return e._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){return e._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e}();t._EASINGMODE_EASEIN=0,t._EASINGMODE_EASEOUT=1,t._EASINGMODE_EASEINOUT=2,e.EasingFunction=t;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(t);e.CircleEase=i;var r=function(e){function t(t){void 0===t&&(t=1);var i=e.call(this)||this;return i.amplitude=t,i}return o(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}(t);e.BackEase=r;var n=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=2);var r=e.call(this)||this;return r.bounces=t,r.bounciness=i,r}return o(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),i=this.bounciness;i<=1&&(i=1.001);var r=Math.pow(i,t),n=1-i,o=(1-r)/n+.5*r,s=e*o,a=Math.log(-s*(1-i)+1)/Math.log(i),l=Math.floor(a),h=l+1,c=(1-Math.pow(i,l))/(n*o),u=(1-Math.pow(i,h))/(n*o),f=.5*(c+u),d=e-f,p=f-c;return-Math.pow(1/i,t-l)/(p*p)*(d-p)*(d+p)},t}(t);e.BounceEase=n;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}(t);e.CubicEase=s;var a=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=3);var r=e.call(this)||this;return r.oscillations=t,r.springiness=i,r}return o(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.oscillations),i=Math.max(0,this.springiness);return(0==i?e:(Math.exp(i*e)-1)/(Math.exp(i)-1))*Math.sin((6.283185307179586*t+1.5707963267948966)*e)},t}(t);e.ElasticEase=a;var l=function(e){function t(t){void 0===t&&(t=2);var i=e.call(this)||this;return i.exponent=t,i}return o(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(t);e.ExponentialEase=l;var h=function(e){function t(t){void 0===t&&(t=2);var i=e.call(this)||this;return i.power=t,i}return o(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}(t);e.PowerEase=h;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return e*e},t}(t);e.QuadraticEase=c;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}(t);e.QuarticEase=u;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(t);e.QuinticEase=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(t);e.SineEase=d;var p=function(t){function i(e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1);var o=t.call(this)||this;return o.x1=e,o.y1=i,o.x2=r,o.y2=n,o}return o(i,t),i.prototype.easeInCore=function(t){return e.BezierCurve.interpolate(t,this.x1,this.y1,this.x2,this.y2)},i}(t);e.BezierCurveEase=p}(r||(r={}));var r;!function(e){var t=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}();e.Condition=t;var i=function(t){function i(e,r,n,o,s){void 0===s&&(s=i.IsEqual);var a=t.call(this,e)||this;return a.propertyPath=n,a.value=o,a.operator=s,a._target=r,a._effectiveTarget=a._getEffectiveTarget(r,a.propertyPath),a._property=a._getProperty(a.propertyPath),a}return o(i,t),Object.defineProperty(i,"IsEqual",{get:function(){return i._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsDifferent",{get:function(){return i._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsGreater",{get:function(){return i._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsLesser",{get:function(){return i._IsLesser},enumerable:!0,configurable:!0}),i.prototype.isValid=function(){switch(this.operator){case i.IsGreater:return this._effectiveTarget[this._property]>this.value;case i.IsLesser:return this._effectiveTarget[this._property]<this.value;case i.IsEqual:case i.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===i.IsEqual?e:!e}return!1},i.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"operator",value:i.GetOperatorName(this.operator)}]})},i.GetOperatorName=function(e){switch(e){case i._IsEqual:return"IsEqual";case i._IsDifferent:return"IsDifferent";case i._IsGreater:return"IsGreater";case i._IsLesser:return"IsLesser";default:return""}},i}(t);i._IsEqual=0,i._IsDifferent=1,i._IsGreater=2,i._IsLesser=3,e.ValueCondition=i;var r=function(e){function t(t,i){var r=e.call(this,t)||this;return r.predicate=i,r}return o(t,e),t.prototype.isValid=function(){return this.predicate()},t}(t);e.PredicateCondition=r;var n=function(t){function i(e,i,r){var n=t.call(this,e)||this;return n.value=r,n._target=i,n}return o(i,t),i.prototype.isValid=function(){return this._target.state===this.value},i.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},i}(t);e.StateCondition=n}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){this.triggerOptions=t,this.onBeforeExecuteObservable=new e.Observable,t.parameter?(this.trigger=t.trigger,this._triggerParameter=t.parameter):this.trigger=t,this._nextActiveAction=this,this._condition=i}return t.prototype._prepare=function(){},t.prototype.getTriggerParameter=function(){return this._triggerParameter},t.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,i=this._actionManager.getScene().getRenderId();if(t._evaluationId===i){if(!t._currentResult)return}else{if(t._evaluationId=i,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(e),this.skipToNextActiveAction()},t.prototype.execute=function(e){},t.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},t.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},t.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},t.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},t.prototype.serialize=function(e){},t.prototype._serialize=function(e,t){var i={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(i),this._condition){var r=this._condition.serialize();return r.children.push(i),t&&t.children.push(r),r}return t&&t.children.push(i),i},t}();t._SerializeValueAsString=function(t){return"number"==typeof t?t.toString():"boolean"==typeof t?t?"true":"false":t instanceof e.Vector2?t.x+", "+t.y:t instanceof e.Vector3?t.x+", "+t.y+", "+t.z:t instanceof e.Color3?t.r+", "+t.g+", "+t.b:t instanceof e.Color4?t.r+", "+t.g+", "+t.b+", "+t.a:t},t._GetTargetProperty=function(t){return{name:"target",targetType:t instanceof e.Mesh?"MeshProperties":t instanceof e.Light?"LightProperties":t instanceof e.Camera?"CameraProperties":"SceneProperties",value:t instanceof e.Scene?"Scene":t.name}},e.Action=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i,r,n,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=r,this.sourceEvent=n,this.additionalData=o}return e.CreateNew=function(t,i,r){var n=t.getScene();return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer,i,r)},e.CreateNewFromSprite=function(t,i,r,n){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,r,n)},e.CreateNewFromScene=function(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},e.CreateNewFromPrimitive=function(t,i,r,n){return new e(t,i.x,i.y,null,r,n)},e}();e.ActionEvent=t;var i=function(){function t(e){this.actions=new Array,this.hoverCursor="",this._scene=e,e._actionManagers.push(this)}return Object.defineProperty(t,"NothingTrigger",{get:function(){return t._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickTrigger",{get:function(){return t._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLeftPickTrigger",{get:function(){return t._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnRightPickTrigger",{get:function(){return t._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnCenterPickTrigger",{get:function(){return t._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickDownTrigger",{get:function(){return t._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnDoublePickTrigger",{get:function(){return t._OnDoublePickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickUpTrigger",{get:function(){return t._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickOutTrigger",{get:function(){return t._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLongPressTrigger",{get:function(){return t._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOverTrigger",{get:function(){return t._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOutTrigger",{get:function(){return t._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnEveryFrameTrigger",{get:function(){return t._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionEnterTrigger",{get:function(){return t._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionExitTrigger",{get:function(){return t._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyDownTrigger",{get:function(){return t._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyUpTrigger",{get:function(){return t._OnKeyUpTrigger},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){for(var e=this._scene._actionManagers.indexOf(this),i=0;i<this.actions.length;i++){var r=this.actions[i];t.Triggers[r.trigger]--,0===t.Triggers[r.trigger]&&delete t.Triggers[r.trigger]}e>-1&&this._scene._actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var i=this.actions[t];if(e.indexOf(i.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTrigger=function(e){for(var t=0;t<this.actions.length;t++){if(this.actions[t].trigger===e)return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HasTriggers",{get:function(){for(var e in t.Triggers)if(t.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HasPickTriggers",{get:function(){for(var e in t.Triggers)if(t.Triggers.hasOwnProperty(e)){var i=parseInt(e);if(i>=t._OnPickTrigger&&i<=t._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.HasSpecificTrigger=function(e){for(var i in t.Triggers)if(t.Triggers.hasOwnProperty(i)){var r=parseInt(i);if(r===e)return!0}return!1},t.prototype.registerAction=function(i){return i.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),t.Triggers[i.trigger]?t.Triggers[i.trigger]++:t.Triggers[i.trigger]=1,i._actionManager=this,i._prepare(),i)},t.prototype.unregisterAction=function(e){var i=this.actions.indexOf(e);return-1!==i&&(this.actions.splice(i,1),t.Triggers[e.trigger]-=1,delete e._actionManager,!0)},t.prototype.processTrigger=function(e,i){for(var r=0;r<this.actions.length;r++){var n=this.actions[r];if(n.trigger===e){if(i&&(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger)){var o=n.getTriggerParameter();if(o&&o!==i.sourceEvent.keyCode){if(!o.toLowerCase)continue;var s=o.toLowerCase();if(s!==i.sourceEvent.key){var a=i.sourceEvent.charCode?i.sourceEvent.charCode:i.sourceEvent.keyCode;if(String.fromCharCode(a).toLowerCase()!==s)continue}}}n._executeCurrent(i)}}},t.prototype._getEffectiveTarget=function(e,t){for(var i=t.split("."),r=0;r<i.length-1;r++)e=e[i[r]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t.prototype.serialize=function(i){for(var r={children:new Array,name:i,type:3,properties:new Array},n=0;n<this.actions.length;n++){var o={type:0,children:new Array,name:t.GetTriggerName(this.actions[n].trigger),properties:new Array},s=this.actions[n].triggerOptions;if(s&&"number"!=typeof s)if(s.parameter instanceof e.Node)o.properties.push(e.Action._GetTargetProperty(s.parameter));else{var a={};e.Tools.DeepCopy(s.parameter,a,["mesh"]),s.parameter.mesh&&(a._meshId=s.parameter.mesh.id),o.properties.push({name:"parameter",targetType:null,value:a})}this.actions[n].serialize(o),r.children.push(o)}return r},t.Parse=function(i,r,n){var o=new e.ActionManager(n);null===r?n.actionManager=o:r.actionManager=o;for(var s=function(t,i){var r=Object.create(e.Tools.Instantiate("BABYLON."+t).prototype);return r.constructor.apply(r,i),r},a=function(t,i,r,n){if(null===n){var o=parseFloat(i);return"true"===i||"false"===i?"true"===i:isNaN(o)?i:o}for(var s=n.split("."),a=i.split(","),l=0;l<s.length;l++)r=r[s[l]];if("boolean"==typeof r)return"true"===a[0];if("string"==typeof r)return a[0];for(var h=new Array,l=0;l<a.length;l++)h.push(parseFloat(a[l]));return r instanceof e.Vector3?e.Vector3.FromArray(h):r instanceof e.Vector4?e.Vector4.FromArray(h):r instanceof e.Color3?e.Color3.FromArray(h):r instanceof e.Color4?e.Color4.FromArray(h):parseFloat(a[0])},l=function(i,r,h,c,u){if(void 0===u&&(u=null),!i.detached){var f=new Array,d=null,p=null,m=i.combine&&i.combine.length>0;if(2===i.type?f.push(o):f.push(r),m){for(var g=new Array,v=0;v<i.combine.length;v++)l(i.combine[v],t.NothingTrigger,h,c,g);f.push(g)}else for(var y=0;y<i.properties.length;y++){var _=i.properties[y].value,b=i.properties[y].name,x=i.properties[y].targetType;"target"===b?_=d=null!==x&&"SceneProperties"===x?n:n.getNodeByName(_):"parent"===b?_=n.getNodeByName(_):"sound"===b?_=n.getSoundByName(_):"propertyPath"!==b?_=2===i.type&&"operator"===b?e.ValueCondition[_]:a(0,_,d,"value"===b?p:null):p=_,f.push(_)}if(null===u?f.push(h):f.push(null),"InterpolateValueAction"===i.name){var T=f[f.length-2];f[f.length-1]=T,f[f.length-2]=h}var E=s(i.name,f);if(E instanceof e.Condition&&null!==h){var S=new e.DoNothingAction(r,h);c?c.then(S):o.registerAction(S),c=S}null===u?E instanceof e.Condition?(h=E,E=c):(h=null,c?c.then(E):o.registerAction(E)):u.push(E);for(var y=0;y<i.children.length;y++)l(i.children[y],r,h,E,null)}},h=0;h<i.children.length;h++){var c,u=i.children[h];if(u.properties.length>0){var f=u.properties[0].value,d=null===u.properties[0].targetType?f:n.getMeshByName(f);d._meshId&&(d.mesh=n.getMeshByID(d._meshId)),c={trigger:t[u.name],parameter:d}}else c=t[u.name];for(var p=0;p<u.children.length;p++)u.detached||l(u.children[p],c,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t}();i._NothingTrigger=0,i._OnPickTrigger=1,i._OnLeftPickTrigger=2,i._OnRightPickTrigger=3,i._OnCenterPickTrigger=4,i._OnPickDownTrigger=5,i._OnDoublePickTrigger=6,i._OnPickUpTrigger=7,i._OnLongPressTrigger=8,i._OnPointerOverTrigger=9,i._OnPointerOutTrigger=10,i._OnEveryFrameTrigger=11,i._OnIntersectionEnterTrigger=12,i._OnIntersectionExitTrigger=13,i._OnKeyDownTrigger=14,i._OnKeyUpTrigger=15,i._OnPickOutTrigger=16,i.Triggers={},e.ActionManager=i}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h){void 0===s&&(s=1e3);var c=t.call(this,i,a)||this;return c.propertyPath=n,c.value=o,c.duration=s,c.stopOtherAnimations=l,c.onInterpolationDone=h,c.onInterpolationDoneObservable=new e.Observable,c._target=c._effectiveTarget=r,c}return o(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){var t,i=this,r=this._actionManager.getScene(),n=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)t=e.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=e.Animation.ANIMATIONTYPE_QUATERNION}var o=new e.Animation("InterpolateValueAction",this._property,1e3/this.duration*100,t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);o.setKeys(n),this.stopOtherAnimations&&r.stopAnimation(this._effectiveTarget);var s=function(){i.onInterpolationDoneObservable.notifyObservers(i),i.onInterpolationDone&&i.onInterpolationDone()};r.beginDirectAnimation(this._effectiveTarget,[o],0,100,!1,1,s)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"duration",value:e.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:e.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},i)},i}(e.Action);e.InterpolateValueAction=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r,n){var o=t.call(this,e,n)||this;return o.propertyPath=r,o._target=o._effectiveTarget=i,o}return o(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},i)},i}(e.Action);e.SwitchBooleanAction=t;var i=function(t){function i(e,i,r,n){var o=t.call(this,e,n)||this;return o.value=r,o._target=i,o}return o(i,t),i.prototype.execute=function(){this._target.state=this.value},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetStateAction",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},i)},i}(e.Action);e.SetStateAction=i;var r=function(t){function i(e,i,r,n,o){var s=t.call(this,e,o)||this;return s.propertyPath=r,s.value=n,s._target=s._effectiveTarget=i,s}return o(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.SetValueAction=r;var n=function(t){function i(e,i,r,n,o){var s=t.call(this,e,o)||this;return s.propertyPath=r,s.value=n,s._target=s._effectiveTarget=i,s}return o(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},i.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.IncrementValueAction=n;var s=function(t){function i(e,i,r,n,o,s){var a=t.call(this,e,s)||this;return a.from=r,a.to=n,a.loop=o,a._target=i,a}return o(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){this._actionManager.getScene().beginAnimation(this._target,this.from,this.to,this.loop)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[e.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:e.Action._SerializeValueAsString(this.loop)||!1}]},i)},i}(e.Action);e.PlayAnimationAction=s;var a=function(t){function i(e,i,r){var n=t.call(this,e,r)||this;return n._target=i,n}return o(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){this._actionManager.getScene().stopAnimation(this._target)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[e.Action._GetTargetProperty(this._target)]},i)},i}(e.Action);e.StopAnimationAction=a;var l=function(t){function i(i,r){return void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,r)||this}return o(i,t),i.prototype.execute=function(){},i.prototype.serialize=function(e){return t.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},i}(e.Action);e.DoNothingAction=l;var h=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.children=i,n}return o(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t.prototype.serialize=function(t){for(var i=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),r=0;r<this.children.length;r++)i.combine.push(this.children[r].serialize(null));return i},t}(e.Action);e.CombineAction=h;var c=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n.func=i,n}return o(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=c;var u=function(t){function i(e,i,r,n){var o=t.call(this,e,n)||this;return o._target=i,o._parent=r,o}return o(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetParentAction",properties:[e.Action._GetTargetProperty(this._target),e.Action._GetTargetProperty(this._parent)]},i)},i}(e.Action);e.SetParentAction=u;var f=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._sound=i,n}return o(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.PlaySoundAction=f;var d=function(e){function t(t,i,r){var n=e.call(this,t,r)||this;return n._sound=i,n}return o(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.StopSoundAction=d}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o,s,a){if(void 0===s&&(s=.01),void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new e.Observable,this._vertexBuffers={},this._capacity=r,this._spriteTexture=new e.Texture(i,o,!0,!1,a),this._spriteTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,n.width&&n.height)this.cellWidth=n.width,this.cellHeight=n.height;else{if(void 0===n)return;this.cellWidth=n,this.cellHeight=n}this._epsilon=s,this._scene=o,this._scene.spriteManagers.push(this);for(var l=[],h=0,c=0;c<r;c++)l.push(h),l.push(h+1),l.push(h+2),l.push(h),l.push(h+2),l.push(h+3),h+=4;this._indexBuffer=o.getEngine().createIndexBuffer(l),this._vertexData=new Float32Array(16*r*4),this._buffer=new e.Buffer(o.getEngine(),this._vertexData,!0,16);var u=this._buffer.createVertexBuffer(e.VertexBuffer.PositionKind,0,4),f=this._buffer.createVertexBuffer("options",4,4),d=this._buffer.createVertexBuffer("cellInfo",8,4),p=this._buffer.createVertexBuffer(e.VertexBuffer.ColorKind,12,4);this._vertexBuffers[e.VertexBuffer.PositionKind]=u,this._vertexBuffers.options=f,this._vertexBuffers.cellInfo=d,this._vertexBuffers[e.VertexBuffer.ColorKind]=p,this._effectBase=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._spriteTexture},set:function(e){this._spriteTexture=e},enumerable:!0,configurable:!0}),t.prototype._appendSpriteVertex=function(e,t,i,r,n){var o=16*e;0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon),this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._vertexData[o+6]=i,this._vertexData[o+7]=r,this._vertexData[o+8]=t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0;var s=t.cellIndex/n>>0;this._vertexData[o+10]=t.cellIndex-s*n,this._vertexData[o+11]=s,this._vertexData[o+12]=t.color.r,this._vertexData[o+13]=t.color.g,this._vertexData[o+14]=t.color.b,this._vertexData[o+15]=t.color.a},t.prototype.intersects=function(t,i,r,n){for(var o=Math.min(this._capacity,this.sprites.length),s=e.Vector3.Zero(),a=e.Vector3.Zero(),l=Number.MAX_VALUE,h=null,c=e.Vector3.Zero(),u=i.getViewMatrix(),f=0;f<o;f++){var d=this.sprites[f];if(d){if(r){if(!r(d))continue}else if(!d.isPickable)continue;if(e.Vector3.TransformCoordinatesToRef(d.position,u,c),s.copyFromFloats(c.x-d.width/2,c.y-d.height/2,c.z),a.copyFromFloats(c.x+d.width/2,c.y+d.height/2,c.z),t.intersectsBoxMinMax(s,a)){var p=e.Vector3.Distance(c,t.origin);if(l>p&&(l=p,h=d,n))break}}}if(h){var m=new e.PickingInfo;return m.hit=!0,m.pickedSprite=h,m.distance=l,m}return null},t.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var t=this._scene.getEngine(),i=this._spriteTexture.getBaseSize(),r=t.getDeltaTime(),n=Math.min(this._capacity,this.sprites.length),o=i.width/this.cellWidth,s=0,a=0;a<n;a++){var l=this.sprites[a];l&&(l._animate(r),this._appendSpriteVertex(s++,l,0,0,o),this._appendSpriteVertex(s++,l,1,0,o),this._appendSpriteVertex(s++,l,1,1,o),this._appendSpriteVertex(s++,l,0,1,o))}this._buffer.update(this._vertexData);var h=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(h=this._effectFog),t.enableEffect(h);var c=this._scene.getViewMatrix();h.setTexture("diffuseSampler",this._spriteTexture),h.setMatrix("view",c),h.setMatrix("projection",this._scene.getProjectionMatrix()),h.setFloat2("textureInfos",this.cellWidth/i.width,this.cellHeight/i.height),this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(h.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),h.setColor3("vFogColor",this._scene.fogColor)),t.bindBuffers(this._vertexBuffers,this._indexBuffer,h),t.setDepthFunctionToLessOrEqual(),h.setBool("alphaTest",!0),t.setColorWrite(!1),t.draw(!0,0,6*n),t.setColorWrite(!0),h.setBool("alphaTest",!1),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6*n),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t}();e.SpriteManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){this.name=t,this.color=new e.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._time=0,this._manager=i,this._manager.sprites.push(this),this.position=e.Vector3.Zero()}return Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),t.prototype.playAnimation=function(e,t,i,r,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=r,this._animationStarted=!0,this._direction=e<t?1:-1,this.cellIndex=e,this._time=0,this._onAnimationEnd=n},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex>this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this.cellIndex=this._toIndex,this._animationStarted=!1,this._onAnimationEnd&&this._onAnimationEnd(),this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},t}();e.Sprite=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null}return t.prototype.getNormal=function(t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var r=this.pickedMesh.getIndices();if(!r)return null;var n;if(i){var o=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),s=e.Vector3.FromArray(o,3*r[3*this.faceId]),a=e.Vector3.FromArray(o,3*r[3*this.faceId+1]),l=e.Vector3.FromArray(o,3*r[3*this.faceId+2]);s=s.scale(this.bu),a=a.scale(this.bv),l=l.scale(1-this.bu-this.bv),n=new e.Vector3(s.x+a.x+l.x,s.y+a.y+l.y,s.z+a.z+l.z)}else{var h=this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind),c=e.Vector3.FromArray(h,3*r[3*this.faceId]),u=e.Vector3.FromArray(h,3*r[3*this.faceId+1]),f=e.Vector3.FromArray(h,3*r[3*this.faceId+2]),d=c.subtract(u),p=f.subtract(u);n=e.Vector3.Cross(d,p)}return t&&(n=e.Vector3.TransformNormal(n,this.pickedMesh.getWorldMatrix())),e.Vector3.Normalize(n)},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind);if(!i)return null;var r=e.Vector2.FromArray(i,2*t[3*this.faceId]),n=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return r=r.scale(1-this.bu-this.bv),n=n.scale(this.bu),o=o.scale(this.bv),new e.Vector2(r.x+n.x+o.x,r.y+n.y+o.y)},t}();e.PickingInfo=i}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i,r,n,o,s=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else if(i=1/this.direction.x,r=(e.x-this.origin.x)*i,n=(t.x-this.origin.x)*i,n===-1/0&&(n=1/0),r>n&&(o=r,r=n,n=o),s=Math.max(r,s),a=Math.min(n,a),s>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(i=1/this.direction.y,r=(e.y-this.origin.y)*i,n=(t.y-this.origin.y)*i,n===-1/0&&(n=1/0),r>n&&(o=r,r=n,n=o),s=Math.max(r,s),a=Math.min(n,a),s>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(i=1/this.direction.z,r=(e.z-this.origin.z)*i,n=(t.z-this.origin.z)*i,n===-1/0&&(n=1/0),r>n&&(o=r,r=n,n=o),s=Math.max(r,s),a=Math.min(n,a),s>a)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,r=e.center.z-this.origin.z,n=t*t+i*i+r*r,o=e.radius*e.radius;if(n<=o)return!0;var s=t*this.direction.x+i*this.direction.y+r*this.direction.z;return!(s<0)&&n-s*s<=o},t.prototype.intersectsTriangle=function(t,i,r){this._edge1||(this._edge1=e.Vector3.Zero(),this._edge2=e.Vector3.Zero(),this._pvec=e.Vector3.Zero(),this._tvec=e.Vector3.Zero(),this._qvec=e.Vector3.Zero()),i.subtractToRef(t,this._edge1),r.subtractToRef(t,this._edge2),e.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var n=e.Vector3.Dot(this._edge1,this._pvec);if(0===n)return null;var o=1/n;this.origin.subtractToRef(t,this._tvec);var s=e.Vector3.Dot(this._tvec,this._pvec)*o;if(s<0||s>1)return null;e.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var a=e.Vector3.Dot(this.direction,this._qvec)*o;if(a<0||s+a>1)return null;var l=e.Vector3.Dot(this._edge2,this._qvec)*o;return l>this.length?null:new e.IntersectionInfo(s,a,l)},t.prototype.intersectsPlane=function(t){var i,r=e.Vector3.Dot(t.normal,this.direction);if(Math.abs(r)<9.99999997475243e-7)return null;var n=e.Vector3.Dot(t.normal,this.origin);return i=(-t.d-n)/r,i<0?i<-9.99999997475243e-7?null:0:i},t.prototype.intersectsMesh=function(i,r){var n=e.Tmp.Matrix[0];return i.getWorldMatrix().invertToRef(n),this._tmpRay?t.TransformToRef(this,n,this._tmpRay):this._tmpRay=t.Transform(this,n),i.intersects(this._tmpRay,r)},t.prototype.intersectsMeshes=function(e,t,i){i?i.length=0:i=[];for(var r=0;r<e.length;r++){var n=this.intersectsMesh(e[r],t);n.hit&&i.push(n)}return i.sort(this._comparePickingInfo),i},t.prototype._comparePickingInfo=function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0},t.prototype.intersectionSegment=function(i,r,n){var o,s,a,l,h=this.origin.add(this.direction.multiplyByFloats(t.rayl,t.rayl,t.rayl)),c=r.subtract(i),u=h.subtract(this.origin),f=i.subtract(this.origin),d=e.Vector3.Dot(c,c),p=e.Vector3.Dot(c,u),m=e.Vector3.Dot(u,u),g=e.Vector3.Dot(c,f),v=e.Vector3.Dot(u,f),y=d*m-p*p,_=y,b=y;y<t.smallnum?(s=0,_=1,l=v,b=m):(s=p*v-m*g,l=d*v-p*g,s<0?(s=0,l=v,b=m):s>_&&(s=_,l=v+p,b=m)),l<0?(l=0,-g<0?s=0:-g>d?s=_:(s=-g,_=d)):l>b&&(l=b,-g+p<0?s=0:-g+p>d?s=_:(s=-g+p,_=d)),o=Math.abs(s)<t.smallnum?0:s/_,a=Math.abs(l)<t.smallnum?0:l/b;var x=u.multiplyByFloats(a,a,a),T=f.add(c.multiplyByFloats(o,o,o)).subtract(x);return a>0&&a<=this.length&&T.lengthSquared()<n*n?x.length():-1},t.prototype.update=function(t,i,r,n,o,s,a){return e.Vector3.UnprojectFloatsToRef(t,i,0,r,n,o,s,a,this.origin),e.Vector3.UnprojectFloatsToRef(t,i,1,r,n,o,s,a,e.Tmp.Vector3[0]),e.Tmp.Vector3[0].subtractToRef(this.origin,this.direction),this.direction.normalize(),this},t.Zero=function(){return new t(e.Vector3.Zero(),e.Vector3.Zero())},t.CreateNew=function(e,i,r,n,o,s,a){return t.Zero().update(e,i,r,n,o,s,a)},t.CreateNewFromTo=function(i,r,n){void 0===n&&(n=e.Matrix.Identity());var o=r.subtract(i),s=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return o.normalize(),t.Transform(new t(i,o,s),n)},t.Transform=function(i,r){var n=new t(new e.Vector3(0,0,0),new e.Vector3(0,0,0));return t.TransformToRef(i,r,n),n},t.TransformToRef=function(t,i,r){e.Vector3.TransformCoordinatesToRef(t.origin,i,r.origin),e.Vector3.TransformNormalToRef(t.direction,i,r.direction),r.length=t.length;var n=r.direction,o=n.length();if(0!==o&&1!==o){var s=1/o;n.x*=s,n.y*=s,n.z*=s,r.length*=o}},t}();t.smallnum=1e-8,t.rayl=1e9,e.Ray=t}(r||(r={}));var r;!function(e){var t=function(e,t,i,r){return!(e.x>i.x+r)&&(!(i.x-r>t.x)&&(!(e.y>i.y+r)&&(!(i.y-r>t.y)&&(!(e.z>i.z+r)&&!(i.z-r>t.z)))))},i=function(){var e={root:0,found:!1};return function(t,i,r,n){e.root=0,e.found=!1;var o=i*i-4*t*r;if(o<0)return e;var s=Math.sqrt(o),a=(-i-s)/(2*t),l=(-i+s)/(2*t);if(a>l){var h=l;l=a,a=h}return a>0&&a<n?(e.root=a,e.found=!0,e):l>0&&l<n?(e.root=l,e.found=!0,e):e}}(),r=function(){function r(){this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero(),this._radius=e.Vector3.One(),this._retry=0,this._basePointWorld=e.Vector3.Zero(),this._velocityWorld=e.Vector3.Zero(),this._normalizedVelocity=e.Vector3.Zero(),this._collisionMask=-1}return Object.defineProperty(r.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this._collisionMask=isNaN(e)?-1:e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slidePlaneNormal",{get:function(){return this._slidePlaneNormal},enumerable:!0,configurable:!0}),r.prototype._initialize=function(t,i,r){this._velocity=i,e.Vector3.NormalizeToRef(i,this._normalizedVelocity),this._basePoint=t,t.multiplyToRef(this._radius,this._basePointWorld),i.multiplyToRef(this._radius,this._velocityWorld),this._velocityWorldLength=this._velocityWorld.length(),this._epsilon=r,this.collisionFound=!1},r.prototype._checkPointInTriangle=function(t,i,r,n,o){i.subtractToRef(t,this._tempVector),r.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return!(s<0)&&(n.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),!((s=e.Vector3.Dot(this._tempVector4,o))<0)&&(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),(s=e.Vector3.Dot(this._tempVector4,o))>=0))},r.prototype._canDoCollision=function(i,r,n,o){var s=e.Vector3.Distance(this._basePointWorld,i),a=Math.max(this._radius.x,this._radius.y,this._radius.z);return!(s>this._velocityWorldLength+a+r)&&!!t(n,o,this._basePointWorld,this._velocityWorldLength+a)},r.prototype._testTriangle=function(t,r,n,o,s,a){var l,h=!1;r||(r=[]),r[t]||(r[t]=new e.Plane(0,0,0,0),r[t].copyFromPoints(n,o,s));var c=r[t];if(a||c.isFrontFacingTo(this._normalizedVelocity,0)){var u=c.signedDistanceTo(this._basePoint),f=e.Vector3.Dot(c.normal,this._velocity);if(0==f){if(Math.abs(u)>=1)return;h=!0,l=0}else{l=(-1-u)/f;var d=(1-u)/f;if(l>d){var p=d;d=l,l=p}if(l>1||d<0)return;l<0&&(l=0),l>1&&(l=1)}this._collisionPoint.copyFromFloats(0,0,0);var m=!1,g=1;if(h||(this._basePoint.subtractToRef(c.normal,this._planeIntersectionPoint),this._velocity.scaleToRef(l,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,n,o,s,c.normal)&&(m=!0,g=l,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!m){var v=this._velocity.lengthSquared(),y=v;this._basePoint.subtractToRef(n,this._tempVector);var _=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(y,_,b,g);x.found&&(g=x.root,m=!0,this._collisionPoint.copyFrom(n)),this._basePoint.subtractToRef(o,this._tempVector),_=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(y,_,b,g),x.found&&(g=x.root,m=!0,this._collisionPoint.copyFrom(o)),this._basePoint.subtractToRef(s,this._tempVector),_=2*e.Vector3.Dot(this._velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(y,_,b,g),x.found&&(g=x.root,m=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(n,this._edge),n.subtractToRef(this._basePoint,this._baseToVertex);var T=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this._velocity),S=e.Vector3.Dot(this._edge,this._baseToVertex);if(y=T*-v+E*E,_=T*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*E*S,b=T*(1-this._baseToVertex.lengthSquared())+S*S,x=i(y,_,b,g),x.found){var w=(E*x.root-S)/T;w>=0&&w<=1&&(g=x.root,m=!0,this._edge.scaleInPlace(w),n.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this._basePoint,this._baseToVertex),T=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this._velocity),S=e.Vector3.Dot(this._edge,this._baseToVertex),y=T*-v+E*E,_=T*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*E*S,b=T*(1-this._baseToVertex.lengthSquared())+S*S,x=i(y,_,b,g),x.found&&(w=(E*x.root-S)/T)>=0&&w<=1&&(g=x.root,m=!0,this._edge.scaleInPlace(w),o.addToRef(this._edge,this._collisionPoint)),n.subtractToRef(s,this._edge),s.subtractToRef(this._basePoint,this._baseToVertex),T=this._edge.lengthSquared(),E=e.Vector3.Dot(this._edge,this._velocity),S=e.Vector3.Dot(this._edge,this._baseToVertex),y=T*-v+E*E,_=T*(2*e.Vector3.Dot(this._velocity,this._baseToVertex))-2*E*S,b=T*(1-this._baseToVertex.lengthSquared())+S*S,x=i(y,_,b,g),x.found&&(w=(E*x.root-S)/T)>=0&&w<=1&&(g=x.root,m=!0,this._edge.scaleInPlace(w),s.addToRef(this._edge,this._collisionPoint))}if(m){var M=g*this._velocity.length();(!this.collisionFound||M<this._nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this._nearestDistance=M,this.collisionFound=!0)}}},r.prototype._collide=function(e,t,i,r,n,o,s){for(var a=r;a<n;a+=3){var l=t[i[a]-o],h=t[i[a+1]-o],c=t[i[a+2]-o];this._testTriangle(a,e,c,h,l,s)}},r.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this._nearestDistance/i.length()),this._basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this._epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},r}();e.Collider=r}(r||(r={}));var r;!function(e){e.CollisionWorker="";var t;!function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(t=e.WorkerTaskType||(e.WorkerTaskType={}));var i;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(i=e.WorkerReplyType||(e.WorkerReplyType={}));var r=function(){function r(){var n=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){n._addUpdateMeshesList[e.uniqueId]=r.SerializeMesh(e)},this.onGeometryUpdated=function(e){n._addUpdateGeometriesList[e.id]=r.SerializeGeometry(e)},this._afterRender=function(){if(n._init&&!(0==n._toRemoveGeometryArray.length&&0==n._toRemoveMeshesArray.length&&0==Object.keys(n._addUpdateGeometriesList).length&&0==Object.keys(n._addUpdateMeshesList).length||n._runningUpdated>4)){++n._runningUpdated;var e={updatedMeshes:n._addUpdateMeshesList,updatedGeometries:n._addUpdateGeometriesList,removedGeometries:n._toRemoveGeometryArray,removedMeshes:n._toRemoveMeshesArray},i={payload:e,taskType:t.UPDATE},r=[];for(var o in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(o)&&(r.push(i.payload.updatedGeometries[o].indices.buffer),r.push(i.payload.updatedGeometries[o].normals.buffer),r.push(i.payload.updatedGeometries[o].positions.buffer));n._worker.postMessage(i,r),n._addUpdateMeshesList={},n._addUpdateGeometriesList={},n._toRemoveGeometryArray=[],n._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(r){var o=r.data;if(o.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(o.taskType){case t.INIT:n._init=!0,n._scene.meshes.forEach(function(e){n.onMeshAdded(e)}),n._scene.getGeometries().forEach(function(e){n.onGeometryAdded(e)});break;case t.UPDATE:n._runningUpdated--;break;case t.COLLIDE:var s=o.payload;if(!n._collisionsCallbackArray[s.collisionId])return;var a=n._collisionsCallbackArray[s.collisionId];if(a){var l=n._scene.getMeshByUniqueID(s.collidedMeshUniqueId);l&&a(s.collisionId,e.Vector3.FromArray(s.newPosition),l)}n._collisionsCallbackArray[s.collisionId]=null}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return r.prototype.getNewPosition=function(e,i,r,n,o,s,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(r._radius,this._scaledPosition),i.divideToRef(r._radius,this._scaledVelocity),this._collisionsCallbackArray[a]=s;var l={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:r._radius.asArray()},collisionId:a,excludedMeshUniqueId:o?o.uniqueId:null,maximumRetry:n},h={payload:l,taskType:t.COLLIDE};this._worker.postMessage(h)}},r.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var r=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(r),this._worker.onmessage=this._onMessageFromWorker;var n={payload:{},taskType:t.INIT};this._worker.postMessage(n)},r.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},r.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},r.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},r.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},r.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},r}();r.SerializeMesh=function(t){var i=[];t.subMeshes&&(i=t.subMeshes.map(function(e,t){var i=e.getBoundingInfo();return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:i.boundingSphere.centerWorld.asArray(),sphereRadius:i.boundingSphere.radiusWorld,boxMinimum:i.boundingBox.minimumWorld.asArray(),boxMaximum:i.boundingBox.maximumWorld.asArray()}}));var r=null;if(t instanceof e.Mesh){var n=t.geometry;r=n?n.id:null}else if(t instanceof e.InstancedMesh){var n=t.sourceMesh.geometry;r=n?n.id:null}var o=t.getBoundingInfo();return{uniqueId:t.uniqueId,id:t.id,name:t.name,geometryId:r,sphereCenter:o.boundingSphere.centerWorld.asArray(),sphereRadius:o.boundingSphere.radiusWorld,boxMinimum:o.boundingBox.minimumWorld.asArray(),boxMaximum:o.boundingBox.maximumWorld.asArray(),worldMatrixFromCache:t.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:t.checkCollisions}},r.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Uint32Array(t.getIndices()||[])}},e.CollisionCoordinatorWorker=r;var n=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,i,r,n,o,s){e.divideToRef(i._radius,this._scaledPosition),t.divideToRef(i._radius,this._scaledVelocity),i.collidedMesh=null,i._retry=0,i._initialVelocity=this._scaledVelocity,i._initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,r,this._finalPosition,n),this._finalPosition.multiplyInPlace(i._radius),o(s,this._finalPosition,i.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,i,r,n,o,s){void 0===s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(r._retry>=n)return void o.copyFrom(t);var l=s?s.collisionMask:r.collisionMask;r._initialize(t,i,a);for(var h=0;h<this._scene.meshes.length;h++){var c=this._scene.meshes[h];c.isEnabled()&&c.checkCollisions&&c.subMeshes&&c!==s&&0!=(l&c.collisionGroup)&&c._checkCollision(r)}return r.collisionFound?(0===i.x&&0===i.y&&0===i.z||r._getResponse(t,i),i.length()<=a?void o.copyFrom(t):(r._retry++,void this._collideWithWorld(t,i,r,n,o,s))):void t.addToRef(i,o)},t}();e.CollisionCoordinatorLegacy=n}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.particleSystem=t,this.position=e.Vector3.Zero(),this.direction=e.Vector3.Zero(),this.color=new e.Color4(0,0,0,0),this.colorStep=new e.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.angle=0,this.angularSpeed=0,this._currentFrameCounter=0,this.cellIndex=0,this.particleSystem.isAnimationSheetEnabled&&(this.cellIndex=this.particleSystem.startSpriteCellID,0==this.particleSystem.spriteCellChangeSpeed?this.updateCellIndex=this.updateCellIndexWithSpeedCalculated:this.updateCellIndex=this.updateCellIndexWithCustomSpeed)}return t.prototype.updateCellIndexWithSpeedCalculated=function(e){var t=(this.lifeTime-this.age)/e/(this.particleSystem.endSpriteCellID+1-this.cellIndex);this._currentFrameCounter+=e,this._currentFrameCounter>=t*e&&(this._currentFrameCounter=0,++this.cellIndex>this.particleSystem.endSpriteCellID&&(this.cellIndex=this.particleSystem.endSpriteCellID))},t.prototype.updateCellIndexWithCustomSpeed=function(){this._currentFrameCounter>=this.particleSystem.spriteCellChangeSpeed?(this.cellIndex++,this._currentFrameCounter=0,this.cellIndex>this.particleSystem.endSpriteCellID&&(this.particleSystem.spriteCellLoop?this.cellIndex=this.particleSystem.startSpriteCellID:this.cellIndex=this.particleSystem.endSpriteCellID)):this._currentFrameCounter++},t.prototype.copyTo=function(e){e.position.copyFrom(this.position),e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e.size=this.size,e.angle=this.angle,e.angularSpeed=this.angularSpeed,e.particleSystem=this.particleSystem,e.cellIndex=this.cellIndex},t}();e.Particle=t}(r||(r={}));var r;!function(e){var t=function(e,t){return e===t?e:Math.random()*(t-e)+e},i=function(){function i(r,n,o,s,a,l){void 0===s&&(s=null),void 0===a&&(a=!1),void 0===l&&(l=.01);var h=this;this.name=r,this._isAnimationSheetEnabled=a,this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.onDisposeObservable=new e.Observable,this.onAnimationEnd=null,this.blendMode=i.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=e.Vector3.Zero(),this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.minEmitBox=new e.Vector3(-.5,-.5,-.5),this.maxEmitBox=new e.Vector3(.5,.5,.5),this.color1=new e.Color4(1,1,1,1),this.color2=new e.Color4(1,1,1,1),this.colorDead=new e.Color4(0,0,0,1),this.textureMask=new e.Color4(1,1,1,1),this.particles=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new e.Color4(0,0,0,0),this._colorDiff=new e.Color4(0,0,0,0),this._scaledDirection=e.Vector3.Zero(),this._scaledGravity=e.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellLoop=!0,this.spriteCellChangeSpeed=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this._vertexBufferSize=11,this.appendParticleVertexes=null,this.id=r,this._capacity=n,this._epsilon=l,a&&(this._vertexBufferSize=12),this._scene=o||e.Engine.LastCreatedScene,this._customEffect=s,o.particleSystems.push(this),this._createIndexBuffer(),this._vertexData=new Float32Array(n*this._vertexBufferSize*4),this._vertexBuffer=new e.Buffer(o.getEngine(),this._vertexData,!0,this._vertexBufferSize);var c=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.PositionKind,0,3),u=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.ColorKind,3,4),f=this._vertexBuffer.createVertexBuffer("options",7,4);if(this._isAnimationSheetEnabled){var d=this._vertexBuffer.createVertexBuffer("cellIndex",11,1);this._vertexBuffers.cellIndex=d}this._vertexBuffers[e.VertexBuffer.PositionKind]=c,this._vertexBuffers[e.VertexBuffer.ColorKind]=u,this._vertexBuffers.options=f,this.startDirectionFunction=function(i,r,n,o){var s=t(h.direction1.x,h.direction2.x),a=t(h.direction1.y,h.direction2.y),l=t(h.direction1.z,h.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(s*i,a*i,l*i,r,n)},this.startPositionFunction=function(i,r,n){var o=t(h.minEmitBox.x,h.maxEmitBox.x),s=t(h.minEmitBox.y,h.maxEmitBox.y),a=t(h.minEmitBox.z,h.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(o,s,a,i,r)},this.updateFunction=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.age+=h._scaledUpdateSpeed,i.age>=i.lifeTime?(h.recycleParticle(i),t--):(i.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),i.color.addInPlace(h._scaledColorStep),i.color.a<0&&(i.color.a=0),i.angle+=i.angularSpeed*h._scaledUpdateSpeed,i.direction.scaleToRef(h._scaledUpdateSpeed,h._scaledDirection),i.position.addInPlace(h._scaledDirection),h.gravity.scaleToRef(h._scaledUpdateSpeed,h._scaledGravity),i.direction.addInPlace(h._scaledGravity),h._isAnimationSheetEnabled&&i.updateCellIndex(h._scaledUpdateSpeed))}}}return Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isAnimationSheetEnabled",{get:function(){return this._isAnimationSheetEnabled},enumerable:!0,configurable:!0}),i.prototype._createIndexBuffer=function(){for(var e=[],t=0,i=0;i<this._capacity;i++)e.push(t),e.push(t+1),e.push(t+2),e.push(t),e.push(t+2),e.push(t+3),t+=4;this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},i.prototype.recycleParticle=function(e){var t=this.particles.pop();t!==e&&(t.copyTo(e),this._stockParticles.push(t))},i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},i.prototype.stop=function(){this._stopped=!0},i.prototype._appendParticleVertex=function(e,t,i,r){var n=e*this._vertexBufferSize;this._vertexData[n]=t.position.x,this._vertexData[n+1]=t.position.y,this._vertexData[n+2]=t.position.z,this._vertexData[n+3]=t.color.r,this._vertexData[n+4]=t.color.g,this._vertexData[n+5]=t.color.b,this._vertexData[n+6]=t.color.a,this._vertexData[n+7]=t.angle,this._vertexData[n+8]=t.size,this._vertexData[n+9]=i,this._vertexData[n+10]=r},i.prototype._appendParticleVertexWithAnimation=function(e,t,i,r){0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===r?r=this._epsilon:1===r&&(r=1-this._epsilon);var n=e*this._vertexBufferSize;this._vertexData[n]=t.position.x,this._vertexData[n+1]=t.position.y,this._vertexData[n+2]=t.position.z,this._vertexData[n+3]=t.color.r,this._vertexData[n+4]=t.color.g,this._vertexData[n+5]=t.color.b,this._vertexData[n+6]=t.color.a,this._vertexData[n+7]=t.angle,this._vertexData[n+8]=t.size,this._vertexData[n+9]=i,this._vertexData[n+10]=r,this._vertexData[n+11]=t.cellIndex},i.prototype._update=function(i){this._alive=this.particles.length>0,this.updateFunction(this.particles);var r;if(this.emitter.position){r=this.emitter.getWorldMatrix()}else{var n=this.emitter;r=e.Matrix.Translation(n.x,n.y,n.z)}for(var o,s=0;s<i&&this.particles.length!==this._capacity;s++){0!==this._stockParticles.length?(o=this._stockParticles.pop(),o.age=0,o.cellIndex=this.startSpriteCellID):o=new e.Particle(this),this.particles.push(o);var a=t(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(a,r,o.direction,o),o.lifeTime=t(this.minLifeTime,this.maxLifeTime),o.size=t(this.minSize,this.maxSize),o.angularSpeed=t(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(r,o.position,o);var l=t(0,1);e.Color4.LerpToRef(this.color1,this.color2,l,o.color),this.colorDead.subtractToRef(o.color,this._colorDiff),this._colorDiff.scaleToRef(1/o.lifeTime,o.colorStep)}},i.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var t=[];this._scene.clipPlane&&t.push("#define CLIPPLANE"),this._isAnimationSheetEnabled&&t.push("#define ANIMATESHEET");var i=t.join("\n");if(this._cachedDefines!==i){this._cachedDefines=i;var r,n;this._isAnimationSheetEnabled?(r=[e.VertexBuffer.PositionKind,e.VertexBuffer.ColorKind,"options","cellIndex"],n=["invView","view","projection","particlesInfos","vClipPlane","textureMask"]):(r=[e.VertexBuffer.PositionKind,e.VertexBuffer.ColorKind,"options"],n=["invView","view","projection","vClipPlane","textureMask"]),this._effect=this._scene.getEngine().createEffect("particles",r,n,["diffuseSampler"],i)}return this._effect},i.prototype.animate=function(){if(this._started){var e=this._getEffect();if(this.emitter&&e.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var t;this.manualEmitCount>-1?(t=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(t=this.emitRate*this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-t),this._newPartsExcess>1&&(t+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?t=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(t),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene._toBeDisposed.push(this))),this._isAnimationSheetEnabled?this.appendParticleVertexes=this.appenedParticleVertexesWithSheet:this.appendParticleVertexes=this.appenedParticleVertexesNoSheet;for(var i=0,r=0;r<this.particles.length;r++){var n=this.particles[r];this.appendParticleVertexes(i,n),i+=4}this._vertexBuffer&&this._vertexBuffer.update(this._vertexData)}}},i.prototype.appenedParticleVertexesWithSheet=function(e,t){this._appendParticleVertexWithAnimation(e++,t,0,0),this._appendParticleVertexWithAnimation(e++,t,1,0),this._appendParticleVertexWithAnimation(e++,t,1,1),this._appendParticleVertexWithAnimation(e++,t,0,1)},i.prototype.appenedParticleVertexesNoSheet=function(e,t){this._appendParticleVertex(e++,t,0,0),this._appendParticleVertex(e++,t,1,0),this._appendParticleVertex(e++,t,1,1),this._appendParticleVertex(e++,t,0,1)},i.prototype.rebuild=function(){this._createIndexBuffer(),this._vertexBuffer&&this._vertexBuffer._rebuild()},i.prototype.render=function(){var t=this._getEffect();if(!(this.emitter&&t.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var r=this._scene.getEngine();r.enableEffect(t),r.setState(!1);var n=this._scene.getViewMatrix();if(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",n),t.setMatrix("projection",this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled){var o=this.particleTexture.getBaseSize();t.setFloat3("particlesInfos",this.spriteCellWidth/o.width,this.spriteCellHeight/o.height,o.width/this.spriteCellWidth)}if(t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var s=this._scene.clipPlane,a=n.clone();a.invert(),t.setMatrix("invView",a),t.setFloat4("vClipPlane",s.normal.x,s.normal.y,s.normal.z,s.d)}return r.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this.blendMode===i.BLENDMODE_ONEONE?r.setAlphaMode(e.Engine.ALPHA_ONEONE):r.setAlphaMode(e.Engine.ALPHA_COMBINE),this.forceDepthWrite&&r.setDepthWrite(!0),r.draw(!0,0,6*this.particles.length),r.setAlphaMode(e.Engine.ALPHA_DISABLE),this.particles.length},i.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var e=this._scene.particleSystems.indexOf(this);e>-1&&this._scene.particleSystems.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.clone=function(t,r){var n=null,o=null;if(null!=this.customShader){o=this.customShader;var s=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";n=this._scene.getEngine().createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,s)}var a=new i(t,this._capacity,this._scene,n);return a.customShader=o,e.Tools.DeepCopy(this,a,["particles","customShader"]),void 0===r&&(r=this.emitter),a.emitter=r,this.particleTexture&&(a.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),this.preventAutoStart||a.start(),a},i.prototype.serialize=function(){var t={};if(t.name=this.name,t.id=this.id,this.emitter.position){var i=this.emitter;t.emitterId=i.id}else{var r=this.emitter;t.emitter=r.asArray()}return t.capacity=this.getCapacity(),this.particleTexture&&(t.textureName=this.particleTexture.name),e.Animation.AppendSerializedAnimations(this,t),t.minAngularSpeed=this.minAngularSpeed,t.maxAngularSpeed=this.maxAngularSpeed,t.minSize=this.minSize,t.maxSize=this.maxSize,t.minEmitPower=this.minEmitPower,t.maxEmitPower=this.maxEmitPower,t.minLifeTime=this.minLifeTime,t.maxLifeTime=this.maxLifeTime,t.emitRate=this.emitRate,t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t.gravity=this.gravity.asArray(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.color1=this.color1.asArray(),t.color2=this.color2.asArray(),t.colorDead=this.colorDead.asArray(),t.updateSpeed=this.updateSpeed,t.targetStopDuration=this.targetStopDuration,t.textureMask=this.textureMask.asArray(),t.blendMode=this.blendMode,t.customShader=this.customShader,t.preventAutoStart=this.preventAutoStart,t},i.Parse=function(t,r,n){var o=t.name,s=null,a=null;if(t.customShader){a=t.customShader;var l=a.shaderOptions.defines.length>0?a.shaderOptions.defines.join("\n"):"";s=r.getEngine().createEffectForParticles(a.shaderPath.fragmentElement,a.shaderOptions.uniforms,a.shaderOptions.samplers,l)}var h=new i(o,t.capacity,r,s);if(h.customShader=a,t.id&&(h.id=t.id),t.preventAutoStart&&(h.preventAutoStart=t.preventAutoStart),t.textureName&&(h.particleTexture=new e.Texture(n+t.textureName,r),h.particleTexture.name=t.textureName),t.emitterId?h.emitter=r.getLastMeshByID(t.emitterId):h.emitter=e.Vector3.FromArray(t.emitter),t.animations)for(var c=0;c<t.animations.length;c++){var u=t.animations[c];h.animations.push(e.Animation.Parse(u))}return t.autoAnimate&&r.beginAnimation(h,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),h.minAngularSpeed=t.minAngularSpeed,h.maxAngularSpeed=t.maxAngularSpeed,h.minSize=t.minSize,h.maxSize=t.maxSize,h.minLifeTime=t.minLifeTime,h.maxLifeTime=t.maxLifeTime,h.minEmitPower=t.minEmitPower,h.maxEmitPower=t.maxEmitPower,h.emitRate=t.emitRate,h.minEmitBox=e.Vector3.FromArray(t.minEmitBox),h.maxEmitBox=e.Vector3.FromArray(t.maxEmitBox),h.gravity=e.Vector3.FromArray(t.gravity),h.direction1=e.Vector3.FromArray(t.direction1),h.direction2=e.Vector3.FromArray(t.direction2),h.color1=e.Color4.FromArray(t.color1),h.color2=e.Color4.FromArray(t.color2),h.colorDead=e.Color4.FromArray(t.colorDead),h.updateSpeed=t.updateSpeed,h.targetStopDuration=t.targetStopDuration,h.textureMask=e.Color4.FromArray(t.textureMask),h.blendMode=t.blendMode,h.preventAutoStart||h.start(),h},i}();i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,e.ParticleSystem=i}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){this.name=t,this.emitter=null,this.renderingGroupId=0,this.layerMask=268435455,this._updateVertexBuffers={},this._renderVertexBuffers={},this._currentRenderId=-1,this._started=!0,this.onDisposeObservable=new e.Observable,this.id=t,this._scene=r||e.Engine.LastCreatedScene,this._capacity=i,this._engine=this._scene.getEngine(),this._scene.particleSystems.push(this),this._renderEffect=new e.Effect("gpuRenderParticles",["position","age","life","velocity"],[],[],this._scene.getEngine());var n={attributes:["position","age","life","velocity"],uniformsNames:[],uniformBuffersNames:[],samplers:[],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition","outAge","outLife","outVelocity"]};this._updateEffect=new e.Effect("gpuUpdateParticles",n,this._scene.getEngine())}return t.prototype.isStarted=function(){return this._started},t.prototype.start=function(){this._started=!0},t.prototype.stop=function(){this._started=!1},t.prototype.animate=function(){},t.prototype._initialize=function(){if(!this._renderVAO){for(var t=new Array,i=0;i<this._capacity;i++){t.push(0),t.push(0),t.push(0);var r=1+10*Math.random();t.push(r+1),t.push(r),t.push(0),t.push(0),t.push(0)}this._updateBuffer=new e.Buffer(this._scene.getEngine(),t,!1,0),this._updateVertexBuffers.position=this._updateBuffer.createVertexBuffer("position",0,3,3),this._updateVertexBuffers.age=this._updateBuffer.createVertexBuffer("age",3,1,1),this._updateVertexBuffers.life=this._updateBuffer.createVertexBuffer("life",4,1,1),this._updateVertexBuffers.velocity=this._updateBuffer.createVertexBuffer("velocity",5,3,3),this._updateVAO=this._engine.recordVertexArrayObject(this._updateVertexBuffers,null,this._updateEffect),this._engine.bindArrayBuffer(null),this._renderBuffer=new e.Buffer(this._scene.getEngine(),t,!1,0),this._renderVertexBuffers.position=this._renderBuffer.createVertexBuffer("position",0,3,3),this._renderVertexBuffers.age=this._renderBuffer.createVertexBuffer("age",3,1,1),this._renderVertexBuffers.life=this._renderBuffer.createVertexBuffer("life",4,1,1),this._renderVertexBuffers.velocity=this._renderBuffer.createVertexBuffer("velocity",5,3,3),this._renderVAO=this._engine.recordVertexArrayObject(this._renderVertexBuffers,null,this._renderEffect),this._engine.bindArrayBuffer(null),this._sourceVAO=this._updateVAO,this._targetVAO=this._renderVAO,this._sourceBuffer=this._updateBuffer,this._targetBuffer=this._renderBuffer}},t.prototype.render=function(){if(!this.emitter||!this._updateEffect.isReady()||!this._renderEffect.isReady())return 0;if(this._initialize(),this._currentRenderId===this._scene.getRenderId())return 0;this._currentRenderId=this._scene.getRenderId(),this._engine.enableEffect(this._updateEffect),this._engine.setState(!1),this._engine.bindVertexArrayObject(this._sourceVAO,null),this._engine.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),this._engine.setRasterizerState(!1),this._engine.beginTransformFeedback(),this._engine.drawPointClouds(0,this._capacity),this._engine.endTransformFeedback(),this._engine.setRasterizerState(!0),this._engine.bindTransformFeedbackBuffer(null),this._engine.enableEffect(this._renderEffect),this._engine.bindVertexArrayObject(this._targetVAO,null),this._engine.drawPointClouds(0,this._capacity);var e=this._sourceVAO;this._sourceVAO=this._targetVAO,this._targetVAO=e;var t=this._sourceBuffer;return this._sourceBuffer=this._targetBuffer,this._targetBuffer=t,0},t.prototype.rebuild=function(){},t.prototype.dispose=function(){var e=this._scene.particleSystems.indexOf(this);e>-1&&this._scene.particleSystems.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t.prototype.clone=function(e,t){return null},t.prototype.serialize=function(){},t}();e.GPUParticleSystem=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o,s,a,l){void 0===l&&(l=null),this.idx=0,this.color=new e.Color4(1,1,1,1),this.position=e.Vector3.Zero(),this.rotation=e.Vector3.Zero(),this.scaling=e.Vector3.One(),this.uvs=new e.Vector4(0,0,1,1),this.velocity=e.Vector3.Zero(),this.pivot=e.Vector3.Zero(),this.alive=!0,this.isVisible=!0,this._pos=0,this._ind=0,this.shapeId=0,this.idxInShape=0,this._stillInvisible=!1,this.idx=t,this._pos=i,this._ind=r,this._model=n,this.shapeId=o,this.idxInShape=s,this._sps=a,l&&(this._modelBoundingInfo=l,this._boundingInfo=new e.BoundingInfo(l.minimum,l.maximum))}return Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),t.prototype.intersectsMesh=function(t){return!(!this._boundingInfo||!t._boundingInfo)&&(this._sps._bSphereOnly?e.BoundingSphere.Intersects(this._boundingInfo.boundingSphere,t._boundingInfo.boundingSphere):this._boundingInfo.intersects(t._boundingInfo,!1))},t}();e.SolidParticle=t;var i=function(){function e(e,t,i,r,n,o){this._indicesLength=0,this.shapeID=e,this._shape=t,this._indicesLength=i,this._shapeUV=r,this._positionFunction=n,this._vertexFunction=o}return e}();e.ModelShape=i;var r=function(){function e(){this.ind=0,this.indicesLength=0,this.sqDistance=0}return e}();e.DepthSortedParticle=r}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.recomputeNormals=!0,this.counter=0,this.vars={},this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._depthSort=!1,this._shapeCounter=0,this._copy=new e.SolidParticle(0,0,0,null,0,0,this),this._color=new e.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._depthSortParticles=!0,this._cam_axisZ=e.Vector3.Zero(),this._cam_axisY=e.Vector3.Zero(),this._cam_axisX=e.Vector3.Zero(),this._axisZ=e.Axis.Z,this._camDir=e.Vector3.Zero(),this._camInvertedPosition=e.Vector3.Zero(),this._rotMatrix=new e.Matrix,this._invertMatrix=new e.Matrix,this._rotated=e.Vector3.Zero(),this._quaternion=new e.Quaternion,this._vertex=e.Vector3.Zero(),this._normal=e.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._mustUnrotateFixedNormals=!1,this._minimum=e.Tmp.Vector3[0],this._maximum=e.Tmp.Vector3[1],this._minBbox=e.Tmp.Vector3[4],this._maxBbox=e.Tmp.Vector3[5],this._particlesIntersect=!1,this._depthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},this._needs32Bits=!1,this._bSphereOnly=!1,this._bSphereRadiusFactor=1,this.name=t,this._scene=i||e.Engine.LastCreatedScene,this._camera=i.activeCamera,this._pickable=!!r&&r.isPickable,this._depthSort=!!r&&r.enableDepthSort,this._particlesIntersect=!!r&&r.particleIntersection,this._bSphereOnly=!!r&&r.boundingSphereOnly,this._bSphereRadiusFactor=r&&r.bSphereRadiusFactor?r.bSphereRadiusFactor:1,r&&r.updatable?this._updatable=r.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[]),this._depthSort&&(this.depthSortedParticles=[])}return t.prototype.buildMesh=function(){if(0===this.nbParticles){var t=e.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}this._indices32=this._needs32Bits?new Uint32Array(this._indices):new Uint16Array(this._indices),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),this.recomputeNormals&&e.VertexData.ComputeNormals(this._positions32,this._indices,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals),this._mustUnrotateFixedNormals&&this._unrotateFixedNormals();var i=new e.VertexData;i.indices=this._depthSort?this._indices:this._indices32,i.set(this._positions32,e.VertexBuffer.PositionKind),i.set(this._normals32,e.VertexBuffer.NormalKind),this._uvs32&&i.set(this._uvs32,e.VertexBuffer.UVKind),this._colors32&&i.set(this._colors32,e.VertexBuffer.ColorKind);var r=new e.Mesh(this.name,this._scene);return i.applyToMesh(r,this._updatable),this.mesh=r,this.mesh.isPickable=this._pickable,this._depthSort||(this._indices=null),this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),r},t.prototype.digest=function(t,i){var r=i&&i.facetNb||1,n=i&&i.number||0,o=i&&i.delta||0,s=t.getVerticesData(e.VertexBuffer.PositionKind),a=t.getIndices(),l=t.getVerticesData(e.VertexBuffer.UVKind),h=t.getVerticesData(e.VertexBuffer.ColorKind),c=t.getVerticesData(e.VertexBuffer.NormalKind),u=0,f=a.length/3;n?(n=n>f?f:n,r=Math.round(f/n),o=0):r=r>f?f:r;for(var d=[],p=[],m=[],g=[],v=e.Tmp.Vector3[0],y=r;u<f;){r=y+Math.floor((1+o)*Math.random()),u>f-r&&(r=f-u),d.length=0,p.length=0,m.length=0,g.length=0;for(var _=0,b=3*u;b<3*(u+r);b++){p.push(_);var x=a[b];d.push(s[3*x],s[3*x+1],s[3*x+2]),l&&m.push(l[2*x],l[2*x+1]),h&&g.push(h[4*x],h[4*x+1],h[4*x+2],h[4*x+3]),_++}var T,E=this.nbParticles,S=this._posToShape(d),w=this._uvsToShapeUV(m);for(T=0;T<S.length;T++)v.addInPlace(S[T]);for(v.scaleInPlace(1/S.length),T=0;T<S.length;T++)S[T].subtractInPlace(v);var M;this._particlesIntersect&&(M=new e.BoundingInfo(v,v));var A=new e.ModelShape(this._shapeCounter,S,3*r,w,null,null),P=this._positions.length,C=this._indices.length;this._meshBuilder(this._index,S,this._positions,p,this._indices,m,this._uvs,g,this._colors,c,this._normals,E,0,null),this._addParticle(E,P,C,A,this._shapeCounter,0,M),this.particles[this.nbParticles].position.addInPlace(v),this._index+=S.length,E++,this.nbParticles++,this._shapeCounter++,u+=r}return this},t.prototype._unrotateFixedNormals=function(){for(var t=0,i=0,r=0;r<this.particles.length;r++){this._particle=this.particles[r],this._shape=this._particle._model._shape,this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix);for(var n=0;n<this._shape.length;n++)i=t+3*n,e.Vector3.TransformNormalFromFloatsToRef(this._normals32[i],this._normals32[i+1],this._normals32[i+2],this._invertMatrix,this._normal),this._fixedNormal32[i]=this._normal.x,this._fixedNormal32[i+1]=this._normal.y,this._fixedNormal32[i+2]=this._normal.z;t=i+3}},t.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null},t.prototype._meshBuilder=function(t,i,r,n,o,s,a,l,h,c,u,f,d,p){var m,g=0,v=0,y=0;for(this._resetCopy(),p&&p.positionFunction&&(p.positionFunction(this._copy,f,d),this._mustUnrotateFixedNormals=!0),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),m=0;m<i.length;m++)this._vertex.x=i[m].x,this._vertex.y=i[m].y,this._vertex.z=i[m].z,p&&p.vertexFunction&&p.vertexFunction(this._copy,this._vertex,m),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x+=this._copy.pivot.x,this._vertex.y+=this._copy.pivot.y,this._vertex.z+=this._copy.pivot.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),r.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),s&&(a.push((this._copy.uvs.z-this._copy.uvs.x)*s[g]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*s[g+1]+this._copy.uvs.y),g+=2),this._copy.color?this._color=this._copy.color:l&&void 0!==l[v]?(this._color.r=l[v],this._color.g=l[v+1],this._color.b=l[v+2],this._color.a=l[v+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),h.push(this._color.r,this._color.g,this._color.b,this._color.a),v+=4,!this.recomputeNormals&&c&&(this._normal.x=c[y],this._normal.y=c[y+1],this._normal.z=c[y+2],e.Vector3.TransformNormalToRef(this._normal,this._rotMatrix,this._normal),u.push(this._normal.x,this._normal.y,this._normal.z),y+=3);for(m=0;m<n.length;m++){var _=t+n[m];o.push(_),_>65535&&(this._needs32Bits=!0)}if(this._pickable){var b=n.length/3;for(m=0;m<b;m++)this.pickedParticles.push({idx:f,faceId:m})}return this._depthSort&&this.depthSortedParticles.push(new e.DepthSortedParticle),this._copy},t.prototype._posToShape=function(t){for(var i=[],r=0;r<t.length;r+=3)i.push(new e.Vector3(t[r],t[r+1],t[r+2]));return i},t.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},t.prototype._addParticle=function(t,i,r,n,o,s,a){void 0===a&&(a=null);var l=new e.SolidParticle(t,i,r,n,o,s,this,a);return this.particles.push(l),l},t.prototype.addShape=function(t,i,r){var n,o=t.getVerticesData(e.VertexBuffer.PositionKind),s=t.getIndices(),a=t.getVerticesData(e.VertexBuffer.UVKind),l=t.getVerticesData(e.VertexBuffer.ColorKind),h=t.getVerticesData(e.VertexBuffer.NormalKind);this._particlesIntersect&&(n=t.getBoundingInfo());for(var c,u,f=this._posToShape(o),d=this._uvsToShapeUV(a),p=r?r.positionFunction:null,m=r?r.vertexFunction:null,g=new e.ModelShape(this._shapeCounter,f,s.length,d,p,m),v=this.nbParticles,y=0;y<i;y++){var _=this._positions.length,b=this._indices.length;u=this._meshBuilder(this._index,f,this._positions,s,this._indices,a,this._uvs,l,this._colors,h,this._normals,v,y,r),this._updatable&&(c=this._addParticle(v,_,b,g,this._shapeCounter,y,n),c.position.copyFrom(u.position),c.rotation.copyFrom(u.rotation),u.rotationQuaternion&&c.rotationQuaternion&&c.rotationQuaternion.copyFrom(u.rotationQuaternion),u.color&&c.color&&c.color.copyFrom(u.color),c.scaling.copyFrom(u.scaling),c.uvs.copyFrom(u.uvs)),this._index+=f.length,v++}return this.nbParticles+=i,++this._shapeCounter-1},t.prototype._rebuildParticle=function(t){this._resetCopy(),t._model._positionFunction&&t._model._positionFunction(this._copy,t.idx,t.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._shape=t._model._shape;for(var i=0;i<this._shape.length;i++)this._vertex.x=this._shape[i].x,this._vertex.y=this._shape[i].y,this._vertex.z=this._shape[i].z,t._model._vertexFunction&&t._model._vertexFunction(this._copy,this._vertex,i),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,this._vertex.x+=this._copy.pivot.x,this._vertex.y+=this._copy.pivot.y,this._vertex.z+=this._copy.pivot.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[t._pos+3*i]=this._copy.position.x+this._rotated.x,this._positions32[t._pos+3*i+1]=this._copy.position.y+this._rotated.y,this._positions32[t._pos+3*i+2]=this._copy.position.z+this._rotated.z;t.position.x=0,t.position.y=0,t.position.z=0,t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.rotationQuaternion=null,t.scaling.x=1,t.scaling.y=1,t.scaling.z=1},t.prototype.rebuildMesh=function(){for(var t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[t]);return this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1),this},t.prototype.setParticles=function(t,i,r){if(void 0===t&&(t=0),void 0===i&&(i=this.nbParticles-1),void 0===r&&(r=!0),!this._updatable)return this;if(this.beforeUpdateParticles(t,i,r),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,(this.billboard||this._depthSort)&&(this.mesh.computeWorldMatrix(!0),this.mesh._worldMatrix.invertToRef(this._invertMatrix)),this.billboard){this._camera.getDirectionToRef(this._axisZ,this._camDir),e.Vector3.TransformNormalToRef(this._camDir,this._invertMatrix,this._cam_axisZ),this._cam_axisZ.normalize();var n=this._camera.getViewMatrix(!0);e.Vector3.TransformNormalFromFloatsToRef(n.m[1],n.m[5],n.m[9],this._invertMatrix,this._cam_axisY),e.Vector3.CrossToRef(this._cam_axisY,this._cam_axisZ,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize()}this._depthSort&&e.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._camInvertedPosition),e.Matrix.IdentityToRef(this._rotMatrix);var o=0,s=0,a=0,l=0,h=0,c=0,u=0;this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),i=i>=this.nbParticles?this.nbParticles-1:i,this._computeBoundingBox&&(0==t&&i==this.nbParticles-1?(e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)):this.mesh._boundingInfo&&(this._minimum.copyFrom(this.mesh._boundingInfo.boundingBox.minimum),this._maximum.copyFrom(this.mesh._boundingInfo.boundingBox.maximum))),s=this.particles[t]._pos;var f=s/3|0;l=4*f,c=2*f;for(var d=t;d<=i;d++){if(this._particle=this.particles[d],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._depthSort&&this._depthSortParticles){var p=this.depthSortedParticles[d];p.ind=this._particle._ind,p.indicesLength=this._particle._model._indicesLength,p.sqDistance=e.Vector3.DistanceSquared(this._particle.position,this._camInvertedPosition)}if(!this._particle.alive||this._particle._stillInvisible&&!this._particle.isVisible)u=this._shape.length,s+=3*u,l+=4*u,c+=2*u;else{if(this._particle.isVisible)for(this._particle._stillInvisible=!1,this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),(this._computeParticleRotation||this.billboard)&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),u=0;u<this._shape.length;u++)o=s+3*u,a=l+4*u,h=c+2*u,this._vertex.x=this._shape[u].x,this._vertex.y=this._shape[u].y,this._vertex.z=this._shape[u].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,u),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._vertex.x+=this._particle.pivot.x,this._vertex.y+=this._particle.pivot.y,this._vertex.z+=this._particle.pivot.z,this._rotated.x=this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8],this._rotated.y=this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9],this._rotated.z=this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10],this._positions32[o]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[o+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[o+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[o]<this._minimum.x&&(this._minimum.x=this._positions32[o]),this._positions32[o]>this._maximum.x&&(this._maximum.x=this._positions32[o]),this._positions32[o+1]<this._minimum.y&&(this._minimum.y=this._positions32[o+1]),this._positions32[o+1]>this._maximum.y&&(this._maximum.y=this._positions32[o+1]),this._positions32[o+2]<this._minimum.z&&(this._minimum.z=this._positions32[o+2]),this._positions32[o+2]>this._maximum.z&&(this._maximum.z=this._positions32[o+2])),this._computeParticleVertex||(this._normal.x=this._fixedNormal32[o],this._normal.y=this._fixedNormal32[o+1],this._normal.z=this._fixedNormal32[o+2],this._rotated.x=this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8],this._rotated.y=this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9],this._rotated.z=this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10],this._normals32[o]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[o+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[o+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&this._particle.color&&(this._colors32[a]=this._particle.color.r,this._colors32[a+1]=this._particle.color.g,this._colors32[a+2]=this._particle.color.b,this._colors32[a+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[2*u]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[2*u+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(this._particle._stillInvisible=!0,u=0;u<this._shape.length;u++)o=s+3*u,a=l+4*u,h=c+2*u,this._positions32[o]=0,this._positions32[o+1]=0,this._positions32[o+2]=0,this._normals32[o]=0,this._normals32[o+1]=0,this._normals32[o+2]=0,this._computeParticleColor&&this._particle.color&&(this._colors32[a]=this._particle.color.r,this._colors32[a+1]=this._particle.color.g,this._colors32[a+2]=this._particle.color.b,this._colors32[a+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[2*u]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[2*u+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);if(this._particlesIntersect){var m=this._particle._boundingInfo,g=m.boundingBox,v=m.boundingSphere;if(!this._bSphereOnly){for(var y=0;y<g.vectors.length;y++)this._vertex.x=this._particle._modelBoundingInfo.boundingBox.vectors[y].x*this._particle.scaling.x,this._vertex.y=this._particle._modelBoundingInfo.boundingBox.vectors[y].y*this._particle.scaling.y,this._vertex.z=this._particle._modelBoundingInfo.boundingBox.vectors[y].z*this._particle.scaling.z,this._rotated.x=this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8],this._rotated.y=this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9],this._rotated.z=this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10],g.vectors[y].x=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,g.vectors[y].y=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,g.vectors[y].z=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z;g._update(this.mesh._worldMatrix)}this._minBbox.x=this._particle._modelBoundingInfo.minimum.x*this._particle.scaling.x,this._minBbox.y=this._particle._modelBoundingInfo.minimum.y*this._particle.scaling.y,this._minBbox.z=this._particle._modelBoundingInfo.minimum.z*this._particle.scaling.z,this._maxBbox.x=this._particle._modelBoundingInfo.maximum.x*this._particle.scaling.x,this._maxBbox.y=this._particle._modelBoundingInfo.maximum.y*this._particle.scaling.y,this._maxBbox.z=this._particle._modelBoundingInfo.maximum.z*this._particle.scaling.z,v.center.x=this._particle.position.x+.5*(this._minBbox.x+this._maxBbox.x),v.center.y=this._particle.position.y+.5*(this._minBbox.y+this._maxBbox.y),v.center.z=this._particle.position.z+.5*(this._minBbox.z+this._maxBbox.z),v.radius=.5*this._bSphereRadiusFactor*Math.sqrt((this._maxBbox.x-this._minBbox.x)*(this._maxBbox.x-this._minBbox.x)+(this._maxBbox.y-this._minBbox.y)*(this._maxBbox.y-this._minBbox.y)+(this._maxBbox.z-this._minBbox.z)*(this._maxBbox.z-this._minBbox.z)),v._update(this.mesh._worldMatrix)}s=o+3,l=a+4,c=h+2}}if(r){if(this._computeParticleColor&&this.mesh.updateVerticesData(e.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(e.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen||this.mesh.isFacetDataEnabled){if(this._computeParticleVertex||this.mesh.isFacetDataEnabled){var _=this.mesh.isFacetDataEnabled?this.mesh.getFacetDataParameters():null;e.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32,_);for(var b=0;b<this._normals32.length;b++)this._fixedNormal32[b]=this._normals32[b]}this.mesh.areNormalsFrozen||this.mesh.updateVerticesData(e.VertexBuffer.NormalKind,this._normals32,!1,!1)}if(this._depthSort&&this._depthSortParticles){this.depthSortedParticles.sort(this._depthSortFunction);var x=this.depthSortedParticles.length,T=0,E=0,S=0,w=0;for(T=0;T<x;T++){E=this.depthSortedParticles[T].indicesLength,S=this.depthSortedParticles[T].ind;for(var b=0;b<E;b++)this._indices32[w]=this._indices[S+b],w++}this.mesh.updateIndices(this._indices32)}}return this._computeBoundingBox&&(this.mesh._boundingInfo=new e.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(t,i,r),this},t.prototype._quaternionRotationYPR=function(){this._halfroll=.5*this._roll,this._halfpitch=.5*this._pitch,this._halfyaw=.5*this._yaw,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},t.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[3]=0,this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[7]=0,this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[11]=0,this._rotMatrix.m[12]=0,this._rotMatrix.m[13]=0,this._rotMatrix.m[14]=0,this._rotMatrix.m[15]=1},t.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},t.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},t.prototype.setVisibilityBox=function(t){var i=t/2;this.mesh._boundingInfo=new e.BoundingInfo(new e.Vector3(-i,-i,-i),new e.Vector3(i,i,i))},Object.defineProperty(t.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthSortParticles",{get:function(){return this._depthSortParticles},set:function(e){this._depthSortParticles=e},enumerable:!0,configurable:!0}),t.prototype.initParticles=function(){},t.prototype.recycleParticle=function(e){return e},t.prototype.updateParticle=function(e){return e},t.prototype.updateParticleVertex=function(e,t,i){return t},t.prototype.beforeUpdateParticles=function(e,t,i){},t.prototype.afterUpdateParticles=function(e,t,i){},t}();e.SolidParticleSystem=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.generateOctree=!1,r}return o(i,t),i.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(i.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e),this.createOrUpdateSubmeshesOctree(t)},i.prototype.getHeightAtCoordinates=function(t,i){var r=this.getWorldMatrix(),n=e.Tmp.Matrix[5];r.invertToRef(n);var o=e.Tmp.Vector3[8];if(e.Vector3.TransformCoordinatesFromFloatsToRef(t,0,i,n,o),t=o.x,i=o.z,t<this._minX||t>this._maxX||i<this._minZ||i>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(t,i),a=-(s.x*t+s.z*i+s.w)/s.y;return e.Vector3.TransformCoordinatesFromFloatsToRef(0,a,0,r,o),o.y},i.prototype.getNormalAtCoordinates=function(t,i){var r=new e.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,i,r),r},i.prototype.getNormalAtCoordinatesToRef=function(t,i,r){var n=this.getWorldMatrix(),o=e.Tmp.Matrix[5];n.invertToRef(o);var s=e.Tmp.Vector3[8];if(e.Vector3.TransformCoordinatesFromFloatsToRef(t,0,i,o,s),t=s.x,i=s.z,t<this._minX||t>this._maxX||i<this._minZ||i>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(t,i);return e.Vector3.TransformNormalFromFloatsToRef(a.x,a.y,a.z,n,r),this},i.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},i.prototype._getFacetAt=function(e,t){var i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[r*this._subdivisionsX+i];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},i.prototype._initHeightQuads=function(){var t=this._subdivisionsX,i=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<i;r++)for(var n=0;n<t;n++){var o={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[r*t+n]=o}return this},i.prototype._computeHeightQuads=function(){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return this;for(var i=e.Tmp.Vector3[3],r=e.Tmp.Vector3[2],n=e.Tmp.Vector3[1],o=e.Tmp.Vector3[0],s=e.Tmp.Vector3[4],a=e.Tmp.Vector3[5],l=e.Tmp.Vector3[6],h=e.Tmp.Vector3[7],c=e.Tmp.Vector3[8],u=0,f=0,d=0,p=0,m=0,g=0,v=0,y=this._subdivisionsX,_=this._subdivisionsY,b=0;b<_;b++)for(var x=0;x<y;x++){u=3*x,f=b*(y+1)*3,d=(b+1)*(y+1)*3,i.x=t[f+u],i.y=t[f+u+1],i.z=t[f+u+2],r.x=t[f+u+3],r.y=t[f+u+4],r.z=t[f+u+5],n.x=t[d+u],n.y=t[d+u+1],n.z=t[d+u+2],o.x=t[d+u+3],o.y=t[d+u+4],o.z=t[d+u+5],p=(o.z-i.z)/(o.x-i.x),m=i.z-p*i.x,r.subtractToRef(i,s),n.subtractToRef(i,a),o.subtractToRef(i,l),e.Vector3.CrossToRef(l,a,h),e.Vector3.CrossToRef(s,l,c),h.normalize(),c.normalize(),g=-(h.x*i.x+h.y*i.y+h.z*i.z),v=-(c.x*r.x+c.y*r.y+c.z*r.z);var T=this._heightQuads[b*y+x];T.slope.copyFromFloats(p,m),T.facet1.copyFromFloats(h.x,h.y,h.z,g),T.facet2.copyFromFloats(c.x,c.y,c.z,v)}return this},i.prototype.serialize=function(e){t.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},i.Parse=function(e,t){var r=new i(e.name,t);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},i}(e.Mesh);e.GroundMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i.getScene())||this;return i.instances.push(r),r._sourceMesh=i,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(),r._syncSubMeshes(),r}return o(i,t),i.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},i.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},i.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},i.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getBoundingInfo();return this._boundingInfo=new e.BoundingInfo(t.minimum.clone(),t.maximum.clone()),this._updateBoundingInfo(),this},i.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},i.prototype._activate=function(e){return this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),this},i.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,r){var n=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,n,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),i&&(n.parent=i),!r)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent===this&&s.clone(s.name,n)}return n.computeWorldMatrix(!0),n},i.prototype.dispose=function(e){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1),t.prototype.dispose.call(this,e)},i}(e.AbstractMesh);e.InstancedMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){void 0===r&&(r=null),void 0===n&&(n=null);var h=t.call(this,i,r,n,o,s)||this;h.useVertexColor=a,h.useVertexAlpha=l,h.color=new e.Color3(1,1,1),h.alpha=1,o&&(h.color=o.color.clone(),h.alpha=o.alpha,h.useVertexColor=o.useVertexColor,h.useVertexAlpha=o.useVertexAlpha),h._intersectionThreshold=.1;var c=[],u={attributes:[e.VertexBuffer.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:c};return!1===l&&(u.needAlphaBlending=!1),a?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(e.VertexBuffer.ColorKind)):u.uniforms.push("color"),h._colorShader=new e.ShaderMaterial("colorShader",h.getScene(),"color",u),h}return o(i,t),Object.defineProperty(i.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(t){this._intersectionThreshold!==t&&(this._intersectionThreshold=t,this.geometry&&(this.geometry.boundingBias=new e.Vector2(0,t)))},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.createInstance=function(e){throw new Error("LinesMeshes do not support createInstance.")},i.prototype._bind=function(e,t,i){return this._geometry?(this._geometry._bind(this._colorShader.getEffect()),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),this):this},i.prototype._draw=function(e,t,i){return this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()?(this.getScene().getEngine().draw(!1,e.indexStart,e.indexCount),this):this},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i.prototype.clone=function(e,t,r){return new i(e,this.getScene(),t,this,r)},i}(e.Mesh);e.LinesMesh=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,i,r)||this;return s._textures={},s._textureArrays={},s._floats={},s._floatsArrays={},s._colors3={},s._colors3Arrays={},s._colors4={},s._vectors2={},s._vectors3={},s._vectors4={},s._matrices={},s._matrices3x3={},s._matrices2x2={},s._vectors2Arrays={},s._vectors3Arrays={},s._cachedWorldViewMatrix=new e.Matrix,s._shaderPath=n,o.needAlphaBlending=o.needAlphaBlending||!1,o.needAlphaTesting=o.needAlphaTesting||!1,o.attributes=o.attributes||["position","normal","uv"],o.uniforms=o.uniforms||["worldViewProjection"],o.uniformBuffers=o.uniformBuffers||[],o.samplers=o.samplers||[],o.defines=o.defines||[],s._options=o,s}return o(i,t),i.prototype.getClassName=function(){return"ShaderMaterial"},i.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},i.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},i.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce(function(e,t){return t.toArray(e,e.length),e},[]),this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},i.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},i.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},i.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},i.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},i.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},i.prototype._checkCache=function(e,t,i){return!t||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},i.prototype.isReady=function(t,i){var r=this.getScene(),n=r.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId()&&this._checkCache(r,t,i))return!0;var o=[],s=[],a=new e.EffectFallbacks;i&&o.push("#define INSTANCES");for(var l=0;l<this._options.defines.length;l++)o.push(this._options.defines[l]);for(var l=0;l<this._options.attributes.length;l++)s.push(this._options.attributes[l]);t&&t.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(s.push(e.VertexBuffer.ColorKind),o.push("#define VERTEXCOLOR")),t&&t.useBones&&t.computeBonesUsingShaders&&t.skeleton?(s.push(e.VertexBuffer.MatricesIndicesKind),s.push(e.VertexBuffer.MatricesWeightsKind),t.numBoneInfluencers>4&&(s.push(e.VertexBuffer.MatricesIndicesExtraKind),s.push(e.VertexBuffer.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),o.push("#define BonesPerMesh "+(t.skeleton.bones.length+1)),a.addCPUSkinningFallback(0,t),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones")):o.push("#define NUM_BONE_INFLUENCERS 0");for(var h in this._textures)if(!this._textures[h].isReady())return!1;n.getAlphaTesting()&&o.push("#define ALPHATEST");var c=this._effect,u=o.join("\n");return this._effect=n.createEffect(this._shaderPath,{attributes:s,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:u,fallbacks:a,onCompiled:this.onCompiled,onError:this.onError},n),!!this._effect.isReady()&&(c!==this._effect&&r.resetCachedMaterial(),this._renderId=r.getRenderId(),!0)},i.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix())))},i.prototype.bind=function(t,i){if(this.bindOnlyWorldMatrix(t),this._effect&&this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._effect);var r;for(r in this._textures)this._effect.setTexture(r,this._textures[r]);for(r in this._textureArrays)this._effect.setTextureArray(r,this._textureArrays[r]);for(r in this._floats)this._effect.setFloat(r,this._floats[r]);for(r in this._floatsArrays)this._effect.setArray(r,this._floatsArrays[r]);for(r in this._colors3)this._effect.setColor3(r,this._colors3[r]);for(r in this._colors3Arrays)this._effect.setArray3(r,this._colors3Arrays[r]);for(r in this._colors4){var n=this._colors4[r];this._effect.setFloat4(r,n.r,n.g,n.b,n.a)}for(r in this._vectors2)this._effect.setVector2(r,this._vectors2[r]);for(r in this._vectors3)this._effect.setVector3(r,this._vectors3[r]);for(r in this._vectors4)this._effect.setVector4(r,this._vectors4[r]);for(r in this._matrices)this._effect.setMatrix(r,this._matrices[r]);for(r in this._matrices3x3)this._effect.setMatrix3x3(r,this._matrices3x3[r]);for(r in this._matrices2x2)this._effect.setMatrix2x2(r,this._matrices2x2[r]);for(r in this._vectors2Arrays)this._effect.setArray2(r,this._vectors2Arrays[r]);for(r in this._vectors3Arrays)this._effect.setArray3(r,this._vectors3Arrays[r])}this._afterBind(i)},i.prototype.getActiveTextures=function(){var e=t.prototype.getActiveTextures.call(this);for(var i in this._textures)e.push(this._textures[i]);for(var i in this._textureArrays)for(var r=this._textureArrays[i],n=0;n<r.length;n++)e.push(r[n]);return e},i.prototype.hasTexture=function(e){if(t.prototype.hasTexture.call(this,e))return!0;for(var i in this._textures)if(this._textures[i]===e)return!0;for(var i in this._textureArrays)for(var r=this._textureArrays[i],n=0;n<r.length;n++)if(r[n]===e)return!0;return!1},i.prototype.clone=function(e){return new i(e,this.getScene(),this._shaderPath,this._options)},i.prototype.dispose=function(e,i){if(i){var r;for(r in this._textures)this._textures[r].dispose();for(r in this._textureArrays)for(var n=this._textureArrays[r],o=0;o<n.length;o++)n[o].dispose()}this._textures={},t.prototype.dispose.call(this,e,i)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath;var i;t.textures={};for(i in this._textures)t.textures[i]=this._textures[i].serialize();t.textureArrays={};for(i in this._textureArrays){t.textureArrays[i]=[];for(var r=this._textureArrays[i],n=0;n<r.length;n++)t.textureArrays[i].push(r[n].serialize())}t.floats={};for(i in this._floats)t.floats[i]=this._floats[i];t.FloatArrays={};for(i in this._floatsArrays)t.FloatArrays[i]=this._floatsArrays[i];t.colors3={};for(i in this._colors3)t.colors3[i]=this._colors3[i].asArray();t.colors3Arrays={};for(i in this._colors3Arrays)t.colors3Arrays[i]=this._colors3Arrays[i];t.colors4={};for(i in this._colors4)t.colors4[i]=this._colors4[i].asArray();t.vectors2={};for(i in this._vectors2)t.vectors2[i]=this._vectors2[i].asArray();t.vectors3={};for(i in this._vectors3)t.vectors3[i]=this._vectors3[i].asArray();t.vectors4={};for(i in this._vectors4)t.vectors4[i]=this._vectors4[i].asArray();t.matrices={};for(i in this._matrices)t.matrices[i]=this._matrices[i].asArray();t.matrices3x3={};for(i in this._matrices3x3)t.matrices3x3[i]=this._matrices3x3[i];t.matrices2x2={};for(i in this._matrices2x2)t.matrices2x2[i]=this._matrices2x2[i];t.vectors2Arrays={};for(i in this._vectors2Arrays)t.vectors2Arrays[i]=this._vectors2Arrays[i];t.vectors3Arrays={};for(i in this._vectors3Arrays)t.vectors3Arrays[i]=this._vectors3Arrays[i];return t},i.Parse=function(t,r,n){var o,s=e.SerializationHelper.Parse(function(){return new i(t.name,r,t.shaderPath,t.options)},t,r,n);for(o in t.textures)s.setTexture(o,e.Texture.Parse(t.textures[o],r,n));for(o in t.textureArrays){for(var a=t.textureArrays[o],l=new Array,h=0;h<a.length;h++)l.push(e.Texture.Parse(a[h],r,n));s.setTextureArray(o,l)}for(o in t.floats)s.setFloat(o,t.floats[o]);for(o in t.floatsArrays)s.setFloats(o,t.floatsArrays[o]);for(o in t.colors3)s.setColor3(o,e.Color3.FromArray(t.colors3[o]));for(o in t.colors3Arrays){var c=t.colors3Arrays[o].reduce(function(e,t,i){return i%3==0?e.push([t]):e[e.length-1].push(t),e},[]).map(function(t){return e.Color3.FromArray(t)});s.setColor3Array(o,c)}for(o in t.colors4)s.setColor4(o,e.Color4.FromArray(t.colors4[o]));for(o in t.vectors2)s.setVector2(o,e.Vector2.FromArray(t.vectors2[o]));for(o in t.vectors3)s.setVector3(o,e.Vector3.FromArray(t.vectors3[o]));for(o in t.vectors4)s.setVector4(o,e.Vector4.FromArray(t.vectors4[o]));for(o in t.matrices)s.setMatrix(o,e.Matrix.FromArray(t.matrices[o]));for(o in t.matrices3x3)s.setMatrix3x3(o,t.matrices3x3[o]);for(o in t.matrices2x2)s.setMatrix2x2(o,t.matrices2x2[o]);for(o in t.vectors2Arrays)s.setArray2(o,t.vectors2Arrays[o]);for(o in t.vectors3Arrays)s.setArray3(o,t.vectors3Arrays[o]);return s},i}(e.Material);e.ShaderMaterial=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.updateSideOrientation=function(t){return t==e.Mesh.DOUBLESIDE?e.Mesh.DOUBLESIDE:void 0===t||null===t?e.Mesh.FRONTSIDE:t},t.CreateBox=function(i,r,n){void 0===n&&(n=null);var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateBox(r).applyToMesh(o,r.updatable),o},t.CreateSphere=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateSphere(r).applyToMesh(o,r.updatable),o},t.CreateDisc=function(i,r,n){void 0===n&&(n=null);var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateDisc(r).applyToMesh(o,r.updatable),o},t.CreateIcoSphere=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateIcoSphere(r).applyToMesh(o,r.updatable),o},t.CreateRibbon=function(i,r,n){void 0===n&&(n=null);var o=r.pathArray,s=r.closeArray,a=r.closePath,l=t.updateSideOrientation(r.sideOrientation),h=r.instance,c=r.updatable;if(h){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,e.Tmp.Vector3[0]),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,e.Tmp.Vector3[1]);var u=h.getVerticesData(e.VertexBuffer.PositionKind);if(function(t){for(var i=o[0].length,r=0,n=h._originalBuilderSideOrientation===e.Mesh.DOUBLESIDE?2:1,s=1;s<=n;s++)for(var a=0;a<o.length;a++){var l=o[a],c=l.length;i=i<c?i:c;for(var u=0;u<i;)t[r]=l[u].x,t[r+1]=l[u].y,t[r+2]=l[u].z,l[u].x<e.Tmp.Vector3[0].x&&(e.Tmp.Vector3[0].x=l[u].x),l[u].x>e.Tmp.Vector3[1].x&&(e.Tmp.Vector3[1].x=l[u].x),l[u].y<e.Tmp.Vector3[0].y&&(e.Tmp.Vector3[0].y=l[u].y),l[u].y>e.Tmp.Vector3[1].y&&(e.Tmp.Vector3[1].y=l[u].y),l[u].z<e.Tmp.Vector3[0].z&&(e.Tmp.Vector3[0].z=l[u].z),l[u].z>e.Tmp.Vector3[1].z&&(e.Tmp.Vector3[1].z=l[u].z),u++,r+=3;h._closePath&&(t[r]=l[0].x,t[r+1]=l[0].y,t[r+2]=l[0].z,r+=3)}}(u),h._boundingInfo=new e.BoundingInfo(e.Tmp.Vector3[0],e.Tmp.Vector3[1]),h._boundingInfo.update(h._worldMatrix),h.updateVerticesData(e.VertexBuffer.PositionKind,u,!1,!1),r.colors){for(var f=h.getVerticesData(e.VertexBuffer.ColorKind),d=0;d<r.colors.length;d++)f[4*d]=r.colors[d].r,f[4*d+1]=r.colors[d].g,f[4*d+2]=r.colors[d].b,f[4*d+3]=r.colors[d].a;h.updateVerticesData(e.VertexBuffer.ColorKind,f,!1,!1)}if(r.uvs){for(var p=h.getVerticesData(e.VertexBuffer.UVKind),m=0;m<r.uvs.length;m++)p[2*m]=r.uvs[m].x,p[2*m+1]=r.uvs[m].y;h.updateVerticesData(e.VertexBuffer.UVKind,p,!1,!1)}if(!h.areNormalsFrozen||h.isFacetDataEnabled){var g=h.getIndices(),v=h.getVerticesData(e.VertexBuffer.NormalKind),y=h.isFacetDataEnabled?h.getFacetDataParameters():null;if(e.VertexData.ComputeNormals(u,g,v,y),h._closePath)for(var _=0,b=0,x=0;x<o.length;x++)_=3*h._idx[x],b=x+1<o.length?3*(h._idx[x+1]-1):v.length-3,v[_]=.5*(v[_]+v[b]),v[_+1]=.5*(v[_+1]+v[b+1]),v[_+2]=.5*(v[_+2]+v[b+2]),v[b]=v[_],v[b+1]=v[_+1],v[b+2]=v[_+2];h.areNormalsFrozen||h.updateVerticesData(e.VertexBuffer.NormalKind,v,!1,!1)}return h}var T=new e.Mesh(i,n);T._originalBuilderSideOrientation=l;var E=e.VertexData.CreateRibbon(r);return a&&(T._idx=E._idx),T._closePath=a,T._closeArray=s,E.applyToMesh(T,c),T},t.CreateCylinder=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateCylinder(r).applyToMesh(o,r.updatable),o},t.CreateTorus=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateTorus(r).applyToMesh(o,r.updatable),o},t.CreateTorusKnot=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreateTorusKnot(r).applyToMesh(o,r.updatable),o},t.CreateLineSystem=function(t,i,r){var n=i.instance,o=i.lines,s=i.colors;if(n){var a,l,h=n.getVerticesData(e.VertexBuffer.PositionKind);s&&(a=n.getVerticesData(e.VertexBuffer.ColorKind));for(var c=0,u=0,f=0;f<o.length;f++)for(var d=o[f],p=0;p<d.length;p++)h[c]=d[p].x,h[c+1]=d[p].y,h[c+2]=d[p].z,s&&a&&(l=s[f],a[u]=l[p].r,a[u+1]=l[p].g,a[u+2]=l[p].b,a[u+3]=l[p].a,u+=4),c+=3;return n.updateVerticesData(e.VertexBuffer.PositionKind,h,!1,!1),s&&a&&n.updateVerticesData(e.VertexBuffer.ColorKind,a,!1,!1),n}var m=!!s,g=new e.LinesMesh(t,r,null,void 0,void 0,m,i.useVertexAlpha);return e.VertexData.CreateLineSystem(i).applyToMesh(g,i.updatable),g},t.CreateLines=function(e,i,r){void 0===r&&(r=null);var n=i.colors?[i.colors]:null;return t.CreateLineSystem(e,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:n,useVertexAlpha:i.useVertexAlpha},r)},t.CreateDashedLines=function(t,i,r){void 0===r&&(r=null);var n=i.points,o=i.instance,s=i.gapSize||1,a=i.dashSize||3;if(o){var l=function(t){var i=e.Vector3.Zero(),r=t.length/6,s=0,a=0,l=0,h=0,c=0,u=0,f=0,d=0;for(f=0;f<n.length-1;f++)n[f+1].subtractToRef(n[f],i),s+=i.length();for(l=s/r,h=o.dashSize*l/(o.dashSize+o.gapSize),f=0;f<n.length-1;f++)for(n[f+1].subtractToRef(n[f],i),a=Math.floor(i.length()/l),i.normalize(),d=0;d<a&&u<t.length;)c=l*d,t[u]=n[f].x+c*i.x,t[u+1]=n[f].y+c*i.y,t[u+2]=n[f].z+c*i.z,t[u+3]=n[f].x+(c+h)*i.x,t[u+4]=n[f].y+(c+h)*i.y,t[u+5]=n[f].z+(c+h)*i.z,u+=6,d++;for(;u<t.length;)t[u]=n[f].x,t[u+1]=n[f].y,t[u+2]=n[f].z,u+=3};return o.updateMeshPositions(l,!1),o}var h=new e.LinesMesh(t,r);return e.VertexData.CreateDashedLines(i).applyToMesh(h,i.updatable),h.dashSize=a,h.gapSize=s,h},t.ExtrudeShape=function(i,r,n){void 0===n&&(n=null);var o=r.path,s=r.shape,a=r.scale||1,l=r.rotation||0,h=0===r.cap?0:r.cap||e.Mesh.NO_CAP,c=r.updatable,u=t.updateSideOrientation(r.sideOrientation),f=r.instance||null,d=r.invertUV||!1;return t._ExtrudeShapeGeneric(i,s,o,a,l,null,null,!1,!1,h,!1,n,!!c,u,f,d,r.frontUVs||null,r.backUVs||null)},t.ExtrudeShapeCustom=function(i,r,n){var o=r.path,s=r.shape,a=r.scaleFunction||function(){return 1},l=r.rotationFunction||function(){return 0},h=r.ribbonCloseArray||!1,c=r.ribbonClosePath||!1,u=0===r.cap?0:r.cap||e.Mesh.NO_CAP,f=r.updatable,d=t.updateSideOrientation(r.sideOrientation),p=r.instance,m=r.invertUV||!1;return t._ExtrudeShapeGeneric(i,s,o,null,null,a,l,h,c,u,!0,n,!!f,d,p||null,m,r.frontUVs||null,r.backUVs||null)},t.CreateLathe=function(i,r,n){var o,s=r.arc?r.arc<=0||r.arc>1?1:r.arc:1,a=void 0===r.closed||r.closed,l=r.shape,h=r.radius||1,c=r.tessellation||64,u=r.updatable,f=t.updateSideOrientation(r.sideOrientation),d=r.cap||e.Mesh.NO_CAP,p=2*Math.PI,m=new Array,g=r.invertUV||!1,v=0,y=0,_=p/c*s,b=new Array;for(v=0;v<=c;v++){var b=[];for(d!=e.Mesh.CAP_START&&d!=e.Mesh.CAP_ALL||(b.push(new e.Vector3(0,l[0].y,0)),b.push(new e.Vector3(Math.cos(v*_)*l[0].x*h,l[0].y,Math.sin(v*_)*l[0].x*h))),y=0;y<l.length;y++)o=new e.Vector3(Math.cos(v*_)*l[y].x*h,l[y].y,Math.sin(v*_)*l[y].x*h),b.push(o);d!=e.Mesh.CAP_END&&d!=e.Mesh.CAP_ALL||(b.push(new e.Vector3(Math.cos(v*_)*l[l.length-1].x*h,l[l.length-1].y,Math.sin(v*_)*l[l.length-1].x*h)),b.push(new e.Vector3(0,l[l.length-1].y,0))),m.push(b)}return t.CreateRibbon(i,{pathArray:m,closeArray:a,sideOrientation:f,updatable:u,invertUV:g,frontUVs:r.frontUVs,backUVs:r.backUVs},n)},t.CreatePlane=function(i,r,n){var o=new e.Mesh(i,n);if(r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePlane(r).applyToMesh(o,r.updatable),r.sourcePlane){o.translate(r.sourcePlane.normal,r.sourcePlane.d);var s=Math.acos(e.Vector3.Dot(r.sourcePlane.normal,e.Axis.Z)),a=e.Vector3.Cross(e.Axis.Z,r.sourcePlane.normal);o.rotate(a,s)}return o},t.CreateGround=function(t,i,r){var n=new e.GroundMesh(t,r);return n._setReady(!1),n._subdivisionsX=i.subdivisionsX||i.subdivisions||1,n._subdivisionsY=i.subdivisionsY||i.subdivisions||1,n._width=i.width||1,n._height=i.height||1,n._maxX=n._width/2,n._maxZ=n._height/2,n._minX=-n._maxX,n._minZ=-n._maxZ,e.VertexData.CreateGround(i).applyToMesh(n,i.updatable),n._setReady(!0),n},t.CreateTiledGround=function(t,i,r){var n=new e.Mesh(t,r);return e.VertexData.CreateTiledGround(i).applyToMesh(n,i.updatable),n},t.CreateGroundFromHeightMap=function(t,i,r,n){var o=r.width||10,s=r.height||10,a=r.subdivisions||1,l=r.minHeight||0,h=r.maxHeight||1,c=r.colorFilter||new e.Color3(.3,.59,.11),u=r.updatable,f=r.onReady,d=new e.GroundMesh(t,n);d._subdivisionsX=a,d._subdivisionsY=a,d._width=o,d._height=s,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1);var p=function(t){var i=document.createElement("canvas"),r=i.getContext("2d");if(!r)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");var n=t.width,p=t.height;i.width=n,i.height=p,r.drawImage(t,0,0);var m=r.getImageData(0,0,n,p).data;e.VertexData.CreateGroundFromHeightMap({width:o,height:s,subdivisions:a,minHeight:l,maxHeight:h,colorFilter:c,buffer:m,bufferWidth:n,bufferHeight:p}).applyToMesh(d,u),d._setReady(!0),f&&f(d)};return e.Tools.LoadImage(i,p,function(){},n.database),d},t.CreatePolygon=function(i,r,n){r.sideOrientation=t.updateSideOrientation(r.sideOrientation);for(var o=r.shape,s=r.holes||[],a=r.depth||0,l=[],h=[],c=0;c<o.length;c++)l[c]=new e.Vector2(o[c].x,o[c].z);l[0].equalsWithEpsilon(l[l.length-1],1e-8)&&l.pop();for(var u=new e.PolygonMeshBuilder(i,l,n),f=0;f<s.length;f++){h=[];for(var d=0;d<s[f].length;d++)h.push(new e.Vector2(s[f][d].x,s[f][d].z));u.addHole(h)}var p=u.build(r.updatable,a);return p._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePolygon(p,r.sideOrientation,r.faceUV,r.faceColors,r.frontUVs,r.backUVs).applyToMesh(p,r.updatable),p},t.ExtrudePolygon=function(e,i,r){return t.CreatePolygon(e,i,r)},t.CreateTube=function(i,r,n){var o=r.path,s=r.instance,a=1;s&&(a=s.radius),void 0!==r.radius&&(a=r.radius);var l=r.tessellation||64,h=r.radiusFunction||null,c=r.cap||e.Mesh.NO_CAP,u=r.invertUV||!1,f=r.updatable,d=t.updateSideOrientation(r.sideOrientation);r.arc=r.arc&&(r.arc<=0||r.arc>1)?1:r.arc||1;var p,m,g=function(t,i,r,n,o,s,a,l){for(var h,c,u,f,d=i.getTangents(),p=i.getNormals(),m=i.getDistances(),g=2*Math.PI,v=g/o*l,y=function(){return n},_=s||y,b=e.Tmp.Matrix[0],x=a===e.Mesh._NO_CAP||a===e.Mesh.CAP_END?0:2,T=0;T<t.length;T++){c=_(T,m[T]),h=Array(),u=p[T];for(var E=0;E<o;E++)e.Matrix.RotationAxisToRef(d[T],v*E,b),f=h[E]?h[E]:e.Vector3.Zero(),e.Vector3.TransformCoordinatesToRef(u,b,f),f.scaleInPlace(c).addInPlace(t[T]),h[E]=f;r[x]=h,x++}var S=function(e,i){for(var r=Array(),n=0;n<e;n++)r.push(t[i]);return r};switch(a){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:r[0]=S(o,0),r[1]=r[2].slice(0);break;case e.Mesh.CAP_END:r[x]=r[x-1].slice(0),r[x+1]=S(o,t.length-1);break;case e.Mesh.CAP_ALL:r[0]=S(o,0),r[1]=r[2].slice(0),r[x]=r[x-1].slice(0),r[x+1]=S(o,t.length-1)}return r};if(s){var v=r.arc||s.arc;return p=s.path3D.update(o),m=g(o,p,s.pathArray,a,s.tessellation,h,s.cap,v),s=t.CreateRibbon("",{pathArray:m,instance:s}),s.path3D=p,s.pathArray=m,s.arc=v,s.radius=a,s}p=new e.Path3D(o);var y=new Array;c=c<0||c>3?0:c,m=g(o,p,y,a,l,h,c,r.arc);var _=t.CreateRibbon(i,{pathArray:m,closePath:!0,closeArray:!1,updatable:f,sideOrientation:d,invertUV:u,frontUVs:r.frontUVs,backUVs:r.backUVs},n);return _.pathArray=m,_.path3D=p,_.tessellation=l,_.cap=c,_.arc=r.arc,_.radius=a,_},t.CreatePolyhedron=function(i,r,n){var o=new e.Mesh(i,n);return r.sideOrientation=t.updateSideOrientation(r.sideOrientation),o._originalBuilderSideOrientation=r.sideOrientation,e.VertexData.CreatePolyhedron(r).applyToMesh(o,r.updatable),o},t.CreateDecal=function(t,i,r){var n=i.getIndices(),o=i.getVerticesData(e.VertexBuffer.PositionKind),s=i.getVerticesData(e.VertexBuffer.NormalKind),a=r.position||e.Vector3.Zero(),l=r.normal||e.Vector3.Up(),h=r.size||e.Vector3.One(),c=r.angle||0;if(!l){var u=new e.Vector3(0,0,1),f=i.getScene().activeCamera,d=e.Vector3.TransformCoordinates(u,f.getWorldMatrix());l=f.globalPosition.subtract(d)}var p=-Math.atan2(l.z,l.x)-Math.PI/2,m=Math.sqrt(l.x*l.x+l.z*l.z),g=Math.atan2(l.y,m),v=e.Matrix.RotationYawPitchRoll(p,g,c).multiply(e.Matrix.Translation(a.x,a.y,a.z)),y=e.Matrix.Invert(v),_=i.getWorldMatrix(),b=_.multiply(y),x=new e.VertexData;x.indices=[],x.positions=[],x.normals=[],x.uvs=[];for(var T=0,E=function(t){var i=new e.PositionNormalVertex;if(!n||!o||!s)return i;var r=n[t];return i.position=new e.Vector3(o[3*r],o[3*r+1],o[3*r+2]),i.position=e.Vector3.TransformCoordinates(i.position,b),i.normal=new e.Vector3(s[3*r],s[3*r+1],s[3*r+2]),i.normal=e.Vector3.TransformNormal(i.normal,b),i},S=function(t,i){if(0===t.length)return t;for(var r=.5*Math.abs(e.Vector3.Dot(h,i)),n=function(t,n){var o=e.Vector3.GetClipFactor(t.position,n.position,i,r);return new e.PositionNormalVertex(e.Vector3.Lerp(t.position,n.position,o),e.Vector3.Lerp(t.normal,n.normal,o))},o=new Array,s=0;s<t.length;s+=3){var a,l,c,u=null,f=null,d=null,p=null,m=e.Vector3.Dot(t[s].position,i)-r,g=e.Vector3.Dot(t[s+1].position,i)-r,v=e.Vector3.Dot(t[s+2].position,i)-r;switch(a=m>0,l=g>0,c=v>0,(a?1:0)+(l?1:0)+(c?1:0)){case 0:o.push(t[s]),o.push(t[s+1]),o.push(t[s+2]);break;case 1:if(a&&(u=t[s+1],f=t[s+2],d=n(t[s],u),p=n(t[s],f)),l){u=t[s],f=t[s+2],d=n(t[s+1],u),p=n(t[s+1],f),o.push(d),o.push(f.clone()),o.push(u.clone()),o.push(f.clone()),o.push(d.clone()),o.push(p);break}c&&(u=t[s],f=t[s+1],d=n(t[s+2],u),p=n(t[s+2],f)),u&&f&&d&&p&&(o.push(u.clone()),o.push(f.clone()),o.push(d),o.push(p),o.push(d.clone()),o.push(f.clone()));break;case 2:a||(u=t[s].clone(),f=n(u,t[s+1]),d=n(u,t[s+2]),o.push(u),o.push(f),o.push(d)),l||(u=t[s+1].clone(),f=n(u,t[s+2]),d=n(u,t[s]),o.push(u),o.push(f),o.push(d)),c||(u=t[s+2].clone(),f=n(u,t[s]),d=n(u,t[s+1]),o.push(u),o.push(f),o.push(d))}}return o},w=0;w<n.length;w+=3){var M=new Array;if(M.push(E(w)),M.push(E(w+1)),M.push(E(w+2)),M=S(M,new e.Vector3(1,0,0)),M=S(M,new e.Vector3(-1,0,0)),M=S(M,new e.Vector3(0,1,0)),M=S(M,new e.Vector3(0,-1,0)),M=S(M,new e.Vector3(0,0,1)),M=S(M,new e.Vector3(0,0,-1)),0!==M.length)for(var A=0;A<M.length;A++){var P=M[A];x.indices.push(T),P.position.toArray(x.positions,3*T),P.normal.toArray(x.normals,3*T),x.uvs.push(.5+P.position.x/h.x),x.uvs.push(.5+P.position.y/h.y),T++}}var C=new e.Mesh(t,i.getScene());return x.applyToMesh(C),C.position=a.clone(),C.rotation=new e.Vector3(g,p,c),C},t._ExtrudeShapeGeneric=function(i,r,n,o,s,a,l,h,c,u,f,d,p,m,g,v,y,_){var b,x,T=function(t,i,r,n,o,s,a,l,h,c){for(var u=r.getTangents(),f=r.getNormals(),d=r.getBinormals(),p=r.getDistances(),m=0,g=function(){return null!==o?o:1},v=function(){return null!==s?s:0},y=c&&l?l:v,_=c&&a?a:g,b=h===e.Mesh.NO_CAP||h===e.Mesh.CAP_END?0:2,x=e.Tmp.Matrix[0],T=0;T<i.length;T++){for(var E=new Array,S=y(T,p[T]),w=_(T,p[T]),M=0;M<t.length;M++){e.Matrix.RotationAxisToRef(u[T],m,x);var A=u[T].scale(t[M].z).add(f[T].scale(t[M].x)).add(d[T].scale(t[M].y)),P=E[M]?E[M]:e.Vector3.Zero();e.Vector3.TransformCoordinatesToRef(A,x,P),P.scaleInPlace(w).addInPlace(i[T]),E[M]=P}n[b]=E,m+=S,b++}var C=function(t){var i,r=Array(),n=e.Vector3.Zero();for(i=0;i<t.length;i++)n.addInPlace(t[i]);for(n.scaleInPlace(1/t.length),i=0;i<t.length;i++)r.push(n);return r};switch(h){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:n[0]=C(n[2]),n[1]=n[2];break;case e.Mesh.CAP_END:n[b]=n[b-1],n[b+1]=C(n[b-1]);break;case e.Mesh.CAP_ALL:n[0]=C(n[2]),n[1]=n[2],n[b]=n[b-1],n[b+1]=C(n[b-1])}return n};if(g)return b=g.path3D.update(n),x=T(r,n,g.path3D,g.pathArray,o,s,a,l,g.cap,f),g=e.Mesh.CreateRibbon("",x,!1,!1,0,d||void 0,!1,0,g);b=new e.Path3D(n);var E=new Array;u=u<0||u>3?0:u,x=T(r,n,b,E,o,s,a,l,u,f);var S=t.CreateRibbon(i,{pathArray:x,closeArray:h,closePath:c,updatable:p,sideOrientation:m,invertUV:v,frontUVs:y||void 0,backUVs:_||void 0},d);return S.pathArray=x,S.path3D=b,S.cap=u,S},t}();e.MeshBuilder=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.unlocked=!1,this.isMP3supported=!1,this.isOGGsupported=!1,void 0===window.AudioContext&&void 0===window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0);var e=document.createElement("audio");try{e&&e.canPlayType&&e.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")&&(this.isMP3supported=!0)}catch(e){}try{e&&e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(e){}/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0}return Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._unlockiOSaudio=function(){var e=this,t=function(){if(e.audioContext){var i=e.audioContext.createBuffer(1,1,22050),r=e.audioContext.createBufferSource();r.buffer=i,r.connect(e.audioContext.destination),r.start(0),setTimeout(function(){r.playbackState!==r.PLAYING_STATE&&r.playbackState!==r.FINISHED_STATE||(e.unlocked=!0,window.removeEventListener("touchend",t,!1),e.onAudioUnlocked&&e.onAudioUnlocked())},0)}};window.addEventListener("touchend",t,!1)},t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error("Web Audio: "+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o){void 0===n&&(n=null);var s=this;if(this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=t,this._scene=r,this._readyToPlayCallback=n,this._customAttenuationFunction=function(e,t,i,r,n){return t<i?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=o.streaming||!1),e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext){this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this);var a=!0;if(i){"string"==typeof i&&(this._urlType="String"),Array.isArray(i)&&(this._urlType="Array"),i instanceof ArrayBuffer&&(this._urlType="ArrayBuffer");var l=[],h=!1;switch(this._urlType){case"ArrayBuffer":i.byteLength>0&&(h=!0,this._soundLoaded(i));break;case"String":l.push(i);case"Array":0===l.length&&(l=i);for(var c=0;c<l.length;c++){var u=l[c];if(-1!==u.indexOf(".mp3",u.length-4)&&e.Engine.audioEngine.isMP3supported&&(h=!0),-1!==u.indexOf(".ogg",u.length-4)&&e.Engine.audioEngine.isOGGsupported&&(h=!0),-1!==u.indexOf(".wav",u.length-4)&&(h=!0),-1!==u.indexOf("blob:")&&(h=!0),h){this._streaming?(this._htmlAudioElement=new Audio(u),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,e.Tools.SetCorsBehavior(u,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){s._isReadyToPlay=!0,s.autoplay&&s.play(),s._readyToPlayCallback&&s._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):e.Tools.LoadFile(u,function(e){s._soundLoaded(e)},void 0,this._scene.database,!0);break}}break;default:a=!1}a?h||(this._isReadyToPlay=!0,this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback&&s._readyToPlayCallback()},1e3)):e.Tools.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}}else this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error("Web Audio is not supported by your browser."),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback&&s._readyToPlayCallback()},1e3)}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype.isReady=function(){return this._isReadyToPlay},t.prototype._soundLoaded=function(t){var i=this;e.Engine.audioEngine.audioContext&&e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(t){e.Tools.Error("Error while decoding audio data for: "+i.name+" / Error: "+t)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate)))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&this._soundPanner&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t),this._isOutputConnected=!0)},t.prototype.setDirectionalCone=function(t,i,r){if(i<t)return void e.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=r,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play())},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){if(this._connectedMesh&&this._soundPanner){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)}},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t,i){var r=this;if(this._isReadyToPlay&&this._scene.audioEnabled&&e.Engine.audioEngine.audioContext)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var n=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&this._soundPanner&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming?(this._streamingSource||(this._streamingSource=e.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){r._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){r._onended()},this._soundSource.buffer&&this._soundSource.start(n,this.isPaused?this._startOffset%this._soundSource.buffer.duration:i||0)),this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(t){e.Tools.Error("Error while trying to play audio: "+this.name+", "+t.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){if(this._streaming)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else if(e.Engine.audioEngine.audioContext&&this._soundSource){var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this._soundSource.onended=function(){},this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():e.Engine.audioEngine.audioContext&&(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime))},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&this._soundGain&&(i&&e.Engine.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,e.Engine.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype.detachFromMesh=function(){this._connectedMesh&&this._registerFunc&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){if(t.getBoundingInfo){var i=t,r=i.getBoundingInfo();this.setPosition(r.boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}},t.prototype.clone=function(){var e=this;if(this._streaming)return null;var i=function(){e._isReadyToPlay?(n._audioBuffer=e.getAudioBuffer(),n._isReadyToPlay=!0,n.autoplay&&n.play()):window.setTimeout(i,300)},r={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},n=new t(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,r);return this.useCustomAttenuation&&n.setAttenuationFunction(this._customAttenuationFunction),n.setPosition(this._position),n.setPlaybackRate(this._playbackRate),i(),n},t.prototype.getAudioBuffer=function(){return this._audioBuffer},t.prototype.serialize=function(){var e={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId};return this.spatialSound&&(this._connectedMesh&&(e.connectedMeshId=this._connectedMesh.id),e.position=this._position.asArray(),e.refDistance=this.refDistance,e.distanceModel=this.distanceModel,e.isDirectional=this._isDirectional,e.localDirectionToMesh=this._localDirection.asArray(),e.coneInnerAngle=this._coneInnerAngle,e.coneOuterAngle=this._coneOuterAngle,e.coneOuterGain=this._coneOuterGain),e},t.Parse=function(i,r,n,o){var s,a=i.name;s=i.url?n+i.url:n+a;var l,h={autoplay:i.autoplay,loop:i.loop,volume:i.volume,spatialSound:i.spatialSound,maxDistance:i.maxDistance,rolloffFactor:i.rolloffFactor,refDistance:i.refDistance,distanceModel:i.distanceModel,playbackRate:i.playbackRate};if(o){var c=function(){o._isReadyToPlay?(l._audioBuffer=o.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play()):window.setTimeout(c,300)};l=new t(a,new ArrayBuffer(0),r,null,h),c()}else l=new t(a,s,r,function(){r._removePendingData(l)},h),r._addPendingData(l);if(i.position){var u=e.Vector3.FromArray(i.position);l.setPosition(u)}if(i.isDirectional&&(l.setDirectionalCone(i.coneInnerAngle||360,i.coneOuterAngle||360,i.coneOuterGain||0),i.localDirectionToMesh)){var f=e.Vector3.FromArray(i.localDirectionToMesh);l.setLocalDirectionToMesh(f)}if(i.connectedMeshId){var d=r.getMeshByID(i.connectedMeshId);d&&l.attachToMesh(d)}return l},t}();e.Sound=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=e,this.soundCollection=new Array,this._options=t,this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype._initializeSoundTrackAudioGraph=function(){e.Engine.audioEngine.canUseWebAudio&&e.Engine.audioEngine.audioContext&&(this._outputAudioNode=e.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(e.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},t.prototype.dispose=function(){if(e.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(t){e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=t)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,e.Engine.audioEngine.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,e.Engine.audioEngine.masterGain))},t}();e.SoundTrack=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&this._audioEngine.audioContext&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc&&this._debugCanvasContext)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var r=t[i],n=r/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*n,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),l=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+l+", 100%, 50%)",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._registerFunc&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null),document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c,u){void 0===n&&(n=null),void 0===o&&(o=!1),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),void 0===h&&(h=e.Engine.TEXTUREFORMAT_RGBA),void 0===c&&(c=!1),void 0===u&&(u=null);var f=t.call(this,r)||this;if(f.coordinatesMode=e.Texture.CUBIC_MODE,f.name=i,f.url=i,f._noMipmap=o,f.hasAlpha=!1,f._format=h,f._prefiltered=c,f.isCube=!0,f._textureMatrix=e.Matrix.Identity(),c&&(f.gammaSpace=!1),!i&&!s)return f;f._texture=f._getFromCache(i,o);var d=i.lastIndexOf("."),p=u||(d>-1?i.substring(d).toLowerCase():""),m=".dds"===p;if(!s&&(m||n||(n=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),s=[],n))for(var g=0;g<n.length;g++)s.push(i+n[g]);return f._files=s,f._texture?a&&(f._texture.isReady?e.Tools.SetImmediate(function(){return a()}):f._texture.onLoadedObservable.add(a)):r.useDelayedTextureLoading?f.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:f._texture=c?r.getEngine().createPrefilteredCubeTexture(i,r,f.lodGenerationScale,f.lodGenerationOffset,a,l,h,u):r.getEngine().createCubeTexture(i,r,s,o,a,l,f._format,u),f}return o(i,t),i.CreateFromImages=function(e,t,r){return new i("",t,null,r,e)},i.CreateFromPrefilteredData=function(e,t,r){return void 0===r&&(r=null),new i(e,t,null,!1,null,null,null,void 0,!0,r)},i.prototype.delayLoad=function(){if(this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){var t=this.getScene();t&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._prefiltered?this._texture=t.getEngine().createPrefilteredCubeTexture(this.url,t,this.lodGenerationScale,this.lodGenerationOffset,void 0,void 0,this._format):this._texture=t.getEngine().createCubeTexture(this.url,t,this._files,this._noMipmap,void 0,void 0,this._format)))}},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.prototype.setReflectionTextureMatrix=function(e){this._textureMatrix=e},i.Parse=function(t,i,r){var n=e.SerializationHelper.Parse(function(){return new e.CubeTexture(r+t.name,i,t.extensions)},t,i);if(t.animations)for(var o=0;o<t.animations.length;o++){var s=t.animations[o];n.animations.push(e.Animation.Parse(s))}return n},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone(function(){var e=t.getScene();return e?new i(t.url,e,t._extensions,t._noMipmap,t._files):t},this)},i}(e.BaseTexture);e.CubeTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c,u,f){void 0===s&&(s=!0),void 0===a&&(a=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===l&&(l=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=!0),void 0===u&&(u=!1),void 0===f&&(f=!1);var d=t.call(this,null,n,!o)||this;return d.isCube=l,d.renderList=new Array,d.renderParticles=!0,d.renderSprites=!1,d.coordinatesMode=e.Texture.PROJECTION_MODE,d.ignoreCameraViewport=!1,d.onBeforeBindObservable=new e.Observable,d.onAfterUnbindObservable=new e.Observable,d.onBeforeRenderObservable=new e.Observable,d.onAfterRenderObservable=new e.Observable,d.onClearObservable=new e.Observable,d._currentRefreshId=-1,d._refreshRate=1,d._samples=1,(n=d.getScene())?(d._engine=n.getEngine(),d.name=i,d.isRenderTarget=!0,d._initialSizeParameter=r,d._processSizeParameter(r),d._resizeObserver=d.getScene().getEngine().onResizeObservable.add(function(){}),d._generateMipMaps=!!o,d._doNotChangeAspectRatio=s,d._renderingManager=new e.RenderingManager(n),f?d:(d._renderTargetOptions={generateMipMaps:o,type:a,samplingMode:h,generateDepthBuffer:c,generateStencilBuffer:u},h===e.Texture.NEAREST_SAMPLINGMODE&&(d.wrapU=e.Texture.CLAMP_ADDRESSMODE,d.wrapV=e.Texture.CLAMP_ADDRESSMODE),l?(d._texture=n.getEngine().createRenderTargetCubeTexture(d.getRenderSize(),d._renderTargetOptions),d.coordinatesMode=e.Texture.INVCUBIC_MODE,d._textureMatrix=e.Matrix.Identity()):d._texture=n.getEngine().createRenderTargetTexture(d._size,d._renderTargetOptions),d)):d}return o(i,t),Object.defineProperty(i,"REFRESHRATE_RENDER_ONCE",{get:function(){return i._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return i._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(i,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return i._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!0,configurable:!0}),i.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},i.prototype._processSizeParameter=function(e){e.ratio?(this._sizeRatio=e.ratio,this._size={width:this._bestReflectionRenderTargetDimension(this._engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(this._engine.getRenderHeight(),this._sizeRatio)}):this._size=e},Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!0,configurable:!0}),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype.addPostProcess=function(t){if(!this._postProcessManager){var i=this.getScene();if(!i)return;this._postProcessManager=new e.PostProcessManager(i),this._postProcesses=new Array}this._postProcesses.push(t),this._postProcesses[0].autoClear=!1},i.prototype.clearPostProcesses=function(e){if(this._postProcesses){if(e)for(var t=0,i=this._postProcesses;t<i.length;t++){var r=i[t];r.dispose()}this._postProcesses=[]}},i.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},i.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.getRenderSize=function(){return this._size.width?this._size.width:this._size},i.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},i.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.scale=function(e){var t=this.getRenderSize()*e;this.resize(t)},i.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:t.prototype.getReflectionTextureMatrix.call(this)},i.prototype.resize=function(e){this.releaseInternalTexture();var t=this.getScene();t&&(this._processSizeParameter(e),this.isCube?this._texture=t.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=t.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions))},i.prototype.render=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var i=this.getScene();if(i){var r=i.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var o=this._waitingRenderList[n],s=i.getMeshByID(o);s&&this.renderList.push(s)}delete this._waitingRenderList}if(this.renderListPredicate){this.renderList?this.renderList.splice(0):this.renderList=[];var i=this.getScene();if(!i)return;for(var a=i.meshes,n=0;n<a.length;n++){var l=a[n];this.renderListPredicate(l)&&this.renderList.push(l)}}this.onBeforeBindObservable.notifyObservers(this);var h;this.activeCamera?(h=this.activeCamera,r.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==i.activeCamera&&i.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(h=i.activeCamera)&&r.setViewport(h.viewport,this.getRenderWidth(),this.getRenderHeight()),this._renderingManager.reset();for(var c=this.renderList?this.renderList:i.getActiveMeshes().data,u=this.renderList?this.renderList.length:i.getActiveMeshes().length,f=i.getRenderId(),d=0;d<u;d++){var l=c[d];if(l){if(!l.isReady()){this.resetRefreshCounter();continue}l._preActivateForIntermediateRendering(f);var p=void 0;if(p=!(this.renderList||!h)&&0==(l.layerMask&h.layerMask),l.isEnabled()&&l.isVisible&&l.subMeshes&&!p){l._activate(f);for(var m=0;m<l.subMeshes.length;m++){var g=l.subMeshes[m];i._activeIndices.addCount(g.indexCount,!1),this._renderingManager.dispatch(g)}}}}for(var v=0;v<i.particleSystems.length;v++){var y=i.particleSystems[v],_=y.emitter;y.isStarted()&&_&&_.position&&_.isEnabled()&&(c.indexOf(_)>=0&&this._renderingManager.dispatchParticles(y))}if(this.isCube)for(var b=0;b<6;b++)this.renderToTarget(b,c,u,e,t),i.incrementRenderId(),i.resetCachedMaterial();else this.renderToTarget(0,c,u,e,t);this.onAfterUnbindObservable.notifyObservers(this),i.activeCamera&&(this.activeCamera&&this.activeCamera!==i.activeCamera&&i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix(!0)),r.setViewport(i.activeCamera.viewport)),i.resetCachedMaterial()}},i.prototype._bestReflectionRenderTargetDimension=function(t,i){var r=t*i,n=e.Tools.NearestPOT(r+16384/(128+r));return Math.min(e.Tools.FloorPOT(t),n)},i.prototype.renderToTarget=function(t,i,r,n,o){var s=this,a=this.getScene();if(a){var l=a.getEngine();this._texture&&(this._postProcessManager?this._postProcessManager._prepareFrame(this._texture,this._postProcesses):n&&a.postProcessManager._prepareFrame(this._texture)||this._texture&&l.bindFramebuffer(this._texture,this.isCube?t:void 0,void 0,void 0,this.ignoreCameraViewport),this.onBeforeRenderObservable.notifyObservers(t),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(l):l.clear(this.clearColor||a.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,i,this.renderParticles,this.renderSprites),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,t,this._postProcesses,this.ignoreCameraViewport):n&&a.postProcessManager._finalizeFrame(!1,this._texture,t),this._doNotChangeAspectRatio||a.updateTransformMatrix(!0),o&&e.Tools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),l),this.isCube&&5!==t?this.onAfterRenderObservable.notifyObservers(t):(this.isCube&&5===t&&l.generateMipMapsForCubemap(this._texture),l.unBindFramebuffer(this._texture,this.isCube,function(){s.onAfterRenderObservable.notifyObservers(t)})))}},i.prototype.setRenderingOrder=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this._renderingManager.setRenderingOrder(e,t,i,r)},i.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t)},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(var i=0;i<this.renderList.length;i++)e.renderList.push(this.renderList[i].id);return e},i.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},i.prototype.dispose=function(){this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var e=this.getScene();if(e){var i=e.customRenderTargets.indexOf(this);i>=0&&e.customRenderTargets.splice(i,1);for(var r=0,n=e.cameras;r<n.length;r++){var o=n[r];i=o.customRenderTargets.indexOf(this),i>=0&&o.customRenderTargets.splice(i,1)}t.prototype.dispose.call(this)}},i.prototype._rebuild=function(){this.refreshRate===i.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=i.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},i}(e.Texture);t._REFRESHRATE_RENDER_ONCE=0,t._REFRESHRATE_RENDER_ONEVERYFRAME=1,t._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,e.RenderTargetTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s){var a=this;s=s||{};var l=!!s.generateMipMaps&&s.generateMipMaps,h=!!s.generateDepthTexture&&s.generateDepthTexture,c=void 0===s.doNotChangeAspectRatio||s.doNotChangeAspectRatio;if(a=t.call(this,i,r,o,l,c)||this,a._engine=o.getEngine(),!a.isSupported)return void a.dispose();for(var u=[],f=[],d=0;d<n;d++)s.types&&s.types[d]?u.push(s.types[d]):u.push(e.Engine.TEXTURETYPE_FLOAT),s.samplingModes&&s.samplingModes[d]?f.push(s.samplingModes[d]):f.push(e.Texture.BILINEAR_SAMPLINGMODE);var p=void 0===s.generateDepthBuffer||s.generateDepthBuffer,m=void 0!==s.generateStencilBuffer&&s.generateStencilBuffer;return a._size=r,a._multiRenderTargetOptions={samplingModes:f,generateMipMaps:l,generateDepthBuffer:p,generateStencilBuffer:m,generateDepthTexture:h,types:u,textureCount:n},a._createInternalTextures(),a._createTextures(),a}return o(i,t),Object.defineProperty(i.prototype,"isSupported",{get:function(){return this._engine.webGLVersion>1||this._engine.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textures",{get:function(){return this._textures},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"depthTexture",{get:function(){return this._textures[this._textures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapU",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapU=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wrapV",{set:function(e){if(this._textures)for(var t=0;t<this._textures.length;t++)this._textures[t].wrapV=e},enumerable:!0,configurable:!0}),i.prototype._rebuild=function(){this.releaseInternalTextures(),this._createInternalTextures();for(var e=0;e<this._internalTextures.length;e++){this._textures[e]._texture=this._internalTextures[e]}this._texture=this._internalTextures[0]},i.prototype._createInternalTextures=function(){this._internalTextures=this._engine.createMultipleRenderTarget(this._size,this._multiRenderTargetOptions)},i.prototype._createTextures=function(){this._textures=[];for(var t=0;t<this._internalTextures.length;t++){var i=new e.Texture(null,this.getScene());i._texture=this._internalTextures[t],this._textures.push(i)}this._texture=this._internalTextures[0]},Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e)for(var t=0;t<this._internalTextures.length;t++)this._samples=this._engine.updateRenderTargetTextureSampleCount(this._internalTextures[t],e)},enumerable:!0,configurable:!0}),i.prototype.resize=function(e){this.releaseInternalTextures(),this._internalTextures=this._engine.createMultipleRenderTarget(e,this._multiRenderTargetOptions),this._createInternalTextures()},i.prototype.dispose=function(){this.releaseInternalTextures(),t.prototype.dispose.call(this)},i.prototype.releaseInternalTextures=function(){if(this._internalTextures)for(var e=this._internalTextures.length-1;e>=0;e--)void 0!==this._internalTextures[e]&&(this._internalTextures[e].dispose(),this._internalTextures.splice(e,1))},i}(e.RenderTargetTexture);e.MultiRenderTarget=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){void 0===s&&(s=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),void 0===l&&(l=!0);var h=t.call(this,i,r,n,o,!0,s,!1,a,l)||this;return h.mirrorPlane=new e.Plane(0,1,0,1),h._transformMatrix=e.Matrix.Zero(),h._mirrorMatrix=e.Matrix.Zero(),h._adaptiveBlurKernel=0,h._blurKernelX=0,h._blurKernelY=0,h._blurRatio=1,h.ignoreCameraViewport=!0,h.onBeforeRenderObservable.add(function(){e.Matrix.ReflectionToRef(h.mirrorPlane,h._mirrorMatrix),h._savedViewMatrix=n.getViewMatrix(),h._mirrorMatrix.multiplyToRef(h._savedViewMatrix,h._transformMatrix),n.setTransformMatrix(h._transformMatrix,n.getProjectionMatrix()),n.clipPlane=h.mirrorPlane,n.getEngine().cullBackFaces=!1,n._mirroredCameraPosition=e.Vector3.TransformCoordinates(n.activeCamera.globalPosition,h._mirrorMatrix)}),h.onAfterRenderObservable.add(function(){n.setTransformMatrix(h._savedViewMatrix,n.getProjectionMatrix()),n.getEngine().cullBackFaces=!0,n._mirroredCameraPosition=null,delete n.clipPlane}),h}return o(i,t),Object.defineProperty(i.prototype,"blurRatio",{get:function(){return this._blurRatio},set:function(e){this._blurRatio!==e&&(this._blurRatio=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"adaptiveBlurKernel",{set:function(e){this._adaptiveBlurKernel=e,this._autoComputeBlurKernel()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernel",{set:function(e){this.blurKernelX=e,this.blurKernelY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernelX",{get:function(){return this._blurKernelX},set:function(e){this._blurKernelX!==e&&(this._blurKernelX=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurKernelY",{get:function(){return this._blurKernelY},set:function(e){this._blurKernelY!==e&&(this._blurKernelY=e,this._preparePostProcesses())},enumerable:!0,configurable:!0}),i.prototype._autoComputeBlurKernel=function(){var e=this.getScene().getEngine(),t=this.getRenderWidth()/e.getRenderWidth(),i=this.getRenderHeight()/e.getRenderHeight();this.blurKernelX=this._adaptiveBlurKernel*t,this.blurKernelY=this._adaptiveBlurKernel*i},i.prototype._onRatioRescale=function(){this._sizeRatio&&(this.resize(this._initialSizeParameter),this._adaptiveBlurKernel||this._preparePostProcesses()),this._adaptiveBlurKernel&&this._autoComputeBlurKernel()},i.prototype._preparePostProcesses=function(){if(this.clearPostProcesses(!0),this._blurKernelX&&this._blurKernelY){var t=this.getScene().getEngine(),i=t.getCaps().textureFloatRender?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_HALF_FLOAT;this._blurX=new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),this._blurKernelX,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,i),this._blurX.autoClear=!1,1===this._blurRatio&&this.samples<2&&this._texture?this._blurX.outputTexture=this._texture:this._blurX.alwaysForcePOT=!0,this._blurY=new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),this._blurKernelY,this._blurRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,t,!1,i),this._blurY.autoClear=!1,this._blurY.alwaysForcePOT=1!==this._blurRatio,this.addPostProcess(this._blurX),this.addPostProcess(this._blurY)}else this._blurY&&(this.removePostProcess(this._blurY),this._blurY.dispose(),this._blurY=null),this._blurX&&(this.removePostProcess(this._blurX),this._blurX.dispose(),this._blurX=null)},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t.width,e,this._renderTargetOptions.generateMipMaps,this._renderTargetOptions.type,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.mirrorPlane=this.mirrorPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},i}(e.RenderTargetTexture);e.MirrorTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,i,r,n,o,!0)||this;return s.refractionPlane=new e.Plane(0,1,0,1),s.depth=2,s.onBeforeRenderObservable.add(function(){n.clipPlane=s.refractionPlane}),s.onAfterRenderObservable.add(function(){delete n.clipPlane}),s}return o(i,t),i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t.width,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.refractionPlane=this.refractionPlane.clone(),this.renderList&&(r.renderList=this.renderList.slice(0)),r.depth=this.depth,r},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},i}(e.RenderTargetTexture);e.RefractionTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a){void 0===n&&(n=null),void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=e.Engine.TEXTUREFORMAT_RGBA);var l=t.call(this,null,n,!o,void 0,s,void 0,void 0,void 0,void 0,a)||this;l.name=i,l._engine=l.getScene().getEngine(),l.wrapU=e.Texture.CLAMP_ADDRESSMODE,l.wrapV=e.Texture.CLAMP_ADDRESSMODE,l._generateMipMaps=o,r.getContext?(l._canvas=r,l._texture=l._engine.createDynamicTexture(r.width,r.height,o,s)):(l._canvas=document.createElement("canvas"),r.width?l._texture=l._engine.createDynamicTexture(r.width,r.height,o,s):l._texture=l._engine.createDynamicTexture(r,r,o,s));var h=l.getSize();return l._canvas.width=h.width,l._canvas.height=h.height,l._context=l._canvas.getContext("2d"),l}return o(i,t),Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype._recreate=function(e){this._canvas.width=e.width,this._canvas.height=e.height,this.releaseInternalTexture(),this._texture=this._engine.createDynamicTexture(e.width,e.height,this._generateMipMaps,this._samplingMode)},i.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._recreate(t)},i.prototype.scaleTo=function(e,t){var i=this.getSize();i.width=e,i.height=t,this._recreate(i)},i.prototype.getContext=function(){return this._context},i.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},i.prototype.update=function(e){this._engine.updateDynamicTexture(this._texture,this._canvas,void 0===e||e,void 0,this._format||void 0)},i.prototype.drawText=function(e,t,i,r,n,o,s,a){void 0===a&&(a=!0);var l=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,l.width,l.height)),this._context.font=r,null===t||void 0===t){var h=this._context.measureText(e);t=(l.width-h.width)/2}if(null===i||void 0===i){var c=parseInt(r.replace(/\D/g,""));i=l.height/2+c/3.65}this._context.fillStyle=n,this._context.fillText(e,t,i),a&&this.update(s)},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this.getSize(),r=new i(this.name,t,e,this._generateMipMaps);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r},i.prototype._rebuild=function(){this.update()},i}(e.Texture);e.DynamicTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE);var l=t.call(this,null,n,!o,s)||this;l._autoLaunch=!0;var h=null;return l.name=i,r instanceof HTMLVideoElement?l.video=r:(h=r,l.video=document.createElement("video"),l.video.autoplay=!1,l.video.loop=!0,e.Tools.SetCorsBehavior(h,l.video)),l._engine=l.getScene().getEngine(),l._generateMipMaps=o,l._samplingMode=a,!l._engine.needPOTTextures||e.Tools.IsExponentOfTwo(l.video.videoWidth)&&e.Tools.IsExponentOfTwo(l.video.videoHeight)?(l.wrapU=e.Texture.WRAP_ADDRESSMODE,l.wrapV=e.Texture.WRAP_ADDRESSMODE):(l.wrapU=e.Texture.CLAMP_ADDRESSMODE,l.wrapV=e.Texture.CLAMP_ADDRESSMODE,l._generateMipMaps=!1),h?(l.video.addEventListener("canplay",function(){l._createTexture()}),h.forEach(function(e){var t=document.createElement("source");t.src=e,l.video.appendChild(t)})):l._createTexture(),l._lastUpdate=e.Tools.Now,l}return o(i,t),i.prototype.__setTextureReady=function(){this._texture&&(this._texture.isReady=!0)},i.prototype._createTexture=function(){this._texture=this._engine.createDynamicTexture(this.video.videoWidth,this.video.videoHeight,this._generateMipMaps,this._samplingMode),this._autoLaunch&&(this._autoLaunch=!1,this.video.play()),this._setTextureReady=this.__setTextureReady.bind(this),this.video.addEventListener("playing",this._setTextureReady)},i.prototype._rebuild=function(){this.update()},i.prototype.update=function(){var t=e.Tools.Now;return!(t-this._lastUpdate<15||this.video.readyState!==this.video.HAVE_ENOUGH_DATA)&&(this._lastUpdate=t,this._engine.updateVideoTexture(this._texture,this.video,this._invertY),!0)},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.video.removeEventListener("playing",this._setTextureReady)},i.CreateFromWebCam=function(t,i,r){var n,o=document.createElement("video");r&&r.deviceId&&(n={exact:r.deviceId}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.getUserMedia&&navigator.getUserMedia({video:{deviceId:n,width:{min:r&&r.minWidth||256,max:r&&r.maxWidth||640},height:{min:r&&r.minHeight||256,max:r&&r.maxHeight||480}}},function(r){void 0!==o.mozSrcObject?o.mozSrcObject=r:o.src=window.URL&&window.URL.createObjectURL(r)||r,o.play(),i&&i(new e.VideoTexture("video",o,t,!0,!0))},function(t){e.Tools.Error(t.name)})},i}(e.Texture);e.VideoTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c){void 0===a&&(a=!0),void 0===l&&(l=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=t.call(this,null,s,!a,l)||this;return u.format=o,u._engine=s.getEngine(),u._texture=s.getEngine().createRawTexture(i,r,n,o,a,l,h,null,c),u.wrapU=e.Texture.CLAMP_ADDRESSMODE,u.wrapV=e.Texture.CLAMP_ADDRESSMODE,u}return o(i,t),i.prototype.update=function(e){this._engine.updateRawTexture(this._texture,e,this._texture.format,this._texture.invertY,void 0,this._texture.type)},i.CreateLuminanceTexture=function(t,r,n,o,s,a,l){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,l)},i.CreateLuminanceAlphaTexture=function(t,r,n,o,s,a,l){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,l)},i.CreateAlphaTexture=function(t,r,n,o,s,a,l){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,r,n,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,l)},i.CreateRGBTexture=function(t,r,n,o,s,a,l,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGB,o,s,a,l,h)},i.CreateRGBATexture=function(t,r,n,o,s,a,l,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT),new i(t,r,n,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,l,h)},i}(e.Texture);e.RawTexture=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o,s,a,l,h,c,u,f,d,p){void 0===a&&(a=e.Texture.NEAREST_SAMPLINGMODE),void 0===c&&(c=null),void 0===u&&(u=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===f&&(f="postprocess"),void 0===p&&(p=!1),this.name=t,this.width=-1,this.height=-1,this.autoClear=!0,this.alphaMode=e.Engine.ALPHA_DISABLE,this.animations=new Array,this.enablePixelPerfectMode=!1,this.scaleMode=e.Engine.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this.samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._textures=new e.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new e.Vector2(1,1),this._texelSize=e.Vector2.Zero(),this.onActivateObservable=new e.Observable,this.onSizeChangedObservable=new e.Observable,this.onApplyObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this)):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=o,this.renderTargetSamplingMode=a||e.Texture.NEAREST_SAMPLINGMODE,this._reusable=h||!1,this._textureType=u,this._samplers=n||[],this._samplers.push("textureSampler"),this._fragmentUrl=i,this._vertexUrl=f,this._parameters=r||[],this._parameters.push("scale"),this._indexParameters=d,p||this.updateEffect(c)}return Object.defineProperty(t.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!0,configurable:!0}),t.prototype.getCamera=function(){return this._camera},Object.defineProperty(t.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!0,configurable:!0}),t.prototype.getEngine=function(){return this._engine},t.prototype.getEffect=function(){return this._effect},t.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},t.prototype.updateEffect=function(e,t,i,r,n,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),this._effect=this._engine.createEffect({vertex:this._vertexUrl,fragment:this._fragmentUrl},["position"],t||this._parameters,i||this._samplers,null!==e?e:"",void 0,n,o,r||this._indexParameters)},t.prototype.isReusable=function(){return this._reusable},t.prototype.markTextureDirty=function(){this.width=-1},t.prototype.activate=function(t,i,r){var n=this;void 0===i&&(i=null),t=t||this._camera;var o=t.getScene(),s=o.getEngine(),a=s.getCaps().maxTextureSize,l=(i?i.width:this._engine.getRenderWidth(!0))*this._options|0,h=(i?i.height:this._engine.getRenderHeight(!0))*this._options|0,c=this._options.width||l,u=this._options.height||h;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var f=s.currentViewport;f&&(c*=f.width,u*=f.height)}if((this.renderTargetSamplingMode===e.Texture.TRILINEAR_SAMPLINGMODE||this.alwaysForcePOT)&&(this._options.width||(c=s.needPOTTextures?e.Tools.GetExponentOfTwo(c,a,this.scaleMode):c),this._options.height||(u=s.needPOTTextures?e.Tools.GetExponentOfTwo(u,a,this.scaleMode):u)),this.width!==c||this.height!==u){if(this._textures.length>0){for(var d=0;d<this._textures.length;d++)this._engine._releaseTexture(this._textures.data[d]);this._textures.reset()}this.width=c,this.height=u;var p={width:this.width,height:this.height},m={generateMipMaps:!1,generateDepthBuffer:r||0===t._postProcesses.indexOf(this),generateStencilBuffer:(r||0===t._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType};this._textures.push(this._engine.createRenderTargetTexture(p,m)),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture(p,m)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}this._textures.forEach(function(e){e.samples!==n.samples&&n._engine.updateRenderTargetTextureSampleCount(e,n.samples)})}var g;this._shareOutputWithPostProcess?g=this._shareOutputWithPostProcess.outputTexture:this._forcedOutputTexture?(g=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height):g=this.outputTexture,this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(l/c,h/u),this._engine.bindFramebuffer(g,0,l,h,!0)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(g,0,void 0,void 0,!0)),this.onActivateObservable.notifyObservers(t),this.autoClear&&this.alphaMode===e.Engine.ALPHA_DISABLE&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,!0,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!0,configurable:!0}),t.prototype.apply=function(){if(!this._effect||!this._effect.isReady())return null;this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);var e;return e=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.outputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.outputTexture,this._effect._bindTexture("textureSampler",e),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect},t.prototype._disposeTextures=function(){if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this._textures.length>0)for(var e=0;e<this._textures.length;e++)this._engine._releaseTexture(this._textures.data[e]);this._textures.dispose()}},t.prototype.dispose=function(e){if(e=e||this._camera,this._disposeTextures(),this._scene){var t=this._scene.postProcesses.indexOf(this);-1!==t&&this._scene.postProcesses.splice(t,1)}else{var i=this._engine.postProcesses.indexOf(this);-1!==i&&this._engine.postProcesses.splice(i,1)}if(e){e.detachPostProcess(this);0===e._postProcesses.indexOf(this)&&e._postProcesses.length>0&&this._camera._postProcesses[0].markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},t}();e.PostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){return void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),t.call(this,i,"pass",null,null,r,n,o,s,a,void 0,l)||this}return o(i,t),i}(e.PostProcess);e.PassPostProcess=t}(r||(r={}));var r,s=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};!function(e){var t=function(){function t(i,r,n){this._bias=5e-5,this._blurBoxOffset=1,this._blurScale=2,this._blurKernel=1,this._useKernelBlur=!1,this._filter=t.FILTER_NONE,this._darkness=0,this._transparencyShadow=!1,this.frustumEdgeFalloff=0,this.forceBackFacesOnly=!1,this._lightDirection=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._defaultTextureMatrix=e.Matrix.Identity(),this._mapSize=i,this._light=r,this._scene=r.getScene(),r._shadowGenerator=this;var o=this._scene.getEngine().getCaps();n?o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_FLOAT:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_HALF_FLOAT:this._textureType=e.Engine.TEXTURETYPE_UNSIGNED_INT:o.textureHalfFloatRender&&o.textureHalfFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_HALF_FLOAT:o.textureFloatRender&&o.textureFloatLinearFiltering?this._textureType=e.Engine.TEXTURETYPE_FLOAT:this._textureType=e.Engine.TEXTURETYPE_UNSIGNED_INT,this._initializeGenerator()}return Object.defineProperty(t,"FILTER_NONE",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_POISSONSAMPLING",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_EXPONENTIALSHADOWMAP",{get:function(){return t._FILTER_EXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_BLUREXPONENTIALSHADOWMAP",{get:function(){return t._FILTER_BLUREXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_CLOSEEXPONENTIALSHADOWMAP",{get:function(){return t._FILTER_CLOSEEXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_BLURCLOSEEXPONENTIALSHADOWMAP",{get:function(){return t._FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(e){this._blurBoxOffset!==e&&(this._blurBoxOffset=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurScale",{get:function(){return this._blurScale},set:function(e){this._blurScale!==e&&(this._blurScale=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurKernel",{get:function(){return this._blurKernel},set:function(e){this._blurKernel!==e&&(this._blurKernel=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useKernelBlur",{get:function(){return this._useKernelBlur},set:function(e){this._useKernelBlur!==e&&(this._useKernelBlur=e,this._disposeBlurPostProcesses())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthScale",{get:function(){return void 0!==this._depthScale?this._depthScale:this._light.getDepthScale()},set:function(e){this._depthScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(e){this._light.needCube()&&(e===t.FILTER_BLUREXPONENTIALSHADOWMAP?this.useExponentialShadowMap=!0:e===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP&&(this.useCloseExponentialShadowMap=!0)),this._filter!==e&&(this._filter=e,this._disposeBlurPostProcesses(),this._applyFilterValues(),this._light._markMeshesAsLightDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING},set:function(e){(e||this.filter===t.FILTER_POISSONSAMPLING)&&(this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap},set:function(t){e.Tools.Warn("VSM are now replaced by ESM. Please use useExponentialShadowMap instead."),this.useExponentialShadowMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurVarianceShadowMap",{get:function(){return e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap},set:function(t){e.Tools.Warn("VSM are now replaced by ESM. Please use useBlurExponentialShadowMap instead."),this.useBlurExponentialShadowMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useExponentialShadowMap",{get:function(){return this.filter===t.FILTER_EXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_EXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_EXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurExponentialShadowMap",{get:function(){return this.filter===t.FILTER_BLUREXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_BLUREXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_BLUREXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useCloseExponentialShadowMap",{get:function(){return this.filter===t.FILTER_CLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_CLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_CLOSEEXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurCloseExponentialShadowMap",{get:function(){return this.filter===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP},set:function(e){(e||this.filter===t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)&&(this.filter=e?t.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP:t.FILTER_NONE)},enumerable:!0,configurable:!0}),t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){return this._darkness=e>=1?1:e<=0?0:e,this},t.prototype.setTransparencyShadow=function(e){return this._transparencyShadow=e,this},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.addShadowCaster=function(e,t){return void 0===t&&(t=!0),this._shadowMap?(this._shadowMap.renderList||(this._shadowMap.renderList=[]),this._shadowMap.renderList.push(e),t&&(i=this._shadowMap.renderList).push.apply(i,e.getChildMeshes()),this):this;var i},t.prototype.removeShadowCaster=function(e,t){if(void 0===t&&(t=!0),!this._shadowMap||!this._shadowMap.renderList)return this;var i=this._shadowMap.renderList.indexOf(e);if(-1!==i&&this._shadowMap.renderList.splice(i,1),t)for(var r=0,n=e.getChildren();r<n.length;r++){var o=n[r];this.removeShadowCaster(o)}return this},t.prototype.getLight=function(){return this._light},t.prototype._initializeGenerator=function(){this._light._markMeshesAsLightDirty(),this._initializeShadowMap()},t.prototype._initializeShadowMap=function(){var t=this;this._shadowMap=new e.RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,!1,!0,this._textureType,this._light.needCube()),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.ignoreCameraViewport=!0,this._shadowMap.onBeforeRenderObservable.add(function(e){t._currentFaceIndex=e}),this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this),this._shadowMap.onAfterUnbindObservable.add(function(){if(t.useBlurExponentialShadowMap||t.useBlurCloseExponentialShadowMap){t._blurPostProcesses&&t._blurPostProcesses.length||t._initializeBlurRTTAndPostProcesses();var e=t.getShadowMapForRendering();e&&t._scene.postProcessManager.directRender(t._blurPostProcesses,e.getInternalTexture(),!0)}}),this._shadowMap.onClearObservable.add(function(i){t.useExponentialShadowMap||t.useBlurExponentialShadowMap?i.clear(new e.Color4(0,0,0,0),!0,!0,!0):i.clear(new e.Color4(1,1,1,1),!0,!0,!0)})},t.prototype._initializeBlurRTTAndPostProcesses=function(){var t=this,i=this._scene.getEngine(),r=this._mapSize/this.blurScale;this.useKernelBlur&&1===this.blurScale||(this._shadowMap2=new e.RenderTargetTexture(this._light.name+"_shadowMap2",r,this._scene,!1,!0,this._textureType),this._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap2.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)),this.useKernelBlur?(this._kernelBlurXPostprocess=new e.BlurPostProcess(this._light.name+"KernelBlurX",new e.Vector2(1,0),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.width=r,this._kernelBlurXPostprocess.height=r,this._kernelBlurXPostprocess.onApplyObservable.add(function(e){e.setTexture("textureSampler",t._shadowMap)}),this._kernelBlurYPostprocess=new e.BlurPostProcess(this._light.name+"KernelBlurY",new e.Vector2(0,1),this.blurKernel,1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._textureType),this._kernelBlurXPostprocess.autoClear=!1,this._kernelBlurYPostprocess.autoClear=!1,this._textureType===e.Engine.TEXTURETYPE_UNSIGNED_INT&&(this._kernelBlurXPostprocess.packedFloat=!0,this._kernelBlurYPostprocess.packedFloat=!0),this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess]):(this._boxBlurPostprocess=new e.PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,"#define OFFSET "+this._blurBoxOffset,this._textureType),this._boxBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",r,r),e.setTexture("textureSampler",t._shadowMap)}),this._boxBlurPostprocess.autoClear=!1,this._blurPostProcesses=[this._boxBlurPostprocess])},t.prototype._renderForShadowMap=function(e,t,i,r){var n,o=this._scene.getEngine();if(r.length){for(o.setColorWrite(!1),n=0;n<r.length;n++)this._renderSubMeshForShadowMap(r.data[n]);o.setColorWrite(!0)}for(n=0;n<e.length;n++)this._renderSubMeshForShadowMap(e.data[n]);for(n=0;n<t.length;n++)this._renderSubMeshForShadowMap(t.data[n]);if(this._transparencyShadow)for(n=0;n<i.length;n++)this._renderSubMeshForShadowMap(i.data[n])},t.prototype._renderSubMeshForShadowMap=function(t){var i=this,r=t.getRenderingMesh(),n=this._scene,o=n.getEngine(),s=t.getMaterial();if(s){o.setState(s.backFaceCulling);var a=r._getInstancesRenderList(t._id);if(!a.mustReturn){var l=o.getCaps().instancedArrays&&null!==a.visibleInstances[t._id]&&void 0!==a.visibleInstances[t._id];if(this.isReady(t,l)){if(o.enableEffect(this._effect),r._bind(t,this._effect,e.Material.TriangleFillMode),this._effect.setFloat2("biasAndScale",this.bias,this.depthScale),this._effect.setMatrix("viewProjection",this.getTransformMatrix()),this._effect.setVector3("lightPosition",this.getLight().position),n.activeCamera&&this._effect.setFloat2("depthValues",this.getLight().getDepthMinZ(n.activeCamera),this.getLight().getDepthMinZ(n.activeCamera)+this.getLight().getDepthMaxZ(n.activeCamera)),s&&s.needAlphaTesting()){var h=s.getAlphaTestTexture();h&&(this._effect.setTexture("diffuseSampler",h),this._effect.setMatrix("diffuseMatrix",h.getTextureMatrix()||this._defaultTextureMatrix))}r.useBones&&r.computeBonesUsingShaders&&this._effect.setMatrices("mBones",r.skeleton.getTransformMatrices(r)),this.forceBackFacesOnly&&o.setState(!0,0,!1,!0),r._processRendering(t,this._effect,e.Material.TriangleFillMode,a,l,function(e,t){return i._effect.setMatrix("world",t)}),this.forceBackFacesOnly&&o.setState(!0,0,!1,!1)}else this._shadowMap&&this._shadowMap.resetRefreshCounter()}}},t.prototype._applyFilterValues=function(){this._shadowMap&&(this.filter===t.FILTER_NONE?this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE):this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE))},t.prototype.forceCompilation=function(e,t){var i=this,r=s({useInstances:!1},t),n=this.getShadowMap();if(!n)return void(e&&e(this));var o=n.renderList;if(!o)return void(e&&e(this));for(var a=new Array,l=0,h=o;l<h.length;l++){var c=h[l];a.push.apply(a,c.subMeshes)}if(0===a.length)return void(e&&e(this));var u=0,f=function(){if(i._scene&&i._scene.getEngine()){for(;i.isReady(a[u],r.useInstances);)if(++u>=a.length)return void(e&&e(i));setTimeout(f,16)}};f()},t.prototype.isReady=function(t,i){var r=[];this._textureType!==e.Engine.TEXTURETYPE_UNSIGNED_INT&&r.push("#define FLOAT"),(this.useExponentialShadowMap||this.useBlurExponentialShadowMap)&&r.push("#define ESM");var n=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();if(s&&s.needAlphaTesting()){var a=s.getAlphaTestTexture();a&&(r.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===a.coordinatesIndex&&(n.push(e.VertexBuffer.UV2Kind),r.push("#define UV2")))}o.useBones&&o.computeBonesUsingShaders?(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(n.push(e.VertexBuffer.MatricesIndicesExtraKind),n.push(e.VertexBuffer.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),r.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))):r.push("#define NUM_BONE_INFLUENCERS 0"),i&&(r.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var l=r.join("\n");return this._cachedDefines!==l&&(this._cachedDefines=l,this._effect=this._scene.getEngine().createEffect("shadowMap",n,["world","mBones","viewProjection","diffuseMatrix","lightPosition","depthValues","biasAndScale"],["diffuseSampler"],l)),this._effect.isReady()},t.prototype.prepareDefines=function(e,t){var i=this._scene,r=this._light;i.shadowsEnabled&&r.shadowEnabled&&(e["SHADOW"+t]=!0,this.usePoissonSampling?e["SHADOWPCF"+t]=!0:this.useExponentialShadowMap||this.useBlurExponentialShadowMap?e["SHADOWESM"+t]=!0:(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap)&&(e["SHADOWCLOSEESM"+t]=!0),r.needCube()&&(e["SHADOWCUBE"+t]=!0))},t.prototype.bindShadowLight=function(e,t){var i=this._light,r=this._scene;if(r.shadowsEnabled&&i.shadowEnabled){var n=r.activeCamera;if(n){var o=this.getShadowMap();o&&(i.needCube()||t.setMatrix("lightMatrix"+e,this.getTransformMatrix()),t.setTexture("shadowSampler"+e,this.getShadowMapForRendering()),i._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/o.getSize().width,this.depthScale,this.frustumEdgeFalloff,e),i._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(n),this.getLight().getDepthMinZ(n)+this.getLight().getDepthMaxZ(n),e))}}},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var i=this._light.position;if(this._light.computeTransformedInformation()&&(i=this._light.transformedPosition),e.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(e.Vector3.Dot(this._lightDirection,e.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!i.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition=i.clone(),this._cachedDirection=this._lightDirection.clone(),e.Matrix.LookAtLHToRef(i,i.add(this._lightDirection),e.Vector3.Up(),this._viewMatrix);var r=this.getShadowMap();if(r){var n=r.renderList;n&&this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,n)}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)}return this._transformMatrix},t.prototype.recreateShadowMap=function(){var e=this._shadowMap;if(e){var t=e.renderList;this._disposeRTTandPostProcesses(),this._initializeGenerator(),this.filter=this.filter,this._applyFilterValues(),this._shadowMap.renderList=t}},t.prototype._disposeBlurPostProcesses=function(){this._shadowMap2&&(this._shadowMap2.dispose(),this._shadowMap2=null),this._downSamplePostprocess&&(this._downSamplePostprocess.dispose(),this._downSamplePostprocess=null),this._boxBlurPostprocess&&(this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=null),this._kernelBlurXPostprocess&&(this._kernelBlurXPostprocess.dispose(),this._kernelBlurXPostprocess=null),this._kernelBlurYPostprocess&&(this._kernelBlurYPostprocess.dispose(),this._kernelBlurYPostprocess=null),this._blurPostProcesses=[]},t.prototype._disposeRTTandPostProcesses=function(){this._shadowMap&&(this._shadowMap.dispose(),this._shadowMap=null),this._disposeBlurPostProcesses()},t.prototype.dispose=function(){this._disposeRTTandPostProcesses(),this._light&&(this._light._shadowGenerator=null,this._light._markMeshesAsLightDirty())},t.prototype.serialize=function(){var e={},t=this.getShadowMap();if(!t)return e;if(e.lightId=this._light.id,e.mapSize=t.getRenderSize(),e.useExponentialShadowMap=this.useExponentialShadowMap,e.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap,e.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.depthScale=this.depthScale,e.darkness=this.getDarkness(),e.blurBoxOffset=this.blurBoxOffset,e.blurKernel=this.blurKernel,e.blurScale=this.blurScale,e.useKernelBlur=this.useKernelBlur,e.transparencyShadow=this._transparencyShadow,e.renderList=[],t.renderList)for(var i=0;i<t.renderList.length;i++){var r=t.renderList[i];e.renderList.push(r.id)}return e},t.Parse=function(e,i){for(var r=i.getLightByID(e.lightId),n=new t(e.mapSize,r),o=n.getShadowMap(),s=0;s<e.renderList.length;s++){i.getMeshesByID(e.renderList[s]).forEach(function(e){o&&(o.renderList||(o.renderList=[]),o.renderList.push(e))})}return e.usePoissonSampling?n.usePoissonSampling=!0:e.useExponentialShadowMap?n.useExponentialShadowMap=!0:e.useBlurExponentialShadowMap?n.useBlurExponentialShadowMap=!0:e.useCloseExponentialShadowMap?n.useCloseExponentialShadowMap=!0:e.useBlurCloseExponentialShadowMap?n.useBlurCloseExponentialShadowMap=!0:e.useVarianceShadowMap?n.useExponentialShadowMap=!0:e.useBlurVarianceShadowMap&&(n.useBlurExponentialShadowMap=!0),e.depthScale&&(n.depthScale=e.depthScale),e.blurScale&&(n.blurScale=e.blurScale),e.blurBoxOffset&&(n.blurBoxOffset=e.blurBoxOffset),e.useKernelBlur&&(n.useKernelBlur=e.useKernelBlur),e.blurKernel&&(n.blurKernel=e.blurKernel),void 0!==e.bias&&(n.bias=e.bias),e.darkness&&n.setDarkness(e.darkness),e.transparencyShadow&&n.setTransparencyShadow(!0),n.forceBackFacesOnly=e.forceBackFacesOnly,n},t}();t._FILTER_NONE=0,t._FILTER_EXPONENTIALSHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t._FILTER_BLUREXPONENTIALSHADOWMAP=3,t._FILTER_CLOSEEXPONENTIALSHADOWMAP=4,t._FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5,e.ShadowGenerator=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i){void 0===t&&(t=""),void 0===i&&(i="black");var r=this;this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=function(){var e=r._renderingCanvas.getBoundingClientRect(),t=window.getComputedStyle(r._renderingCanvas).position;r._loadingDiv&&(r._loadingDiv.style.position="fixed"===t?"fixed":"absolute",r._loadingDiv.style.left=e.left+"px",r._loadingDiv.style.top=e.top+"px",r._loadingDiv.style.width=e.width+"px",r._loadingDiv.style.height=e.height+"px")}}return e.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var e=document.createElement("style");e.type="text/css";e.innerHTML="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }",document.getElementsByTagName("head")[0].appendChild(e);var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAYq0lEQVR4Xu2dCZRcVZnHScAJUZSwjSOIbAJmEAZwQCCMoAInYRGIg8AwegQx7AFzUBBmzAFlE4EAwxz2GRk2w7AnAURZBiEOZgyEQDAQAjmEJqTpNd3V1V3Vmd+/6utKV7/1vnpVXd2p/zn3vOV+27vfu/fd/W3QQAPrBZqbm7fJZrN79vf3T+/r67uf4wO9vb37WXQDIwWtra0Tenp6voQTv5XP56/BkfcR3iLk1g6B7hEeI+zP5V+ZiAbqBZ2dnZ8lV+6Gg87CobfhpOc4byf0FjwYE9DneBkWcXrM2tmzNzTxDdQKJPyETCazI46YgiMuI9zJuXJltuChFIHsP/PSfIfTjU19A2mira1tcxy3ey6XO5vEnkV4kes11XBmENDVj97XOT2O03FmWgMuoNLzGRJva8IUnPkzjjcT/kLoKCZzfQB7XiX8M2G8md7AUJgzJ+Z6e88gZ1xGuj3HsY17PcVkrG9gp7CUF/F8PUvxqdZDrFq1ahNVfKjwTCYxZuDE2wjKlc2WViMePM+HPNsFPOdf22OPblD5OZQHvphnV65cjTMzxaQY3eA5V9OO/hmnm1lSjE7woFsQbiXki4++foHnXkW4mLC1JUl947333tsMY3emqfB9jtPJlXN5U0+bOXPmWCPxgOccSy4+AfqPio+9/oFnbyatbqVE28GSZfjQ1NT0KQzaHMcdyPfyaNoE12HcvdxT29K3Fkv8A2vWrPmcifAFZNtD91yRY+SBZ+9UsMtEgD+jTpeenp6JXI6xpKkuUDqRcA6Kr0Wpens+InQTnIpV6Fdi+BQT64ulS5eOIzefD62na7CeoGcnLCM8ykt5OWlzcPv772/BS/w3nP+K+xU11+DvQe5dcrQlTfWAwbNMb8XA8AyGX80xtLlA6TAJuteMbVhhia1v5VMcr+LWMeoZ4xiYw7q6urbhHbgG+paCkIRQehHu4pO3O5fVydEomF5Ulx548JfVD2wqfKE2I3R3ob/f2GoC1DWhdz7HG3i5j2pvb9+Z24m6HvVZQtYsZFWcowlzePEP4jJdR/OQhxTVpAs9NMXxmZxuZKo8IG4s+v8R2tUFphSBTBWzH+OAFwn/gS3TuN55xYoVqfc6dXd3fwHZ1xFaTX0iyGbwjJqXXAammxP00EXx6UMGEx7ram7+vKnzBZ/87Xiwp40tEdDTgYwlHG/CmadSjO7L+XiialOZAej7POFG2VK0Khngl6Pn8/LL0YEtlFh4n8oDAqvaAYH8tzH2iNDm1IIFn8Ax50G7xtgCAU07CfAG4RHOz+vLZL7e0dGxlYlKHaj8BHo25xgrsfV5wrYH4KmouxV+ZZDnCUdwmXxMGgFvFUVWD+jQuOot6rI0tb4gcfaG9v+MrcAn+wj38gL8C7cObmlp2ZRjOkWYD6ypuAf6zjFHLSJ0c/6YQ813DM/yZXgehreiVgP8cvSfsOeExYsXuzs6n8v9j8mqBRZQmdjXVPuira1NHSpn8UDf4Xu0vd2uCtDzacJOlDDf5ng94X8JTWarB8R1EK7ju7udiYgEz/v3pLFKm4oHUHhh3iZdfshpaEYpA4pvKLLXBujLYKRq71XLhUHg27z12rW9B6L/QhLrWWxRH7nzeDK8awi/5HRTEx0K6MZQ694LHk0DqrgfADkreIYz1q5c+UlTEQzesIuMryrggYQWjNL3RGO7p2tuFMeqjaOidgzyCz1yJMTJ6L6d66WEVCcHIO/dQkI75Chs2g97Hoc3jRz9Lge1ED5l4r0gckqRPB0gTw34t1B+h3IqxZkmrn2SULUa7ezZszdE5xfR9130Xsm5ilrnHrmkQOcKvrkncxqrIiY6wlewbw7BOUfDo/b84zzvj9C7J7eCS0NrUiRKCPjUE7ScMBdlF/B2HqBi0ERXBcuXL99YnQz9fX2ah3Up4UnsWGEmDRuUhoTn+Z5PfvbZZ2N/fuCZRJgnfhNVBu73EZoIKt7l0L2UBsYeDZg016nb5EUCWuXQewinUtTuyq2aTStF14a8SD+VDQVj6hDYxjuXf4Hjl83sSMCmTp8j4FtoMuRQ5dAZcii3kk/0s2bBhxIcBxjxUlib1hWInEDO/6qKV+y4geO5HAMntEE/pq+nZyo0ywsG1SmwL4Orf+0yqGCfmvR73LAn9lAeBjQTEhkA+1h49a08iRflcq4H5iuXFU9cz4lqihC/LXS/NZa6Bc+pz5gql5ub6VXD2tZWTSPeyS7XgeLhXrMnEhj6MSHSwaIhFGZH8oA/JzzFeexvJbRN2HW03moT6cEChx6w4QY2rurn85JWrxsiCy0FwjcIqos8w7GZNPulkawDEbFHlaBtjzODEDrVztuKXMmADPWA3RaljyJeNdKq98ilAez8iJdyGqfO31V4NoV/EvyaCqR54V2EshE5Lqcb+TrkstkTLD4WKB4PNNZQ8P05HAelMXNSPWChC8JsYvwthJo0jSoF6fIqjjqe08Aat+LIkd+AVjn09zxbZFqK3tjXAUbXUaWDjTUSyN4J45YZX2Igo4cEOVfFson2ALIxSjR0jog5YNgpfNHM90BxIjDyWIB8Z2NfB01HISJ20wPaw4w1FlavXq1v8aPGXhFw9JNRFTDItifU/RwwpfmKxYsDK180kU4x0lhAXvOSJUs+bezlIDL2N4xi4GpjK4MGCuzUA+SPxzn3m4iKgKyV2DCV08DeMWg0B+zHHOt2DpjS3Mz1BfFOM25C5ZH4LxldJBB0g7GVARkaXgv8VsKqZtIMPpN9RUnJgRzU5Wfp22vifcG3+2vQvmdsdQXsX2pm+oKX+GYjjQXkPWqsXshpRhcJ0RpbGShSHiSuheP37ZYHsGusVHOrU1lMxkO9od4eE+8LlSzQqfetpnPAooBN/2Um+gISp89MkF8K4G3RrMJYoOhbYGxlQEGhSOGogfoLwipExGtUZVVBYIVAluaAaUpuWA+YujlPF22Ra/iBLYEOsV6tV4w0FiitfmLsXiBMU0NiAVrfsp77Zd8MHPgbDoHtva6uLs1jiv1piAKy5tCG+4KJ9wVO/p6RDzvy+b5rzSwP9Okh/WKPERiCWzfk4K8bUSTiOljAyCdx5DZG4gE8W5Dov+NYUfsV/j50fUC4dmXIQDh0qQ6PVgJsOcLM8oA410Ggvo6Ojr81di+g2TKuQOiyJOKWxlpCJpM5zUjKAL3awTsamQfEbYhjtDGKa5tPsyn/wAuiURftlBO56h6aunEwCMxxvV1d+2Fr7Jce2vAu5LUtLeoGi/19gtbToCaR97BoD6BvUs+WkXqgbw6OuhC6wH5l4rRGaCFOvYnjYbyxnpcsCvDVhYOxo6+zszNwSNHVTtJEmSiwzlMAQmNPwIPW42Dds2hfEK/5WJo0Fth+5VNxFHSlkoTzFRh/N3wnq0OGWxXtdoO8enFwaI4jsyidYgNZTxhrMEjEJ4w+En65ESWRXZ7Q4K/COqDAPlhka87WedB8KawmngTIHREOJs5pMiRp+p/GGgxL1FiA9hxjK6G1tVVdhJGAV15+cPXq1f7dahVC20Wg4miCp0uTe3Xh4Hwu93rY1B7SR/t7xQbP5R1FGgpy8IlKe+MJhZ9Aa7u5jPm+pGLX2BMDOZ+hDXgQiXIJ5xoXHZg96anEEFcvOTi0SMUXS4w0FijSTzTWYEA3hkTSEtDI2qw6RoytDLA6jctCvzKqJ8oPFOO7kAhnYe9cZGiWiZ/N9ezguWaSL4h3TUfvKJIfoN0I4sjigYSdZyxlcDVMgEczEY41ER6oZFBOh2Yqegf2zYoziFC3DuZZrjSTPLDtMlxaNPmPP/54W2OPxksrVozP5fLPGr8vEOpbxJCr3jQSJyDvGRNRhv7iHh8vE5LMpKznHBz4zSTOaXwe+mXGGh9tbWvVQf+iyfCAON/ZlTj4v43ECfB94Le4CuMrWVpTtw7O9fZOM5M8oD7xVSOLBdLuNWN1g7bgJUF8+4qpBjf7Te9M6hD4tBDc0289Wh2MHbuaSR7gsHOMLBaQ9W/G6o5MJrNDPu9dcYdQ33Yc95I6OFV5hnp2cGCliDingX5KU+9MShd0dmqta/k8J4zwnV2JsuuNxAnI83VwNpO52kiSoC4djA255cuXBzYPycGzjTQWkPdNY00OfRcQVLafRnd39ySLLsG1i20AyPZ3cDb7AyNJgnp1cOhUHUhcFiL045v9jTUa8Gjlm29fsQQhb3DzJLUEhC+oiK7EISPOwapoEh+7JQJti5YfGXs0YNC62ouC1h9lsrlToClsjc/RM7uSe0kd3EmlzTO/Kqk8Q106mM/Yw2aOB9jnOg6sWTHxJ9FraSJMy6nGz7RbZUDYmN7e3BnQ5Gisez7u3J9c0JwA6Pb0aCFvNObgwKk6NoU59uJwaJ8y1viAT4vCtEFXYO8SFQGtCZpllyXQtNqL+4lmZ/BN/5qJKQFZozEHe9JtAGSaw4wsFnie4JmUQcjleh8yZq0Fnmq3y0D02IzPMgnonYqYIfA4pC+TcXrgIahLB+PEb5s5HrjaR0b7kbHGB0pK7TDO1/T39x1lUZGAPlUH0xTbz+KSoC4dDDx2DQCHzTCaWOB5zjbW+KCSpW0IS0BIJmy6zWCk7WDuxZ4r5oO6dHB7e/sBZo4H2OfUsYOv9jHW+ECJdkAtA/c6MpmMd+XaEKj7km9M4F5TEfBzSKovDLKG1cHobw+b6EDa3WOksYBPAhevBUJMxl8GJTRhFyMLBKSJFn5ls9nvmogS0DfaHOzb3h8AcUuNNBLQNiWa0gRv4MwMMyBwCqxAfCIH82JdYSJKQN+ocjA5NHD2I/e1aj/23iPyhbG6A+bAgXsZoUEII/UAkkQORu71JqIE7o22HBw4VaelpWU74mPPDc/39d1trO5Qb4vJ8QXxbwat06WofcTInMCzeToAtN4VXUn/l1AXDkan9tDSfmL6C81BZooHxDkN9CMveLFZFFAWWZtDwVta3G0sJcAbe3bmYEiniShBXabcL+wflQDD5mD0yKlvk0b/Tk33AG5F7idG+/ibRe54oEl1nLG6A+ZYe1jyAIuG/u2LB3MazxwAfL5vJFGJinxQUwcju6c/n3+FNPm5JhJyy2k/sQTp5nm+2HBJCGi1X1WpwzuBoQXAN+IcjDz8mdePKi/WhH1uxd7GcCjIVBcWpUYDfZ0VbclEJSr2akMBhVrdX6j+Jx3DpSh7vKB8CIiqKwcrcXGqdr05k3RKbU9ryTQVkUB3aHMrEshw7kGCXiv8xxG0h6Uzent6Fpn6MhA17A6GT/3yTxNO1coJbgWur3JFf1fXNuTes5AZe18xXobFHJKv04JZc3O7CtIcgGL9KW03u3QCfL4D4b292dhrpoYgsYOhEz4kaOuHqXKqiagYiN9QnUlyKgX84JUYsQFP9GKzMFRSe8XJb9upE9Dn62CK/KQT75wdTLz+NXgPNdrDuYzeUd0ByN4Wp07n+EdCRZuTY1/ymZQDwIjQye9pA32xdw6IiUgHc639mN8kzCLRjkxzQRzitUpkZ8LZBP1CILUd55EVvdgsCrzJl5i8mgCja+Zgjst4Pq3DUnMmtSWqyNIuQruRU3+CbO08n+pvBAZAjf1IU5kcGJc0YRMBfVV3MPd2RN4+YbvYukI/3sSpe+LUmbw0ryG/6ts1oSLeYrMw6C0xeaFAGc+Wq3hbfeRk582b55lrzf3UHJwWkD0Wp+6BQ3+BfXEXw6UCdHX4TVB0BoJi9Y1Cp59XbUWN8HW7lRjLli3zbINE+1hNiCRI1cGakIhT99ani/A6z1z1nDoUqNQfbO40kyqDfrCBwMg3E5rsCy+8sFlHR8dEnFzRTq/I8hQ9NFFOtGhXVOxgFeUqfknUK7Ctpjl1ANKJ/vmUkvrdwRZmWjpA4J9MTyja2toKY8TQa/ufxP/Whdd5c5cQJHIwfBsTvkKiaqd6/fRyOHKqavdL0H+V2sxmWvrQCAeKItfmQlNyDG/8SVwnetMHyxmA7lm0K2I7GFrlVBW/V6FPP9GqeU4V0Kt2+O2yhctUN6AJBEWD9ngMnessJxh5AfCoQe+8q+xQOYLuWbQrQh2MXP1XYh8S9DKC2sI1z6kCatW3/RCZ6Vj9fNPMqx2wQVNJQlcNEl/mGG5pv48bi7HxMVSOoHsW7QqPg5GlvnJtk6/B9+HMqYUfaXE6rampqWy4dVhgi8FfLprnBXEex+i/wCSkNiSNDSpUxxt7Ccj2nQQYAwUHc9yE3HEotuifDklnfFYMdGNC/lWCxotDf4PvB/jHZTs71c+f2n+ryqCPPcb5/pKdGrTvbH2MUjH4ByOLBDpON9YSFi5cuI1FOwFbbyTox5T6y+iwFL8CqvWvwVtolWgSv/N4sXbl5ZP3r8hRLT50d56KgYJDCYXVhYOhtqqReKDdZuGJtSQSOk8f67x581SspvH3lpoBe9Vefbg/lzveaXmnAf6tEDMNGRp3LnV3ch29o10lQIf+bOKZc+XnmMGARF2EK4vUwQiSw33n7ZlqDWwcaK9Ob29vd26vwj+OT8m3kKFxdd9tlILSJ1Wo8Y8RZT/YiKOY4le5P3SGZJAc7telg7FroL16Jc/n/a1cBBCxsSblwT8LOfofcCh4AQ4x1uoCXZtgVKnYDXLMUECnPSQD29VBcrhfVw7GHrVXb6WylGg0SvUZcrr+YPYuwWVfaE9ltmpA2Q6EQq2UY+yigzf2oqCH4v4MIysD94fdwdig9uqDnB4T5/d+gwHPGNVFcOopyJiPLOfmGTwa0Ek8qS8RKDKORLFWH95utwbDd94SRqqN/Cv4PDXbTFfXfUZWBvRUPJCRBJiIqfnnccy0Dz74wHkWoypY2D4ZGU8gK+kKjQKQ8RcTW1uQI2fmc7nH7LIMFEW+sw6xdyN4CgvNByNIDjp+ZyRVhzlV7dVLaZc7t1cRoW0w9of/No6ptbuRdZupqC3QPZY33HchMkbJiRPssgyaHkN82XaJXPtOJuN+JRuixQI6Cu1VXiZtJehcFGpeNPyXI6cqPWTIvsxU1R7o912akevre4OHfTHot3fEfRbD3y8+Qu0djO5Ce5UXNGl7dTt4z0RGqnOuhgLZgmcPk2FHrrd3jgwkAVQ58e1ioxjcHeMLPWQcq+5gZKm9+hJHjXo5z4xQBQsxxyDjEfir+nNq5GfQo/nYh6f9e4NUgGEFx3DEzvw1nPrOhSJ+kh6GUBUHw6//Kmls96dJ2qv6FxNF9z8g405kVLVXDfkaiFAd4JIkttYUGFpyDOf91Ch/YVEe8DA/gORpuywDfLNMjBOQt4qEupbTPTX4YeJig+/qrnoxkfMeIdH2UHGBfP0H6kFepElc1rY5lBQYXZbzuO7BWYH7b3V3d/+TX1FEG/JSExEJdOi7qsnrx3DuNM8Zdg2NqnN/BjK0EXlVhxORr56wP6Lv/DT+X1FzYLynaOWe2s1TjCQW4An9t6Jk4hBVdH6YpB9YNXoS+SRk/JaQZHd5J2CnesLuyGaze3KZ2hTemoNcpO+uB3pAQuzvC7SeJSfc0258Wo97aX9PT+TmMEMB73jsO0wJzXnVx4llL7pe5kWaFtSqGHHgu6rpPr5jsdx+hyI59G+hA4C25GDO1V69mbf/77h0+lZpzZX44B+Ye1X1cWKz92pKrYlcjtzc6gfN+ufhApd/ErcwTvuTRNI0m4c4Tg77u6gfbCHdTuQcrRFaRKiFU7Xl1O/RqX9RObevRxR43gmEBYUn9wEJIMeF/jk0yVKTta2tE0jg43kx1OatWifEYKDrHYKGDnfkMrU1xHUPaoh7k8i+030EvoV3c6i4aTCoc/9+9NVkFgh6BmZFaig08he3oxYkwBEkQGCzg7gfG6kzaDvuSyLfgIyqt1cF6SAspoS4iJf3c9xaf3JrGEgUzZcOGgvO4agzjTQUkI9V5z4851MuLhBvUUp1gR7tjXEHL+shXFZnduNIBomi6T73FVLLByQePu4N3CxMbVxyzfeQUTYZrdpA3yvoPVf/1jdTGggC6aXx0ieLSecFcWoj72vkhU4IcswU7gVORksb6FHnufbouJ4Xbv+gf1g0EADav9uSeO9YenpA3IfURFVZ0gqEms1rRg0qCzM4TuYy1T061jt0dXXpX0xJ96FMDXIqQXtJ3tSfze6OaY0KU1ogfTUgUJMK0lBIL06dS/F/LJeRe0k2kAAk7BgSWN2GVW/aCOjRuPCbBHVGBG6J3ECKIN3VlfjroguqA+RrMsFvCNqisf5mRox2qPlB4s8vuiMdIE/fVjVvLlRnhKlqYLig7QIpOiva40PAqR2E22neJFrN10AVgWMOIDgPuMOjmRFa+HVaR0fHliaugXoEOe80nBWrZg2dZkZoYffuaW5u1kCVkadmbT70AGdqJodWOhxHqP2eFg1UDvsLatnSFq41M+KKnp6eXbhsdB2OdGiCeX8+/2ecqgnmk/VXNYtqYLSAnNposzpjgw3+H/belpVa8J7TAAAAAElFTkSuQmCC",t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.marginLeft="-60px",t.style.marginTop="-60px",t.style.animation="spin1 2s infinite ease-in-out",t.style.webkitAnimation="spin1 2s infinite ease-in-out",t.style.transformOrigin="50% 50%",t.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(t),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}},e.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",t)}},Object.defineProperty(e.prototype,"loadingUIText",{set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor)},enumerable:!0,configurable:!0}),e}();e.DefaultLoadingScreen=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ForceFullSceneLoadingForIncremental",{get:function(){return t._ForceFullSceneLoadingForIncremental},set:function(e){t._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ShowLoadingScreen",{get:function(){return t._ShowLoadingScreen},set:function(e){t._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loggingLevel",{get:function(){return t._loggingLevel},set:function(e){t._loggingLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CleanBoneMatrixWeights",{get:function(){return t._CleanBoneMatrixWeights},set:function(e){t._CleanBoneMatrixWeights=e},enumerable:!0,configurable:!0}),t._getDefaultPlugin=function(){return t._registeredPlugins[".babylon"]},t._getPluginForExtension=function(i){var r=t._registeredPlugins[i];return r||(e.Tools.Warn("Unable to find a plugin to load "+i+" files. Trying to use .babylon default plugin."),t._getDefaultPlugin())},t._getPluginForDirectLoad=function(e){for(var i in t._registeredPlugins){var r=t._registeredPlugins[i].plugin;if(r.canDirectLoad&&r.canDirectLoad(e))return t._registeredPlugins[i]}return t._getDefaultPlugin()},t._getPluginForFilename=function(e){e.name&&(e=e.name);var i=e.indexOf("?");-1!==i&&(e=e.substring(0,i));var r=e.lastIndexOf("."),n=e.substring(r,e.length).toLowerCase();return t._getPluginForExtension(n)},t._getDirectLoad=function(e){return e.substr&&"data:"===e.substr(0,5)?e.substr(5):null},t._loadData=function(i,r,n,o,s,a,l){var h,c=t._getDirectLoad(r),u=l?t._getPluginForExtension(l):c?t._getPluginForDirectLoad(r):t._getPluginForFilename(r);h=u.plugin.createPlugin?u.plugin.createPlugin():u.plugin;var f,d=u.isBinary;t.OnPluginActivatedObservable.notifyObservers(h);var p=function(e,t){if(n.isDisposed)return void a("Scene has been disposed");n.database=f;try{o(h,e,t)}catch(e){a(null,e)}},m=function(t){e.Tools.LoadFile(i+r,p,s,f,d,function(e){e&&a(e.status+" "+e.statusText)})};if(c)return p(c),h;if(-1===i.indexOf("file:"))n.getEngine().enableOfflineSupport?f=new e.Database(i+r,m):m();else{var g=r;g.name?e.Tools.ReadFile(g,p,s,d):e.FilesInput.FilesToLoad[r]?e.Tools.ReadFile(e.FilesInput.FilesToLoad[r],p,s,d):a("Unable to find file named "+r)}return h},t.GetPluginForExtension=function(e){return t._getPluginForExtension(e).plugin},t.RegisterPlugin=function(e){if("string"==typeof e.extensions){var i=e.extensions;t._registeredPlugins[i.toLowerCase()]={plugin:e,isBinary:!1}}else{var r=e.extensions;Object.keys(r).forEach(function(i){t._registeredPlugins[i.toLowerCase()]={plugin:e,isBinary:r[i].isBinary}})}},t.ImportMesh=function(i,r,n,o,s,a,l,h){if(void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null),n.substr&&"/"===n.substr(0,1))return e.Tools.Error("Wrong sceneFilename parameter"),null;var c={};o._addPendingData(c);var u=function(t,i){var s="Unable to import meshes from "+r+n+(t?": "+t:"");l?l(o,s,i):e.Tools.Error(s),o._removePendingData(c)},f=function(e){a&&a(e)};return t._loadData(r,n,o,function(e,t,a){if(e.rewriteRootURL&&(r=e.rewriteRootURL(r,a)),e.importMesh){var l=e,h=new Array,d=new Array,p=new Array;if(!l.importMesh(i,o,t,r,h,d,p,u))return;if(s)try{o.importedMeshesFiles.push(r+n),s(h,d,p),o._removePendingData(c)}catch(e){u("Error in onSuccess callback.",e)}}else{e.importMeshAsync(i,o,t,r,function(e,t,i){if(s)try{o.importedMeshesFiles.push(r+n),s(e,t,i),o._removePendingData(c)}catch(e){u("Error in onSuccess callback.",e)}},f,u)}},f,u,h)},t.Load=function(i,r,n,o,s,a,l){return t.Append(i,r,new e.Scene(n),o,s,a,l)},t.Append=function(i,r,n,o,s,a,l){if(r.substr&&"/"===r.substr(0,1))return e.Tools.Error("Wrong sceneFilename parameter"),null;t.ShowLoadingScreen&&n.getEngine().displayLoadingUI();var h={};n._addPendingData(h);var c=function(t,o){var s="Unable to load from "+i+r+(t?": "+t:"");a?a(n,s,o):e.Tools.Error(s),n._removePendingData(h),n.getEngine().hideLoadingUI()},u=function(e){s&&s(e)};return t._loadData(i,r,n,function(e,r,s){if(e.load){if(!e.load(n,r,i,c))return;if(o)try{o(n)}catch(e){c("Error in onSuccess callback",e)}n.loadingPluginName=e.name,n._removePendingData(h)}else{e.loadAsync(n,r,i,function(){o&&o(n),n.loadingPluginName=e.name,n._removePendingData(h)},u,c)}t.ShowLoadingScreen&&n.executeWhenReady(function(){n.getEngine().hideLoadingUI()})},u,c,l)},t}();t._ForceFullSceneLoadingForIncremental=!1,t._ShowLoadingScreen=!0,t._CleanBoneMatrixWeights=!1,t._loggingLevel=t.NO_LOGGING,t.OnPluginActivatedObservable=new e.Observable,t._registeredPlugins={},e.SceneLoader=t}(r||(r={}));var r;!function(e){!function(t){var i=function(t,i,r,n){for(var o=0,s=i.materials.length;o<s;o++){var a=i.materials[o];if(a.id===t)return e.Material.Parse(a,r,n)}return null},r=function(e,t,i){for(var r in t)if(e.name===t[r])return i.push(e.id),!0;return!(!e.parentId||-1===i.indexOf(e.parentId))&&(i.push(e.id),!0)},n=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")};e.SceneLoader.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(e){return-1!==e.indexOf("babylon")},importMesh:function(t,o,s,a,l,h,c,u){var f="importMesh has failed JSON parse";try{var d=JSON.parse(s);f="";var p=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING;t?Array.isArray(t)||(t=[t]):t=null;var m=new Array;if(void 0!==d.meshes&&null!==d.meshes){var g,v,y=[],_=[];for(g=0,v=d.meshes.length;g<v;g++){var b=d.meshes[g];if(null===t||r(b,t,m)){if(null!==t&&delete t[t.indexOf(b.name)],void 0!==b.geometryId&&null!==b.geometryId&&void 0!==d.geometries&&null!==d.geometries){var x=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(t){!0!==x&&d.geometries[t]&&Array.isArray(d.geometries[t])&&d.geometries[t].forEach(function(i){if(i.id===b.geometryId){switch(t){case"boxes":e.Geometry.Primitives.Box.Parse(i,o);break;case"spheres":e.Geometry.Primitives.Sphere.Parse(i,o);break;case"cylinders":e.Geometry.Primitives.Cylinder.Parse(i,o);break;case"toruses":e.Geometry.Primitives.Torus.Parse(i,o);break;case"grounds":e.Geometry.Primitives.Ground.Parse(i,o);break;case"planes":e.Geometry.Primitives.Plane.Parse(i,o);break;case"torusKnots":e.Geometry.Primitives.TorusKnot.Parse(i,o);break;case"vertexData":e.Geometry.Parse(i,o,a)}x=!0}})}),!1===x&&e.Tools.Warn("Geometry not found for mesh "+b.id)}if(b.materialId){var T=-1!==_.indexOf(b.materialId);if(!1===T&&void 0!==d.multiMaterials&&null!==d.multiMaterials)for(var E=0,S=d.multiMaterials.length;E<S;E++){var w=d.multiMaterials[E];if(w.id===b.materialId){for(var M=0,A=w.materials.length;M<A;M++){var P=w.materials[M];_.push(P);var C=i(P,d,o,a);f+="\n\tMaterial "+C.toString(p)}_.push(w.id);var R=e.Material.ParseMultiMaterial(w,o);T=!0,f+="\n\tMulti-Material "+R.toString(p);break}}if(!1===T){_.push(b.materialId);var C=i(b.materialId,d,o,a);C?f+="\n\tMaterial "+C.toString(p):e.Tools.Warn("Material not found for mesh "+b.id)}}if(b.skeletonId>-1&&void 0!==d.skeletons&&null!==d.skeletons){if(!1===y.indexOf(b.skeletonId)>-1)for(var D=0,I=d.skeletons.length;D<I;D++){var O=d.skeletons[D];if(O.id===b.skeletonId){var F=e.Skeleton.Parse(O,o);c.push(F),y.push(O.id),f+="\n\tSkeleton "+F.toString(p)}}}var L=e.Mesh.Parse(b,o,a);l.push(L),f+="\n\tMesh "+L.toString(p)}}var B;for(g=0,v=o.meshes.length;g<v;g++)B=o.meshes[g],B._waitingParentId&&(B.parent=o.getLastEntryByID(B._waitingParentId),B._waitingParentId=null);for(g=0,v=o.meshes.length;g<v;g++)B=o.meshes[g],B._waitingFreezeWorldMatrix?(B.freezeWorldMatrix(),B._waitingFreezeWorldMatrix=null):B.computeWorldMatrix(!0)}if(void 0!==d.particleSystems&&null!==d.particleSystems)for(g=0,v=d.particleSystems.length;g<v;g++){var N=d.particleSystems[g];-1!==m.indexOf(N.emitterId)&&h.push(e.ParticleSystem.Parse(N,o,a))}return!0}catch(t){var k=n("importMesh",d?d.producer:"Unknown")+f;if(!u)throw e.Tools.Log(k),t;u(k,t)}finally{null!==f&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(n("importMesh",d?d.producer:"Unknown")+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?f:""))}return!1},load:function(t,i,r,o){var s="importScene has failed JSON parse";try{var a=JSON.parse(i);s="";var l=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING;if(void 0!==a.useDelayedTextureLoading&&null!==a.useDelayedTextureLoading&&(t.useDelayedTextureLoading=a.useDelayedTextureLoading&&!e.SceneLoader.ForceFullSceneLoadingForIncremental),void 0!==a.autoClear&&null!==a.autoClear&&(t.autoClear=a.autoClear),void 0!==a.clearColor&&null!==a.clearColor&&(t.clearColor=e.Color4.FromArray(a.clearColor)),void 0!==a.ambientColor&&null!==a.ambientColor&&(t.ambientColor=e.Color3.FromArray(a.ambientColor)),void 0!==a.gravity&&null!==a.gravity&&(t.gravity=e.Vector3.FromArray(a.gravity)),a.fogMode&&0!==a.fogMode)switch(t.fogMode=a.fogMode,t.fogColor=e.Color3.FromArray(a.fogColor),t.fogStart=a.fogStart,t.fogEnd=a.fogEnd,t.fogDensity=a.fogDensity,s+="\tFog mode for scene:  ",t.fogMode){case 1:s+="exp\n";break;case 2:s+="exp2\n";break;case 3:s+="linear\n"}if(a.physicsEnabled){var h;"cannon"===a.physicsEngine?h=new e.CannonJSPlugin:"oimo"===a.physicsEngine&&(h=new e.OimoJSPlugin),s="\tPhysics engine "+(a.physicsEngine?a.physicsEngine:"oimo")+" enabled\n";var c=a.physicsGravity?e.Vector3.FromArray(a.physicsGravity):null;t.enablePhysics(c,h)}void 0!==a.metadata&&null!==a.metadata&&(t.metadata=a.metadata),void 0!==a.collisionsEnabled&&null!==a.collisionsEnabled&&(t.collisionsEnabled=a.collisionsEnabled),t.workerCollisions=!!a.workerCollisions;var u,f;if(void 0!==a.lights&&null!==a.lights)for(u=0,f=a.lights.length;u<f;u++){var d=a.lights[u],p=e.Light.Parse(d,t);p&&(s+=0===u?"\n\tLights:":"",s+="\n\t\t"+p.toString(l))}if(void 0!==a.animations&&null!==a.animations)for(u=0,f=a.animations.length;u<f;u++){var m=a.animations[u],g=e.Animation.Parse(m);t.animations.push(g),s+=0===u?"\n\tAnimations:":"",s+="\n\t\t"+g.toString(l)}if(a.autoAnimate&&t.beginAnimation(t,a.autoAnimateFrom,a.autoAnimateTo,a.autoAnimateLoop,a.autoAnimateSpeed||1),void 0!==a.materials&&null!==a.materials)for(u=0,f=a.materials.length;u<f;u++){var v=a.materials[u],y=e.Material.Parse(v,t,r);s+=0===u?"\n\tMaterials:":"",s+="\n\t\t"+y.toString(l)}if(void 0!==a.multiMaterials&&null!==a.multiMaterials)for(u=0,f=a.multiMaterials.length;u<f;u++){var _=a.multiMaterials[u],b=e.Material.ParseMultiMaterial(_,t);s+=0===u?"\n\tMultiMaterials:":"",s+="\n\t\t"+b.toString(l)}if(void 0!==a.morphTargetManagers&&null!==a.morphTargetManagers)for(var x=0,T=a.morphTargetManagers;x<T.length;x++){var E=T[x];e.MorphTargetManager.Parse(E,t)}if(void 0!==a.skeletons&&null!==a.skeletons)for(u=0,f=a.skeletons.length;u<f;u++){var S=a.skeletons[u],w=e.Skeleton.Parse(S,t);s+=0===u?"\n\tSkeletons:":"",s+="\n\t\t"+w.toString(l)}var M=a.geometries;if(void 0!==M&&null!==M){var A=M.boxes;if(void 0!==A&&null!==A)for(u=0,f=A.length;u<f;u++){var P=A[u];e.Geometry.Primitives.Box.Parse(P,t)}var C=M.spheres;if(void 0!==C&&null!==C)for(u=0,f=C.length;u<f;u++){var R=C[u];e.Geometry.Primitives.Sphere.Parse(R,t)}var D=M.cylinders;if(void 0!==D&&null!==D)for(u=0,f=D.length;u<f;u++){var I=D[u];e.Geometry.Primitives.Cylinder.Parse(I,t)}var O=M.toruses;if(void 0!==O&&null!==O)for(u=0,f=O.length;u<f;u++){var F=O[u];e.Geometry.Primitives.Torus.Parse(F,t)}var L=M.grounds;if(void 0!==L&&null!==L)for(u=0,f=L.length;u<f;u++){var B=L[u];e.Geometry.Primitives.Ground.Parse(B,t)}var N=M.planes;if(void 0!==N&&null!==N)for(u=0,f=N.length;u<f;u++){var k=N[u];e.Geometry.Primitives.Plane.Parse(k,t)}var V=M.torusKnots;if(void 0!==V&&null!==V)for(u=0,f=V.length;u<f;u++){var U=V[u];e.Geometry.Primitives.TorusKnot.Parse(U,t)}var z=M.vertexData;if(void 0!==z&&null!==z)for(u=0,f=z.length;u<f;u++){var G=z[u];e.Geometry.Parse(G,t,r)}}if(void 0!==a.transformNodes&&null!==a.transformNodes)for(u=0,f=a.transformNodes.length;u<f;u++){var H=a.transformNodes[u];e.TransformNode.Parse(H,t,r)}if(void 0!==a.meshes&&null!==a.meshes)for(u=0,f=a.meshes.length;u<f;u++){var j=a.meshes[u],W=e.Mesh.Parse(j,t,r);s+=0===u?"\n\tMeshes:":"",s+="\n\t\t"+W.toString(l)}if(void 0!==a.cameras&&null!==a.cameras)for(u=0,f=a.cameras.length;u<f;u++){var X=a.cameras[u],Y=e.Camera.Parse(X,t);s+=0===u?"\n\tCameras:":"",s+="\n\t\t"+Y.toString(l)}for(void 0!==a.activeCameraID&&null!==a.activeCameraID&&t.setActiveCameraByID(a.activeCameraID),u=0,f=t.cameras.length;u<f;u++){var Y=t.cameras[u];Y._waitingParentId&&(Y.parent=t.getLastEntryByID(Y._waitingParentId),Y._waitingParentId=null)}for(u=0,f=t.lights.length;u<f;u++){var K=t.lights[u];K&&K._waitingParentId&&(K.parent=t.getLastEntryByID(K._waitingParentId),K._waitingParentId=null)}var q,Q=[];if(e.AudioEngine&&void 0!==a.sounds&&null!==a.sounds)for(u=0,f=a.sounds.length;u<f;u++){var Z=a.sounds[u];e.Engine.audioEngine.canUseWebAudio?(Z.url||(Z.url=Z.name),Q[Z.url]?e.Sound.Parse(Z,t,r,Q[Z.url]):(q=e.Sound.Parse(Z,t,r),Q[Z.url]=q)):new e.Sound(Z.name,null,t)}for(Q=[],u=0,f=t.transformNodes.length;u<f;u++){var J=t.transformNodes[u];J._waitingParentId&&(J.parent=t.getLastEntryByID(J._waitingParentId),J._waitingParentId=null)}for(u=0,f=t.meshes.length;u<f;u++){var W=t.meshes[u];W._waitingParentId&&(W.parent=t.getLastEntryByID(W._waitingParentId),W._waitingParentId=null),W._waitingActions&&(e.ActionManager.Parse(W._waitingActions,W,t),W._waitingActions=null)}for(u=0,f=t.meshes.length;u<f;u++){var $=t.meshes[u];$._waitingFreezeWorldMatrix?($.freezeWorldMatrix(),$._waitingFreezeWorldMatrix=null):$.computeWorldMatrix(!0)}if(void 0!==a.particleSystems&&null!==a.particleSystems)for(u=0,f=a.particleSystems.length;u<f;u++){var ee=a.particleSystems[u];e.ParticleSystem.Parse(ee,t,r)}if(void 0!==a.environmentTexture&&null!==a.environmentTexture&&(t.environmentTexture=e.CubeTexture.CreateFromPrefilteredData(r+a.environmentTexture,t),!0===a.createDefaultSkybox)){var te=void 0!==t.activeCamera&&null!==t.activeCamera?(t.activeCamera.maxZ-t.activeCamera.minZ)/2:1e3,ie=a.skyboxBlurLevel||0;t.createDefaultSkybox(void 0,!0,te,ie)}if(void 0!==a.lensFlareSystems&&null!==a.lensFlareSystems)for(u=0,f=a.lensFlareSystems.length;u<f;u++){var re=a.lensFlareSystems[u];e.LensFlareSystem.Parse(re,t,r)}if(void 0!==a.shadowGenerators&&null!==a.shadowGenerators)for(u=0,f=a.shadowGenerators.length;u<f;u++){var ne=a.shadowGenerators[u];e.ShadowGenerator.Parse(ne,t)}for(u=0,f=t.lights.length;u<f;u++){var oe=t.lights[u];if(oe._excludedMeshesIds.length>0){for(var se=0;se<oe._excludedMeshesIds.length;se++){var ae=t.getMeshByID(oe._excludedMeshesIds[se]);ae&&oe.excludedMeshes.push(ae)}oe._excludedMeshesIds=[]}if(oe._includedOnlyMeshesIds.length>0){for(var le=0;le<oe._includedOnlyMeshesIds.length;le++){var he=t.getMeshByID(oe._includedOnlyMeshesIds[le]);he&&oe.includedOnlyMeshes.push(he)}oe._includedOnlyMeshesIds=[]}}return void 0!==a.actions&&null!==a.actions&&e.ActionManager.Parse(a.actions,null,t),!0}catch(t){var ce=n("importScene",a?a.producer:"Unknown")+s;if(!o)throw e.Tools.Log(ce),t;o(ce,t)}finally{null!==s&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(n("importScene",a?a.producer:"Unknown")+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?s:""))}return!1}})}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i,r,n,o,s,a,l){this.onProcessFileCallback=function(){return!0},this._engine=e,this._currentScene=t,this._sceneLoadedCallback=i,this._progressCallback=r,this._additionalRenderLoopLogicCallback=n,this._textureLoadingCallback=o,this._startingProcessingFilesCallback=s,this._onReloadCallback=a,this._errorCallback=l}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._dragEnterHandler=function(e){t.drag(e)},this._dragOverHandler=function(e){t.drag(e)},this._dropHandler=function(e){t.drop(e)},this._elementToMonitor.addEventListener("dragenter",this._dragEnterHandler,!1),this._elementToMonitor.addEventListener("dragover",this._dragOverHandler,!1),this._elementToMonitor.addEventListener("drop",this._dropHandler,!1))},t.prototype.dispose=function(){this._elementToMonitor&&(this._elementToMonitor.removeEventListener("dragenter",this._dragEnterHandler),this._elementToMonitor.removeEventListener("dragover",this._dragOverHandler),this._elementToMonitor.removeEventListener("drop",this._dropHandler))},t.prototype.renderFunction=function(){if(this._additionalRenderLoopLogicCallback&&this._additionalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype._traverseFolder=function(e,t,i,r){var n=this,o=e.createReader(),s=e.fullPath.replace(/^\//,"").replace(/(.+?)\/?$/,"$1/");o.readEntries(function(e){i.count+=e.length;for(var o=0,a=e;o<a.length;o++){var l=a[o];l.isFile?l.file(function(e){e.correctName=s+e.name,t.push(e),0==--i.count&&r()}):l.isDirectory&&n._traverseFolder(l,t,i,r)}--i.count&&r()})},t.prototype._processFiles=function(e){for(var i=0,r=0;r<e.length;r++){var n=e[r].correctName.toLowerCase(),o=n.split(".").pop();this.onProcessFileCallback(e[r],n,o)?"babylon"!==o&&"stl"!==o&&"obj"!==o&&"gltf"!==o&&"glb"!==o||-1!==n.indexOf(".binary.babylon")||-1!==n.indexOf(".incremental.babylon")?t.FilesToLoad[n]=e[r]:this._sceneFileToLoad=e[r]:i++}this._onReloadCallback?this._onReloadCallback(this._sceneFileToLoad):i<e.length&&this.reload()},t.prototype.loadFiles=function(e){var t=this;if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=new Array,r=[],n=e.dataTransfer?e.dataTransfer.items:null,o=0;o<this._filesToLoad.length;o++){var s=this._filesToLoad[o],a=s.name.toLowerCase(),l=void 0;if(s.correctName=a,n){var h=n[o];h.getAsEntry?l=h.getAsEntry():h.webkitGetAsEntry&&(l=h.webkitGetAsEntry())}l&&l.isDirectory?r.push(l):i.push(s)}if(0===r.length)this._processFiles(i);else for(var c={count:r.length},u=0,f=r;u<f.length;u++){var d=f[u];this._traverseFolder(d,i,c,function(){t._processFiles(i)})}}},t.prototype.reload=function(){var t=this;this._sceneFileToLoad?(this._currentScene&&(e.Tools.errorsCount>0&&(e.Tools.ClearLogCache(),e.Tools.Log("Babylon.js engine (v"+e.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(e){t._currentScene=e,t._sceneLoadedCallback&&t._sceneLoadedCallback(t._sceneFileToLoad,t._currentScene),t._currentScene.executeWhenReady(function(){t._engine.runRenderLoop(function(){t.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)},function(e,i){t._currentScene=e,t._errorCallback&&t._errorCallback(t._sceneFileToLoad,t._currentScene,i)})):e.Tools.Error("Please provide a valid .babylon file.")},t}();t.FilesToLoad={},e.FilesInput=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach(function(e,i){return t.add(e,i)})},e.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},e.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i?i:(i=t(e),i&&this.add(e,i),i)},e.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data){e(t,this._data[t])}},e.prototype.first=function(e){for(var t in this._data){var i=this._data[t],r=e(t,i);if(r)return r}return null},e}();e.StringDictionary=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return t.HasTags(e)},e.addTags=function(i){return t.AddTagsTo(e,i)},e.removeTags=function(i){return t.RemoveTagsFrom(e,i)},e.matchesTagsQuery=function(i){return t.MatchesQuery(e,i)}},t.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},t.HasTags=function(t){return!!t._tags&&!e.Tools.IsEmpty(t._tags)},t.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var i=[];for(var r in e._tags)e._tags.hasOwnProperty(r)&&!0===e._tags[r]&&i.push(r);return i.join(" ")}return e._tags},t.AddTagsTo=function(e,i){if(i&&"string"==typeof i){i.split(" ").forEach(function(i,r,n){t._AddTagTo(e,i)})}},t._AddTagTo=function(e,i){""!==(i=i.trim())&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(e),e._tags[i]=!0))},t.RemoveTagsFrom=function(e,i){if(t.HasTags(e)){var r=i.split(" ");for(var n in r)t._RemoveTagFrom(e,r[n])}},t._RemoveTagFrom=function(e,t){delete e._tags[t]},t.MatchesQuery=function(i,r){return void 0===r||(""===r?t.HasTags(i):e.Internals.AndOrNotEvaluator.Eval(r,function(e){return t.HasTags(i)&&i._tags[e]}))},t}();e.Tags=t}(r||(r={}));var r;!function(e){!function(e){var t=function(){function e(){}return e.Eval=function(t,i){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)}):e._HandleParenthesisContent(t,i))||"false"!==t&&e.Eval(t,i)},e._HandleParenthesisContent=function(t,i){i=i||function(e){return"true"===e};var r,n=t.split("||");for(var o in n)if(n.hasOwnProperty(o)){var s=e._SimplifyNegation(n[o].trim()),a=s.split("&&");if(a.length>1)for(var l=0;l<a.length;++l){var h=e._SimplifyNegation(a[l].trim());if(!(r="true"!==h&&"false"!==h?"!"===h[0]?!i(h.substring(1)):i(h):"true"===h)){s="false";break}}if(r||"true"===s){r=!0;break}r="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s}return r?"true":"false"},e._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),e=e.trim(),"!true"===e?e="false":"!false"===e&&(e="true"),e},e}();e.AndOrNotEvaluator=t}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this._enableSceneOffline=!1,this._enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return Object.defineProperty(t.prototype,"enableSceneOffline",{get:function(){return this._enableSceneOffline},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableTexturesOffline",{get:function(){return this._enableTexturesOffline},enumerable:!0,configurable:!0}),t.prototype.checkManifestFile=function(){var t=this,i=function(){t._enableSceneOffline=!1,t._enableTexturesOffline=!1,t.callbackManifestChecked(!1)},r=!1,n=this.currentSceneUrl+".manifest",o=new XMLHttpRequest;navigator.onLine&&(r=!0,n=n+(null==n.match(/\?/)?"?":"&")+(new Date).getTime()),o.open("GET",n,!0),o.timeout=1e3,o.ontimeout=function(){i()},o.addEventListener("load",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{var r=JSON.parse(o.response);t._enableSceneOffline=r.enableSceneOffline,t._enableTexturesOffline=r.enableTexturesOffline,r.version&&!isNaN(parseInt(r.version))&&(t.manifestVersionFound=r.version),t.callbackManifestChecked&&t.callbackManifestChecked(!0)}catch(e){i()}else i()},!1),o.addEventListener("error",function(e){if(r){r=!1;var n=t.currentSceneUrl+".manifest";o.open("GET",n,!0),o.send()}else i()},!1);try{o.send()}catch(t){e.Tools.Error("Error on XHR send request."),this.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){var r=this,n=function(){r.isSupported=!1,i&&i()};if(this.idbFactory&&(this._enableSceneOffline||this._enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var o=this.idbFactory.open("babylonjs",1);o.onerror=function(e){n()},o.onblocked=function(t){e.Tools.Error("IDB request blocked. Please reload the page."),n()},o.onsuccess=function(e){r.db=o.result,t()},o.onupgradeneeded=function(t){if(r.db=t.target.result,r.db)try{r.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),r.db.createObjectStore("versions",{keyPath:"sceneUrl"}),r.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(t){e.Tools.Error("Error while creating object stores. Exception: "+t.message),n()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var r=this,n=t.ReturnFullUrlLocation(e),o=function(){r.hasReachedQuota||null===r.db?i.src=e:r._saveImageIntoDBAsync(n,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(n,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,r){if(this.isSupported&&null!==this.db){var n,o=this.db.transaction(["textures"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(n){var a=window.URL||window.webkitURL;s=a.createObjectURL(n.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error("Error loading image from blob URL: "+s+" switching back to web url: "+t),i.src=t},i.src=s}else r()};var s=o.objectStore("textures").get(t);s.onsuccess=function(e){n=e.target.result},s.onerror=function(r){e.Tools.Error("Error loading texture "+t+" from DB."),i.src=t}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,r){var n=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}e&&(r.src=e)};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="blob",a.addEventListener("load",function(){if(200===a.status&&n.db){s=a.response;var e=n.db.transaction(["textures"],"readwrite");e.onabort=function(e){try{var t=e.srcElement||e.target,i=t.error;i&&"QuotaExceededError"===i.name&&(n.hasReachedQuota=!0)}catch(e){}o()},e.oncomplete=function(e){o()};var l={textureUrl:i,data:s};try{var h=e.objectStore("textures").put(l);h.onsuccess=function(e){},h.onerror=function(e){o()}}catch(e){25===e.code&&(t.IsUASupportingBlobStorage=!1),r.src=i}}else r.src=i},!1),a.addEventListener("error",function(t){e.Tools.Error("Error in XHR request in BABYLON.Database."),r.src=i},!1),a.send()}else r.src=i}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),r.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,r=function(){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,r)},t.prototype._loadVersionFromDBAsync=function(t,i,r){var n=this;if(this.isSupported&&this.db){var o;try{var s=this.db.transaction(["versions"]);s.oncomplete=function(e){o?n.manifestVersionFound>o.data?(n.mustUpdateRessources=!0,r()):i(o.data):(n.mustUpdateRessources=!0,r())},s.onabort=function(e){i(-1)};var a=s.objectStore("versions").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(r){e.Tools.Error("Error loading version for scene "+t+" from DB."),i(-1)}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+t.message),i(-1)}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var r=this;if(this.isSupported&&!this.hasReachedQuota&&this.db)try{var n=this.db.transaction(["versions"],"readwrite");n.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(r.hasReachedQuota=!0)}catch(e){}i(-1)},n.oncomplete=function(e){i(r.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=n.objectStore("versions").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+t.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,r,n,o){var s=this,a=t.ReturnFullUrlLocation(e),l=function(){s._saveFileIntoDBAsync(a,i,r)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,r,o):s._loadFileFromDBAsync(a,i,l,o):n&&n()})},t.prototype._loadFileFromDBAsync=function(t,i,r,n){if(this.isSupported&&this.db){var o;o=-1!==t.indexOf(".babylon")?"scenes":"textures";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):r()},a.onabort=function(e){r()};var l=a.objectStore(o).get(t);l.onsuccess=function(e){s=e.target.result},l.onerror=function(i){e.Tools.Error("Error loading file "+t+" from DB."),r()}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.prototype._saveFileIntoDBAsync=function(t,i,r,n){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var a,l=new XMLHttpRequest;l.open("GET",t,!0),n&&(l.responseType="arraybuffer"),r&&(l.onprogress=r),l.addEventListener("load",function(){if(200===l.status||e.Tools.ValidateXHRData(l,n?6:1))if(a=n?l.response:l.responseText,!o.hasReachedQuota&&o.db){var r=o.db.transaction([s],"readwrite");r.onabort=function(e){try{var t=e.srcElement.error;t&&"QuotaExceededError"===t.name&&(o.hasReachedQuota=!0)}catch(e){}i(a)},r.oncomplete=function(e){i(a)};var h;h="scenes"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var c=r.objectStore(s).put(h);c.onsuccess=function(e){},c.onerror=function(t){e.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(e){i(a)}}else i(a);else i()},!1),l.addEventListener("error",function(t){e.Tools.Error("error on XHR request."),i()},!1),l.send()}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t}();t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){document.createElement("a").href=e;var t=e.substring(0,e.lastIndexOf("#")),i=e.substring(t.lastIndexOf("/")+1,e.length);return e.substring(0,e.indexOf(i,0))},t.ReturnFullUrlLocation=function(e){return-1===e.indexOf("http:/")&&-1===e.indexOf("https:/")?t.parseURL(window.location.href)+e:e},e.Database=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._isEnabled=!0,this.leftColor=e.Color3.White(),this.rightColor=e.Color3.Black(),this.bias=0,this.power=1}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var i=new t;return e.Tools.DeepCopy(this,i),i},t.prototype.serialize=function(){var e={};return e.isEnabled=this.isEnabled,e.leftColor=this.leftColor,e.rightColor=this.rightColor,e.bias=this.bias,e.power=this.power,e},t.Parse=function(i){var r=new t;return r.isEnabled=i.isEnabled,r.leftColor=e.Color3.FromArray(i.leftColor),r.rightColor=e.Color3.FromArray(i.rightColor),r.bias=i.bias,r.power=i.power||1,r},t}();e.FresnelParameters=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i){var r=t.call(this,e,i,!0)||this;return i.multiMaterials.push(r),r.subMaterials=new Array,r.storeEffectOnSubMeshes=!0,r}return o(i,t),Object.defineProperty(i.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!0,configurable:!0}),i.prototype._hookArray=function(e){var t=this,i=e.push;e.push=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=i.apply(e,r);return t._markAllSubMeshesAsTexturesDirty(),o};var r=e.splice;e.splice=function(i,n){var o=r.apply(e,[i,n]);return t._markAllSubMeshesAsTexturesDirty(),o}},i.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},i.prototype.getActiveTextures=function(){return(e=t.prototype.getActiveTextures.call(this)).concat.apply(e,this.subMaterials.map(function(e){return e?e.getActiveTextures():[]}));var e},i.prototype.getClassName=function(){return"MultiMaterial"},i.prototype.isReadyForSubMesh=function(e,t,i){for(var r=0;r<this.subMaterials.length;r++){var n=this.subMaterials[r];if(n){if(n.storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,i))return!1;continue}if(!n.isReady(e))return!1}}return!0},i.prototype.clone=function(e,t){for(var r=new i(e,this.getScene()),n=0;n<this.subMaterials.length;n++){var o=null,s=this.subMaterials[n];o=t&&s?s.clone(e+"-"+s.name):this.subMaterials[n],r.subMaterials.push(o)}return r},i.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,e.Tags&&(t.tags=e.Tags.GetTags(this)),t.materials=[];for(var i=0;i<this.subMaterials.length;i++){var r=this.subMaterials[i];r?t.materials.push(r.id):t.materials.push(null)}return t},i.prototype.dispose=function(e,i){var r=this.getScene();if(r){var n=r.multiMaterials.indexOf(this);n>=0&&r.multiMaterials.splice(n,1),t.prototype.dispose.call(this,e,i)}},i}(e.Material);e.MultiMaterial=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250}return t.prototype.attachControl=function(t,i){var r=this,n=null;void 0===this._pointerInput&&(this._onLostFocus=function(e){r._offsetX=null,r._offsetY=null},this._pointerInput=function(t,o){var s=t.event;if("mouse"!==s.pointerType)if(t.type===e.PointerEventTypes.POINTERDOWN){if(i||s.preventDefault(),r._pointerPressed.push(s.pointerId),1!==r._pointerPressed.length)return;n={x:s.clientX,y:s.clientY}}else if(t.type===e.PointerEventTypes.POINTERUP){i||s.preventDefault();var a=r._pointerPressed.indexOf(s.pointerId);if(-1===a)return;if(r._pointerPressed.splice(a,1),0!=a)return;n=null,r._offsetX=null,r._offsetY=null}else if(t.type===e.PointerEventTypes.POINTERMOVE){if(i||s.preventDefault(),!n)return;var a=r._pointerPressed.indexOf(s.pointerId);if(0!=a)return;r._offsetX=s.clientX-n.x,r._offsetY=-(s.clientY-n.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),this._onLostFocus&&t.addEventListener("blur",this._onLostFocus)},t.prototype.detachControl=function(e){this._pointerInput&&e&&(this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null),this._onLostFocus&&(e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null),this._pointerPressed=[],this._offsetX=null,this._offsetY=null)},t.prototype.checkInputs=function(){if(this._offsetX&&this._offsetY){var t=this.camera;if(t.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var i=t._computeLocalCameraSpeed(),r=new e.Vector3(0,0,i*this._offsetY/this.touchMoveSensibility);e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(r,t._cameraRotationMatrix))}}},t.prototype.getClassName=function(){return"FreeCameraTouchInput"},t.prototype.getSimpleName=function(){return"touch"},t}();n([e.serialize()],t.prototype,"touchAngularSensibility",void 0),n([e.serialize()],t.prototype,"touchMoveSensibility",void 0),e.FreeCameraTouchInput=t,e.CameraInputTypes.FreeCameraTouchInput=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addTouch(),n._setupInputs(),n}return o(t,e),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},t}(e.FreeCamera);e.TouchCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){void 0===s&&(s=null),void 0===a&&(a=!0),void 0===l&&(l=!1);var h=t.call(this,null,o,!a)||this;h.isCube=l,h.isEnabled=!0,h._currentRefreshId=-1,h._refreshRate=1,h._vertexBuffers={},h._uniforms=new Array,h._samplers=new Array,h._textures={},h._floats={},h._floatsArrays={},h._colors3={},h._colors4={},h._vectors2={},h._vectors3={},h._matrices={},h._fallbackTextureUsed=!1,o._proceduralTextures.push(h),h._engine=o.getEngine(),h.name=i,h.isRenderTarget=!0,h._size=r,h._generateMipMaps=a,h.setFragment(n),h._fallbackTexture=s,l?(h._texture=h._engine.createRenderTargetCubeTexture(r,{generateMipMaps:a}),h.setFloat("face",0)):h._texture=h._engine.createRenderTargetTexture(r,a);var c=[];return c.push(1,1),c.push(-1,1),c.push(-1,-1),c.push(1,-1),h._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(h._engine,c,e.VertexBuffer.PositionKind,!1,!1,2),h._createIndexBuffer(),h}return o(i,t),i.prototype._createIndexBuffer=function(){var e=this._engine,t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},i.prototype._rebuild=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&t._rebuild(),this._createIndexBuffer(),this.refreshRate===e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=e.RenderTargetTexture.REFRESHRATE_RENDER_ONCE)},i.prototype.reset=function(){if(void 0!==this._effect){this._engine._releaseEffect(this._effect)}},i.prototype.isReady=function(){var t,i=this,r=this._engine;return!!this._fragment&&(!!this._fallbackTextureUsed||(t=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=r.createEffect(t,[e.VertexBuffer.PositionKind],this._uniforms,this._samplers,"",void 0,void 0,function(){i.releaseInternalTexture(),i._fallbackTexture&&(i._texture=i._fallbackTexture._texture,i._texture&&i._texture.incrementReferences()),i._fallbackTextureUsed=!0}),this._effect.isReady()))},i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},i.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return!!(this.isEnabled&&this.isReady()&&this._texture)&&(!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)))},i.prototype.getRenderSize=function(){return this._size},i.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this._engine.createRenderTargetTexture(e,t))},i.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},i.prototype.render=function(e){var t=this.getScene();if(t){var i=this._engine;i.enableEffect(this._effect),i.setState(!1);for(var r in this._textures)this._effect.setTexture(r,this._textures[r]);for(r in this._floats)this._effect.setFloat(r,this._floats[r]);for(r in this._floatsArrays)this._effect.setArray(r,this._floatsArrays[r]);for(r in this._colors3)this._effect.setColor3(r,this._colors3[r]);for(r in this._colors4){var n=this._colors4[r];this._effect.setFloat4(r,n.r,n.g,n.b,n.a)}for(r in this._vectors2)this._effect.setVector2(r,this._vectors2[r]);for(r in this._vectors3)this._effect.setVector3(r,this._vectors3[r]);for(r in this._matrices)this._effect.setMatrix(r,this._matrices[r]);if(this._texture){if(this.isCube)for(var o=0;o<6;o++)i.bindFramebuffer(this._texture,o,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this._effect.setFloat("face",o),i.clear(t.clearColor,!0,!0,!0),i.draw(!0,0,6),5===o&&i.generateMipMapsForCubemap(this._texture);else i.bindFramebuffer(this._texture,0,void 0,void 0,!0),i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),i.clear(t.clearColor,!0,!0,!0),i.draw(!0,0,6);i.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated()}}},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t},i.prototype.dispose=function(){var i=this.getScene();if(i){var r=i._proceduralTextures.indexOf(this);r>=0&&i._proceduralTextures.splice(r,1);var n=this._vertexBuffers[e.VertexBuffer.PositionKind];n&&(n.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),t.prototype.dispose.call(this)}},i}(e.Texture);e.ProceduralTexture=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r,n,o,s){var a=t.call(this,e,r,null,n,o,s)||this;return a._animate=!0,a._time=0,a._texturePath=i,a.loadJson(i),a.refreshRate=1,a}return o(i,t),i.prototype.loadJson=function(t){var i=this,r=function(){e.Tools.Log("No config file found in "+t+" trying to use ShadersStore or DOM element");try{i.setFragment(i._texturePath)}catch(t){e.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}},n=t+"/config.json",o=new XMLHttpRequest;o.open("GET",n,!0),o.addEventListener("load",function(){if(200===o.status||e.Tools.ValidateXHRData(o,1))try{i._config=JSON.parse(o.response),i.updateShaderUniforms(),i.updateTextures(),i.setFragment(i._texturePath+"/custom"),i._animate=i._config.animate,i.refreshRate=i._config.refreshrate}catch(e){r()}else r()},!1),o.addEventListener("error",function(){r()},!1);try{o.send()}catch(t){e.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},i.prototype.isReady=function(){if(!t.prototype.isReady.call(this))return!1;for(var e in this._textures){if(!this._textures[e].isReady())return!1}return!0},i.prototype.render=function(e){var i=this.getScene();this._animate&&i&&(this._time+=.03*i.getAnimationRatio(),this.updateShaderUniforms()),t.prototype.render.call(this,e)},i.prototype.updateTextures=function(){for(var t=0;t<this._config.sampler2Ds.length;t++)this.setTexture(this._config.sampler2Ds[t].sample2Dname,new e.Texture(this._texturePath+"/"+this._config.sampler2Ds[t].textureRelativeUrl,this.getScene()))},i.prototype.updateShaderUniforms=function(){if(this._config)for(var t=0;t<this._config.uniforms.length;t++){var i=this._config.uniforms[t];switch(i.type){case"float":this.setFloat(i.name,i.value);break;case"color3":this.setColor3(i.name,new e.Color3(i.r,i.g,i.b));break;case"color4":this.setColor4(i.name,new e.Color4(i.r,i.g,i.b,i.a));break;case"vector2":this.setVector2(i.name,new e.Vector2(i.x,i.y));break;case"vector3":this.setVector3(i.name,new e.Vector3(i.x,i.y,i.z))}}this.setFloat("time",this._time)},Object.defineProperty(i.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),i}(e.ProceduralTexture);e.CustomProceduralTexture=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40,this._cameraTransform=e.Matrix.Identity(),this._deltaTransform=e.Vector3.Zero(),this._vector3=e.Vector3.Zero(),this._vector2=e.Vector2.Zero()}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(t){t.type!==e.Gamepad.POSE_ENABLED&&(r.gamepad&&t.type!==e.Gamepad.XBOX||(r.gamepad=t))}),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(e){r.gamepad===e&&(r.gamepad=null)}),this.gamepad=n.getGamepadByType(e.Gamepad.XBOX)},t.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad&&this.gamepad.leftStick){var t=this.camera,i=this.gamepad.leftStick,r=i.x/this.gamepadMoveSensibility,n=i.y/this.gamepadMoveSensibility;i.x=Math.abs(r)>.005?0+r:0,i.y=Math.abs(n)>.005?0+n:0;var o=this.gamepad.rightStick;if(o){var s=o.x/this.gamepadAngularSensibility,a=o.y/this.gamepadAngularSensibility;o.x=Math.abs(s)>.001?0+s:0,o.y=Math.abs(a)>.001?0+a:0}else o={x:0,y:0};t.rotationQuaternion?t.rotationQuaternion.toRotationMatrix(this._cameraTransform):e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,this._cameraTransform);var l=50*t._computeLocalCameraSpeed();this._vector3.copyFromFloats(i.x*l,0,-i.y*l),e.Vector3.TransformCoordinatesToRef(this._vector3,this._cameraTransform,this._deltaTransform),t.cameraDirection.addInPlace(this._deltaTransform),this._vector2.copyFromFloats(o.y,o.x),t.cameraRotation.addInPlace(this._vector2)}},t.prototype.getClassName=function(){return"FreeCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},t}();n([e.serialize()],t.prototype,"gamepadAngularSensibility",void 0),n([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),e.FreeCameraGamepadInput=t,e.CameraInputTypes.FreeCameraGamepadInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return t.prototype.attachControl=function(t,i){var r=this,n=this.camera.getScene().gamepadManager;this._onGamepadConnectedObserver=n.onGamepadConnectedObservable.add(function(t){t.type!==e.Gamepad.POSE_ENABLED&&(r.gamepad&&t.type!==e.Gamepad.XBOX||(r.gamepad=t))}),this._onGamepadDisconnectedObserver=n.onGamepadDisconnectedObservable.add(function(e){r.gamepad===e&&(r.gamepad=null)}),this.gamepad=n.getGamepadByType(e.Gamepad.XBOX)},t.prototype.detachControl=function(e){this.camera.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.camera.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,t=this.gamepad.rightStick;if(t){if(0!=t.x){var i=t.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialAlphaOffset+=i)}if(0!=t.y){var r=t.y/this.gamepadRotationSensibility;0!=r&&Math.abs(r)>.005&&(e.inertialBetaOffset+=r)}}var n=this.gamepad.leftStick;if(n&&0!=n.y){var o=n.y/this.gamepadMoveSensibility;0!=o&&Math.abs(o)>.005&&(this.camera.inertialRadiusOffset-=o)}}},t.prototype.getClassName=function(){return"ArcRotateCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},t}();n([e.serialize()],t.prototype,"gamepadRotationSensibility",void 0),n([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),e.ArcRotateCameraGamepadInput=t,e.CameraInputTypes.ArcRotateCameraGamepadInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){var i=this;this._scene=t,this._babylonGamepads=[],this._oneGamepadConnected=!1,this._isMonitoring=!1,this.onGamepadDisconnectedObservable=new e.Observable,e.Tools.IsWindowObjectExist()?(this._gamepadEventSupported="GamepadEvent"in window,this._gamepadSupport=navigator.getGamepads||navigator.webkitGetGamepads||navigator.msGetGamepads||navigator.webkitGamepads):this._gamepadEventSupported=!1,this.onGamepadConnectedObservable=new e.Observable(function(e){for(var t in i._babylonGamepads){var r=i._babylonGamepads[t];r&&r._isConnected&&i.onGamepadConnectedObservable.notifyObserver(e,r)}}),this._onGamepadConnectedEvent=function(e){var t=e.gamepad;if(!(t.index in i._babylonGamepads&&i._babylonGamepads[t.index].isConnected)){var r;i._babylonGamepads[t.index]?(r=i._babylonGamepads[t.index],r.browserGamepad=t,r._isConnected=!0):r=i._addNewGamepad(t),i.onGamepadConnectedObservable.notifyObservers(r),i._startMonitoringGamepads()}},this._onGamepadDisconnectedEvent=function(e){var t=e.gamepad;for(var r in i._babylonGamepads)if(i._babylonGamepads[r].index===t.index){var n=i._babylonGamepads[r];n._isConnected=!1,i.onGamepadDisconnectedObservable.notifyObservers(n);break}},this._gamepadSupport&&(this._updateGamepadObjects(),this._babylonGamepads.length&&this._startMonitoringGamepads(),this._gamepadEventSupported?(window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent,!1)):this._startMonitoringGamepads())}return Object.defineProperty(t.prototype,"gamepads",{get:function(){return this._babylonGamepads},enumerable:!0,configurable:!0}),t.prototype.getGamepadByType=function(t){void 0===t&&(t=e.Gamepad.XBOX);for(var i=0,r=this._babylonGamepads;i<r.length;i++){var n=r[i];if(n&&n.type===t)return n}return null},t.prototype.dispose=function(){this._gamepadEventSupported&&(this._onGamepadConnectedEvent&&window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent),this._onGamepadDisconnectedEvent&&window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnectedEvent),this._onGamepadConnectedEvent=null,this._onGamepadDisconnectedEvent=null),this._babylonGamepads.forEach(function(e){e.dispose()}),this.onGamepadConnectedObservable.clear(),this.onGamepadDisconnectedObservable.clear(),this._oneGamepadConnected=!1,this._stopMonitoringGamepads(),this._babylonGamepads=[]},t.prototype._addNewGamepad=function(t){this._oneGamepadConnected||(this._oneGamepadConnected=!0);var i,r=-1!==t.id.search("Xbox One");return i=r||-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")?new e.Xbox360Pad(t.id,t.index,t,r):t.pose?e.PoseEnabledControllerHelper.InitiateController(t):new e.GenericPad(t.id,t.index,t),this._babylonGamepads[i.index]=i,i},t.prototype._startMonitoringGamepads=function(){this._isMonitoring||(this._isMonitoring=!0,this._scene||this._checkGamepadsStatus())},t.prototype._stopMonitoringGamepads=function(){this._isMonitoring=!1},t.prototype._checkGamepadsStatus=function(){var t=this;this._updateGamepadObjects();for(var i in this._babylonGamepads){var r=this._babylonGamepads[i];r&&r.isConnected&&r.update()}this._isMonitoring&&!this._scene&&e.Tools.QueueNewFrame(function(){t._checkGamepadsStatus()})},t.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(this._babylonGamepads[e[t].index])this._babylonGamepads[t].browserGamepad=e[t],this._babylonGamepads[t].isConnected||(this._babylonGamepads[t]._isConnected=!0,this.onGamepadConnectedObservable.notifyObservers(this._babylonGamepads[t]));else{var i=this._addNewGamepad(e[t]);this.onGamepadConnectedObservable.notifyObservers(i)}},t}();e.GamepadManager=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=t;var i=function(){function e(t,i,r,n,o,s,a){void 0===n&&(n=0),void 0===o&&(o=1),void 0===s&&(s=2),void 0===a&&(a=3),this.id=t,this.index=i,this.browserGamepad=r,this._isConnected=!0,this._invertLeftStickY=!1,this.type=e.GAMEPAD,this._leftStickAxisX=n,this._leftStickAxisY=o,this._rightStickAxisX=s,this._rightStickAxisY=a,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._isConnected},enumerable:!0,configurable:!0}),e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[this._leftStickAxisX],y:this.browserGamepad.axes[this._leftStickAxisY]},this._invertLeftStickY&&(this.leftStick.y*=-1)),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[this._rightStickAxisX],y:this.browserGamepad.axes[this._rightStickAxisY]})},e.prototype.dispose=function(){},e}();i.GAMEPAD=0,i.GENERIC=1,i.XBOX=2,i.POSE_ENABLED=3,e.Gamepad=i;var r=function(t){function r(r,n,o){var s=t.call(this,r,n,o)||this;return s.onButtonDownObservable=new e.Observable,s.onButtonUpObservable=new e.Observable,s.type=i.GENERIC,s._buttons=new Array(o.buttons.length),s}return o(r,t),r.prototype.onbuttondown=function(e){this._onbuttondown=e},r.prototype.onbuttonup=function(e){this._onbuttonup=e},r.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},r.prototype.update=function(){t.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._buttons[e]=this._setButtonValue(this.browserGamepad.buttons[e].value,this._buttons[e],e)},r.prototype.dispose=function(){t.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear()},r}(i);e.GenericPad=r}(r||(r={}));var r;!function(e){var t;!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(t=e.Xbox360Button||(e.Xbox360Button={}));var i;!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(i=e.Xbox360Dpad||(e.Xbox360Dpad={}));var r=function(r){function n(t,i,n,o){void 0===o&&(o=!1);var s=r.call(this,t,i,n,0,1,2,3)||this;return s._leftTrigger=0,s._rightTrigger=0,s.onButtonDownObservable=new e.Observable,s.onButtonUpObservable=new e.Observable,s.onPadDownObservable=new e.Observable,s.onPadUpObservable=new e.Observable,s._buttonA=0,s._buttonB=0,s._buttonX=0,s._buttonY=0,s._buttonBack=0,s._buttonStart=0,s._buttonLB=0,s._buttonRB=0,s._buttonLeftStick=0,s._buttonRightStick=0,s._dPadUp=0,s._dPadDown=0,s._dPadLeft=0,s._dPadRight=0,s._isXboxOnePad=!1,s.type=e.Gamepad.XBOX,s._isXboxOnePad=o,s}return o(n,r),n.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},n.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(n.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),this._rightTrigger=e},enumerable:!0,configurable:!0}),n.prototype.onbuttondown=function(e){this._onbuttondown=e},n.prototype.onbuttonup=function(e){this._onbuttonup=e},n.prototype.ondpaddown=function(e){this._ondpaddown=e},n.prototype.ondpadup=function(e){this._ondpadup=e},n.prototype._setButtonValue=function(e,t,i){return e!==t&&(1===e&&(this._onbuttondown&&this._onbuttondown(i),this.onButtonDownObservable.notifyObservers(i)),0===e&&(this._onbuttonup&&this._onbuttonup(i),this.onButtonUpObservable.notifyObservers(i))),e},n.prototype._setDPadValue=function(e,t,i){return e!==t&&(1===e&&(this._ondpaddown&&this._ondpaddown(i),this.onPadDownObservable.notifyObservers(i)),0===e&&(this._ondpadup&&this._ondpadup(i),this.onPadUpObservable.notifyObservers(i))),e},Object.defineProperty(n.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,t.A)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,t.B)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,t.X)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,t.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,t.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,t.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,t.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,t.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,t.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,t.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,i.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,i.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,i.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,i.Right)},enumerable:!0,configurable:!0}),n.prototype.update=function(){r.prototype.update.call(this),this._isXboxOnePad?(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.axes[2],this.rightTrigger=this.browserGamepad.axes[5],this.buttonBack=this.browserGamepad.buttons[9].value,this.buttonStart=this.browserGamepad.buttons[8].value,this.buttonLeftStick=this.browserGamepad.buttons[6].value,this.buttonRightStick=this.browserGamepad.buttons[7].value,this.dPadUp=this.browserGamepad.buttons[11].value,this.dPadDown=this.browserGamepad.buttons[12].value,this.dPadLeft=this.browserGamepad.buttons[13].value,this.dPadRight=this.browserGamepad.buttons[14].value):(this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value)},n.prototype.dispose=function(){r.prototype.dispose.call(this),this.onButtonDownObservable.clear(),this.onButtonUpObservable.clear(),this.onPadDownObservable.clear(),this.onPadUpObservable.clear()},n}(e.Gamepad);e.Xbox360Pad=r}(r||(r={}));var r;!function(e){var t;!function(e){e[e.VIVE=0]="VIVE",e[e.OCULUS=1]="OCULUS",e[e.WINDOWS=2]="WINDOWS",e[e.GENERIC=3]="GENERIC"}(t=e.PoseEnabledControllerType||(e.PoseEnabledControllerType={}));var i=function(){function t(){}return t.InitiateController=function(t){return-1!==t.id.indexOf("Oculus Touch")?new e.OculusTouchController(t):0===t.id.indexOf(e.WindowsMotionController.GAMEPAD_ID_PREFIX)?new e.WindowsMotionController(t):-1!==t.id.toLowerCase().indexOf("openvr")?new e.ViveController(t):new e.GenericController(t)},t}();e.PoseEnabledControllerHelper=i;var r=function(i){function r(r){var n=i.call(this,r.id,r.index,r)||this;return n._deviceRoomPosition=e.Vector3.Zero(),n._deviceRoomRotationQuaternion=new e.Quaternion,n.devicePosition=e.Vector3.Zero(),n.deviceRotationQuaternion=new e.Quaternion,n.deviceScaleFactor=1,n._leftHandSystemQuaternion=new e.Quaternion,n._deviceToWorld=e.Matrix.Identity(),n._workingMatrix=e.Matrix.Identity(),n.type=e.Gamepad.POSE_ENABLED,n.controllerType=t.GENERIC,n.position=e.Vector3.Zero(),n.rotationQuaternion=new e.Quaternion,n._calculatedPosition=e.Vector3.Zero(),n._calculatedRotation=new e.Quaternion,e.Quaternion.RotationYawPitchRollToRef(Math.PI,0,0,n._leftHandSystemQuaternion),n}return o(r,i),r.prototype.update=function(){i.prototype.update.call(this);var t=this.browserGamepad.pose;this.updateFromDevice(t),e.Vector3.TransformCoordinatesToRef(this._calculatedPosition,this._deviceToWorld,this.devicePosition),this._deviceToWorld.getRotationMatrixToRef(this._workingMatrix),e.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),this.deviceRotationQuaternion.multiplyInPlace(this._calculatedRotation),this._mesh&&(this._mesh.position.copyFrom(this.devicePosition),this._mesh.rotationQuaternion&&this._mesh.rotationQuaternion.copyFrom(this.deviceRotationQuaternion))},r.prototype.updateFromDevice=function(e){if(e){this.rawPose=e,e.position&&(this._deviceRoomPosition.copyFromFloats(e.position[0],e.position[1],-e.position[2]),this._mesh&&this._mesh.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1),this._deviceRoomPosition.scaleToRef(this.deviceScaleFactor,this._calculatedPosition),this._calculatedPosition.addInPlace(this.position));var t=this.rawPose;e.orientation&&t.orientation&&(this._deviceRoomRotationQuaternion.copyFromFloats(t.orientation[0],t.orientation[1],-t.orientation[2],-t.orientation[3]),this._mesh&&(this._mesh.getScene().useRightHandedSystem?(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1):this._deviceRoomRotationQuaternion.multiplyToRef(this._leftHandSystemQuaternion,this._deviceRoomRotationQuaternion)),this._deviceRoomRotationQuaternion.multiplyToRef(this.rotationQuaternion,this._calculatedRotation))}},r.prototype.attachToMesh=function(t){this._mesh&&(this._mesh.parent=null),this._mesh=t,this._poseControlledCamera&&(this._mesh.parent=this._poseControlledCamera),this._mesh.rotationQuaternion||(this._mesh.rotationQuaternion=new e.Quaternion)},r.prototype.attachToPoseControlledCamera=function(e){this._poseControlledCamera=e,this._mesh&&(this._mesh.parent=this._poseControlledCamera)},r.prototype.dispose=function(){this._mesh&&this._mesh.dispose(),this._mesh=null,i.prototype.dispose.call(this)},Object.defineProperty(r.prototype,"mesh",{get:function(){return this._mesh},enumerable:!0,configurable:!0}),r.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this.mesh)return new e.Ray(e.Vector3.Zero(),new e.Vector3(0,0,1),t);var i=this.mesh.getWorldMatrix(),r=i.getTranslation(),n=new e.Vector3(0,0,-1),o=e.Vector3.TransformNormal(n,i),s=e.Vector3.Normalize(o);return new e.Ray(r,s,t)},r}(e.Gamepad);e.PoseEnabledController=r}(r||(r={}));var r;!function(e){var t=function(t){function i(r){var n=t.call(this,r)||this;return n.onTriggerStateChangedObservable=new e.Observable,n.onMainButtonStateChangedObservable=new e.Observable,n.onSecondaryButtonStateChangedObservable=new e.Observable,n.onPadStateChangedObservable=new e.Observable,n.onPadValuesChangedObservable=new e.Observable,n.pad={x:0,y:0},n._changes={pressChanged:!1,touchChanged:!1,valueChanged:!1,changed:!1},n._buttons=new Array(r.buttons.length),n.hand=r.hand,n.hand||(n.hand=i.handCounter%2==0?"left":"right",i.handCounter++),n}return o(i,t),i.prototype.onButtonStateChange=function(e){this._onButtonStateChange=e},Object.defineProperty(i.prototype,"defaultModel",{get:function(){return this._defaultModel},enumerable:!0,configurable:!0}),i.prototype.update=function(){t.prototype.update.call(this);for(var e=0;e<this._buttons.length;e++)this._setButtonValue(this.browserGamepad.buttons[e],this._buttons[e],e);this.leftStick.x===this.pad.x&&this.leftStick.y===this.pad.y||(this.pad.x=this.leftStick.x,this.pad.y=this.leftStick.y,this.onPadValuesChangedObservable.notifyObservers(this.pad))},i.prototype._setButtonValue=function(e,t,i){if(e||(e={pressed:!1,touched:!1,value:0}),!t)return void(this._buttons[i]={pressed:e.pressed,touched:e.touched,value:e.value});this._checkChanges(e,t),this._changes.changed&&(this._onButtonStateChange&&this._onButtonStateChange(this.index,i,e),this.handleButtonChange(i,e,this._changes)),this._buttons[i].pressed=e.pressed,this._buttons[i].touched=e.touched,this._buttons[i].value=e.value<1e-8?0:e.value},i.prototype._checkChanges=function(e,t){return this._changes.pressChanged=e.pressed!==t.pressed,this._changes.touchChanged=e.touched!==t.touched,this._changes.valueChanged=e.value!==t.value,this._changes.changed=this._changes.pressChanged||this._changes.touchChanged||this._changes.valueChanged,this._changes},i.prototype.dispose=function(){t.prototype.dispose.call(this),this.onTriggerStateChangedObservable.clear(),this.onMainButtonStateChangedObservable.clear(),this.onSecondaryButtonStateChangedObservable.clear(),this.onPadStateChangedObservable.clear(),this.onPadValuesChangedObservable.clear()},i}(e.PoseEnabledController);t.handCounter=0,e.WebVRController=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.onSecondaryTriggerStateChangedObservable=new e.Observable,r.onThumbRestChangedObservable=new e.Observable,r.controllerType=e.PoseEnabledControllerType.OCULUS,r}return o(i,t),i.prototype.initControllerMesh=function(t,r){var n,o=this;n="left"===this.hand?i.MODEL_LEFT_FILENAME:i.MODEL_RIGHT_FILENAME,e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,n,t,function(e){o._defaultModel=e[1],o.attachToMesh(o._defaultModel),r&&r(o._defaultModel)})},Object.defineProperty(i.prototype,"onAButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No A button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onBButtonStateChangedObservable",{get:function(){if("right"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No B button on left hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onXButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onMainButtonStateChangedObservable;throw new Error("No X button on right hand")},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onYButtonStateChangedObservable",{get:function(){if("left"===this.hand)return this.onSecondaryButtonStateChangedObservable;throw new Error("No Y button on right hand")},enumerable:!0,configurable:!0}),i.prototype.handleButtonChange=function(e,t,i){var r=t,n="right"===this.hand?-1:1;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[3].rotation.x=.2*-r.value,this._defaultModel.getChildren()[3].position.y=.005*-r.value,this._defaultModel.getChildren()[3].position.z=.005*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return this._defaultModel&&(this._defaultModel.getChildren()[4].position.x=n*r.value*.0035),void this.onSecondaryTriggerStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[1].position.y=-.001:this._defaultModel.getChildren()[1].position.y=0),void this.onMainButtonStateChangedObservable.notifyObservers(r);case 4:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r);case 5:return void this.onThumbRestChangedObservable.notifyObservers(r)}},i}(e.WebVRController);t.MODEL_BASE_URL="https://controllers.babylonjs.com/oculus/",t.MODEL_LEFT_FILENAME="left.babylon",t.MODEL_RIGHT_FILENAME="right.babylon",e.OculusTouchController=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i){var r=t.call(this,i)||this;return r.controllerType=e.PoseEnabledControllerType.VIVE,r._invertLeftStickY=!0,r}return o(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,function(e){n._defaultModel=e[1],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)})},Object.defineProperty(i.prototype,"onLeftButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onRightButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),i.prototype.handleButtonChange=function(e,t,i){var r=t;switch(e){case 0:return void this.onPadStateChangedObservable.notifyObservers(r);case 1:return this._defaultModel&&(this._defaultModel.getChildren()[6].rotation.x=.15*-r.value),void this.onTriggerStateChangedObservable.notifyObservers(r);case 2:return void this.onMainButtonStateChangedObservable.notifyObservers(r);case 3:return this._defaultModel&&(r.pressed?this._defaultModel.getChildren()[2].position.y=-.001:this._defaultModel.getChildren()[2].position.y=0),void this.onSecondaryButtonStateChangedObservable.notifyObservers(r)}},i}(e.WebVRController);t.MODEL_BASE_URL="https://controllers.babylonjs.com/vive/",t.MODEL_FILENAME="wand.babylon",e.ViveController=t}(r||(r={}));var r;!function(e){var t=function(t){function i(e){return t.call(this,e)||this}return o(i,t),i.prototype.initControllerMesh=function(t,r){var n=this;e.SceneLoader.ImportMesh("",i.MODEL_BASE_URL,i.MODEL_FILENAME,t,function(e){n._defaultModel=e[1],n.attachToMesh(n._defaultModel),r&&r(n._defaultModel)})},i.prototype.handleButtonChange=function(e,t,i){console.log("Button id: "+e+"state: "),console.dir(t)},i}(e.WebVRController);t.MODEL_BASE_URL="https://controllers.babylonjs.com/generic/",t.MODEL_FILENAME="generic.babylon",e.GenericController=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.buttonMeshes={},this.axisMeshes={}}return e}(),i=function(i){function r(t){var r=i.call(this,t)||this;return r._mapping={buttons:["thumbstick","trigger","grip","menu","trackpad"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},buttonObservableNames:{trigger:"onTriggerStateChangedObservable",menu:"onSecondaryButtonStateChangedObservable",grip:"onMainButtonStateChangedObservable",thumbstick:"onPadStateChangedObservable",trackpad:"onTrackpadChangedObservable"},axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],pointingPoseMeshName:"POINTING_POSE"},r.onTrackpadChangedObservable=new e.Observable,r.onTrackpadValuesChangedObservable=new e.Observable,r.trackpad={x:0,y:0},r.controllerType=e.PoseEnabledControllerType.WINDOWS,r._loadedMeshInfo=null,r}return o(r,i),Object.defineProperty(r.prototype,"onTriggerButtonStateChangedObservable",{get:function(){return this.onTriggerStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onMenuButtonStateChangedObservable",{get:function(){return this.onSecondaryButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onGripButtonStateChangedObservable",{get:function(){return this.onMainButtonStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onThumbstickButtonStateChangedObservable",{get:function(){return this.onPadStateChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onTouchpadButtonStateChangedObservable",{get:function(){return this.onTrackpadChangedObservable},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"onTouchpadValuesChangedObservable",{get:function(){return this.onTrackpadValuesChangedObservable},enumerable:!0,configurable:!0}),r.prototype.update=function(){if(i.prototype.update.call(this),this._loadedMeshInfo&&this.browserGamepad.axes){this.browserGamepad.axes[2]==this.trackpad.x&&this.browserGamepad.axes[3]==this.trackpad.y||(this.trackpad.x=this.browserGamepad.axes[2],this.trackpad.y=this.browserGamepad.axes[3],this.onTrackpadValuesChangedObservable.notifyObservers(this.trackpad));for(var e=0;e<this._mapping.axisMeshNames.length;e++)this.lerpAxisTransform(e,this.browserGamepad.axes[e])}},r.prototype.handleButtonChange=function(e,t,i){var r=this._mapping.buttons[e];if(r){var n=this[this._mapping.buttonObservableNames[r]];n&&n.notifyObservers(t),this.lerpButtonTransform(r,t.value)}},r.prototype.lerpButtonTransform=function(t,i){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.buttonMeshes[t];r.unpressed.rotationQuaternion&&r.pressed.rotationQuaternion&&r.value.rotationQuaternion&&(e.Quaternion.SlerpToRef(r.unpressed.rotationQuaternion,r.pressed.rotationQuaternion,i,r.value.rotationQuaternion),e.Vector3.LerpToRef(r.unpressed.position,r.pressed.position,i,r.value.position))}},r.prototype.lerpAxisTransform=function(t,i){if(this._loadedMeshInfo){var r=this._loadedMeshInfo.axisMeshes[t];if(r&&r.min.rotationQuaternion&&r.max.rotationQuaternion&&r.value.rotationQuaternion){var n=.5*i+.5;e.Quaternion.SlerpToRef(r.min.rotationQuaternion,r.max.rotationQuaternion,n,r.value.rotationQuaternion),e.Vector3.LerpToRef(r.min.position,r.max.position,n,r.value.position)}}},r.prototype.initControllerMesh=function(t,i,n){var o=this;void 0===n&&(n=!1);var s,a;if(e.SceneLoader.GetPluginForExtension("glb")){var l="default";if(this.id&&!n){var h=this.id.match(r.GAMEPAD_ID_PATTERN);l=h&&h[0]||l}a="left"===this.hand?r.MODEL_LEFT_FILENAME:r.MODEL_RIGHT_FILENAME,s=r.MODEL_BASE_URL+l+"/"}else e.Tools.Warn("You need to reference GLTF loader to load Windows Motion Controllers model. Falling back to generic models"),s=e.GenericController.MODEL_BASE_URL,a=e.GenericController.MODEL_FILENAME;e.SceneLoader.ImportMesh("",s,a,t,function(e){o._loadedMeshInfo=o.processModel(t,e),o._loadedMeshInfo&&(o._defaultModel=o._loadedMeshInfo.rootNode,o.attachToMesh(o._defaultModel),i&&i(o._defaultModel))},null,function(t,r){e.Tools.Log(r),e.Tools.Warn("Failed to retrieve controller model from the remote server: "+s+a),n||o.initControllerMesh(t,i,!0)})},r.prototype.processModel=function(t,i){for(var r=null,n=new e.Mesh(this.id+" "+this.hand,t),o=null,s=0;s<i.length;s++){var a=i[s];if(!a.parent){a.isPickable=!1,o=a;break}}return o?(o.setParent(n),r=this.createMeshInfo(n)):e.Tools.Warn("Could not find root node in model file."),r},r.prototype.createMeshInfo=function(i){function r(e,t){return e.getChildMeshes(!1,function(e){return e.name===t})[0]}function n(e,t){return e.getChildMeshes(!0,function(e){return e.name==t})[0]}var o,s=new t;for(s.rootNode=i,s.buttonMeshes={},s.axisMeshes={},o=0;o<this._mapping.buttons.length;o++){var a=this._mapping.buttonMeshNames[this._mapping.buttons[o]];if(a){var l=r(i,a);if(l){var h={index:o,value:n(l,"VALUE"),pressed:n(l,"PRESSED"),unpressed:n(l,"UNPRESSED")};h.value&&h.pressed&&h.unpressed?s.buttonMeshes[this._mapping.buttons[o]]=h:e.Tools.Warn("Missing button submesh under mesh with name: "+a+"(VALUE: "+!!h.value+", PRESSED: "+!!h.pressed+", UNPRESSED:"+!!h.unpressed+")")}else e.Tools.Warn("Missing button mesh with name: "+a)}else e.Tools.Log("Skipping unknown button at index: "+o+" with mapped name: "+this._mapping.buttons[o])}for(o=0;o<this._mapping.axisMeshNames.length;o++){var c=this._mapping.axisMeshNames[o];if(c){var u=r(i,c);if(u){var f={index:o,value:n(u,"VALUE"),min:n(u,"MIN"),max:n(u,"MAX")};f.value&&f.min&&f.max?s.axisMeshes[o]=f:e.Tools.Warn("Missing axis submesh under mesh with name: "+c+"(VALUE: "+!!f.value+", MIN: "+!!f.min+", MAX:"+!!f.max+")")}else e.Tools.Warn("Missing axis mesh with name: "+c)}else e.Tools.Log("Skipping unknown axis at index: "+o)}return s.pointingPoseNode=r(i,this._mapping.pointingPoseMeshName),s.pointingPoseNode||e.Tools.Warn("Missing pointing pose mesh with name: "+this._mapping.pointingPoseMeshName),s},r.prototype.getForwardRay=function(t){if(void 0===t&&(t=100),!this._loadedMeshInfo||!this._loadedMeshInfo.pointingPoseNode)return i.prototype.getForwardRay.call(this,t);var r=this._loadedMeshInfo.pointingPoseNode.getWorldMatrix(),n=r.getTranslation(),o=new e.Vector3(0,0,-1),s=e.Vector3.TransformNormal(o,r),a=e.Vector3.Normalize(s);return new e.Ray(n,a,t)},r.prototype.dispose=function(){i.prototype.dispose.call(this),this.onTrackpadChangedObservable.clear()},r}(e.WebVRController);i.MODEL_BASE_URL="https://controllers.babylonjs.com/microsoft/",i.MODEL_LEFT_FILENAME="left.glb",i.MODEL_RIGHT_FILENAME="right.glb",i.GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",i.GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/,e.WindowsMotionController=i}(r||(r={}));var r;!function(e){var t=function(t){function i(e,i,r,n){void 0===n&&(n=null);var o=t.call(this,e,i,r)||this;return o.radius=12,o.rotationOffset=0,o.heightOffset=4,o.cameraAcceleration=.05,o.maxCameraSpeed=20,o.lockedTarget=n,o}return o(i,t),i.prototype.getRadians=function(e){return e*Math.PI/180},i.prototype.follow=function(t){if(t){var i;if(t.rotationQuaternion){var r=new e.Matrix;t.rotationQuaternion.toRotationMatrix(r),i=Math.atan2(r.m[8],r.m[10])}else i=t.rotation.y;var n=this.getRadians(this.rotationOffset)+i,o=t.getAbsolutePosition(),s=o.x+Math.sin(n)*this.radius,a=o.z+Math.cos(n)*this.radius,l=s-this.position.x,h=o.y+this.heightOffset-this.position.y,c=a-this.position.z,u=l*this.cameraAcceleration*2,f=h*this.cameraAcceleration,d=c*this.cameraAcceleration*2;(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=u<1?-this.maxCameraSpeed:this.maxCameraSpeed),(f>this.maxCameraSpeed||f<-this.maxCameraSpeed)&&(f=f<1?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=d<1?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+u,this.position.y+f,this.position.z+d),this.setTarget(o)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.lockedTarget&&this.follow(this.lockedTarget)},i.prototype.getClassName=function(){return"FollowCamera"},i}(e.TargetCamera);n([e.serialize()],t.prototype,"radius",void 0),n([e.serialize()],t.prototype,"rotationOffset",void 0),n([e.serialize()],t.prototype,"heightOffset",void 0),n([e.serialize()],t.prototype,"cameraAcceleration",void 0),n([e.serialize()],t.prototype,"maxCameraSpeed",void 0),n([e.serializeAsMeshReference("lockedTargetId")],t.prototype,"lockedTarget",void 0),e.FollowCamera=t;var i=function(t){function i(i,r,n,o,s,a){var l=t.call(this,i,e.Vector3.Zero(),a)||this;return l.alpha=r,l.beta=n,l.radius=o,l.target=s,l._cartesianCoordinates=e.Vector3.Zero(),l.follow(),l}return o(i,t),i.prototype.follow=function(){if(this.target){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta);var e=this.target.getAbsolutePosition();this.position=e.add(this._cartesianCoordinates),this.setTarget(e)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow()},i.prototype.getClassName=function(){return"ArcFollowCamera"},i}(e.TargetCamera);e.ArcFollowCamera=i}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addGamepad(),n}return o(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"UniversalCamera"},t}(e.TouchCamera);e.UniversalCamera=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r){return e.call(this,t,i,r)||this}return o(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"GamepadCamera"},t}(e.UniversalCamera);e.GamepadCamera=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._renderPipelines={}}return e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,i){void 0===i&&(i=!1);var r=this._renderPipelines[e];r&&r._attachCameras(t,i)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var i=this._renderPipelines[e];i&&i._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,i){var r=this._renderPipelines[e];r&&r._enableEffect(t,i)},e.prototype.disableEffectInPipeline=function(e,t,i){var r=this._renderPipelines[e];r&&r._disableEffect(t,i)},e.prototype.enableDisplayOnlyPassInPipeline=function(e,t,i){var r=this._renderPipelines[e];r&&r._enableDisplayOnlyPass(t,i)},e.prototype.disableDisplayOnlyPassInPipeline=function(e,t){var i=this._renderPipelines[e];i&&i._disableDisplayOnlyPass(t)},e.prototype.update=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[e];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[e])}},e.prototype._rebuild=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[e];t._rebuild()}},e.prototype.dispose=function(){for(var e in this._renderPipelines)if(this._renderPipelines.hasOwnProperty(e)){var t=this._renderPipelines[e];t.dispose()}},e}();e.PostProcessRenderPipelineManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o,s){this._refCount=0,this._name=i,this._renderTexture=new e.RenderTargetTexture(i,r,t),this.setRenderList(n),this._renderTexture.onBeforeRenderObservable.add(o),this._renderTexture.onAfterRenderObservable.add(s),this._scene=t,this._renderList=n}return t.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},t.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},t.prototype._update=function(){this.setRenderList(this._renderList)},t.prototype.setRenderList=function(e){this._renderTexture.renderList=e},t.prototype.getRenderTexture=function(){return this._renderTexture},t}();e.PostProcessRenderPass=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i,r){this._name=t,this._singleInstance=r||!0,this._getPostProcess=i,this._cameras={},this._indicesForCamera={},this._postProcesses={},this._renderPasses={},this._renderEffectAsPasses={}}return Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(!this._postProcesses[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._update=function(){for(var e in this._renderPasses)this._renderPasses[e]._update()},t.prototype.addPass=function(e){this._renderPasses[e._name]=e,this._linkParameters()},t.prototype.removePass=function(e){delete this._renderPasses[e._name],this._linkParameters()},t.prototype.addRenderEffectAsPass=function(e){this._renderEffectAsPasses[e._name]=e,this._linkParameters()},t.prototype.getPass=function(e){for(var t in this._renderPasses)if(t===e)return this._renderPasses[e];return null},t.prototype.emptyPasses=function(){this._renderPasses={},this._linkParameters()},t.prototype._attachCameras=function(t){var i,r=e.Tools.MakeArray(t||this._cameras);if(r){for(var n=0;n<r.length;n++){var o=r[n],s=o.name;i=this._singleInstance?0:s,this._postProcesses[i]=this._postProcesses[i]||this._getPostProcess();var a=o.attachPostProcess(this._postProcesses[i]);this._indicesForCamera[s]||(this._indicesForCamera[s]=[]),this._indicesForCamera[s].push(a),this._cameras[s]||(this._cameras[s]=o);for(var l in this._renderPasses)this._renderPasses[l]._incRefCount()}this._linkParameters()}},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i)for(var r=0;r<i.length;r++){var n=i[r],o=n.name;n.detachPostProcess(this._postProcesses[this._singleInstance?0:o]),this._cameras[o]&&(this._cameras[o]=null);for(var s in this._renderPasses)this._renderPasses[s]._decRefCount()}},t.prototype._enable=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i)for(var r=0;r<i.length;r++){for(var n=i[r],o=n.name,s=0;s<this._indicesForCamera[o].length;s++)void 0===n._postProcesses[this._indicesForCamera[o][s]]&&t[r].attachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o][s]);for(var a in this._renderPasses)this._renderPasses[a]._incRefCount()}},t.prototype._disable=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i)for(var r=0;r<i.length;r++){var n=i[r],o=n.Name;n.detachPostProcess(this._postProcesses[this._singleInstance?0:o]);for(var s in this._renderPasses)this._renderPasses[s]._decRefCount()}},t.prototype.getPostProcess=function(e){return this._singleInstance?this._postProcesses[0]:e?this._postProcesses[e.name]:null},t.prototype._linkParameters=function(){var e=this;for(var t in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[t]),this._postProcesses[t].onBeforeRenderObservable.add(function(t){e._linkTextures(t)})},t.prototype._linkTextures=function(e){for(var t in this._renderPasses)e.setTexture(t,this._renderPasses[t].getRenderTexture());for(var i in this._renderEffectAsPasses)e.setTextureFromPostProcess(i+"Sampler",this._renderEffectAsPasses[i].getPostProcess())},t}();e.PostProcessRenderEffect=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){this._engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass=new Array,this._cameras=[]}return t.prototype.getClassName=function(){return"PostProcessRenderPipeline"},Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(this._renderEffects.hasOwnProperty(e)&&!this._renderEffects[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype.addEffect=function(e){this._renderEffects[e._name]=e},t.prototype._rebuild=function(){},t.prototype._enableEffect=function(t,i){var r=this._renderEffects[t];r&&r._enable(e.Tools.MakeArray(i||this._cameras))},t.prototype._disableEffect=function(t,i){var r=this._renderEffects[t];r&&r._disable(e.Tools.MakeArray(i||this._cameras))},t.prototype._attachCameras=function(t,i){var r=e.Tools.MakeArray(t||this._cameras);if(r){var n,o=[];for(n=0;n<r.length;n++){var s=r[n],a=s.name;-1===this._cameras.indexOf(s)?this._cameras[a]=s:i&&o.push(n)}for(n=0;n<o.length;n++)t.splice(o[n],1);for(var l in this._renderEffects)this._renderEffects.hasOwnProperty(l)&&this._renderEffects[l]._attachCameras(r)}},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);if(i){for(var r in this._renderEffects)this._renderEffects.hasOwnProperty(r)&&this._renderEffects[r]._detachCameras(i);for(var n=0;n<i.length;n++)this._cameras.splice(this._cameras.indexOf(i[n]),1)}},t.prototype._enableDisplayOnlyPass=function(i,r){var n=this,o=e.Tools.MakeArray(r||this._cameras);if(o){var s,a=null;for(s in this._renderEffects)if(this._renderEffects.hasOwnProperty(s)&&null!=(a=this._renderEffects[s].getPass(i)))break;if(null!==a){for(s in this._renderEffects)this._renderEffects.hasOwnProperty(s)&&this._renderEffects[s]._disable(o);a._name=t.PASS_SAMPLER_NAME;for(var l=0;l<o.length;l++){var h=o[l],c=h.name;this._renderEffectsForIsolatedPass[c]=this._renderEffectsForIsolatedPass[c]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,void 0,n._engine,!0)}),this._renderEffectsForIsolatedPass[c].emptyPasses(),this._renderEffectsForIsolatedPass[c].addPass(a),this._renderEffectsForIsolatedPass[c]._attachCameras(h)}}}},t.prototype._disableDisplayOnlyPass=function(i){var r=this,n=e.Tools.MakeArray(i||this._cameras);if(n){for(var o=0;o<n.length;o++){var s=n[o],a=s.name;this._renderEffectsForIsolatedPass[a]=this._renderEffectsForIsolatedPass[a]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,void 0,r._engine,!0)}),this._renderEffectsForIsolatedPass[a]._disable(s)}for(var l in this._renderEffects)this._renderEffects.hasOwnProperty(l)&&this._renderEffects[l]._enable(n)}},t.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects.hasOwnProperty(e)&&this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t].name;this._renderEffectsForIsolatedPass[i]&&this._renderEffectsForIsolatedPass[i]._update()}},t.prototype._reset=function(){this._renderEffects={},this._renderEffectsForIsolatedPass=new Array},t.prototype.dispose=function(){},t}();t.PASS_EFFECT_NAME="passEffect",t.PASS_SAMPLER_NAME="passSampler",n([e.serialize()],t.prototype,"_name",void 0),e.PostProcessRenderPipeline=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT);var r=this;this._scene=t;var n=t.getEngine();this._depthMap=new e.RenderTargetTexture("depthMap",{width:n.getRenderWidth(),height:n.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClearObservable.add(function(t){t.clear(new e.Color4(1,1,1,1),!0,!0,!0)});var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine(),s=t.getMaterial();if(s){o.setState(s.backFaceCulling,0,!1,n.useRightHandedSystem);var a=i._getInstancesRenderList(t._id);if(!a.mustReturn){var l=o.getCaps().instancedArrays&&null!==a.visibleInstances[t._id];if(r.isReady(t,l)&&n.activeCamera){if(o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode),r._effect.setMatrix("viewProjection",n.getTransformMatrix()),r._effect.setFloat2("depthValues",n.activeCamera.minZ,n.activeCamera.minZ+n.activeCamera.maxZ),s&&s.needAlphaTesting()){var h=s.getAlphaTestTexture();h&&(r._effect.setTexture("diffuseSampler",h),r._effect.setMatrix("diffuseMatrix",h.getTextureMatrix()))}i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&r._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),i._processRendering(t,r._effect,e.Material.TriangleFillMode,a,l,function(e,t){return r._effect.setMatrix("world",t)})}}}};this._depthMap.customRenderFunction=function(e,t,i,r){var s;if(r.length){for(n.setColorWrite(!1),s=0;s<r.length;s++)o(r.data[s]);n.setColorWrite(!0)}for(s=0;s<e.length;s++)o(e.data[s]);for(s=0;s<t.length;s++)o(t.data[s])}}return t.prototype.isReady=function(t,i){var r=t.getMaterial();if(r.disableDepthWrite)return!1;var n=[],o=[e.VertexBuffer.PositionKind],s=t.getMesh();r&&r.needAlphaTesting()&&(n.push("#define ALPHATEST"),s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push("#define UV1")),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),s.useBones&&s.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(o.push(e.VertexBuffer.MatricesIndicesExtraKind),o.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),n.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("depth",o,["world","mBones","viewProjection","diffuseMatrix","depthValues"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,r.getEngine(),i)||this;s.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",s.SSAORenderEffect="SSAORenderEffect",s.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",s.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",s.SSAOCombineRenderEffect="SSAOCombineRenderEffect",s.totalStrength=1,s.radius=1e-4,s.area=.0075,s.fallOff=1e-6,s.base=.5,s._firstUpdate=!0,s._scene=r,s._createRandomTexture(),s._depthTexture=r.enableDepthRenderer().getDepthMap();var a=n.ssaoRatio||n,l=n.combineRatio||n;return s._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",l,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),s._createSSAOPostProcess(a),s._createBlurPostProcess(a),s._createSSAOCombinePostProcess(l),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(s),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o),s}return o(i,t),i.prototype.dispose=function(e){void 0===e&&(e=!1);for(var i=0;i<this._scene.cameras.length;i++){var r=this._scene.cameras[i];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),t.prototype.dispose.call(this)},i.prototype._createBlurPostProcess=function(t){var i=this;this._blurHPostProcess=new e.BlurPostProcess("BlurH",new e.Vector2(1,0),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurVPostProcess=new e.BlurPostProcess("BlurV",new e.Vector2(0,1),16,t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurHPostProcess.onActivateObservable.add(function(){var e=i._blurHPostProcess.width/i._scene.getEngine().getRenderWidth();i._blurHPostProcess.kernel=16*e}),this._blurVPostProcess.onActivateObservable.add(function(){var e=i._blurVPostProcess.height/i._scene.getEngine().getRenderHeight();i._blurVPostProcess.kernel=16*e})},i.prototype._rebuild=function(){this._firstUpdate=!0,t.prototype._rebuild.call(this)},i.prototype._createSSAOPostProcess=function(t){var i=this,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271];this._ssaoPostProcess=new e.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES 16\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3("sampleSphere",r),e.setFloat("samplesFactor",1/16),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",i.totalStrength),e.setFloat("radius",i.radius),e.setFloat("area",i.area),e.setFloat("fallOff",i.fallOff),e.setFloat("base",i.base),e.setTexture("textureSampler",i._depthTexture),e.setTexture("randomSampler",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess("originalColor",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){this._randomTexture=new e.DynamicTexture("SSAORandomTexture",512,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t=this._randomTexture.getContext(),i=function(e,t){return Math.random()*(t-e)+e},r=e.Vector3.Zero(),n=0;n<512;n++)for(var o=0;o<512;o++)r.x=Math.floor(255*i(-1,1)),r.y=Math.floor(255*i(-1,1)),r.z=Math.floor(255*i(-1,1)),t.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",t.fillRect(n,o,1,1);this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);n([e.serialize()],t.prototype,"totalStrength",void 0),n([e.serialize()],t.prototype,"radius",void 0),n([e.serialize()],t.prototype,"area",void 0),n([e.serialize()],t.prototype,"fallOff",void 0),n([e.serialize()],t.prototype,"base",void 0),e.SSAORenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,r.getEngine(),i)||this;if(s.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",s.SSAORenderEffect="SSAORenderEffect",s.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",s.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",s.SSAOCombineRenderEffect="SSAOCombineRenderEffect",s.totalStrength=1,s.maxZ=100,s.minZAspect=.2,s._samples=8,s._expensiveBlur=!0,s.radius=2,s.base=.1,s._firstUpdate=!0,s._scene=r,!s.isSupported)return e.Tools.Error("SSAO 2 needs WebGL 2 support."),s;var a=n.ssaoRatio||n,l=n.blurRatio||n,h=r.enableGeometryBufferRenderer();return s._createRandomTexture(),s._depthTexture=h.getGBuffer().textures[0],s._normalTexture=h.getGBuffer().textures[1],s._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",1,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1),s._createSSAOPostProcess(1),s._createBlurPostProcess(a,l),s._createSSAOCombinePostProcess(l),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),s.addEffect(new e.PostProcessRenderEffect(r.getEngine(),s.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(s),o&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o),s}return o(i,t),Object.defineProperty(i.prototype,"samples",{get:function(){return this._samples},set:function(e){this._ssaoPostProcess.updateEffect("#define SAMPLES "+e+"\n#define SSAO"),this._samples=e,this._sampleSphere=this._generateHemisphere(),this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"expensiveBlur",{get:function(){return this._expensiveBlur},set:function(e){this._blurHPostProcess.updateEffect("#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._blurVPostProcess.updateEffect("#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE "+(e?"1":"0")+"\n",null,["textureSampler","depthSampler"]),this._expensiveBlur=e,this._firstUpdate=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsSupported",{get:function(){var t=e.Engine.LastCreatedEngine;return!!t&&t.getCaps().drawBuffersExtension},enumerable:!0,configurable:!0}),i.prototype.dispose=function(e){void 0===e&&(e=!1);for(var i=0;i<this._scene.cameras.length;i++){var r=this._scene.cameras[i];this._originalColorPostProcess.dispose(r),this._ssaoPostProcess.dispose(r),this._blurHPostProcess.dispose(r),this._blurVPostProcess.dispose(r),this._ssaoCombinePostProcess.dispose(r)}this._randomTexture.dispose(),e&&this._scene.disableGeometryBufferRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),t.prototype.dispose.call(this)},i.prototype._createBlurPostProcess=function(t,i){var r=this;this._samplerOffsets=[];for(var n=this.expensiveBlur,o=-8;o<8;o++)this._samplerOffsets.push(2*o+.5);this._blurHPostProcess=new e.PostProcess("BlurH","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE "+(n?"1":"0")+"\n"),this._blurHPostProcess.onApply=function(e){r._scene.activeCamera&&(e.setFloat("outSize",r._ssaoCombinePostProcess.width>0?r._ssaoCombinePostProcess.width:r._originalColorPostProcess.width),e.setFloat("near",r._scene.activeCamera.minZ),e.setFloat("far",r._scene.activeCamera.maxZ),e.setFloat("radius",r.radius),e.setTexture("depthSampler",r._depthTexture),r._firstUpdate&&e.setArray("samplerOffsets",r._samplerOffsets))},this._blurVPostProcess=new e.PostProcess("BlurV","ssao2",["outSize","samplerOffsets","near","far","radius"],["depthSampler"],i,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE "+(n?"1":"0")+"\n"),this._blurVPostProcess.onApply=function(e){r._scene.activeCamera&&(e.setFloat("outSize",r._ssaoCombinePostProcess.height>0?r._ssaoCombinePostProcess.height:r._originalColorPostProcess.height),e.setFloat("near",r._scene.activeCamera.minZ),e.setFloat("far",r._scene.activeCamera.maxZ),e.setFloat("radius",r.radius),e.setTexture("depthSampler",r._depthTexture),r._firstUpdate&&(e.setArray("samplerOffsets",r._samplerOffsets),r._firstUpdate=!1))}},i.prototype._rebuild=function(){this._firstUpdate=!0,t.prototype._rebuild.call(this)},i.prototype._generateHemisphere=function(){for(var t,i,r=this.samples,n=[],o=function(e,t){return Math.random()*(t-e)+e},s=0;s<r;)t=new e.Vector3(o(-1,1),o(-1,1),o(.3,1)),t.normalize(),i=s/r,i=e.Scalar.Lerp(.1,1,i*i),t.scaleInPlace(i),n.push(t.x,t.y,t.z),s++;return n},i.prototype._createSSAOPostProcess=function(t){var i=this,r=this.samples;this._sampleSphere=this._generateHemisphere(),this._ssaoPostProcess=new e.PostProcess("ssao2","ssao2",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","base","range","projection","near","far","texelSize","xViewport","yViewport","maxZ","minZAspect"],["randomSampler","normalSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+r+"\n#define SSAO"),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3("sampleSphere",i._sampleSphere),e.setFloat("randTextureTiles",4)),i._scene.activeCamera&&(e.setFloat("samplesFactor",1/i.samples),e.setFloat("totalStrength",i.totalStrength),e.setFloat2("texelSize",1/i._ssaoPostProcess.width,1/i._ssaoPostProcess.height),e.setFloat("radius",i.radius),e.setFloat("maxZ",i.maxZ),e.setFloat("minZAspect",i.minZAspect),e.setFloat("base",i.base),e.setFloat("near",i._scene.activeCamera.minZ),e.setFloat("far",i._scene.activeCamera.maxZ),e.setFloat("xViewport",Math.tan(i._scene.activeCamera.fov/2)*i._scene.getEngine().getAspectRatio(i._scene.activeCamera,!0)),e.setFloat("yViewport",Math.tan(i._scene.activeCamera.fov/2)),e.setMatrix("projection",i._scene.getProjectionMatrix()),e.setTexture("textureSampler",i._depthTexture),e.setTexture("normalSampler",i._normalTexture),e.setTexture("randomSampler",i._randomTexture))}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess("originalColor",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){this._randomTexture=new e.DynamicTexture("SSAORandomTexture",512,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t=this._randomTexture.getContext(),i=function(e,t){return Math.random()*(t-e)+e},r=e.Vector3.Zero(),n=0;n<512;n++)for(var o=0;o<512;o++)r.x=i(0,1),r.y=i(0,1),r.z=0,r.normalize(),r.scaleInPlace(255),r.x=Math.floor(r.x),r.y=Math.floor(r.y),t.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",t.fillRect(n,o,1,1);this._randomTexture.update(!1)},i}(e.PostProcessRenderPipeline);n([e.serialize()],t.prototype,"totalStrength",void 0),n([e.serialize()],t.prototype,"maxZ",void 0),n([e.serialize()],t.prototype,"minZAspect",void 0),n([e.serialize("samples")],t.prototype,"_samples",void 0),n([e.serialize("expensiveBlur")],t.prototype,"_expensiveBlur",void 0),n([e.serialize()],t.prototype,"radius",void 0),n([e.serialize()],t.prototype,"base",void 0),e.SSAO2RenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s){void 0===o&&(o=1);var a=t.call(this,n.getEngine(),i)||this;return a.LensChromaticAberrationEffect="LensChromaticAberrationEffect",a.HighlightsEnhancingEffect="HighlightsEnhancingEffect",a.LensDepthOfFieldEffect="LensDepthOfFieldEffect",a._scene=n,a._depthTexture=n.enableDepthRenderer().getDepthMap(),r.grain_texture?a._grainTexture=r.grain_texture:a._createGrainTexture(),a._edgeBlur=r.edge_blur?r.edge_blur:0,a._grainAmount=r.grain_amount?r.grain_amount:0,a._chromaticAberration=r.chromatic_aberration?r.chromatic_aberration:0,a._distortion=r.distortion?r.distortion:0,a._highlightsGain=void 0!==r.dof_gain?r.dof_gain:-1,a._highlightsThreshold=r.dof_threshold?r.dof_threshold:1,a._dofDistance=void 0!==r.dof_focus_distance?r.dof_focus_distance:-1,a._dofAperture=r.dof_aperture?r.dof_aperture:1,a._dofDarken=r.dof_darken?r.dof_darken:0,a._dofPentagon=void 0===r.dof_pentagon||r.dof_pentagon,a._blurNoise=void 0===r.blur_noise||r.blur_noise,a._createChromaticAberrationPostProcess(o),a._createHighlightsPostProcess(o),a._createDepthOfFieldPostProcess(o/4),a.addEffect(new e.PostProcessRenderEffect(n.getEngine(),a.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),a.addEffect(new e.PostProcessRenderEffect(n.getEngine(),a.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),a.addEffect(new e.PostProcessRenderEffect(n.getEngine(),a.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1===a._highlightsGain&&a._disableEffect(a.HighlightsEnhancingEffect,null),n.postProcessRenderPipelineManager.addPipeline(a),s&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s),a}return o(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},i.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=null,this._highlightsPostProcess=null,this._depthOfFieldPostProcess=null,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",i._chromaticAberration),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight())}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",i._highlightsGain),e.setFloat("threshold",i._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",i._chromaticAberrationPostProcess),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight())}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",i._depthTexture),e.setTexture("grainSampler",i._grainTexture),e.setTextureFromPostProcess("textureSampler",i._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",i._depthOfFieldPostProcess),e.setFloat("grain_amount",i._grainAmount),e.setBool("blur_noise",i._blurNoise),e.setFloat("screen_width",i._scene.getEngine().getRenderWidth()),e.setFloat("screen_height",i._scene.getEngine().getRenderHeight()),e.setFloat("distortion",i._distortion),e.setBool("dof_enabled",-1!==i._dofDistance),e.setFloat("screen_distance",1/(.1-1/i._dofDistance)),e.setFloat("aperture",i._dofAperture),e.setFloat("darken",i._dofDarken),e.setFloat("edge_blur",i._edgeBlur),e.setBool("highlights",-1!==i._highlightsGain),i._scene.activeCamera&&(e.setFloat("near",i._scene.activeCamera.minZ),e.setFloat("far",i._scene.activeCamera.maxZ))}},i.prototype._createGrainTexture=function(){this._grainTexture=new e.DynamicTexture("LensNoiseTexture",512,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var t,i=this._grainTexture.getContext(),r=0;r<512;r++)for(var n=0;n<512;n++)t=Math.floor(255*function(e,t){return Math.random()*(t-e)+e}(.42,.58)),i.fillStyle="rgb("+t+", "+t+", "+t+")",i.fillRect(r,n,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s){void 0===o&&(o=null);var a=t.call(this,r.getEngine(),i)||this;return a.downSampleX4PostProcess=null,a.brightPassPostProcess=null,a.blurHPostProcesses=[],a.blurVPostProcesses=[],a.textureAdderPostProcess=null,a.volumetricLightPostProcess=null,a.volumetricLightSmoothXPostProcess=null,a.volumetricLightSmoothYPostProcess=null,a.volumetricLightMergePostProces=null,a.volumetricLightFinalPostProcess=null,a.luminancePostProcess=null,a.luminanceDownSamplePostProcesses=[],a.hdrPostProcess=null,a.textureAdderFinalPostProcess=null,a.lensFlareFinalPostProcess=null,a.hdrFinalPostProcess=null,a.lensFlarePostProcess=null,a.lensFlareComposePostProcess=null,a.motionBlurPostProcess=null,a.depthOfFieldPostProcess=null,a.brightThreshold=1,a.blurWidth=512,a.horizontalBlur=!1,a.exposure=1,a.lensTexture=null,a.volumetricLightCoefficient=.2,a.volumetricLightPower=4,a.volumetricLightBlurScale=64,a.sourceLight=null,a.hdrMinimumLuminance=1,a.hdrDecreaseRate=.5,a.hdrIncreaseRate=.5,a.lensColorTexture=null,a.lensFlareStrength=20,a.lensFlareGhostDispersal=1.4,a.lensFlareHaloWidth=.7,a.lensFlareDistortionStrength=16,a.lensStarTexture=null,a.lensFlareDirtTexture=null,a.depthOfFieldDistance=10,a.depthOfFieldBlurWidth=64,a.motionStrength=1,a.animations=[],a._currentDepthOfFieldSource=null,a._hdrCurrentLuminance=1,a._bloomEnabled=!0,a._depthOfFieldEnabled=!1,a._vlsEnabled=!1,a._lensFlareEnabled=!1,a._hdrEnabled=!1,a._motionBlurEnabled=!1,a._motionBlurSamples=64,a._volumetricLightStepsCount=50,a._cameras=s||[],a._scene=r,a._basePostProcess=o,a._ratio=n,a._floatTextureType=r.getEngine().getCaps().textureFloatRender?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_HALF_FLOAT,r.postProcessRenderPipelineManager.addPipeline(a),a._buildPipeline(),a}return o(i,t),Object.defineProperty(i.prototype,"BloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"DepthOfFieldEnabled",{get:function(){return this._depthOfFieldEnabled},set:function(e){this._depthOfFieldEnabled!==e&&(this._depthOfFieldEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"LensFlareEnabled",{get:function(){return this._lensFlareEnabled},set:function(e){this._lensFlareEnabled!==e&&(this._lensFlareEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"HDREnabled",{get:function(){return this._hdrEnabled},set:function(e){this._hdrEnabled!==e&&(this._hdrEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"VLSEnabled",{get:function(){return this._vlsEnabled},set:function(t){if(this._vlsEnabled!==t){if(t){if(!this._scene.enableGeometryBufferRenderer())return void e.Tools.Warn("Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline")}this._vlsEnabled=t,this._buildPipeline()}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"MotionBlurEnabled",{get:function(){return this._motionBlurEnabled},set:function(e){this._motionBlurEnabled!==e&&(this._motionBlurEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"volumetricLightStepsCount",{get:function(){return this._volumetricLightStepsCount},set:function(e){this.volumetricLightPostProcess&&this.volumetricLightPostProcess.updateEffect("#define VLS\n#define NB_STEPS "+e.toFixed(1)),this._volumetricLightStepsCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"motionBlurSamples",{get:function(){return this._motionBlurSamples},set:function(e){this.motionBlurPostProcess&&this.motionBlurPostProcess.updateEffect("#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+e.toFixed(1)),this._motionBlurSamples=e},enumerable:!0,configurable:!0}),i.prototype._buildPipeline=function(){var t=this,i=this._ratio,r=this._scene;this._disposePostProcesses(),this._reset(),this._basePostProcess?this.originalPostProcess=this._basePostProcess:(this.originalPostProcess=new e.PostProcess("HDRPass","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",this._floatTextureType),this.originalPostProcess.onApply=function(e){t._currentDepthOfFieldSource=t.originalPostProcess}),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPassPostProcess",function(){return t.originalPostProcess},!0)),this._currentDepthOfFieldSource=this.originalPostProcess,this._vlsEnabled&&(this._createVolumetricLightPostProcess(r,i),this.volumetricLightFinalPostProcess=new e.PostProcess("HDRVLSFinal","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRVLSFinal",function(){return t.volumetricLightFinalPostProcess},!0))),this._bloomEnabled&&(this._createDownSampleX4PostProcess(r,i/2),this._createBrightPassPostProcess(r,i/2),this._createBlurPostProcesses(r,i/4,1),this._createTextureAdderPostProcess(r,i),this.textureAdderFinalPostProcess=new e.PostProcess("HDRDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRBaseDepthOfFieldSource",function(){return t.textureAdderFinalPostProcess},!0))),this._lensFlareEnabled&&(this._createLensFlarePostProcess(r,i),this.lensFlareFinalPostProcess=new e.PostProcess("HDRPostLensFlareDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPostLensFlareDepthOfFieldSource",function(){return t.lensFlareFinalPostProcess},!0))),this._hdrEnabled&&(this._createLuminancePostProcesses(r,this._floatTextureType),this._createHdrPostProcess(r,i),this.hdrFinalPostProcess=new e.PostProcess("HDRPostHDReDepthOfFieldSource","standard",[],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1,"#define PASS_POST_PROCESS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPostHDReDepthOfFieldSource",function(){return t.hdrFinalPostProcess},!0))),this._depthOfFieldEnabled&&(this._createBlurPostProcesses(r,i/2,3,"depthOfFieldBlurWidth"),this._createDepthOfFieldPostProcess(r,i)),this._motionBlurEnabled&&this._createMotionBlurPostProcess(r,i),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras)},i.prototype._createDownSampleX4PostProcess=function(t,i){var r=this,n=new Array(32);this.downSampleX4PostProcess=new e.PostProcess("HDRDownSampleX4","standard",["dsOffsets"],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DOWN_SAMPLE_X4",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.downSampleX4PostProcess.onApply=function(e){for(var t=0,i=r.downSampleX4PostProcess.width,o=r.downSampleX4PostProcess.height,s=-2;s<2;s++)for(var a=-2;a<2;a++)n[t]=(s+.5)*(1/i),n[t+1]=(a+.5)*(1/o),t+=2;e.setArray2("dsOffsets",n)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDownSampleX4",function(){return r.downSampleX4PostProcess},!0))},i.prototype._createBrightPassPostProcess=function(t,i){var r=this,n=new Array(8);this.brightPassPostProcess=new e.PostProcess("HDRBrightPass","standard",["dsOffsets","brightThreshold"],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define BRIGHT_PASS",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.brightPassPostProcess.onApply=function(e){var t=1/r.brightPassPostProcess.width,i=1/r.brightPassPostProcess.height;n[0]=-.5*t,n[1]=.5*i,n[2]=.5*t,n[3]=.5*i,n[4]=-.5*t,n[5]=-.5*i,n[6]=.5*t,n[7]=-.5*i,e.setArray2("dsOffsets",n),e.setFloat("brightThreshold",r.brightThreshold)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBrightPass",function(){return r.brightPassPostProcess},!0))},i.prototype._createBlurPostProcesses=function(t,i,r,n){var o=this;void 0===n&&(n="blurWidth");var s=t.getEngine(),a=new e.BlurPostProcess("HDRBlurH_"+r,new e.Vector2(1,0),this[n],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT),l=new e.BlurPostProcess("HDRBlurV_"+r,new e.Vector2(0,1),this[n],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);a.onActivateObservable.add(function(){var e=a.width/s.getRenderWidth();a.kernel=o[n]*e}),l.onActivateObservable.add(function(){var e=l.height/s.getRenderHeight();l.kernel=o.horizontalBlur?64*e:o[n]*e}),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurH"+r,function(){return a},!0)),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRBlurV"+r,function(){return l},!0)),this.blurHPostProcesses.push(a),this.blurVPostProcesses.push(l)},i.prototype._createTextureAdderPostProcess=function(t,i){var r=this;this.textureAdderPostProcess=new e.PostProcess("HDRTextureAdder","standard",["exposure"],["otherSampler","lensSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define TEXTURE_ADDER",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",r._vlsEnabled?r._currentDepthOfFieldSource:r.originalPostProcess),e.setTexture("lensSampler",r.lensTexture),e.setFloat("exposure",r.exposure),r._currentDepthOfFieldSource=r.textureAdderFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRTextureAdder",function(){return r.textureAdderPostProcess},!0))},i.prototype._createVolumetricLightPostProcess=function(t,i){var r=this,n=t.enableGeometryBufferRenderer();n.enablePosition=!0;var o=n.getGBuffer();this.volumetricLightPostProcess=new e.PostProcess("HDRVLS","standard",["shadowViewProjection","cameraPosition","sunDirection","sunColor","scatteringCoefficient","scatteringPower","depthValues"],["shadowMapSampler","positionSampler"],i/8,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLS\n#define NB_STEPS "+this._volumetricLightStepsCount.toFixed(1));var s=e.Vector2.Zero();this.volumetricLightPostProcess.onApply=function(e){if(r.sourceLight&&r.sourceLight.getShadowGenerator()&&r._scene.activeCamera){var t=r.sourceLight.getShadowGenerator();e.setTexture("shadowMapSampler",t.getShadowMap()),e.setTexture("positionSampler",o.textures[2]),e.setColor3("sunColor",r.sourceLight.diffuse),e.setVector3("sunDirection",r.sourceLight.getShadowDirection()),e.setVector3("cameraPosition",r._scene.activeCamera.globalPosition),e.setMatrix("shadowViewProjection",t.getTransformMatrix()),e.setFloat("scatteringCoefficient",r.volumetricLightCoefficient),e.setFloat("scatteringPower",r.volumetricLightPower),s.x=t.getLight().getDepthMinZ(r._scene.activeCamera),s.y=t.getLight().getDepthMaxZ(r._scene.activeCamera),e.setVector2("depthValues",s)}},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLS",function(){return r.volumetricLightPostProcess},!0)),this._createBlurPostProcesses(t,i/4,0,"volumetricLightBlurScale"),this.volumetricLightMergePostProces=new e.PostProcess("HDRVLSMerge","standard",[],["originalSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define VLSMERGE"),this.volumetricLightMergePostProces.onApply=function(e){e.setTextureFromPostProcess("originalSampler",r.originalPostProcess),r._currentDepthOfFieldSource=r.volumetricLightFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRVLSMerge",function(){return r.volumetricLightMergePostProces},!0))},i.prototype._createLuminancePostProcesses=function(t,r){var n=this,o=Math.pow(3,i.LuminanceSteps);this.luminancePostProcess=new e.PostProcess("HDRLuminance","standard",["lumOffsets"],[],{width:o,height:o},null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LUMINANCE",r);var s=[];this.luminancePostProcess.onApply=function(e){var t=1/n.luminancePostProcess.width,i=1/n.luminancePostProcess.height;s[0]=-.5*t,s[1]=.5*i,s[2]=.5*t,s[3]=.5*i,s[4]=-.5*t,s[5]=-.5*i,s[6]=.5*t,s[7]=-.5*i,e.setArray2("lumOffsets",s)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminance",function(){return n.luminancePostProcess},!0));for(var a=i.LuminanceSteps-1;a>=0;a--){var o=Math.pow(3,a),l="#define LUMINANCE_DOWN_SAMPLE\n";0===a&&(l+="#define FINAL_DOWN_SAMPLER");var h=new e.PostProcess("HDRLuminanceDownSample"+a,"standard",["dsOffsets","halfDestPixelSize"],[],{width:o,height:o},null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,l,r);this.luminanceDownSamplePostProcesses.push(h)}var c=this.luminancePostProcess;this.luminanceDownSamplePostProcesses.forEach(function(i,r){var o=new Array(18);i.onApply=function(e){if(c){for(var t=0,s=-1;s<2;s++)for(var a=-1;a<2;a++)o[t]=s/c.width,o[t+1]=a/c.height,t+=2;e.setArray2("dsOffsets",o),e.setFloat("halfDestPixelSize",.5/c.width),c=r===n.luminanceDownSamplePostProcesses.length-1?n.luminancePostProcess:i}},r===n.luminanceDownSamplePostProcesses.length-1&&(i.onAfterRender=function(i){var r=t.getEngine().readPixels(0,0,1,1),o=new e.Vector4(1/16581375,1/65025,1/255,1);n._hdrCurrentLuminance=(r[0]*o.x+r[1]*o.y+r[2]*o.z+r[3]*o.w)/100}),n.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLuminanceDownSample"+r,function(){return i},!0))})},i.prototype._createHdrPostProcess=function(t,i){var r=this;this.hdrPostProcess=new e.PostProcess("HDR","standard",["averageLuminance"],["textureAdderSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define HDR",e.Engine.TEXTURETYPE_UNSIGNED_INT);var n=1,o=0,s=0;this.hdrPostProcess.onApply=function(i){if(i.setTextureFromPostProcess("textureAdderSampler",r._currentDepthOfFieldSource),o+=t.getEngine().getDeltaTime(),n<0)n=r._hdrCurrentLuminance;else{var a=(s-o)/1e3;r._hdrCurrentLuminance<n+r.hdrDecreaseRate*a?n+=r.hdrDecreaseRate*a:r._hdrCurrentLuminance>n-r.hdrIncreaseRate*a?n-=r.hdrIncreaseRate*a:n=r._hdrCurrentLuminance}n=e.Scalar.Clamp(n,r.hdrMinimumLuminance,1e20),i.setFloat("averageLuminance",n),s=o,r._currentDepthOfFieldSource=r.hdrFinalPostProcess},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDR",function(){return r.hdrPostProcess},!0))},i.prototype._createLensFlarePostProcess=function(t,i){var r=this;this.lensFlarePostProcess=new e.PostProcess("HDRLensFlare","standard",["strength","ghostDispersal","haloWidth","resolution","distortionStrength"],["lensColorSampler"],i/2,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlare",function(){return r.lensFlarePostProcess},!0)),this._createBlurPostProcesses(t,i/4,2),this.lensFlareComposePostProcess=new e.PostProcess("HDRLensFlareCompose","standard",["lensStarMatrix"],["otherSampler","lensDirtSampler","lensStarSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define LENS_FLARE_COMPOSE",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRLensFlareCompose",function(){return r.lensFlareComposePostProcess},!0));var n=new e.Vector2(0,0);this.lensFlarePostProcess.onApply=function(e){e.setTextureFromPostProcess("textureSampler",r._bloomEnabled?r.blurHPostProcesses[0]:r.originalPostProcess),e.setTexture("lensColorSampler",r.lensColorTexture),e.setFloat("strength",r.lensFlareStrength),e.setFloat("ghostDispersal",r.lensFlareGhostDispersal),e.setFloat("haloWidth",r.lensFlareHaloWidth),n.x=r.lensFlarePostProcess.width,n.y=r.lensFlarePostProcess.height,e.setVector2("resolution",n),e.setFloat("distortionStrength",r.lensFlareDistortionStrength)};var o=e.Matrix.FromValues(2,0,-1,0,0,2,-1,0,0,0,1,0,0,0,0,1),s=e.Matrix.FromValues(.5,0,.5,0,0,.5,.5,0,0,0,1,0,0,0,0,1);this.lensFlareComposePostProcess.onApply=function(t){if(r._scene.activeCamera){t.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),t.setTexture("lensDirtSampler",r.lensFlareDirtTexture),t.setTexture("lensStarSampler",r.lensStarTexture);var i=r._scene.activeCamera.getViewMatrix().getRow(0),n=r._scene.activeCamera.getViewMatrix().getRow(2),a=e.Vector3.Dot(i.toVector3(),new e.Vector3(1,0,0))+e.Vector3.Dot(n.toVector3(),new e.Vector3(0,0,1));a*=4;var l=e.Matrix.FromValues(.5*Math.cos(a),-Math.sin(a),0,0,Math.sin(a),.5*Math.cos(a),0,0,0,0,1,0,0,0,0,1),h=s.multiply(l).multiply(o);t.setMatrix("lensStarMatrix",h),r._currentDepthOfFieldSource=r.lensFlareFinalPostProcess}}},i.prototype._createDepthOfFieldPostProcess=function(t,i){var r=this;this.depthOfFieldPostProcess=new e.PostProcess("HDRDepthOfField","standard",["distance"],["otherSampler","depthSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DEPTH_OF_FIELD",e.Engine.TEXTURETYPE_UNSIGNED_INT),this.depthOfFieldPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",r._currentDepthOfFieldSource),e.setTexture("depthSampler",r._getDepthTexture()),e.setFloat("distance",r.depthOfFieldDistance)},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRDepthOfField",function(){return r.depthOfFieldPostProcess},!0))},i.prototype._createMotionBlurPostProcess=function(t,i){var r=this;this.motionBlurPostProcess=new e.PostProcess("HDRMotionBlur","standard",["inverseViewProjection","prevViewProjection","screenSize","motionScale","motionStrength"],["depthSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES "+this.motionBlurSamples.toFixed(1),e.Engine.TEXTURETYPE_UNSIGNED_INT);var n=0,o=e.Matrix.Identity(),s=e.Matrix.Identity(),a=e.Matrix.Identity(),l=e.Vector2.Zero();this.motionBlurPostProcess.onApply=function(e){a=t.getProjectionMatrix().multiply(t.getViewMatrix()),a.invertToRef(s),e.setMatrix("inverseViewProjection",s),e.setMatrix("prevViewProjection",o),o=a,l.x=r.motionBlurPostProcess.width,l.y=r.motionBlurPostProcess.height,e.setVector2("screenSize",l),n=t.getEngine().getFps()/60,e.setFloat("motionScale",n),e.setFloat("motionStrength",r.motionStrength),e.setTexture("depthSampler",r._getDepthTexture())},this.addEffect(new e.PostProcessRenderEffect(t.getEngine(),"HDRMotionBlur",function(){return r.motionBlurPostProcess},!0))},i.prototype._getDepthTexture=function(){if(this._scene.getEngine().getCaps().drawBuffersExtension){return this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]}return this._scene.enableDepthRenderer().getDepthMap()},i.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[e];this.originalPostProcess&&this.originalPostProcess.dispose(t),this.downSampleX4PostProcess&&this.downSampleX4PostProcess.dispose(t),this.brightPassPostProcess&&this.brightPassPostProcess.dispose(t),this.textureAdderPostProcess&&this.textureAdderPostProcess.dispose(t),this.textureAdderFinalPostProcess&&this.textureAdderFinalPostProcess.dispose(t),this.volumetricLightPostProcess&&this.volumetricLightPostProcess.dispose(t),this.volumetricLightSmoothXPostProcess&&this.volumetricLightSmoothXPostProcess.dispose(t),this.volumetricLightSmoothYPostProcess&&this.volumetricLightSmoothYPostProcess.dispose(t),this.volumetricLightMergePostProces&&this.volumetricLightMergePostProces.dispose(t),this.volumetricLightFinalPostProcess&&this.volumetricLightFinalPostProcess.dispose(t),this.lensFlarePostProcess&&this.lensFlarePostProcess.dispose(t),this.lensFlareComposePostProcess&&this.lensFlareComposePostProcess.dispose(t);for(var i=0;i<this.luminanceDownSamplePostProcesses.length;i++)this.luminanceDownSamplePostProcesses[i].dispose(t);this.luminancePostProcess&&this.luminancePostProcess.dispose(t),this.hdrPostProcess&&this.hdrPostProcess.dispose(t),this.hdrFinalPostProcess&&this.hdrFinalPostProcess.dispose(t),this.depthOfFieldPostProcess&&this.depthOfFieldPostProcess.dispose(t),this.motionBlurPostProcess&&this.motionBlurPostProcess.dispose(t);for(var i=0;i<this.blurHPostProcesses.length;i++)this.blurHPostProcesses[i].dispose(t);for(var i=0;i<this.blurVPostProcesses.length;i++)this.blurVPostProcesses[i].dispose(t)}this.originalPostProcess=null,this.downSampleX4PostProcess=null,this.brightPassPostProcess=null,this.textureAdderPostProcess=null,this.textureAdderFinalPostProcess=null,this.volumetricLightPostProcess=null,this.volumetricLightSmoothXPostProcess=null,this.volumetricLightSmoothYPostProcess=null,this.volumetricLightMergePostProces=null,this.volumetricLightFinalPostProcess=null,this.lensFlarePostProcess=null,this.lensFlareComposePostProcess=null,this.luminancePostProcess=null,this.hdrPostProcess=null,this.hdrFinalPostProcess=null,this.depthOfFieldPostProcess=null,this.motionBlurPostProcess=null,this.luminanceDownSamplePostProcesses=[],this.blurHPostProcesses=[],this.blurVPostProcesses=[]},i.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),t.prototype.dispose.call(this)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="StandardRenderingPipeline",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse(function(){return new i(t._name,r,t._ratio)},t,r,n)},i}(e.PostProcessRenderPipeline);t.LuminanceSteps=6,n([e.serialize()],t.prototype,"brightThreshold",void 0),n([e.serialize()],t.prototype,"blurWidth",void 0),n([e.serialize()],t.prototype,"horizontalBlur",void 0),n([e.serialize()],t.prototype,"exposure",void 0),n([e.serializeAsTexture("lensTexture")],t.prototype,"lensTexture",void 0),n([e.serialize()],t.prototype,"volumetricLightCoefficient",void 0),n([e.serialize()],t.prototype,"volumetricLightPower",void 0),n([e.serialize()],t.prototype,"volumetricLightBlurScale",void 0),n([e.serialize()],t.prototype,"hdrMinimumLuminance",void 0),n([e.serialize()],t.prototype,"hdrDecreaseRate",void 0),n([e.serialize()],t.prototype,"hdrIncreaseRate",void 0),n([e.serializeAsTexture("lensColorTexture")],t.prototype,"lensColorTexture",void 0),n([e.serialize()],t.prototype,"lensFlareStrength",void 0),n([e.serialize()],t.prototype,"lensFlareGhostDispersal",void 0),n([e.serialize()],t.prototype,"lensFlareHaloWidth",void 0),n([e.serialize()],t.prototype,"lensFlareDistortionStrength",void 0),n([e.serializeAsTexture("lensStarTexture")],t.prototype,"lensStarTexture",void 0),n([e.serializeAsTexture("lensFlareDirtTexture")],t.prototype,"lensFlareDirtTexture",void 0),n([e.serialize()],t.prototype,"depthOfFieldDistance",void 0),n([e.serialize()],t.prototype,"depthOfFieldBlurWidth",void 0),n([e.serialize()],t.prototype,"motionStrength",void 0),n([e.serialize()],t.prototype,"BloomEnabled",null),n([e.serialize()],t.prototype,"DepthOfFieldEnabled",null),n([e.serialize()],t.prototype,"LensFlareEnabled",null),n([e.serialize()],t.prototype,"HDREnabled",null),n([e.serialize()],t.prototype,"VLSEnabled",null),n([e.serialize()],t.prototype,"MotionBlurEnabled",null),n([e.serialize()],t.prototype,"volumetricLightStepsCount",null),n([e.serialize()],t.prototype,"motionBlurSamples",null),e.StandardRenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT);var h=t.call(this,i,"fxaa",["texelSize"],null,r,n,o||e.Texture.BILINEAR_SAMPLINGMODE,s,a,null,l,"fxaa")||this;return h.onApplyObservable.add(function(e){var t=h.texelSize;e.setFloat2("texelSize",t.x,t.y)}),h}return o(i,t),i}(e.PostProcess);e.FxaaPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s){void 0===s&&(s=!0);var a=t.call(this,n.getEngine(),i)||this;a.PassPostProcessId="PassPostProcessEffect",a.HighLightsPostProcessId="HighLightsPostProcessEffect",a.BlurXPostProcessId="BlurXPostProcessEffect",a.BlurYPostProcessId="BlurYPostProcessEffect",a.CopyBackPostProcessId="CopyBackPostProcessEffect",a.ImageProcessingPostProcessId="ImageProcessingPostProcessEffect",a.FxaaPostProcessId="FxaaPostProcessEffect",a.FinalMergePostProcessId="FinalMergePostProcessEffect",a.animations=[],a._bloomEnabled=!1,a._fxaaEnabled=!1,a._imageProcessingEnabled=!0,a._bloomScale=.6,a._buildAllowed=!0,a.bloomKernel=64,a._bloomWeight=.15,a._cameras=o||[],a._buildAllowed=s,a._scene=n;var l=a._scene.getEngine().getCaps();return a._hdr=r&&(l.textureHalfFloatRender||l.textureFloatRender),a._hdr?l.textureHalfFloatRender?a._defaultPipelineTextureType=e.Engine.TEXTURETYPE_HALF_FLOAT:l.textureFloatRender&&(a._defaultPipelineTextureType=e.Engine.TEXTURETYPE_FLOAT):a._defaultPipelineTextureType=e.Engine.TEXTURETYPE_UNSIGNED_INT,n.postProcessRenderPipelineManager.addPipeline(a),a._buildPipeline(),a}return o(i,t),Object.defineProperty(i.prototype,"bloomWeight",{get:function(){return this._bloomWeight},set:function(t){this._bloomWeight!==t&&(this._bloomWeight=t,this._hdr&&this.copyBack&&(this.copyBack.alphaConstants=new e.Color4(t,t,t,t)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomScale",{get:function(){return this._bloomScale},set:function(e){this._bloomScale!==e&&(this._bloomScale=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"bloomEnabled",{get:function(){return this._bloomEnabled},set:function(e){this._bloomEnabled!==e&&(this._bloomEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fxaaEnabled",{get:function(){return this._fxaaEnabled},set:function(e){this._fxaaEnabled!==e&&(this._fxaaEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"imageProcessingEnabled",{get:function(){return this._imageProcessingEnabled},set:function(e){this._imageProcessingEnabled!==e&&(this._imageProcessingEnabled=e,this._buildPipeline())},enumerable:!0,configurable:!0}),i.prototype.prepare=function(){var e=this._buildAllowed;this._buildAllowed=!0,this._buildPipeline(),this._buildAllowed=e},i.prototype._buildPipeline=function(){var t=this;if(this._buildAllowed){var i=this._scene.getEngine();if(this._disposePostProcesses(),this._reset(),this.bloomEnabled){if(this.pass=new e.PassPostProcess("sceneRenderTarget",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.PassPostProcessId,function(){return t.pass},!0)),this._hdr||(this.highlights=new e.HighlightsPostProcess("highlights",this.bloomScale,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.HighLightsPostProcessId,function(){return t.highlights},!0)),this.highlights.autoClear=!1,this.highlights.alwaysForcePOT=!0),this.blurX=new e.BlurPostProcess("horizontal blur",new e.Vector2(1,0),10,this.bloomScale,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.BlurXPostProcessId,function(){return t.blurX},!0)),this.blurX.alwaysForcePOT=!0,this.blurX.autoClear=!1,this.blurX.onActivateObservable.add(function(){var e=t.blurX.width/i.getRenderWidth(!0);t.blurX.kernel=t.bloomKernel*e}),this.blurY=new e.BlurPostProcess("vertical blur",new e.Vector2(0,1),10,this.bloomScale,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.BlurYPostProcessId,function(){return t.blurY},!0)),this.blurY.alwaysForcePOT=!0,this.blurY.autoClear=!1,this.blurY.onActivateObservable.add(function(){var e=t.blurY.height/i.getRenderHeight(!0);t.blurY.kernel=t.bloomKernel*e}),this.copyBack=new e.PassPostProcess("bloomBlendBlit",this.bloomScale,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.CopyBackPostProcessId,function(){return t.copyBack},!0)),this.copyBack.alwaysForcePOT=!0,this._hdr){this.copyBack.alphaMode=e.Engine.ALPHA_INTERPOLATE;var r=this.bloomWeight;this.copyBack.alphaConstants=new e.Color4(r,r,r,r)}else this.copyBack.alphaMode=e.Engine.ALPHA_SCREENMODE;this.copyBack.autoClear=!1}this._imageProcessingEnabled&&(this.imageProcessing=new e.ImageProcessingPostProcess("imageProcessing",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this._hdr?this.addEffect(new e.PostProcessRenderEffect(i,this.ImageProcessingPostProcessId,function(){return t.imageProcessing},!0)):this._scene.imageProcessingConfiguration.applyByPostProcess=!1),this.fxaaEnabled?(this.fxaa=new e.FxaaPostProcess("fxaa",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.FxaaPostProcessId,function(){return t.fxaa},!0)),this.fxaa.autoClear=!(this.bloomEnabled||this._hdr&&this.imageProcessing)):this._hdr&&this.imageProcessing?this.finalMerge=this.imageProcessing:(this.finalMerge=new e.PassPostProcess("finalMerge",1,null,e.Texture.BILINEAR_SAMPLINGMODE,i,!1,this._defaultPipelineTextureType),this.addEffect(new e.PostProcessRenderEffect(i,this.FinalMergePostProcessId,function(){return t.finalMerge},!0)),this.finalMerge.autoClear=!(this.bloomEnabled||this._hdr&&this.imageProcessing)),this.bloomEnabled&&(this._hdr?(this.copyBack.shareOutputWith(this.blurX),this.imageProcessing?(this.imageProcessing.shareOutputWith(this.pass),this.imageProcessing.autoClear=!1):this.fxaa?this.fxaa.shareOutputWith(this.pass):this.finalMerge.shareOutputWith(this.pass)):this.fxaa?this.fxaa.shareOutputWith(this.pass):this.finalMerge.shareOutputWith(this.pass)),null!==this._cameras&&this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this._name,this._cameras)}},i.prototype._disposePostProcesses=function(){for(var e=0;e<this._cameras.length;e++){var t=this._cameras[e];this.pass&&this.pass.dispose(t),this.highlights&&this.highlights.dispose(t),this.blurX&&this.blurX.dispose(t),this.blurY&&this.blurY.dispose(t),this.copyBack&&this.copyBack.dispose(t),this.imageProcessing&&this.imageProcessing.dispose(t),this.fxaa&&this.fxaa.dispose(t),this.finalMerge&&this.finalMerge.dispose(t)}this.pass=null,this.highlights=null,this.blurX=null,this.blurY=null,this.copyBack=null,this.imageProcessing=null,this.fxaa=null,this.finalMerge=null},i.prototype.dispose=function(){this._disposePostProcesses(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._cameras),t.prototype.dispose.call(this)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="DefaultRenderingPipeline",t},i.Parse=function(t,r,n){return e.SerializationHelper.Parse(function(){return new i(t._name,t._name._hdr,r)},t,r,n)},i}(e.PostProcessRenderPipeline);n([e.serialize()],t.prototype,"bloomKernel",void 0),n([e.serialize()],t.prototype,"_bloomWeight",void 0),n([e.serialize()],t.prototype,"_hdr",void 0),n([e.serialize()],t.prototype,"bloomWeight",null),n([e.serialize()],t.prototype,"bloomScale",null),n([e.serialize()],t.prototype,"bloomEnabled",null),n([e.serialize()],t.prototype,"fxaaEnabled",null),n([e.serialize()],t.prototype,"imageProcessingEnabled",null),e.DefaultRenderingPipeline=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t){void 0===t&&(t=1),this._enablePosition=!1,this._scene=e,this._ratio=t,this._createRenderTargets()}return Object.defineProperty(t.prototype,"renderList",{set:function(e){this._multiRenderTarget.renderList=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._multiRenderTarget.isSupported},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enablePosition",{get:function(){return this._enablePosition},set:function(e){this._enablePosition=e,this.dispose(),this._createRenderTargets()},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var r=t.getMaterial();if(r&&r.disableDepthWrite)return!1;var n=[],o=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],s=t.getMesh();r&&r.needAlphaTesting()&&(n.push("#define ALPHATEST"),s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push("#define UV1")),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),this._enablePosition&&n.push("#define POSITION"),s.useBones&&s.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(o.push(e.VertexBuffer.MatricesIndicesExtraKind),o.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),n.push("#define BonesPerMesh "+(s.skeleton?s.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("geometry",o,["world","mBones","viewProjection","diffuseMatrix","view"],["diffuseSampler"],a,void 0,void 0,void 0,{buffersCount:this._enablePosition?3:2})),this._effect.isReady()},t.prototype.getGBuffer=function(){return this._multiRenderTarget},t.prototype.dispose=function(){this.getGBuffer().dispose()},t.prototype._createRenderTargets=function(){var t=this,i=this._scene.getEngine(),r=this._enablePosition?3:2;if(this._multiRenderTarget=new e.MultiRenderTarget("gBuffer",{width:i.getRenderWidth()*this._ratio,height:i.getRenderHeight()*this._ratio},r,this._scene,{generateMipMaps:!1,generateDepthTexture:!0}),this.isSupported){this._multiRenderTarget.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._multiRenderTarget.refreshRate=1,this._multiRenderTarget.renderParticles=!1,this._multiRenderTarget.renderList=null,this._multiRenderTarget.onClearObservable.add(function(t){t.clear(new e.Color4(0,0,0,1),!0,!0,!0)});var n=function(i){var r=i.getRenderingMesh(),n=t._scene,o=n.getEngine(),s=i.getMaterial();if(s){o.setState(s.backFaceCulling);var a=r._getInstancesRenderList(i._id);if(!a.mustReturn){var l=o.getCaps().instancedArrays&&null!==a.visibleInstances[i._id];if(t.isReady(i,l)){if(o.enableEffect(t._effect),r._bind(i,t._effect,e.Material.TriangleFillMode),t._effect.setMatrix("viewProjection",n.getTransformMatrix()),t._effect.setMatrix("view",n.getViewMatrix()),s&&s.needAlphaTesting()){var h=s.getAlphaTestTexture();h&&(t._effect.setTexture("diffuseSampler",h),t._effect.setMatrix("diffuseMatrix",h.getTextureMatrix()))}r.useBones&&r.computeBonesUsingShaders&&r.skeleton&&t._effect.setMatrices("mBones",r.skeleton.getTransformMatrices(r)),r._processRendering(i,t._effect,e.Material.TriangleFillMode,a,l,function(e,i){return t._effect.setMatrix("world",i)})}}}};this._multiRenderTarget.customRenderFunction=function(e,t,r,o){var s;if(o.length){for(i.setColorWrite(!1),s=0;s<o.length;s++)n(o.data[s]);i.setColorWrite(!0)}for(s=0;s<e.length;s++)n(e.data[s]);for(s=0;s<t.length;s++)n(t.data[s])}}},t}();e.GeometryBufferRenderer=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c,u){var f=t.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,l,h,c,u)||this;return f.color=n,f.depth=o,f.colorLevel=s,f.onActivateObservable.add(function(t){f._refRexture=f._refRexture||new e.Texture(r,t.getScene())}),f.onApplyObservable.add(function(e){e.setColor3("baseColor",f.color),e.setFloat("depth",f.depth),e.setFloat("colorLevel",f.colorLevel),e.setTexture("refractionSampler",f._refRexture)}),f}return o(i,t),i.prototype.dispose=function(e){this._refRexture&&this._refRexture.dispose(),t.prototype.dispose.call(this,e)},i}(e.PostProcess);e.RefractionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t,"blackAndWhite",["degree"],null,i,r,n,o,s)||this;return a.degree=1,a.onApplyObservable.add(function(e){e.setFloat("degree",a.degree)}),a}return o(t,e),t}(e.PostProcess);e.BlackAndWhitePostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r,n,o,s,a){var l=e.call(this,t,"convolution",["kernel","screenSize"],null,r,n,o,s,a)||this;return l.kernel=i,l.onApply=function(e){e.setFloat2("screenSize",l.width,l.height),e.setArray("kernel",l.kernel)},l}return o(t,e),t}(e.PostProcess);t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],e.ConvolutionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r,n,o,s,a){var l=e.call(this,t,"filter",["kernelMatrix"],null,r,n,o,s,a)||this;return l.kernelMatrix=i,l.onApply=function(e){e.setMatrix("kernelMatrix",l.kernelMatrix)},l}return o(t,e),t}(e.PostProcess);e.FilterPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(r,n,o,s,a,l,h,c,u){void 0===a&&(a=100),void 0===l&&(l=e.Texture.BILINEAR_SAMPLINGMODE);var f=t.call(this,r,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],n.postProcessRatio||n,o,l,h,c,"#define NUM_SAMPLES "+a)||this;return f._screenCoordinates=e.Vector2.Zero(),f.customMeshPosition=e.Vector3.Zero(),f.useCustomMeshPosition=!1,f.invert=!0,f.excludedMeshes=new Array,f.exposure=.3,f.decay=.96815,f.weight=.58767,f.density=.926,u=null===o?u:o.getScene(),h=u.getEngine(),f._viewPort=new e.Viewport(0,0,1,1).toGlobal(h.getRenderWidth(),h.getRenderHeight()),f.mesh=null!==s?s:i.CreateDefaultMesh("VolumetricLightScatteringMesh",u),f._createPass(u,n.passRatio||n),f.onActivate=function(e){f.isSupported||f.dispose(e),f.onActivate=null},f.onApplyObservable.add(function(e){f._updateMeshScreenCoordinates(u),e.setTexture("lightScatteringSampler",f._volumetricLightScatteringRTT),e.setFloat("exposure",f.exposure),e.setFloat("decay",f.decay),e.setFloat("weight",f.weight),e.setFloat("density",f.density),e.setVector2("meshPositionOnScreen",f._screenCoordinates)}),f}return o(i,t),Object.defineProperty(i.prototype,"useDiffuseColor",{get:function(){return e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(t){e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"VolumetricLightScatteringPostProcess"},i.prototype.isReady=function(t,i){var r=t.getMesh();if(r===this.mesh&&r.material)return r.material.isReady(r);var n=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial();s&&(s.needAlphaTesting()&&n.push("#define ALPHATEST"),r.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),n.push("#define UV1")),r.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),r.useBones&&r.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),n.push("#define NUM_BONE_INFLUENCERS "+r.numBoneInfluencers),n.push("#define BonesPerMesh "+(r.skeleton?r.skeleton.bones.length+1:0))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._volumetricLightScatteringPass=r.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},o,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},i.prototype._createPass=function(t,i){var r=this,n=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture("volumetricLightScatteringMap",{width:n.getRenderWidth()*i,height:n.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1;var o=this.getCamera();o?o.customRenderTargets.push(this._volumetricLightScatteringRTT):t.customRenderTargets.push(this._volumetricLightScatteringRTT);var s,a=function(t){var i=t.getRenderingMesh();if(!r._meshExcluded(i)){var n=t.getMaterial();if(n){var o=i.getScene(),s=o.getEngine();s.setState(n.backFaceCulling);var a=i._getInstancesRenderList(t._id);if(!a.mustReturn){var l=s.getCaps().instancedArrays&&null!==a.visibleInstances[t._id];if(r.isReady(t,l)){var h=r._volumetricLightScatteringPass;if(i===r.mesh&&(h=t.effect?t.effect:n.getEffect()),s.enableEffect(h),i._bind(t,h,e.Material.TriangleFillMode),i===r.mesh)n.bind(i.getWorldMatrix(),i);else{if(r._volumetricLightScatteringPass.setMatrix("viewProjection",o.getTransformMatrix()),n&&n.needAlphaTesting()){var c=n.getAlphaTestTexture();r._volumetricLightScatteringPass.setTexture("diffuseSampler",c),c&&r._volumetricLightScatteringPass.setMatrix("diffuseMatrix",c.getTextureMatrix())}i.useBones&&i.computeBonesUsingShaders&&i.skeleton&&r._volumetricLightScatteringPass.setMatrices("mBones",i.skeleton.getTransformMatrices(i))}i._processRendering(t,r._volumetricLightScatteringPass,e.Material.TriangleFillMode,a,l,function(e,t){return h.setMatrix("world",t)})}}}}},l=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){s=t.clearColor,t.clearColor=l}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){t.clearColor=s}),this._volumetricLightScatteringRTT.customRenderFunction=function(i,r,n,o){var s,l=t.getEngine();if(o.length){for(l.setColorWrite(!1),s=0;s<o.length;s++)a(o.data[s]);l.setColorWrite(!0)}for(s=0;s<i.length;s++)a(i.data[s]);for(l.setAlphaTesting(!0),s=0;s<r.length;s++)a(r.data[s]);if(l.setAlphaTesting(!1),n.length){for(s=0;s<n.length;s++){var h=n.data[s],c=h.getBoundingInfo();c&&t.activeCamera&&(h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=c.boundingSphere.centerWorld.subtract(t.activeCamera.position).length())}var u=n.data.slice(0,n.length);for(u.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),l.setAlphaMode(e.Engine.ALPHA_COMBINE),s=0;s<u.length;s++)a(u[s]);l.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i,r=t.getTransformMatrix();i=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var n=e.Vector3.Project(i,e.Matrix.Identity(),r,this._viewPort);this._screenCoordinates.x=n.x/this._viewPort.width,this._screenCoordinates.y=n.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var r=e.Mesh.CreatePlane(t,1,i);r.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL;var n=new e.StandardMaterial(t+"Material",i);return n.emissiveColor=new e.Color3(1,1,1),r.material=n,r},i}(e.PostProcess);n([e.serializeAsVector3()],t.prototype,"customMeshPosition",void 0),n([e.serialize()],t.prototype,"useCustomMeshPosition",void 0),n([e.serialize()],t.prototype,"invert",void 0),n([e.serializeAsMeshReference()],t.prototype,"mesh",void 0),n([e.serialize()],t.prototype,"excludedMeshes",void 0),n([e.serialize()],t.prototype,"exposure",void 0),n([e.serialize()],t.prototype,"decay",void 0),n([e.serialize()],t.prototype,"weight",void 0),n([e.serialize()],t.prototype,"density",void 0),e.VolumetricLightScatteringPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){var h=t.call(this,i,"colorCorrection",null,["colorTable"],n,o,s,a,l)||this;return h._colorTableTexture=new e.Texture(r,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),h._colorTableTexture.anisotropicFilteringLevel=1,h._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,h._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,h.onApply=function(e){e.setTexture("colorTable",h._colorTableTexture)},h}return o(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(r||(r={}));var r;!function(e){var t;!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(t=e.TonemappingOperator||(e.TonemappingOperator={}));var i=function(i){function r(r,n,o,s,a,l,h){void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),void 0===h&&(h=e.Engine.TEXTURETYPE_UNSIGNED_INT);var c=i.call(this,r,"tonemap",["_ExposureAdjustment"],null,1,s,a,l,!0,null,h)||this;c._operator=n,c.exposureAdjustment=o;var u="#define ";return c._operator===t.Hable?u+="HABLE_TONEMAPPING":c._operator===t.Reinhard?u+="REINHARD_TONEMAPPING":c._operator===t.HejiDawson?u+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":c._operator===t.Photographic&&(u+="PHOTOGRAPHIC_TONEMAPPING"),c.updateEffect(u),c.onApply=function(e){e.setFloat("_ExposureAdjustment",c.exposureAdjustment)},c}return o(r,i),r}(e.PostProcess);e.TonemapPostProcess=i}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r,n,o,s){return e.call(this,t,"displayPass",["passSampler"],["passSampler"],i,r,n,o,s)||this}return o(t,e),t}(e.PostProcess);e.DisplayPassPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){return void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),t.call(this,i,"highlights",null,null,r,n,o,s,a,null,l)||this}return o(i,t),i}(e.PostProcess);e.HighlightsPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h){void 0===n&&(n=null),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT);var c=t.call(this,i,"imageProcessing",[],[],r,n,o,s,a,null,l,"postprocess",null,!0)||this;return c._fromLinearSpace=!0,c._defines={IMAGEPROCESSING:!1,VIGNETTE:!1,VIGNETTEBLENDMODEMULTIPLY:!1,VIGNETTEBLENDMODEOPAQUE:!1,TONEMAPPING:!1,CONTRAST:!1,COLORCURVES:!1,COLORGRADING:!1,COLORGRADING3D:!1,FROMLINEARSPACE:!1,SAMPLER3DGREENDEPTH:!1,SAMPLER3DBGRMAP:!1,IMAGEPROCESSINGPOSTPROCESS:!1,EXPOSURE:!1},h?(h.applyByPostProcess=!0,c._attachImageProcessingConfiguration(h,!0),c.fromLinearSpace=!1):(c._attachImageProcessingConfiguration(null,!0),c.imageProcessingConfiguration.applyByPostProcess=!0),c.onApply=function(e){c.imageProcessingConfiguration.bind(e,c.aspectRatio)},c}return o(i,t),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e)},enumerable:!0,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(t,i){var r=this;if(void 0===i&&(i=!1),t!==this._imageProcessingConfiguration){if(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),t)this._imageProcessingConfiguration=t;else{var n=null,o=this.getEngine(),s=this.getCamera();if(s)n=s.getScene();else if(o&&o.scenes){var a=o.scenes;n=a[a.length-1]}else n=e.Engine.LastCreatedScene;this._imageProcessingConfiguration=n.imageProcessingConfiguration}this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(e){r._updateParameters()}),i||this._updateParameters()}},Object.defineProperty(i.prototype,"colorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingTexture",{get:function(){return this.imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exposure",{get:function(){return this.imageProcessingConfiguration.exposure},set:function(e){this.imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"toneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"contrast",{get:function(){return this.imageProcessingConfiguration.contrast},set:function(e){this.imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteStretch",{get:function(){return this.imageProcessingConfiguration.vignetteStretch},set:function(e){this.imageProcessingConfiguration.vignetteStretch=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCentreX",{get:function(){return this.imageProcessingConfiguration.vignetteCentreX},set:function(e){this.imageProcessingConfiguration.vignetteCentreX=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCentreY",{get:function(){return this.imageProcessingConfiguration.vignetteCentreY},set:function(e){this.imageProcessingConfiguration.vignetteCentreY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteWeight",{get:function(){return this.imageProcessingConfiguration.vignetteWeight},set:function(e){this.imageProcessingConfiguration.vignetteWeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteColor",{get:function(){return this.imageProcessingConfiguration.vignetteColor},set:function(e){this.imageProcessingConfiguration.vignetteColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteCameraFov",{get:function(){return this.imageProcessingConfiguration.vignetteCameraFov},set:function(e){this.imageProcessingConfiguration.vignetteCameraFov=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteBlendMode",{get:function(){return this.imageProcessingConfiguration.vignetteBlendMode},set:function(e){this.imageProcessingConfiguration.vignetteBlendMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vignetteEnabled",{get:function(){return this.imageProcessingConfiguration.vignetteEnabled},set:function(e){this.imageProcessingConfiguration.vignetteEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fromLinearSpace",{get:function(){return this._fromLinearSpace},set:function(e){this._fromLinearSpace!==e&&(this._fromLinearSpace=e,this._updateParameters())},enumerable:!0,configurable:!0}),i.prototype.getClassName=function(){return"ImageProcessingPostProcess"},i.prototype._updateParameters=function(){this._defines.FROMLINEARSPACE=this._fromLinearSpace,this.imageProcessingConfiguration.prepareDefines(this._defines,!0);var t="";for(var i in this._defines)this._defines[i]&&(t+="#define "+i+";\r\n");var r=["textureSampler"];e.ImageProcessingConfiguration.PrepareSamplers(r,this._defines);var n=["scale"];e.ImageProcessingConfiguration.PrepareUniforms(n,this._defines),this.updateEffect(t,n,r)},i.prototype.dispose=function(e){t.prototype.dispose.call(this,e),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this.imageProcessingConfiguration.applyByPostProcess=!1},i}(e.PostProcess);n([e.serialize()],t.prototype,"_fromLinearSpace",void 0),e.ImageProcessingPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c){void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),void 0===c&&(c=e.Engine.TEXTURETYPE_UNSIGNED_INT);var u=t.call(this,i,"kernelBlur",["delta","direction"],null,o,s,a,l,h,null,c,"kernelBlur",{varyingCount:0,depCount:0},!0)||this;return u.direction=r,u._packedFloat=!1,u.onApplyObservable.add(function(e){e.setFloat2("delta",1/u.width*u.direction.x,1/u.height*u.direction.y)}),u.kernel=n,u}return o(i,t),Object.defineProperty(i.prototype,"kernel",{get:function(){return this._idealKernel},set:function(e){this._idealKernel!==e&&(e=Math.max(e,1),this._idealKernel=e,this._kernel=this._nearestBestKernel(e),this._updateParameters())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"packedFloat",{get:function(){return this._packedFloat},set:function(e){this._packedFloat!==e&&(this._packedFloat=e,this._updateParameters())},enumerable:!0,configurable:!0}),i.prototype._updateParameters=function(){for(var e=this._kernel,t=(e-1)/2,i=[],r=[],n=0,o=0;o<e;o++){var s=o/(e-1),a=this._gaussianWeight(2*s-1);i[o]=o-t,r[o]=a,n+=a}for(var o=0;o<r.length;o++)r[o]/=n;for(var l=[],h=[],c=[],o=0;o<=t;o+=2){var u=Math.min(o+1,Math.floor(t));if(o===u)c.push({o:i[o],w:r[o]});else{var f=u===t,d=r[o]+r[u]*(f?.5:1),p=i[o]+1/(1+r[o]/r[u]);0===p?(c.push({o:i[o],w:r[o]}),c.push({o:i[o+1],w:r[o+1]})):(c.push({o:p,w:d}),c.push({o:-p,w:d}))}}for(var o=0;o<c.length;o++)h[o]=c[o].o,l[o]=c[o].w;i=h,r=l;for(var m=this.getEngine().getCaps().maxVaryingVectors,g=Math.max(m,0)-1,v=Math.min(i.length,g),y="",o=0;o<v;o++)y+="#define KERNEL_OFFSET"+o+" "+this._glslFloat(i[o])+"\r\n",y+="#define KERNEL_WEIGHT"+o+" "+this._glslFloat(r[o])+"\r\n";for(var _=0,o=g;o<i.length;o++)y+="#define KERNEL_DEP_OFFSET"+_+" "+this._glslFloat(i[o])+"\r\n",y+="#define KERNEL_DEP_WEIGHT"+_+" "+this._glslFloat(r[o])+"\r\n",_++;this.packedFloat&&(y+="#define PACKEDFLOAT 1"),this.updateEffect(y,null,null,{varyingCount:v,depCount:_})},i.prototype._nearestBestKernel=function(e){for(var t=Math.round(e),i=0,r=[t,t-1,t+1,t-2,t+2];i<r.length;i++){var n=r[i];if(n%2!=0&&Math.floor(n/2)%2==0&&n>0)return Math.max(n,3)}return Math.max(t,3)},i.prototype._gaussianWeight=function(e){var t=Math.sqrt(2*Math.PI)*(1/3),i=-e*e/(1/3*2*(1/3));return 1/t*Math.exp(i)},i.prototype._glslFloat=function(e,t){return void 0===t&&(t=8),e.toFixed(t).replace(/0+$/,"")},i}(e.PostProcess);e.BlurPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l){void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null);var h=t.call(this,i,r.getScene())||this;return h.name=i,h.children=new Array,h.animations=new Array,h._index=null,h._worldTransform=new e.Matrix,h._absoluteTransform=new e.Matrix,h._invertedAbsoluteTransform=new e.Matrix,h._scaleMatrix=e.Matrix.Identity(),h._scaleVector=e.Vector3.One(),h._negateScaleChildren=e.Vector3.One(),h._scalingDeterminant=1,h._skeleton=r,h._localMatrix=o||e.Matrix.Identity(),h._restPose=s||h._localMatrix.clone(),h._baseMatrix=a||h._localMatrix.clone(),h._index=l,r.bones.push(h),h.setParent(n,!1),h._updateDifferenceMatrix(),h}return o(i,t),Object.defineProperty(i.prototype,"_matrix",{get:function(){return this._localMatrix},set:function(e){this._localMatrix?this._localMatrix.copyFrom(e):this._localMatrix=e},enumerable:!0,configurable:!0}),i.prototype.getSkeleton=function(){return this._skeleton},i.prototype.getParent=function(){return this._parent},i.prototype.setParent=function(e,t){if(void 0===t&&(t=!0),this._parent!==e){if(this._parent){var i=this._parent.children.indexOf(this);-1!==i&&this._parent.children.splice(i,1)}this._parent=e,this._parent&&this._parent.children.push(this),t&&this._updateDifferenceMatrix()}},i.prototype.getLocalMatrix=function(){return this._localMatrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},Object.defineProperty(i.prototype,"position",{get:function(){return this.getPosition()},set:function(e){this.setPosition(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this.getRotationQuaternion()},set:function(e){this.setRotationQuaternion(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e.x,e.y,e.z)},enumerable:!0,configurable:!0}),i.prototype.updateMatrix=function(e,t){void 0===t&&(t=!0),this._baseMatrix=e.clone(),this._localMatrix=e.clone(),this._skeleton._markAsDirty(),t&&this._updateDifferenceMatrix()},i.prototype._updateDifferenceMatrix=function(e){e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var t=0;t<this.children.length;t++)this.children[t]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},i.prototype.markAsDirty=function(){this._currentRenderId++,this._skeleton._markAsDirty()},i.prototype.copyAnimationRange=function(t,i,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=null),0===this.animations.length&&(this.animations.push(new e.Animation(this.name,"_matrix",t.animations[0].framePerSecond,e.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var s=t.animations[0].getRange(i);if(!s)return!1;for(var a,l,h,c=s.from,u=s.to,f=t.animations[0].getKeys(),d=t.length,p=t.getParent(),m=this.getParent(),g=n&&p&&d&&this.length&&d!==this.length,v=g&&m&&p?m.length/p.length:1,y=n&&!m&&o&&(1!==o.x||1!==o.y||1!==o.z),_=this.animations[0].getKeys(),b=0,x=f.length;b<x;b++)a=f[b],a.frame>=c&&a.frame<=u&&(n?(h=a.value.clone(),g?(l=h.getTranslation(),h.setTranslation(l.scaleInPlace(v))):y&&o?(l=h.getTranslation(),h.setTranslation(l.multiplyInPlace(o))):h=a.value):h=a.value,_.push({frame:a.frame+r,value:h}));return this.animations[0].createRange(i,c+r,u+r),!0},i.prototype.translate=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var o=this.getLocalMatrix();if(r==e.Space.LOCAL)o.m[12]+=t.x,o.m[13]+=t.y,o.m[14]+=t.z;else{var s=null;n&&(s=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0],l=i._tmpVecs[0];this._parent&&(n&&s?(a.copyFrom(this._parent.getAbsoluteTransform()),a.multiplyToRef(s,a)):a.copyFrom(this._parent.getAbsoluteTransform())),a.m[12]=0,a.m[13]=0,a.m[14]=0,a.invert(),e.Vector3.TransformCoordinatesToRef(t,a,l),o.m[12]+=l.x,o.m[13]+=l.y,o.m[14]+=l.z}this.markAsDirty()},i.prototype.setPosition=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var o=this.getLocalMatrix();if(r==e.Space.LOCAL)o.m[12]=t.x,o.m[13]=t.y,o.m[14]=t.z;else{var s=null;n&&(s=n.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0],l=i._tmpVecs[0];this._parent&&(n&&s?(a.copyFrom(this._parent.getAbsoluteTransform()),a.multiplyToRef(s,a)):a.copyFrom(this._parent.getAbsoluteTransform())),a.invert(),e.Vector3.TransformCoordinatesToRef(t,a,l),o.m[12]=l.x,o.m[13]=l.y,o.m[14]=l.z}this.markAsDirty()},i.prototype.setAbsolutePosition=function(t,i){this.setPosition(t,e.Space.WORLD,i)},i.prototype.setScale=function(e,t,i,r){void 0===r&&(r=!1),this.animations[0]&&!this.animations[0].hasRunningRuntimeAnimations&&(r||(this._negateScaleChildren.x=1/e,this._negateScaleChildren.y=1/t,this._negateScaleChildren.z=1/i),this._syncScaleVector()),this.scale(e/this._scaleVector.x,t/this._scaleVector.y,i/this._scaleVector.z,r)},i.prototype.scale=function(t,r,n,o){void 0===o&&(o=!1);var s=this.getLocalMatrix(),a=i._tmpMats[0];a.copyFrom(s);var l=i._tmpMats[1];l.copyFrom(a),l.invert();var h=i._tmpMats[2];e.Matrix.FromValuesToRef(t,0,0,0,0,r,0,0,0,0,n,0,0,0,0,1,h),this._scaleMatrix.multiplyToRef(h,this._scaleMatrix),this._scaleVector.x*=t,this._scaleVector.y*=r,this._scaleVector.z*=n,s.multiplyToRef(l,s),s.multiplyToRef(h,s),s.multiplyToRef(a,s);var c=this.getParent();c?s.multiplyToRef(c.getAbsoluteTransform(),this.getAbsoluteTransform()):this.getAbsoluteTransform().copyFrom(s);var u=this.children.length;h.invert();for(var f=0;f<u;f++){var d=this.children[f],p=d.getLocalMatrix();p.multiplyToRef(h,p);var m=d.getLocalMatrix();m.m[12]*=t,m.m[13]*=r,m.m[14]*=n}if(this.computeAbsoluteTransforms(),o)for(var f=0;f<u;f++)this.children[f].scale(t,r,n,o);this.markAsDirty()},i.prototype.setYawPitchRoll=function(t,r,n,o,s){void 0===o&&(o=e.Space.LOCAL);var a=i._tmpMats[0];e.Matrix.RotationYawPitchRollToRef(t,r,n,a);var l=i._tmpMats[1];this._getNegativeRotationToRef(l,o,s),l.multiplyToRef(a,a),this._rotateWithMatrix(a,o,s)},i.prototype.rotate=function(t,r,n,o){void 0===n&&(n=e.Space.LOCAL);var s=i._tmpMats[0];s.m[12]=0,s.m[13]=0,s.m[14]=0,e.Matrix.RotationAxisToRef(t,r,s),this._rotateWithMatrix(s,n,o)},i.prototype.setAxisAngle=function(t,r,n,o){void 0===n&&(n=e.Space.LOCAL);var s=i._tmpMats[0];e.Matrix.RotationAxisToRef(t,r,s);var a=i._tmpMats[1];this._getNegativeRotationToRef(a,n,o),a.multiplyToRef(s,s),this._rotateWithMatrix(s,n,o)},i.prototype.setRotation=function(t,i,r){void 0===i&&(i=e.Space.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,i,r)},i.prototype.setRotationQuaternion=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var o=i._tmpMats[0];this._getNegativeRotationToRef(o,r,n);var s=i._tmpMats[1];e.Matrix.FromQuaternionToRef(t,s),o.multiplyToRef(s,s),this._rotateWithMatrix(s,r,n)},i.prototype.setRotationMatrix=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var o=i._tmpMats[0];this._getNegativeRotationToRef(o,r,n);var s=i._tmpMats[1];s.copyFrom(t),o.multiplyToRef(t,s),this._rotateWithMatrix(s,r,n)},i.prototype._rotateWithMatrix=function(t,r,n){void 0===r&&(r=e.Space.LOCAL);var o=this.getLocalMatrix(),s=o.m[12],a=o.m[13],l=o.m[14],h=this.getParent(),c=i._tmpMats[3],u=i._tmpMats[4];h?(r==e.Space.WORLD?n?(c.copyFrom(n.getWorldMatrix()),h.getAbsoluteTransform().multiplyToRef(c,c)):c.copyFrom(h.getAbsoluteTransform()):c=h._scaleMatrix,u.copyFrom(c),u.invert(),o.multiplyToRef(c,o),o.multiplyToRef(t,o),o.multiplyToRef(u,o)):r==e.Space.WORLD&&n?(c.copyFrom(n.getWorldMatrix()),u.copyFrom(c),u.invert(),o.multiplyToRef(c,o),o.multiplyToRef(t,o),o.multiplyToRef(u,o)):o.multiplyToRef(t,o),o.m[12]=s,o.m[13]=a,o.m[14]=l,this.computeAbsoluteTransforms(),this.markAsDirty()},i.prototype._getNegativeRotationToRef=function(t,r,n){if(void 0===r&&(r=e.Space.LOCAL),r==e.Space.WORLD){var o=i._tmpMats[2];if(o.copyFrom(this._scaleMatrix),t.copyFrom(this.getAbsoluteTransform()),n){t.multiplyToRef(n.getWorldMatrix(),t);var s=i._tmpMats[3];e.Matrix.ScalingToRef(n.scaling.x,n.scaling.y,n.scaling.z,s),o.multiplyToRef(s,o)}t.invert(),o.m[0]*=this._scalingDeterminant,t.multiplyToRef(o,t)}else{t.copyFrom(this.getLocalMatrix()),t.invert();var o=i._tmpMats[2];if(o.copyFrom(this._scaleMatrix),this._parent){var a=i._tmpMats[3];a.copyFrom(this._parent._scaleMatrix),a.invert(),a.multiplyToRef(t,t)}else o.m[0]*=this._scalingDeterminant;t.multiplyToRef(o,t)}},i.prototype.getScale=function(){return this._scaleVector.clone()},i.prototype.getScaleToRef=function(e){e.copyFrom(this._scaleVector)},i.prototype.getPosition=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getPositionToRef(t,i,r),r},i.prototype.getPositionToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),t==e.Space.LOCAL){var o=this.getLocalMatrix();n.x=o.m[12],n.y=o.m[13],n.z=o.m[14]}else{var s=null;r&&(s=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0];r&&s?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(s,a)):a=this.getAbsoluteTransform(),n.x=a.m[12],n.y=a.m[13],n.z=a.m[14]}},i.prototype.getAbsolutePosition=function(t){void 0===t&&(t=null);var i=e.Vector3.Zero();return this.getPositionToRef(e.Space.WORLD,t,i),i},i.prototype.getAbsolutePositionToRef=function(t,i){this.getPositionToRef(e.Space.WORLD,t,i)},i.prototype.computeAbsoluteTransforms=function(){if(this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var t=this.children,i=t.length,r=0;r<i;r++)t[r].computeAbsoluteTransforms()},i.prototype._syncScaleVector=function(){var t=this.getLocalMatrix(),i=t.m[0]*t.m[0]+t.m[1]*t.m[1]+t.m[2]*t.m[2],r=t.m[4]*t.m[4]+t.m[5]*t.m[5]+t.m[6]*t.m[6],n=t.m[8]*t.m[8]+t.m[9]*t.m[9]+t.m[10]*t.m[10],o=t.m[0]*t.m[1]*t.m[2]*t.m[3]<0?-1:1,s=t.m[4]*t.m[5]*t.m[6]*t.m[7]<0?-1:1,a=t.m[8]*t.m[9]*t.m[10]*t.m[11]<0?-1:1;this._scaleVector.x=o*Math.sqrt(i),this._scaleVector.y=s*Math.sqrt(r),this._scaleVector.z=a*Math.sqrt(n),this._parent&&(this._scaleVector.x/=this._parent._negateScaleChildren.x,this._scaleVector.y/=this._parent._negateScaleChildren.y,this._scaleVector.z/=this._parent._negateScaleChildren.z),e.Matrix.FromValuesToRef(this._scaleVector.x,0,0,0,0,this._scaleVector.y,0,0,0,0,this._scaleVector.z,0,0,0,0,1,this._scaleMatrix)},i.prototype.getDirection=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getDirectionToRef(t,i,r),r},i.prototype.getDirectionToRef=function(t,r,n){void 0===r&&(r=null);var o=null;r&&(o=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0];s.copyFrom(this.getAbsoluteTransform()),r&&o&&s.multiplyToRef(o,s),e.Vector3.TransformNormalToRef(t,s,n),n.normalize()},i.prototype.getRotation=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getRotationToRef(t,i,r),r},i.prototype.getRotationToRef=function(t,r,n){void 0===t&&(t=e.Space.LOCAL),void 0===r&&(r=null);var o=i._tmpQuat;this.getRotationQuaternionToRef(t,r,o),o.toEulerAnglesToRef(n)},i.prototype.getRotationQuaternion=function(t,i){void 0===t&&(t=e.Space.LOCAL),void 0===i&&(i=null);var r=e.Quaternion.Identity();return this.getRotationQuaternionToRef(t,i,r),r},i.prototype.getRotationQuaternionToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),void 0===r&&(r=null),t==e.Space.LOCAL)this.getLocalMatrix().decompose(i._tmpVecs[0],n,i._tmpVecs[1]);else{var o=i._tmpMats[0],s=this.getAbsoluteTransform();r?s.multiplyToRef(r.getWorldMatrix(),o):o.copyFrom(s),o.m[0]*=this._scalingDeterminant,o.m[1]*=this._scalingDeterminant,o.m[2]*=this._scalingDeterminant,o.decompose(i._tmpVecs[0],n,i._tmpVecs[1])}},i.prototype.getRotationMatrix=function(t,i){void 0===t&&(t=e.Space.LOCAL);var r=e.Matrix.Identity();return this.getRotationMatrixToRef(t,i,r),r},i.prototype.getRotationMatrixToRef=function(t,r,n){if(void 0===t&&(t=e.Space.LOCAL),t==e.Space.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(n);else{var o=i._tmpMats[0],s=this.getAbsoluteTransform();r?s.multiplyToRef(r.getWorldMatrix(),o):o.copyFrom(s),o.m[0]*=this._scalingDeterminant,o.m[1]*=this._scalingDeterminant,o.m[2]*=this._scalingDeterminant,o.getRotationMatrixToRef(n)}},i.prototype.getAbsolutePositionFromLocal=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getAbsolutePositionFromLocalToRef(t,i,r),r},i.prototype.getAbsolutePositionFromLocalToRef=function(t,r,n){void 0===r&&(r=null);var o=null;r&&(o=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0];r&&o?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(o,s)):s=this.getAbsoluteTransform(),e.Vector3.TransformCoordinatesToRef(t,s,n)},i.prototype.getLocalPositionFromAbsolute=function(t,i){void 0===i&&(i=null);var r=e.Vector3.Zero();return this.getLocalPositionFromAbsoluteToRef(t,i,r),r},i.prototype.getLocalPositionFromAbsoluteToRef=function(t,r,n){void 0===r&&(r=null);var o=null;r&&(o=r.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0];s.copyFrom(this.getAbsoluteTransform()),r&&o&&s.multiplyToRef(o,s),s.invert(),e.Vector3.TransformCoordinatesToRef(t,s,n)},i}(e.Node);t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity()],e.Bone=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){if(this.targetPosition=e.Vector3.Zero(),this.poleTargetPosition=e.Vector3.Zero(),this.poleTargetLocalOffset=e.Vector3.Zero(),this.poleAngle=0,this.slerpAmount=1,this._bone1Quat=e.Quaternion.Identity(),this._bone1Mat=e.Matrix.Identity(),this._bone2Ang=Math.PI,this._maxAngle=Math.PI,this._rightHandedSystem=!1,this._bendAxis=e.Vector3.Right(),this._slerping=!1,this._adjustRoll=0,this._bone2=i,this._bone1=i.getParent(),this._bone1){this.mesh=t;var n=i.getPosition();if(i.getAbsoluteTransform().determinant()>0&&(this._rightHandedSystem=!0,this._bendAxis.x=0,this._bendAxis.y=0,this._bendAxis.z=-1,n.x>n.y&&n.x>n.z&&(this._adjustRoll=.5*Math.PI,this._bendAxis.z=1)),this._bone1.length){var o=this._bone1.getScale(),s=this._bone2.getScale();this._bone1Length=this._bone1.length*o.y*this.mesh.scaling.y,this._bone2Length=this._bone2.length*s.y*this.mesh.scaling.y}else if(this._bone1.children[0]){t.computeWorldMatrix(!0);var a=this._bone2.children[0].getAbsolutePosition(t),l=this._bone2.getAbsolutePosition(t),h=this._bone1.getAbsolutePosition(t);this._bone1Length=e.Vector3.Distance(a,l),this._bone2Length=e.Vector3.Distance(l,h)}this._bone1.getRotationMatrixToRef(e.Space.WORLD,t,this._bone1Mat),this.maxAngle=Math.PI,r&&(r.targetMesh&&(this.targetMesh=r.targetMesh,this.targetMesh.computeWorldMatrix(!0)),r.poleTargetMesh?(this.poleTargetMesh=r.poleTargetMesh,this.poleTargetMesh.computeWorldMatrix(!0)):r.poleTargetBone?this.poleTargetBone=r.poleTargetBone:this._bone1.getParent()&&(this.poleTargetBone=this._bone1.getParent()),r.poleTargetLocalOffset&&this.poleTargetLocalOffset.copyFrom(r.poleTargetLocalOffset),r.poleAngle&&(this.poleAngle=r.poleAngle),r.bendAxis&&this._bendAxis.copyFrom(r.bendAxis),r.maxAngle&&(this.maxAngle=r.maxAngle),r.slerpAmount&&(this.slerpAmount=r.slerpAmount))}}return Object.defineProperty(t.prototype,"maxAngle",{get:function(){return this._maxAngle},set:function(e){this._setMaxAngle(e)},enumerable:!0,configurable:!0}),t.prototype._setMaxAngle=function(e){e<0&&(e=0),(e>Math.PI||void 0==e)&&(e=Math.PI),this._maxAngle=e;var t=this._bone1Length,i=this._bone2Length;this._maxReach=Math.sqrt(t*t+i*i-2*t*i*Math.cos(e))},t.prototype.update=function(){var i=this._bone1;if(i){var r=this.targetPosition,n=this.poleTargetPosition,o=t._tmpMats[0],s=t._tmpMats[1];this.targetMesh&&r.copyFrom(this.targetMesh.getAbsolutePosition()),this.poleTargetBone?this.poleTargetBone.getAbsolutePositionFromLocalToRef(this.poleTargetLocalOffset,this.mesh,n):this.poleTargetMesh&&e.Vector3.TransformCoordinatesToRef(this.poleTargetLocalOffset,this.poleTargetMesh.getWorldMatrix(),n);var a=t._tmpVecs[0],l=t._tmpVecs[1],h=t._tmpVecs[2],c=t._tmpVecs[3],u=t._tmpVecs[4],f=t._tmpQuat;i.getAbsolutePositionToRef(this.mesh,a),n.subtractToRef(a,u),0==u.x&&0==u.y&&0==u.z?u.y=1:u.normalize(),r.subtractToRef(a,c),c.normalize(),e.Vector3.CrossToRef(c,u,l),l.normalize(),e.Vector3.CrossToRef(c,l,h),h.normalize(),e.Matrix.FromXYZAxesToRef(h,c,l,o);var d=this._bone1Length,p=this._bone2Length,m=e.Vector3.Distance(a,r);this._maxReach>0&&(m=Math.min(this._maxReach,m));var g=(p*p+m*m-d*d)/(2*p*m),v=(m*m+d*d-p*p)/(2*m*d);g>1&&(g=1),v>1&&(v=1),g<-1&&(g=-1),v<-1&&(v=-1);var y=Math.acos(g),_=Math.acos(v),b=-y-_;if(this._rightHandedSystem)e.Matrix.RotationYawPitchRollToRef(0,0,this._adjustRoll,s),s.multiplyToRef(o,o),e.Matrix.RotationAxisToRef(this._bendAxis,_,s),s.multiplyToRef(o,o);else{var x=t._tmpVecs[5];x.copyFrom(this._bendAxis),x.x*=-1,e.Matrix.RotationAxisToRef(x,-_,s),s.multiplyToRef(o,o)}this.poleAngle&&(e.Matrix.RotationAxisToRef(c,this.poleAngle,s),o.multiplyToRef(s,o)),this._bone1&&(this.slerpAmount<1?(this._slerping||e.Quaternion.FromRotationMatrixToRef(this._bone1Mat,this._bone1Quat),e.Quaternion.FromRotationMatrixToRef(o,f),e.Quaternion.SlerpToRef(this._bone1Quat,f,this.slerpAmount,this._bone1Quat),b=this._bone2Ang*(1-this.slerpAmount)+b*this.slerpAmount,this._bone1.setRotationQuaternion(this._bone1Quat,e.Space.WORLD,this.mesh),this._slerping=!0):(this._bone1.setRotationMatrix(o,e.Space.WORLD,this.mesh),this._bone1Mat.copyFrom(o),this._slerping=!1)),this._bone2.setAxisAngle(this._bendAxis,b,e.Space.LOCAL),this._bone2Ang=b}},t}();t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity()],e.BoneIKController=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n){if(this.upAxis=e.Vector3.Up(),this.upAxisSpace=e.Space.LOCAL,this.adjustYaw=0,this.adjustPitch=0,this.adjustRoll=0,this.slerpAmount=1,this._boneQuat=e.Quaternion.Identity(),this._slerping=!1,this._firstFrameSkipped=!1,this._fowardAxis=e.Vector3.Forward(),this.mesh=t,this.bone=i,this.target=r,n&&(n.adjustYaw&&(this.adjustYaw=n.adjustYaw),n.adjustPitch&&(this.adjustPitch=n.adjustPitch),n.adjustRoll&&(this.adjustRoll=n.adjustRoll),null!=n.maxYaw?this.maxYaw=n.maxYaw:this.maxYaw=Math.PI,null!=n.minYaw?this.minYaw=n.minYaw:this.minYaw=-Math.PI,null!=n.maxPitch?this.maxPitch=n.maxPitch:this.maxPitch=Math.PI,null!=n.minPitch?this.minPitch=n.minPitch:this.minPitch=-Math.PI,null!=n.slerpAmount&&(this.slerpAmount=n.slerpAmount),null!=n.upAxis&&(this.upAxis=n.upAxis),null!=n.upAxisSpace&&(this.upAxisSpace=n.upAxisSpace),null!=n.yawAxis||null!=n.pitchAxis)){var o=e.Axis.Y,s=e.Axis.X;null!=n.yawAxis&&(o=n.yawAxis.clone(),o.normalize()),null!=n.pitchAxis&&(s=n.pitchAxis.clone(),s.normalize());var a=e.Vector3.Cross(s,o);this._transformYawPitch=e.Matrix.Identity(),e.Matrix.FromXYZAxesToRef(s,o,a,this._transformYawPitch),this._transformYawPitchInv=this._transformYawPitch.clone(),this._transformYawPitch.invert()}i.getParent()||this.upAxisSpace!=e.Space.BONE||(this.upAxisSpace=e.Space.LOCAL)}return Object.defineProperty(t.prototype,"minYaw",{get:function(){return this._minYaw},set:function(e){this._minYaw=e,this._minYawSin=Math.sin(e),this._minYawCos=Math.cos(e),null!=this._maxYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxYaw",{get:function(){return this._maxYaw},set:function(e){this._maxYaw=e,this._maxYawSin=Math.sin(e),this._maxYawCos=Math.cos(e),null!=this._minYaw&&(this._midYawConstraint=.5*this._getAngleDiff(this._minYaw,this._maxYaw)+this._minYaw,this._yawRange=this._maxYaw-this._minYaw)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPitch",{get:function(){return this._minPitch},set:function(e){this._minPitch=e,this._minPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPitch",{get:function(){return this._maxPitch},set:function(e){this._maxPitch=e,this._maxPitchTan=Math.tan(e)},enumerable:!0,configurable:!0}),t.prototype.update=function(){if(this.slerpAmount<1&&!this._firstFrameSkipped)return void(this._firstFrameSkipped=!0);var i=this.bone,r=t._tmpVecs[0];i.getAbsolutePositionToRef(this.mesh,r);var n=this.target,o=t._tmpMats[0],s=t._tmpMats[1],a=this.mesh,l=i.getParent(),h=t._tmpVecs[1];h.copyFrom(this.upAxis),this.upAxisSpace==e.Space.BONE&&l?(this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(h,this._transformYawPitchInv,h),l.getDirectionToRef(h,this.mesh,h)):this.upAxisSpace==e.Space.LOCAL&&(a.getDirectionToRef(h,h),1==a.scaling.x&&1==a.scaling.y&&1==a.scaling.z||h.normalize());var c=!1,u=!1;if(this._maxYaw==Math.PI&&this._minYaw==-Math.PI||(c=!0),this._maxPitch==Math.PI&&this._minPitch==-Math.PI||(u=!0),c||u){var f=t._tmpMats[2],d=t._tmpMats[3];if(this.upAxisSpace==e.Space.BONE&&1==h.y&&l)l.getRotationMatrixToRef(e.Space.WORLD,this.mesh,f);else if(this.upAxisSpace!=e.Space.LOCAL||1!=h.y||l){var p=t._tmpVecs[2];p.copyFrom(this._fowardAxis),this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(p,this._transformYawPitchInv,p),l?l.getDirectionToRef(p,this.mesh,p):a.getDirectionToRef(p,p);var m=e.Vector3.Cross(h,p);m.normalize();var p=e.Vector3.Cross(m,h);e.Matrix.FromXYZAxesToRef(m,h,p,f)}else f.copyFrom(a.getWorldMatrix());f.invertToRef(d);var g=null;if(u){var v=t._tmpVecs[3];n.subtractToRef(r,v),e.Vector3.TransformCoordinatesToRef(v,d,v),g=Math.sqrt(v.x*v.x+v.z*v.z);var y=Math.atan2(v.y,g),_=y;y>this._maxPitch?(v.y=this._maxPitchTan*g,_=this._maxPitch):y<this._minPitch&&(v.y=this._minPitchTan*g,_=this._minPitch),y!=_&&(e.Vector3.TransformCoordinatesToRef(v,f,v),v.addInPlace(r),n=v)}if(c){var v=t._tmpVecs[4];n.subtractToRef(r,v),e.Vector3.TransformCoordinatesToRef(v,d,v);var b=Math.atan2(v.x,v.z),x=b;if((b>this._maxYaw||b<this._minYaw)&&(null==g&&(g=Math.sqrt(v.x*v.x+v.z*v.z)),this._yawRange>Math.PI?this._isAngleBetween(b,this._maxYaw,this._midYawConstraint)?(v.z=this._maxYawCos*g,v.x=this._maxYawSin*g,x=this._maxYaw):this._isAngleBetween(b,this._midYawConstraint,this._minYaw)&&(v.z=this._minYawCos*g,v.x=this._minYawSin*g,x=this._minYaw):b>this._maxYaw?(v.z=this._maxYawCos*g,v.x=this._maxYawSin*g,x=this._maxYaw):b<this._minYaw&&(v.z=this._minYawCos*g,v.x=this._minYawSin*g,x=this._minYaw)),this._slerping&&this._yawRange>Math.PI){var T=t._tmpVecs[8];T.copyFrom(e.Axis.Z),this._transformYawPitch&&e.Vector3.TransformCoordinatesToRef(T,this._transformYawPitchInv,T);var E=e.BoneLookController._tmpMats[4];this._boneQuat.toRotationMatrix(E),this.mesh.getWorldMatrix().multiplyToRef(E,E),e.Vector3.TransformCoordinatesToRef(T,E,T),e.Vector3.TransformCoordinatesToRef(T,d,T);var S=Math.atan2(T.x,T.z);if(this._getAngleBetween(S,b)>this._getAngleBetween(S,this._midYawConstraint)){null==g&&(g=Math.sqrt(v.x*v.x+v.z*v.z));var w=this._getAngleBetween(S,this._maxYaw);this._getAngleBetween(S,this._minYaw)<w?(x=S+.75*Math.PI,v.z=Math.cos(x)*g,v.x=Math.sin(x)*g):(x=S-.75*Math.PI,v.z=Math.cos(x)*g,v.x=Math.sin(x)*g)}}b!=x&&(e.Vector3.TransformCoordinatesToRef(v,f,v),v.addInPlace(r),n=v)}}var M=t._tmpVecs[5],A=t._tmpVecs[6],P=t._tmpVecs[7],C=t._tmpQuat;n.subtractToRef(r,M),M.normalize(),e.Vector3.CrossToRef(h,M,A),A.normalize(),e.Vector3.CrossToRef(M,A,P),P.normalize(),e.Matrix.FromXYZAxesToRef(A,P,M,o),0===A.x&&0===A.y&&0===A.z||0===P.x&&0===P.y&&0===P.z||0===M.x&&0===M.y&&0===M.z||((this.adjustYaw||this.adjustPitch||this.adjustRoll)&&(e.Matrix.RotationYawPitchRollToRef(this.adjustYaw,this.adjustPitch,this.adjustRoll,s),s.multiplyToRef(o,o)),this.slerpAmount<1?(this._slerping||this.bone.getRotationQuaternionToRef(e.Space.WORLD,this.mesh,this._boneQuat),this._transformYawPitch&&this._transformYawPitch.multiplyToRef(o,o),e.Quaternion.FromRotationMatrixToRef(o,C),e.Quaternion.SlerpToRef(this._boneQuat,C,this.slerpAmount,this._boneQuat),this.bone.setRotationQuaternion(this._boneQuat,e.Space.WORLD,this.mesh),this._slerping=!0):(this._transformYawPitch&&this._transformYawPitch.multiplyToRef(o,o),this.bone.setRotationMatrix(o,e.Space.WORLD,this.mesh),this._slerping=!1))},t.prototype._getAngleDiff=function(e,t){var i=t-e;return i%=2*Math.PI,i>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),i},t.prototype._getAngleBetween=function(e,t){e%=2*Math.PI,e=e<0?e+2*Math.PI:e,t%=2*Math.PI,t=t<0?t+2*Math.PI:t;var i=0;return i=e<t?t-e:e-t,i>Math.PI&&(i=2*Math.PI-i),i},t.prototype._isAngleBetween=function(e,t,i){if(e%=2*Math.PI,e=e<0?e+2*Math.PI:e,t%=2*Math.PI,t=t<0?t+2*Math.PI:t,i%=2*Math.PI,i=i<0?i+2*Math.PI:i,t<i){if(e>t&&e<i)return!0}else if(e>i&&e<t)return!0;return!1},t}();t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t._tmpMats=[e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity(),e.Matrix.Identity()],e.BoneLookController=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){this.name=t,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=e.Matrix.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this.onBeforeComputeObservable=new e.Observable,this.bones=[],this._scene=r||e.Engine.LastCreatedScene,r.skeletons.push(this),this._isDirty=!0}return t.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},t.prototype.getScene=function(){return this._scene},t.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var r in this._ranges)i&&(t+=", ",i=!1),t+=r;t+="}"}return t},t.prototype.getBoneIndexByName=function(e){for(var t=0,i=this.bones.length;t<i;t++)if(this.bones[t].name===e)return t;return-1},t.prototype.createAnimationRange=function(t,i,r){if(!this._ranges[t]){this._ranges[t]=new e.AnimationRange(t,i,r);for(var n=0,o=this.bones.length;n<o;n++)this.bones[n].animations[0]&&this.bones[n].animations[0].createRange(t,i,r)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,r=this.bones.length;i<r;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(e,t);this._ranges[e]=null},t.prototype.getAnimationRange=function(e){return this._ranges[e]},t.prototype.getAnimationRanges=function(){var e,t=[],i=0;for(e in this._ranges)t[i]=this._ranges[e],i++;return t},t.prototype.copyAnimationRange=function(t,i,r){if(void 0===r&&(r=!1),this._ranges[i]||!t.getAnimationRange(i))return!1;var n,o,s=!0,a=this._getHighestAnimationFrame()+1,l={},h=t.bones;for(o=0,n=h.length;o<n;o++)l[h[o].name]=h[o];this.bones.length!==h.length&&(e.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+h.length),s=!1);var c=r&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(o=0,n=this.bones.length;o<n;o++){var u=this.bones[o].name,f=l[u];f?s=s&&this.bones[o].copyAnimationRange(f,i,a,r,c):(e.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+u),s=!1)}var d=t.getAnimationRange(i);return d&&(this._ranges[i]=new e.AnimationRange(i,d.from+a,d.to+a)),s},t.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[e].returnToRest()},t.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,i=this.bones.length;t<i;t++)if(this.bones[t].animations[0]){var r=this.bones[t].animations[0].getHighestFrame();e<r&&(e=r)}return e},t.prototype.beginAnimation=function(e,t,i,r){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,i,r):null},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},t.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},t.prototype._computeTransformMatrices=function(e,t){this.onBeforeComputeObservable.notifyObservers(this);for(var i=0;i<this.bones.length;i++){var r=this.bones[i],n=r.getParent();if(n?r.getLocalMatrix().multiplyToRef(n.getWorldMatrix(),r.getWorldMatrix()):t?r.getLocalMatrix().multiplyToRef(t,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),-1!==r._index){var o=null===r._index?i:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),e,16*o)}}this._identity.copyToArray(e,16*this.bones.length)},t.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var t=0;t<this._meshesWithPoseMatrix.length;t++){var i=this._meshesWithPoseMatrix[t],r=i.getPoseMatrix();if(i._bonesTransformMatrices&&i._bonesTransformMatrices.length===16*(this.bones.length+1)||(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==i){this._synchronizedWithMesh=i;for(var n=0;n<this.bones.length;n++){var o=this.bones[n];if(!o.getParent()){var s=o.getBaseMatrix();s.multiplyToRef(r,e.Tmp.Matrix[1]),o._updateDifferenceMatrix(e.Tmp.Matrix[1])}}}this._computeTransformMatrices(i._bonesTransformMatrices,r)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},t.prototype.clone=function(i,r){var n=new t(i,r||i,this._scene);n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var o=0;o<this.bones.length;o++){var s=this.bones[o],a=null,l=s.getParent();if(l){var h=this.bones.indexOf(l);a=n.bones[h]}var c=new e.Bone(s.name,n,a,s.getBaseMatrix().clone(),s.getRestPose().clone());e.Tools.DeepCopy(s.animations,c.animations)}if(this._ranges){n._ranges={};for(var u in this._ranges){var f=this._ranges[u];f&&(n._ranges[u]=f.clone())}}return this._isDirty=!0,n},t.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach(function(t){t.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=e})})},t.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,e.dimensionsAtRest=this.dimensionsAtRest,e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var i=this.bones[t],r=i.getParent(),n={parentBoneIndex:r?this.bones.indexOf(r):-1,name:i.name,matrix:i.getBaseMatrix().toArray(),rest:i.getRestPose().toArray()};e.bones.push(n),i.length&&(n.length=i.length),i.animations&&i.animations.length>0&&(n.animation=i.animations[0].serialize()),e.ranges=[];for(var o in this._ranges){var s=this._ranges[o];if(s){var a={};a.name=o,a.from=s.from,a.to=s.to,e.ranges.push(a)}}}return e},t.Parse=function(i,r){var n=new t(i.name,i.id,r);i.dimensionsAtRest&&(n.dimensionsAtRest=e.Vector3.FromArray(i.dimensionsAtRest)),n.needInitialSkinMatrix=i.needInitialSkinMatrix;var o;for(o=0;o<i.bones.length;o++){var s=i.bones[o],a=null;s.parentBoneIndex>-1&&(a=n.bones[s.parentBoneIndex]);var l=s.rest?e.Matrix.FromArray(s.rest):null,h=new e.Bone(s.name,n,a,e.Matrix.FromArray(s.matrix),l);s.length&&(h.length=s.length),s.animation&&h.animations.push(e.Animation.Parse(s.animation))}if(i.ranges)for(o=0;o<i.ranges.length;o++){var c=i.ranges[o];n.createAnimationRange(c.name,c.from,c.to)}return n},t.prototype.computeAbsoluteTransforms=function(e){void 0===e&&(e=!1);var t=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=t||e)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=t)},t.prototype.getPoseMatrix=function(){var e=null;return this._meshesWithPoseMatrix.length>0&&(e=this._meshesWithPoseMatrix[0].getPoseMatrix()),e},t.prototype.sortBones=function(){for(var e=new Array,t=new Array(this.bones.length),i=0;i<this.bones.length;i++)this._sortBones(i,e,t);this.bones=e},t.prototype._sortBones=function(e,t,i){if(!i[e]){i[e]=!0;var r=this.bones[e];void 0===r._index&&(r._index=e);var n=r.getParent();n&&this._sortBones(this.bones.indexOf(n),t,i),t.push(r)}},t}();e.Skeleton=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.x=e.Vector3.Zero(),this.y=e.Vector3.Zero(),this.z=e.Vector3.Zero(),this.xx=e.Vector3.Zero(),this.yy=e.Vector3.Zero(),this.zz=e.Vector3.Zero(),this.xy=e.Vector3.Zero(),this.yz=e.Vector3.Zero(),this.zx=e.Vector3.Zero()}return t.prototype.addAmbient=function(t){var i=new e.Vector3(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(e){var i=new t;return i.x=e.L11.scale(1.02333),i.y=e.L1_1.scale(1.02333),i.z=e.L10.scale(1.02333),i.xx=e.L00.scale(.886277).subtract(e.L20.scale(.247708)).add(e.L22.scale(.429043)),i.yy=e.L00.scale(.886277).subtract(e.L20.scale(.247708)).subtract(e.L22.scale(.429043)),i.zz=e.L00.scale(.886277).add(e.L20.scale(.495417)),i.yz=e.L2_1.scale(.858086),i.zx=e.L21.scale(.858086),i.xy=e.L2_2.scale(.858086),i.scale(1/Math.PI),i},t.prototype.scale=function(e){this.x=this.x.scale(e),this.y=this.y.scale(e),this.z=this.z.scale(e),this.xx=this.xx.scale(e),this.yy=this.yy.scale(e),this.zz=this.zz.scale(e),this.yz=this.yz.scale(e),this.zx=this.zx.scale(e),this.xy=this.xy.scale(e)},t}();e.SphericalPolynomial=t;var i=function(){function t(){this.L00=e.Vector3.Zero(),this.L1_1=e.Vector3.Zero(),this.L10=e.Vector3.Zero(),this.L11=e.Vector3.Zero(),this.L2_2=e.Vector3.Zero(),this.L2_1=e.Vector3.Zero(),this.L20=e.Vector3.Zero(),this.L21=e.Vector3.Zero(),this.L22=e.Vector3.Zero()}return t.prototype.addLight=function(t,i,r){var n=new e.Vector3(i.r,i.g,i.b),o=n.scale(r);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(e){this.L00=this.L00.scale(e),this.L1_1=this.L1_1.scale(e),this.L10=this.L10.scale(e),this.L11=this.L11.scale(e),this.L2_2=this.L2_2.scale(e),this.L2_1=this.L2_1.scale(e),this.L20=this.L20.scale(e),this.L21=this.L21.scale(e),this.L22=this.L22.scale(e)},t.prototype.convertIncidentRadianceToIrradiance=function(){this.L00=this.L00.scale(3.141593),this.L1_1=this.L1_1.scale(2.094395),this.L10=this.L10.scale(2.094395),this.L11=this.L11.scale(2.094395),this.L2_2=this.L2_2.scale(.785398),this.L2_1=this.L2_1.scale(.785398),this.L20=this.L20.scale(.785398),this.L21=this.L21.scale(.785398),this.L22=this.L22.scale(.785398)},t.prototype.convertIrradianceToLambertianRadiance=function(){this.scale(1/Math.PI)},t.getsphericalHarmonicsFromPolynomial=function(e){var i=new t;return i.L00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),i.L1_1=e.y.scale(.977204),i.L10=e.z.scale(.977204),i.L11=e.x.scale(.977204),i.L2_2=e.xy.scale(1.16538),i.L2_1=e.yz.scale(1.16538),i.L20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),i.L21=e.zx.scale(1.16538),i.L22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),i.scale(Math.PI),i},t}();e.SphericalHarmonics=i}(r||(r={}));var r;!function(e){!function(t){var i=function(){function e(e,t,i,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=r}return e}(),r=function(){function t(){}return t.ConvertCubeMapTextureToSphericalPolynomial=function(t){if(!t.isCube)return null;var i,r,n=t.getSize().width,o=t.readPixels(0),s=t.readPixels(1);t.isRenderTarget?(i=t.readPixels(3),r=t.readPixels(2)):(i=t.readPixels(2),r=t.readPixels(3));var a=t.readPixels(4),l=t.readPixels(5),h=t.gammaSpace,c=e.Engine.TEXTUREFORMAT_RGBA,u=e.Engine.TEXTURETYPE_UNSIGNED_INT;t.textureType&&t.textureType!==e.Engine.TEXTURETYPE_UNSIGNED_INT&&(u=e.Engine.TEXTURETYPE_FLOAT);var f={size:n,right:o,left:s,up:i,down:r,front:a,back:l,format:c,type:u,gammaSpace:h};return this.ConvertCubeMapToSphericalPolynomial(f)},t.ConvertCubeMapToSphericalPolynomial=function(t){for(var i=new e.SphericalHarmonics,r=0,n=2/t.size,o=n,s=.5*n-1,a=0;a<6;a++)for(var l=this.FileFaces[a],h=t[l.name],c=s,u=t.format===e.Engine.TEXTUREFORMAT_RGBA?4:3,f=0;f<t.size;f++){for(var d=s,p=0;p<t.size;p++){var m=l.worldAxisForFileX.scale(d).add(l.worldAxisForFileY.scale(c)).add(l.worldAxisForNormal);m.normalize();var g=Math.pow(1+d*d+c*c,-1.5),v=h[f*t.size*u+p*u+0],y=h[f*t.size*u+p*u+1],_=h[f*t.size*u+p*u+2];t.type===e.Engine.TEXTURETYPE_UNSIGNED_INT&&(v/=255,y/=255,_/=255),t.gammaSpace&&(v=Math.pow(e.Scalar.Clamp(v),e.ToLinearSpace),y=Math.pow(e.Scalar.Clamp(y),e.ToLinearSpace),_=Math.pow(e.Scalar.Clamp(_),e.ToLinearSpace));var b=new e.Color3(v,y,_);i.addLight(m,b,g),r+=g,d+=n}c+=o}var x=4*Math.PI,T=6*x/6,E=T/r;return i.scale(E),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),e.SphericalPolynomial.getSphericalPolynomialFromHarmonics(i)},t}();r.FileFaces=[new i("right",new e.Vector3(1,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0)),new i("left",new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,-1,0)),new i("up",new e.Vector3(0,1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,1)),new i("down",new e.Vector3(0,-1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,-1)),new i("front",new e.Vector3(0,0,1),new e.Vector3(1,0,0),new e.Vector3(0,-1,0)),new i("back",new e.Vector3(0,0,-1),new e.Vector3(-1,0,0),new e.Vector3(0,-1,0))],t.CubeMapToSphericalPolynomialTools=r}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(){}return t.ConvertPanoramaToCubemap=function(t,i,r,n){if(!t)throw"ConvertPanoramaToCubemap: input cannot be null";if(t.length!=i*r*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(n,this.FACE_FRONT,t,i,r),back:this.CreateCubemapTexture(n,this.FACE_BACK,t,i,r),left:this.CreateCubemapTexture(n,this.FACE_LEFT,t,i,r),right:this.CreateCubemapTexture(n,this.FACE_RIGHT,t,i,r),up:this.CreateCubemapTexture(n,this.FACE_UP,t,i,r),down:this.CreateCubemapTexture(n,this.FACE_DOWN,t,i,r),size:n,type:e.Engine.TEXTURETYPE_FLOAT,format:e.Engine.TEXTUREFORMAT_RGB,gammaSpace:!1}},t.CreateCubemapTexture=function(e,t,i,r,n){for(var o=new ArrayBuffer(e*e*4*3),s=new Float32Array(o),a=t[1].subtract(t[0]).scale(1/e),l=t[3].subtract(t[2]).scale(1/e),h=1/e,c=0,u=0;u<e;u++){for(var f=t[0],d=t[2],p=0;p<e;p++){var m=d.subtract(f).scale(c).add(f);m.normalize();var g=this.CalcProjectionSpherical(m,i,r,n);s[u*e*3+3*p+0]=g.r,s[u*e*3+3*p+1]=g.g,s[u*e*3+3*p+2]=g.b,f=f.add(a),d=d.add(l)}c+=h}return s},t.CalcProjectionSpherical=function(e,t,i,r){for(var n=Math.atan2(e.z,e.x),o=Math.acos(e.y);n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;var s=n/Math.PI,a=o/Math.PI;s=.5*s+.5;var l=Math.round(s*i);l<0?l=0:l>=i&&(l=i-1);var h=Math.round(a*r);h<0?h=0:h>=r&&(h=r-1);var c=r-h-1;return{r:t[c*i*3+3*l+0],g:t[c*i*3+3*l+1],b:t[c*i*3+3*l+2]}},t}();i.FACE_FRONT=[new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1),new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1)],i.FACE_BACK=[new e.Vector3(1,-1,1),new e.Vector3(-1,-1,1),new e.Vector3(1,1,1),new e.Vector3(-1,1,1)],i.FACE_RIGHT=[new e.Vector3(1,-1,-1),new e.Vector3(1,-1,1),new e.Vector3(1,1,-1),new e.Vector3(1,1,1)],i.FACE_LEFT=[new e.Vector3(-1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(-1,1,1),new e.Vector3(-1,1,-1)],i.FACE_DOWN=[new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1),new e.Vector3(-1,1,1),new e.Vector3(1,1,1)],i.FACE_UP=[new e.Vector3(-1,-1,1),new e.Vector3(1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1)],t.PanoramaToCubeMapTools=i}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(e){var t=function(){function t(){}return t.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):t<-1074?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},t.Rgbe2float=function(e,t,i,r,n,o){n>0?(n=this.Ldexp(1,n-136),e[o+0]=t*n,e[o+1]=i*n,e[o+2]=r*n):(e[o+0]=0,e[o+1]=0,e[o+2]=0)},t.readStringLine=function(e,t){for(var i="",r="",n=t;n<e.length-t&&"\n"!=(r=String.fromCharCode(e[n]));n++)i+=r;return i},t.RGBE_ReadHeader=function(e){var t=0,i=0,r=this.readStringLine(e,0);if("#"!=r[0]||"?"!=r[1])throw"Bad HDR Format.";var n=!1,o=!1,s=0;do{s+=r.length+1,r=this.readStringLine(e,s),"FORMAT=32-bit_rle_rgbe"==r?o=!0:0==r.length&&(n=!0)}while(!n);if(!o)throw"HDR Bad header format, unsupported FORMAT";s+=r.length+1,r=this.readStringLine(e,s);var a=/^\-Y (.*) \+X (.*)$/g,l=a.exec(r);if(!l||l.length<3)throw"HDR Bad header format, no size";if(i=parseInt(l[2]),t=parseInt(l[1]),i<8||i>32767)throw"HDR Bad header format, unsupported size";return s+=r.length+1,{height:t,width:i,dataPosition:s}},t.GetCubeMapTextureData=function(t,i){var r=new Uint8Array(t),n=this.RGBE_ReadHeader(r),o=this.RGBE_ReadPixels_RLE(r,n);return e.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(o,n.width,n.height,i)},t.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},t.RGBE_ReadPixels_RLE=function(e,t){for(var i,r,n,o,s,a=t.height,l=t.width,h=t.dataPosition,c=0,u=0,f=0,d=new ArrayBuffer(4*l),p=new Uint8Array(d),m=new ArrayBuffer(t.width*t.height*4*3),g=new Float32Array(m);a>0;){if(i=e[h++],r=e[h++],n=e[h++],o=e[h++],2!=i||2!=r||128&n)throw"HDR Bad header format, not RLE";if((n<<8|o)!=l)throw"HDR Bad header format, wrong scan line width";for(c=0,f=0;f<4;f++)for(u=(f+1)*l;c<u;)if(i=e[h++],r=e[h++],i>128){if(0==(s=i-128)||s>u-c)throw"HDR Bad Format, bad scanline data (run)";for(;s-- >0;)p[c++]=r}else{if(0==(s=i)||s>u-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=r,--s>0)for(var v=0;v<s;v++)p[c++]=e[h++]}for(f=0;f<l;f++)i=p[f],r=p[f+l],n=p[f+2*l],o=p[f+3*l],this.Rgbe2float(g,i,r,n,o,(t.height-a)*l*3+3*f);a--}return g},t}();e.HDRTools=t}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h,c){void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===l&&(l=!1),void 0===h&&(h=null),void 0===c&&(c=null);var u=t.call(this,r)||this;if(u._useInGammaSpace=!1,u._generateHarmonics=!0,u._isBABYLONPreprocessed=!1,u._onLoad=null,u._onError=null,u.coordinatesMode=e.Texture.CUBIC_MODE,u.isPMREM=!1,u._isBlocking=!0,!i)return u;u.name=i,u.url=i,u.hasAlpha=!1,u.isCube=!0,u._textureMatrix=e.Matrix.Identity(),u._onLoad=h,u._onError=c,u.gammaSpace=!1;var f=r.getEngine().getCaps();return n?(u._isBABYLONPreprocessed=!1,u._noMipmap=o,u._size=n,u._useInGammaSpace=a,u._usePMREMGenerator=l&&f.textureLOD&&f.textureFloat&&!u._useInGammaSpace):(u._isBABYLONPreprocessed=!0,u._noMipmap=!1,u._useInGammaSpace=!1,u._usePMREMGenerator=f.textureLOD&&f.textureFloat&&!u._useInGammaSpace),u.isPMREM=u._usePMREMGenerator,u._texture=u._getFromCache(i,u._noMipmap),u._texture||(r.useDelayedTextureLoading?u.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:u.loadTexture()),u}return o(i,t),Object.defineProperty(i.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!0,configurable:!0}),i.prototype.loadBabylonTexture=function(){var t=this,i=0,r=null,n=this.getScene(),o=!this._useInGammaSpace&&n&&n.getEngine().getCaps().textureFloat?function(e){var n=new Array;if(!r)return n;for(var o=30,s=0;s<i;s++){n.push([]);for(var a=3*Math.pow(t._size>>s,2),l=0;l<6;l++){var h=r.subarray(o,o+a);n[s].push(h),o+=a}}return n}:null,s=function(n){var s=t.getScene();if(!s)return null;var a=new Int32Array(n);r=new Float32Array(n);var l=a[0];if(t._size=a[1],!t._texture)return null;t._texture.updateSize(t._size,t._size);var h=new e.SphericalPolynomial;h.x.copyFromFloats(r[2],r[3],r[4]),h.y.copyFromFloats(r[5],r[6],r[7]),h.z.copyFromFloats(r[8],r[9],r[10]),h.xx.copyFromFloats(r[11],r[12],r[13]),h.yy.copyFromFloats(r[14],r[15],r[16]),h.zz.copyFromFloats(r[17],r[18],r[19]),h.xy.copyFromFloats(r[20],r[21],r[22]),h.yz.copyFromFloats(r[23],r[24],r[25]),h.zx.copyFromFloats(r[26],r[27],r[28]),t.sphericalPolynomial=h,i=a[29];for(var c=30,u=[],f=3*Math.pow(t._size,2),d=0;d<6;d++)u.push(r.subarray(c,c+f)),c+=f;for(var p=[],m=null,g=0;g<6;g++){var v=null;if(1===l){v=u[[0,2,4,1,3,5][g]]}if(!o&&v){if(!s.getEngine().getCaps().textureFloat){var y=new ArrayBuffer(f);m=new Uint8Array(y)}for(var _=0;_<t._size*t._size;_++)if(t._useInGammaSpace&&(v[3*_+0]=Math.pow(v[3*_+0],e.ToGammaSpace),v[3*_+1]=Math.pow(v[3*_+1],e.ToGammaSpace),v[3*_+2]=Math.pow(v[3*_+2],e.ToGammaSpace)),m){var b=Math.max(255*v[3*_+0],0),x=Math.max(255*v[3*_+1],0),T=Math.max(255*v[3*_+2],0),E=Math.max(Math.max(b,x),T);if(E>255){var S=255/E;b*=S,x*=S,T*=S}m[3*_+0]=b,m[3*_+1]=x,m[3*_+2]=T}}m?p.push(m):p.push(v)}return p};n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,e.Engine.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,s,o,this._onLoad,this._onError))},i.prototype.loadHDRTexture=function(){var t=this,r=function(r){var n=t.getScene();if(!n)return null;var o=e.Internals.HDRTools.GetCubeMapTextureData(r,t._size);if(t._generateHarmonics){var s=e.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(o);t.sphericalPolynomial=s}for(var a=[],l=null,h=0;h<6;h++){if(!n.getEngine().getCaps().textureFloat){var c=new ArrayBuffer(t._size*t._size*3);l=new Uint8Array(c)}var u=o[i._facesMapping[h]];if(t._useInGammaSpace||l)for(var f=0;f<t._size*t._size;f++)if(t._useInGammaSpace&&(u[3*f+0]=Math.pow(u[3*f+0],e.ToGammaSpace),u[3*f+1]=Math.pow(u[3*f+1],e.ToGammaSpace),u[3*f+2]=Math.pow(u[3*f+2],e.ToGammaSpace)),l){var d=Math.max(255*u[3*f+0],0),p=Math.max(255*u[3*f+1],0),m=Math.max(255*u[3*f+2],0),g=Math.max(Math.max(d,p),m);if(g>255){var v=255/g;d*=v,p*=v,m*=v}l[3*f+0]=d,l[3*f+1]=p,l[3*f+2]=m}l?a.push(l):a.push(u)}return a},n=this.getScene();n&&(this._texture=n.getEngine().createRawCubeTextureFromUrl(this.url,n,this._size,e.Engine.TEXTUREFORMAT_RGB,n.getEngine().getCaps().textureFloat?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,r,null,this._onLoad,this._onError))},i.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},i.prototype.clone=function(){var e=this.getScene();if(!e)return this;var t=this._isBABYLONPreprocessed?null:this._size,r=new i(this.url,e,t,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);return r.level=this.level,r.wrapU=this.wrapU,r.wrapV=this.wrapV,r.coordinatesIndex=this.coordinatesIndex,r.coordinatesMode=this.coordinatesMode,r},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.prototype.setReflectionTextureMatrix=function(e){this._textureMatrix=e},i.Parse=function(t,i,r){var n=null;if(t.name&&!t.isRenderTarget){var o=t.isBABYLONPreprocessed?null:t.size;n=new e.HDRCubeTexture(r+t.name,i,o,t.noMipmap,t.generateHarmonics,t.useInGammaSpace,t.usePMREMGenerator),n.name=t.name,n.hasAlpha=t.hasAlpha,n.level=t.level,n.coordinatesMode=t.coordinatesMode,n.isBlocking=t.isBlocking}return n},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this._useInGammaSpace,e.generateHarmonics=this._generateHarmonics,e.usePMREMGenerator=this._usePMREMGenerator,e.isBABYLONPreprocessed=this._isBABYLONPreprocessed,e.customType="BABYLON.HDRCubeTexture",e.noMipmap=this._noMipmap,e.isBlocking=this._isBlocking,e},i.generateBabylonHDROnDisk=function(e,t,r){void 0===r&&(r=null);var n=function(e){var t=new Blob([e],{type:"application/octet-stream"}),i=window.URL.createObjectURL(t),r=document.createElement("a");document.body.appendChild(r),r.style.display="none",r.href=i,r.download="envmap.babylon.hdr",r.click()};i.generateBabylonHDR(e,t,n,r)},i.generateBabylonHDR=function(t,i,r,n){void 0===n&&(n=null),t&&e.Tools.IsExponentOfTwo(i)&&e.Tools.Error("Generation of Babylon HDR is coming back in 3.2.")},i}(e.BaseTexture);t._facesMapping=["right","left","up","down","front","back"],e.HDRCubeTexture=t}(r||(r={}));var a;!function(e){function t(e,t,r){r=r||2;var o=t&&t.length,s=o?t[0]*r:e.length,a=i(e,0,s,r,!0),l=new Array;if(!a)return l;var c,u,f,d,p=0,m=0,g=0;if(o&&(a=h(e,t,a,r)),e.length>80*r){p=c=e[0],m=u=e[1];for(var v=r;v<s;v+=r)f=e[v],d=e[v+1],f<p&&(p=f),d<m&&(m=d),f>c&&(c=f),d>u&&(u=d);g=Math.max(c-p,u-m)}return n(a,l,r,p,m,g,0),l}function i(e,t,i,r,n){var o,s=null;if(n===C(e,t,i,r)>0)for(o=t;o<i;o+=r)s=M(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=M(o,e[o],e[o+1],s);return s&&b(s,s.next)&&(A(s),s=s.next),s}function r(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!b(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)return;i=!0}}while(i||r!==t);return t}function n(e,t,i,h,c,u,f){if(e){!f&&u&&d(e,h,c,u);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,u?s(e,h,c,u):o(e))t.push(p.i/i),t.push(e.i/i),t.push(m.i/i),A(e),e=m.next,g=m.next;else if((e=m)===g){f?1===f?(e=a(e,t,i),n(e,t,i,h,c,u,2)):2===f&&l(e,t,i,h,c,u):n(r(e,void 0),t,i,h,c,u,1);break}}}function o(e){var t=e.prev,i=e,r=e.next;if(_(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(v(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function s(e,t,i,r){var n=e.prev,o=e,s=e.next;if(_(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,u=m(a,l,t,i,r),f=m(h,c,t,i,r),d=e.nextZ;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&v(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&_(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&v(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&_(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function a(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!b(n,o)&&x(n,r,r.next,o)&&E(n,o)&&E(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),A(r),A(r.next),r=e=o),r=r.next}while(r!==e);return r}function l(e,t,i,o,s,a){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&y(l,h)){var c=w(l,h);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,o,s,a,void 0),void n(c,t,i,o,s,a,void 0)}h=h.next}l=l.next}while(l!==e)}function h(e,t,n,o){var s,a,l,h,f,d=[];for(s=0,a=t.length;s<a;s++)l=t[s]*o,h=s<a-1?t[s+1]*o:e.length,f=i(e,l,h,o,!1),f===f.next&&(f.steiner=!0),d.push(g(f));for(d.sort(c),s=0;s<d.length;s++)u(d[s],n),n=r(n,n.next);return n}function c(e,t){return e.x-t.x}function u(e,t){if(t=f(e,t)){var i=w(t,e);r(i,i.next)}}function f(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var l,h=i,c=i.x,u=i.y,f=1/0;for(r=i.next;r!==h;)n>=r.x&&r.x>=c&&v(o<u?n:s,o,c,u,o<u?s:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<f||l===f&&r.x>i.x)&&E(r,e)&&(i=r,f=l),r=r.next;return i}function d(e,t,i,r){var n=e;do{null===n.z&&(n.z=m(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,p(n)}function p(e){var t,i,r,n,o,s,a,l,h=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<h&&(a++,r=r.nextZ);t++);for(l=h;a>0||l>0&&r;)0===a?(n=r,r=r.nextZ,l--):0!==l&&r?i.z<=r.z?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,a--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1);return e}function m(e,t,i,r,n){return e=32767*(e-i)/n,t=32767*(t-r)/n,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function g(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function v(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!T(e,t)&&E(e,t)&&E(t,e)&&S(e,t)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function b(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,r){return!!(b(e,t)&&b(i,r)||b(e,r)&&b(i,t))||_(e,t,i)>0!=_(e,t,r)>0&&_(i,r,e)>0!=_(i,r,t)>0}function T(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function E(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function S(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function w(e,t){var i=new D(e.i,e.x,e.y),r=new D(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function M(e,t,i,r){var n=new D(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(C(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var h=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(C(e,h,c,i))}var u=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,d=r[a+1]*i,p=r[a+2]*i;u+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)}function C(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}function R(e){for(var t=e[0][0].length,i={vertices:new Array,holes:new Array,dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}e.earcut=t;var D=function(){function e(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return e}();e.deviation=P,e.flatten=R}(a||(a={}));var r;!function(e){var t=function(e){function t(t,i){var r=e.call(this,t.x,t.y)||this;return r.index=i,r}return o(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,r=new Array;return e.forEach(function(e){if(0===r.length||!e.equalsWithEpsilon(r[0])){var n=new t(e,i.elements.length);r.push(n),i.elements.push(n)}}),r},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),r=function(){function t(){}return t.Rectangle=function(t,i,r,n){return[new e.Vector2(t,i),new e.Vector2(r,i),new e.Vector2(r,n),new e.Vector2(t,n)]},t.Circle=function(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=32);for(var o=new Array,s=0,a=2*Math.PI/n,l=0;l<n;l++)o.push(new e.Vector2(i+Math.cos(s)*t,r+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,r=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),n=[];for(i=0;i<(2147483646&r.length);i+=2)n.push(new e.Vector2(r[i],r[i+1]));return n},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=r;var n=function(){function t(t,r,n){this._points=new i,this._outlinepoints=new i,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this._name=t,this._scene=n;var o;o=r instanceof e.Path2?r.getPoints():r,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o)}return t.prototype._addToepoint=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._epoints.push(r.x,r.y)}},t.prototype.addHole=function(e){this._points.add(e);var t=new i;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},t.prototype.build=function(t,i){var r=this;void 0===t&&(t=!1),void 0===i&&(i=0);var n=new e.Mesh(this._name,this._scene),o=new Array,s=new Array,l=new Array,h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),l.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});for(var c=new Array,u=a.earcut(this._epoints,this._eholes,2),f=0;f<u.length;f++)c.push(u[f]);if(i>0){var d=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),l.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});for(var p=c.length,f=0;f<p;f+=3){var m=c[f+0],g=c[f+1],v=c[f+2];c.push(v+d),c.push(g+d),c.push(m+d)}this.addSide(s,o,l,c,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){r.addSide(s,o,l,c,h,e,i,!0)})}return n.setVerticesData(e.VertexBuffer.PositionKind,s,t),n.setVerticesData(e.VertexBuffer.NormalKind,o,t),n.setVerticesData(e.VertexBuffer.UVKind,l,t),n.setIndices(c),n},t.prototype.addSide=function(t,i,r,n,o,s,a,l){for(var h=t.length/3,c=0,u=0;u<s.elements.length;u++){var f,d=s.elements[u];f=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(d.x,0,d.y),t.push(d.x,-a,d.y),t.push(f.x,0,f.y),t.push(f.x,-a,f.y);var p=new e.Vector3(d.x,0,d.y),m=new e.Vector3(f.x,0,f.y),g=m.subtract(p),v=new e.Vector3(0,1,0),y=e.Vector3.Cross(g,v);y=y.normalize(),r.push(c/o.width,0),r.push(c/o.width,1),c+=g.length(),r.push(c/o.width,0),r.push(c/o.width,1),l?(i.push(y.x,y.y,y.z),i.push(y.x,y.y,y.z),i.push(y.x,y.y,y.z),i.push(y.x,y.y,y.z),n.push(h),n.push(h+2),n.push(h+1),n.push(h+1),n.push(h+2),n.push(h+3)):(i.push(-y.x,-y.y,-y.z),i.push(-y.x,-y.y,-y.z),i.push(-y.x,-y.y,-y.z),i.push(-y.x,-y.y,-y.z),n.push(h),n.push(h+1),n.push(h+2),n.push(h+1),n.push(h+3),n.push(h+2)),h+=4}},t}();e.PolygonMeshBuilder=n}(r||(r={}));var r;!function(e){var t=0,i=function(){function t(e,t,i){this.pos=e,this.normal=t,this.uv=i}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(i,r){return new t(e.Vector3.Lerp(this.pos,i.pos,r),e.Vector3.Lerp(this.normal,i.normal,r),e.Vector2.Lerp(this.uv,i.uv,r))},t}(),r=function(){function t(e,t){this.normal=e,this.w=t}return t.FromPoints=function(i,r,n){var o=n.subtract(i),s=r.subtract(i);if(0===o.lengthSquared()||0===s.lengthSquared())return null;var a=e.Vector3.Normalize(e.Vector3.Cross(o,s));return new t(a,e.Vector3.Dot(a,i))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(i,r,o,s,a){var l,h,c=0,u=[];for(l=0;l<i.vertices.length;l++){h=e.Vector3.Dot(this.normal,i.vertices[l].pos)-this.w;var f=h<-t.EPSILON?2:h>t.EPSILON?1:0;c|=f,u.push(f)}switch(c){case 0:(e.Vector3.Dot(this.normal,i.plane.normal)>0?r:o).push(i);break;case 1:s.push(i);break;case 2:a.push(i);break;case 3:var d=[],p=[];for(l=0;l<i.vertices.length;l++){var m=(l+1)%i.vertices.length,g=u[l],v=u[m],y=i.vertices[l],_=i.vertices[m];if(2!==g&&d.push(y),1!==g&&p.push(2!==g?y.clone():y),3==(g|v)){h=(this.w-e.Vector3.Dot(this.normal,y.pos))/e.Vector3.Dot(this.normal,_.pos.subtract(y.pos));var b=y.interpolate(_,h);d.push(b),p.push(b.clone())}}var x;d.length>=3&&(x=new n(d,i.shared),x.plane&&s.push(x)),p.length>=3&&(x=new n(p,i.shared),x.plane&&a.push(x))}},t}();r.EPSILON=1e-5;var n=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=r.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){return new e(this.vertices.map(function(e){return e.clone()}),this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),o=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=new Array,e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=new Array,i=new Array,r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var i=new Array,r=new Array,n=0;n<t.length;n++)this.plane.splitPolygon(t[n],this.polygons,this.polygons,i,r);i.length&&(this.front||(this.front=new e),this.front.build(i)),r.length&&(this.back||(this.back=new e),this.back.build(r))}},e}(),s=function(){function r(){this.polygons=new Array}return r.FromMesh=function(o){var s,a,l,h,c,u,f,d,p,m,g=new Array,v=null;if(!(o instanceof e.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";o.computeWorldMatrix(!0),f=o.getWorldMatrix(),d=o.position.clone(),p=o.rotation.clone(),o.rotationQuaternion&&(v=o.rotationQuaternion.clone()),m=o.scaling.clone();for(var y=o.getIndices(),_=o.getVerticesData(e.VertexBuffer.PositionKind),b=o.getVerticesData(e.VertexBuffer.NormalKind),x=o.getVerticesData(e.VertexBuffer.UVKind),T=o.subMeshes,E=0,S=T.length;E<S;E++)for(var w=T[E].indexStart,M=T[E].indexCount+T[E].indexStart;w<M;w+=3){u=[];for(var A=0;A<3;A++){var P=new e.Vector3(b[3*y[w+A]],b[3*y[w+A]+1],b[3*y[w+A]+2]);l=new e.Vector2(x[2*y[w+A]],x[2*y[w+A]+1]);var C=new e.Vector3(_[3*y[w+A]],_[3*y[w+A]+1],_[3*y[w+A]+2]);h=e.Vector3.TransformCoordinates(C,f),a=e.Vector3.TransformNormal(P,f),s=new i(h,a,l),u.push(s)}c=new n(u,{subMeshId:E,meshId:t,materialIndex:T[E].materialIndex}),c.plane&&g.push(c)}var R=r.FromPolygons(g);return R.matrix=f,R.position=d,R.rotation=p,R.scaling=m,R.rotationQuaternion=v,t++,R},r.FromPolygons=function(e){var t=new r;return t.polygons=e,t},r.prototype.clone=function(){var e=new r;return e.polygons=this.polygons.map(function(e){return e.clone()}),e.copyTransformAttributes(this),e},r.prototype.union=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.unionInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this.polygons=t.allPolygons()},r.prototype.subtract=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.subtractInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},r.prototype.intersect=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),r.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},r.prototype.intersectInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},r.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},r.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},r.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},r.prototype.buildMeshGeometry=function(t,i,r){var n=this.matrix.clone();n.invert();var o,s,a,l=new e.Mesh(t,i),h=[],c=[],u=[],f=[],d=e.Vector3.Zero(),p=e.Vector3.Zero(),m=e.Vector2.Zero(),g=this.polygons,v=[0,0,0],y={},_=0,b={};r&&g.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var x=0,T=g.length;x<T;x++){o=g[x],b[o.shared.meshId]||(b[o.shared.meshId]={}),b[o.shared.meshId][o.shared.subMeshId]||(b[o.shared.meshId][o.shared.subMeshId]={indexStart:1/0,indexEnd:-1/0,materialIndex:o.shared.materialIndex}),a=b[o.shared.meshId][o.shared.subMeshId];for(var E=2,S=o.vertices.length;E<S;E++){v[0]=0,v[1]=E-1,v[2]=E;for(var w=0;w<3;w++){d.copyFrom(o.vertices[v[w]].pos),p.copyFrom(o.vertices[v[w]].normal),m.copyFrom(o.vertices[v[w]].uv);var M=e.Vector3.TransformCoordinates(d,n),A=e.Vector3.TransformNormal(p,n);s=y[M.x+","+M.y+","+M.z],void 0!==s&&u[3*s]===A.x&&u[3*s+1]===A.y&&u[3*s+2]===A.z&&f[2*s]===m.x&&f[2*s+1]===m.y||(h.push(M.x,M.y,M.z),f.push(m.x,m.y),u.push(p.x,p.y,p.z),s=y[M.x+","+M.y+","+M.z]=h.length/3-1),c.push(s),a.indexStart=Math.min(_,a.indexStart),a.indexEnd=Math.max(_,a.indexEnd),_++}}}if(l.setVerticesData(e.VertexBuffer.PositionKind,h),l.setVerticesData(e.VertexBuffer.NormalKind,u),l.setVerticesData(e.VertexBuffer.UVKind,f),l.setIndices(c,null),r){var P,C=0;l.subMeshes=new Array;for(var R in b){P=-1;for(var D in b[R])a=b[R][D],e.SubMesh.CreateFromIndices(a.materialIndex+C,a.indexStart,a.indexEnd-a.indexStart+1,l),P=Math.max(a.materialIndex,P);C+=++P}}return l},r.prototype.toMesh=function(e,t,i,r){var n=this.buildMeshGeometry(e,i,r);return n.material=t,n.position.copyFrom(this.position),n.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(n.rotationQuaternion=this.rotationQuaternion.clone()),n.scaling.copyFrom(this.scaling),n.computeWorldMatrix(!0),n},r}();e.CSG=s}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o){this.size=t,this.position=i,this.alphaMode=e.Engine.ALPHA_ONEONE,this.color=r||new e.Color3(1,1,1),this.texture=n?new e.Texture(n,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return t.AddFlare=function(e,i,r,n,o){return new t(e,i,r,n,o)},t.prototype.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},t}();e.LensFlare=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.viewportBorder=0,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=r||e.Engine.LastCreatedScene,this._emitter=i,this.id=t,r.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return r.activeCamera&&e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&r.activeCamera.layerMask)};var n=r.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(n,o,e.VertexBuffer.PositionKind,!1,!1,2);var s=[];s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),this._indexBuffer=n.createIndexBuffer(s),this._effect=n.createEffect("lensFlare",[e.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.setEmitter=function(e){this._emitter=e},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var i=this.getEmitterPosition();return i=e.Vector3.Project(i,e.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=i.x,this._positionY=i.y,i=e.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),this.viewportBorder>0&&(t.x-=this.viewportBorder,t.y-=this.viewportBorder,t.width+=2*this.viewportBorder,t.height+=2*this.viewportBorder,i.x+=this.viewportBorder,i.y+=this.viewportBorder,this._positionX+=this.viewportBorder,this._positionY+=this.viewportBorder),i.z>0&&(this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&(this._positionY,t.y,t.height),!0)},t.prototype._isVisible=function(){if(!this._isEnabled||!this._scene.activeCamera)return!1;var t=this.getEmitterPosition(),i=t.subtract(this._scene.activeCamera.globalPosition),r=i.length();i.normalize();var n=new e.Ray(this._scene.activeCamera.globalPosition,i),o=this._scene.pickWithRay(n,this.meshesSelectionPredicate,!0);return!o||!o.hit||o.distance>r},t.prototype.render=function(){if(!this._effect.isReady()||!this._scene.activeCamera)return!1;var t=this._scene.getEngine(),i=this._scene.activeCamera.viewport,r=i.toGlobal(t.getRenderWidth(!0),t.getRenderHeight(!0));if(!this.computeEffectivePosition(r))return!1;if(!this._isVisible())return!1;var n,o;n=this._positionX<this.borderLimit+r.x?this.borderLimit+r.x-this._positionX:this._positionX>r.x+r.width-this.borderLimit?this._positionX-r.x-r.width+this.borderLimit:0,o=this._positionY<this.borderLimit+r.y?this.borderLimit+r.y-this._positionY:this._positionY>r.y+r.height-this.borderLimit?this._positionY-r.y-r.height+this.borderLimit:0;var s=n>o?n:o;(s-=this.viewportBorder)>this.borderLimit&&(s=this.borderLimit);var a=1-s/this.borderLimit;if(a<0)return!1;a>1&&(a=1),this.viewportBorder>0&&(r.x+=this.viewportBorder,r.y+=this.viewportBorder,r.width-=2*this.viewportBorder,r.height-=2*this.viewportBorder,this._positionX-=this.viewportBorder,this._positionY-=this.viewportBorder);var l=r.x+r.width/2,h=r.y+r.height/2,c=l-this._positionX,u=h-this._positionY;t.enableEffect(this._effect),t.setState(!1),t.setDepthBuffer(!1),t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var f=0;f<this.lensFlares.length;f++){var d=this.lensFlares[f];t.setAlphaMode(d.alphaMode);var p=l-c*d.position,m=h-u*d.position,g=d.size,v=d.size*t.getAspectRatio(this._scene.activeCamera,!0),y=p/(r.width+2*r.x)*2-1,_=1-m/(r.height+2*r.y)*2,b=e.Matrix.FromValues(g/2,0,0,0,0,v/2,0,0,0,0,1,0,y,_,0,1);this._effect.setMatrix("viewportMatrix",b),this._effect.setTexture("textureSampler",d.texture),this._effect.setFloat4("color",d.color.r*a,d.color.g*a,d.color.b*a,1),t.draw(!0,0,6)}return t.setDepthBuffer(!0),t.setAlphaMode(e.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];for(t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var i=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(i,1)},t.Parse=function(i,r,n){var o=r.getLastEntryByID(i.emitterId),s=i.name||"lensFlareSystem#"+i.emitterId,a=new t(s,o,r);a.id=i.id||s,a.borderLimit=i.borderLimit;for(var l=0;l<i.flares.length;l++){var h=i.flares[l];e.LensFlare.AddFlare(h.size,h.position,e.Color3.FromArray(h.color),h.textureName?n+h.textureName:"",a)}return a},t.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var i=0;i<this.lensFlares.length;i++){var r=this.lensFlares[i];t.flares.push({size:r.size,position:r.position,color:r.color.asArray(),textureName:e.Tools.GetFilename(r.texture?r.texture.name:"")})}return t},t}();e.LensFlareSystem=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint,this._physicsJoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e}();t.DistanceJoint=0,t.HingeJoint=1,t.BallAndSocketJoint=2,t.WheelJoint=3,t.SliderJoint=4,t.PrismaticJoint=5,t.UniversalJoint=6,t.Hinge2Joint=t.WheelJoint,t.PointToPointJoint=8,t.SpringJoint=9,t.LockJoint=10,e.PhysicsJoint=t;var i=function(e){function i(i){return e.call(this,t.DistanceJoint,i)||this}return o(i,e),i.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},i}(t);e.DistanceJoint=i;var r=function(e){function t(t,i){return e.call(this,t,i)||this}return o(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(t);e.MotorEnabledJoint=r;var n=function(e){function i(i){return e.call(this,t.HingeJoint,i)||this}return o(i,e),i.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e||0,t)},i.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},i}(r);e.HingeJoint=n;var s=function(e){function i(i){return e.call(this,t.Hinge2Joint,i)||this}return o(i,e),i.prototype.setMotor=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,e||0,t,i)},i.prototype.setLimit=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,e,t,i)},i}(r);e.Hinge2Joint=s}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n){void 0===r&&(r={mass:0});var o=this;if(this.object=t,this.type=i,this._options=r,this._scene=n,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=e.Vector3.Zero(),this._isDisposed=!1,this._tmpQuat=new e.Quaternion,this._tmpQuat2=new e.Quaternion,this.beforeStep=function(){o._physicsEngine&&(o.object.translate(o._deltaPosition,-1),o._deltaRotationConjugated&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotationConjugated,o.object.rotationQuaternion),o.object.computeWorldMatrix(!1),o.object.parent&&o.object.rotationQuaternion?(o.getParentsRotation(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o._tmpQuat)):o._tmpQuat.copyFrom(o.object.rotationQuaternion||new e.Quaternion),o._options.disableBidirectionalTransformation||o.object.rotationQuaternion&&o._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(o,o.object.getAbsolutePivotPoint(),o._tmpQuat),o._onBeforePhysicsStepCallbacks.forEach(function(e){e(o)}))},this.afterStep=function(){o._physicsEngine&&(o._onAfterPhysicsStepCallbacks.forEach(function(e){e(o)}),o._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(o),o.object.parent&&o.object.rotationQuaternion&&(o.getParentsRotation(),o._tmpQuat.conjugateInPlace(),o._tmpQuat.multiplyToRef(o.object.rotationQuaternion,o.object.rotationQuaternion)),o.object.setAbsolutePosition(o.object.position),o._deltaRotation&&o.object.rotationQuaternion&&o.object.rotationQuaternion.multiplyToRef(o._deltaRotation,o.object.rotationQuaternion),o.object.translate(o._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(e){if((o._onPhysicsCollideCallbacks.length||o.onCollideEvent)&&o._physicsEngine){var t=o._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&(o.onCollideEvent&&o.onCollideEvent(o,t),o._onPhysicsCollideCallbacks.filter(function(e){return-1!==e.otherImpostors.indexOf(t)}).forEach(function(e){e.callback(o,t)}))}},!this.object)return void e.Tools.Error("No object was provided. A physics object is obligatory");!this._scene&&t.getScene&&(this._scene=t.getScene()),this._scene&&(this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new e.Quaternion),this._options.mass=void 0===r.mass?0:r.mass,this._options.friction=void 0===r.friction?.2:r.friction,this._options.restitution=void 0===r.restitution?.2:r.restitution,this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&e.Tools.Warn("You must affect impostors to children before affecting impostor to parent.")):e.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))}return Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(e){this.setMass(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,e)},enumerable:!0,configurable:!0}),t.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},t.prototype._getPhysicsParent=function(){if(this.object.parent instanceof e.AbstractMesh){return this.object.parent.physicsImpostor}return null},t.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},t.prototype.setScalingUpdated=function(e){this.forceUpdate()},t.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(t.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(e){this._parent=e},enumerable:!0,configurable:!0}),t.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},t.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var e=this.object.rotationQuaternion;this.object.rotationQuaternion=t.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var i=this.object.getBoundingInfo(),r=i.boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=e,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),r}return t.DEFAULT_OBJECT_SIZE},t.prototype.getObjectCenter=function(){if(this.object.getBoundingInfo){return this.object.getBoundingInfo().boundingBox.centerWorld}return this.object.position},t.prototype.getParam=function(e){return this._options[e]},t.prototype.setParam=function(e,t){this._options[e]=t,this._bodyUpdateRequired=!0},t.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},t.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):e.Vector3.Zero()},t.prototype.setLinearVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},t.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):e.Vector3.Zero()},t.prototype.setAngularVelocity=function(e){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},t.prototype.executeNativeFunction=function(e){this._physicsEngine&&e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},t.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},t.prototype.unregisterBeforePhysicsStep=function(t){var i=this._onBeforePhysicsStepCallbacks.indexOf(t);i>-1?this._onBeforePhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},t.prototype.unregisterAfterPhysicsStep=function(t){var i=this._onAfterPhysicsStepCallbacks.indexOf(t);i>-1?this._onAfterPhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerOnPhysicsCollide=function(e,t){var i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})},t.prototype.unregisterOnPhysicsCollide=function(t,i){var r=t instanceof Array?t:[t],n=this._onPhysicsCollideCallbacks.indexOf({callback:i,otherImpostors:r});n>-1?this._onPhysicsCollideCallbacks.splice(n,1):e.Tools.Warn("Function to remove was not found")},t.prototype.getParentsRotation=function(){var t=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):e.Quaternion.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.parent;return this._tmpQuat},t.prototype.applyForce=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t),this},t.prototype.applyImpulse=function(e,t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t),this},t.prototype.createJoint=function(t,i,r){var n=new e.PhysicsJoint(i,r);return this.addJoint(t,n),this},t.prototype.addJoint=function(e,t){return this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine&&this._physicsEngine.addJoint(this,e,t),this},t.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},t.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},t.prototype.clone=function(e){return e?new t(e,this.type,this._options,this._scene):null},t.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach(function(t){e._physicsEngine&&e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},t.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},t.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new e.Quaternion),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},t.prototype.getBoxSizeToRef=function(e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,e),this},t.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},t.prototype.syncBoneWithImpostor=function(i,r,n,o,s){var a=t._tmpVecs[0],l=this.object;if(l.rotationQuaternion)if(s){var h=t._tmpQuat;l.rotationQuaternion.multiplyToRef(s,h),i.setRotationQuaternion(h,e.Space.WORLD,r)}else i.setRotationQuaternion(l.rotationQuaternion,e.Space.WORLD,r);a.x=0,a.y=0,a.z=0,n&&(a.x=n.x,a.y=n.y,a.z=n.z,i.getDirectionToRef(a,r,a),void 0!==o&&null!==o||(o=n.length()),a.x*=o,a.y*=o,a.z*=o),i.getParent()?(a.addInPlace(l.getAbsolutePosition()),i.setAbsolutePosition(a,r)):(r.setAbsolutePosition(l.getAbsolutePosition()),r.position.x-=a.x,r.position.y-=a.y,r.position.z-=a.z)},t.prototype.syncImpostorWithBone=function(i,r,n,o,s,a){var l=this.object;if(l.rotationQuaternion)if(s){var h=t._tmpQuat;i.getRotationQuaternionToRef(e.Space.WORLD,r,h),h.multiplyToRef(s,l.rotationQuaternion)}else i.getRotationQuaternionToRef(e.Space.WORLD,r,l.rotationQuaternion);var c=t._tmpVecs[0],u=t._tmpVecs[1];a||(a=t._tmpVecs[2],a.x=0,a.y=1,a.z=0),i.getDirectionToRef(a,r,u),i.getAbsolutePositionToRef(r,c),void 0!==o&&null!==o||!n||(o=n.length()),void 0!==o&&null!==o&&(c.x+=u.x*o,c.y+=u.y*o,c.z+=u.z*o),l.setAbsolutePosition(c)},t}();t.DEFAULT_OBJECT_SIZE=new e.Vector3(1,1,1),t.IDENTITY_QUATERNION=e.Quaternion.Identity(),t._tmpVecs=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()],t._tmpQuat=e.Quaternion.Identity(),t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CylinderImpostor=7,t.ParticleImpostor=8,t.HeightmapImpostor=9,e.PhysicsImpostor=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){if(void 0===i&&(i=new e.CannonJSPlugin),this._physicsPlugin=i,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new e.Vector3(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return t.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},t.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},t.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},t.prototype.dispose=function(){this._impostors.forEach(function(e){e.dispose()}),this._physicsPlugin.dispose()},t.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},t.prototype.addImpostor=function(e){e.uniqueId=this._impostors.push(e),e.parent||this._physicsPlugin.generatePhysicsBody(e)},t.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);if(t>-1){var i=this._impostors.splice(t,1);i.length&&(i[0].physicsBody=null)}},t.prototype.addJoint=function(e,t,i){var r={mainImpostor:e,connectedImpostor:t,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(r),this._physicsPlugin.generateJoint(r)},t.prototype.removeJoint=function(e,t,i){var r=this._joints.filter(function(r){return r.connectedImpostor===t&&r.joint===i&&r.mainImpostor===e});r.length&&this._physicsPlugin.removeJoint(r[0])},t.prototype._step=function(e){var t=this;this._impostors.forEach(function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)}),e>.1?e=.1:e<=0&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},t.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},t.prototype.getImpostors=function(){return this._impostors},t.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t];return null},t.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t];return null},t}();t.Epsilon=.001,e.PhysicsEngine=t}(r||(r={}));var r;!function(e){var t;!function(e){e[e.Constant=0]="Constant",e[e.Linear=1]="Linear"}(t=e.PhysicsRadialImpulseFalloff||(e.PhysicsRadialImpulseFalloff={}));var i;!function(e){e[e.Center=0]="Center",e[e.Perpendicular=1]="Perpendicular"}(i=e.PhysicsUpdraftMode||(e.PhysicsUpdraftMode={}));var r=function(){function i(t){this._scene=t,this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine||e.Tools.Warn("Physics engine not enabled. Please enable the physics before you can use the methods.")}return i.prototype.applyRadialExplosionImpulse=function(i,r,o,s){if(void 0===s&&(s=t.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call this method."),null;var a=this._physicsEngine.getImpostors();if(0===a.length)return null;var l=new n(this._scene);return a.forEach(function(e){var t=l.getImpostorForceAndContactPoint(e,i,r,o,s);t&&e.applyImpulse(t.force,t.contactPoint)}),l.dispose(!1),l},i.prototype.applyRadialExplosionForce=function(i,r,o,s){if(void 0===s&&(s=t.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;var a=this._physicsEngine.getImpostors();if(0===a.length)return null;var l=new n(this._scene);return a.forEach(function(e){var t=l.getImpostorForceAndContactPoint(e,i,r,o,s);t&&e.applyForce(t.force,t.contactPoint)}),l.dispose(!1),l},i.prototype.gravitationalField=function(i,r,n,s){if(void 0===s&&(s=t.Constant),!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var a=new o(this,this._scene,i,r,n,s);return a.dispose(!1),a},i.prototype.updraft=function(t,i,r,n,o){if(!this._physicsEngine)return e.Tools.Warn("Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."),null;if(0===this._physicsEngine.getImpostors().length)return null;var a=new s(this._physicsEngine,this._scene,t,i,r,n,o);return a.dispose(!1),a},i}();e.PhysicsHelper=r;var n=function(){function i(e){this._sphereOptions={segments:32,diameter:1},this._rays=[],this._dataFetched=!1,this._scene=e}return i.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere,rays:this._rays}},i.prototype.getImpostorForceAndContactPoint=function(i,r,n,o,s){if(0===i.mass)return null;if(!this._intersectsWithSphere(i,r,n))return null;var a=i.object,l=i.getObjectCenter(),h=l.subtract(r),c=new e.Ray(r,h,n);this._rays.push(c);var u=c.intersectsMesh(a),f=u.pickedPoint;if(!f)return null;var d=e.Vector3.Distance(r,f);if(d>n)return null;var p=s===t.Constant?o:o*(1-d/n);return{force:h.multiplyByFloats(p,p,p),contactPoint:f}},i.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},i.prototype._prepareSphere=function(){this._sphere||(this._sphere=e.MeshBuilder.CreateSphere("radialExplosionEventSphere",this._sphereOptions,this._scene),this._sphere.isVisible=!1)},i.prototype._intersectsWithSphere=function(t,i,r){var n=t.object;return this._prepareSphere(),this._sphere.position=i,this._sphere.scaling=new e.Vector3(2*r,2*r,2*r),this._sphere._updateBoundingInfo(),this._sphere.computeWorldMatrix(!0),this._sphere.intersectsMesh(n,!0)},i}();e.PhysicsRadialExplosionEvent=n;var o=function(){function e(e,i,r,n,o,s){void 0===s&&(s=t.Constant),this._dataFetched=!1,this._physicsHelper=e,this._scene=i,this._origin=r,this._radius=n,this._strength=o,this._falloff=s,this._tickCallback=this._tick.bind(this)}return e.prototype.getData=function(){return this._dataFetched=!0,{sphere:this._sphere}},e.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},e.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},e.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._sphere.dispose():setTimeout(function(){t._dataFetched||t._sphere.dispose()},0)},e.prototype._tick=function(){if(this._sphere)this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);else{var e=this._physicsHelper.applyRadialExplosionForce(this._origin,this._radius,-1*this._strength,this._falloff);e&&(this._sphere=e.getData().sphere.clone("radialExplosionEventSphereClone"))}},e}();e.PhysicsGravitationalFieldEvent=o;var s=function(){function t(t,r,n,o,s,a,l){this._originTop=e.Vector3.Zero(),this._originDirection=e.Vector3.Zero(),this._cylinderPosition=e.Vector3.Zero(),this._dataFetched=!1,this._physicsEngine=t,this._scene=r,this._origin=n,this._radius=o,this._strength=s,this._height=a,this._updraftMode=l,this._origin.addToRef(new e.Vector3(0,this._height/2,0),this._cylinderPosition),this._origin.addToRef(new e.Vector3(0,this._height,0),this._originTop),this._updraftMode===i.Perpendicular&&(this._originDirection=this._origin.subtract(this._originTop).normalize()),this._tickCallback=this._tick.bind(this)}return t.prototype.getData=function(){return this._dataFetched=!0,{cylinder:this._cylinder}},t.prototype.enable=function(){this._tickCallback.call(this),this._scene.registerBeforeRender(this._tickCallback)},t.prototype.disable=function(){this._scene.unregisterBeforeRender(this._tickCallback)},t.prototype.dispose=function(e){var t=this;void 0===e&&(e=!0),e?this._cylinder.dispose():setTimeout(function(){t._dataFetched||t._cylinder.dispose()},0)},t.prototype.getImpostorForceAndContactPoint=function(e){if(0===e.mass)return null;if(!this._intersectsWithCylinder(e))return null;var t=e.getObjectCenter();if(this._updraftMode===i.Perpendicular)var r=this._originDirection;else var r=t.subtract(this._originTop);var n=-1*this._strength;return{force:r.multiplyByFloats(n,n,n),contactPoint:t}},t.prototype._tick=function(){var e=this;this._physicsEngine.getImpostors().forEach(function(t){var i=e.getImpostorForceAndContactPoint(t);i&&t.applyForce(i.force,i.contactPoint)})},t.prototype._prepareCylinder=function(){this._cylinder||(this._cylinder=e.MeshBuilder.CreateCylinder("updraftEventCylinder",{height:this._height,diameter:2*this._radius},this._scene),this._cylinder.isVisible=!1)},t.prototype._intersectsWithCylinder=function(e){var t=e.object;return this._prepareCylinder(),this._cylinder.position=this._cylinderPosition,this._cylinder.intersectsMesh(t,!0)},t}();e.PhysicsUpdraftEvent=s}(r||(r={}));var r;!function(e){var t=function(){function t(t,r){if(void 0===t&&(t=!0),void 0===r&&(r=10),this._useDeltaForWorldStep=t,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this.BJSCANNON="undefined"!=typeof CANNON?CANNON:i(!function(){var e=new Error('Cannot find module "cannon"');throw e.code="MODULE_NOT_FOUND",e}()),this._minus90X=new e.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new e.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=e.Vector3.Zero(),this._tmpDeltaPosition=e.Vector3.Zero(),this._tmpUnityRotation=new e.Quaternion,!this.isSupported())return void e.Tools.Error("CannonJS is not available. Please make sure you included the js file.");this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=r}return t.prototype.setGravity=function(e){this.world.gravity.copy(e)},t.prototype.setTimeStep=function(e){this._fixedTimeStep=e},t.prototype.getTimeStep=function(){return this._fixedTimeStep},t.prototype.executeStep=function(e,t){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?e:0,3)},t.prototype.applyImpulse=function(e,t,i){var r=new this.BJSCANNON.Vec3(i.x,i.y,i.z),n=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(n,r)},t.prototype.applyForce=function(e,t,i){var r=new this.BJSCANNON.Vec3(i.x,i.y,i.z),n=new this.BJSCANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyForce(n,r)},t.prototype.generatePhysicsBody=function(e){if(e.parent)return void(e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate()));if(e.isBodyInitRequired()){var t=this._createShape(e),i=e.physicsBody;i&&this.removePhysicsBody(e);var r=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),n={mass:e.getParam("mass"),material:r},o=e.getParam("nativeOptions");for(var s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);e.physicsBody=new this.BJSCANNON.Body(n),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),this.world.add(e.physicsBody),i&&["force","torque","velocity","angularVelocity"].forEach(function(t){e.physicsBody[t].copy(i[t])}),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)},t.prototype._processChildMeshes=function(t){var i=this,r=t.object.getChildMeshes?t.object.getChildMeshes(!0):[],n=t.object.rotationQuaternion;if(r.length){var o=function(r,s){if(n&&s.rotationQuaternion){var a=s.getPhysicsImpostor();if(a){if(a.parent!==t){var l=s.getAbsolutePosition().subtract(t.object.getAbsolutePosition()),h=s.rotationQuaternion.multiply(e.Quaternion.Inverse(n));a.physicsBody&&(i.removePhysicsBody(a),a.physicsBody=null),a.parent=t,a.resetUpdateFlags(),t.physicsBody.addShape(i._createShape(a),new i.BJSCANNON.Vec3(l.x,l.y,l.z),new i.BJSCANNON.Quaternion(h.x,h.y,h.z,h.w)),t.physicsBody.mass+=a.getParam("mass")}}n.multiplyInPlace(s.rotationQuaternion),s.getChildMeshes(!0).filter(function(e){return!!e.physicsImpostor}).forEach(o.bind(i,s.getAbsolutePosition()))}};r.filter(function(e){return!!e.physicsImpostor}).forEach(o.bind(this,t.object.getAbsolutePosition()))}},t.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),this.world.remove(e.physicsBody)},t.prototype.generateJoint=function(t){var i=t.mainImpostor.physicsBody,r=t.connectedImpostor.physicsBody;if(i&&r){var n,o=t.joint.jointData,s={pivotA:o.mainPivot?(new this.BJSCANNON.Vec3).copy(o.mainPivot):null,pivotB:o.connectedPivot?(new this.BJSCANNON.Vec3).copy(o.connectedPivot):null,axisA:o.mainAxis?(new this.BJSCANNON.Vec3).copy(o.mainAxis):null,axisB:o.connectedAxis?(new this.BJSCANNON.Vec3).copy(o.connectedAxis):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(t.joint.type){case e.PhysicsJoint.HingeJoint:case e.PhysicsJoint.Hinge2Joint:n=new this.BJSCANNON.HingeConstraint(i,r,s);break;case e.PhysicsJoint.DistanceJoint:n=new this.BJSCANNON.DistanceConstraint(i,r,o.maxDistance||2);break;case e.PhysicsJoint.SpringJoint:var a=o;n=new this.BJSCANNON.Spring(i,r,{restLength:a.length,stiffness:a.stiffness,damping:a.damping,localAnchorA:s.pivotA,localAnchorB:s.pivotB});break;case e.PhysicsJoint.LockJoint:n=new this.BJSCANNON.LockConstraint(i,r,s);break;case e.PhysicsJoint.PointToPointJoint:case e.PhysicsJoint.BallAndSocketJoint:default:n=new this.BJSCANNON.PointToPointConstraint(i,s.pivotA,r,s.pivotA,s.maxForce)}n.collideConnected=!!o.collision,t.joint.physicsJoint=n,t.joint.type!==e.PhysicsJoint.SpringJoint?this.world.addConstraint(n):t.mainImpostor.registerAfterPhysicsStep(function(){n.applyForce()})}},t.prototype.removeJoint=function(e){this.world.removeConstraint(e.joint.physicsJoint)},t.prototype._addMaterial=function(e,t,i){var r,n;for(r=0;r<this._physicsMaterials.length;r++)if(n=this._physicsMaterials[r],n.friction===t&&n.restitution===i)return n;var o=new this.BJSCANNON.Material(e);return o.friction=t,o.restitution=i,this._physicsMaterials.push(o),o},t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype._createShape=function(t){var i,r=t.object,n=t.getObjectExtendSize();switch(t.type){case e.PhysicsImpostor.SphereImpostor:var o=n.x,s=n.y,a=n.z;i=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(a))/2);break;case e.PhysicsImpostor.CylinderImpostor:i=new this.BJSCANNON.Cylinder(this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.x)/2,this._checkWithEpsilon(n.y),16);break;case e.PhysicsImpostor.BoxImpostor:var l=n.scale(.5);i=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(l.x),this._checkWithEpsilon(l.y),this._checkWithEpsilon(l.z)));break;case e.PhysicsImpostor.PlaneImpostor:e.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),i=new this.BJSCANNON.Plane;break;case e.PhysicsImpostor.MeshImpostor:var h=r.getVerticesData?r.getVerticesData(e.VertexBuffer.PositionKind):[],c=r.getIndices?r.getIndices():[];if(!h)return;var u=r.position.clone(),f=r.rotation&&r.rotation.clone(),d=r.rotationQuaternion&&r.rotationQuaternion.clone();r.position.copyFromFloats(0,0,0),r.rotation&&r.rotation.copyFromFloats(0,0,0),r.rotationQuaternion&&r.rotationQuaternion.copyFrom(t.getParentsRotation()),r.rotationQuaternion&&r.parent&&r.rotationQuaternion.conjugateInPlace();var p,m=r.computeWorldMatrix(!0),g=new Array;for(p=0;p<h.length;p+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(h,p),m).toArray(g,p);e.Tools.Warn("MeshImpostor only collides against spheres."),i=new this.BJSCANNON.Trimesh(g,c),r.position.copyFrom(u),f&&r.rotation&&r.rotation.copyFrom(f),d&&r.rotationQuaternion&&r.rotationQuaternion.copyFrom(d);break;case e.PhysicsImpostor.HeightmapImpostor:var v=r.position.clone(),y=r.rotation&&r.rotation.clone(),_=r.rotationQuaternion&&r.rotationQuaternion.clone();r.position.copyFromFloats(0,0,0),r.rotation&&r.rotation.copyFromFloats(0,0,0),r.rotationQuaternion&&r.rotationQuaternion.copyFrom(t.getParentsRotation()),r.rotationQuaternion&&r.parent&&r.rotationQuaternion.conjugateInPlace(),r.rotationQuaternion&&r.rotationQuaternion.multiplyInPlace(this._minus90X),i=this._createHeightmap(r),r.position.copyFrom(v),y&&r.rotation&&r.rotation.copyFrom(y),_&&r.rotationQuaternion&&r.rotationQuaternion.copyFrom(_),r.computeWorldMatrix(!0);break;case e.PhysicsImpostor.ParticleImpostor:i=new this.BJSCANNON.Particle}return i},t.prototype._createHeightmap=function(t,i){var r,n=t.getVerticesData(e.VertexBuffer.PositionKind),o=t.computeWorldMatrix(!0),s=new Array;for(r=0;r<n.length;r+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(n,r),o).toArray(s,r);n=s;for(var a=new Array,l=i||~~(Math.sqrt(n.length/3)-1),h=t.getBoundingInfo(),c=Math.min(h.boundingBox.extendSizeWorld.x,h.boundingBox.extendSizeWorld.y),u=h.boundingBox.extendSizeWorld.z,f=2*c/l,d=0;d<n.length;d+=3){var p=Math.round(n[d+0]/f+l/2),m=Math.round(-1*(n[d+1]/f-l/2)),g=-n[d+2]+u;a[p]||(a[p]=[]),a[p][m]||(a[p][m]=g),a[p][m]=Math.max(g,a[p][m])}for(var p=0;p<=l;++p){if(!a[p]){for(var v=1;!a[(p+v)%l];)v++;a[p]=a[(p+v)%l].slice()}for(var m=0;m<=l;++m)if(!a[p][m]){for(var y,v=1;void 0===y;)y=a[p][(m+v++)%l];a[p][m]=y}}var _=new this.BJSCANNON.Heightfield(a,{elementSize:f});return _.minY=u,_},t.prototype._updatePhysicsBodyTransformation=function(t){var i=t.object;if(i.computeWorldMatrix&&i.computeWorldMatrix(!0),i.getBoundingInfo()){var r=t.getObjectCenter();this._tmpDeltaPosition.copyFrom(i.getAbsolutePivotPoint().subtract(r)),this._tmpPosition.copyFrom(r);var n=i.rotationQuaternion;if(n){if(t.type!==e.PhysicsImpostor.PlaneImpostor&&t.type!==e.PhysicsImpostor.HeightmapImpostor&&t.type!==e.PhysicsImpostor.CylinderImpostor||(n=n.multiply(this._minus90X),t.setDeltaRotation(this._plus90X)),t.type===e.PhysicsImpostor.HeightmapImpostor){var o=i,s=o.getBoundingInfo(),a=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var l=r.clone(),h=o.getPivotMatrix()||e.Matrix.Translation(0,0,0),c=e.Matrix.Translation(s.boundingBox.extendSizeWorld.x,0,-s.boundingBox.extendSizeWorld.z);o.setPivotMatrix(c),o.computeWorldMatrix(!0);var u=s.boundingBox.centerWorld.subtract(r).subtract(o.position).negate();this._tmpPosition.copyFromFloats(u.x,u.y-s.boundingBox.extendSizeWorld.y,u.z),this._tmpDeltaPosition.copyFrom(s.boundingBox.centerWorld.subtract(l)),this._tmpDeltaPosition.y+=s.boundingBox.extendSizeWorld.y,o.rotationQuaternion=a,o.setPivotMatrix(h),o.computeWorldMatrix(!0)}else t.type===e.PhysicsImpostor.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpDeltaPosition),t.physicsBody.position.copy(this._tmpPosition),t.physicsBody.quaternion.copy(n)}}},t.prototype.setTransformationFromPhysicsBody=function(e){e.object.position.copyFrom(e.physicsBody.position),e.object.rotationQuaternion&&e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)},t.prototype.setPhysicsBodyTransformation=function(e,t,i){e.physicsBody.position.copy(t),e.physicsBody.quaternion.copy(i)},t.prototype.isSupported=function(){return void 0!==this.BJSCANNON},t.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.copy(t)},t.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},t.prototype.getLinearVelocity=function(t){var i=t.physicsBody.velocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.getAngularVelocity=function(t){var i=t.physicsBody.angularVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},t.prototype.getBodyMass=function(e){return e.physicsBody.mass},t.prototype.getBodyFriction=function(e){return e.physicsBody.material.friction},t.prototype.setBodyFriction=function(e,t){e.physicsBody.material.friction=t},t.prototype.getBodyRestitution=function(e){return e.physicsBody.material.restitution},t.prototype.setBodyRestitution=function(e,t){e.physicsBody.material.restitution=t},t.prototype.sleepBody=function(e){e.physicsBody.sleep()},t.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},t.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.distance=t},t.prototype.setMotor=function(e,t,i,r){r||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),i&&this.setLimit(e,i))},t.prototype.setLimit=function(e,t,i){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===i?-t:i},t.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.quaternion.x,e.rotationQuaternion.y=i.quaternion.y,e.rotationQuaternion.z=i.quaternion.z,e.rotationQuaternion.w=i.quaternion.w)},t.prototype.getRadius=function(e){return e.physicsBody.shapes[0].boundingSphereRadius},t.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes[0];t.x=2*i.halfExtents.x,t.y=2*i.halfExtents.y,t.z=2*i.halfExtents.z},t.prototype.dispose=function(){},t.prototype._extendNamespace=function(){var e=new this.BJSCANNON.Vec3,t=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(i,r,n){if(n=n||10,0===(r=r||0))this.internalStep(i),this.time+=i;else{var o=Math.floor((this.time+r)/i)-Math.floor(this.time/i);o=Math.min(o,n)||1;for(var s=performance.now(),a=0;a!==o&&(this.internalStep(i),!(performance.now()-s>1e3*i));a++);this.time+=r;for(var l=this.time%i,h=l/i,c=e,u=this.bodies,f=0;f!==u.length;f++){var d=u[f];d.type!==t.Body.STATIC&&d.sleepState!==t.Body.SLEEPING?(d.position.vsub(d.previousPosition,c),c.scale(h,c),d.position.vadd(c,d.interpolatedPosition)):(d.interpolatedPosition.copy(d.position),d.interpolatedQuaternion.copy(d.quaternion))}}}},t}();e.CannonJSPlugin=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=e.Vector3.Zero(),this.BJSOIMO="undefined"!=typeof OIMO?OIMO:i(!function(){var e=new Error('Cannot find module "./Oimo"');throw e.code="MODULE_NOT_FOUND",e}()),this.world=new this.BJSOIMO.World(1/60,2,t,!0),this.world.worldscale(1),this.world.clear(),this.world.isNoStat=!0}return t.prototype.setGravity=function(e){this.world.gravity.copy(e)},t.prototype.setTimeStep=function(e){this.world.timeStep=e},t.prototype.getTimeStep=function(){return this.world.timeStep},t.prototype.executeStep=function(e,t){var i=this;t.forEach(function(e){e.beforeStep()}),this.world.step(),t.forEach(function(e){e.afterStep(),i._tmpImpostorsArray[e.uniqueId]=e});for(var r=this.world.contacts;null!==r;)if(!r.touching||r.body1.sleeping||r.body2.sleeping){var n=this._tmpImpostorsArray[+r.body1.name],o=this._tmpImpostorsArray[+r.body2.name];n&&o?(n.onCollide({body:o.physicsBody}),o.onCollide({body:n.physicsBody}),r=r.next):r=r.next}else r=r.next},t.prototype.applyImpulse=function(e,t,i){var r=e.physicsBody.massInfo.mass;e.physicsBody.applyImpulse(i.scale(this.BJSOIMO.INV_SCALE),t.scale(this.BJSOIMO.INV_SCALE*r))},t.prototype.applyForce=function(t,i,r){e.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,i,r)},t.prototype.generatePhysicsBody=function(t){var i=this;if(t.parent)return void(t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate()));if(t.isBodyInitRequired()){var r={name:t.uniqueId,config:[t.getParam("mass")||1,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==t.getParam("mass"),world:this.world},n=[t];!function(e){e.getChildMeshes&&e.getChildMeshes().forEach(function(e){e.physicsImpostor&&n.push(e.physicsImpostor)})}(t.object);var o=function(t){return Math.max(t,e.PhysicsEngine.Epsilon)};n.forEach(function(n){if(t.object.rotationQuaternion){var s=n.object.rotationQuaternion,a=(new i.BJSOIMO.Euler).setFromQuaternion({x:t.object.rotationQuaternion.x,y:t.object.rotationQuaternion.y,z:t.object.rotationQuaternion.z,s:t.object.rotationQuaternion.w}),l=n.getObjectExtendSize();if(n===t){var h=t.getObjectCenter();t.object.position.subtractToRef(h,i._tmpPositionVector),r.pos.push(h.x),r.pos.push(h.y),r.pos.push(h.z),r.rot.push(a.x/(i.BJSOIMO.degtorad||i.BJSOIMO.TO_RAD)),r.rot.push(a.y/(i.BJSOIMO.degtorad||i.BJSOIMO.TO_RAD)),r.rot.push(a.z/(i.BJSOIMO.degtorad||i.BJSOIMO.TO_RAD))}else{var c=n.object.getAbsolutePosition().subtract(t.object.getAbsolutePosition());r.pos.push(c.x),r.pos.push(c.y),r.pos.push(c.z),r.rot.push(0),r.rot.push(0),r.rot.push(0)}switch(n.type){case e.PhysicsImpostor.ParticleImpostor:e.Tools.Warn("No Particle support in this.BJSOIMO.js. using SphereImpostor instead");case e.PhysicsImpostor.SphereImpostor:var u=l.x,f=l.y,d=l.z,p=Math.max(o(u),o(f),o(d))/2;r.type.push("sphere"),r.size.push(p),r.size.push(p),r.size.push(p);break;case e.PhysicsImpostor.CylinderImpostor:var m=o(l.x)/2,g=o(l.y);r.type.push("cylinder"),r.size.push(m),r.size.push(g),r.size.push(g);break;case e.PhysicsImpostor.PlaneImpostor:case e.PhysicsImpostor.BoxImpostor:default:var m=o(l.x),g=o(l.y),v=o(l.z);r.type.push("box"),r.size.push(m),r.size.push(g),r.size.push(v)}n.object.rotationQuaternion=s}}),t.physicsBody=new this.BJSOIMO.Body(r).body}else this._tmpPositionVector.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpPositionVector)},t.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},t.prototype.generateJoint=function(t){var i=t.mainImpostor.physicsBody,r=t.connectedImpostor.physicsBody;if(i&&r){var n,o=t.joint.jointData,s=o.nativeParams||{},a={body1:i,body2:r,axe1:s.axe1||(o.mainAxis?o.mainAxis.asArray():null),axe2:s.axe2||(o.connectedAxis?o.connectedAxis.asArray():null),pos1:s.pos1||(o.mainPivot?o.mainPivot.asArray():null),pos2:s.pos2||(o.connectedPivot?o.connectedPivot.asArray():null),min:s.min,max:s.max,collision:s.collision||o.collision,spring:s.spring,world:this.world};switch(t.joint.type){case e.PhysicsJoint.BallAndSocketJoint:n="jointBall";break;case e.PhysicsJoint.SpringJoint:e.Tools.Warn("this.BJSOIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var l=o;a.min=l.length||a.min,a.max=Math.max(a.min,a.max);case e.PhysicsJoint.DistanceJoint:n="jointDistance",a.max=o.maxDistance;break;case e.PhysicsJoint.PrismaticJoint:n="jointPrisme";break;case e.PhysicsJoint.SliderJoint:n="jointSlide";break;case e.PhysicsJoint.WheelJoint:n="jointWheel";break;case e.PhysicsJoint.HingeJoint:default:n="jointHinge"}a.type=n,t.joint.physicsJoint=new this.BJSOIMO.Link(a).joint}},t.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(t){e.Tools.Warn(t)}},t.prototype.isSupported=function(){return void 0!==this.BJSOIMO},t.prototype.setTransformationFromPhysicsBody=function(e){if(!e.physicsBody.sleeping){if(e.physicsBody.shapes.next){var t=this._getLastShape(e.physicsBody);e.object.position.x=t.position.x*this.BJSOIMO.WORLD_SCALE,e.object.position.y=t.position.y*this.BJSOIMO.WORLD_SCALE,e.object.position.z=t.position.z*this.BJSOIMO.WORLD_SCALE}else e.object.position.copyFrom(e.physicsBody.getPosition());e.object.rotationQuaternion&&(e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()),e.object.rotationQuaternion.normalize())}},t.prototype.setPhysicsBodyTransformation=function(e,t,i){var r=e.physicsBody;r.position.init(t.x*this.BJSOIMO.INV_SCALE,t.y*this.BJSOIMO.INV_SCALE,t.z*this.BJSOIMO.INV_SCALE),r.orientation.init(i.w,i.x,i.y,i.z),r.syncShapes(),r.awake()},t.prototype._getLastShape=function(e){for(var t=e.shapes;t.next;)t=t.next;return t},t.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.init(t.x,t.y,t.z)},t.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.init(t.x,t.y,t.z)},t.prototype.getLinearVelocity=function(t){var i=t.physicsBody.linearVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.getAngularVelocity=function(t){var i=t.physicsBody.angularVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.setBodyMass=function(e,t){var i=0===t;e.physicsBody.shapes.density=i?1:t,e.physicsBody.setupMass(i?2:1)},t.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},t.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},t.prototype.setBodyFriction=function(e,t){e.physicsBody.shapes.friction=t},t.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},t.prototype.setBodyRestitution=function(e,t){e.physicsBody.shapes.restitution=t},t.prototype.sleepBody=function(e){e.physicsBody.sleep()},t.prototype.wakeUpBody=function(e){e.physicsBody.awake()},t.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.limitMotor.upperLimit=t,void 0!==i&&(e.physicsJoint.limitMotor.lowerLimit=i)},t.prototype.setMotor=function(e,t,i,r){var n=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;n&&n.setMotor(t,i)},t.prototype.setLimit=function(e,t,i,r){var n=r?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;n&&n.setLimit(t,void 0===i?-t:i)},t.prototype.syncMeshWithImpostor=function(e,t){var i=t.physicsBody;e.position.x=i.position.x,e.position.y=i.position.y,e.position.z=i.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=i.orientation.x,e.rotationQuaternion.y=i.orientation.y,e.rotationQuaternion.z=i.orientation.z,e.rotationQuaternion.w=i.orientation.s)},t.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},t.prototype.getBoxSizeToRef=function(e,t){var i=e.physicsBody.shapes;t.x=2*i.halfWidth,t.y=2*i.halfHeight,t.z=2*i.halfDepth},t.prototype.dispose=function(){this.world.clear()},t}();e.OimoJSPlugin=t}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0;return{id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]}},t.UploadContent=function(i,r){if(r.length<19)return void e.Tools.Error("Unable to load TGA file - Not enough data to contain header");var n=18,o=t.GetTGAHeader(r);if(o.id_length+n>r.length)return void e.Tools.Error("Unable to load TGA file - Not enough data");n+=o.id_length;var s=!1,a=!1,l=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:l=!0}var h,c,u=o.pixel_size>>3,f=o.width*o.height*u;if(a&&(c=r.subarray(n,n+=o.colormap_length*(o.colormap_size>>3))),s){h=new Uint8Array(f);for(var d,p,m,g=0,v=new Uint8Array(u);n<f&&g<f;)if(d=r[n++],p=1+(127&d),128&d){for(m=0;m<u;++m)v[m]=r[n++];for(m=0;m<p;++m)h.set(v,g+m*u);g+=u*p}else{for(p*=u,m=0;m<p;++m)h[g+m]=r[n++];g+=p}}else h=r.subarray(n,n+=a?o.width*o.height:f);var y,_,b,x,T,E;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,b=1,E=o.width,_=0,x=1,T=o.height;break;case t._ORIGIN_BL:y=0,b=1,E=o.width,_=o.height-1,x=-1,T=-1;break;case t._ORIGIN_UR:y=o.width-1,b=-1,E=-1,_=0,x=1,T=o.height;break;case t._ORIGIN_BR:y=o.width-1,b=-1,E=-1,_=o.height-1,x=-1,T=-1}var S="_getImageData"+(l?"Grey":"")+o.pixel_size+"bits",w=t[S](o,c,h,_,x,T,y,b,E);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,w)},t._getImageData8bits=function(e,t,i,r,n,o,s,a,l){var h,c,u,f=i,d=t,p=e.width,m=e.height,g=0,v=new Uint8Array(p*m*4);for(u=r;u!==o;u+=n)for(c=s;c!==l;c+=a,g++)h=f[g],v[4*(c+p*u)+3]=255,v[4*(c+p*u)+2]=d[3*h+0],v[4*(c+p*u)+1]=d[3*h+1],v[4*(c+p*u)+0]=d[3*h+2];return v},t._getImageData16bits=function(e,t,i,r,n,o,s,a,l){var h,c,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(c=s;c!==l;c+=a,m+=2)h=f[m+0]+(f[m+1]<<8),g[4*(c+d*u)+0]=(31744&h)>>7,g[4*(c+d*u)+1]=(992&h)>>2,g[4*(c+d*u)+2]=(31&h)>>3,g[4*(c+d*u)+3]=32768&h?0:255;return g},t._getImageData24bits=function(e,t,i,r,n,o,s,a,l){var h,c,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(c=r;c!==o;c+=n)for(h=s;h!==l;h+=a,p+=3)m[4*(h+f*c)+3]=255,m[4*(h+f*c)+2]=u[p+0],m[4*(h+f*c)+1]=u[p+1],m[4*(h+f*c)+0]=u[p+2];return m},t._getImageData32bits=function(e,t,i,r,n,o,s,a,l){var h,c,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(c=r;c!==o;c+=n)for(h=s;h!==l;h+=a,p+=4)m[4*(h+f*c)+2]=u[p+0],m[4*(h+f*c)+1]=u[p+1],m[4*(h+f*c)+0]=u[p+2],m[4*(h+f*c)+3]=u[p+3];return m},t._getImageDataGrey8bits=function(e,t,i,r,n,o,s,a,l){var h,c,u,f=i,d=e.width,p=e.height,m=0,g=new Uint8Array(d*p*4);for(u=r;u!==o;u+=n)for(c=s;c!==l;c+=a,m++)h=f[m],g[4*(c+d*u)+0]=h,g[4*(c+d*u)+1]=h,g[4*(c+d*u)+2]=h,g[4*(c+d*u)+3]=255;return g},t._getImageDataGrey16bits=function(e,t,i,r,n,o,s,a,l){var h,c,u=i,f=e.width,d=e.height,p=0,m=new Uint8Array(f*d*4);for(c=r;c!==o;c+=n)for(h=s;h!==l;h+=a,p+=2)m[4*(h+f*c)+0]=u[p+0],m[4*(h+f*c)+1]=u[p+0],m[4*(h+f*c)+2]=u[p+0],m[4*(h+f*c)+3]=u[p+1];return m},t}();i._TYPE_INDEXED=1,i._TYPE_RGB=2,i._TYPE_GREY=3,i._TYPE_RLE_INDEXED=9,i._TYPE_RLE_RGB=10,i._TYPE_RLE_GREY=11,i._ORIGIN_MASK=48,i._ORIGIN_SHIFT=4,i._ORIGIN_BL=0,i._ORIGIN_BR=1,i._ORIGIN_UL=2,i._ORIGIN_UR=3,t.TGATools=i}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n=i("DXT1"),o=i("DXT3"),s=i("DXT5"),a=i("DX10"),l=function(){function t(){}return t.GetDDSInfo=function(t){var i=new Int32Array(t,0,31),r=new Int32Array(t,0,35),l=1;131072&i[2]&&(l=Math.max(1,i[7]));var h=i[21],c=h===a?r[32]:0,u=e.Engine.TEXTURETYPE_UNSIGNED_INT;switch(h){case 113:u=e.Engine.TEXTURETYPE_HALF_FLOAT;break;case 116:u=e.Engine.TEXTURETYPE_FLOAT;break;case a:if(10===c){u=e.Engine.TEXTURETYPE_HALF_FLOAT;break}}return{width:i[4],height:i[3],mipmapCount:l,isFourCC:4==(4&i[20]),isRGB:64==(64&i[20]),isLuminance:131072==(131072&i[20]),isCube:512==(512&i[28]),isCompressed:h===n||h===o||h===s,dxgiFormat:c,textureType:u}},t._ToHalfFloat=function(e){t._FloatView||(t._FloatView=new Float32Array(1),t._Int32View=new Int32Array(t._FloatView.buffer)),t._FloatView[0]=e;var i=t._Int32View[0],r=i>>16&32768,n=i>>12&2047,o=i>>23&255;return o<103?r:o>142?(r|=31744,r|=(255==o?0:1)&&8388607&i):o<113?(n|=2048,r|=(n>>114-o)+(n>>113-o&1)):(r|=o-112<<10|n>>1,r+=1&n)},t._FromHalfFloat=function(e){var t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0===i?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/Math.pow(2,10))},t._GetHalfFloatAsFloatRGBAArrayBuffer=function(e,i,r,n,o,s){for(var a=new Float32Array(n),l=new Uint16Array(o,r),h=0,c=0;c<i;c++)for(var u=0;u<e;u++){var f=4*(u+c*e);a[h]=t._FromHalfFloat(l[f]),a[h+1]=t._FromHalfFloat(l[f+1]),a[h+2]=t._FromHalfFloat(l[f+2]),t.StoreLODInAlphaChannel?a[h+3]=s:a[h+3]=t._FromHalfFloat(l[f+3]),h+=4}return a},t._GetHalfFloatRGBAArrayBuffer=function(e,i,r,n,o,s){if(t.StoreLODInAlphaChannel){for(var a=new Uint16Array(n),l=new Uint16Array(o,r),h=0,c=0;c<i;c++)for(var u=0;u<e;u++){var f=4*(u+c*e);a[h]=l[f],a[h+1]=l[f+1],a[h+2]=l[f+2],a[h+3]=t._ToHalfFloat(s),h+=4}return a}return new Uint16Array(o,r,n)},t._GetFloatRGBAArrayBuffer=function(e,i,r,n,o,s){if(t.StoreLODInAlphaChannel){for(var a=new Float32Array(n),l=new Float32Array(o,r),h=0,c=0;c<i;c++)for(var u=0;u<e;u++){var f=4*(u+c*e);a[h]=l[f],a[h+1]=l[f+1],a[h+2]=l[f+2],a[h+3]=s,h+=4}return a}return new Float32Array(o,r,n)},t._GetFloatAsUIntRGBAArrayBuffer=function(i,r,n,o,s,a){for(var l=new Uint8Array(o),h=new Float32Array(s,n),c=0,u=0;u<r;u++)for(var f=0;f<i;f++){var d=4*(f+u*i);l[c]=255*e.Scalar.Clamp(h[d]),l[c+1]=255*e.Scalar.Clamp(h[d+1]),l[c+2]=255*e.Scalar.Clamp(h[d+2]),t.StoreLODInAlphaChannel?l[c+3]=a:l[c+3]=255*e.Scalar.Clamp(h[d+3]),c+=4}return l},t._GetHalfFloatAsUIntRGBAArrayBuffer=function(i,r,n,o,s,a){for(var l=new Uint8Array(o),h=new Uint16Array(s,n),c=0,u=0;u<r;u++)for(var f=0;f<i;f++){var d=4*(f+u*i);l[c]=255*e.Scalar.Clamp(t._FromHalfFloat(h[d])),l[c+1]=255*e.Scalar.Clamp(t._FromHalfFloat(h[d+1])),l[c+2]=255*e.Scalar.Clamp(t._FromHalfFloat(h[d+2])),t.StoreLODInAlphaChannel?l[c+3]=a:l[c+3]=255*e.Scalar.Clamp(t._FromHalfFloat(h[d+3])),c+=4}return l},t._GetRGBAArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n,i),a=0,l=0;l<t;l++)for(var h=0;h<e;h++){var c=4*(h+l*e);o[a]=s[c+2],o[a+1]=s[c+1],o[a+2]=s[c],o[a+3]=s[c+3],a+=4}return o},t._GetRGBArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n,i),a=0,l=0;l<t;l++)for(var h=0;h<e;h++){var c=3*(h+l*e);o[a]=s[c+2],o[a+1]=s[c+1],o[a+2]=s[c],a+=3}return o},t._GetLuminanceArrayBuffer=function(e,t,i,r,n){for(var o=new Uint8Array(r),s=new Uint8Array(n,i),a=0,l=0;l<t;l++)for(var h=0;h<e;h++){var c=h+l*e;o[a]=s[c],a++}return o},t.UploadDDSLevels=function(i,l,h,c,u,f,d,p){void 0===d&&(d=-1);var m,g,v,y,_,b,x,T=i.getCaps().s3tc,E=new Int32Array(h,0,31),S=0,w=0,M=0,A=1;if(542327876!==E[0])return void e.Tools.Error("Invalid magic number in DDS header");if(!c.isFourCC&&!c.isRGB&&!c.isLuminance)return void e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(c.isCompressed&&!T)return void e.Tools.Error("Compressed textures are not supported on this platform.");var P=E[22];y=E[1]+4;var C=!1;if(c.isFourCC)switch(m=E[21]){case n:A=8,w=T.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case o:A=16,w=T.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case s:A=16,w=T.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 113:case 116:C=!0;break;case a:y+=20;var R=!1;switch(c.dxgiFormat){case 10:C=!0,R=!0;break;case 88:c.isRGB=!0,c.isFourCC=!1,P=32,R=!0}if(R)break;default:return void console.error("Unsupported FourCC code:",r(m))}C&&(M=i._getWebGLTextureType(c.textureType),w=i._getRGBABufferInternalSizedFormat(c.textureType)),b=1,131072&E[2]&&!1!==u&&(b=Math.max(1,E[7]));for(var D=0;D<f;D++){var I=1===f?l.TEXTURE_2D:l.TEXTURE_CUBE_MAP_POSITIVE_X+D+(p||0);for(g=E[4],v=E[3],x=0;x<b;++x){if(-1===d||d===x){var O=-1===d?x:0;if(!c.isCompressed&&c.isFourCC){S=g*v*4;var F=null;i.badOS||i.badDesktopOS||!i.getCaps().textureHalfFloat&&!i.getCaps().textureFloat?(128===P?F=t._GetFloatAsUIntRGBAArrayBuffer(g,v,y,S,h,O):64===P&&(F=t._GetHalfFloatAsUIntRGBAArrayBuffer(g,v,y,S,h,O)),c.textureType=e.Engine.TEXTURETYPE_UNSIGNED_INT,M=i._getWebGLTextureType(c.textureType),w=i._getRGBABufferInternalSizedFormat(c.textureType)):128===P?F=t._GetFloatRGBAArrayBuffer(g,v,y,S,h,O):64!==P||i.getCaps().textureHalfFloat?F=t._GetHalfFloatRGBAArrayBuffer(g,v,y,S,h,O):(F=t._GetHalfFloatAsFloatRGBAArrayBuffer(g,v,y,S,h,O),c.textureType=e.Engine.TEXTURETYPE_FLOAT,M=i._getWebGLTextureType(c.textureType),w=i._getRGBABufferInternalSizedFormat(c.textureType)),F&&i._uploadDataToTexture(I,O,w,g,v,l.RGBA,M,F)}else if(c.isRGB)24===P?(S=g*v*3,_=t._GetRGBArrayBuffer(g,v,y,S,h),i._uploadDataToTexture(I,O,l.RGB,g,v,l.RGB,l.UNSIGNED_BYTE,_)):(S=g*v*4,_=t._GetRGBAArrayBuffer(g,v,y,S,h),i._uploadDataToTexture(I,O,l.RGBA,g,v,l.RGBA,l.UNSIGNED_BYTE,_));else if(c.isLuminance){var L=l.getParameter(l.UNPACK_ALIGNMENT),B=g,N=Math.floor((g+L-1)/L)*L;S=N*(v-1)+B,_=t._GetLuminanceArrayBuffer(g,v,y,S,h),i._uploadDataToTexture(I,O,l.LUMINANCE,g,v,l.LUMINANCE,l.UNSIGNED_BYTE,_)}else S=Math.max(4,g)/4*Math.max(4,v)/4*A,_=new Uint8Array(h,y,S),i._uploadCompressedDataToTexture(I,O,w,g,v,_)}y+=P?g*v*(P/8):S,g*=.5,v*=.5,g=Math.max(1,g),v=Math.max(1,v)}if(void 0!==p)break}},t}();l.StoreLODInAlphaChannel=!1,t.DDSTools=l}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(i,r,n,o){this.arrayBuffer=i;var s=new Uint8Array(this.arrayBuffer,0,12);if(171!==s[0]||75!==s[1]||84!==s[2]||88!==s[3]||32!==s[4]||49!==s[5]||49!==s[6]||187!==s[7]||13!==s[8]||10!==s[9]||26!==s[10]||10!==s[11])return void e.Tools.Error("texture missing KTX identifier");var a=new Int32Array(this.arrayBuffer,12,13),l=16909060===a[0];return this.glType=l?this.switchEndainness(a[1]):a[1],this.glTypeSize=l?this.switchEndainness(a[2]):a[2],this.glFormat=l?this.switchEndainness(a[3]):a[3],this.glInternalFormat=l?this.switchEndainness(a[4]):a[4],this.glBaseInternalFormat=l?this.switchEndainness(a[5]):a[5],this.pixelWidth=l?this.switchEndainness(a[6]):a[6],this.pixelHeight=l?this.switchEndainness(a[7]):a[7],this.pixelDepth=l?this.switchEndainness(a[8]):a[8],this.numberOfArrayElements=l?this.switchEndainness(a[9]):a[9],this.numberOfFaces=l?this.switchEndainness(a[10]):a[10],this.numberOfMipmapLevels=l?this.switchEndainness(a[11]):a[11],this.bytesOfKeyValueData=l?this.switchEndainness(a[12]):a[12],0!==this.glType?void e.Tools.Error("only compressed formats currently supported"):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),0===this.pixelHeight||0!==this.pixelDepth?void e.Tools.Error("only 2D textures currently supported"):0!==this.numberOfArrayElements?void e.Tools.Error("texture arrays not currently supported"):this.numberOfFaces!==r?void e.Tools.Error("number of faces expected"+r+", but found "+this.numberOfFaces):void(this.loadType=t.COMPRESSED_2D))}return t.prototype.switchEndainness=function(e){return(255&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255},t.prototype.uploadLevels=function(e,i){switch(this.loadType){case t.COMPRESSED_2D:this._upload2DCompressedLevels(e,i);break;case t.TEX_2D:case t.COMPRESSED_3D:case t.TEX_3D:}},t.prototype._upload2DCompressedLevels=function(e,i){for(var r=t.HEADER_LEN+this.bytesOfKeyValueData,n=this.pixelWidth,o=this.pixelHeight,s=i?this.numberOfMipmapLevels:1,a=0;a<s;a++){for(var l=new Int32Array(this.arrayBuffer,r,1)[0],h=0;h<this.numberOfFaces;h++){var c=1===this.numberOfFaces?e.TEXTURE_2D:e.TEXTURE_CUBE_MAP_POSITIVE_X+h,u=new Uint8Array(this.arrayBuffer,r+4,l);e.compressedTexImage2D(c,a,this.glInternalFormat,n,o,0,u),r+=l+4,r+=3-(l+3)%4}n=Math.max(1,.5*n),o=Math.max(1,.5*o)}},t}();i.HEADER_LEN=64,i.COMPRESSED_2D=0,i.COMPRESSED_3D=1,i.TEX_2D=2,i.TEX_3D=3,t.KhronosTextureContainer=i}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(t,i,r,n,o){void 0===n&&(n=!0),void 0===o&&(o=1),this.skeleton=t,this.mesh=i,this.autoUpdateBonesMatrices=n,this.renderingGroupId=o,this.color=e.Color3.White(),this._debugLines=new Array,this._isEnabled=!1,this._scene=r,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),t.prototype._getBonePosition=function(t,i,r,n,o,s){void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0);var a=e.Tmp.Matrix[0],l=i.getParent();if(a.copyFrom(i.getLocalMatrix()),0!==n||0!==o||0!==s){var h=e.Tmp.Matrix[1];e.Matrix.IdentityToRef(h),h.m[12]=n,h.m[13]=o,h.m[14]=s,h.multiplyToRef(a,a)}l&&a.multiplyToRef(l.getAbsoluteTransform(),a),a.multiplyToRef(r,a),t.x=a.m[12],t.y=a.m[13],t.z=a.m[14]},t.prototype._getLinesForBonesWithLength=function(t,i){for(var r=t.length,n=this.mesh.position,o=0;o<r;o++){var s=t[o],a=this._debugLines[o];a||(a=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[o]=a),this._getBonePosition(a[0],s,i),this._getBonePosition(a[1],s,i,0,s.length,0),a[0].subtractInPlace(n),a[1].subtractInPlace(n)}},t.prototype._getLinesForBonesNoLength=function(t,i){for(var r=t.length,n=0,o=this.mesh.position,s=r-1;s>=0;s--){var a=t[s],l=a.getParent();if(l){var h=this._debugLines[n];h||(h=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[n]=h),a.getAbsolutePositionToRef(this.mesh,h[0]),l.getAbsolutePositionToRef(this.mesh,h[1]),h[0].subtractInPlace(o),h[1].subtractInPlace(o),n++}}},t.prototype.update=function(){this.autoUpdateBonesMatrices&&this.skeleton.computeAbsoluteTransforms(),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?e.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=e.MeshBuilder.CreateLineSystem("",{lines:this._debugLines,updatable:!0,instance:null},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.position.copyFrom(this.mesh.position),this._debugMesh.color=this.color},t.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},t}();t.SkeletonViewer=i}(e.Debug||(e.Debug={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(t,i){void 0===i&&(i=1),this._xline=[e.Vector3.Zero(),e.Vector3.Zero()],this._yline=[e.Vector3.Zero(),e.Vector3.Zero()],this._zline=[e.Vector3.Zero(),e.Vector3.Zero()],this.scaleLines=1,this.scaleLines=i,this._xmesh=e.Mesh.CreateLines("xline",this._xline,t,!0),this._ymesh=e.Mesh.CreateLines("yline",this._yline,t,!0),this._zmesh=e.Mesh.CreateLines("zline",this._zline,t,!0),this._xmesh.renderingGroupId=2,this._ymesh.renderingGroupId=2,this._zmesh.renderingGroupId=2,this._xmesh.material.checkReadyOnlyOnce=!0,this._xmesh.color=new e.Color3(1,0,0),this._ymesh.material.checkReadyOnlyOnce=!0,this._ymesh.color=new e.Color3(0,1,0),this._zmesh.material.checkReadyOnlyOnce=!0,this._zmesh.color=new e.Color3(0,0,1),this.scene=t}return t.prototype.update=function(t,i,r,n){var o=this.scaleLines;this._xmesh&&this._xmesh.position.copyFrom(t),this._ymesh&&this._ymesh.position.copyFrom(t),this._zmesh&&this._zmesh.position.copyFrom(t);var s=this._xline[1];s.x=i.x*o,s.y=i.y*o,s.z=i.z*o,e.Mesh.CreateLines("",this._xline,null,!1,this._xmesh),s=this._yline[1],s.x=r.x*o,s.y=r.y*o,s.z=r.z*o,e.Mesh.CreateLines("",this._yline,null,!1,this._ymesh),s=this._zline[1],s.x=n.x*o,s.y=n.y*o,s.z=n.z*o,e.Mesh.CreateLines("",this._zline,null,!1,this._zmesh)},t.prototype.dispose=function(){this._xmesh&&this._xmesh.dispose(),this._ymesh&&this._ymesh.dispose(),this._zmesh&&this._zmesh.dispose(),this._xmesh=null,this._ymesh=null,this._zmesh=null,this.scene=null},t}();t.AxesViewer=i}(e.Debug||(e.Debug={}))}(r||(r={}));var r;!function(e){!function(t){var i=function(t){function i(i,r,n,o){void 0===o&&(o=1);var s=t.call(this,i,o)||this;return s.pos=e.Vector3.Zero(),s.xaxis=e.Vector3.Zero(),s.yaxis=e.Vector3.Zero(),s.zaxis=e.Vector3.Zero(),s.mesh=n,s.bone=r,s}return o(i,t),i.prototype.update=function(){if(this.mesh&&this.bone){var i=this.bone;i.getAbsolutePositionToRef(this.mesh,this.pos),i.getDirectionToRef(e.Axis.X,this.mesh,this.xaxis),i.getDirectionToRef(e.Axis.Y,this.mesh,this.yaxis),i.getDirectionToRef(e.Axis.Z,this.mesh,this.zaxis),t.prototype.update.call(this,this.pos,this.xaxis,this.yaxis,this.zaxis)}},i.prototype.dispose=function(){this.mesh&&(this.mesh=null,this.bone=null,t.prototype.dispose.call(this))},i}(t.AxesViewer);t.BoneAxesViewer=i}(e.Debug||(e.Debug={}))}(r||(r={}));var r;!function(e){var t=function(){function t(e){this.ray=e}return t.CreateAndShow=function(e,i,r){var n=new t(e);return n.show(i,r),n},t.prototype.show=function(t,i){if(!this._renderFunction&&this.ray){var r=this.ray;this._renderFunction=this._render.bind(this),this._scene=t,this._renderPoints=[r.origin,r.origin.add(r.direction.scale(r.length))],this._renderLine=e.Mesh.CreateLines("ray",this._renderPoints,t,!0),this._renderFunction&&this._scene.registerBeforeRender(this._renderFunction)}i&&this._renderLine&&this._renderLine.color.copyFrom(i)},t.prototype.hide=function(){this._renderFunction&&this._scene&&(this._scene.unregisterBeforeRender(this._renderFunction),this._scene=null,this._renderFunction=null,this._renderLine&&(this._renderLine.dispose(),this._renderLine=null),this._renderPoints=[])},t.prototype._render=function(){var t=this.ray;if(t){var i=this._renderPoints[1],r=Math.min(t.length,1e6);i.copyFrom(t.direction),i.scaleInPlace(r),i.addInPlace(t.origin),e.Mesh.CreateLines("ray",this._renderPoints,this._scene,!0,this._renderLine)}},t.prototype.attachToMesh=function(t,i,r,n){this._attachedToMesh=t;var o=this.ray;o&&(o.direction||(o.direction=e.Vector3.Zero()),o.origin||(o.origin=e.Vector3.Zero()),n&&(o.length=n),r||(r=e.Vector3.Zero()),i||(i=new e.Vector3(0,0,-1)),this._meshSpaceDirection?(this._meshSpaceDirection.copyFrom(i),this._meshSpaceOrigin.copyFrom(r)):(this._meshSpaceDirection=i.clone(),this._meshSpaceOrigin=r.clone()),this._updateToMeshFunction||(this._updateToMeshFunction=this._updateToMesh.bind(this),this._attachedToMesh.getScene().registerBeforeRender(this._updateToMeshFunction)),this._updateToMesh())},t.prototype.detachFromMesh=function(){this._attachedToMesh&&(this._updateToMeshFunction&&this._attachedToMesh.getScene().unregisterBeforeRender(this._updateToMeshFunction),this._attachedToMesh=null,this._updateToMeshFunction=null)},t.prototype._updateToMesh=function(){var t=this.ray;if(this._attachedToMesh&&t){if(this._attachedToMesh._isDisposed)return void this.detachFromMesh();this._attachedToMesh.getDirectionToRef(this._meshSpaceDirection,t.direction),e.Vector3.TransformCoordinatesToRef(this._meshSpaceOrigin,this._attachedToMesh.getWorldMatrix(),t.origin)}},t.prototype.dispose=function(){this.hide(),this.detachFromMesh(),this.ray=null},t}();e.RayHelper=t}(r||(r={}));var r;!function(e){var t=function(){function t(e){this.BJSINSPECTOR="undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this._scene=e}return t.prototype._createInspector=function(e){void 0===e&&(e={});var t=e.popup||!1,i=e.initialTab||0,r=e.parentElement||null;this._inspector||(this.BJSINSPECTOR=this.BJSINSPECTOR||"undefined"!=typeof INSPECTOR?INSPECTOR:void 0,this._inspector=new this.BJSINSPECTOR.Inspector(this._scene,t,i,r,e.newColors))},t.prototype.isVisible=function(){return!!this._inspector},t.prototype.hide=function(){if(this._inspector){try{this._inspector.dispose()}catch(e){}this._inspector=null}},t.prototype.show=function(i){void 0===i&&(i={}),void 0===this.BJSINSPECTOR?e.Tools.LoadScript(t.InspectorURL,this._createInspector.bind(this,i)):this._createInspector(i)},t}();t.InspectorURL="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js",e.DebugLayer=t}(r||(r={}));var r;!function(e){!function(t){var i=function(){function t(t){this._impostors=[],this._meshes=[],this._numMeshes=0,this._scene=t||e.Engine.LastCreatedScene;var i=this._scene.getPhysicsEngine();i&&(this._physicsEnginePlugin=i.getPhysicsPlugin())}return t.prototype._updateDebugMeshes=function(){for(var e=this._physicsEnginePlugin,t=0;t<this._numMeshes;t++){var i=this._impostors[t];if(i)if(i.isDisposed)this.hideImpostor(this._impostors[t--]);else{var r=this._meshes[t];r&&e&&e.syncMeshWithImpostor(r,i)}}},t.prototype.showImpostor=function(e){if(this._scene){for(var t=0;t<this._numMeshes;t++)if(this._impostors[t]==e)return;var i=this._getDebugMesh(e,this._scene);i&&(this._impostors[this._numMeshes]=e,this._meshes[this._numMeshes]=i,0===this._numMeshes&&(this._renderFunction=this._updateDebugMeshes.bind(this),this._scene.registerBeforeRender(this._renderFunction)),this._numMeshes++)}},t.prototype.hideImpostor=function(e){if(e&&this._scene){for(var t=!1,i=0;i<this._numMeshes;i++)if(this._impostors[i]==e){var r=this._meshes[i];if(!r)continue;this._scene.removeMesh(r),r.dispose(),this._numMeshes--,this._numMeshes>0?(this._meshes[i]=this._meshes[this._numMeshes],this._impostors[i]=this._impostors[this._numMeshes],this._meshes[this._numMeshes]=null,this._impostors[this._numMeshes]=null):(this._meshes[0]=null,this._impostors[0]=null),t=!0;break}t&&0===this._numMeshes&&this._scene.unregisterBeforeRender(this._renderFunction)}},t.prototype._getDebugMaterial=function(t){return this._debugMaterial||(this._debugMaterial=new e.StandardMaterial("",t),this._debugMaterial.wireframe=!0),this._debugMaterial},t.prototype._getDebugBoxMesh=function(t){return this._debugBoxMesh||(this._debugBoxMesh=e.MeshBuilder.CreateBox("physicsBodyBoxViewMesh",{size:1},t),this._debugBoxMesh.renderingGroupId=1,this._debugBoxMesh.rotationQuaternion=e.Quaternion.Identity(),this._debugBoxMesh.material=this._getDebugMaterial(t),t.removeMesh(this._debugBoxMesh)),this._debugBoxMesh.createInstance("physicsBodyBoxViewInstance")},t.prototype._getDebugSphereMesh=function(t){return this._debugSphereMesh||(this._debugSphereMesh=e.MeshBuilder.CreateSphere("physicsBodySphereViewMesh",{diameter:1},t),this._debugSphereMesh.renderingGroupId=1,this._debugSphereMesh.rotationQuaternion=e.Quaternion.Identity(),this._debugSphereMesh.material=this._getDebugMaterial(t),t.removeMesh(this._debugSphereMesh)),this._debugSphereMesh.createInstance("physicsBodyBoxViewInstance")},t.prototype._getDebugMesh=function(t,i){var r=null;if(t.type==e.PhysicsImpostor.BoxImpostor)r=this._getDebugBoxMesh(i),t.getBoxSizeToRef(r.scaling);else if(t.type==e.PhysicsImpostor.SphereImpostor){r=this._getDebugSphereMesh(i);var n=t.getRadius();r.scaling.x=2*n,r.scaling.y=2*n,r.scaling.z=2*n}return r},t.prototype.dispose=function(){for(var e=0;e<this._numMeshes;e++)this.hideImpostor(this._impostors[e]);this._debugBoxMesh&&this._debugBoxMesh.dispose(),this._debugSphereMesh&&this._debugSphereMesh.dispose(),this._debugMaterial&&this._debugMaterial.dispose(),this._impostors.length=0,this._scene=null,this._physicsEnginePlugin=null},t}();t.PhysicsViewer=i}(e.Debug||(e.Debug={}))}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.frontColor=new e.Color3(1,1,1),this.backColor=new e.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new e.SmartArray(32),this._vertexBuffers={},this._scene=t}return t.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new e.ShaderMaterial("colorShader",this._scene,"color",{attributes:[e.VertexBuffer.PositionKind],uniforms:["world","viewProjection","color"]});var t=this._scene.getEngine(),i=e.VertexData.CreateBox({size:1});this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(t,i.positions,e.VertexBuffer.PositionKind,!1),this._createIndexBuffer()}},t.prototype._createIndexBuffer=function(){var e=this._scene.getEngine();this._indexBuffer=e.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])},t.prototype._rebuild=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var t=this._scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var i=0;i<this.renderList.length;i++){var r=this.renderList.data[i],n=r.minimum,o=r.maximum,s=o.subtract(n),a=n.add(s.scale(.5)),l=e.Matrix.Scaling(s.x,s.y,s.z).multiply(e.Matrix.Translation(a.x,a.y,a.z)).multiply(r.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(l),t.draw(!1,0,24)),t.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(l),t.draw(!1,0,24)}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},t.prototype.renderOcclusionBoundingBox=function(t){if(this._prepareRessources(),this._colorShader.isReady()&&t._boundingInfo){var i=this._scene.getEngine();i.setDepthWrite(!1),i.setColorWrite(!1),this._colorShader._preBind();var r=t._boundingInfo.boundingBox,n=r.minimum,o=r.maximum,s=o.subtract(n),a=n.add(s.scale(.5)),l=e.Matrix.Scaling(s.x,s.y,s.z).multiply(e.Matrix.Translation(a.x,a.y,a.z)).multiply(r.getWorldMatrix());i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),i.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.bind(l),i.draw(!1,0,24),this._colorShader.unbind(),i.setDepthFunctionToLessOrEqual(),i.setDepthWrite(!0),i.setColorWrite(!0)}},t.prototype.dispose=function(){if(this._colorShader){this.renderList.dispose(),this._colorShader.dispose();var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},t}();e.BoundingBoxRenderer=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){void 0===i&&(i=0),this.name=t,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this.onInfluenceChanged=new e.Observable,this.influence=i}return Object.defineProperty(t.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var t=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers&&this.onInfluenceChanged.notifyObservers(0===t||0===e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!0,configurable:!0}),t.prototype.setPositions=function(e){this._positions=e},t.prototype.getPositions=function(){return this._positions},t.prototype.setNormals=function(e){this._normals=e},t.prototype.getNormals=function(){return this._normals},t.prototype.setTangents=function(e){this._tangents=e},t.prototype.getTangents=function(){return this._tangents},t.prototype.serialize=function(){var t={};return t.name=this.name,t.influence=this.influence,t.positions=Array.prototype.slice.call(this.getPositions()),this.hasNormals&&(t.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(t.tangents=Array.prototype.slice.call(this.getTangents())),e.Animation.AppendSerializedAnimations(this,t),t},t.Parse=function(i){var r=new t(i.name,i.influence);if(r.setPositions(i.positions),i.normals&&r.setNormals(i.normals),i.tangents&&r.setTangents(i.tangents),i.animations)for(var n=0;n<i.animations.length;n++){var o=i.animations[n];r.animations.push(e.Animation.Parse(o))}return r},t.FromMesh=function(i,r,n){r||(r=i.name);var o=new t(r,n);return o.setPositions(i.getVerticesData(e.VertexBuffer.PositionKind)),i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&o.setNormals(i.getVerticesData(e.VertexBuffer.NormalKind)),i.isVerticesDataPresent(e.VertexBuffer.TangentKind)&&o.setTangents(i.getVerticesData(e.VertexBuffer.TangentKind)),o},t}();e.MorphTarget=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){void 0===t&&(t=null),this._targets=new Array,this._targetObservable=new Array,this._activeTargets=new e.SmartArray(16),this._supportsNormals=!1,this._supportsTangents=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,t||(t=e.Engine.LastCreatedScene),this._scene=t,this._scene&&(this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsNormals",{get:function(){return this._supportsNormals},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsTangents",{get:function(){return this._supportsTangents},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"influences",{get:function(){return this._influences},enumerable:!0,configurable:!0}),t.prototype.getActiveTarget=function(e){return this._activeTargets.data[e]},t.prototype.getTarget=function(e){return this._targets[e]},t.prototype.addTarget=function(e){var t=this;this._targets.push(e),this._targetObservable.push(e.onInfluenceChanged.add(function(e){t._syncActiveTargets(e)})),this._syncActiveTargets(!0)},t.prototype.removeTarget=function(e){var t=this._targets.indexOf(e);t>=0&&(this._targets.splice(t,1),e.onInfluenceChanged.remove(this._targetObservable.splice(t,1)[0]),this._syncActiveTargets(!0))},t.prototype.serialize=function(){var e={};e.id=this.uniqueId,e.targets=[];for(var t=0,i=this._targets;t<i.length;t++){var r=i[t];e.targets.push(r.serialize())}return e},t.prototype._syncActiveTargets=function(t){var i=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._vertexCount=0;for(var r=0,n=this._targets;r<n.length;r++){var o=n[r];if(o.influence>0){this._activeTargets.push(o),this._tempInfluences[i++]=o.influence,this._supportsNormals=this._supportsNormals&&o.hasNormals,this._supportsTangents=this._supportsTangents&&o.hasTangents;var s=o.getPositions();if(!s)return void e.Tools.Error("Invalid target. Target must positions.");var a=s.length/3;if(0===this._vertexCount)this._vertexCount=a;else if(this._vertexCount!==a)return void e.Tools.Error("Incompatible target. Targets must all have the same vertices count.")}}this._influences&&this._influences.length===i||(this._influences=new Float32Array(i));for(var l=0;l<i;l++)this._influences[l]=this._tempInfluences[l];if(t&&this._scene)for(var h=0,c=this._scene.meshes;h<c.length;h++){var u=c[h];u.morphTargetManager===this&&u._syncGeometryWithMorphTargetManager()}},t.Parse=function(i,r){var n=new t(r);n._uniqueId=i.id;for(var o=0,s=i.targets;o<s.length;o++){var a=s[o];n.addTarget(e.MorphTarget.Parse(a))}return n},t}();e.MorphTargetManager=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r){void 0===r&&(r=2),this.maxDepth=r,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new e.SmartArrayNoDuplicate(1024),this._creationFunc=t}return t.prototype.update=function(e,i,r){t._CreateBlocks(e,i,r,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++){this.blocks[t].addEntry(e)}},t.prototype.select=function(e,t){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){this.blocks[i].select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(e,t,i){this._selectionContent.reset();for(var r=0;r<this.blocks.length;r++){this.blocks[r].intersects(e,t,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++){this.blocks[t].intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,i,r,n,o,s,a,l){a.blocks=new Array;for(var h=new e.Vector3((i.x-t.x)/2,(i.y-t.y)/2,(i.z-t.z)/2),c=0;c<2;c++)for(var u=0;u<2;u++)for(var f=0;f<2;f++){var d=t.add(h.multiplyByFloats(c,u,f)),p=t.add(h.multiplyByFloats(c+1,u+1,f+1)),m=new e.OctreeBlock(d,p,n,o+1,s,l);m.addEntries(r),a.blocks.push(m)}},t}();t.CreationFuncForMeshes=function(e,t){var i=e.getBoundingInfo();!e.isBlocked&&i.boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},e.Octree=t}(r||(r={}));var r;!function(e){var t=function(){function t(e,t,i,r,n,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=r,this._maxDepth=n,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addEntry(i)}},t.prototype.select=function(t,i,r){if(e.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var n=0;n<this.blocks.length;n++){this.blocks[n].select(t,i,r)}return}r?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,i,r,n){if(e.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,i)){if(this.blocks){for(var o=0;o<this.blocks.length;o++){this.blocks[o].intersects(t,i,r,n)}return}n?r.concat(this.entries):r.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){this.blocks[i].intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){e.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();e.OctreeBlock=t}(r||(r={}));var r;!function(e){var t=function(){function e(){}return e.TransformCoordinatesToRefSIMD=function(t,i,r){e.TransformCoordinatesFromFloatsToRefSIMD(t.x,t.y,t.z,i,r)},e.TransformCoordinatesFromFloatsToRefSIMD=function(e,t,i,r,n){var o=r.m,s=SIMD.Float32x4.load(o,0),a=SIMD.Float32x4.load(o,4),l=SIMD.Float32x4.load(o,8),h=SIMD.Float32x4.load(o,12),c=SIMD.Float32x4.add(SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(e),s),SIMD.Float32x4.mul(SIMD.Float32x4.splat(t),a)),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(i),l),h));c=SIMD.Float32x4.div(c,SIMD.Float32x4.swizzle(c,3,3,3,3)),n.x=SIMD.Float32x4.extractLane(c,0),n.y=SIMD.Float32x4.extractLane(c,1),n.z=SIMD.Float32x4.extractLane(c,2)},e}(),i=function(){function e(){}return e.prototype.multiplyToArraySIMD=function(e,t,i){for(var r=this.m,n=e.m,o=SIMD.Float32x4.load(n,0),s=SIMD.Float32x4.load(n,4),a=SIMD.Float32x4.load(n,8),l=SIMD.Float32x4.load(n,12),h=0;h<16;h+=4)SIMD.Float32x4.store(t,h+i,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(r[h]),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(r[h+1]),s),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.splat(r[h+2]),a),SIMD.Float32x4.mul(SIMD.Float32x4.splat(r[h+3]),l)))));return this},e.prototype.invertToRefSIMD=function(e){var t=this.m,i=e.m,r=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),o=SIMD.Float32x4.load(t,8),s=SIMD.Float32x4.load(t,12),a=SIMD.Float32x4.shuffle(r,n,0,1,4,5),l=SIMD.Float32x4.shuffle(o,s,0,1,4,5),h=SIMD.Float32x4.shuffle(a,l,0,2,4,6);l=SIMD.Float32x4.shuffle(l,a,1,3,5,7),a=SIMD.Float32x4.shuffle(r,n,2,3,6,7);var c=SIMD.Float32x4.shuffle(o,s,2,3,6,7),u=SIMD.Float32x4.shuffle(a,c,0,2,4,6);c=SIMD.Float32x4.shuffle(c,a,1,3,5,7),a=SIMD.Float32x4.mul(u,c),a=SIMD.Float32x4.swizzle(a,1,0,3,2);var f=SIMD.Float32x4.mul(l,a),d=SIMD.Float32x4.mul(h,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,a),f),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,a),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),a=SIMD.Float32x4.mul(l,u),a=SIMD.Float32x4.swizzle(a,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),f);var p=SIMD.Float32x4.mul(h,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,a)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,a),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,3,0,1),c),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,a),f);var m=SIMD.Float32x4.mul(h,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,a)),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,a),m),m=SIMD.Float32x4.swizzle(m,2,3,0,1),a=SIMD.Float32x4.mul(h,l),a=SIMD.Float32x4.swizzle(a,1,0,3,2),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),m),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,a),p),a=SIMD.Float32x4.swizzle(a,2,3,0,1),m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,a),m),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(u,a)),a=SIMD.Float32x4.mul(h,c),a=SIMD.Float32x4.swizzle(a,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,a)),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,a),m),a=SIMD.Float32x4.swizzle(a,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,a),d),m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(l,a)),a=SIMD.Float32x4.mul(h,u),a=SIMD.Float32x4.swizzle(a,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,a),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(c,a)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,a),p);var g=SIMD.Float32x4.mul(h,f);return g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,2,3,0,1),g),g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,1,0,3,2),g),a=SIMD.Float32x4.reciprocalApproximation(g),g=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(g,SIMD.Float32x4.mul(a,a))),g=SIMD.Float32x4.swizzle(g,0,0,0,0),SIMD.Float32x4.store(i,0,SIMD.Float32x4.mul(g,f)),SIMD.Float32x4.store(i,4,SIMD.Float32x4.mul(g,d)),SIMD.Float32x4.store(i,8,m=SIMD.Float32x4.mul(g,m)),SIMD.Float32x4.store(i,12,SIMD.Float32x4.mul(g,p)),this},e.LookAtLHToRefSIMD=function(e,t,i,r){var n=r.m,o=SIMD.Float32x4(t.x,t.y,t.z,0),s=SIMD.Float32x4(e.x,e.y,e.z,0),a=SIMD.Float32x4(i.x,i.y,i.z,0),l=SIMD.Float32x4.sub(o,s),h=SIMD.Float32x4.mul(l,l);h=SIMD.Float32x4.add(h,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,2,0,3),SIMD.Float32x4.swizzle(h,2,0,1,3))),l=SIMD.Float32x4.mul(l,SIMD.Float32x4.reciprocalSqrtApproximation(h)),h=SIMD.Float32x4.mul(a,a),h=SIMD.Float32x4.add(h,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,2,0,3),SIMD.Float32x4.swizzle(h,2,0,1,3))),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.reciprocalSqrtApproximation(h));var c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,2,0,3),SIMD.Float32x4.swizzle(a,2,0,1,3)),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,0,1,3),SIMD.Float32x4.swizzle(a,1,2,0,3)));h=SIMD.Float32x4.mul(c,c),h=SIMD.Float32x4.add(h,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,2,0,3),SIMD.Float32x4.swizzle(h,2,0,1,3))),c=SIMD.Float32x4.mul(c,SIMD.Float32x4.reciprocalSqrtApproximation(h));var u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,2,0,3),SIMD.Float32x4.swizzle(l,2,0,1,3)),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,0,1,3),SIMD.Float32x4.swizzle(l,1,2,0,3)));h=SIMD.Float32x4.mul(c,c),h=SIMD.Float32x4.add(h,SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,2,0,3),SIMD.Float32x4.swizzle(h,2,0,1,3))),c=SIMD.Float32x4.mul(c,SIMD.Float32x4.reciprocalSqrtApproximation(h));var f=SIMD.Float32x4.splat(0);c=SIMD.Float32x4.neg(c);var d=SIMD.Float32x4.shuffle(c,u,0,1,4,5),p=SIMD.Float32x4.shuffle(l,f,0,1,4,5),m=SIMD.Float32x4.shuffle(d,p,0,2,4,6),g=SIMD.Float32x4.shuffle(d,p,1,3,5,7),v=SIMD.Float32x4.shuffle(SIMD.Float32x4.shuffle(c,u,2,3,6,7),SIMD.Float32x4.shuffle(l,f,2,3,6,7),0,2,4,6),y=SIMD.Float32x4(0,0,0,1),_=SIMD.Float32x4(1,0,0,0);SIMD.Float32x4.store(n,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),m),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),v),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),y))))),_=SIMD.Float32x4(0,1,0,0),SIMD.Float32x4.store(n,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),m),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),v),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),y))))),_=SIMD.Float32x4(0,0,1,0),SIMD.Float32x4.store(n,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),m),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),v),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),y))))),_=SIMD.Float32x4.replaceLane(SIMD.Float32x4.neg(s),3,1),SIMD.Float32x4.store(n,12,SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),m),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),v),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),y)))))},e}(),r=e.Matrix.prototype.multiplyToArray,n=e.Matrix.prototype.invertToRef,o=e.Matrix.LookAtLHToRef,s=e.Vector3.TransformCoordinatesToRef,a=e.Vector3.TransformCoordinatesFromFloatsToRef,l=function(){function l(){}return Object.defineProperty(l,"IsEnabled",{get:function(){return l._isEnabled},enumerable:!0,configurable:!0}),l.DisableSIMD=function(){e.Matrix.prototype.multiplyToArray=r,e.Matrix.prototype.invertToRef=n,e.Matrix.LookAtLHToRef=o,e.Vector3.TransformCoordinatesToRef=s,e.Vector3.TransformCoordinatesFromFloatsToRef=a,l._isEnabled=!1},l.EnableSIMD=function(){void 0!==self.SIMD&&(self.Math.fround||(self.Math.fround=function(e){return function(t){return e[0]=t,e[0]}}(new Float32Array(1))),self.Math.imul||(self.Math.imul=function(e,t){var i=e>>>16&65535,r=65535&e,n=t>>>16&65535,o=65535&t;return r*o+(i*o+r*n<<16>>>0)|0}),e.Matrix.prototype.multiplyToArray=i.prototype.multiplyToArraySIMD,e.Matrix.prototype.invertToRef=i.prototype.invertToRefSIMD,e.Matrix.LookAtLHToRef=i.LookAtLHToRefSIMD,e.Vector3.TransformCoordinatesToRef=t.TransformCoordinatesToRefSIMD,e.Vector3.TransformCoordinatesFromFloatsToRef=t.TransformCoordinatesFromFloatsToRefSIMD,l._isEnabled=!0)},l}();l._isEnabled=!1,e.SIMDHelper=l}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,i,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,r,e.Texture.BILINEAR_SAMPLINGMODE)||this;return s._isRightEye=n,s._distortionFactors=o.distortionK,s._postProcessScaleFactor=o.postProcessScaleFactor,s._lensCenterOffset=o.lensCenterOffset,s.adaptScaleToCurrentViewport=!0,s.onSizeChangedObservable.add(function(){s.aspectRatio=.5*s.width/s.height,s._scaleIn=new e.Vector2(2,2/s.aspectRatio),s._scaleFactor=new e.Vector2(1/s._postProcessScaleFactor*.5,1/s._postProcessScaleFactor*.5*s.aspectRatio),s._lensCenter=new e.Vector2(s._isRightEye?.5-.5*s._lensCenterOffset:.5+.5*s._lensCenterOffset,.5)}),s.onApplyObservable.add(function(e){e.setFloat2("LensCenter",s._lensCenter.x,s._lensCenter.y),e.setFloat2("Scale",s._scaleFactor.x,s._scaleFactor.y),e.setFloat2("ScaleIn",s._scaleIn.x,s._scaleIn.y),e.setFloat4("HmdWarpParam",s._distortionFactors[0],s._distortionFactors[1],s._distortionFactors[2],s._distortionFactors[3])}),s}return o(i,t),i}(e.PostProcess);e.VRDistortionCorrectionPostProcess=t}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r,n,o,s){var a=e.call(this,t,"anaglyph",null,["leftSampler"],i,r[1],n,o,s)||this;return a._passedProcess=r[0]._rigPostProcess,a.onApplyObservable.add(function(e){e.setTextureFromPostProcess("leftSampler",a._passedProcess)}),a}return o(t,e),t}(e.PostProcess);e.AnaglyphPostProcess=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a){var l=t.call(this,i,"stereoscopicInterlace",["stepSize"],["camASampler"],1,r[1],o,s,a,n?"#define IS_STEREOSCOPIC_HORIZ 1":void 0)||this;return l._passedProcess=r[0]._rigPostProcess,l._stepSize=new e.Vector2(1/l.width,1/l.height),l.onSizeChangedObservable.add(function(){l._stepSize=new e.Vector2(1/l.width,1/l.height)}),l.onApplyObservable.add(function(e){e.setTextureFromPostProcess("camASampler",l._passedProcess),e.setFloat2("stepSize",l._stepSize.x,l._stepSize.y)}),l}return o(i,t),i}(e.PostProcess);e.StereoscopicInterlacePostProcess=t}(r||(r={}));var r;!function(e){var t=function(){function t(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new e.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){t._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-e.Tools.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=null!==e.alpha?e.alpha:0,t._beta=null!==e.beta?e.beta:0,t._gamma=null!==e.gamma?e.gamma:0},this._constantTranform=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t,null==this._camera||this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new e.Quaternion)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation),this._orientationChanged()},t.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},t.prototype.checkInputs=function(){this._alpha&&(e.Quaternion.RotationYawPitchRollToRef(e.Tools.ToRadians(this._alpha),e.Tools.ToRadians(this._beta),-e.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1)},t.prototype.getClassName=function(){return"FreeCameraDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"deviceOrientation"},t}();e.FreeCameraDeviceOrientationInput=t,e.CameraInputTypes.FreeCameraDeviceOrientationInput=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){this.camera.attachControl(e,t),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){null!==e.alpha&&(this._alpha=0|+e.alpha),null!==e.gamma&&(this._gamma=0|+e.gamma),this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getClassName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();e.ArcRotateCameraVRDeviceOrientationInput=t,e.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.compensateDistortion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(-i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){void 0===o&&(o={});var s=t.call(this,i,r,n)||this;s.webVROptions=o,s._vrDevice=null,s.rawPose=null,s._specsVersion="1.1",s._attached=!1,s._descendants=[],s._deviceRoomPosition=e.Vector3.Zero(),s._deviceRoomRotationQuaternion=e.Quaternion.Identity(),s._standingMatrix=null,s.devicePosition=e.Vector3.Zero(),s.deviceRotationQuaternion=e.Quaternion.Identity(),s.deviceScaleFactor=1,s._deviceToWorld=e.Matrix.Identity(),s._worldToDevice=e.Matrix.Identity(),s.controllers=[],s.onControllersAttachedObservable=new e.Observable,s.onControllerMeshLoadedObservable=new e.Observable,s.rigParenting=!0,s._defaultHeight=0,s.deviceDistanceToRoomGround=function(){return s._standingMatrix?(s._standingMatrix.getTranslationToRef(s._workingVector),s._deviceRoomPosition.y+s._workingVector.y):s._defaultHeight},s.useStandingMatrix=function(t){void 0===t&&(t=function(e){}),navigator&&navigator.getVRDisplays?navigator.getVRDisplays().then(function(i){if(i&&i[0]&&i[0].stageParameters&&i[0].stageParameters.sittingToStandingTransform){s._standingMatrix=new e.Matrix,e.Matrix.FromFloat32ArrayToRefScaled(i[0].stageParameters.sittingToStandingTransform,0,1,s._standingMatrix),s.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(e){s._standingMatrix&&(s._standingMatrix.m[e]*=-1)}),s._deviceToWorld.multiplyToRef(s._standingMatrix,s._deviceToWorld);var r=s._deviceToWorld.getTranslation();r.y-=s._defaultHeight,s._deviceToWorld.setTranslation(r),t(!0)}else t(!1)}):t(!1)},s._workingVector=e.Vector3.Zero(),s._oneVector=e.Vector3.One(),s._workingMatrix=e.Matrix.Identity(),s._cache.position=e.Vector3.Zero(),o.defaultHeight&&(s._defaultHeight=o.defaultHeight,s.position.y=s._defaultHeight),s.minZ=.1,5===arguments.length&&(s.webVROptions=arguments[4]),void 0==s.webVROptions.trackPosition&&(s.webVROptions.trackPosition=!0),void 0==s.webVROptions.controllerMeshes&&(s.webVROptions.controllerMeshes=!0),void 0==s.webVROptions.defaultLightingOnControllers&&(s.webVROptions.defaultLightingOnControllers=!0),s.rotationQuaternion=new e.Quaternion,s.webVROptions&&s.webVROptions.positionScale&&(s.deviceScaleFactor=s.webVROptions.positionScale);var a=s.getEngine();return s._onVREnabled=function(e){e&&s.initControllers()},a.onVRRequestPresentComplete.add(s._onVREnabled),a.initWebVR().add(function(t){t.vrDisplay&&s._vrDevice!==t.vrDisplay&&(s._vrDevice=t.vrDisplay,s.setCameraRigMode(e.Camera.RIG_MODE_WEBVR,{parentCamera:s,vrDisplay:s._vrDevice,frameData:s._frameData,specs:s._specsVersion}),s._attached&&s.getEngine().enableVR())}),"undefined"!=typeof VRFrameData&&(s._frameData=new VRFrameData),n.onBeforeCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&(s._descendants=s.getDescendants(!0,function(e){var t=s.controllers.some(function(t){return t._mesh===e}),i=-1!==s._rigCameras.indexOf(e);return!t&&!i}),s._descendants.forEach(function(t){t.parent=e}))}),n.onAfterCameraRenderObservable.add(function(e){e.parent===s&&s.rigParenting&&s._descendants.forEach(function(e){e.parent=s})}),s}return o(i,t),i.prototype.dispose=function(){this.getEngine().onVRRequestPresentComplete.removeCallback(this._onVREnabled),t.prototype.dispose.call(this)},i.prototype.getControllerByName=function(e){for(var t=0,i=this.controllers;t<i.length;t++){var r=i[t];if(r.hand===e)return r}return null},Object.defineProperty(i.prototype,"leftController",{get:function(){return this._leftController||(this._leftController=this.getControllerByName("left")),this._leftController},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rightController",{get:function(){return this._rightController||(this._rightController=this.getControllerByName("right")),this._rightController},enumerable:!0,configurable:!0}),i.prototype.getForwardRay=function(e){return void 0===e&&(e=100),this.leftCamera?t.prototype.getForwardRay.call(this,e,this.leftCamera.getWorldMatrix(),this.leftCamera.globalPosition):t.prototype.getForwardRay.call(this,e)},i.prototype._checkInputs=function(){this._vrDevice&&this._vrDevice.isPresenting&&(this._vrDevice.getFrameData(this._frameData),this.updateFromDevice(this._frameData.pose)),t.prototype._checkInputs.call(this)},i.prototype.updateFromDevice=function(e){e&&e.orientation&&(this.rawPose=e,this._deviceRoomRotationQuaternion.copyFromFloats(e.orientation[0],e.orientation[1],-e.orientation[2],-e.orientation[3]),this.getScene().useRightHandedSystem&&(this._deviceRoomRotationQuaternion.z*=-1,this._deviceRoomRotationQuaternion.w*=-1),this.webVROptions.trackPosition&&this.rawPose.position&&(this._deviceRoomPosition.copyFromFloats(this.rawPose.position[0],this.rawPose.position[1],-this.rawPose.position[2]),this.getScene().useRightHandedSystem&&(this._deviceRoomPosition.z*=-1)))},i.prototype.attachControl=function(i,r){t.prototype.attachControl.call(this,i,r),this._attached=!0,r=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&r,this._vrDevice&&this.getEngine().enableVR()},i.prototype.detachControl=function(e){this.getScene().gamepadManager.onGamepadConnectedObservable.remove(this._onGamepadConnectedObserver),this.getScene().gamepadManager.onGamepadDisconnectedObservable.remove(this._onGamepadDisconnectedObserver),t.prototype.detachControl.call(this,e),this._attached=!1,this.getEngine().disableVR()},i.prototype.getClassName=function(){return"WebVRFreeCamera"},i.prototype.resetToCurrentRotation=function(){this._vrDevice.resetPose()},i.prototype._updateRigCameras=function(){var e=this._rigCameras[0],t=this._rigCameras[1];e.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),t.rotationQuaternion.copyFrom(this._deviceRoomRotationQuaternion),e.position.copyFrom(this._deviceRoomPosition),t.position.copyFrom(this._deviceRoomPosition)},i.prototype._updateCache=function(i){var r=this;this.rotationQuaternion.equals(this._cache.rotationQuaternion)&&this.position.equals(this._cache.position)||(this.update(),this.rotationQuaternion.toRotationMatrix(this._workingMatrix),e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._workingMatrix,this._workingVector),this.devicePosition.subtractToRef(this._workingVector,this._workingVector),e.Matrix.ComposeToRef(this._oneVector,this.rotationQuaternion,this._workingVector,this._deviceToWorld),this._deviceToWorld.getTranslationToRef(this._workingVector),this._workingVector.addInPlace(this.position),this._workingVector.subtractInPlace(this._cache.position),this._deviceToWorld.setTranslation(this._workingVector),this._deviceToWorld.invertToRef(this._worldToDevice),this.controllers.forEach(function(e){e._deviceToWorld=r._deviceToWorld,e.update()}),this.update()),i||t.prototype._updateCache.call(this)},i.prototype.update=function(){e.Vector3.TransformCoordinatesToRef(this._deviceRoomPosition,this._deviceToWorld,this.devicePosition),e.Matrix.FromQuaternionToRef(this._deviceRoomRotationQuaternion,this._workingMatrix),this._workingMatrix.multiplyToRef(this._deviceToWorld,this._workingMatrix),e.Quaternion.FromRotationMatrixToRef(this._workingMatrix,this.deviceRotationQuaternion),t.prototype.update.call(this)},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype._getWebVRViewMatrix=function(){var t=this,i=this._cameraRigParams.left?this._cameraRigParams.frameData.leftViewMatrix:this._cameraRigParams.frameData.rightViewMatrix;e.Matrix.FromArrayToRef(i,0,this._webvrViewMatrix),this.getScene().useRightHandedSystem||[2,6,8,9,14].forEach(function(e){t._webvrViewMatrix.m[e]*=-1}),this._webvrViewMatrix.getRotationMatrixToRef(this._cameraRotationMatrix),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget);var r=this._cameraRigParams.parentCamera;return 1!==r.deviceScaleFactor&&(this._webvrViewMatrix.invert(),r.deviceScaleFactor&&(this._webvrViewMatrix.m[12]*=r.deviceScaleFactor,this._webvrViewMatrix.m[13]*=r.deviceScaleFactor,this._webvrViewMatrix.m[14]*=r.deviceScaleFactor),this._webvrViewMatrix.invert()),r._worldToDevice.multiplyToRef(this._webvrViewMatrix,this._webvrViewMatrix),this._webvrViewMatrix},i.prototype._getWebVRProjectionMatrix=function(){var t=this,i=this.parent;i._vrDevice.depthNear=i.minZ,i._vrDevice.depthFar=i.maxZ;var r=this._cameraRigParams.left?this._cameraRigParams.frameData.leftProjectionMatrix:this._cameraRigParams.frameData.rightProjectionMatrix;return e.Matrix.FromArrayToRef(r,0,this._projectionMatrix),this.getScene().useRightHandedSystem||[8,9,10,11].forEach(function(e){t._projectionMatrix.m[e]*=-1}),this._projectionMatrix},i.prototype.initControllers=function(){var t=this;this.controllers=[];var i=this.getScene().gamepadManager;this._onGamepadDisconnectedObserver=i.onGamepadDisconnectedObservable.add(function(i){if(i.type===e.Gamepad.POSE_ENABLED){var r=i;r.defaultModel&&r.defaultModel.setEnabled(!1),"right"===r.hand&&(t._rightController=null),"left"===r.hand&&(t._rightController=null);var n=t.controllers.indexOf(r);-1!==n&&t.controllers.splice(n,1)}}),this._onGamepadConnectedObserver=i.onGamepadConnectedObservable.add(function(i){if(i.type===e.Gamepad.POSE_ENABLED){var r=i;if(r._deviceToWorld=t._deviceToWorld,t.webVROptions.controllerMeshes&&(r.defaultModel?r.defaultModel.setEnabled(!0):r.initControllerMesh(t.getScene(),function(i){if(t.onControllerMeshLoadedObservable.notifyObservers(r),t.webVROptions.defaultLightingOnControllers){t._lightOnControllers||(t._lightOnControllers=new e.HemisphericLight("vrControllersLight",new e.Vector3(0,1,0),t.getScene()));var n=function(e,t){var i=e.getChildren();0!==i.length&&i.forEach(function(e){t.includedOnlyMeshes.push(e),n(e,t)})};t._lightOnControllers.includedOnlyMeshes.push(i),n(i,t._lightOnControllers)}})),r.attachToPoseControlledCamera(t),-1===t.controllers.indexOf(r)&&(t.controllers.push(r),t.controllers.length>=2)){for(var n=!1,o=0;o<t.controllers.length;o++)t.controllers[o].controllerType===e.PoseEnabledControllerType.VIVE&&(n?t.controllers[o].hand="right":(n=!0,t.controllers[o].hand="left"));t.onControllersAttachedObservable.notifyObservers(t.controllers)}}})},i}(e.FreeCamera);e.WebVRFreeCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n){var o=t.call(this,i,r,n)||this;return o._quaternionCache=new e.Quaternion,o.inputs.addDeviceOrientation(),o}return o(i,t),i.prototype.getClassName=function(){return"DeviceOrientationCamera"},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this._quaternionCache.copyFrom(this.rotationQuaternion),this._initialQuaternion&&this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)},i.prototype.resetToCurrentRotation=function(t){var i=this;void 0===t&&(t=e.Axis.Y),this.rotationQuaternion&&(this._initialQuaternion||(this._initialQuaternion=new e.Quaternion),this._initialQuaternion.copyFrom(this._quaternionCache||this.rotationQuaternion),["x","y","z"].forEach(function(e){t[e]?i._initialQuaternion[e]*=-1:i._initialQuaternion[e]=0}),this._initialQuaternion.normalize(),this._initialQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion))},i}(e.FreeCamera);e.DeviceOrientationCamera=t}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s){void 0===o&&(o=!0),void 0===s&&(s=e.VRCameraMetrics.GetDefault());var a=t.call(this,i,r,n)||this;return s.compensateDistortion=o,a.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),a}return o(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationFreeCamera"},i}(e.DeviceOrientationCamera);e.VRDeviceOrientationFreeCamera=t;var i=function(t){function i(i,r,n,o,s){void 0===o&&(o=!0),void 0===s&&(s=e.VRCameraMetrics.GetDefault());var a=t.call(this,i,r,n,o,s)||this;return a.inputs.addGamepad(),a}return o(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationGamepadCamera"},i}(t);e.VRDeviceOrientationGamepadCamera=i;var r=function(t){function i(i,r,n,o,s,a,l,h){void 0===l&&(l=!0),void 0===h&&(h=e.VRCameraMetrics.GetDefault());var c=t.call(this,i,r,n,o,s,a)||this;return h.compensateDistortion=l,c.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:h}),c.inputs.addVRDeviceOrientation(),c}return o(i,t),i.prototype.getClassName=function(){return"VRDeviceOrientationArcRotateCamera"},i}(e.ArcRotateCamera);e.VRDeviceOrientationArcRotateCamera=r}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),s}return o(i,t),i.prototype.getClassName=function(){return"AnaglyphFreeCamera"},i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,r,n,o,s,a,l){var h=t.call(this,i,r,n,o,s,l)||this;return h.interaxialDistance=a,h.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a}),h}return o(i,t),i.prototype.getClassName=function(){return"AnaglyphArcRotateCamera"},i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var r=function(t){function i(i,r,n,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),s}return o(i,t),i.prototype.getClassName=function(){return"AnaglyphGamepadCamera"},i}(e.GamepadCamera);e.AnaglyphGamepadCamera=r;var n=function(t){function i(i,r,n,o){var s=t.call(this,i,r,o)||this;return s.interaxialDistance=n,s.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:n}),s}return o(i,t),i.prototype.getClassName=function(){return"AnaglyphUniversalCamera"},i}(e.UniversalCamera);e.AnaglyphUniversalCamera=n;var s=function(t){function i(i,r,n,o,s){var a=t.call(this,i,r,s)||this;return a.interaxialDistance=n,a.isStereoscopicSideBySide=o,a.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),a}return o(i,t),i.prototype.getClassName=function(){return"StereoscopicFreeCamera"},i}(e.FreeCamera);e.StereoscopicFreeCamera=s;var a=function(t){function i(i,r,n,o,s,a,l,h){var c=t.call(this,i,r,n,o,s,h)||this;return c.interaxialDistance=a,c.isStereoscopicSideBySide=l,c.setCameraRigMode(l?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a}),c}return o(i,t),i.prototype.getClassName=function(){return"StereoscopicArcRotateCamera"},i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=a;var l=function(t){function i(i,r,n,o,s){var a=t.call(this,i,r,s)||this;return a.interaxialDistance=n,a.isStereoscopicSideBySide=o,a.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),a}return o(i,t),i.prototype.getClassName=function(){return"StereoscopicGamepadCamera"},i}(e.GamepadCamera);e.StereoscopicGamepadCamera=l;var h=function(t){function i(i,r,n,o,s){var a=t.call(this,i,r,s)||this;return a.interaxialDistance=n,a.isStereoscopicSideBySide=o,a.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:n}),a}return o(i,t),i.prototype.getClassName=function(){return"StereoscopicUniversalCamera"},i}(e.UniversalCamera);e.StereoscopicUniversalCamera=h}(r||(r={}));var r;!function(e){var t=function(){function t(t,i){void 0===i&&(i={});var r=this;if(this.webVROptions=i,this._webVRsupported=!1,this._webVRready=!1,this._webVRrequesting=!1,this._webVRpresenting=!1,this._fullscreenVRpresenting=!1,this.onEnteringVR=new e.Observable,this.onExitingVR=new e.Observable,this.onControllerMeshLoaded=new e.Observable,this._useCustomVRButton=!1,this._teleportationRequested=!1,this._teleportationEnabledOnLeftController=!1,this._teleportationEnabledOnRightController=!1,this._interactionsEnabledOnLeftController=!1,this._interactionsEnabledOnRightController=!1,this._leftControllerReady=!1,this._rightControllerReady=!1,this._floorMeshesCollection=[],this._teleportationAllowed=!1,this._rotationAllowed=!0,this._teleportationRequestInitiated=!1,this._teleportationBackRequestInitiated=!1,this.teleportBackwardsVector=new e.Vector3(0,-1,-1),this._rotationRightAsked=!1,this._rotationLeftAsked=!1,this._isDefaultTeleportationTarget=!0,this._teleportationFillColor="#444444",this._teleportationBorderColor="#FFFFFF",this._rotationAngle=0,this._haloCenter=new e.Vector3(0,0,0),this._padSensibilityUp=.65,this._padSensibilityDown=.35,this.onNewMeshSelected=new e.Observable,this._pointerDownOnMeshAsked=!1,this._isActionableMesh=!1,this._teleportationEnabled=!1,this._interactionsEnabled=!1,this._interactionsRequested=!1,this._displayGaze=!0,this._displayLaserPointer=!0,this._dpadPressed=!0,this._onResize=function(){r.moveButtonToBottomRight(),r._fullscreenVRpresenting&&r._webVRready&&r.exitVR()},this._onFullscreenChange=function(){void 0!==document.fullscreen?r._fullscreenVRpresenting=document.fullscreen:void 0!==document.mozFullScreen?r._fullscreenVRpresenting=document.mozFullScreen:void 0!==document.webkitIsFullScreen?r._fullscreenVRpresenting=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(r._fullscreenVRpresenting=document.msIsFullScreen),!r._fullscreenVRpresenting&&r._canvas&&(r.exitVR(),r._useCustomVRButton||(r._btnVR.style.top=r._canvas.offsetTop+r._canvas.offsetHeight-70+"px",r._btnVR.style.left=r._canvas.offsetLeft+r._canvas.offsetWidth-100+"px"))},this.beforeRender=function(){r._castRayAndSelectObject()},this._onNewGamepadConnected=function(t){t.type!==e.Gamepad.POSE_ENABLED&&(t.leftStick&&t.onleftstickchanged(function(e){r._teleportationEnabled&&(!r._leftLaserPointer&&!r._rightLaserPointer||r._leftLaserPointer&&!r._leftLaserPointer.isVisible&&r._rightLaserPointer&&!r._rightLaserPointer.isVisible)&&(r._checkTeleportWithRay(e),r._checkTeleportBackwards(e))}),t.rightStick&&t.onrightstickchanged(function(e){r._teleportationEnabled&&r._checkRotate(e)}),t.type===e.Gamepad.XBOX&&(t.onbuttondown(function(t){r._interactionsEnabled&&t===e.Xbox360Button.A&&r._selectionPointerDown()}),t.onbuttonup(function(t){r._interactionsEnabled&&t===e.Xbox360Button.A&&r._selectionPointerUp()})))},this._onNewGamepadDisconnected=function(t){t instanceof e.WebVRController&&("left"===t.hand&&(r._interactionsEnabledOnLeftController=!1,r._teleportationEnabledOnLeftController=!1,r._leftControllerReady=!1,r._leftLaserPointer&&r._leftLaserPointer.dispose()),"right"===t.hand&&(r._interactionsEnabledOnRightController=!1,r._teleportationEnabledOnRightController=!1,r._rightControllerReady=!1,r._rightLaserPointer&&r._rightLaserPointer.dispose()))},this._workingVector=e.Vector3.Zero(),this._workingQuaternion=e.Quaternion.Identity(),this._workingMatrix=e.Matrix.Identity(),this._scene=t,this._canvas=t.getEngine().getRenderingCanvas(),void 0===i.createFallbackVRDeviceOrientationFreeCamera&&(i.createFallbackVRDeviceOrientationFreeCamera=!0),void 0===i.createDeviceOrientationCamera&&(i.createDeviceOrientationCamera=!0),void 0===i.defaultHeight&&(i.defaultHeight=1.7),i.useCustomVRButton&&(this._useCustomVRButton=!0,i.customVRButton&&(this._btnVR=i.customVRButton)),i.rayLength&&(this._rayLength=i.rayLength),this._defaultHeight=i.defaultHeight,this._scene.activeCamera?this._position=this._scene.activeCamera.position.clone():this._position=new e.Vector3(0,this._defaultHeight,0),i.createDeviceOrientationCamera||!this._scene.activeCamera){if(this._deviceOrientationCamera=new e.DeviceOrientationCamera("deviceOrientationVRHelper",this._position.clone(),t),this._scene.activeCamera&&(this._deviceOrientationCamera.minZ=this._scene.activeCamera.minZ,this._deviceOrientationCamera.maxZ=this._scene.activeCamera.maxZ,this._scene.activeCamera instanceof e.TargetCamera&&this._scene.activeCamera.rotation)){var n=this._scene.activeCamera;n.rotationQuaternion?this._deviceOrientationCamera.rotationQuaternion.copyFrom(n.rotationQuaternion):this._deviceOrientationCamera.rotationQuaternion.copyFrom(e.Quaternion.RotationYawPitchRoll(n.rotation.y,n.rotation.x,n.rotation.z)),this._deviceOrientationCamera.rotation=n.rotation.clone()}this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)}else this._existingCamera=this._scene.activeCamera;if(i.createFallbackVRDeviceOrientationFreeCamera&&(this._vrDeviceOrientationCamera=new e.VRDeviceOrientationFreeCamera("VRDeviceOrientationVRHelper",this._position,this._scene)),this._webVRCamera=new e.WebVRFreeCamera("WebVRHelper",this._position,this._scene,i),this._webVRCamera.useStandingMatrix(),!this._useCustomVRButton){this._btnVR=document.createElement("BUTTON"),this._btnVR.className="babylonVRicon",this._btnVR.id="babylonVRiconbtn",this._btnVR.title="Click to switch to VR";var o=".babylonVRicon { position: absolute; right: 20px; height: 50px; width: 80px; background-color: rgba(51,51,51,0.7); background-image: url(data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%222048%22%20height%3D%221152%22%20viewBox%3D%220%200%202048%201152%22%20version%3D%221.1%22%3E%3Cpath%20transform%3D%22rotate%28180%201024%2C576.0000000000001%29%22%20d%3D%22m1109%2C896q17%2C0%2030%2C-12t13%2C-30t-12.5%2C-30.5t-30.5%2C-12.5l-170%2C0q-18%2C0%20-30.5%2C12.5t-12.5%2C30.5t13%2C30t30%2C12l170%2C0zm-85%2C256q59%2C0%20132.5%2C-1.5t154.5%2C-5.5t164.5%2C-11.5t163%2C-20t150%2C-30t124.5%2C-41.5q23%2C-11%2042%2C-24t38%2C-30q27%2C-25%2041%2C-61.5t14%2C-72.5l0%2C-257q0%2C-123%20-47%2C-232t-128%2C-190t-190%2C-128t-232%2C-47l-81%2C0q-37%2C0%20-68.5%2C14t-60.5%2C34.5t-55.5%2C45t-53%2C45t-53%2C34.5t-55.5%2C14t-55.5%2C-14t-53%2C-34.5t-53%2C-45t-55.5%2C-45t-60.5%2C-34.5t-68.5%2C-14l-81%2C0q-123%2C0%20-232%2C47t-190%2C128t-128%2C190t-47%2C232l0%2C257q0%2C68%2038%2C115t97%2C73q54%2C24%20124.5%2C41.5t150%2C30t163%2C20t164.5%2C11.5t154.5%2C5.5t132.5%2C1.5zm939%2C-298q0%2C39%20-24.5%2C67t-58.5%2C42q-54%2C23%20-122%2C39.5t-143.5%2C28t-155.5%2C19t-157%2C11t-148.5%2C5t-129.5%2C1.5q-59%2C0%20-130%2C-1.5t-148%2C-5t-157%2C-11t-155.5%2C-19t-143.5%2C-28t-122%2C-39.5q-34%2C-14%20-58.5%2C-42t-24.5%2C-67l0%2C-257q0%2C-106%2040.5%2C-199t110%2C-162.5t162.5%2C-109.5t199%2C-40l81%2C0q27%2C0%2052%2C14t50%2C34.5t51%2C44.5t55.5%2C44.5t63.5%2C34.5t74%2C14t74%2C-14t63.5%2C-34.5t55.5%2C-44.5t51%2C-44.5t50%2C-34.5t52%2C-14l14%2C0q37%2C0%2070%2C0.5t64.5%2C4.5t63.5%2C12t68%2C23q71%2C30%20128.5%2C78.5t98.5%2C110t63.5%2C133.5t22.5%2C149l0%2C257z%22%20fill%3D%22white%22%20/%3E%3C/svg%3E%0A); background-size: 80%; background-repeat:no-repeat; background-position: center; border: none; outline: none; transition: transform 0.125s ease-out } .babylonVRicon:hover { transform: scale(1.05) } .babylonVRicon:active {background-color: rgba(51,51,51,1) } .babylonVRicon:focus {background-color: rgba(51,51,51,1) }";o+=".babylonVRicon.vrdisplaypresenting { display: none; }";var s=document.createElement("style");s.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(s),this.moveButtonToBottomRight()}this._btnVR&&this._btnVR.addEventListener("click",function(){r.isInVRMode?r.exitVR():r.enterVR()}),window.addEventListener("resize",this._onResize),document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),i.createFallbackVRDeviceOrientationFreeCamera?this.displayVRButton():this._scene.getEngine().onVRDisplayChangedObservable.add(function(e){e.vrDisplay&&r.displayVRButton()}),this._onKeyDown=function(e){27===e.keyCode&&r.isInVRMode&&r.exitVR()},document.addEventListener("keydown",this._onKeyDown),this._scene.onPrePointerObservable.add(function(e,t){r.isInVRMode&&(r.exitVR(),r._fullscreenVRpresenting&&r._scene.getEngine().switchFullscreen(!0))},e.PointerEventTypes.POINTERDOUBLETAP,!1),this._onVRDisplayChanged=function(e){return r.onVRDisplayChanged(e)},this._onVrDisplayPresentChange=function(){return r.onVrDisplayPresentChange()},this._onVRRequestPresentStart=function(){r._webVRrequesting=!0,r.updateButtonVisibility()},this._onVRRequestPresentComplete=function(e){r._webVRrequesting=!1,r.updateButtonVisibility()},t.getEngine().onVRDisplayChangedObservable.add(this._onVRDisplayChanged),t.getEngine().onVRRequestPresentStart.add(this._onVRRequestPresentStart),t.getEngine().onVRRequestPresentComplete.add(this._onVRRequestPresentComplete),window.addEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),t.onDisposeObservable.add(function(){r.dispose()}),this._webVRCamera.onControllerMeshLoadedObservable.add(function(e){return r._onDefaultMeshLoaded(e)}),this._scene.gamepadManager.onGamepadConnectedObservable.add(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.add(this._onNewGamepadDisconnected),this.updateButtonVisibility(),this._circleEase=new e.CircleEase,this._circleEase.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT)}return Object.defineProperty(t.prototype,"teleportationTarget",{get:function(){return this._teleportationTarget},set:function(e){e&&(e.name="teleportationTarget",this._isDefaultTeleportationTarget=!1,this._teleportationTarget=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayGaze",{get:function(){return this._displayGaze},set:function(e){this._displayGaze=e,e||(this._gazeTracker.isVisible=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLaserPointer",{get:function(){return this._displayLaserPointer},set:function(e){this._displayLaserPointer=e,e?this._rightLaserPointer?this._rightLaserPointer.isVisible=!0:this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!0):(this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!1),this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deviceOrientationCamera",{get:function(){return this._deviceOrientationCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentVRCamera",{get:function(){return this._webVRready?this._webVRCamera:this._scene.activeCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"webVRCamera",{get:function(){return this._webVRCamera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vrDeviceOrientationCamera",{get:function(){return this._vrDeviceOrientationCamera},enumerable:!0,configurable:!0}),t.prototype._onDefaultMeshLoaded=function(t){"left"===t.hand&&(this._leftControllerReady=!0,this._interactionsRequested&&!this._interactionsEnabledOnLeftController&&this._enableInteractionOnController(t),this._teleportationRequested&&!this._teleportationEnabledOnLeftController&&this._enableTeleportationOnController(t)),"right"===t.hand&&(this._rightControllerReady=!0,this._interactionsRequested&&!this._interactionsEnabledOnRightController&&this._enableInteractionOnController(t),this._teleportationRequested&&!this._teleportationEnabledOnRightController&&this._enableTeleportationOnController(t));try{this.onControllerMeshLoaded.notifyObservers(t)}catch(t){e.Tools.Warn("Error in your custom logic onControllerMeshLoaded: "+t)}},Object.defineProperty(t.prototype,"isInVRMode",{get:function(){return this._webVRpresenting||this._fullscreenVRpresenting},enumerable:!0,configurable:!0}),t.prototype.onVrDisplayPresentChange=function(){var t=this._scene.getEngine().getVRDevice();if(t){var i=this._webVRpresenting;this._webVRpresenting=t.isPresenting,i&&!this._webVRpresenting&&this.exitVR()}else e.Tools.Warn("Detected VRDisplayPresentChange on an unknown VRDisplay. Did you can enterVR on the vrExperienceHelper?");this.updateButtonVisibility()},t.prototype.onVRDisplayChanged=function(e){this._webVRsupported=e.vrSupported,this._webVRready=!!e.vrDisplay,this._webVRpresenting=e.vrDisplay&&e.vrDisplay.isPresenting,this.updateButtonVisibility()},t.prototype.moveButtonToBottomRight=function(){this._canvas&&!this._useCustomVRButton&&(this._btnVR.style.top=this._canvas.offsetTop+this._canvas.offsetHeight-70+"px",this._btnVR.style.left=this._canvas.offsetLeft+this._canvas.offsetWidth-100+"px")},t.prototype.displayVRButton=function(){this._useCustomVRButton||this._btnVRDisplayed||(document.body.appendChild(this._btnVR),this._btnVRDisplayed=!0)},t.prototype.updateButtonVisibility=function(){this._btnVR&&!this._useCustomVRButton&&(this._btnVR.className="babylonVRicon",this.isInVRMode?this._btnVR.className+=" vrdisplaypresenting":(this._webVRready&&(this._btnVR.className+=" vrdisplayready"),this._webVRsupported&&(this._btnVR.className+=" vrdisplaysupported"),this._webVRrequesting&&(this._btnVR.className+=" vrdisplayrequesting")))},t.prototype.enterVR=function(){if(this.onEnteringVR)try{this.onEnteringVR.notifyObservers(this)}catch(t){e.Tools.Warn("Error in your custom logic onEnteringVR: "+t)}this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._webVRrequesting||(this._webVRready?this._webVRpresenting||(this._webVRCamera.position=this._position,this._scene.activeCamera=this._webVRCamera):this._vrDeviceOrientationCamera&&(this._vrDeviceOrientationCamera.position=this._position,this._scene.activeCamera=this._vrDeviceOrientationCamera,this._scene.getEngine().switchFullscreen(!0),this.updateButtonVisibility()),this._scene.activeCamera&&this._canvas&&this._scene.activeCamera.attachControl(this._canvas))},t.prototype.exitVR=function(){if(this.onExitingVR)try{this.onExitingVR.notifyObservers(this)}catch(t){e.Tools.Warn("Error in your custom logic onExitingVR: "+t)}this._webVRpresenting&&this._scene.getEngine().disableVR(),this._scene.activeCamera&&(this._position=this._scene.activeCamera.position.clone()),this._deviceOrientationCamera?(this._deviceOrientationCamera.position=this._position,this._scene.activeCamera=this._deviceOrientationCamera,this._canvas&&this._scene.activeCamera.attachControl(this._canvas)):this._existingCamera&&(this._existingCamera.position=this._position,this._scene.activeCamera=this._existingCamera),this.updateButtonVisibility()},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._scene.activeCamera&&(this._scene.activeCamera.position=e)},enumerable:!0,configurable:!0}),t.prototype.enableInteractions=function(){var e=this;this._interactionsEnabled||(this._interactionsRequested=!0,this._leftControllerReady&&this._webVRCamera.leftController&&this._enableInteractionOnController(this._webVRCamera.leftController),this._rightControllerReady&&this._webVRCamera.rightController&&this._enableInteractionOnController(this._webVRCamera.rightController),this._createGazeTracker(),this.raySelectionPredicate=function(e){return!0},this.meshSelectionPredicate=function(e){return!0},this._raySelectionPredicate=function(t){return!!(e._isTeleportationFloor(t)||t.isVisible&&-1===t.name.indexOf("gazeTracker")&&-1===t.name.indexOf("teleportationTarget")&&-1===t.name.indexOf("torusTeleportation")&&-1===t.name.indexOf("laserPointer"))&&e.raySelectionPredicate(t)},this._scene.registerBeforeRender(this.beforeRender),this._interactionsEnabled=!0)},t.prototype._isTeleportationFloor=function(e){for(var t=0;t<this._floorMeshesCollection.length;t++)if(this._floorMeshesCollection[t].id===e.id)return!0;return!(!this._floorMeshName||e.name!==this._floorMeshName)},t.prototype.addFloorMesh=function(e){this._floorMeshesCollection&&(this._floorMeshesCollection.indexOf(e)>-1||this._floorMeshesCollection.push(e))},t.prototype.removeFloorMesh=function(e){if(this._floorMeshesCollection){var t=this._floorMeshesCollection.indexOf(e);-1!==t&&this._floorMeshesCollection.splice(t,1)}},t.prototype.enableTeleportation=function(t){if(void 0===t&&(t={}),!this._teleportationEnabled){this._teleportationRequested=!0,this.enableInteractions(),t&&(t.floorMeshName&&(this._floorMeshName=t.floorMeshName),t.floorMeshes&&(this._floorMeshesCollection=t.floorMeshes)),this._leftControllerReady&&this._webVRCamera.leftController&&this._enableTeleportationOnController(this._webVRCamera.leftController),this._rightControllerReady&&this._webVRCamera.rightController&&this._enableTeleportationOnController(this._webVRCamera.rightController);var i=new e.ImageProcessingConfiguration;i.vignetteColor=new e.Color4(0,0,0,0),i.vignetteEnabled=!0,this._postProcessMove=new e.ImageProcessingPostProcess("postProcessMove",1,this._webVRCamera,void 0,void 0,void 0,void 0,i),this._webVRCamera.detachPostProcess(this._postProcessMove),this._passProcessMove=new e.PassPostProcess("pass",1,this._webVRCamera),this._teleportationEnabled=!0,this._isDefaultTeleportationTarget&&this._createTeleportationCircles()}},t.prototype._enableInteractionOnController=function(t){var i=this,r=t.mesh;if(r){var n=function(e){e.name+=" laserPointer",e.getChildMeshes().forEach(function(e){n(e)})};n(r);for(var o=r.getChildMeshes(),s=0;s<o.length;s++)if(o[s].name&&o[s].name.indexOf("POINTING_POSE")>=0){r=o[s];break}var a=e.Mesh.CreateCylinder("laserPointer",1,.004,2e-4,20,1,this._scene,!1),l=new e.StandardMaterial("laserPointerMat",this._scene);l.emissiveColor=new e.Color3(.7,.7,.7),l.alpha=.6,a.material=l,a.rotation.x=Math.PI/2,a.parent=r,a.position.z=-.5,a.isVisible=!1,"left"===t.hand?(this._leftLaserPointer=a,this._interactionsEnabledOnLeftController=!0,this._rightLaserPointer||(this._leftLaserPointer.isVisible=!0)):(this._rightLaserPointer=a,this._interactionsEnabledOnRightController=!0,this._leftLaserPointer||(this._rightLaserPointer.isVisible=!0)),t.onMainButtonStateChangedObservable.add(function(e){i._displayLaserPointer&&1===e.value&&(a.isVisible=!a.isVisible,"left"===t.hand&&i._rightLaserPointer?i._rightLaserPointer.isVisible=!1:i._leftLaserPointer&&(i._leftLaserPointer.isVisible=!1))}),t.onTriggerStateChangedObservable.add(function(e){i._pointerDownOnMeshAsked?e.value<i._padSensibilityDown&&i._selectionPointerUp():e.value>i._padSensibilityUp&&i._selectionPointerDown()})}},t.prototype._checkTeleportWithRay=function(e,t){void 0===t&&(t=null),this._teleportationRequestInitiated?(null==t||"left"===t.hand&&this._leftLaserPointer&&this._leftLaserPointer.isVisible||"right"===t.hand&&this._rightLaserPointer&&this._rightLaserPointer.isVisible)&&Math.sqrt(e.y*e.y+e.x*e.x)<this._padSensibilityDown&&(this._teleportationAllowed&&(this._teleportationAllowed=!1,this._teleportCamera()),this._teleportationRequestInitiated=!1):e.y<-this._padSensibilityUp&&this._dpadPressed&&(t&&(this._displayLaserPointer&&"left"===t.hand&&this._leftLaserPointer?(this._leftLaserPointer.isVisible=!0,this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!1)):this._displayLaserPointer&&this._rightLaserPointer&&(this._rightLaserPointer.isVisible=!0,this._leftLaserPointer&&(this._leftLaserPointer.isVisible=!1))),this._teleportationRequestInitiated=!0)},t.prototype._selectionPointerDown=function(){this._pointerDownOnMeshAsked=!0,this._currentMeshSelected&&this._currentHit&&this._scene.simulatePointerDown(this._currentHit)},t.prototype._selectionPointerUp=function(){this._currentMeshSelected&&this._currentHit&&this._scene.simulatePointerUp(this._currentHit),this._pointerDownOnMeshAsked=!1},t.prototype._checkRotate=function(e){this._teleportationRequestInitiated||(this._rotationLeftAsked?e.x>-this._padSensibilityDown&&(this._rotationLeftAsked=!1):e.x<-this._padSensibilityUp&&this._dpadPressed&&(this._rotationLeftAsked=!0,this._rotationAllowed&&this._rotateCamera(!1)),this._rotationRightAsked?e.x<this._padSensibilityDown&&(this._rotationRightAsked=!1):e.x>this._padSensibilityUp&&this._dpadPressed&&(this._rotationRightAsked=!0,this._rotationAllowed&&this._rotateCamera(!0)))},t.prototype._checkTeleportBackwards=function(t){if(!this._teleportationRequestInitiated)if(t.y>this._padSensibilityUp&&this._dpadPressed){if(!this._teleportationBackRequestInitiated){if(!this.currentVRCamera)return;var i=e.Quaternion.FromRotationMatrix(this.currentVRCamera.getWorldMatrix().getRotationMatrix()),r=this.currentVRCamera.position;this.currentVRCamera.devicePosition&&this.currentVRCamera.deviceRotationQuaternion&&(i=this.currentVRCamera.deviceRotationQuaternion,r=this.currentVRCamera.devicePosition),i.toEulerAnglesToRef(this._workingVector),this._workingVector.z=0,this._workingVector.x=0,e.Quaternion.RotationYawPitchRollToRef(this._workingVector.y,this._workingVector.x,this._workingVector.z,this._workingQuaternion),this._workingQuaternion.toRotationMatrix(this._workingMatrix),e.Vector3.TransformCoordinatesToRef(this.teleportBackwardsVector,this._workingMatrix,this._workingVector);var n=new e.Ray(r,this._workingVector),o=this._scene.pickWithRay(n,this._raySelectionPredicate);o&&o.pickedPoint&&o.pickedMesh&&this._isTeleportationFloor(o.pickedMesh)&&o.distance<5&&this._teleportCamera(o.pickedPoint),this._teleportationBackRequestInitiated=!0}}else this._teleportationBackRequestInitiated=!1},t.prototype._enableTeleportationOnController=function(t){var i=this;t.mesh&&("left"===t.hand?(this._interactionsEnabledOnLeftController||this._enableInteractionOnController(t),this._teleportationEnabledOnLeftController=!0):(this._interactionsEnabledOnRightController||this._enableInteractionOnController(t),this._teleportationEnabledOnRightController=!0),t.controllerType===e.PoseEnabledControllerType.VIVE&&(this._dpadPressed=!1,t.onPadStateChangedObservable.add(function(e){i._dpadPressed=e.pressed,i._dpadPressed||(i._rotationLeftAsked=!1,i._rotationRightAsked=!1,i._teleportationBackRequestInitiated=!1)})),t.onPadValuesChangedObservable.add(function(e){i._checkTeleportBackwards(e),i._checkTeleportWithRay(e,t),i._checkRotate(e)}))},t.prototype._createGazeTracker=function(){this._gazeTracker=e.Mesh.CreateTorus("gazeTracker",.0035,.0025,20,this._scene,!1),this._gazeTracker.bakeCurrentTransformIntoVertices(),this._gazeTracker.isPickable=!1,this._gazeTracker.isVisible=!1;var t=new e.StandardMaterial("targetMat",this._scene);t.specularColor=e.Color3.Black(),t.emissiveColor=new e.Color3(.7,.7,.7),t.backFaceCulling=!1,this._gazeTracker.material=t},t.prototype._createTeleportationCircles=function(){this._teleportationTarget=e.Mesh.CreateGround("teleportationTarget",2,2,2,this._scene),this._teleportationTarget.isPickable=!1;var t=new e.DynamicTexture("DynamicTexture",512,this._scene,!0);t.hasAlpha=!0;var i=t.getContext();i.beginPath(),i.arc(256,256,200,0,2*Math.PI,!1),i.fillStyle=this._teleportationFillColor,i.fill(),i.lineWidth=10,i.strokeStyle=this._teleportationBorderColor,i.stroke(),i.closePath(),t.update();var r=new e.StandardMaterial("TextPlaneMaterial",this._scene);r.diffuseTexture=t,this._teleportationTarget.material=r;var n=e.Mesh.CreateTorus("torusTeleportation",.75,.1,25,this._scene,!1);n.isPickable=!1,n.parent=this._teleportationTarget;var o=new e.Animation("animationInnerCircle","position.y",30,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CYCLE),s=[];s.push({frame:0,value:0}),s.push({frame:30,value:.4}),s.push({frame:60,value:0}),o.setKeys(s);var a=new e.SineEase;a.setEasingMode(e.EasingFunction.EASINGMODE_EASEINOUT),o.setEasingFunction(a),n.animations=[],n.animations.push(o),this._scene.beginAnimation(n,0,60,!0),this._hideTeleportationTarget()},t.prototype._displayTeleportationTarget=function(){this._teleportationEnabled&&(this._teleportationTarget.isVisible=!0,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!0))},t.prototype._hideTeleportationTarget=function(){this._teleportationEnabled&&(this._teleportationTarget.isVisible=!1,this._isDefaultTeleportationTarget&&(this._teleportationTarget.getChildren()[0].isVisible=!1))},t.prototype._rotateCamera=function(t){var i=this;if(this.currentVRCamera instanceof e.FreeCamera){t?this._rotationAngle++:this._rotationAngle--,this.currentVRCamera.animations=[];var r=e.Quaternion.FromRotationMatrix(e.Matrix.RotationY(Math.PI/4*this._rotationAngle)),n=new e.Animation("animationRotation","rotationQuaternion",90,e.Animation.ANIMATIONTYPE_QUATERNION,e.Animation.ANIMATIONLOOPMODE_CONSTANT),o=[];o.push({frame:0,value:this.currentVRCamera.rotationQuaternion}),o.push({frame:6,value:r}),n.setKeys(o),n.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(n),this._postProcessMove.animations=[];var s=new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),a=[];a.push({frame:0,value:0}),a.push({frame:3,value:4}),a.push({frame:6,value:0}),s.setKeys(a),s.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(s);var l=new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:0}),h.push({frame:3,value:10}),h.push({frame:6,value:0}),l.setKeys(h),l.setEasingFunction(this._circleEase),this._postProcessMove.animations.push(l),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,6,!1,1,function(){i._webVRCamera.detachPostProcess(i._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,6,!1,1)}},t.prototype._moveTeleportationSelectorTo=function(t){if(t.pickedPoint){this._teleportationAllowed=!0,this._teleportationRequestInitiated?this._displayTeleportationTarget():this._hideTeleportationTarget(),this._haloCenter.copyFrom(t.pickedPoint),this._teleportationTarget.position.copyFrom(t.pickedPoint);var i=t.getNormal(!0,!1);if(i){var r=e.Vector3.Cross(e.Axis.Y,i),n=e.Vector3.Cross(i,r);e.Vector3.RotationFromAxisToRef(n,i,r,this._teleportationTarget.rotation)}this._teleportationTarget.position.y+=.1}},t.prototype._teleportCamera=function(t){var i=this;if(void 0===t&&(t=null),this.currentVRCamera instanceof e.FreeCamera){t||(t=this._haloCenter),this.webVRCamera.leftCamera?(this._workingVector.copyFrom(this.webVRCamera.leftCamera.globalPosition),this._workingVector.subtractInPlace(this.webVRCamera.position),t.subtractToRef(this._workingVector,this._workingVector)):this._workingVector.copyFrom(t),this.isInVRMode?this._workingVector.y+=this.webVRCamera.deviceDistanceToRoomGround():this._workingVector.y+=this._defaultHeight,this.currentVRCamera.animations=[];var r=new e.Animation("animationCameraTeleportation","position",90,e.Animation.ANIMATIONTYPE_VECTOR3,e.Animation.ANIMATIONLOOPMODE_CONSTANT),n=[{frame:0,value:this.currentVRCamera.position},{frame:11,value:this._workingVector}];r.setKeys(n),r.setEasingFunction(this._circleEase),this.currentVRCamera.animations.push(r),this._postProcessMove.animations=[];var o=new e.Animation("animationPP","vignetteWeight",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),s=[];s.push({frame:0,value:0}),s.push({frame:5,value:8}),s.push({frame:11,value:0}),o.setKeys(s),this._postProcessMove.animations.push(o);var a=new e.Animation("animationPP2","vignetteStretch",90,e.Animation.ANIMATIONTYPE_FLOAT,e.Animation.ANIMATIONLOOPMODE_CONSTANT),l=[];l.push({frame:0,value:0}),l.push({frame:5,value:10}),l.push({frame:11,value:0}),a.setKeys(l),this._postProcessMove.animations.push(a),this._postProcessMove.imageProcessingConfiguration.vignetteWeight=0,this._postProcessMove.imageProcessingConfiguration.vignetteStretch=0,this._webVRCamera.attachPostProcess(this._postProcessMove),this._scene.beginAnimation(this._postProcessMove,0,11,!1,1,function(){i._webVRCamera.detachPostProcess(i._postProcessMove)}),this._scene.beginAnimation(this.currentVRCamera,0,11,!1,1)}},t.prototype._castRayAndSelectObject=function(){if(this.currentVRCamera instanceof e.FreeCamera){var t;t=this._leftLaserPointer&&this._leftLaserPointer.isVisible&&this.currentVRCamera.leftController?this.currentVRCamera.leftController.getForwardRay(this._rayLength):this._rightLaserPointer&&this._rightLaserPointer.isVisible&&this.currentVRCamera.rightController?this.currentVRCamera.rightController.getForwardRay(this._rayLength):this.currentVRCamera.getForwardRay(this._rayLength);var i=this._scene.pickWithRay(t,this._raySelectionPredicate);if(i&&i.pickedPoint){if(this._displayGaze){var r=1;this._gazeTracker.isVisible=!0,this._isActionableMesh&&(r=3),this._gazeTracker.scaling.x=i.distance*r,this._gazeTracker.scaling.y=i.distance*r,this._gazeTracker.scaling.z=i.distance*r;var n=i.getNormal();if(n){var o=e.Vector3.Cross(e.Axis.Y,n),s=e.Vector3.Cross(n,o);e.Vector3.RotationFromAxisToRef(s,n,o,this._gazeTracker.rotation)}this._gazeTracker.position.copyFrom(i.pickedPoint),this._gazeTracker.position.x<0?this._gazeTracker.position.x+=.002:this._gazeTracker.position.x-=.002,this._gazeTracker.position.y<0?this._gazeTracker.position.y+=.002:this._gazeTracker.position.y-=.002,this._gazeTracker.position.z<0?this._gazeTracker.position.z+=.002:this._gazeTracker.position.z-=.002}this._rightLaserPointer&&this._rightLaserPointer.isVisible&&(this._rightLaserPointer.scaling.y=i.distance,this._rightLaserPointer.position.z=-i.distance/2),this._leftLaserPointer&&this._leftLaserPointer.isVisible&&(this._leftLaserPointer.scaling.y=i.distance,this._leftLaserPointer.position.z=-i.distance/2)}else this._gazeTracker.isVisible=!1;if(i&&i.pickedMesh){if(this._currentHit=i,this._pointerDownOnMeshAsked&&this._scene.simulatePointerMove(this._currentHit),this._teleportationEnabled&&this._isTeleportationFloor(i.pickedMesh)&&i.pickedPoint)return void this._moveTeleportationSelectorTo(i);if(this._hideTeleportationTarget(),this._teleportationAllowed=!1,i.pickedMesh!==this._currentMeshSelected)if(this.meshSelectionPredicate(i.pickedMesh)){this._currentMeshSelected=i.pickedMesh,i.pickedMesh.isPickable&&i.pickedMesh.actionManager?(this.changeGazeColor(new e.Color3(0,0,1)),this.changeLaserColor(new e.Color3(.2,.2,1)),this._isActionableMesh=!0):(this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7)),this._isActionableMesh=!1);try{this.onNewMeshSelected.notifyObservers(this._currentMeshSelected)}catch(t){e.Tools.Warn("Error in your custom logic onNewMeshSelected: "+t)}}else this._currentMeshSelected=null,this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7))}else this._currentHit=null,this._currentMeshSelected=null,this._teleportationAllowed=!1,this._hideTeleportationTarget(),this.changeGazeColor(new e.Color3(.7,.7,.7)),this.changeLaserColor(new e.Color3(.7,.7,.7))}},t.prototype.changeLaserColor=function(e){this._leftLaserPointer&&this._leftLaserPointer.material&&(this._leftLaserPointer.material.emissiveColor=e),this._rightLaserPointer&&this._rightLaserPointer.material&&(this._rightLaserPointer.material.emissiveColor=e)},t.prototype.changeGazeColor=function(e){this._gazeTracker.material&&(this._gazeTracker.material.emissiveColor=e)},t.prototype.dispose=function(){this.isInVRMode&&this.exitVR(),this._passProcessMove&&this._passProcessMove.dispose(),this._postProcessMove&&this._postProcessMove.dispose(),this._webVRCamera&&this._webVRCamera.dispose(),this._vrDeviceOrientationCamera&&this._vrDeviceOrientationCamera.dispose(),!this._useCustomVRButton&&this._btnVR.parentNode&&document.body.removeChild(this._btnVR),this._deviceOrientationCamera&&this._scene.activeCamera!=this._deviceOrientationCamera&&this._deviceOrientationCamera.dispose(),this._gazeTracker&&this._gazeTracker.dispose(),this._teleportationTarget&&this._teleportationTarget.dispose(),this._floorMeshesCollection=[],document.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),window.removeEventListener("resize",this._onResize),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),this._scene.getEngine().onVRDisplayChangedObservable.removeCallback(this._onVRDisplayChanged),this._scene.getEngine().onVRRequestPresentStart.removeCallback(this._onVRRequestPresentStart),this._scene.getEngine().onVRRequestPresentComplete.removeCallback(this._onVRRequestPresentComplete),window.removeEventListener("vrdisplaypresentchange",this._onVrDisplayPresentChange),this._scene.gamepadManager.onGamepadConnectedObservable.removeCallback(this._onNewGamepadConnected),this._scene.gamepadManager.onGamepadDisconnectedObservable.removeCallback(this._onNewGamepadDisconnected),this._scene.unregisterBeforeRender(this.beforeRender)},t.prototype.getClassName=function(){return"VRExperienceHelper"},t}();e.VRExperienceHelper=t}(r||(r={}));var r;!function(e){var t;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(t=e.JoystickAxis||(e.JoystickAxis={}));var i=function(){function i(r){var n=this;if(this._leftJoystick=!!r,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=t.X,this._axisTargetedByUpAndDown=t.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new e.StringDictionary,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._onResize=function(e){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas&&(i.vjCanvas.width=i.vjCanvasWidth,i.vjCanvas.height=i.vjCanvasHeight),i.halfWidth=i.vjCanvasWidth/2},!i.vjCanvas){window.addEventListener("resize",this._onResize,!1),i.vjCanvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas.width=window.innerWidth,i.vjCanvas.height=window.innerHeight,i.vjCanvas.style.width="100%",i.vjCanvas.style.height="100%",i.vjCanvas.style.position="absolute",i.vjCanvas.style.backgroundColor="transparent",i.vjCanvas.style.top="0px",i.vjCanvas.style.left="0px",i.vjCanvas.style.zIndex="5",i.vjCanvas.style.msTouchAction="none",i.vjCanvas.setAttribute("touch-action","none");var o=i.vjCanvas.getContext("2d");if(!o)throw new Error("Unable to create canvas for virtual joystick");i.vjCanvasContext=o,i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.vjCanvas)}i.halfWidth=i.vjCanvas.width/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPreviousPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),this._onPointerDownHandlerRef=function(e){n._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){n._onPointerMove(e)},this._onPointerUpHandlerRef=function(e){n._onPointerUp(e)},i.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){n._drawVirtualJoystick()})}return i.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(e){var t;e.preventDefault(),t=!0===this._leftJoystick?e.clientX<i.halfWidth:e.clientX>i.halfWidth,t&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),{x:e.clientX,y:e.clientY,prevX:e.clientX,prevY:e.clientY}))},i.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var i=this.reverseLeftRight?-1:1,r=i*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,r));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,r));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,r))}var n=this.reverseUpDown?1:-1,o=n*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var s=this._touches.get(e.pointerId.toString());s&&(s.x=e.clientX,s.y=e.clientY)}},i.prototype._onPointerUp=function(e){if(this._joystickPointerID==e.pointerId)i.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-64,this._joystickPointerStartPos.y-64,128,128),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-42,this._joystickPreviousPointerPos.y-42,84,84),this._joystickPointerID=-1,this.pressed=!1;else{var t=this._touches.get(e.pointerId.toString());t&&i.vjCanvasContext.clearRect(t.prevX-44,t.prevY-44,88,88)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},i.prototype.setJoystickColor=function(e){this._joystickColor=e},i.prototype.setActionOnTouch=function(e){this._action=e},i.prototype.setAxisForLeftRight=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=t.X}},i.prototype.setAxisForUpDown=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=t.Y}},i.prototype._drawVirtualJoystick=function(){var e=this;this.pressed&&this._touches.forEach(function(t,r){r.pointerId===e._joystickPointerID?(i.vjCanvasContext.clearRect(e._joystickPointerStartPos.x-64,e._joystickPointerStartPos.y-64,128,128),i.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x-42,e._joystickPreviousPointerPos.y-42,84,84),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,60,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerPos.x,e._joystickPointerPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),e._joystickPreviousPointerPos=e._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(r.prevX-44,r.prevY-44,88,88),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(r.x,r.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),r.prevX=r.x,r.prevY=r.y)}),requestAnimationFrame(function(){e._drawVirtualJoystick()})},i.prototype.releaseCanvas=function(){i.vjCanvas&&(i.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.vjCanvas),i.vjCanvas=null)},i}();i._globalJoystickIndex=0,e.VirtualJoystick=i}(r||(r={}));var r;!function(e){var t=function(e){function t(t,i,r){var n=e.call(this,t,i,r)||this;return n.inputs.addVirtualJoystick(),n}return o(t,e),t.prototype.getClassName=function(){return"VirtualJoysticksCamera"},t}(e.FreeCamera);e.VirtualJoysticksCamera=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.prototype.getLeftJoystick=function(){return this._leftjoystick},t.prototype.getRightJoystick=function(){return this._rightjoystick},t.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,i=50*t._computeLocalCameraSpeed(),r=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),n=e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x*i,this._leftjoystick.deltaPosition.y*i,this._leftjoystick.deltaPosition.z*i),r);t.cameraDirection=t.cameraDirection.add(n),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},t.prototype.attachControl=function(t,i){this._leftjoystick=new e.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(e.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(e.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new e.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(e.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(e.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},t.prototype.detachControl=function(e){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},t.prototype.getClassName=function(){return"FreeCameraVirtualJoystickInput"},t.prototype.getSimpleName=function(){return"virtualJoystick"},t}();e.FreeCameraVirtualJoystickInput=t,e.CameraInputTypes.FreeCameraVirtualJoystickInput=t}(r||(r={}));var r;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){i.getSimplifier(t).simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var r=this.getSimplifier(t),n=function(e,i){r.simplify(e,function(r){t.mesh.addLODLevel(e.distance,r),r.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){n(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case r.QUADRATIC:default:return new l(e.mesh)}},t}();e.SimplificationQueue=i;var r;!function(e){e[e.QUADRATIC=0]="QUADRATIC"}(r=e.SimplificationType||(e.SimplificationType={}));var n=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=n;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;t<10;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}return e.prototype.det=function(e,t,i,r,n,o,s,a,l){return this.data[e]*this.data[n]*this.data[l]+this.data[i]*this.data[r]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[n]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[r]*this.data[l]},e.prototype.addInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;t<10;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,r=0;r<10;++r)i.data[r]=this.data[r]+t.data[r];return i},e.FromData=function(t,i,r,n){return new e(e.DataFromNumbers(t,i,r,n))},e.DataFromNumbers=function(e,t,i,r){return[e*e,e*t,e*i,e*r,t*t,t*i,t*r,i*i,i*r,r*r]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var l=function(){function t(t){this._mesh=t,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Epsilon}return t.prototype.simplify=function(t,i){var r=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){r.initWithMesh(e.index,function(){r.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(r._reconstructedMesh)},0)})},t.prototype.runDecimation=function(t,i,r){var n=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,l=function(t,i){setTimeout(function(){t%5==0&&n.updateMesh(0===t);for(var r=0;r<n.triangles.length;++r)n.triangles[r].isDirty=!1;var l=1e-9*Math.pow(t+3,n.aggressiveness),h=function(t){var i=~~((n.triangles.length/2+t)%n.triangles.length),r=n.triangles[i];if(r&&!(r.error[3]>l||r.deleted||r.isDirty))for(var o=0;o<3;++o)if(r.error[o]<l){var a=[],h=[],c=r.vertices[o],u=r.vertices[(o+1)%3];if(c.isBorder||u.isBorder)continue;var f=e.Vector3.Zero(),d=e.Vector3.Zero(),p=e.Vector2.Zero(),m=new e.Color4(0,0,0,1);n.calculateError(c,u,f,d,p,m);var g=new Array;if(n.isFlipped(c,u,f,a,r.borderFactor,g))continue;if(n.isFlipped(u,c,f,h,r.borderFactor,g))continue;if(a.indexOf(!0)<0||h.indexOf(!0)<0)continue;var v=new Array;if(g.forEach(function(e){-1===v.indexOf(e)&&(e.deletePending=!0,v.push(e))}),v.length%2!=0)continue;c.q=u.q.add(c.q),c.updatePosition(f);var y=n.references.length;s=n.updateTriangles(c,c,a,s),s=n.updateTriangles(c,u,h,s);var _=n.references.length-y;if(_<=c.triangleCount){if(_)for(var b=0;b<_;b++)n.references[c.triangleStart+b]=n.references[y+b]}else c.triangleStart=y;c.triangleCount=_;break}};e.AsyncLoop.SyncAsyncForLoop(n.triangles.length,n.syncIterations,h,i,function(){return a-s<=o})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){a-s<=o?e.breakLoop():l(e.index,function(){e.executeNext()})},function(){setTimeout(function(){n.reconstructMesh(i),r()},0)})},t.prototype.initWithMesh=function(t,i,r){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),l=this._mesh.getIndices(),h=this._mesh.subMeshes[t],c=function(e){if(r)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],f=function(t){if(a){var i=t+h.verticesStart,r=e.Vector3.FromArray(a,3*i),n=c(r)||new o(r,s.vertices.length);n.originalOffsets.push(i),n.id===s.vertices.length&&s.vertices.push(n),u.push(n.id)}},d=h.verticesCount;e.AsyncLoop.SyncAsyncForLoop(d,this.syncIterations/4>>0,f,function(){var t=function(e){if(l){var t=h.indexStart/3+e,i=3*t,r=l[i+0],o=l[i+1],a=l[i+2],c=s.vertices[u[r-h.verticesStart]],f=s.vertices[u[o-h.verticesStart]],d=s.vertices[u[a-h.verticesStart]],p=new n([c,f,d]);p.originalOffset=i,s.triangles.push(p)}};e.AsyncLoop.SyncAsyncForLoop(h.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,r=function(t){var r=i.triangles[t];r.normal=e.Vector3.Cross(r.vertices[1].position.subtract(r.vertices[0].position),r.vertices[2].position.subtract(r.vertices[0].position)).normalize();for(var n=0;n<3;n++)r.vertices[n].q.addArrayInPlace(s.DataFromNumbers(r.normal.x,r.normal.y,r.normal.z,-e.Vector3.Dot(r.normal,r.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,r,function(){var r=function(e){for(var t=i.triangles[e],r=0;r<3;++r)t.error[r]=i.calculateError(t.vertices[r],t.vertices[(r+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,r,function(){t()})})},t.prototype.reconstructMesh=function(t){var i,r=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var n,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(n=this.triangles[i],o=0;o<3;++o)n.vertices[o].triangleCount=1;r.push(n)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],l=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],c=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),f=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),d=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=d,p.triangleCount&&p.originalOffsets.forEach(function(e){c&&(s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(c[3*e]),a.push(c[3*e+1]),a.push(c[3*e+2]),u&&u.length?(l.push(u[2*e]),l.push(u[2*e+1])):f&&f.length&&(h.push(f[4*e]),h.push(f[4*e+1]),h.push(f[4*e+2]),h.push(f[4*e+3])),++d)})}var m=this._reconstructedMesh.getTotalIndices(),g=this._reconstructedMesh.getTotalVertices(),v=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var y=this._reconstructedMesh.getIndices(),_=this._mesh.getIndices();for(i=0;i<r.length;++i)n=r[i],[0,1,2].forEach(function(e){var t=_[n.originalOffset+e],i=n.vertices[e].originalOffsets.indexOf(t);i<0&&(i=0),y.push(n.vertices[e].id+i+g)});this._reconstructedMesh.setIndices(y),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),l.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,l),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,h);var b=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],v.forEach(function(t){e.SubMesh.AddToMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())}),e.SubMesh.AddToMesh(b.materialIndex,g,d,m,3*r.length,this._reconstructedMesh))},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},t.prototype.isFlipped=function(t,i,r,n,o,s){for(var a=0;a<t.triangleCount;++a){var l=this.triangles[this.references[t.triangleStart+a].triangleId];if(!l.deleted){var h=this.references[t.triangleStart+a].vertexId,c=l.vertices[(h+1)%3],u=l.vertices[(h+2)%3];if(c!==i&&u!==i){var f=c.position.subtract(r);f=f.normalize();var d=u.position.subtract(r);if(d=d.normalize(),Math.abs(e.Vector3.Dot(f,d))>.999)return!0;var p=e.Vector3.Cross(f,d).normalize();if(n[a]=!1,e.Vector3.Dot(p,l.normal)<.2)return!0}else n[a]=!0,s.push(l)}}return!1},t.prototype.updateTriangles=function(e,t,i,r){for(var n=r,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,n++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return n},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],r=[],n=this.vertices[e];for(t=0;t<n.triangleCount;++t)for(var o=this.triangles[this.references[n.triangleStart+t].triangleId],s=0;s<3;s++){for(var a=0,l=o.vertices[s];a<i.length&&r[a]!==l.id;)++a;a===i.length?(i.push(1),r.push(l.id)):i[a]++}for(t=0;t<i.length;++t)1===i[t]?this.vertices[r[t]].isBorder=!0:this.vertices[r[t]].isBorder=!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var r,n,o;for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;n<3;++n)o=r.vertices[n],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var l=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(r=this.triangles[t],n=0;n<3;++n)o=r.vertices[n],l[o.triangleStart+o.triangleCount]=new a(n,t),o.triangleCount++;this.references=l,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,r=t.y,n=t.z;return e.data[0]*i*i+2*e.data[1]*i*r+2*e.data[2]*i*n+2*e.data[3]*i+e.data[4]*r*r+2*e.data[5]*r*n+2*e.data[6]*r+e.data[7]*n*n+2*e.data[8]*n+e.data[9]},t.prototype.calculateError=function(t,i,r,n,o,s){var a=t.q.add(i.q),l=t.isBorder&&i.isBorder,h=0,c=a.det(0,1,2,1,4,5,2,5,7);if(0===c||l){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),f=this.vertexError(a,t.position),d=this.vertexError(a,i.position),p=this.vertexError(a,u);h=Math.min(f,d,p),h===f?r&&r.copyFrom(t.position):h===d?r&&r.copyFrom(i.position):r&&r.copyFrom(u)}else r||(r=e.Vector3.Zero()),r.x=-1/c*a.det(1,2,3,4,5,6,5,7,8),r.y=1/c*a.det(0,2,3,1,5,6,2,7,8),r.z=-1/c*a.det(0,1,3,1,4,6,2,5,8),h=this.vertexError(a,r);return h},t}();e.QuadraticErrorSimplification=l}(r||(r={}));var r;!function(e){!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(e.Internals||(e.Internals={}))}(r||(r={}));var r;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=1024);var r=e.call(this,t)||this;return r.priority=t,r.maximumSize=i,r.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var n=e.textures[i];if(n.canRescale&&!n.getContext){var o=n.getSize();Math.max(o.width,o.height)>r.maximumSize&&(n.scale(.5),t=!1)}}return t},r}return o(t,e),t}(t);e.TextureOptimization=i;var r=function(e){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=2);var r=e.call(this,t)||this;return r.priority=t,r.maximumScale=i,r._currentScale=1,r.apply=function(e){return r._currentScale++,e.getEngine().setHardwareScalingLevel(r._currentScale),r._currentScale>=r.maximumScale},r}return o(t,e),t}(t);e.HardwareScalingOptimization=r;var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.apply=function(e){return e.shadowsEnabled=!1,!0},t}return o(t,e),t}(t);e.ShadowsOptimization=n;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.apply=function(e){return e.postProcessesEnabled=!1,!0},t}return o(t,e),t}(t);e.PostProcessesOptimization=s;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.apply=function(e){return e.lensFlaresEnabled=!1,!0},t}return o(t,e),t}(t);e.LensFlaresOptimization=a;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.apply=function(e){return e.particlesEnabled=!1,!0},t}return o(t,e),t}(t);e.ParticlesOptimization=l;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.apply=function(e){return e.renderTargetsEnabled=!1,!0},t}return o(t,e),t}(t);e.RenderTargetsOptimization=h;var c=function(t){function i(){var r=null!==t&&t.apply(this,arguments)||this;return r._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return!(!i.isVisible||!i.isEnabled())&&(!(i.instances.length>0)&&(!i.skeleton&&!i.hasLODLevels&&!i.parent))},r.apply=function(t,n){for(var o=t.meshes.slice(0),s=o.length,a=0;a<s;a++){var l=new Array,h=o[a];if(r._canBeMerged(h)){l.push(h);for(var c=a+1;c<s;c++){var u=o[c];r._canBeMerged(u)&&(u.material===h.material&&u.checkCollisions===h.checkCollisions&&(l.push(u),s--,o.splice(c,1),c--))}l.length<2||e.Mesh.MergeMeshes(l)}}return void 0!=n?n&&t.createOrUpdateSelectionOctree():i.UpdateSelectionTree&&t.createOrUpdateSelectionOctree(),!0},r}return o(i,t),Object.defineProperty(i,"UpdateSelectionTree",{get:function(){return i._UpdateSelectionTree},set:function(e){i._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),i}(t);c._UpdateSelectionTree=!1,e.MergeMeshesOptimization=c;var u=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var r=new e(t),o=0;return r.optimizations.push(new c(o)),r.optimizations.push(new n(o)),r.optimizations.push(new a(o)),o++,r.optimizations.push(new s(o)),r.optimizations.push(new l(o)),o++,r.optimizations.push(new i(o,1024)),r},e.ModerateDegradationAllowed=function(t){var o=new e(t),u=0;return o.optimizations.push(new c(u)),o.optimizations.push(new n(u)),o.optimizations.push(new a(u)),u++,o.optimizations.push(new s(u)),o.optimizations.push(new l(u)),u++,o.optimizations.push(new i(u,512)),u++,o.optimizations.push(new h(u)),u++,o.optimizations.push(new r(u,2)),o},e.HighDegradationAllowed=function(t){var o=new e(t),u=0;return o.optimizations.push(new c(u)),o.optimizations.push(new n(u)),o.optimizations.push(new a(u)),u++,o.optimizations.push(new s(u)),o.optimizations.push(new l(u)),u++,o.optimizations.push(new i(u,256)),u++,o.optimizations.push(new h(u)),u++,o.optimizations.push(new r(u,4)),o},e}();e.SceneOptimizerOptions=u;var f=function(){function e(){}return e._CheckCurrentState=function(t,i,r,n,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(n&&n());for(var s=!0,a=!0,l=0;l<i.optimizations.length;l++){var h=i.optimizations[l];h.priority===r&&(a=!1,s=s&&h.apply(t))}if(a)return void(o&&o());s&&r++,t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,r,n,o)},i.trackerDuration)})},e.OptimizeAsync=function(t,i,r,n){i||(i=u.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,r,n)},i.trackerDuration)})},e}();e.SceneOptimizer=f}(r||(r={}));var r;!function(e){var t=function(){function t(e){this.zOffset=1,this._scene=e}return t.prototype.render=function(t,i,r){var n=this;void 0===r&&(r=!1);var o=this._scene,s=this._scene.getEngine(),a=s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var l=t.getRenderingMesh(),h=t.getMaterial();if(h&&o.activeCamera){if(s.enableEffect(this._effect),h.useLogarithmicDepth&&this._effect.setFloat("logarithmicDepthConstant",2/(Math.log(o.activeCamera.maxZ+1)/Math.LN2)),this._effect.setFloat("offset",r?0:l.outlineWidth),this._effect.setColor4("color",r?l.overlayColor:l.outlineColor,r?l.overlayAlpha:h.alpha),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),l.useBones&&l.computeBonesUsingShaders&&l.skeleton&&this._effect.setMatrices("mBones",l.skeleton.getTransformMatrices(l)),l._bind(t,this._effect,e.Material.TriangleFillMode),h&&h.needAlphaTesting()){var c=h.getAlphaTestTexture();c&&(this._effect.setTexture("diffuseSampler",c),this._effect.setMatrix("diffuseMatrix",c.getTextureMatrix()))}s.setZOffset(-this.zOffset),l._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){n._effect.setMatrix("world",t)}),s.setZOffset(0)}}},t.prototype.isReady=function(t,i){var r=[],n=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&(s.needAlphaTesting()&&(r.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(n.push(e.VertexBuffer.UVKind),r.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(n.push(e.VertexBuffer.UV2Kind),r.push("#define UV2"))),s.useLogarithmicDepth&&r.push("#define LOGARITHMICDEPTH")),o.useBones&&o.computeBonesUsingShaders?(n.push(e.VertexBuffer.MatricesIndicesKind),n.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(n.push(e.VertexBuffer.MatricesIndicesExtraKind),n.push(e.VertexBuffer.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),r.push("#define BonesPerMesh "+(o.skeleton?o.skeleton.bones.length+1:0))):r.push("#define NUM_BONE_INFLUENCERS 0"),i&&(r.push("#define INSTANCES"),n.push("world0"),n.push("world1"),n.push("world2"),n.push("world3"));var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("outline",n,["world","mBones","viewProjection","diffuseMatrix","offset","color","logarithmicDepthConstant"],["diffuseSampler"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.edges=new Array,this.edgesConnectedCount=0}return e}(),i=function(){function i(e,t,i){void 0===t&&(t=.95),void 0===i&&(i=!1),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this._source=e,this._checkVerticesInsteadOfIndices=i,this._epsilon=t,this._prepareRessources(),this._generateEdgesLines()}return i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new e.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},i.prototype._rebuild=function(){var t=this._buffers[e.VertexBuffer.PositionKind];t&&t._rebuild(),(t=this._buffers[e.VertexBuffer.NormalKind])&&t._rebuild();var i=this._source.getScene(),r=i.getEngine();this._ib=r.createIndexBuffer(this._linesIndices)},i.prototype.dispose=function(){var t=this._buffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._buffers[e.VertexBuffer.PositionKind]=null),t=this._buffers[e.VertexBuffer.NormalKind],t&&(t.dispose(),this._buffers[e.VertexBuffer.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(e,t,i,r,n){return e===i&&t===r||e===r&&t===i?0:e===r&&t===n||e===n&&t===r?1:e===n&&t===i||e===i&&t===n?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,i,r,n){return e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)?0:e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)?1:e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)?2:-1},i.prototype._checkEdge=function(t,i,r,n,o){var s;if(void 0===i)s=!0;else{s=e.Vector3.Dot(r[t],r[i])<this._epsilon}if(s){var a=this._linesPositions.length/3;n.subtract(o).normalize(),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesPositions.push(n.x),this._linesPositions.push(n.y),this._linesPositions.push(n.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(-1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(1),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(-1),this._linesNormals.push(n.x),this._linesNormals.push(n.y),this._linesNormals.push(n.z),this._linesNormals.push(1),this._linesIndices.push(a),this._linesIndices.push(a+1),this._linesIndices.push(a+2),this._linesIndices.push(a),this._linesIndices.push(a+2),this._linesIndices.push(a+3)}},i.prototype._generateEdgesLines=function(){var i=this._source.getVerticesData(e.VertexBuffer.PositionKind),r=this._source.getIndices();if(r&&i){var n,o,s=new Array,a=new Array;for(n=0;n<r.length;n+=3){o=new t;var l=r[n],h=r[n+1],c=r[n+2];o.p0=new e.Vector3(i[3*l],i[3*l+1],i[3*l+2]),o.p1=new e.Vector3(i[3*h],i[3*h+1],i[3*h+2]),o.p2=new e.Vector3(i[3*c],i[3*c+1],i[3*c+2]);var u=e.Vector3.Cross(o.p1.subtract(o.p0),o.p2.subtract(o.p1));u.normalize(),a.push(u),s.push(o)}for(n=0;n<s.length;n++){o=s[n];for(var f=n+1;f<s.length;f++){var d=s[f];if(3===o.edgesConnectedCount)break;if(3!==d.edgesConnectedCount)for(var p=r[3*f],m=r[3*f+1],g=r[3*f+2],v=0;v<3;v++){var y=0;if(void 0===o.edges[v]){switch(v){case 0:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(o.p0,o.p1,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(r[3*n],r[3*n+1],p,m,g);break;case 1:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(o.p1,o.p2,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(r[3*n+1],r[3*n+2],p,m,g);break;case 2:y=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(o.p2,o.p0,d.p0,d.p1,d.p2):this._processEdgeForAdjacencies(r[3*n+2],r[3*n],p,m,g)}if(-1!==y&&(o.edges[v]=f,d.edges[y]=n,o.edgesConnectedCount++,d.edgesConnectedCount++,3===o.edgesConnectedCount))break}}}}for(n=0;n<s.length;n++){var _=s[n];this._checkEdge(n,_.edges[0],a,_.p0,_.p1),this._checkEdge(n,_.edges[1],a,_.p1,_.p2),this._checkEdge(n,_.edges[2],a,_.p2,_.p0)}var b=this._source.getScene().getEngine();this._buffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(b,this._linesPositions,e.VertexBuffer.PositionKind,!1),this._buffers[e.VertexBuffer.NormalKind]=new e.VertexBuffer(b,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),this._ib=b.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length}},i.prototype.render=function(){var t=this._source.getScene();if(this._lineShader.isReady()&&t.activeCamera){var i=t.getEngine();this._lineShader._preBind(),i.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===e.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",i.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),i.draw(!0,0,this._indicesCount),this._lineShader.unbind(),i.setDepthWrite(!0)}},i}();e.EdgesRenderer=i}(r||(r={}));var r;!function(e){var t=function(t){function i(i,r,n,o,s,a,l,h){void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE);var c=t.call(this,i,"glowBlurPostProcess",["screenSize","direction","blurWidth"],null,o,s,a,l,h)||this;return c.direction=r,c.kernel=n,c.onApplyObservable.add(function(e){e.setFloat2("screenSize",c.width,c.height),e.setVector2("direction",c.direction),e.setFloat("blurWidth",c.kernel)}),c}return o(i,t),i}(e.PostProcess),i=function(){function i(t,r,n){this.name=t,this._vertexBuffers={},this._mainTextureDesiredSize={width:0,height:0},this._meshes={},this._maxSize=0,this._shouldRender=!1,this._instanceGlowingMeshStencilReference=i.glowingMeshStencilReference++,this._excludedMeshes={},this.innerGlow=!0,this.outerGlow=!0,this.isEnabled=!0,this.onDisposeObservable=new e.Observable,this.onBeforeRenderMainTextureObservable=new e.Observable,this.onBeforeBlurObservable=new e.Observable,this.onAfterBlurObservable=new e.Observable,this.onBeforeComposeObservable=new e.Observable,this.onAfterComposeObservable=new e.Observable,this.onSizeChangedObservable=new e.Observable,this._scene=r||e.Engine.LastCreatedScene;var o=r.getEngine();this._engine=o,this._maxSize=this._engine.getCaps().maxTextureSize,this._scene.highlightLayers.push(this),this._engine.isStencilEnable||e.Tools.Warn("Rendering the Highlight Layer requires the stencil to be active on the canvas. var engine = new BABYLON.Engine(canvas, antialias, { stencil: true }"),this._options=n||{mainTextureRatio:.5,blurTextureSizeRatio:.5,blurHorizontalSize:1,blurVerticalSize:1,alphaBlendingMode:e.Engine.ALPHA_COMBINE,camera:null},this._options.mainTextureRatio=this._options.mainTextureRatio||.5,this._options.blurTextureSizeRatio=this._options.blurTextureSizeRatio||1,this._options.blurHorizontalSize=this._options.blurHorizontalSize||1,this._options.blurVerticalSize=this._options.blurVerticalSize||1,this._options.alphaBlendingMode=this._options.alphaBlendingMode||e.Engine.ALPHA_COMBINE;var s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1);var a=new e.VertexBuffer(o,s,e.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[e.VertexBuffer.PositionKind]=a,this._createIndexBuffer(),this._glowMapMergeEffect=o.createEffect("glowMapMerge",[e.VertexBuffer.PositionKind],["offset"],["textureSampler"],""),this.setMainTextureSize(),this.createTextureAndPostProcesses()}return Object.defineProperty(i.prototype,"blurHorizontalSize",{get:function(){return this._horizontalBlurPostprocess.kernel},set:function(e){this._horizontalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"blurVerticalSize",{get:function(){return this._verticalBlurPostprocess.kernel},set:function(e){this._verticalBlurPostprocess.kernel=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"camera",{get:function(){return this._options.camera},enumerable:!0,configurable:!0}),i.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},i.prototype._rebuild=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},i.prototype.createTextureAndPostProcesses=function(){var r=this,n=this._mainTextureDesiredSize.width*this._options.blurTextureSizeRatio,o=this._mainTextureDesiredSize.height*this._options.blurTextureSizeRatio;n=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(n,this._maxSize):n,o=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(o,this._maxSize):o,this._mainTexture=new e.RenderTargetTexture("HighlightLayerMainRTT",{width:this._mainTextureDesiredSize.width,height:this._mainTextureDesiredSize.height},this._scene,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._mainTexture.activeCamera=this._options.camera,this._mainTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._mainTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._mainTexture.anisotropicFilteringLevel=1,this._mainTexture.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE),this._mainTexture.renderParticles=!1,this._mainTexture.renderList=null,this._mainTexture.ignoreCameraViewport=!0,this._blurTexture=new e.RenderTargetTexture("HighlightLayerBlurRTT",{width:n,height:o},this._scene,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._blurTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._blurTexture.anisotropicFilteringLevel=16,this._blurTexture.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),this._blurTexture.renderParticles=!1,this._blurTexture.ignoreCameraViewport=!0,this._downSamplePostprocess=new e.PassPostProcess("HighlightLayerPPP",this._options.blurTextureSizeRatio,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._downSamplePostprocess.onApplyObservable.add(function(e){e.setTexture("textureSampler",r._mainTexture)}),this._options.alphaBlendingMode===e.Engine.ALPHA_COMBINE?(this._horizontalBlurPostprocess=new t("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,o)}),this._verticalBlurPostprocess=new t("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,o)})):(this._horizontalBlurPostprocess=new e.BlurPostProcess("HighlightLayerHBP",new e.Vector2(1,0),this._options.blurHorizontalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._horizontalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,o)}),this._verticalBlurPostprocess=new e.BlurPostProcess("HighlightLayerVBP",new e.Vector2(0,1),this._options.blurVerticalSize,1,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine()),this._verticalBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",n,o)})),this._mainTexture.onAfterUnbindObservable.add(function(){r.onBeforeBlurObservable.notifyObservers(r);var e=r._blurTexture.getInternalTexture();e&&r._scene.postProcessManager.directRender([r._downSamplePostprocess,r._horizontalBlurPostprocess,r._verticalBlurPostprocess],e,!0),r.onAfterBlurObservable.notifyObservers(r)});var s=function(t){if(r._meshes){var n=t.getMaterial(),o=t.getRenderingMesh(),s=r._scene,a=s.getEngine();if(n&&!n.needAlphaBlendingForMesh(o)){a.setState(n.backFaceCulling);var l=o._getInstancesRenderList(t._id);if(!(l.mustReturn||r._excludedMeshes&&r._excludedMeshes[o.uniqueId])){var h=a.getCaps().instancedArrays&&null!==l.visibleInstances[t._id]&&void 0!==l.visibleInstances[t._id],c=r._meshes[o.uniqueId],u=null;if(c&&c.glowEmissiveOnly&&n&&(u=n.emissiveTexture),r.isReady(t,h,u)){if(a.enableEffect(r._glowMapGenerationEffect),o._bind(t,r._glowMapGenerationEffect,e.Material.TriangleFillMode),r._glowMapGenerationEffect.setMatrix("viewProjection",s.getTransformMatrix()),c?r._glowMapGenerationEffect.setFloat4("color",c.color.r,c.color.g,c.color.b,1):r._glowMapGenerationEffect.setFloat4("color",i.neutralColor.r,i.neutralColor.g,i.neutralColor.b,i.neutralColor.a),n&&n.needAlphaTesting()){var f=n.getAlphaTestTexture();if(f){r._glowMapGenerationEffect.setTexture("diffuseSampler",f);var d=f.getTextureMatrix();d&&r._glowMapGenerationEffect.setMatrix("diffuseMatrix",d)}}u&&(r._glowMapGenerationEffect.setTexture("emissiveSampler",u),r._glowMapGenerationEffect.setMatrix("emissiveMatrix",u.getTextureMatrix())),o.useBones&&o.computeBonesUsingShaders&&o.skeleton&&r._glowMapGenerationEffect.setMatrices("mBones",o.skeleton.getTransformMatrices(o)),o._processRendering(t,r._glowMapGenerationEffect,e.Material.TriangleFillMode,l,h,function(e,t){return r._glowMapGenerationEffect.setMatrix("world",t)})}else r._mainTexture.resetRefreshCounter()}}}};this._mainTexture.customRenderFunction=function(e,t,i,n){r.onBeforeRenderMainTextureObservable.notifyObservers(r);var o,a=r._scene.getEngine();if(n.length){for(a.setColorWrite(!1),o=0;o<n.length;o++)s(n.data[o]);a.setColorWrite(!0)}for(o=0;o<e.length;o++)s(e.data[o]);for(o=0;o<t.length;o++)s(t.data[o]);for(o=0;o<i.length;o++)s(i.data[o])},this._mainTexture.onClearObservable.add(function(e){e.clear(i.neutralColor,!0,!0,!0)})},i.prototype.isReady=function(t,i,r){var n=t.getMaterial();if(!n)return!1;if(!n.isReady(t.getMesh(),i))return!1;var o=[],s=[e.VertexBuffer.PositionKind],a=t.getMesh(),l=!1,h=!1;if(n&&n.needAlphaTesting()){var c=n.getAlphaTestTexture();c&&(o.push("#define ALPHATEST"),a.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===c.coordinatesIndex?(o.push("#define DIFFUSEUV2"),h=!0):a.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push("#define DIFFUSEUV1"),l=!0))}r&&(o.push("#define EMISSIVE"),a.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&1===r.coordinatesIndex?(o.push("#define EMISSIVEUV2"),h=!0):a.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push("#define EMISSIVEUV1"),l=!0)),l&&(s.push(e.VertexBuffer.UVKind),o.push("#define UV1")),h&&(s.push(e.VertexBuffer.UV2Kind),o.push("#define UV2")),a.useBones&&a.computeBonesUsingShaders?(s.push(e.VertexBuffer.MatricesIndicesKind),s.push(e.VertexBuffer.MatricesWeightsKind),a.numBoneInfluencers>4&&(s.push(e.VertexBuffer.MatricesIndicesExtraKind),s.push(e.VertexBuffer.MatricesWeightsExtraKind)),o.push("#define NUM_BONE_INFLUENCERS "+a.numBoneInfluencers),o.push("#define BonesPerMesh "+(a.skeleton?a.skeleton.bones.length+1:0))):o.push("#define NUM_BONE_INFLUENCERS 0"),i&&(o.push("#define INSTANCES"),s.push("world0"),s.push("world1"),s.push("world2"),s.push("world3"));var u=o.join("\n");return this._cachedDefines!==u&&(this._cachedDefines=u,this._glowMapGenerationEffect=this._scene.getEngine().createEffect("glowMapGeneration",s,["world","mBones","viewProjection","diffuseMatrix","color","emissiveMatrix"],["diffuseSampler","emissiveSampler"],u)),this._glowMapGenerationEffect.isReady()},i.prototype.render=function(){var t=this._glowMapMergeEffect;if(t.isReady()&&this._blurTexture.isReady()){var i=this._scene.getEngine();this.onBeforeComposeObservable.notifyObservers(this),i.enableEffect(t),i.setState(!1);var r=i.getStencilBuffer(),n=i.getStencilFunction(),o=i.getStencilMask(),s=i.getStencilOperationPass(),a=i.getStencilOperationFail(),l=i.getStencilOperationDepthFail(),h=i.getAlphaMode();t.setTexture("textureSampler",this._blurTexture),i.bindBuffers(this._vertexBuffers,this._indexBuffer,t),i.setStencilOperationPass(e.Engine.REPLACE),i.setStencilOperationFail(e.Engine.KEEP),i.setStencilOperationDepthFail(e.Engine.KEEP),i.setAlphaMode(this._options.alphaBlendingMode),i.setStencilMask(0),i.setStencilBuffer(!0),i.setStencilFunctionReference(this._instanceGlowingMeshStencilReference),this.outerGlow&&(t.setFloat("offset",0),i.setStencilFunction(e.Engine.NOTEQUAL),i.draw(!0,0,6)),this.innerGlow&&(t.setFloat("offset",1),i.setStencilFunction(e.Engine.EQUAL),i.draw(!0,0,6)),i.setStencilFunction(n),i.setStencilMask(o),i.setAlphaMode(h),i.setStencilBuffer(r),i.setStencilOperationPass(s),i.setStencilOperationFail(a),i.setStencilOperationDepthFail(l),i._stencilState.reset(),this.onAfterComposeObservable.notifyObservers(this);var c=this._mainTexture.getSize();this.setMainTextureSize(),c.width===this._mainTextureDesiredSize.width&&c.height===this._mainTextureDesiredSize.height||(this.onSizeChangedObservable.notifyObservers(this),this.disposeTextureAndPostProcesses(),this.createTextureAndPostProcesses())}},i.prototype.addExcludedMesh=function(e){if(this._excludedMeshes){this._excludedMeshes[e.uniqueId]||(this._excludedMeshes[e.uniqueId]={mesh:e,beforeRender:e.onBeforeRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!1)}),afterRender:e.onAfterRenderObservable.add(function(e){e.getEngine().setStencilBuffer(!0)})})}},i.prototype.removeExcludedMesh=function(e){if(this._excludedMeshes){var t=this._excludedMeshes[e.uniqueId];t&&(t.beforeRender&&e.onBeforeRenderObservable.remove(t.beforeRender),t.afterRender&&e.onAfterRenderObservable.remove(t.afterRender)),this._excludedMeshes[e.uniqueId]=null}},i.prototype.addMesh=function(e,t,i){var r=this;if(void 0===i&&(i=!1),this._meshes){var n=this._meshes[e.uniqueId];n?n.color=t:this._meshes[e.uniqueId]={mesh:e,color:t,observerHighlight:e.onBeforeRenderObservable.add(function(e){r._excludedMeshes&&r._excludedMeshes[e.uniqueId]?r.defaultStencilReference(e):e.getScene().getEngine().setStencilFunctionReference(r._instanceGlowingMeshStencilReference)}),observerDefault:e.onAfterRenderObservable.add(this.defaultStencilReference),glowEmissiveOnly:i},this._shouldRender=!0}},i.prototype.removeMesh=function(e){if(this._meshes){var t=this._meshes[e.uniqueId];t&&(t.observerHighlight&&e.onBeforeRenderObservable.remove(t.observerHighlight),t.observerDefault&&e.onAfterRenderObservable.remove(t.observerDefault)),this._meshes[e.uniqueId]=null,this._shouldRender=!1;for(var i in this._meshes)if(this._meshes[i]){this._shouldRender=!0;break}}},i.prototype.shouldRender=function(){return this.isEnabled&&this._shouldRender},i.prototype.setMainTextureSize=function(){this._options.mainTextureFixedSize?(this._mainTextureDesiredSize.width=this._options.mainTextureFixedSize,this._mainTextureDesiredSize.height=this._options.mainTextureFixedSize):(this._mainTextureDesiredSize.width=this._engine.getRenderWidth()*this._options.mainTextureRatio,this._mainTextureDesiredSize.height=this._engine.getRenderHeight()*this._options.mainTextureRatio,this._mainTextureDesiredSize.width=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.width,this._maxSize):this._mainTextureDesiredSize.width,this._mainTextureDesiredSize.height=this._engine.needPOTTextures?e.Tools.GetExponentOfTwo(this._mainTextureDesiredSize.height,this._maxSize):this._mainTextureDesiredSize.height)},i.prototype.defaultStencilReference=function(e){e.getScene().getEngine().setStencilFunctionReference(i.normalMeshStencilReference)},i.prototype.disposeTextureAndPostProcesses=function(){this._blurTexture.dispose(),this._mainTexture.dispose(),this._downSamplePostprocess.dispose(),this._horizontalBlurPostprocess.dispose(),this._verticalBlurPostprocess.dispose()},i.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];if(t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.disposeTextureAndPostProcesses(),this._meshes){for(var i in this._meshes){var r=this._meshes[i];r&&r.mesh&&(r.observerHighlight&&r.mesh.onBeforeRenderObservable.remove(r.observerHighlight),r.observerDefault&&r.mesh.onAfterRenderObservable.remove(r.observerDefault))}this._meshes=null}if(this._excludedMeshes){for(var i in this._excludedMeshes){var r=this._excludedMeshes[i];r&&(r.beforeRender&&r.mesh.onBeforeRenderObservable.remove(r.beforeRender),r.afterRender&&r.mesh.onAfterRenderObservable.remove(r.afterRender))}this._excludedMeshes=null}var n=this._scene.highlightLayers.indexOf(this,0);n>-1&&this._scene.highlightLayers.splice(n,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderMainTextureObservable.clear(),this.onBeforeBlurObservable.clear(),this.onBeforeComposeObservable.clear(),this.onAfterComposeObservable.clear(),this.onSizeChangedObservable.clear()},i}();i.neutralColor=new e.Color4(0,0,0,0),i.glowingMeshStencilReference=2,i.normalMeshStencilReference=1,e.HighlightLayer=i}(r||(r={}));var r;!function(e){var t;!function(e){e[e.INIT=0]="INIT",e[e.RUNNING=1]="RUNNING",e[e.DONE=2]="DONE",e[e.ERROR=3]="ERROR"}(t=e.AssetTaskState||(e.AssetTaskState={}));var i=function(){function e(e){this.name=e,this.isCompleted=!1,this.taskState=t.INIT}return e.prototype.run=function(e,i,r){var n=this;this.taskState=t.RUNNING,this.runTask(e,function(){n.onDoneCallback(i,r)},function(e,t){n.onErrorCallback(r,e,t)})},e.prototype.runTask=function(e,t,i){throw new Error("runTask is not implemented")},e.prototype.onErrorCallback=function(e,i,r){this.taskState=t.ERROR,this.errorObject={message:i,exception:r},this.onError&&this.onError(this,i,r),e()},e.prototype.onDoneCallback=function(e,i){try{this.taskState=t.DONE,this.isCompleted=!0,this.onSuccess&&this.onSuccess(this),e()}catch(e){this.onErrorCallback(i,"Task is done, error executing success callback(s)",e)}},e}();e.AbstractAssetTask=i;var r=function(){function e(e,t,i){this.remainingCount=e,this.totalCount=t,this.task=i}return e}();e.AssetsProgressEvent=r;var n=function(t){function i(e,i,r,n){var o=t.call(this,e)||this;return o.name=e,o.meshesNames=i,o.rootUrl=r,o.sceneFilename=n,o}return o(i,t),i.prototype.runTask=function(t,i,r){var n=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,r){n.loadedMeshes=e,n.loadedParticleSystems=t,n.loadedSkeletons=r,i()},null,function(e,t,i){r(t,i)})},i}(i);e.MeshAssetTask=n;var s=function(t){function i(e,i){var r=t.call(this,e)||this;return r.name=e,r.url=i,r}return o(i,t),i.prototype.runTask=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.text=e,i()},void 0,t.database,!1,function(e,t){e&&r(e.status+" "+e.statusText,t)})},i}(i);e.TextFileAssetTask=s;var a=function(t){function i(e,i){var r=t.call(this,e)||this;return r.name=e,r.url=i,r}return o(i,t),i.prototype.runTask=function(t,i,r){var n=this;e.Tools.LoadFile(this.url,function(e){n.data=e,i()},void 0,t.database,!0,function(e,t){e&&r(e.status+" "+e.statusText,t)})},i}(i);e.BinaryFileAssetTask=a;var l=function(t){function i(e,i){var r=t.call(this,e)||this;return r.name=e,r.url=i,r}return o(i,t),i.prototype.runTask=function(t,i,r){var n=this,o=new Image;e.Tools.SetCorsBehavior(this.url,o),o.onload=function(){n.image=o,i()},o.onerror=function(e){r("Error loading image",e)},o.src=this.url},i}(i);e.ImageAssetTask=l;var h=function(t){function i(i,r,n,o,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=t.call(this,i)||this;return a.name=i,a.url=r,a.noMipmap=n,a.invertY=o,a.samplingMode=s,a}return o(i,t),i.prototype.runTask=function(t,i,r){var n=function(){i()},o=function(e,t){r(e,t)};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,n,o)},i}(i);e.TextureAssetTask=h;var c=function(t){function i(e,i,r,n,o){var s=t.call(this,e)||this;return s.name=e,s.url=i,s.extensions=r,s.noMipmap=n,s.files=o,s}return o(i,t),i.prototype.runTask=function(t,i,r){var n=function(){i()},o=function(e,t){r(e,t)};this.texture=new e.CubeTexture(this.url,t,this.extensions,this.noMipmap,this.files,n,o)},i}(i);e.CubeTextureAssetTask=c;var u=function(t){function i(e,i,r,n,o,s,a){void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===a&&(a=!1);var l=t.call(this,e)||this;return l.name=e,l.url=i,l.size=r,l.noMipmap=n,l.generateHarmonics=o,l.useInGammaSpace=s,l.usePMREMGenerator=a,l}return o(i,t),i.prototype.run=function(t,i,r){var n=function(){i()},o=function(e,t){r(e,t)};this.texture=new e.HDRCubeTexture(this.url,t,this.size,this.noMipmap,this.generateHarmonics,this.useInGammaSpace,this.usePMREMGenerator,n,o)},i}(i);e.HDRCubeTextureAssetTask=u;var f=function(){function t(t){this.tasks=new Array,this.waitingTasksCount=0,this.onTaskSuccessObservable=new e.Observable,this.onTaskErrorObservable=new e.Observable,this.onTasksDoneObservable=new e.Observable,this.onProgressObservable=new e.Observable,this.useDefaultLoadingScreen=!0,this._scene=t}return t.prototype.addMeshTask=function(e,t,i,r){var o=new n(e,t,i,r);return this.tasks.push(o),o},t.prototype.addTextFileTask=function(e,t){var i=new s(e,t);return this.tasks.push(i),i},t.prototype.addBinaryFileTask=function(e,t){var i=new a(e,t);return this.tasks.push(i),i},t.prototype.addImageTask=function(e,t){var i=new l(e,t);return this.tasks.push(i),i},t.prototype.addTextureTask=function(t,i,r,n,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE);var s=new h(t,i,r,n,o);return this.tasks.push(s),s},t.prototype.addCubeTextureTask=function(e,t,i,r,n){var o=new c(e,t,i,r,n);return this.tasks.push(o),o},t.prototype.addHDRCubeTextureTask=function(e,t,i,r,n,o,s){void 0===r&&(r=!1),void 0===n&&(n=!0),void 0===o&&(o=!1),void 0===s&&(s=!1);var a=new u(e,t,i,r,n,o,s);return this.tasks.push(a),a},t.prototype._decreaseWaitingTasksCount=function(t){this.waitingTasksCount--;try{this.onProgress&&this.onProgress(this.waitingTasksCount,this.tasks.length,t),this.onProgressObservable.notifyObservers(new r(this.waitingTasksCount,this.tasks.length,t))}catch(t){e.Tools.Error("Error running progress callbacks."),console.log(t)}if(0===this.waitingTasksCount){try{this.onFinish&&this.onFinish(this.tasks),this.onTasksDoneObservable.notifyObservers(this.tasks)}catch(t){e.Tools.Error("Error running tasks-done callbacks."),console.log(t)}this._scene.getEngine().hideLoadingUI()}},t.prototype._runTask=function(e){var t=this,i=function(){try{t.onTaskSuccess&&t.onTaskSuccess(e),t.onTaskSuccessObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)}catch(e){r("Error executing task success callbacks",e)}},r=function(i,r){e.errorObject=e.errorObject||{message:i,exception:r},t.onTaskError&&t.onTaskError(e),t.onTaskErrorObservable.notifyObservers(e),t._decreaseWaitingTasksCount(e)};e.run(this._scene,i,r)},t.prototype.reset=function(){return this.tasks=new Array,this},t.prototype.load=function(){if(this.waitingTasksCount=this.tasks.length,0===this.waitingTasksCount)return this.onFinish&&this.onFinish(this.tasks),this.onTasksDoneObservable.notifyObservers(this.tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this.tasks.length;e++){var t=this.tasks[e];this._runTask(t)}return this},t}();e.AssetsManager=f}(r||(r={}));var r;!function(e){var t=[],i=function(i,r){if(!t[i.id]&&!i.doNotSerialize){if(i instanceof e.Geometry.Primitives.Box)r.boxes.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Sphere)r.spheres.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Cylinder)r.cylinders.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Torus)r.toruses.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Ground)r.grounds.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Plane)r.planes.push(i.serialize());else if(i instanceof e.Geometry.Primitives.TorusKnot)r.torusKnots.push(i.serialize());else{if(i instanceof e.Geometry.Primitives._Primitive)throw new Error("Unknown primitive type");r.vertexData.push(i.serializeVerticeData())}t[i.id]=!0}},r=function(e,t){var r={},n=e._geometry;return n&&(e.getScene().getGeometryByID(n.id)||i(n,t.geometries)),e.serialize&&e.serialize(r),r},n=function(t,n){if(t.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||t.delayLoadState===e.Engine.DELAYLOADSTATE_NONE){t.material&&(t.material instanceof e.StandardMaterial?(n.materials=n.materials||[],n.materials.some(function(e){return e.id===t.material.id})||n.materials.push(t.material.serialize())):t.material instanceof e.MultiMaterial&&(n.multiMaterials=n.multiMaterials||[],n.multiMaterials.some(function(e){return e.id===t.material.id})||n.multiMaterials.push(t.material.serialize())));var o=t._geometry;o&&(n.geometries||(n.geometries={},n.geometries.boxes=[],n.geometries.spheres=[],n.geometries.cylinders=[],n.geometries.toruses=[],n.geometries.grounds=[],n.geometries.planes=[],n.geometries.torusKnots=[],n.geometries.vertexData=[]),i(o,n.geometries)),t.skeleton&&(n.skeletons=n.skeletons||[],n.skeletons.push(t.skeleton.serialize())),n.meshes=n.meshes||[],n.meshes.push(r(t,n))}},o=function(){function o(){}return o.ClearCache=function(){t=[]},o.Serialize=function(n){var s={};if(o.ClearCache(),s.useDelayedTextureLoading=n.useDelayedTextureLoading,s.autoClear=n.autoClear,s.clearColor=n.clearColor.asArray(),s.ambientColor=n.ambientColor.asArray(),s.gravity=n.gravity.asArray(),s.collisionsEnabled=n.collisionsEnabled,s.workerCollisions=n.workerCollisions,n.fogMode&&0!==n.fogMode&&(s.fogMode=n.fogMode,s.fogColor=n.fogColor.asArray(),s.fogStart=n.fogStart,s.fogEnd=n.fogEnd,s.fogDensity=n.fogDensity),n.isPhysicsEnabled()){var a=n.getPhysicsEngine();a&&(s.physicsEnabled=!0,s.physicsGravity=a.gravity.asArray(),s.physicsEngine=a.getPhysicsPluginName())}n.metadata&&(s.metadata=n.metadata),s.morphTargetManagers=[];for(var l=0,h=n.meshes;l<h.length;l++){var c=h[l],u=c.morphTargetManager;u&&s.morphTargetManagers.push(u.serialize())}s.lights=[];var f,d;for(f=0;f<n.lights.length;f++)d=n.lights[f],d.doNotSerialize||s.lights.push(d.serialize());for(s.cameras=[],f=0;f<n.cameras.length;f++){var p=n.cameras[f];p.doNotSerialize||s.cameras.push(p.serialize())}n.activeCamera&&(s.activeCameraID=n.activeCamera.id),e.Animation.AppendSerializedAnimations(n,s),s.materials=[],s.multiMaterials=[];var m;for(f=0;f<n.materials.length;f++)m=n.materials[f],m.doNotSerialize||s.materials.push(m.serialize());for(s.multiMaterials=[],f=0;f<n.multiMaterials.length;f++){var g=n.multiMaterials[f];s.multiMaterials.push(g.serialize())}for(s.skeletons=[],f=0;f<n.skeletons.length;f++)s.skeletons.push(n.skeletons[f].serialize());for(s.transformNodes=[],f=0;f<n.transformNodes.length;f++)s.transformNodes.push(n.transformNodes[f].serialize());s.geometries={},s.geometries.boxes=[],s.geometries.spheres=[],s.geometries.cylinders=[],s.geometries.toruses=[],s.geometries.grounds=[],s.geometries.planes=[],s.geometries.torusKnots=[],s.geometries.vertexData=[],t=[];var v=n.getGeometries();for(f=0;f<v.length;f++){var y=v[f];y.isReady()&&i(y,s.geometries)}for(s.meshes=[],f=0;f<n.meshes.length;f++){var c=n.meshes[f];if(c instanceof e.Mesh){var _=c;_.doNotSerialize||_.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADED&&_.delayLoadState!==e.Engine.DELAYLOADSTATE_NONE||s.meshes.push(r(_,s))}}for(s.particleSystems=[],f=0;f<n.particleSystems.length;f++)s.particleSystems.push(n.particleSystems[f].serialize());for(s.lensFlareSystems=[],f=0;f<n.lensFlareSystems.length;f++)s.lensFlareSystems.push(n.lensFlareSystems[f].serialize());for(s.shadowGenerators=[],f=0;f<n.lights.length;f++){d=n.lights[f];var b=d.getShadowGenerator();b&&s.shadowGenerators.push(b.serialize())}for(n.actionManager&&(s.actions=n.actionManager.serialize("scene")),s.sounds=[],f=0;f<n.soundTracks.length;f++)for(var x=n.soundTracks[f],T=0;T<x.soundCollection.length;T++)s.sounds.push(x.soundCollection[T].serialize());return s},o.SerializeMesh=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var s={};if(o.ClearCache(),t=t instanceof Array?t:[t],i||r)for(var a=0;a<t.length;++a)r&&t[a].getDescendants().forEach(function(i){i instanceof e.Mesh&&t.indexOf(i)<0&&t.push(i)}),i&&t[a].parent&&t.indexOf(t[a].parent)<0&&t.push(t[a].parent);return t.forEach(function(e){n(e,s)}),s},o}();e.SceneSerializer=o}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n){void 0===n&&(n=!0);var o=this;this.name=t,this._viewMatrix=e.Matrix.Identity(),this._target=e.Vector3.Zero(),this._add=e.Vector3.Zero(),this.invertYAxis=!1,this.position=e.Vector3.Zero(),this._scene=r,this._scene.reflectionProbes.push(this),this._renderTargetTexture=new e.RenderTargetTexture(t,i,r,n,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(t){switch(t){case 0:o._add.copyFromFloats(1,0,0);break;case 1:o._add.copyFromFloats(-1,0,0);break;case 2:o._add.copyFromFloats(0,o.invertYAxis?1:-1,0);break;case 3:o._add.copyFromFloats(0,o.invertYAxis?-1:1,0);break;case 4:o._add.copyFromFloats(0,0,1);break;case 5:o._add.copyFromFloats(0,0,-1)}o._attachedMesh&&o.position.copyFrom(o._attachedMesh.getAbsolutePosition()),o.position.addToRef(o._add,o._target),e.Matrix.LookAtLHToRef(o.position,o._target,e.Vector3.Up(),o._viewMatrix),r.setTransformMatrix(o._viewMatrix,o._projectionMatrix),r._forcedViewPosition=o.position}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){r._forcedViewPosition=null,r.updateTransformMatrix(!0)}),r.activeCamera&&(this._projectionMatrix=e.Matrix.PerspectiveFovLH(Math.PI/2,1,r.activeCamera.minZ,r.activeCamera.maxZ))}return Object.defineProperty(t.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(e){this._renderTargetTexture.samples=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(e){this._renderTargetTexture.refreshRate=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},Object.defineProperty(t.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),t.prototype.attachToMesh=function(e){this._attachedMesh=e},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderTargetTexture.setRenderingAutoClearDepthStencil(e,t)},t.prototype.dispose=function(){var e=this._scene.reflectionProbes.indexOf(this);-1!==e&&this._scene.reflectionProbes.splice(e,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},t}();e.ReflectionProbe=t}(r||(r={}));var r;!function(e){var t=function(){function t(t,i,r,n,o){this.name=t,this.scale=new e.Vector2(1,1),this.offset=new e.Vector2(0,0),this.alphaBlendingMode=e.Engine.ALPHA_COMBINE,this.layerMask=268435455,this._vertexBuffers={},this.onDisposeObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.texture=i?new e.Texture(i,r,!0):null,this.isBackground=void 0===n||n,this.color=void 0===o?new e.Color4(1,1,1,1):o,this._scene=r||e.Engine.LastCreatedScene,this._scene.layers.push(this);var s=this._scene.getEngine(),a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1);var l=new e.VertexBuffer(s,a,e.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[e.VertexBuffer.PositionKind]=l,this._createIndexBuffer(),this._effect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype._createIndexBuffer=function(){var e=this._scene.getEngine(),t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=e.createIndexBuffer(t)},t.prototype._rebuild=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&t._rebuild(),this._createIndexBuffer()},t.prototype.render=function(){var t=this.alphaTest?this._alphaTestEffect:this._effect;if(t.isReady()&&this.texture&&this.texture.isReady()){var i=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),i.enableEffect(t),i.setState(!1),t.setTexture("textureSampler",this.texture),t.setMatrix("textureMatrix",this.texture.getTextureMatrix()),t.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.setVector2("offset",this.offset),t.setVector2("scale",this.scale),i.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this.alphaTest?i.draw(!0,0,6):(i.setAlphaMode(this.alphaBlendingMode),i.draw(!0,0,6),i.setAlphaMode(e.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var i=this._scene.layers.indexOf(this);this._scene.layers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},t}();e.Layer=t}(r||(r={}));var r;!function(e){var t=function(){function t(){}return t.CreateResizedCopy=function(t,i,r,n){void 0===n&&(n=!0);var o=t.getScene(),s=o.getEngine(),a=new e.RenderTargetTexture("resized"+t.name,{width:i,height:r},o,!t.noMipmap,!0,t._texture.type,!1,t._samplingMode,!1);a.wrapU=t.wrapU,a.wrapV=t.wrapV,a.uOffset=t.uOffset,a.vOffset=t.vOffset,a.uScale=t.uScale,a.vScale=t.vScale,a.uAng=t.uAng,a.vAng=t.vAng,a.wAng=t.wAng,a.coordinatesIndex=t.coordinatesIndex,a.level=t.level,a.anisotropicFilteringLevel=t.anisotropicFilteringLevel,a._texture.isReady=!1,t.wrapU=e.Texture.CLAMP_ADDRESSMODE,t.wrapV=e.Texture.CLAMP_ADDRESSMODE;var l=new e.PassPostProcess("pass",1,null,n?e.Texture.BILINEAR_SAMPLINGMODE:e.Texture.NEAREST_SAMPLINGMODE,s,!1,e.Engine.TEXTURETYPE_UNSIGNED_INT);return l.getEffect().executeWhenCompiled(function(){l.onApply=function(e){e.setTexture("textureSampler",t)};var e=a.getInternalTexture();e&&(o.postProcessManager.directRender([l],e),s.unBindFramebuffer(e),a.disposeFramebufferObjects(),l.dispose(),e.isReady=!0)}),a},t.GetEnvironmentBRDFTexture=function(t){if(!t._environmentBRDFTexture){var i=e.Texture.CreateFromBase64String(this._environmentBRDFBase64Texture,"EnvironmentBRDFTexture",t,!0,!1,e.Texture.BILINEAR_SAMPLINGMODE);i.wrapU=e.Texture.CLAMP_ADDRESSMODE,i.wrapV=e.Texture.CLAMP_ADDRESSMODE,t._environmentBRDFTexture=i}return t._environmentBRDFTexture},t}();t._environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR4Xu19Z7PtTHbW1g3jMMbGmGDAZAMm5xxMLDAU0WSKWOQcCoqccw6eGdtgk4yNbZxnvvAL+Af8Af6AsQl+06ako9X36dXPSi3pnPu+cz/cOntL3S1pq5+w1mrpLs/eud9fvn27rf9evPPwFz+v22S7fGZ/n7/70G79J5/Xv/qzbLP+Pnvvoc/6Tz7jX/15/c62LfeH7fofbpfP3l/ct36Wf+u4+D37+XYb++G26LPsr/zFttnPuh37bm1bt0f7MvtlnOx4uv0H4fty8UUsz77rfn/57u32cgXvDv72eQf0tl0+G38b0Nf9K4Dl704MEfA16KsE8Gw9JgD+DQE8EA0DT2b7GwK4GHnF4a8iguXZt9/vL5/dbisJbEq/uwD5vIK/fbbAv4N9U/8nJIDNCazKvBLBGwdwu62OhajxmQSAx6gqNp5HCg9wPan2nwSNjhLD8ux/3u8vP3y7vbwDAYjtR8AzFyDqLu1Q+YEINnew23rPCYiKb+q/K7o4AVT4tg0t/h4ydJZfkQASQ/d5b9fZ/Z1ENmuPn/cwYCYEELBguKC3nRkCnE0AFOwOKCOAR/sH/L4hgFMpbSWP5dn/uN9ffs7t9mJ5cAHoBLTyszBAFJ/F/xIKdASw5wgaEWDMLySxAk4svf6L+4QAGPiJCziNAPb4f3UZ2dh/m+z7BK4SAPYrxf5FB6ABPgCUAfANAZwKyscc7IEA/vv9/uLzbreXzx9cQCMACAl00m8jAlF7ov6SCMQ8gJsMFFBnCECSg5H6TxJAU3vPAbwhgFfz9AABeOEDBcIbB3AqPzwQwH+731/8sNvt5Ydut5e3B2C/fG9P+jESgGz/RgxG9r9VAwTUUh0goQDafUz+DYnAnSha5l99Z1l/yQVswAZSGIAugNd/9xBgCw9E8aECkHUB22QPHIAVDlQdQAMWAibhBgZAasAVHUAI8Cqg96Tm0bj3VBS9jwd7IIBvuN9ffMHt9vLTbreXy+32QlwAhgMIeuNzKwOqCoB2Aa00KHE+EsIeDuj4H2N+Hf/TfAC6A4nhgQCQDDwiaKDXiq9KgBEJNPArAtCk0AEd2mpAizW3/lYIoANpBPg3BPA+hjs/9eXZV+0E8Bm32wsJA9aEoBCAuAABPiEAC/yDC4gSgRgKRHkAlgsI6v7iEFqJEMgBwb4BGkEfEEDnDlReoAP/SQRgOYIB+IYDMEE/SQBbXoLNr0jhq4qOZc0PHBSf5oKW519xvz//kbfby8+83V68ABfwniIBgwgQ/HoRUMv8w5qAoQqgk4DWQiCw+63eD8k/XAPQgK5s/5a5xzAAqgR6wY9k+ZEMtCOoJABb230hEHMFWQdgAl0Ap/+uc6tKBrrP/n0AuwfiNwTwNKguHHV5/qX3+/M1B/Ddb7cXax7g2e324vaQB3hhkMAW92tHoFb96cVAbimwkgQ0Vv7R+D8iACfuxzKfLvnNlAAjAsBwwP2MwLQAD9sbYJME0AFcg5uBPSAA0x0AobhtcDKDA0j3KYDhk7Hp8uKj9/vzH3C7vfget9uLT9nDgDUZuOYCLBJA8MNKPyGGIftPrL+4gy3eh5p/lwRUYYAs9Fn7tM/E9lvJwCH2DxJ/mPTr4nyyLiDtBgTAGCrgNuPzNuETgN+suEEAFhng9lkCoICMLH7V0isCeEMCxylrefkl9/uzz90J4NNUGLDmAnYXINUBrf5dCCAuQCcCvYVAYPk3G++VAveVfkIAFRLolgbr2F9ifP33pAqAV/fHRF4HcAS7AKlAAEIYFNwITOszs/wMsB6II4BXFZ0QwBsSOEYCDwTw2TsBfPrt9uLlqzCgcwFABI0EVCiANl8Uvq0JWNsi2JPZ/0YKsOiHxftsW4v51ZqAaBWgZf91PsBL/jFHwEqBR1cCiuJ3gAfCmCEA3cf8rmz8AMZHIoA3JDBPAsuHVgL4jNvt+UoCH34ggK0asIYBGArsAB7AD+reQgCl+GwZ8LaNlP3MEEDaSg4ACMGr/+ulwV4JsAEfLH42/vdKgWElAJ4QpBl+LAlKErHwt+oGMgTA2ngE4IUIOH3dGr/hAKT/m/UBdSJYPuVL7vflU26352sScCWAD+0EsCcDVxewKjfmAzAsENVn4EfgdySgnYB81yEAgL4RA8T8mTUASAAYBgylQAkL8K/+zL6rsl8qF6ArAeS7WRGoAB8Sf7isN/VZqTs6jQ5wXlweWfyqpQ8I4I0TmCCAT/3I/b48u92ef9bt9nwNAdZE4FoOFALYXcAGegkDMByAzzQEgJh+cAIs/legH0IA5QTCPADE+7ISkD0TgA/8sBIgLQfOgF/F9kPcr+J8fIYguyCILQRKgV4DNviOzoKqeJS0u4AA3pBAjQSWT//I/b5OmC0MWB3ASgBrGLA+IryvDNxCgRXo+wKhjgwk8bcTwUACsJ09ANRVAALwCxmEoFcrAUsuAJ4M1E8BDuHABAHomJ8RgACrZfQLyT9dBWi2OOEG9NJd/TDQ8HAQuBE97ZhjGKy6o+imnU+4gDckkCeB5cMfud/v6zr9Dz84gOdCAM/3JwQhF9CAD25gBWWz/8wNgMpj3K9Lfy0foMMBVffXyT4r+cceC9bvCcDFP0311QrATPkvWgosYQFLAuoqQEcQuw3v2si25F+M1RkZXLUU+CgBmCBOEsCbvECOBJbP+Oj9fv+u2+3Zp91uz9cy4Kfebs/3ROD6iPD2b10YJCXB+0PyrgsHdtBuRACfBeTN+uM+suJPSEDbfh3/oxPoHgwiC3/06j8Eutj69sAQqj++I0CUfvIpwCEvYCT90O4Pn1XsT5Ve1/+dcp9FBh3woqXBSEJkvjHHEOUPqJPAjUUCeOMGfCJYPvOj9/t7//d2e7YmAlcS2B3A8xcPYcBm/7ULEDIQew+5gS0EIEA31R8Uf6gAoBsgKwBd9ddvBBJAs6XARgLQXQ2o7T8+IETe+9eRACg7rhCMVgCiE8D4O9wOCb2ubOht1/vYd2ubzLlgKbBHEDSnAMfL6durVm8qBPwXWz7rY/f7/X/fbsvL2+3Zqv4QAjzfw4COAMAJbEC3wC8koBJ9lAhgxZ+4hi3Oh/f8dU8EqtV/JhHgWn9cC4CJQZXZp6GAk/1nawMkrrcqAiwPIIA2FwOB2oaAF5UkcX+GADBs0I5gsNbBQqCorJcFJjqWKvhNMjky0Aek7/LZH7vf3/vO2215vruAD91uz/dSYCOAPQzYkoD7vw34sFIQw4LNymNSUKk8Wv0hCYhkoJ74Q6BboO9eDKoWAHXvBiCvAdPZf4nt3QqA924AbfXV8t8uN4Bt2We029WkoErWpSoCSm11TM8AOYA5uRS4RAITIQDDavaYHxCcm5exfM7H7vd3v2N9McDt9uxDD//WKsAG/ue32/M1DEACuO3g1jkBsf57fqCL/7UbIISAio85AAG0VQEYiIC9DJTYfy/+Dx8HlpeDRK8G90IBHQbgWgD2WT8LoOJ7NyeA5JEkAwwxmuqzur5X6y+sBEwDMggrqoBNH7c68Puk/fI9Vwfwvx4e6H724oEA1iSg5AAaAewlweeyLmAnAHQCTfU1CTAH4GyTMt+QDMRFQFEYQB71lXUAOjHYlvTqh4N2xe5yASoh2PpaJUGDBDrLr9cGIDlY1l+vDlQOAQHckYMiA68KMFsGtOy65RCGsMIDT+QqJoD3yUwCy/f+6P3+7koAt50AXrwigM0FrIuEoBrwHMMAUhmQUKAlAwHo7VmAPURo9h/r//ozLv1V7/5v6wGMV4B3rwYPXEBqIZAQwp4TYDE+LQlqtQfw6my/LgsyZaeLg7wVgmDnWQ5AA5ZWCDRx7ECzyn3udgFptFCIgTlyFRMEUCKgA+O/jl2Xz/3o/f7Otz88QvpszQOsLmAPARoBSDVgud02AthdwPZ5BSxUBVr8L3kAVHrvs076KSLQi3/M9QCJ7H/G/rf4n8X41XIgcwHecuBMDgAe+BHA6uQgqnvbF5DB5hwUQM3vQgIWkKOVftH+gAC6cz0RXZ9MjmD5fh/ZCWCd1CsB7CSwhgArAUgIIC5AQoDOCewJwab+CH79WR4C0mQAZT4hEQS9DgfEztNkoEECDfi6FAhZflb6Q1XXqwHDEECpvZX4a0qP1l7bfAS98cQfzQUo9a4mASMC0CsIm6JGK/2i/QkCuFK9PxmIYPm8nQDu795uy3K7LTvwVyJAB7ARwJoAVLkA7QIkJ9A5AQS95Ad2YmgvAJWwQFcBpB38pUuB9wVKbAWgCXwV86Mz2ICKTwUWFgOxMEBicr0eoBwCGBUADfxsDsAiA+zflNay31ZcfnAdAAXgDGkcdAcfZCJYfuCX3O9vf/vtthHAmgcQF7ATwOoAtn9IACsRSDkQ/wqIIUGoXYEQQ/sL5IDJP539776DwodVAGlr5QBgP8sDdApP3gSUXQa8/rZsRaBeHmy+HwDyCI1MUNlZzX9iJSBO9igJGJYCo4RdIqMfJQ4Ztq8C7FXjHuSnQ92XH/yvdwJ4Z68ErOXAlQRW0O9/JRG42v9GBHsuAImAqv+uzDo30C3yAfVHoHeg9xyAp/7wlp+WFCSWv1sOTBb+0EoAZP5DImBrApAUMFHolQG19c+EAkbpjyUEdQ6gm/QEsCzZFxKDlWNwprJVWfBm/1WAvWrcQ0ie7Lz80H91v7/9v263+9sPI2zrAZAEdvXvXMBKBJIIFDcgyUAEvHICg/o7wA/Bvyt35wCc2F9Cg03RvRyAA34N8hD0xsIfXP7bQgDMFSgyYO8GsF4N/hQ5ALak1yUGRQDZZJ5VWXgKEsie8yQuH63b8vn/8oEA3lsJYJ2EQgD73xX4z9bs/74gaHMBQgA7+DsXAJWBBniHCLTtNx2AUnkG/LYNiUCpvX7wp6sIOHF/lwgkNf8UGagwYMgLMBdgLQCyVgOyciCGCs5nz/Jr8EXOQOcQZEbrfjjTU8qaCBseMyx4vxPB8iP+RU8A24Kg9R8Qgaj/av8lDBgcwApQ+QdVgW0bKr3+jsk//AztzBKgtv4K+Kj08rl7JFgt9BnCAIsQcD2AsQAolQj0CAGAqhOFCK5u3cA+84dyIJLCPm6buAgoBa5qDoDF6wzUkZ13iSDKKwTamSKZSf29cuzJUwq7LV/wz18RwH2Nl9dKABLArv6bC5B/+9OBGxmsIIR1AQ3w2gk4RECTfwBulgC0rP96/FYJUOv9SzkAB/xuKTBY/qsTgZ0LILF/s/RW9v81ywEwhbeAwUIH6hRwGp+wEOhqoF49fojqQoPlR/+z+/3t77jd3n3rdru999CzEYAQAYJfXACEAqL8W5lQgA5uoJUK9zxBB3ii9ALiYT2AjvuN72wFILP+XdlP8gLKFeg6f5QM3AC+VlMMZ9ABGuN+VePHWL6tHVD23or3tQPo2iWfBRgShDp0ELcBjmIAbwTWqEzIJvLM6kEDEFcD9erxCzg3my4/9p/e7299x+323lu32+oAtjwAhgE7Cazqv7mAvRLQcgG7A9B5AAwHus87CWBYsIKFfe+eCSBgt2J+7QBQ+VsogOU/9fIPBvLhASEF8AHwlhPQ2wVYFhmo/Wby74QyYLcmQAEbbbue2FcnAb28QTmHQKBwNVCvHv8IESw//h/f7299pyIA7QIE/LsTeIbqL59hPUADvHIBG8jBIWgn0L4rsKMj2Noomz8QgZELsCoAAnh0Caj8lup7ib9tX+ZBoKgUmFkWTGJ8S/UHZa/kAHT+QGaeoeQmMUC/CoAzVYAjYDvSNwPCq8fPnINus/zEfwQE8O7tdt8dwGZjIQQQ9Y9cwAB+RQIC4I4MdvvdLL+O//E7LgLykn6q3Efjf6X8bOUfkoNYcQZ8z/KzBUBYCqT/YQgjBuOBHxPs7JHh7JoAy/IzWz+xEtBKBEYg8fIGw+SeQQQ+CzHZP+oWXWPU/8z9y0/+h/f729/5kAN4791X/6/cpl4SCsDfLRQwHEBLCmJFYH92vssNgBPo7D8qv4CekIHpAjKgx1iffGbKb5UAQwdguIAtz2KsEWj7vIQggNON91lYoIFN2mznYKj9UBmwQgXLLcDstRTdBchEFWAWcLP9MgC9cuzM8aXN8lP//v3+9v/uCUDyAM0FIBFADqAjAsgFiAvYwK3/MfAL8InSd/Yfy37Qpyv3OSTgxf8C5vZXPfF3aB2AA3hJGg5LghMOgCUBo8SgEAyC3Irvh5xAwhW0cT1iQBKYWds/QQLdeVUQcrEjeGoiWH7633sggHfWJOAaAkglYL/wLQyQf3tYsCp9CwmgFIgOgIJ/JwMdBuB3cQTDX4z9wR2whN+WE9idh67761p/F/8bpb8O/OotQCsJDhZfji0qT9p0LsCI83X9H8E9KH8iCSiTrQO29bwAAbvlCipPAw4T/oRKQAVElbaMJ472t7jnqnEjrlt+1t+539/6P4oAxLquawIkF7Bb/40M9hAAHcD2GVzABmBYKSgxfyMGAbROCipl1w6gs/8ZF0Cy/UIOOr7vHAIu9iHP/2v77yX9ROUt29+AHVUCnDJgtvSn8wXsnQGzIUAW3F27qFS4z2CrD07wCogqbR8LtGecUwR4vX/5OX/7FQFsOYC9FCiToBGAEAH83ZwA5AM06BspiPKrNQIt/kcg69iffBegNqVXb/wdQgIMC0DltUuQ+L+Bmz0OrNTdK/91+4JVf15SEPMCYRkwEfc3stBxurMS0AoTMKRocaV8cKw6jpcFsdUn2/8qRT8buGeP55HC8vP+5v3+1v99cADvvfNQBZB4dO24Kv5GAntSUOz/+n1wAis4wAnoMAC/N9svSUKsBABgmwPAbQTwWzsW/2vAI6j14h+1CEjnBYZFQWSxj+sEVFyPjgBBrhf+aOtPY39vRaBVJlQ2vyOGIATQsb6etBguDMSQyAF4IMhUAmZANNNnUNSqBDvtzzif6HSWL/wbuwN4eycA4gDEBQgRYPzfSGC3/BYBdOCHxKBHBAJoAbdWfIz1I9XXsf5g9y0yAJB7iUDPCaC6e2EA2ngMGyIHwAgBldncf4ID0EDXVp1NYmbnrclOtyfDhiPOoCO4CEXB/rOBfOZ4yy/8a7sDAALY1gKAfWMEgOovoNdk0IArKr+7gwH02gWQ2L4t/sEEoLL2IQnoFX96HYC4CIz/jcSgAJSVAtu2RPZ/SPRBHkC7AkYEqceC2fqBfdKaCcHAAeAkpKVBCANcElBVgBQRTC4HngHOTJ+rQo2jhEbP6xf/VU4AmBza7L+EAZgLgGSgxP8dGQDwmQOQbS2xp6oEWAnQn1seIEMCJO4fsv8Q2w/JQU0IJMvPiCCT/NPuQP/noJ0rAFBa23VSr1N/vQhIgxzzB9odMMIAkGvFZPF6JkyIlJeFFl6IcRYYX0ciOOOcll/6l+/3t/7fngPYy4BSCmyT0SGAlgvY4/+BAET10fZjUhAWCg2AV8nBEPQ6D6DJgSUAoQ/G+Dr+T9l/pfg0HxAs/e3WBUhbsihIgHKkHGiGCQHYO/UHomDgdd0BcRkZlYtyAFlgZNtlzqkSJcwc1xr/6FjLL/tLPQG8t+YA3tuXBKPiqISgAB//bjZdkoNE/Rs5EAIYXIAKCwYHYJADlvhalp8RgS4PogNwFN8jgo1A2LoALxRw1gA09TbCAjckQHBZlQEFwEoS0Iv1S3mAYFGPlwOIJn+0v+ocPohEsHzRX9gJYM0BvPvwTyoB2gGsP6iEAowANsBJWAAVgRYeAPCb/WdkAKEAttNJwRbzM+UPQI8K36k9Kf3RagBTe2vhj3o8uAFXLxUGxTdXBrK1AIltTZ2JzUe7Lp/Ralvxvrb5kcWP9nv2fwBzIRF4FRFkx/XcwRljHCGm5Vf++fv9re+63d4xCABVRhOAJoOtRCguQKoCmghwv7L/mBPQwB/KfMQhCEF0ym8RAUkIToUAxrP/gxOwSoDGmn9WCjTzASw3kHQA5poA7Q4g3n+MEMAChiadiopXwHZV26usvB43e/7Lr/pznADakmBdDcB8AFj+5ggcF4AhgAlwwyUM6m+pPgF8U3BS6jOdAAkJ3HUAO5C7ZKBT99/IVDsGhwyY3e8qNfhCERXDa5BrlW/ftaoqe265Ar0U+PIQQCUzqwqYBYfnSK4AcuW8sjmHaMzl1/zZnQDeud3eXRcCrfH/ngNYbyxzAKL8nQNAMiC5gI0gBNz42XIBAnAkBACwqDyWByPlp2BPWP7WD0Crs/5ewq+1JaBnWX8rEajbDiVAlbNpwHRyAJ4D6EqECQcQWfxo/0wI4E3wcPJnUbSLXqH5A26qHaD9kb7ssKaj+nV/ZiSALRG4rwhsJLBfUKt/k3yAJMGwEtCFBGD/PTIY4n6d8ANyaEk/Q/nPUv8h+WeRgXYCVgIwSwbK3osKi4PonEGUC2C2Pngc2LL73Xanlj9bBTg7BIgAFe2vuoxZS14B7wy/DCT8xX/qfn/rrYccwLtrElA7AJkgkrDSJUHJfO/Z/wZ4Kx8g4IXyYKfm0i9QfkoSJK5HghALr51Ce2Jwv0ad9BvAj1WCidKfZf1x3UDnvPQ90HYf7o1WfSQMGbOpU1D3H6oCynpjPE7VfSccpoalMEHNdAxFKkDLgDzTRo5ZaXukz1E34f1Gy2/8kzEB6MUlsjCoCwWMEAAdgOcGTECrnECn+JYTgPyABn0U82vwt7hfJft0rK9DAlHooTSolH94GxBUAnTSL/reAbz6UBADt344SDkIJBIT5E62HgnEAwgFmjq3ChFkAJUFd7Zd9fwsdZ89nnX85Tf/8Z0A1hwAOgDJAxBbuU1usboYCoiCKvWX+L/lAUDlNUG0bD8Bt7dviP9Vf0v9LbV3XQCz/3qbZf2d0h8D+JAPYDb/RAfArL1l92W7Z/OjEICpOZvkw7bES0EisET7M0RxRNkzx78qJGj37rf+MUUA+zoAnQjs1gTAhJNyFy4X7kBtkYHKB0ifDMgrLiADfJMESGa/Cwe0/a+CHsmA5QQ8N6ByAzJZh1IhEobOAegsvwaVDhEKDkCre0cielYbau4SQfIZggyIM0DMtMkc6ywnMHMsduzlt/+R+/2tt2+3d8QBiAtQSUBaEVDxPyYB22cEuiYDQgJtLUFk7539ke1vgAeAR05gC3ekbAclwuaEjEVA3XoAAnLpT6sBCuStrUrIpqsBHhkwcBOVTecFJAteCAFSyk/GzapwBOJofwV0mbEQkNX2p/X9HX9IEcB7eyLw3q8IlPgSbV/LBThEIMreQJkhAeYOIsDrsELV8VmIgHX9ITGo1L+BnxGB5wQY6IvKLzZZCKD7nsj8m+sADjoAVHk9ga19tF1CzSk5GO8T9MCUAdpZbSqEUW17lpNYfucfvN/fBgfwLlQBcEnwdkA9cdGiCjCgGrCpZhACDMSA6wL28dewgKl6GzuI963EXwtf1Nr/wQ0YMb+bCJwAPgKc5gPIPeiImeUC4B5J2zbZnGXBQjI4Mdk2HFNPYqv9MNlJCJByAzPPEezIiUAe7a8ANjPWGYpePc52Db/799/vb7/zKgQQAnhvDwH0cwFWLqBluwkRYJ7AqgoMTiHjApTqR9ZfbLxbCbCUX1wOKQGiO8ASn7XdKgMimL2SoG4nkxGVnqk+OoeBDHR4AN87EmCWnlULBGiBuiNJMFC5RJB8HsACRgYwZ7WpEEY2pNEuYOoYv/f37Q7g3dvtnT3+39YC6BBAv3IK1wVA9p8SAYC5gRDBqz53QDasvag/dQboGMCy0zBA7e/CgoTyszX/VeA35QeH1YGc2Hwr2YchGn5mJNGVd8FdoEOIHEBo9VkeQc3cqFJgEkPhxSBHwoIMCVTAlx1vlggq4y+/7/fe72+tDuDdV2XARgD7isDtd95BpZWjKRUov4Acwa6BT5OEsEjICg1aBUAl8DpwA2kgQeCYbHsjL0zygfKbll9XC5xk3zYGgM1yA0IKERGgI2PJQJ20M13CAQfgWv1kEjBj+Yc2zlqAGdWPgBPtrwI2O16FXMrn8Ad+z04AaxVgTwDiasAtBNgnrK4E6HBgSApichCBBHkBCnQNbmb1iTPoSEXlDXCfTv6x0EAA2OUDtCPA70bMT6sAXjVAlf4sIhieC8BYXy0CYk5gIPKCA8CJGzoAI5QYJqoRzx8NAZ6KCLLgzra7igSWP/i79hzA6gCAAMQFrBMNSUCrFypUm+x78k/cQRffY45AqatOGDJy0CDHkh5dDERielFhWvrTIYHO+icy/jK+qe6sCkCAH70erLsXylXMWv5GFowQrLyACISU6HZ0W+RALX0Qz2ug4NgYUWScRNQ+q6IZ8GbaVMCdHS99jX/4dwIBCAmsoNd5AHAB1sRDArByAV1YgLkBnfRDF6AtPbP4LNY32lkOgMX/tPynSKFzC466Y2JP+mT+mk8BOiVAVP2MA9COgH4nQGcgHxyCAe5uMicqARTcJ+QBIlB5+6O+V4E7c9wMCSx/9HfkCEDyAMPDJiQZ2AABqtZUVwG7s+ZWMlCDO/F9iPFZso9l/IkDaMRgxPqe4g8JQa30yg14pdaM7TddgWHxXcUPVgLqvnqyWw6AqrlT0jPV33AekYJb4IlAdfX+6LwR0BVi8Yhg+WO//X5/e68AyLMAawlwCAEwF2BkpTfgqwlu5QU6G45KrdYNsNi9qwAQMgjBnyEDI77XYGcxfjXut1wAhlfSptsGoNHJPab6XkLwTAeAk1MIidp+mJlRJYCqPxCABwizr0aUDl3I/ogEMsDMjJEZp0oYjECWP/HbSA4ACEDWAbA8gJ6MjADWbYP6i5LqvyRROBBABHgjXEAV14k963s7d0koOkm/s+J+FiaERADqbjkAHKNNrsRCoE7lmYsQ0HjlPm+dgMzKRLmQkkgyBJhR/SPWPwPyTJuriWD5U78FHMB7eyJQ5QDaYiBhXL0mgGWumRNQAO/KbieTASMOL8bvVgUSq2/lAvAaOvDiwiEjs6/BThdZ6bUBJNvfuQN0Z+pzVzI09nXqrT3UMRMAACAASURBVJcKg+J6xKAnLao7Tvruc6ZcyBS6EDpUXUIEvgyAz2oTnQuqe+aYzT386d98v69rALZ1AEIAazVgz/4zBzC8aorlAdS2rkIgC4e8v2TxkOsGMLeA45I6vgZ7ygFg4g8JQhOdl+FPZv+ZnRey0CQhE4PtH1TfCBmkXQd+S+1ZXkCTiQZq0gG4sb6qMHSAKFYQHpsIMoDMtKla/syYy5/9Tb0DWGP/7R8QgOUA2NtnzEw3LhRS6hjlA9CK6/gfS4XU5rOk427p9bg02cfATtS9CwGcSsB6/taTf9Zvx0ItvQ2JgH7WgEYyMMA+5AwmHMBMDsAjAhrPTz5M9H4mggy4M65g+XO/YSeAXf1lLYAsBca/24D7MwKdakBIYOUBxKYyJ0BDAeIOTOW2QI75AgVkXNVH7b+VBFTgDisAQda/gd5LrCrlZpa/WXJrEVBk+cGxNWAkqwDMQWiFNq2/zNKgDOi6A2NFICULRAV8rrSN7HgEzmh/NH4G2MZlDi8qXf78Fz8QgNj/thjIcADtvw9HNcgQwGxIwPIGLHTQVj8BfszWmzkAlZsQwFrlPbcCYOUCjBwKKwl6pUBRWyFhukxY7LmO7414X8f61BVY4YLY9iDBhy6BTX6LPJCoPHtcAXelbQRUD+gZEojGZyCvjrv8hV/fOwArBGBLgnFpcGdJYUJ0gNknxLDNCwm8xKEV6xtqPwt4DWpm92kIQICN7bSNF2Xv/pLfUgNd5wxoCEAA34GbqL0VAmhSuMIBuIqv8wGJRUQWmCzAfNIQwV/8tff7O+9BEhBKgEMiUIUAXjLQinMbAAAcCIruFWMVgBPFX28iLhW2Yvzu+JCo06A21wAQm69XRVJwk+RpaiEQCxeQKEDlaWhgtEWQWEqvt7vhwoQDKAFfjR+5hytdgjf20X1HLH/kIpa//GtUCLATgE4CogOQz628IwzslKx0gosuG1bWnuUGotJhyzUYYUIjBSsnoJKVXZnPCAeYo3EBH1UDDIA38CniiBR/CA1I1r5VEQBUg/1XVt8jjG7iWZUD5WEz5UIK8sRagIhYquQQgfqI/a/aeBYKZMOD5a/86r0MCGsApAqQcQDbgTQBMNuqJ70GE/nuOgMSGjDFj7ZZhNABnxBTIxon459Vfa9yYpUEEfRU5RXounEUkJEgGJlEYNb9O2IQ16hsO07y9nk2ETjzJKG4JIKUSlgQKqyDzgzQM22ic/AcxPLXflXSAew30no8eDsJvBGWyhmJsKojQOAOi3R0yRFtPcvuqxo/tf7qeryYv2T/mZqT0IARgfzmG9Eg6erP8Jvr+4Tk4Sk6IwnWfgA/IxsCPhmfKWuk3ugcqENIgLwC+hl1j4Ac7c+CPDNOd4/++q/ccwCRA1iFHkqAtBrA3ICh/J46Yp7AjM+DHIK27t1aA0YIbKGPIisrw59NAOqSH/0NEKyMCBS4qwnAtNpnk4JGnN8pfKYKoIgiA2R2DEYglW1XE8FZQI6AHu1vv8nf+BUPBNDKgFYOgDkAsHdmQhAnkhP74kNDg72OwgMP0CRuN90GW+CTdCwWoVluQKv3EAYQ1cZjuOpv9JXJNyT49KIgliMwlByVu7kJUFwvPBjcQuaxYSuUOBAGZMjGIxEP1BEQn3z/3/oi4gA0CQD4uxAACMBLCKLNjFSPJd3Q7rtJOWu1oZNcHMgmE+8H5T3P3Xj7OlCzCgEeN+sEVDs8Rpu4Ol9ggd1ScuYWkAQIsDv1lrYqB+BZ/2FfsBqQAe3sbZG6Xwn2aGzr3Ja//cuJA8CnAXfr314SajgBkwBwAs6EAwmwWWFChThY0s8iI297B3DDPYRtCLi3Psb2AdRAHrKvqb9BCEyNtaKXS4OkoqAnomXjKUEo9e/GSjqAs0HvAS8C5WzfaNwKES1/95cZDmAlAbIacPudIRcgi4H0oqBuUirgU6WDSVtJsHnJw8gtZNyGWeJLEJNn61vZzYjzo/3dQ0Ea1DgmUXMWAqTAbil9UOaLynttQj+iAzibCCLQRfstUM+ShJiqqP/y937p7gDuex5gBz5bByD23woDMA9ACeCAG8jkCLTis+8ZUhjCAisZOKvwySw/OoWONFWMrmv4ZsWAqX+wrXMGbLkwnMvgIowEIWuHTsV1CTKz978WeViA88IKDzRnA/Ts8TyCcUng7/+SngC2twFZJLBPljIB4IQ1wgA9waPM+rCfJApN9Tae1beOGZ1LO06CEKj7UbF9A7CVB7AShIa9R3Uf1gOwhF9V6S1iEEQFDqFN3my14IJEYNYRTANNERd+PZMMIsXXp7H8g198v68VgHf2uP9dBX5xAtvbgaUUqEqCg/1HKweAlx9vsLeGIlqxchWojCyqY1RCgXK5jxGHofIsD9B+V92nSAgIxCEkgLEGBU8mAaO4PgoVmEJbOQQG1CzIs+08Msg6kAwRzJBOlgiWf/SLRgewksCq8l0YAKBveQAgBGb/t4vDhJQmAwf4a9dQeZPWnJbiHMfgOYeNlAKlx3BFOxs3L6B+LySS8EUg6rzwuEgQ3luBGugDqx/lCzyCGPbtCBBi05M9Io2OFB4hEXgmGLMgzZDEjIvYruUf/0I7BGgkAJWAbY46SUArGThMyAIZVADH2ppEkiCBir2n5xmpu5ME1I5pUH+LYEnFICKEDpiFEADPSSu0JhQX/MphTBFBIYnI3MRjgLviLs48H9OR/JNf4IcAK9bxPwoV9TerAXgj4T0BOJk9MhAQDZOfACUCNgIy0zbTJpPZpyGAQwTiKug7AYkr0L+N991Vf00gpGyHINbK3yZVMQQwVT2xEMh1BEZ/Nvk1EKsKmgXyGeOeTQQdEf/TL3wggNX2b/H//jqwLRGo1gC0HMCeD9AlQPw+WDqZJEZIoCdaNY6OgOmFAVq5u7ae3Y9AHam7sd8kApUsZHaekclAvrv86eoBcwkZkFvrA1hf1wU4Cu4Btu1T/c8G/hWgrxDEmSFDc0D//OdDCEAqADoPIMnA7a8wrv6LpSEFfJlkoQtAdfKShEmAWlUDN7xgOYYE6DPuBY+Lv0W0HRXdK/cN2X6l0jqcsICubbx2AVeFAK7Sy+zV1YDiasAjgH6MvqZth+vXH6sksfyLn/eKAFaw6yoA5gEE9FYScDsZZfsR8CwhSJNb2Tq5UVLsQO0lE5Pk4bqRiBDU/oEcHFVn9X1T4dFZ6TKhYfWZcltqbm6HsZm6D07QKuGRcqQGgEUKSF5N2QySYPutbZkw4SmJwCIIJIXIYSz/8uf2BEDXAWAosN/w7gUhAHwhge7GY2wGBKFtf5oMGKgcl1Cx/wKwKKQY2hWB3oHbqver7ab6J8t/2L9VbaR6sM8auk4gArlRNbBchQnSaBw5RyV7lRCAgSYCerS/otRZwqiMmSECc7x/9XNUDkCvAyB5AAwDtrlBQgG8KegCOsvolQgrgPKcQKTQSReBhOCquBP3a8LTToXF/vpY8ls2J6AdBFH/rNJfov4YDoL6UzVP5gDc8MBJBFbBnwHrWW08EEcqrvhw+5oNBZZ//bMLBCDqb7kAcAJtUQeyOuQDcGIPnzFeJQClSbJqngBULW3xIzKpkBYe3wGxkISn/u5zASwccLbh5NHhht43ELsFcGeFXwfmA1UAdBsZ9YxU/ej+zDkwJ+RtO5Mkmhh9yc+637cKwJ79lxyAlP/kKcC1IqBzAJgL0K4AQwC0m7hgyAsBrAVEaL0HJU6SQKeiyT6dWictOwsTsqW+9ttosAax/pA3AKJBEqEhQLX+T+J2PG9GEIxEPPC6ag/SNzhOtm/fZo3JABYpfLT/KBFU+leUvxHNR37mSAAC/lYBUDkA76EgIYWOAHASKnXHm4/hwaB8pIxIV8oFFpxlziNws/0diSgF91bwuQQmE7QQ+2fUvwO+pf7KkXRA9db6W6QB1+KCHu1qMgTQE70DoTOG24/Y5qMuIEMOFYBXQ4FM++WjP2MnAFUClGTg5gCEAMhy4M4F7JNou/eZ0qBWELD7qO6D0uNkZXmEwKqb4HXI4wzAa8ejLTYSjb5mfXz8jgCvlP86YrhC/ZH4lfpSFU4SgAfMo88TZFxAlRgyY1aI4Iy2zQF87KfbBLCVAAP199YCaBJAV9AlnAxX0NqwnIBSrHSSziAPa/VeJt/ACMp0AY6l1+CNvofqb6h6NikoJMMUHN2apayZNt3YxRwAPa6Tb2iTXj4cVP2MwkdkUQFz5njsGt1tX/rTHghArwHY7P++DBhdwDanYCWgzgPIfh2TtfUB+6QcJhcBedfGUXoGwAaOyXhdKy4rC1rxPAtlymqfjP0x5h6ArVSdARJdiQa6BWC8t3h8RhQ616AnY+cEigRQdREWUZ1NDBnFz4I5Y+OroMf2y5f9VE4ACH50AS4B7OD28gDtxyEVgW6yOIQwWGlg/Uz8bQLXcBoa/AM56Dq8FcMbCTyx/o3ISF3fsvaMWPRv7JLEPht08nC4TyTDb5UNI1VnwO3coaHQFPBKxa0QwAO/G1LAucwA+2oHkDkny2Vs27/8pygCANUXF9D+h2CdC1CA334rcQf7Z7yxsp8qiFpBOKhPQAiW6jIlN9UdzllAKQBjdtxT9eF8HJLQ5xNae6Lska1nSu+pfyMjb3GOlxwEYrHANwA6sO/abdBxyRiPAf4ZoGf6WOA9y0Es/+YnAwHs4JfsP4v/JSEoTgD/is1veYFZEsB+xAp7gDEX0yRU2asQaHX2wD8QjEEsCDKt0pZqM2LpSqaiiNpteCW7mQSgukc4UTWxsH0Z8EaKT/erRGIW/E/pAo6AOdt35+Pxvwf/t0gA8BKQFfzZMiDmAYakoJ4oUB2gE4UtHDLiYQSa9bnsDEhJj4HfdBYHF/V4Vn8gvh3sh9Rfk60ot7c9Uf+Xc80AkDnCNGng+RrnzCa/RS6Z8zXBJDv0ORnf9bHY96Pbov7LV/ykMQfQrQMgVQABvP67//60BKgXA7UTU9Z/mDgk+TeAndjrBtpCBcEF9Wz23on7j1p9TW74mzaH4jgC/Vtri20uDdakzvIDbTL0y1I9Gx+V8CJHgNeTBfIMEXhjz5LDU5HB8pU/ccwByBOAXQ6AxP9sQVBL5EJGF8uByPYDCehJE1UGAuB7JKD3MadA22iFx9DCiPPpeZAFOZWyH46Jk2cDPiZFRX1IvI7XrMdg2fsOvCRsYGMM25QadgC8KAeQIg5BblAajOL26v5Z4DPrb6m95wKWf/cTxhwAPgJskQAu/aUhAIB5+22J9aelQa0uOuFFQoRBCY2Soc4PNBDBMQVAGJ50amqVI8kYOH4F3FTZsyU9EvuLMs4q/NBP3SNT1Y2FPQyQcs0RYYT7JxYTZQgiAmoE/Ki/8E80DgO+RQYe8Nvx/v2P3wng9updALgAyEoEYrY/ejS4katyBegG2OfOEqpSX7s4K0QohgVUpSft+5VgR7BFsb/nEkxScByD/s31pB2IIOMSIETRE9YLF0wiOGMtwcUu4EoyyIAe79uyEsDwIhAsBSrrT6sAuyJ0i4KU6p9CAkpl9boBNuHT7iCw9vThJBJfe8erKrt2IZZjoWSIcTkLCTwVt6oC6nojwLKYvuoWIsUf1DsZRljn7m3PAPcMBY/GqIK8YU/IHTYs/+HHKQLYAd+tBCQkMIQA7L0AQAxo8bbjI1MXPiOIqMJNOgIEly4HmvsUIaUA7oQ0tD/LuBsAzTqC7XosUnAy/MwBZADtKTl1fjhB2aT19j9RCHAGOWTGyII/Gyos//HHAgEo5c8kAbv4X6m+lRDEmy73EtViSEA5pcFOIVTSMHIEAgTLVuvVceXVeFWwO3F+ByIW5zuxv1ZRRqL6d2TK64E1Y/9dIiDWfVB3veqPEcEThAARcDNgPKtNdC6Dw/lPP+Z+fxcWAOHbgM2FQKDsQ/wP+7TSo+qzsiAqk1apLmGoVUor4kTpcCCDALzZen1EQpbNp+QEjgNdiZWxN8t4pCKQUXeLOChZOFacEoFxTmzsYRIjEZwQAnjjRwCL7Hu0PxofLnVc1IM7gzxGE96vWgkAHwUWF8AWAuGDQOyhIAQ/KwPu+9t5KmVvJwXtMHSgE9BQfU0g7oMy2g4byb9ZMFtkwUCMhNDtJ2VDDVoNLBoSEBLpQBYB18kPpElkv9HM1XRzwFB85gzw2BaArX4uoRRAFYG7up+RQYYgKm5i+aof/RACiPK39wAAEbB3ArSq3v4Bl//qpcAa8Nt3QhAM7N0FE7DTSWc4goEUAAwm8Ky1CNYCG69syWr/BJBWLkArvWflL1H/iDwE2I6dH0hKJkeyYtCRFYCThSdZYLuEwo6hCGwGlE9FBsNx//OP2gkAwwBJBBoVgK4SsE8KyQWwuJ8RAoIdCQJvpMXqVnlQA3z4TpRdjsHA1IEo6hss7JFzQQDQYwaE0AHAUmMrSWgAmJKomuRH7D8DmOVWGMAjgHb7T8oBeORR2XcFOcyMyfps2776C/ocwPr7df8rkEMC23xS/0uQLgVm3IBOAHYni1ldneHVcSMJKdbJEYYOQU7BDR+M8VMZeQZUY1tHVNYxlQJnQgJNKNbk9tzGAFovx0CWDXurDkPF1+MVcgBZhzDbbgaoVWdQsftNaIHcNwLQIYCQgCh9SwaC2jfgQ/lPg92qAnQnokIB6gCUcrlVAqNsZqqco+xMtTM2/FTwVxyBofAsvGGgNe25UxqskgxV+ETIkCaCAgFEzkLmqdXuqZ1ARBam6gMAl6/5kSoEUPYfwa/fBNSeBQBi2MZW7wRox8skBgnYTUfgKLeA11O4KDk3gJ0pWzI00BOYxuhOeU9fhwXWqdg/Io7MfuJKKNhBfRrAJisAFJgH1wF4oPYAF4HxyP6oLwN6xhls/f7Lj7jf5dHf9hdeBNoRgJH5L4UB+2TSpBDmBADsCG5U9izYq+Sg25uKqqsJhnJ64JdrcC13Mfan14tAdDL76MhM0qmOFdh2fRxGJBZQoycKI7BkQZ5tFx0v2h+BPw30BrhXH7bweCOA/eWf+kUgFvjxKcChGqAAbuYADCLQ4N5O14j9I/DjftcGe1UDpn7Ogh2LhCrHfyzw098Hwews/aVkkMzkD8qd7JciggNJQItUjoC0CuAjxMLOMzz3r/3h4ADgLcDM+ktOwKwC4HJg9ZmV/RoXWaGBUv1TiYABO8ofWLHwRDLPBd8JCn8quLMWPeMkiPozK5/dNpBCkAPIgnwWiLP9QqAqBc8of6rN1/3wh4VA8gRg9AxARwI7iFgJUCcAKwlBFg50lQIdDoCbMC1rpYKQrBygW+kUMcjkR+CsxvHus/sReCPQRvsR0A74rPCBnXtK6ZVTsdzgYwK+ovaVthE5zCi/8MnydZ+vQgC1AIiFARveINHnJQMbNlHlAbDbiTj7NBmUiYCoNqsiDBNUT+YjoHaSh3Lz3BDBcivedkaSjvqa8X2ypBe+QEQBVl9vBHrmCCi4H7EKcJban00GFcJYvv6H9UlA+i4AXAuAZT/1WWf/LdXv8G6VAQkxlMHPMsJFJ3CJylugstTaU2FPdT3wZpQ9UZ4LiYvU/TswJ1xDRsWZ88v0a0oIFjtDNt7YEQCPEEc0dnX/AwGQ2P9oDkDCAvld9XdP9dEV4I3tbpaenMZ3V2lIn0yCSlv0wyTh1Nkz9p6ppxVGoFU2VV/UOqn+6NKiMbtzdQgmcgRv1P/hJlXdw/C7/dcfajsAifeFDESU27MB+wa5jzoUaOB3LD4SA4v9NVF4LgAnd3ehgeozAHugHianEx6wCR+FG2YeA294whVQYtjvWQRUMw9BlDIkG7b6j4VmVrusOp9s/y0ncJX6R+POAD4kiI0A4L8BQ+Uf3gfg2H/2MBBTfdP+C7vAzdaPAFfIwLSERHVoIoqUBjNKm3EDGVIwx8kAOFLuaL86hkkkxcU/jDgrSh8CUhG9B6iMzc+0iUB7xO6H4EWszLqBb/ghJARgTwKytwI7OYAhBHBcQDYckOtlTmFYABIA3XILbCEJ3QaE1ampsRItHTbsF+mqqpUryCzZzYA/QzJJN+ICPLFqLwPCI/F/aXy5N4YjiRT6akB7BGmd2/INP/ghBGjJPwL+1QnIfGf2X8CuQ4GGEZXoO9UFEOdwhAxYDiCtXE79ngKh2t7LFWTAHwAbSTEKEby2kaqznEHUJ6XmCUJJjaPUdFbFK4CvtI2IprJ/+caVAHQSkD0ObL0MxCgJbnNNqb7+XlX+KATYLlwdky4NZVaRxY/ZcMGLZwNHkCaXCPwZ1bbOBZXNyS0wkJruSKmll1w9CsrHdACzZOBdYwWwYj7CcAhcijf+8o0/KHYAkgzs/u4Trqm+/g7gKYUDRNG7F4jKhTlAbz+SbgNjdz+g0S5yA0wFO5AQAnHVzwOoZ/vPAn8yMeclKSMlPwOspm1nhO2oeRZEM+0qgH8q9d/O8ZtWAig4AMGQuRDIWQ48JAUBkO3eRcDWuQSi+pETQOBSdpxQ/kjJI7IYljkrVXaBlajpZxbqeGrOQEDzGqA8OoywfvdqHP5+IICznEKFSDJOYhjvm35g0QEkFwIh2Bm4w3AgcAJ6MrV5R+y9BpcmCFQl+oOz8MByE0qNu/EK4UDkJBihWHF7Bvz4m5jAJct+I8Wn+6+I1a8YE0k4+OwBtaLwlbYZwIfjrQQwrP4jK/82+6+2y8q/IQmolR2SiNvvqFUc3x/A9jOwESfAgB6BnxGJFR6E9tWbhJ499ey9FUbIhDT6ejadAjwKMbSVtkgxY7kvAOuZjwFn1fvq0CACeAhucGPycejzzT9gdABYERheCLqDUQhh+0qeC2iYNcBvWf4wMWgQhE7+CdHoC04TAlFy0zkY6+41udAJkyANar8JKVIHEBFEspYfOZLIxofkmSEOr82B+H9WvWcIoALaStuILNj+bdtKAF4JUKu+uQpQx/5AFKj6NBwQeiLOYCCxKEegCELb++GHcCoCA2taYHXU0IrtXTJhjsd5kKcDpziDBEEgQZkkg+MBWVigiYjA/T3gZofjGI4kC+azwTszXgTaqwlgHX/5ls97tRRYVL2tADRCgUH1yYKgDofE4nc4VqDG/EGbE0ZiziMIF/yGYlCHYJEKKzviJLaOEWTbQ5CQpN9AAhcoP5JWGaBA8lmyKYHZI+FgldwMeLNhgncNlX0RWczufyAAWQqcjP2tCgACV+Z+t0RYAUmIpAOxEdtHTmDbTybBsHaAnIMmiuHmatcBk9m8iexcEgrqVgP2c6cxvFL+LMii2HkYJ5Er8H6TaeL4ANj/CKSPofiIowcH8P23COBGnwHQhOBVALxHg1l4kCED0mbIEVjqTIhk+4GT26dJIXAF0yGBQR4U6MR5ZNsNTkIRS0mVsa8ir+o4LnF4ZKvPYXKV3xWK/1o4gG/9/ioJKC8E9dyAAXaM75sDANDp+N8LA7p3CyjF1Y5B3xxKEsZ6AVo5SIDYZHMvGRUlqqLseLCSbzunpBVGMsy6hTA0icAWXf9sIjC45irZyPzKuJUjIH4KxR8cwLd+v50A1PMAmOzTnwXTYvkld7Bth5uM+9uBo3yAodKR8uP4HUEQ5dFtGYEM25QCDwQQqVAEzAgcQdx/JvipC4jICX50Cpxk/wzoorCkAsrM8WbHM0WCEGXU9qr9y0oAWwiglH8LCYz1/w3wqvznqr5BDhqsUwuEqg5BkUwHdgOI2yGsx02tHIHcaGd/pMQIbArMRF7hCGAwFMqAxWwTEdys+sO9zJzfjBuoKPVVba8lgGISsFsApElivyE45wdXADdNhwUdlkm8nnYCCeWXY+l439tecgvG5OxuZqSMjnPoJnwWYJETYUoenWOkaBP9M2C2yDML8my72fg/Am2FLKKxZvZvfb7t+77KAWxOwEj8NXUHp7DNb3QBCvwSAnSCq0MAQhiitugOcCzcbsX71qrAri9OXEY21nMGHUu9GnG4oQVncMg2Z8FPSDEFNMcVHemf6ssIidw3a6wsyM9oVwXhUQLwznkQMVIKbQRAV/45RKDJoAHcIQMhiwjUQwjQscer3hYh0BWBxhhCNCzej/ZZx9FuIsolHLbMFUWfAXIUviAY2ecKOUVjMTIoXH8EmAwhRSA/Cuoj/c255pHot33uQw6A5QFku5cLQGAjMSDmLCcw4BImixUaCDCZkntuwGtPCcABCx6nHBJkVDg7qSuvwEoAcQDIBPi9MTIAKyt59rcKyGWWHCr9IvJ4kv2NAII8gIC1Wwqs1wUAoi0yEABrx82UP+sGziCFDsgkHLDyBN1N80gjqCLg+CkQJOPqdn4BUOhEniENVJtE/2x8TduRa/IAmT1WBMSzxomO8yj7P/65r1YCotIPn0m8j28BFpVvwGdkoCRf2/gOd1k3MNgImIEEyBZZYEKJugVrHYEoi3EsTSzu5HEIZCCFyuQPnMIl4If7kgVMtt0hUkOCMj5XgVex7VM2XU3IlEAQxyPDdP0//n3GlYAh+FWs370OXBbbqWSfblNxAlbbsuUPyMLLBeA9YLafTZruB8+AO2vps+32650Flqem4b4T1d881oyreWICqJLL1e2XjQDkjUDkmX+d5WffEVeWE0CBNJU/qfq6f0eQBdVv/Qw1tdyCBWzGsDJGqBIZgiCAzjqK0kQ6A1hnjOGBNUEwIUmd5AAqxyndB0PFw7nkOAY9R5ePf+9XSUBGBAJudAVt234Ttn37xi4ESGyTE0rnAIBtBqwfAD/+Zl68r8nGdA3RykEsy2TtfJYkKsfWk+wM4GavJwnA2fj/CDCPgqzSPwoLov1HSOUVAeBKwGgtgJH80+AfbL8OC9A66Od0gFy0UiuCa+Sjt0cKboYQRGmHsR0w4vmGE0GRltk+AapuIlTbG9dcDh8mxpkCauL6wt/eUcojfY8AUiv0Wd+tc3ogAA/8xsKfDuykTVP2/YO1GlCLNnUCiii0Cpu7LUfgjUf2WTG/JgXLORwFtbkE2VLQRNKPTgiHjNKASBw7PZZ2J0Vnc+Q4ugsk6gAAG0BJREFUVVKKQH/muZxKCp/4Xv3DQGLn0fI3sEerAPVTghAaaFyllgcDi1Asq43t6yzwI2IIKgHiOFKWjZyjZ3XZBMuAOJqYbTJVwwuDfIb/l8FR2cy5VX6Ts0HmZdunz90i7eClJZnjZdoMv1EjAMcFbLiYAT+x8TpX0DCeAHPXxAA5XTug7YiW7on9NPYPwgLtEEKiSNjcTg2y4YSehCeBv+xUZid98ne5khCmwHaQDGeOGfVZVgKwqgAiiBH4U2XAfTCco1qxNcAZxiOAm+J/kSvwEoYU4Anl325ath0hr5BYNPDYq9Sr4LzY+reJfBZZVa/vhPYRGGf2Z/p4bZZPfM++CmCFAF4YIETR/upnApw3AqUJAQ4ShQPD/ovA3wjdANDwwxvKZbVjN45uSwI427eqnIywpsbIKOT7iAAy4Ix+p5kxMn2kzSsCCKoA+AiwJoOOAJTtF8vPSAK3NSFLhAJdPwLuTKiwHc8jhsx+1YaGBSRxJdeadQgWETBVTJNG0mVEE3TbXww9yg6lmPzL/gapawNSitpXgIdcF40783tlzmUd94EAEiVAuc8m+HWOoCH61fxAy19R/mplAElHicqrryeD3wM1fVkpm1gBkOgxHEV0gZA4VnpiFlQ5MzHNNoXjpM+9APBozKuI59BvpgAwJgE/B0KA6CWgrP7vZP4bWcBJZJYEI1FYQuzlAtw8gTFg2jXs12I+diz7gQA9tu/2GaRkOQvrfYapiZgNR6znyMn1zQCkpG7GOZfG0PenQAAZIM6cS2bcq9osnxAC0C6AgH14+Ie9EIQQwoY5FRo0HAbbKY5In3Yf2QtHEGVWiGEAVhHow1cHPHgeJnAZqAIll3GrSUdKBkdyBmQF41WTsxv3LMK6mAAe5bdwSKt6/AcCMEIAmevrbz88A7Dv1CofVQQ66w9ftAJrMdSuAHD46ucIiEGDeRDcKCwgB43KgZYa47l4biIav0QyybjfOufhWGcRiQHK7nivKQFUATcQ+Ylgnhl7+cT3sEOARgDO038dATjZ/w74AKTM9q05AScjBY8YEHRVy4/Kr4mEKZXbRnaSa/IAvR3HISk3CZkkr3AMOPeM3c2SiTtWAfyzgDyz3+xYZ/6e6XPoCMBZ9tuAboB8cALKIbT5x54H2CeVBrkGOHUFHjFQNlBJ6wnVZ+AWgogA3Fg6cVymuJ1zME/kYQdT0CwgXTUpEFdmUodtCgQQjrVf2NXtMuNn2lTu18x4rxyACgO8sp+n+ts+A+Rs+a+0Z1jFfXS/ASLLGQxjJEAYlgpn1FwdN0UazloDD6wR4aQVH4GTPP+ZCUkn/MmhxtWgsu7H7O9x5fkun/hsFQKw5B+AGsGfjfc9UrDIYjukmmjatlv4taoAFduvyccFWYJIvOSdFvIo7s8Avps0ScBaE606VoVUdFvL9byO4Inc2PvhnEcC2CfL+mf7p+P//ar1dgTsEA7AmJ1gFrZ36k36tXEjV8CshFwT3tEsqBPt2rDQNqX68GNl2kfEUQGmpcQR+VSOkQJIQf2vUMorxkxdd1R+hbl6aLzmAMhCnuEZAKPmrxW+EYAFcGtpsLM9dATgUrSiMvLQbSruYArQCaKIAJxyCjgxnGN6hGLuyy55npicFuEcJZSjAD7aPwvOK46TGfPBAej4nz3959T8B8VXYMR5aK4HIACOLD8DLZvzlp2nZiAB1G1+J9pVbD8jrdR6Awts5PymQL+Pf6j6EBCCNVHN/7iV/lgq6XkWCcn1k2NmwX2UxLLHyQBeLkPGXD7x3cccQGbdP1P9UPmt5CAAqiMLOVvD8re2XkjggHXASALUWfAzl4BzKLT0wblk+kdt0vuNc6lMbBPkhtU9tMpRgfUogGaApfmi8lsdPd9S/44ASLyPQEelZwlATQqIPU/56ctB1MtEGI61slP1NybvU4LfELBXmxMZfzZGxnGkQY8HgB9rxkVM9XkK0imqfYUYqgRYAnHBEelxXzkAJwcg4EOFz9p+5hSasBPlZuGCMgIPIkwmiN50RjWg+22zDsFxHRnwR21cEKtzjADvTUx0OzMgjsY2VbEI/iq4ps+L3JiKslfPszJ2pS2exwMBZHMA+8Re709HAGxxELTtnACgWZNIa5ew/APY9c0xngno+qlBXHxfDP7tBlaOwSZjsn+GFLZJciAMOUQYRQI4dKxHBvWVJDAz9vKJz4rXAYjidiHA/sPRtQDWE4LGOwIt1e+2KxvgEsD7DPyotNPqXwQNO84ApIkxI3IJwXryMcPjnUAAVeCd1f6MaxsJgNX9WXjgKbzlCIwyX7vn3jJhpZCUAGBjRBCKTzjukoraOlfbp04iooTk04mFic4I6QiwvQkvp+XlL44cewYkZwF0uDZ1D2Ztu76VR8ZZPv5ZDxpOwwDr+X9P4ZV9b66B2HodRmgXnHEGrc8Tgz98B4GF4wJp0Bud7B+BqDu9fcxMn6hNaT+5llL/IsnNkMNMn9eZUDYC0M/5I2jXzxqowzaw9l1bZzsCl1p9I1zQJCHkhffeVH+HJBgA9HwysZYE4TA/Z/sZziECi+clPAXOKg62y5xLFHJMjZFU2ciVnA30GRJ4jD7Lxz/zVQ5AwFVa/rt3osAv5gIQ3A+25OFuenbefV6AlBLZeBb4U/hMNSLQC8gonPyzx7Xq7gapyObwfKJx4SfIOJmzjveYQM78VlW7PktU2eseCSCI9wegW5Y/SQwakDpksPYLM1juofVTQHFxE71NKGkJQmyGDTyt9qsFGeCYo8N5ZcfJtnMnsvo9smNm2mWBUHU50bFnjvvYY67H6wiAvvLLyQPgk3xWqKCFRZSdAbdti5KBilws8YrcAd70cgxfJYtAYQPI97uPEog62DbxCmNGE7UKJjx2duwz2kVjXLl/hiAihzEz5isCCFYByhzRCj0A37H92xjE1neuwtmP/V1nQBYKWfMbQ40MCKvtD5EMO6ErgBqMGQGBnWa6z37sdPujoUYUipy4f9a+R0A/c9zl277bXgXYRQABjsDUIK0Anym7DiW0m2CCaS0ZHsggafuzYO6GSwCQNkn0CwnojDESYUwFjDjcTL9osVHZTTwigCMgvu77txCAEkCy7s9IAcHI3IIGNoJwIAV0ppmwYD+4xgn9HoCpAuIQl0aDsF9nH0J6KDWo2v5DKk86zxy/QjCZtq9Tm+hcrtq/EUCn9M4LQIYwYL+x5mpABUgK8H0jgmH47IC/U38Sl1fBnwV+GryzuYILwd+GTl5ENPmyzNONkzx2xg7PklP2ujLtHqtNdJxov3YljQBEibW1t7Y34CVW/Wngt3vv9MXxB4sPd5w5CBY+6PESTvihCUzU7JzF68uCwzrnSnKudCx1MZmJUxo/itWTP+bMeWX7PEW7s46ZGSdq00IA+uYfou4DkEG9vX2W7Weqz8gBccjcAQNPRfnNuUjcCQPB6a7BZIMqBI32SfBVjhZNtm6sxPFL48HglX5XtM2OeWa7zFhWm+VbP6NPAgrYXOX3VH8fwFT9qEqg+rvq76izRxQZfEVlQXcOJ4nDBdgZY6TZKoZ6ZpLFo4iq8JZHj1Htf1X7K8bNjDnTZiCAyPLPxvs4LnUEiaW/HaifCPyReEXEkSGfM22/nO82OaKTTyP4QMOLQo/M5NdnfXWf6viZ9pk263Vm2m0hwOoAUK3NxUCBsrvEkFH9YI1AN3+zFYHki0M6UBog8bCDYcth0SUHOgW3pwxyAPiJ9wvMjp6Z7Gzsx+pXPU62/RntGgFYyt/IQVnS9au3DwHL6vc6RIjWASDIBntvOMvsSkAPwBZuuu0HQBuNUwUFPd+LwZ+diFc4kPSxyQ/52H2rx6u0z7bV7ZZvkRyAEddr694BP3IFmXyAE/NHlt8iAv2fjXju1wJ/Cvhq4AzOzDZO58y4mXxClUxObX/4IvqzyU547xqOjnGkf7VvpX2p7bd8eCIJKIpLXAFTfq322jl0feCOee00qC2HYIHfUt408GFgb26n5v0JawVmiOVUgHuDpX6E+GwqEzseLRcnXz3OzDVV+3jtl5UAEKAIOhO40WO+mZifOA5KBEG7DuCJhUADIcDkZPPUJIQDil21/dP4KXYsNs9g46HNgYGrkz1/UucRwHrMo+c527/abwwBdgLoSIAou1bjSNU98jD/81Ct/t7/IyAuRPocAH9F9be2pEM0x+l+tTEag03u11H55Zy2yTZzURUUH2xbBVDmcEfGfOy+yzfrEMBaCrzfTAbsiBwyYcGg/oSEAOu9sKi2oe2fUP3WJQnacN4XbH84lp6VB9xJZoKn25RPPD3yaQ2PAC5zEkfHP9I/03cjAAbgAegHFv9YBMEsPyqsPgcNbNaWgb+bh4QsNLHgjWV9Q4IxZoZFIubxghmWcRWZSVrgj/xwb8Df/VYZMEY/7hVjPBAAgIIqvKHGkfJ3Y0UEsl99+L4AaQcoxLmm593Z4Gfz2pvrw76kg5giBXIiV+EwHDdsEE336/efAaiZszzzuEfHWr7508k7ARXIEMjMGZhKnnkpKGnDxhu2ESWfAX8K0Jn/ZwBmgjn3E7Y/i5uIWDITM3uszFgdYV01cPVEgvZHwXP0dK46fmXc5Zs+nZcBN8BFqn10v7H8V5NMZ7kTVYHBoicBTMkgqaqhC3AaRHiJ9m8TccJZeBM4dUw2wIHrjABVmdjkJ2nDV8eJzuus/VeelzX2RgCDwnuLghxV74CbedQ3Uy5MvBQkUn53P7odreIJUFnzvdueGKdq+b3xLwF2NqE/zRxnweiDNc6VpLD+Uo0AGnjBWg92f6dVur2yNFhA59h4nEfb5+T6fw2MCPxU9ZV8mG3UXKNzn1yjnqIRZtz9RXIpinaIplkiCgd+08D9Bc4ihuUbMQRQkzXrDBAv4UNBcllR+IDK/Ejgb5MZZnVEIJ7V9J4M9EAdEUI7ZqZhVrkzZJawFslTegPvR/gFMiSxEYBW2PX7oPIROWTe+JsIHzoygS/6fDTwjiq/Bv8s8BmJAOfR2x6BxnMW1dDBIyxrTkbnt/VzGqX6PwIgjhxCX0MGXEeO9xh912t4IIAo5nfAj2o0kAaqeDLb341hHNcDf/QEoAvsI8lCA4nW5D/iAE5558ABxR/O/SDCD3a/DCuZ83q/E8HyDZ/mVAF2pCEoKcizdj5DJEIaVfAnlgJXwT/lApxS3wzoM2DLTNSK8mfHE+UvtS/A9apxM6fwlMeW81vJ5WrnsREAA/W2LQHsVMyfGKez/gr8Q1ignEXm8V8PzFXXYIHJUmY2mWbIwPq/EvWEzkzeTJuQNMgg2XEzIJwJb6rjHgp7zjrYI43D3MryX8EBWHZ+VvUtEmGAbseAGUSPWwT/2apvglntOAv0bRwDWRnAXdYmM/BkEvKpgZm8tEeC7nWH6QhgRvVdkColt9rKcT1ioC4gsP0V8LttjUnMwFkBvjXJhu2EFGcBEk3saL8cN5uHmD3PaMpnzzMax9v/GMc4cn5n9N0IANXXBWnmPQCi0Enwb8AO2mbAXwFw1fJXiKQBxLg7FYJAR8aGiyboZfvVwNFxMhN1ZoyZPplzie5hZYzXve3y9RICEBAOZJAEdQnQxpiuG3DWBWA//RnJhu5TdyskFTIDKwBPtU2qfwQGb3/Ut/utEo0TTUxczPSd6ZMF5pVjZ88hanfkHDcCiAC7HSAqFQJthi4icAlU8YMyImPtAcAOmLBtCHzCHikwR6GEvtMnVxQY6ZFD2vMt8TDTjFN5yj5Xgisa29t/BNSV4y5f/6nj04ADABNZfI8kqJor5XcVPwF+D7RybimSgF/PHDNQ5YhAPCC2vkl3EYF6VvlpP7VxZpJW+lTasntbAYLVduYcKse9evzoXJav+9RX6wBkMnUKfgH4U+VFDcTkcmANCAR/SBIF8M+CPOUUCDnijZwB9UyfDlSJmZpo0s3HTPtMm7McRMkNRcgK9s9e18HDDt03AugArx7qMfftQ0XKP+MmvD4U4HguhDi8PpV9mfUGTJFToJdrMGaGNWHO2u46iYCQjgAwC4RsuyxRZoA0c8xo3CvGjI7p3dvla4kD2Dqom06JIOsOEs8A4A9jOZCzwV9yBKpxBtSZNt01JY5h3cwzicA7p84VZGZech1AFhjZdjPneYTIop+iet7ReGed60YAFuBc9T8R/IPiF2N+Rh6RWtM+xEmIw/EmlEckacA6KnsGuL0JaO5LJv2ykztqF+2fBXV23LNApcc5cnyPCM4Yd/kv6ACyoM62q7wSTD+BaDiQlAuYLBNSIBeAGRGBSQbkTlZAf0bb4dySbqQ62TOTNtPGDVkIarJjnkkCR45Z/V1nHMPa5xUBwEQ/TfnhF3DHJC8TYa7gKPhLqg8Hi4Bd3W9ZbDZhzgB3ZYx2bs7szUzsqM3R/Y/pBqJzPZM0HgP4eD0bAaTi/WxeoBDvD6SQIAzG/K1bslJgEUF3o48+XUhi32EiFev8WYKYAjzOPBCDSFkicHj7o75Zlc+MQy4vurS2vzp+9ryvtveZ81i+5lPGMiBT3zRJ7J3Tig9UHvVxHYC6SxmQm22csVwC2q8lcgTbGGRWHQF4tq83KbYxjNkegWAW6NG4mUk84wYyx50Zt3K+FgFUzu2o+9gIIALeVeBHuxmdQxb8VeAP48IAEZCn9zvHsCZQFuDZdvQ4CeWPJudTE0F0fjNOoDLmEQKoHmfmWjRhLF8dOQA1KVygFpKDrwP4B7IwgDkNdOYIDJBlgXt2O7wPenJEE3IG7DN9qhM9Ou8rx5slgMo5zzoT5hY2AjBBfTL48cfZhs6+OhzOvANtArBpR5AA5mEiIHc5GjPrCLLEcIXyW5O3uj07sTNgybTJgjU7Vna8KtEebe/1X/6z5QAmwT+AnL1g9CD4hTzcsMAiDba9mPCLQEv3G2RlTfoMoDNtvEnZ+quBZlR6Buwzx7lCvTMAz7SZIYDsuFlyZCrvnddGAIMDCMDfgbxCFIkKgUcg2q6m1X3/VWj7yTUD7Ec1iSHhLrJEcAT0dLIVKxHRRKwSQQSAq/dH15PdX2030z76LRj4oz7LV2kHQJRqIAgB1GOD31DRChF0bR3lM8GcKO91fYvuwmJr73y8yeQSRlL5zwL1rOJHk/jo/oxyR8e4GtDZ41fPoyeAQhKvVBk4Q/kD8FdIYLvhCTLxQozIAWzDBwCLQB3tj87BnQwTyl8hgkrbzKSNAHD1/gxJZNtkrhfVPLo2rfyV9hsBlMH8RMpfBjn8MpbyZ8asEEEbT/1GFZWOgB/tD13EBcpfBfwVbiCa+FfvrwA7OpfKWLNksZ7D8p8+lFwI9AS2H1U0A1Rp47YlwLTaTwF/7xSB9Oj+I+pfeX15SCYGyWYm5etGAhlQPmabqxwFjrsRgAaO+f0k5ccTcI+dBGuaHJLjReByCSNQ16PAj/qHgIUBKqrN2h7tH6ncFQQRgSoCeLQ/Gj+65gxxasufPSZrt/zHrAN4jcCfBjyG4RPPCZQdgAOuCLgeqUSEFIIeZt0VQD46pjeBryCBCMRX788CNjqPCplYx9wIIHQAB8GfVvwT3gNAgTQBflflme0l7qJCIDMgzwCvtQmcSZpECi82rTiECBTVsWbHi/pl9kdtzgT20bGW/xA5gNcc/K4bOAh8D8DdD3/kPygplhVLoL9Q+TPnESlUFdTV9rPOIgLw0f1HQRv9rjpE8I63EYDpAF5D8LuAP2j5o7GpSkMn/UNXvlfaZtxCa3Oh8lcAWWk7C9yzjpEFmAes2X3ZY2dIKNNm+feWA3hC8FeASNuS9QxZNbeOTfur38i6edkxI2BnVFc7kyPWPnO8yvhntI0m9WOSwBGQRy7g6P4skWwEMDiASfDjzTFdxX5m3f4CYCNyyCzwicZIkQUBv6fiFYWvtDVB9cjKnyWLqrqfBehZsM4CcbZfFrjR+BFRynGWf6cdwCT4GahSJBCAPwJrtx++6GOnQK3icVO5T3p+oAL0qG13fYScvImVAW/p+CoIzYxfPb8qkUSAuIIgZseMzjWzP9NmPb+NABpYXgPwlwAPE02vZjwT8BHJsMn7ZG6AzLoMAM9qU7H5Z6j7GWNkVLd6nCwAFVe2r5HCn7V/+crVAVSeAUALbyjhrPJ7LsIC9NaHKN4lDsBQVtMpOI7CIyg2ebxjzKr/DOgzfSok8NhtI2CeCfQjID3SN7pG3L985cvEOgAE/ZFXfSceCio7AMO1uIShriflFhySqQL2DMKgx0yofwbAnnupALYCpsx5PUaY8H4ILSoAjxzG8hUvi88C7Ee3VB5PjrZJuA02BgVp4EBSwM7E/cn1BBVV90A2tQ86RQCOCCuz/ygRZAF/lETOBLSnypXz9Igssy8igIp7WP7tTgAhcCfVuyOBE8DfLq4A/shVuERhAGsKpBeFBNH/gmRNqogoov2PRQJHj/MYJDBDDkeAPHs8fcxGAJaiVwHMwLZtS4Df7Kst+8HKgQX44fj7hizYz24XKbH8rmjzItAe3R+dU9WmZ53AB5UEZoE8228ggH+TdQAFADMgpQhGAZ0SAlHkSOGj/VZ4MRNCZPvMtuv6JQgqA9gqKWTBmAV3tl32uGcpvgWy6vZZpT8L5CgQlAA85a2qtwZ6RflDB5AEfwT4aL+21Fb7LIhn+kfAzfzHIhVgR22j8zmq/BVQZc61SgKV41fH9n6bWXI4q9/y5SoJiAMfBb9Xm7ccwXB8cQVE7QayIW8groI0s5KwOmYEHm9Cm/suUP+MEp/V5oiaV8B6VdsZEphR9Jk+FXLYCMAE0oTtb2OpCZoBq+kAjLFMsgDP4x33TOsfugohMnJuEUEM56lmRaSIV+/PnP8RwGfHrxzjyrZnksPlBPBlRhlwxrpnwW8CnWXJC0RymBCS5b4zwV5Wf+hwBNhH+lqW9rHdwVF1P9r/dQZ6ljiWlQC0SjIbPLRRilYFv0cC7Yc9WOrLAFWf94y9n+ljnZurdie8YnzquMS9PAUJHAVshqCs63oMsFeuzzvPaB8eZ/lS7QCU4jJVNckgUGurH1XuiVJfilSYFTdUtUIgR0nA67/tU7OjouBll2GEKVnQZ4EWXUPFps8es3KM15EEskoPt3T7KP02AojUO0UCk+CnoCWAzII7Au2w3yG8o6COzoUBioKCnKPrFBjJqRlQcQLVY2WJIjNuBaCvIwlUVX0G0NVjdATwMXEAAYBdEnhC8Ecgc/efGPNH5xFNdhOQRdt/ptpHCh3tj675CFE8JTFUjv2UriFz7GUlgOp/DNKRwUHwdxPfUeMjDoCCq5BfOOoEZvpr2x+BLavolXEyAM6obnTMzHEqoMuc09HxKv2rbTPAVYZO/ydUbXfkKP4/BnecprBuissAAAAASUVORK5CYII=",e.TextureTools=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._mode=t.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(t.prototype,"name",{get:function(){return"Framing"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(i){var r=this;this._attachedCamera=i;var n=this._attachedCamera.getScene();t.EasingFunction.setEasingMode(t.EasingMode),this._onPrePointerObservableObserver=n.onPrePointerObservable.add(function(t){if(t.type===e.PointerEventTypes.POINTERDOWN)return void(r._isPointerDown=!0);t.type===e.PointerEventTypes.POINTERUP&&(r._isPointerDown=!1)}),this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(e){e&&r.zoomOnMesh(e)}),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add(function(){r._applyUserInteraction(),r._maintainCameraAboveGround()})},t.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},t.prototype.zoomOnMesh=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(r.minimumWorld,r.maximumWorld,t,i)},t.prototype.zoomOnMeshHierarchy=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=null),e.computeWorldMatrix(!0);var r=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(r.min,r.max,t,i)},t.prototype.zoomOnMeshesHierarchy=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var n=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=0;s<t.length;s++){var a=t[s].getHierarchyBoundingVectors(!0);e.Tools.CheckExtends(a.min,n,o),e.Tools.CheckExtends(a.max,n,o)}this.zoomOnBoundingInfo(n,o,i,r)},t.prototype.zoomOnBoundingInfo=function(i,r,n,o){var s=this;void 0===n&&(n=!1),void 0===o&&(o=null);var a;if(this._attachedCamera){var l=i.y,h=r.y,c=l+(h-l)*this._positionScale,u=r.subtract(i).scale(.5);if(n)a=new e.Vector3(0,c,0);else{var f=i.add(u);a=new e.Vector3(f.x,c,f.z)}this._vectorTransition||(this._vectorTransition=e.Animation.CreateAnimation("target",e.Animation.ANIMATIONTYPE_VECTOR3,60,t.EasingFunction)),this._betaIsAnimating=!0;var d=e.Animation.TransitionTo("target",a,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);var p=0;if(this._mode===t.FitFrustumSidesMode){var m=this._calculateLowerRadiusFromModelBoundingSphere(i,r);this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.minZ,p=m}else this._mode===t.IgnoreBoundsSizeMode&&(p=this._calculateLowerRadiusFromModelBoundingSphere(i,r),null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));var g=r.subtract(i).length();this._attachedCamera.panningSensibility=5e3/g,this._attachedCamera.wheelPrecision=100/p,this._radiusTransition||(this._radiusTransition=e.Animation.CreateAnimation("radius",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),d=e.Animation.TransitionTo("radius",p,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){o&&o(),s._attachedCamera&&s._attachedCamera.storeState()}),d&&this._animatables.push(d)}},t.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,i){var r=i.subtract(e),n=r.length(),o=this._getFrustumSlope(),s=.5*n,a=s*this._radiusScale,l=a*Math.sqrt(1+1/(o.x*o.x)),h=a*Math.sqrt(1+1/(o.y*o.y)),c=Math.max(l,h),u=this._attachedCamera;return u?(u.lowerRadiusLimit&&this._mode===t.IgnoreBoundsSizeMode&&(c=c<u.lowerRadiusLimit?u.lowerRadiusLimit:c),u.upperRadiusLimit&&(c=c>u.upperRadiusLimit?u.upperRadiusLimit:c),c):0},t.prototype._maintainCameraAboveGround=function(){var i=this;if(!(this._elevationReturnTime<0)){var r=e.Tools.Now-this._lastInteractionTime,n=.5*Math.PI-this._defaultElevation,o=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>o&&r>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=e.Animation.CreateAnimation("beta",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction));var s=e.Animation.TransitionTo("beta",n,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){i._clearAnimationLocks(),i.stopAllAnimations()});s&&this._animatables.push(s)}}},t.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return e.Vector2.Zero();var i=t.getScene().getEngine(),r=i.getAspectRatio(t),n=Math.tan(t.fov/2),o=n*r;return new e.Vector2(o,n)},t.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},t.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=e.Tools.Now,this.stopAllAnimations(),this._clearAnimationLocks())},t.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(t.prototype,"isUserIsMoving",{get:function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},enumerable:!0,configurable:!0}),t}();t.EasingFunction=new e.ExponentialEase,t.EasingMode=e.EasingFunction.EASINGMODE_EASEINOUT,t.IgnoreBoundsSizeMode=0,t.FitFrustumSidesMode=1,e.FramingBehavior=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(t.prototype,"name",{get:function(){return"Bouncing"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var i=this._attachedCamera;i&&(e?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(e){if(e){e.computeWorldMatrix(!0);var i=e.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=.05*i,t.upperRadiusTransitionRange=.05*i}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._attachedCamera&&(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},t.prototype.detach=function(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},t.prototype._isRadiusAtLimit=function(e){return!!this._attachedCamera&&(this._attachedCamera.radius===e&&!this._radiusIsAnimating)},t.prototype._applyBoundRadiusAnimation=function(i){var r=this;if(this._attachedCamera){this._radiusBounceTransition||(t.EasingFunction.setEasingMode(t.EasingMode),this._radiusBounceTransition=e.Animation.CreateAnimation("radius",e.Animation.ANIMATIONTYPE_FLOAT,60,t.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var n=e.Animation.TransitionTo("radius",this._attachedCamera.radius+i,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return r._clearAnimationLocks()});n&&this._animatables.push(n)}},t.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},t.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},t}();t.EasingFunction=new e.BackEase(.3),t.EasingMode=e.EasingFunction.EASINGMODE_EASEOUT,e.BouncingBehavior=t}(r||(r={}));var r;!function(e){var t=function(){function t(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(t.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.attach=function(t){var i=this;this._attachedCamera=t;var r=this._attachedCamera.getScene();this._onPrePointerObservableObserver=r.onPrePointerObservable.add(function(t){if(t.type===e.PointerEventTypes.POINTERDOWN)return void(i._isPointerDown=!0);t.type===e.PointerEventTypes.POINTERUP&&(i._isPointerDown=!1)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){var t=e.Tools.Now,r=0;null!=i._lastFrameTime&&(r=t-i._lastFrameTime),i._lastFrameTime=t,i._applyUserInteraction();var n=t-i._lastInteractionTime-i._idleRotationWaitTime,o=Math.max(Math.min(n/i._idleRotationSpinupTime,1),0);i._cameraRotationSpeed=i._idleRotationSpeed*o,i._attachedCamera&&(i._attachedCamera.alpha-=i._cameraRotationSpeed*(r/1e3))})},t.prototype.detach=function(){if(this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},t.prototype._userIsZooming=function(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset},t.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},t.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=e.Tools.Now)},t.prototype._userIsMoving=function(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)},t}();e.AutoRotationBehavior=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this.renderWidth=512,this.renderHeight=256,this.textureSize=512,this.deterministicLockstep=!1,this.lockstepMaxSteps=4}return e}();e.NullEngineOptions=t;var i=function(i){function r(r){void 0===r&&(r=new t);var n=i.call(this,null)||this;return void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),n._options=r,n._caps=new e.EngineCapabilities,n._caps.maxTexturesImageUnits=16,n._caps.maxVertexTextureImageUnits=16,n._caps.maxTextureSize=512,n._caps.maxCubemapTextureSize=512,n._caps.maxRenderTextureSize=512,n._caps.maxVertexAttribs=16,n._caps.maxVaryingVectors=16,n._caps.maxFragmentUniformVectors=16,n._caps.maxVertexUniformVectors=16,n._caps.standardDerivatives=!1,n._caps.astc=null,n._caps.s3tc=null,n._caps.pvrtc=null,n._caps.etc1=null,n._caps.etc2=null,n._caps.textureAnisotropicFilterExtension=null,n._caps.maxAnisotropy=0,n._caps.uintIndices=!1,n._caps.fragmentDepthSupported=!1,n._caps.highPrecisionShaderSupported=!0,n._caps.colorBufferFloat=!1,n._caps.textureFloat=!1,n._caps.textureFloatLinearFiltering=!1,n._caps.textureFloatRender=!1,n._caps.textureHalfFloat=!1,n._caps.textureHalfFloatLinearFiltering=!1,n._caps.textureHalfFloatRender=!1,n._caps.textureLOD=!1,n._caps.drawBuffersExtension=!1,n._caps.depthTextureExtension=!1,n._caps.vertexArrayObject=!1,n._caps.instancedArrays=!1,e.Tools.Log("Babylon.js null engine (v"+e.Engine.Version+") launched"),"undefined"==typeof URL&&(URL={createObjectURL:function(){},revokeObjectURL:function(){}}),"undefined"==typeof Blob&&(Blob=function(){}),n}return o(r,i),r.prototype.isDeterministicLockStep=function(){return this._options.deterministicLockstep},r.prototype.getLockstepMaxSteps=function(){return this._options.lockstepMaxSteps},r.prototype.createVertexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},r.prototype.createIndexBuffer=function(e){return{capacity:0,references:1,is32Bits:!1}},r.prototype.clear=function(e,t,i,r){void 0===r&&(r=!1)},r.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._options.renderWidth},r.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._options.renderHeight},r.prototype.setViewport=function(e,t,i){this._cachedViewport=e},r.prototype.createShaderProgram=function(e,t,i,r){return{transformFeedback:null,__SPECTOR_rebuildProgram:null}},r.prototype.getUniforms=function(e,t){return[]},r.prototype.getAttributes=function(e,t){return[]},r.prototype.bindSamplers=function(e){this._currentEffect=null},r.prototype.enableEffect=function(e){this._currentEffect=e,e.onBind&&e.onBind(e),e.onBindObservable.notifyObservers(e)},r.prototype.setState=function(e,t,i,r){void 0===t&&(t=0),void 0===r&&(r=!1)},r.prototype.setIntArray=function(e,t){},r.prototype.setIntArray2=function(e,t){},r.prototype.setIntArray3=function(e,t){},r.prototype.setIntArray4=function(e,t){},r.prototype.setFloatArray=function(e,t){},r.prototype.setFloatArray2=function(e,t){},r.prototype.setFloatArray3=function(e,t){},r.prototype.setFloatArray4=function(e,t){},r.prototype.setArray=function(e,t){},r.prototype.setArray2=function(e,t){},r.prototype.setArray3=function(e,t){},r.prototype.setArray4=function(e,t){},r.prototype.setMatrices=function(e,t){},r.prototype.setMatrix=function(e,t){},r.prototype.setMatrix3x3=function(e,t){},r.prototype.setMatrix2x2=function(e,t){},r.prototype.setFloat=function(e,t){},r.prototype.setFloat2=function(e,t,i){},r.prototype.setFloat3=function(e,t,i,r){},r.prototype.setBool=function(e,t){},r.prototype.setFloat4=function(e,t,i,r,n){},r.prototype.setColor3=function(e,t){},r.prototype.setColor4=function(e,t,i){},r.prototype.setAlphaMode=function(t,i){void 0===i&&(i=!1),this._alphaMode!==t&&(this._alphaState.alphaBlend=t!==e.Engine.ALPHA_DISABLE,i||this.setDepthWrite(t===e.Engine.ALPHA_DISABLE),this._alphaMode=t)},r.prototype.bindBuffers=function(e,t,i){},r.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames||(this.resetTextureCache(),this._currentEffect=null,e&&(this._currentProgram=null,this._stencilState.reset(),this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset()),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},r.prototype.draw=function(e,t,i,r){},r.prototype._createTexture=function(){return{}},r.prototype.createTexture=function(t,i,r,n,o,s,a,l,h,c){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===s&&(s=null),void 0===a&&(a=null),void 0===l&&(l=null);var u=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_URL),f=String(t);return u.url=f,u.generateMipMaps=!i,u.samplingMode=o,u.invertY=r,u.baseWidth=this._options.textureSize,u.baseHeight=this._options.textureSize,u.width=this._options.textureSize,u.height=this._options.textureSize,c&&(u.format=c),u.isReady=!0,s&&s(),u},r.prototype.createRenderTargetTexture=function(t,i){var r=new e.RenderTargetCreationOptions;void 0!==i&&"object"==typeof i?(r.generateMipMaps=i.generateMipMaps,r.generateDepthBuffer=void 0===i.generateDepthBuffer||i.generateDepthBuffer,r.generateStencilBuffer=r.generateDepthBuffer&&i.generateStencilBuffer,r.type=void 0===i.type?e.Engine.TEXTURETYPE_UNSIGNED_INT:i.type,r.samplingMode=void 0===i.samplingMode?e.Texture.TRILINEAR_SAMPLINGMODE:i.samplingMode):(r.generateMipMaps=i,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=e.Engine.TEXTURETYPE_UNSIGNED_INT,r.samplingMode=e.Texture.TRILINEAR_SAMPLINGMODE);var n=new e.InternalTexture(this,e.InternalTexture.DATASOURCE_RENDERTARGET),o=t.width||t,s=t.height||t;return n._depthStencilBuffer={},n._framebuffer={},n.baseWidth=o,n.baseHeight=s,n.width=o,n.height=s,n.isReady=!0,n.samples=1,n.generateMipMaps=!!r.generateMipMaps,n.samplingMode=r.samplingMode,n.type=r.type,n._generateDepthBuffer=r.generateDepthBuffer,n._generateStencilBuffer=!!r.generateStencilBuffer,n},r.prototype.updateTextureSamplingMode=function(e,t){t.samplingMode=e},r.prototype.bindFramebuffer=function(e,t,i,r,n){this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._currentFramebuffer=e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer,this._cachedViewport&&!n&&this.setViewport(this._cachedViewport,i,r)},r.prototype.unBindFramebuffer=function(e,t,i){void 0===t&&(t=!1),this._currentRenderTarget=null,i&&(e._MSAAFramebuffer&&(this._currentFramebuffer=e._framebuffer),i()),this._currentFramebuffer=null},r.prototype.createDynamicVertexBuffer=function(e){return{capacity:1,references:1,is32Bits:!1}},r.prototype.updateDynamicIndexBuffer=function(e,t,i){void 0===i&&(i=0)},r.prototype.updateDynamicVertexBuffer=function(e,t,i,r){},r.prototype._bindTextureDirectly=function(e,t){this._boundTexturesCache[this._activeTextureChannel]!==t&&(this._boundTexturesCache[this._activeTextureChannel]=t)},r.prototype._bindTexture=function(e,t){e<0||this._bindTextureDirectly(0,t)},r.prototype._releaseBuffer=function(e){return 0===--e.references},r}(e.Engine);e.NullEngine=i}(r||(r={}));var r;!function(e){var t=function(){function t(t){this.engine=t,this._captureGPUFrameTime=!1,this._gpuFrameTime=new e.PerfCounter,this._captureShaderCompilationTime=!1,this._shaderCompilationTime=new e.PerfCounter,this._onBeginFrameObserver=null,this._onEndFrameObserver=null,this._onBeforeShaderCompilationObserver=null,this._onAfterShaderCompilationObserver=null}return Object.defineProperty(t.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureGPUFrameTime",{get:function(){return this._captureGPUFrameTime},set:function(e){var t=this;e!==this._captureGPUFrameTime&&(this._captureGPUFrameTime=e,e?(this._onBeginFrameObserver=this.engine.onBeginFrameObservable.add(function(){t._gpuFrameTimeToken||(t._gpuFrameTimeToken=t.engine.startTimeQuery())}),this._onEndFrameObserver=this.engine.onEndFrameObservable.add(function(){if(t._gpuFrameTimeToken){var e=t.engine.endTimeQuery(t._gpuFrameTimeToken);e>-1&&(t._gpuFrameTimeToken=null,t._gpuFrameTime.fetchNewFrame(),t._gpuFrameTime.addCount(e,!0))}})):(this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shaderCompilationTimeCounter",{get:function(){return this._shaderCompilationTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureShaderCompilationTime",{get:function(){return this._captureShaderCompilationTime},set:function(e){var t=this;e!==this._captureShaderCompilationTime&&(this._captureShaderCompilationTime=e,e?(this._onBeforeShaderCompilationObserver=this.engine.onBeforeShaderCompilationObservable.add(function(){t._shaderCompilationTime.fetchNewFrame(),t._shaderCompilationTime.beginMonitoring()}),this._onAfterShaderCompilationObserver=this.engine.onAfterShaderCompilationObservable.add(function(){t._shaderCompilationTime.endMonitoring()})):(this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.engine.onBeginFrameObservable.remove(this._onBeginFrameObserver),this._onBeginFrameObserver=null,this.engine.onEndFrameObservable.remove(this._onEndFrameObserver),this._onEndFrameObserver=null,this.engine.onBeforeShaderCompilationObservable.remove(this._onBeforeShaderCompilationObserver),this._onBeforeShaderCompilationObserver=null,this.engine.onAfterShaderCompilationObservable.remove(this._onAfterShaderCompilationObserver),this._onAfterShaderCompilationObserver=null,this.engine=null},t}();e.EngineInstrumentation=t}(r||(r={}));var r;!function(e){var t=function(){function t(t){var i=this;this.scene=t,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new e.PerfCounter,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new e.PerfCounter,this._captureFrameTime=!1,this._frameTime=new e.PerfCounter,this._captureRenderTime=!1,this._renderTime=new e.PerfCounter,this._captureInterFrameTime=!1,this._interFrameTime=new e.PerfCounter,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new e.PerfCounter,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new e.PerfCounter,this._capturePhysicsTime=!1,this._physicsTime=new e.PerfCounter,this._captureAnimationsTime=!1,this._animationsTime=new e.PerfCounter,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeAnimationsObserver=t.onBeforeAnimationsObservable.add(function(){i._captureActiveMeshesEvaluationTime&&i._activeMeshesEvaluationTime.fetchNewFrame(),i._captureRenderTargetsRenderTime&&i._renderTargetsRenderTime.fetchNewFrame(),i._captureFrameTime&&(e.Tools.StartPerformanceCounter("Scene rendering"),i._frameTime.beginMonitoring()),i._captureInterFrameTime&&i._interFrameTime.endMonitoring(),i._captureParticlesRenderTime&&i._particlesRenderTime.fetchNewFrame(),i._captureSpritesRenderTime&&i._spritesRenderTime.fetchNewFrame(),i._captureAnimationsTime&&i._animationsTime.beginMonitoring(),i.scene.getEngine()._drawCalls.fetchNewFrame()}),this._onAfterRenderObserver=t.onAfterRenderObservable.add(function(){i._captureFrameTime&&(e.Tools.EndPerformanceCounter("Scene rendering"),i._frameTime.endMonitoring()),i._captureRenderTime&&i._renderTime.endMonitoring(!1),i._captureInterFrameTime&&i._interFrameTime.beginMonitoring()})}return Object.defineProperty(t.prototype,"activeMeshesEvaluationTimeCounter",{get:function(){return this._activeMeshesEvaluationTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureActiveMeshesEvaluationTime",{get:function(){return this._captureActiveMeshesEvaluationTime},set:function(t){var i=this;t!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=t,t?(this._onBeforeActiveMeshesEvaluationObserver=this.scene.onBeforeActiveMeshesEvaluationObservable.add(function(){e.Tools.StartPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.beginMonitoring()}),this._onAfterActiveMeshesEvaluationObserver=this.scene.onAfterActiveMeshesEvaluationObservable.add(function(){e.Tools.EndPerformanceCounter("Active meshes evaluation"),i._activeMeshesEvaluationTime.endMonitoring()})):(this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetsRenderTimeCounter",{get:function(){return this._renderTargetsRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTargetsRenderTime",{get:function(){return this._captureRenderTargetsRenderTime},set:function(t){var i=this;t!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=t,t?(this._onBeforeRenderTargetsRenderObserver=this.scene.OnBeforeRenderTargetsRenderObservable.add(function(){e.Tools.StartPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.beginMonitoring()}),this._onAfterRenderTargetsRenderObserver=this.scene.OnAfterRenderTargetsRenderObservable.add(function(){e.Tools.EndPerformanceCounter("Render targets rendering"),i._renderTargetsRenderTime.endMonitoring(!1)})):(this.scene.OnBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.OnAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"particlesRenderTimeCounter",{get:function(){return this._particlesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureParticlesRenderTime",{get:function(){return this._captureParticlesRenderTime},set:function(t){var i=this;t!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=t,t?(this._onBeforeParticlesRenderingObserver=this.scene.onBeforeParticlesRenderingObservable.add(function(){e.Tools.StartPerformanceCounter("Particles"),i._particlesRenderTime.beginMonitoring()}),this._onAfterParticlesRenderingObserver=this.scene.onAfterParticlesRenderingObservable.add(function(){e.Tools.EndPerformanceCounter("Particles"),i._particlesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spritesRenderTimeCounter",{get:function(){return this._spritesRenderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureSpritesRenderTime",{get:function(){return this._captureSpritesRenderTime},set:function(t){var i=this;t!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=t,t?(this._onBeforeSpritesRenderingObserver=this.scene.onBeforeSpritesRenderingObservable.add(function(){e.Tools.StartPerformanceCounter("Sprites"),i._spritesRenderTime.beginMonitoring()}),this._onAfterSpritesRenderingObserver=this.scene.onAfterSpritesRenderingObservable.add(function(){e.Tools.EndPerformanceCounter("Sprites"),i._spritesRenderTime.endMonitoring(!1)})):(this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physicsTimeCounter",{get:function(){return this._physicsTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capturePhysicsTime",{get:function(){return this._capturePhysicsTime},set:function(t){var i=this;t!==this._capturePhysicsTime&&(this._capturePhysicsTime=t,t?(this._onBeforePhysicsObserver=this.scene.onBeforePhysicsObservable.add(function(){e.Tools.StartPerformanceCounter("Physics"),i._physicsTime.beginMonitoring()}),this._onAfterPhysicsObserver=this.scene.onAfterPhysicsObservable.add(function(){e.Tools.EndPerformanceCounter("Physics"),i._physicsTime.endMonitoring()})):(this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationsTimeCounter",{get:function(){return this._animationsTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureAnimationsTime",{get:function(){return this._captureAnimationsTime},set:function(e){var t=this;e!==this._captureAnimationsTime&&(this._captureAnimationsTime=e,e?this._onAfterAnimationsObserver=this.scene.onAfterAnimationsObservable.add(function(){t._animationsTime.endMonitoring()}):(this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameTimeCounter",{get:function(){return this._frameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureFrameTime",{get:function(){return this._captureFrameTime},set:function(e){this._captureFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"interFrameTimeCounter",{get:function(){return this._interFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureInterFrameTime",{get:function(){return this._captureInterFrameTime},set:function(e){this._captureInterFrameTime=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var i=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeforeDrawPhaseObserver=this.scene.onBeforeDrawPhaseObservable.add(function(){i._renderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Main render")}),this._onAfterDrawPhaseObserver=this.scene.onAfterDrawPhaseObservable.add(function(){i._renderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Main render")})):(this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawCallsCounter",{get:function(){return this.scene.getEngine()._drawCalls},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.scene.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.scene.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.scene.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.scene.OnBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.scene.OnAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.scene.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.scene.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this.scene.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.scene.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null,this.scene.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.scene.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this.scene.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.scene.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null,this.scene.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.scene=null},t}();e.SceneInstrumentation=t}(r||(r={}));var r;!function(e){var t=function(){function e(){this._timeElapsedQueryEnded=!1}return e}();e._TimeToken=t}(r||(r={}));var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.GAMMADIFFUSE=!1,t.DIFFUSEHASALPHA=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONBLUR=!1,t.REFLECTIONFRESNEL=!1,t.REFLECTIONFALLOFF=!1,t.TEXTURELODSUPPORT=!1,t.PREMULTIPLYALPHA=!1,t.USERGBCOLOR=!1,t.NOISE=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.MAINUV1=!1,t.MAINUV2=!1,t.UV1=!1,t.UV2=!1,t.CLIPPLANE=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SHADOWFLOAT=!1,t.rebuild(),t}return o(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.primaryColor=e.Color3.White(),n.primaryLevel=1,n.secondaryColor=e.Color3.Gray(),n.secondaryLevel=1,n.tertiaryColor=e.Color3.Black(),n.tertiaryLevel=1,n.reflectionTexture=null,n.reflectionBlur=0,n.diffuseTexture=null,n._shadowLights=null,n.shadowLights=null,n.shadowBlurScale=1,n.shadowLevel=0,n.sceneCenter=e.Vector3.Zero(),n.opacityFresnel=!0,n.reflectionFresnel=!1,n.reflectionFalloffDistance=0,n.reflectionAmount=1,n.reflectionReflectance0=.05,n.reflectionReflectance90=.5,n.useRGBColor=!0,n.enableNoise=!1,n._maxSimultaneousLights=4,n.maxSimultaneousLights=4,n._imageProcessingObserver=null,n._renderTargets=new e.SmartArray(16),n._reflectionControls=e.Vector4.Zero(),n._attachImageProcessingConfiguration(null),n.getRenderTargetTextures=function(){return n._renderTargets.reset(),n._diffuseTexture&&n._diffuseTexture.isRenderTarget&&n._renderTargets.push(n._diffuseTexture),n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),n._renderTargets},n}return o(r,i),Object.defineProperty(r.prototype,"reflectionStandardFresnelWeight",{set:function(e){var t=e;t<.5?(t*=2,this.reflectionReflectance0=r.standardReflectance0*t,this.reflectionReflectance90=r.standardReflectance90*t):(t=2*t-1,this.reflectionReflectance0=r.standardReflectance0+(1-r.standardReflectance0)*t,this.reflectionReflectance90=r.standardReflectance90+(1-r.standardReflectance90)*t)},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(e){t._markAllSubMeshesAsImageProcessingDirty()}))},Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this.imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorCurves",{get:function(){return this.imageProcessingConfiguration.colorCurves},set:function(e){this.imageProcessingConfiguration.colorCurves=e},enumerable:!0,configurable:!0}),r.prototype.needAlphaTesting=function(){return!0},r.prototype.needAlphaBlending=function(){return this.alpha<0||null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},r.prototype.isReadyForSubMesh=function(i,r,n){var o=this;if(void 0===n&&(n=!1),r.effect&&this.isFrozen&&this._wasPreviouslyReady)return!0;r._materialDefines||(r._materialDefines=new t);var s=this.getScene(),a=r._materialDefines;if(!this.checkReadyOnEveryCall&&r.effect&&a._renderId===s.getRenderId())return!0;var l=s.getEngine();if(e.MaterialHelper.PrepareDefinesForLights(s,i,a,!1,this._maxSimultaneousLights),a._needNormals=!0,a._areTexturesDirty){if(a._needUVs=!1,s.texturesEnabled){if(s.getEngine().getCaps().textureLOD&&(a.TEXTURELODSUPPORT=!0),this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;e.MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,a,"DIFFUSE"),a.DIFFUSEHASALPHA=this._diffuseTexture.hasAlpha,a.GAMMADIFFUSE=this._diffuseTexture.gammaSpace,a.OPACITYFRESNEL=this._opacityFresnel}else a.DIFFUSE=!1,a.DIFFUSEHASALPHA=!1,a.GAMMADIFFUSE=!1,a.OPACITYFRESNEL=!1;var h=this._reflectionTexture;if(h&&e.StandardMaterial.ReflectionTextureEnabled){if(!h.isReadyOrNotBlocking())return!1;switch(a.REFLECTION=!0,a.GAMMAREFLECTION=h.gammaSpace,a.REFLECTIONBLUR=this._reflectionBlur>0,a.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!h.invertZ:h.invertZ,a.LODINREFLECTIONALPHA=h.lodLevelInAlpha,h.coordinatesMode===e.Texture.INVCUBIC_MODE&&(a.INVERTCUBICMAP=!0),a.REFLECTIONMAP_3D=h.isCube,h.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:a.REFLECTIONMAP_CUBIC=!0;break;case e.Texture.EXPLICIT_MODE:a.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:a.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:a.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:a.REFLECTIONMAP_SKYBOX=!0;break;case e.Texture.SPHERICAL_MODE:a.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0}this.reflectionFresnel?(a.REFLECTIONFRESNEL=!0,a.REFLECTIONFALLOFF=this.reflectionFalloffDistance>0,this._reflectionControls.x=this.reflectionAmount,this._reflectionControls.y=this.reflectionReflectance0,this._reflectionControls.z=this.reflectionReflectance90,this._reflectionControls.w=1/this.reflectionFalloffDistance):(a.REFLECTIONFRESNEL=!1,a.REFLECTIONFALLOFF=!1)}else a.REFLECTION=!1,a.REFLECTIONFALLOFF=!1,a.REFLECTIONBLUR=!1,a.REFLECTIONMAP_3D=!1,a.REFLECTIONMAP_SPHERICAL=!1,a.REFLECTIONMAP_PLANAR=!1,a.REFLECTIONMAP_CUBIC=!1,a.REFLECTIONMAP_PROJECTION=!1,a.REFLECTIONMAP_SKYBOX=!1,a.REFLECTIONMAP_EXPLICIT=!1,a.REFLECTIONMAP_EQUIRECTANGULAR=!1,a.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,a.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,a.INVERTCUBICMAP=!1,a.REFLECTIONMAP_OPPOSITEZ=!1,a.LODINREFLECTIONALPHA=!1,a.GAMMAREFLECTION=!1}a.PREMULTIPLYALPHA=this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED||this.alphaMode===e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,a.USERGBCOLOR=this._useRGBColor,a.NOISE=this._enableNoise}if(a._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a)}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,a),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,l,a,n,!1),e.MaterialHelper.PrepareDefinesForAttributes(i,a,!1,!0,!1)&&i&&(s.getEngine().getCaps().standardDerivatives||i.isVerticesDataPresent(e.VertexBuffer.NormalKind)||(i.createNormals(!0),e.Tools.Warn("BackgroundMaterial: Normals have been created for the mesh: "+i.name))),a.isDirty){a.markAsProcessed(),s.resetCachedMaterial();var c=new e.EffectFallbacks;a.FOG&&c.addFallback(0,"FOG"),a.POINTSIZE&&c.addFallback(1,"POINTSIZE"),e.MaterialHelper.HandleFallbacksForShadows(a,c,this._maxSimultaneousLights),a.NUM_BONE_INFLUENCERS>0&&c.addCPUSkinningFallback(0,i);var u=[e.VertexBuffer.PositionKind];a.NORMAL&&u.push(e.VertexBuffer.NormalKind),a.UV1&&u.push(e.VertexBuffer.UVKind),a.UV2&&u.push(e.VertexBuffer.UV2Kind),e.MaterialHelper.PrepareAttributesForBones(u,i,a,c),e.MaterialHelper.PrepareAttributesForInstances(u,a);var f=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","vClipPlane","mBones","vPrimaryColor","vSecondaryColor","vTertiaryColor","vReflectionInfos","reflectionMatrix","vReflectionMicrosurfaceInfos","shadowLevel","alpha","vBackgroundCenter","vReflectionControl","vDiffuseInfos","diffuseMatrix"],d=["diffuseSampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh"],p=["Material","Scene"];e.ImageProcessingConfiguration.PrepareUniforms(f,a),e.ImageProcessingConfiguration.PrepareSamplers(d,a),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:a,maxSimultaneousLights:this._maxSimultaneousLights});var m=function(e){o.onCompiled&&o.onCompiled(e),o.bindSceneUniformBuffer(e,s.getSceneUniformBuffer())},g=a.toString();r.setEffect(s.getEngine().createEffect("background",{attributes:u,uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:g,fallbacks:c,onCompiled:m,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},l),a),this.buildUniformLayout()}return!(!r.effect||!r.effect.isReady())&&(a._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("vPrimaryColor",4),this._uniformBuffer.addUniform("vSecondaryColor",4),this._uniformBuffer.addUniform("vTertiaryColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("vReflectionMicrosurfaceInfos",3),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.addUniform("shadowLevel",1),this._uniformBuffer.addUniform("alpha",1),this._uniformBuffer.addUniform("vBackgroundCenter",3),this._uniformBuffer.addUniform("vReflectionControl",4),this._uniformBuffer.create()},r.prototype.unbind=function(){this._diffuseTexture&&this._diffuseTexture.isRenderTarget&&this._uniformBuffer.setTexture("diffuseSampler",null),this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._uniformBuffer.setTexture("reflectionSampler",null),i.prototype.unbind.call(this)},r.prototype.bindOnlyWorldMatrix=function(e){this._activeEffect.setMatrix("world",e)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;if(s){this._activeEffect=s,this.bindOnlyWorldMatrix(t),e.MaterialHelper.BindBonesParameters(i,this._activeEffect);var a=this._mustRebind(n,s,i.visibility);if(a){this._uniformBuffer.bindToEffect(s,"Material"),this.bindViewProjection(s);var l=this._reflectionTexture;this._uniformBuffer.useUbo&&this.isFrozen&&this._uniformBuffer.isSync||(n.texturesEnabled&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),e.MaterialHelper.BindTextureMatrix(this._diffuseTexture,this._uniformBuffer,"diffuse")),l&&e.StandardMaterial.ReflectionTextureEnabled&&(this._uniformBuffer.updateMatrix("reflectionMatrix",l.getReflectionTextureMatrix()),this._uniformBuffer.updateFloat2("vReflectionInfos",l.level,this._reflectionBlur),this._uniformBuffer.updateFloat3("vReflectionMicrosurfaceInfos",l.getSize().width,l.lodGenerationScale,l.lodGenerationOffset))),this.shadowLevel>0&&this._uniformBuffer.updateFloat("shadowLevel",this.shadowLevel),this._uniformBuffer.updateFloat("alpha",this.alpha),this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),this._uniformBuffer.updateColor4("vPrimaryColor",this._primaryColor,this._primaryLevel),this._uniformBuffer.updateColor4("vSecondaryColor",this._secondaryColor,this._secondaryLevel),this._uniformBuffer.updateColor4("vTertiaryColor",this._tertiaryColor,this._tertiaryLevel)),n.texturesEnabled&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&this._uniformBuffer.setTexture("diffuseSampler",this._diffuseTexture),l&&e.StandardMaterial.ReflectionTextureEnabled&&(o.REFLECTIONBLUR&&o.TEXTURELODSUPPORT?this._uniformBuffer.setTexture("reflectionSampler",l):o.REFLECTIONBLUR?(this._uniformBuffer.setTexture("reflectionSampler",l._lodTextureMid||l),this._uniformBuffer.setTexture("reflectionSamplerLow",l._lodTextureLow||l),this._uniformBuffer.setTexture("reflectionSamplerHigh",l._lodTextureHigh||l)):this._uniformBuffer.setTexture("reflectionSampler",l),o.REFLECTIONFRESNEL&&(this._uniformBuffer.updateFloat3("vBackgroundCenter",this.sceneCenter.x,this.sceneCenter.y,this.sceneCenter.z),this._uniformBuffer.updateFloat4("vReflectionControl",this._reflectionControls.x,this._reflectionControls.y,this._reflectionControls.z,this._reflectionControls.w)))),e.MaterialHelper.BindClipPlane(this._activeEffect,n),e.MaterialHelper.BindEyePosition(s,n)}!a&&this.isFrozen||(n.lightsEnabled&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this._maxSimultaneousLights,!1),this.bindView(s),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(i)}}},r.prototype.dispose=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),t&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose()),this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.BackgroundMaterial",t},r.prototype.getClassName=function(){return"BackgroundMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},r}(e.PushMaterial);i.standardReflectance0=.05,i.standardReflectance90=.5,n([e.serializeAsColor3()],i.prototype,"_primaryColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"primaryColor",void 0),n([e.serialize()],i.prototype,"_primaryLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"primaryLevel",void 0),n([e.serializeAsColor3()],i.prototype,"_secondaryColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"secondaryColor",void 0),n([e.serialize()],i.prototype,"_secondaryLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"secondaryLevel",void 0),n([e.serializeAsColor3()],i.prototype,"_tertiaryColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"tertiaryColor",void 0),n([e.serialize()],i.prototype,"_tertiaryLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],i.prototype,"tertiaryLevel",void 0),n([e.serializeAsTexture()],i.prototype,"_reflectionTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),n([e.serialize()],i.prototype,"_reflectionBlur",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionBlur",void 0),n([e.serializeAsTexture()],i.prototype,"_diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"diffuseTexture",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"shadowLights",void 0),n([e.serialize()],i.prototype,"_shadowBlurScale",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"shadowBlurScale",void 0),n([e.serialize()],i.prototype,"_shadowLevel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"shadowLevel",void 0),n([e.serializeAsVector3()],i.prototype,"_sceneCenter",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"sceneCenter",void 0),n([e.serialize()],i.prototype,"_opacityFresnel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"opacityFresnel",void 0),n([e.serialize()],i.prototype,"_reflectionFresnel",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionFresnel",void 0),n([e.serialize()],i.prototype,"_reflectionFalloffDistance",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionFalloffDistance",void 0),n([e.serialize()],i.prototype,"_reflectionAmount",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionAmount",void 0),n([e.serialize()],i.prototype,"_reflectionReflectance0",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionReflectance0",void 0),n([e.serialize()],i.prototype,"_reflectionReflectance90",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionReflectance90",void 0),n([e.serialize()],i.prototype,"_useRGBColor",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useRGBColor",void 0),n([e.serialize()],i.prototype,"_enableNoise",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"enableNoise",void 0),n([e.serialize()],i.prototype,"_maxSimultaneousLights",void 0),n([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],i.prototype,"maxSimultaneousLights",void 0),n([e.serializeAsImageProcessingConfiguration()],i.prototype,"_imageProcessingConfiguration",void 0),e.BackgroundMaterial=i}(r||(r={}));var r,s=this&&this.__assign||Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++){t=arguments[i];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};!function(e){var t=function(){function t(e,i){this._options=s({},t._getDefaultOptions(),e),this._scene=i,this._setupBackground(),this._setupImageProcessing()}return t._getDefaultOptions=function(){return{createGround:!0,groundSize:15,groundTexture:this._groundTextureCDNUrl,groundColor:new e.Color3(.2,.2,.3).toLinearSpace().scale(3),groundOpacity:.9,enableGroundShadow:!0,groundShadowLevel:.5,enableGroundMirror:!1,groundMirrorSizeRatio:.3,groundMirrorBlurKernel:64,groundMirrorAmount:1,groundMirrorFresnelWeight:1,groundMirrorFallOffDistance:0,groundMirrorTextureType:e.Engine.TEXTURETYPE_UNSIGNED_INT,createSkybox:!0,skyboxSize:20,skyboxTexture:this._skyboxTextureCDNUrl,skyboxColor:new e.Color3(.2,.2,.3).toLinearSpace().scale(3),backgroundYRotation:0,sizeAuto:!0,rootPosition:e.Vector3.Zero(),setupImageProcessing:!0,environmentTexture:this._environmentTextureCDNUrl,cameraExposure:.8,cameraContrast:1.2,toneMappingEnabled:!0}},Object.defineProperty(t.prototype,"rootMesh",{get:function(){return this._rootMesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skybox",{get:function(){return this._skybox},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skyboxTexture",{get:function(){return this._skyboxTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skyboxMaterial",{get:function(){return this._skyboxMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ground",{get:function(){return this._ground},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundTexture",{get:function(){return this._groundTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMirror",{get:function(){return this._groundMirror},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMirrorRenderList",{get:function(){return this._groundMirror?this._groundMirror.renderList:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groundMaterial",{get:function(){return this._groundMaterial},enumerable:!0,configurable:!0}),t.prototype.updateOptions=function(e){var t=s({},this._options,e);this._ground&&!t.createGround&&(this._ground.dispose(),this._ground=null),this._groundMaterial&&!t.createGround&&(this._groundMaterial.dispose(),this._groundMaterial=null),this._options.groundTexture&&!t.groundTexture&&this._groundTexture&&(this._groundTexture.dispose(),this._groundTexture=null),this._skybox&&!t.createSkybox&&(this._skybox.dispose(),this._skybox=null),this._skyboxMaterial&&!t.createSkybox&&(this._skyboxMaterial.dispose(),this._skyboxMaterial=null),this._options.skyboxTexture&&!t.skyboxTexture&&this._skyboxTexture&&(this._skyboxTexture.dispose(),this._skyboxTexture=null),this._groundMirror&&!t.enableGroundMirror&&(this._groundMirror.dispose(),this._groundMirror=null),this._options.environmentTexture&&!t.environmentTexture&&this._scene.environmentTexture&&this._scene.environmentTexture.dispose(),this._options=t,this._setupBackground(),this._setupImageProcessing()},t.prototype.setMainColor=function(t){this.groundMaterial&&(this.groundMaterial.primaryColor=t),this.skyboxMaterial&&(this.skyboxMaterial.primaryColor=t),this.groundMirror&&(this.groundMirror.clearColor=new e.Color4(t.r,t.g,t.b,1))},t.prototype._setupImageProcessing=function(){this._options.setupImageProcessing&&(this._scene.imageProcessingConfiguration.contrast=this._options.cameraContrast,this._scene.imageProcessingConfiguration.exposure=this._options.cameraExposure,this._scene.imageProcessingConfiguration.toneMappingEnabled=this._options.toneMappingEnabled,this._setupEnvironmentTexture())},t.prototype._setupEnvironmentTexture=function(){if(!this._scene.environmentTexture){if(this._options.environmentTexture instanceof e.BaseTexture)return void(this._scene.environmentTexture=this._options.environmentTexture);var t=e.CubeTexture.CreateFromPrefilteredData(this._options.environmentTexture,this._scene);this._scene.environmentTexture=t}},t.prototype._setupBackground=function(){this._rootMesh||(this._rootMesh=new e.Mesh("BackgroundHelper",this._scene)),this._rootMesh.rotation.y=this._options.backgroundYRotation;var t=this._getSceneSize();this._options.createGround&&(this._setupGround(t),this._setupGroundMaterial(),this._setupGroundDiffuseTexture(),this._options.enableGroundMirror&&this._setupGroundMirrorTexture(t),this._setupMirrorInGroundMaterial()),this._options.createSkybox&&(this._setupSkybox(t),this._setupSkyboxMaterial(),this._setupSkyboxReflectionTexture()),this._rootMesh.position.x=t.rootPosition.x,this._rootMesh.position.z=t.rootPosition.z,this._rootMesh.position.y=t.rootPosition.y},t.prototype._getSceneSize=function(){var t=this._options.groundSize,i=this._options.skyboxSize,r=this._options.rootPosition;if(!this._scene.meshes||1===this._scene.meshes.length)return{groundSize:t,skyboxSize:i,rootPosition:r};var n=this._scene.getWorldExtends(),o=n.max.subtract(n.min),s=1e-4;if(this._options.sizeAuto){this._scene.activeCamera instanceof e.ArcRotateCamera&&this._scene.activeCamera.upperRadiusLimit&&(t=2*this._scene.activeCamera.upperRadiusLimit),this._scene.activeCamera&&(s=(this._scene.activeCamera.maxZ-this._scene.activeCamera.minZ)/1e4);var a=o.length();a>t&&(t=2*a),t*=1.1,i*=1.5,r=n.min.add(o.scale(.5)),r.y=n.min.y-s}return{groundSize:t,skyboxSize:i,rootPosition:r}},t.prototype._setupGround=function(t){var i=this;this._ground||(this._ground=e.Mesh.CreatePlane("BackgroundPlane",t.groundSize,this._scene),this._ground.rotation.x=Math.PI/2,this._ground.parent=this._rootMesh,this._ground.onDisposeObservable.add(function(){i._ground=null})),this._ground.receiveShadows=this._options.enableGroundShadow},t.prototype._setupGroundMaterial=function(){this._groundMaterial||(this._groundMaterial=new e.BackgroundMaterial("BackgroundPlaneMaterial",this._scene)),this._groundMaterial.alpha=this._options.groundOpacity,this._groundMaterial.alphaMode=e.Engine.ALPHA_PREMULTIPLIED_PORTERDUFF,this._groundMaterial.shadowLevel=this._options.groundShadowLevel,this._groundMaterial.primaryLevel=1,this._groundMaterial.primaryColor=this._options.groundColor,this._groundMaterial.secondaryLevel=0,this._groundMaterial.tertiaryLevel=0,this._groundMaterial.useRGBColor=!1,this._groundMaterial.enableNoise=!0,this._ground&&(this._ground.material=this._groundMaterial)},t.prototype._setupGroundDiffuseTexture=function(){if(this._groundMaterial&&!this._groundTexture){if(this._options.groundTexture instanceof e.BaseTexture)return void(this._groundMaterial.diffuseTexture=this._options.groundTexture);var t=new e.Texture(this._options.groundTexture,this._scene);t.gammaSpace=!1,t.hasAlpha=!0,this._groundMaterial.diffuseTexture=t}},t.prototype._setupGroundMirrorTexture=function(t){var i=e.Texture.CLAMP_ADDRESSMODE;if(!this._groundMirror&&(this._groundMirror=new e.MirrorTexture("BackgroundPlaneMirrorTexture",{ratio:this._options.groundMirrorSizeRatio},this._scene,!1,this._options.groundMirrorTextureType,e.Texture.BILINEAR_SAMPLINGMODE,!0),this._groundMirror.mirrorPlane=new e.Plane(0,-1,0,t.rootPosition.y),this._groundMirror.anisotropicFilteringLevel=1,this._groundMirror.wrapU=i,this._groundMirror.wrapV=i,this._groundMirror.gammaSpace=!1,this._groundMirror.renderList))for(var r=0;r<this._scene.meshes.length;r++){var n=this._scene.meshes[r];n!==this._ground&&n!==this._skybox&&n!==this._rootMesh&&this._groundMirror.renderList.push(n)}this._groundMirror.clearColor=new e.Color4(this._options.groundColor.r,this._options.groundColor.g,this._options.groundColor.b,1),this._groundMirror.adaptiveBlurKernel=this._options.groundMirrorBlurKernel},t.prototype._setupMirrorInGroundMaterial=function(){this._groundMaterial&&(this._groundMaterial.reflectionTexture=this._groundMirror,this._groundMaterial.reflectionFresnel=!0,this._groundMaterial.reflectionAmount=this._options.groundMirrorAmount,this._groundMaterial.reflectionStandardFresnelWeight=this._options.groundMirrorFresnelWeight,this._groundMaterial.reflectionFalloffDistance=this._options.groundMirrorFallOffDistance)},t.prototype._setupSkybox=function(t){var i=this;this._skybox||(this._skybox=e.Mesh.CreateBox("BackgroundSkybox",t.skyboxSize,this._scene,void 0,e.Mesh.BACKSIDE),this._skybox.onDisposeObservable.add(function(){i._skybox=null})),this._skybox.parent=this._rootMesh},t.prototype._setupSkyboxMaterial=function(){this._skybox&&(this._skyboxMaterial||(this._skyboxMaterial=new e.BackgroundMaterial("BackgroundSkyboxMaterial",this._scene)),this._skyboxMaterial.useRGBColor=!1,this._skyboxMaterial.primaryLevel=1,this._skyboxMaterial.primaryColor=this._options.skyboxColor,this._skyboxMaterial.secondaryLevel=0,this._skyboxMaterial.tertiaryLevel=0,this._skyboxMaterial.enableNoise=!0,this._skybox.material=this._skyboxMaterial)},t.prototype._setupSkyboxReflectionTexture=function(){if(this._skyboxMaterial&&!this._skyboxTexture){if(this._options.skyboxTexture instanceof e.BaseTexture)return void(this._skyboxMaterial.reflectionTexture=this._skyboxTexture);this._skyboxTexture=new e.CubeTexture(this._options.skyboxTexture,this._scene),this._skyboxTexture.coordinatesMode=e.Texture.SKYBOX_MODE,this._skyboxTexture.gammaSpace=!1,this._skyboxMaterial.reflectionTexture=this._skyboxTexture}},t.prototype.dispose=function(){this._groundMaterial&&this._groundMaterial.dispose(!0,!0),this._skyboxMaterial&&this._skyboxMaterial.dispose(!0,!0),this._rootMesh.dispose(!1)},t}();t._groundTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundGround.png",t._skyboxTextureCDNUrl="https://assets.babylonjs.com/environments/backgroundSkybox.dds",t._environmentTextureCDNUrl="https://assets.babylonjs.com/environments/environmentSpecular.dds",e.EnvironmentHelper=t}(r||(r={})),r.Effect.ShadersStore={defaultVertexShader:"#include<__decl__defaultVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",defaultPixelShader:"#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY \n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\n#if SPECULARDIRECTUV == 1\n#define vSpecularUV vMainUV1\n#elif SPECULARDIRECTUV == 2\n#define vSpecularUV vMainUV2\n#else\nvarying vec2 vSpecularUV;\n#endif\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\ngl_FragColor=color;\n}",pbrVertexShader:"precision highp float;\n#include<__decl__pbrVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif \n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#if defined(ALBEDO) && ALBEDODIRECTUV == 0\nvarying vec2 vAlbedoUV;\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0\nvarying vec2 vReflectivityUV;\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=environmentIrradianceJones(reflectionVector);\n#endif\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif \n#if defined(ALBEDO) && ALBEDODIRECTUV == 0 \nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0 \nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0 \nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0 \nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0 \nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY) && REFLECTIVITYDIRECTUV == 0 \nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(MICROSURFACEMAP) && MICROSURFACEMAPDIRECTUV == 0 \nif (vMicroSurfaceSamplerInfos.x == 0.)\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvMicroSurfaceSamplerUV=vec2(microSurfaceSamplerMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0 \nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<bumpVertex>\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",pbrPixelShader:"#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n#include<__decl__pbrFragment>\nuniform vec4 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vCameraInfos;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2;\n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\n#if ALBEDODIRECTUV == 1\n#define vAlbedoUV vMainUV1\n#elif ALBEDODIRECTUV == 2\n#define vAlbedoUV vMainUV2\n#else\nvarying vec2 vAlbedoUV;\n#endif\nuniform sampler2D albedoSampler;\n#endif\n#ifdef AMBIENT\n#if AMBIENTDIRECTUV == 1\n#define vAmbientUV vMainUV1\n#elif AMBIENTDIRECTUV == 2\n#define vAmbientUV vMainUV2\n#else\nvarying vec2 vAmbientUV;\n#endif\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\n#if OPACITYDIRECTUV == 1\n#define vOpacityUV vMainUV1\n#elif OPACITYDIRECTUV == 2\n#define vOpacityUV vMainUV2\n#else\nvarying vec2 vOpacityUV;\n#endif\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\n#if EMISSIVEDIRECTUV == 1\n#define vEmissiveUV vMainUV1\n#elif EMISSIVEDIRECTUV == 2\n#define vEmissiveUV vMainUV2\n#else\nvarying vec2 vEmissiveUV;\n#endif\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\n#if LIGHTMAPDIRECTUV == 1\n#define vLightmapUV vMainUV1\n#elif LIGHTMAPDIRECTUV == 2\n#define vLightmapUV vMainUV2\n#else\nvarying vec2 vLightmapUV;\n#endif\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFLECTIVITY\n#if REFLECTIVITYDIRECTUV == 1\n#define vReflectivityUV vMainUV1\n#elif REFLECTIVITYDIRECTUV == 2\n#define vReflectivityUV vMainUV2\n#else\nvarying vec2 vReflectivityUV;\n#endif\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef MICROSURFACEMAP\n#if MICROSURFACEMAPDIRECTUV == 1\n#define vMicroSurfaceSamplerUV vMainUV1\n#elif MICROSURFACEMAPDIRECTUV == 2\n#define vMicroSurfaceSamplerUV vMainUV2\n#else\nvarying vec2 vMicroSurfaceSamplerUV;\n#endif\nuniform sampler2D microSurfaceSampler;\n#endif\n\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#endif\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n\n#include<shadowsFragmentFunctions>\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n\n\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\n#include<bumpFragment>\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n\n\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\nsurfaceAlbedo*=vAlbedoInfos.y;\n#endif\n\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#if !defined(LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<=ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nsurfaceAlbedo*=vColor.rgb;\n#endif\n\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\nvec4 surfaceMetallicColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicColorMap.r,surfaceMetallicColorMap.r,surfaceMetallicColorMap.r);\nambientOcclusionColor=mix(ambientOcclusionColor,aoStoreInMetalMap,vReflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicColorMap.g;\n#endif\n#endif\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n\nmicroSurface=1.0-metallicRoughness.g;\n\nvec3 baseColor=surfaceAlbedo;\n\n\nconst vec3 DefaultSpecularReflectanceDielectric=vec3(0.04,0.04,0.04);\n\nsurfaceAlbedo=mix(baseColor.rgb*(1.0-DefaultSpecularReflectanceDielectric.r),vec3(0.,0.,0.),metallicRoughness.r);\n\nsurfaceReflectivityColor=mix(DefaultSpecularReflectanceDielectric,baseColor,metallicRoughness.r);\n#else\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nsurfaceReflectivityColor*=toLinearSpace(surfaceReflectivityColorMap.rgb);\nsurfaceReflectivityColor*=vReflectivityInfos.y;\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceReflectivityColorMap.a;\nmicroSurface*=vReflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#endif\n#endif\n#endif\n\nmicroSurface=clamp(microSurface,0.,1.);\n\nfloat roughness=1.-microSurface;\n\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\n\n\n\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\n\nalpha=fresnelSchlickEnvironmentGGX(clamp(dot(viewDirectionW,normalForward),0.0,1.0),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (alpha<=ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\n\nalpha=1.0;\n#endif\n#endif\n#endif\n#endif\n\n\nfloat NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=clamp(NdotVUnclamped,0.,1.)+0.00001;\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n\n#ifdef REFRACTION\nvec3 environmentRefraction=vec3(0.,0.,0.);\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef LODINREFRACTIONALPHA\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,alphaG,1.0);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef LODINREFRACTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD).rgb;\n#else\nfloat lodRefractionNormalized=clamp(refractionLOD/log2(vRefractionMicrosurfaceInfos.x),0.,1.);\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec3 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords).rgb;\nif(lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords).rgb,\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n}else{\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords).rgb,\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFRACTION\nenvironmentRefraction=toLinearSpace(environmentRefraction.rgb);\n#endif\n\nenvironmentRefraction*=vRefractionInfos.x;\n#endif\n\n#ifdef REFLECTION\nvec3 environmentRadiance=vec3(0.,0.,0.);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,1.);\n#endif\n#ifdef LODBASEDMICROSFURACE\n\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\n\n\n\n\n\n\n\n\n\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,requestedReflectionLOD).rgb;\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x),0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec3 environmentSpecularMid=sampleReflection(reflectionSampler,reflectionCoords).rgb;\nif(lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords).rgb,\nenvironmentSpecularMid,\nlodReflectionNormalizedDoubled\n);\n}else{\nenvironmentRadiance=mix(\nenvironmentSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords).rgb,\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\n#endif\n\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\nenvironmentIrradiance=environmentIrradianceJones(irradianceVector);\n#endif\n#endif\n\nenvironmentRadiance*=vReflectionInfos.x;\nenvironmentRadiance*=vReflectionColor.rgb;\nenvironmentIrradiance*=vReflectionColor.rgb;\n#endif\n\n\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n\nvec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\nlightingInfo info;\nfloat shadow=1.; \nfloat NdotL=-1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n\nvec2 brdfSamplerUV=vec2(NdotV,roughness);\n\nvec4 environmentBrdf=texture2D(environmentBrdfSampler,brdfSamplerUV);\nvec3 specularEnvironmentReflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(reflectionCoords,normalW);\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\n\nvec3 specularEnvironmentReflectance=fresnelSchlickEnvironmentGGX(NdotV,specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n\n#ifdef REFRACTION\nvec3 refractance=vec3(0.0,0.0,0.0);\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedo;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedo*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nenvironmentRefraction*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=transmission;\n#endif\n\n\n\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n\nvec3 finalDiffuse=diffuseBase;\nfinalDiffuse.rgb+=vAmbientColor;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\n\n#ifdef REFLECTION\nvec3 finalIrradiance=environmentIrradiance;\nfinalIrradiance*=surfaceAlbedo.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\n\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#endif\n\n#ifdef REFLECTION\nvec3 finalRadiance=environmentRadiance;\nfinalRadiance*=specularEnvironmentReflectance;\n\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#endif\n\n#ifdef REFRACTION\nvec3 finalRefraction=environmentRefraction;\nfinalRefraction*=refractance;\n#endif\n\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\nfinalEmissive*=vEmissiveInfos.y;\n#endif\n\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA)\nalpha=clamp(alpha+luminanceOverAlpha*luminanceOverAlpha,0.,1.);\n#endif\n#endif\n\n\n\nvec4 finalColor=vec4(finalDiffuse*ambientOcclusionColor*vLightingIntensity.x +\n#ifdef REFLECTION\nfinalIrradiance*ambientOcclusionColor*vLightingIntensity.z +\n#endif\n#ifdef SPECULARTERM\n\n\nfinalSpecularScaled +\n#endif\n#ifdef REFLECTION\n\n\nfinalRadianceScaled +\n#endif\n#ifdef REFRACTION\nfinalRefraction*vLightingIntensity.z +\n#endif\nfinalEmissive*vLightingIntensity.y,\nalpha);\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n\nfinalColor=max(finalColor,0.0);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#else\n\nfinalColor=applyImageProcessing(finalColor);\n#endif\n#ifdef PREMULTIPLYALPHA\n\nfinalColor.rgb*=finalColor.a;\n#endif\ngl_FragColor=finalColor;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}",spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\nattribute float cellIndex;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec3 particlesInfos; \n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset*particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",gpuRenderParticlesVertexShader:"#version 300 es\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 velocity;\nvoid main() {\ngl_PointSize=1.0;\ngl_Position=vec4(position,1.0);\n}",gpuRenderParticlesPixelShader:"void main() {\ngl_FragColor=vec4(1.0);\n}\n",gpuUpdateParticlesVertexShader:"#version 300 es\nuniform float timeDelta;\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 velocity;\n\nout vec3 outPosition;\nout float outAge;\nout float outLife;\nout vec3 outVelocity;\nvoid main() {\nif (age>=life) {\n\noutPosition=vec3(0,0,0);\n\noutAge=0.0;\noutLife=life;\n\noutVelocity=vec3(0,1,0);\n} else {\noutPosition=position+velocity*timeDelta;\noutAge=age+timeDelta;\noutLife=life;\noutVelocity=velocity;\n}\n}",gpuUpdateParticlesPixelShader:"#version 300 es\nvoid main() {\ndiscard;\n}\n",colorVertexShader:"\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 viewProjection;\nuniform mat4 world;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}",colorPixelShader:"#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\nvoid main(void) {\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 biasAndScale;\nuniform vec2 depthValues;\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y))+biasAndScale.x;\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",shadowMapPixelShader:"#ifndef FLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvarying float vDepthMetric;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform vec2 biasAndScale;\nuniform vec2 depthValues;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=vDepthMetric;\n#ifdef ESM\ndepth=clamp(exp(-min(87.,biasAndScale.y*depth)),0.,1.);\n#endif\n#ifdef FLOAT\ngl_FragColor=vec4(depth,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depth);\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(vDepthMetric,vDepthMetric*vDepthMetric,0.0,1.0);\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n",ssao2PixelShader:"\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform sampler2D normalSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\nfloat depth=abs(texture2D(textureSampler,vUV).r);\nvec3 normal=texture2D(normalSampler,vUV).rgb; \nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,1.0);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nif (depth>maxZ) {\ngl_FragColor=vec4(1.0,1.0,1.0,1.0);\nreturn;\n}\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=tbn*sampleSphere[i];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\nfloat sampleDepth=abs(texture2D(textureSampler,offset.xy).r);\n\nfloat rangeCheck=abs(depth-sampleDepth)<correctedRadius ? 1.0 : 0.0;\ndifference=samplePosition.z-sampleDepth;\n\nocclusion+=(difference>=1e-5 ? 1.0 : 0.0)*rangeCheck;\n}\n\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",standardPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n",fxaaVertexShader:"\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}",fxaaPixelShader:"uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\nif(range<rangeMaxClamped) \n{\ngl_FragColor=rgbyM;\nreturn;\n}\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan) \n{\nlumaS=lumaE;\n}\nif (horzSpan) \n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan) \n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN) \n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) \n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN) \n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP) \n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan) \n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}",geometryVertexShader:"precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nvarying vec2 uv;\n#endif\n#ifdef UV2\nvarying vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(position,1.0));\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normal,0.0)));\nvViewPos=view*pos;\n#ifdef POSITION\nvPosition=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",geometryPixelShader:"#extension GL_EXT_draw_buffers : require\nprecision highp float;\nprecision highp int;\nvarying vec3 vNormalV;\nvarying vec4 vViewPos;\n#ifdef POSITION\nvarying vec3 vPosition;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef POSITION\n#include<mrtFragmentDeclaration>[3]\n#else\n#include<mrtFragmentDeclaration>[2]\n#endif\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\n\ngl_FragData[1]=vec4(normalize(vNormalV),1.0);\n\n#ifdef POSITION\ngl_FragData[2]=vec4(vPosition,1.0);\n#endif\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void) \n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11)); \nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",highlightsPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void) \n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a); \n}",imageProcessingPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main(void)\n{\nvec4 result=texture2D(textureSampler,vUV);\n#ifdef IMAGEPROCESSING\n#ifndef FROMLINEARSPACE\n\nresult.rgb=toLinearSpace(result.rgb);\n#endif\nresult=applyImageProcessing(result);\n#else\n\n#ifdef FROMLINEARSPACE\nresult=applyImageProcessing(result);\n#endif\n#endif\ngl_FragColor=result;\n}",kernelBlurVertexShader:"\nattribute vec2 position;\n\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n}",kernelBlurPixelShader:"\nuniform sampler2D textureSampler;\nuniform vec2 delta;\n\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\nvec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nvoid main(void)\n{\n#ifdef PACKEDFLOAT \nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,0.0);\nelse{\ngl_FragColor=texture2D(textureSampler,tc);\n}\n}",glowBlurPostProcessPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\n\nfloat getLuminance(vec3 color)\n{\nreturn dot(color,vec3(0.2126,0.7152,0.0722));\n}\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\n\nvec4 texel=texture2D(textureSampler,start+texelOffset);\nbaseColor.a+=texel.a*weights[i];\n\nfloat luminance=getLuminance(baseColor.rgb);\nfloat luminanceTexel=getLuminance(texel.rgb);\nfloat choice=step(luminanceTexel,luminance);\nbaseColor.rgb=choice*baseColor.rgb+(1.0-choice)*texel.rgb;\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",glowMapGenerationPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform sampler2D emissiveSampler;\n#endif\nuniform vec4 color;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUVDiffuse).a<0.4)\ndiscard;\n#endif\n#ifdef EMISSIVE\ngl_FragColor=texture2D(emissiveSampler,vUVEmissive);\n#else\ngl_FragColor=color;\n#endif\n}",glowMapGenerationVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef ALPHATEST\nvarying vec2 vUVDiffuse;\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vUVEmissive;\nuniform mat4 emissiveMatrix;\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef DIFFUSEUV1\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef DIFFUSEUV2\nvUVDiffuse=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#ifdef EMISSIVE\n#ifdef EMISSIVEUV1\nvUVEmissive=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef EMISSIVEUV2\nvUVEmissive=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",glowMapMergePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float offset;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\nbaseColor.a=abs(offset-baseColor.a);\ngl_FragColor=baseColor;\n}",glowMapMergeVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n",outlinePixelShader:"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",backgroundVertexShader:"precision highp float;\n#include<__decl__backgroundVertex>\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif\n#ifdef MAINUV2\nvarying vec2 vMainUV2; \n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nvarying vec2 vDiffuseUV;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normal);\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uv;\n#endif \n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0 \nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",backgroundPixelShader:"#ifdef TEXTURELODSUPPORT\n#extension GL_EXT_shader_texture_lod : enable\n#endif\nprecision highp float;\n#include<__decl__backgroundFragment>\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef MAINUV1\nvarying vec2 vMainUV1;\n#endif \n#ifdef MAINUV2 \nvarying vec2 vMainUV2; \n#endif \n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef DIFFUSE\n#if DIFFUSEDIRECTUV == 1\n#define vDiffuseUV vMainUV1\n#elif DIFFUSEDIRECTUV == 2\n#define vDiffuseUV vMainUV2\n#else\nvarying vec2 vDiffuseUV;\n#endif\nuniform sampler2D diffuseSampler;\n#endif\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef TEXTURELODSUPPORT\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE;\n#endif\n\n#ifndef SHADOWONLY\n#define SHADOWONLY;\n#endif\n#include<imageProcessingDeclaration>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<helperFunctions>\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<imageProcessingFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n#ifdef REFLECTIONFRESNEL\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(0.0,1.0,0.0);\n#endif\n\nfloat shadow=1.;\nfloat globalShadow=0.;\nfloat shadowLightCount=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef SHADOWINUSE\nglobalShadow/=shadowLightCount;\n#else\nglobalShadow=1.0;\n#endif\n\nvec3 reflectionColor=vec3(1.,1.,1.);\n#ifdef REFLECTION\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=reflectionVector;\n#else\nvec2 reflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n#ifdef REFLECTIONBLUR\nfloat reflectionLOD=vReflectionInfos.y;\n#ifdef TEXTURELODSUPPORT\n\nreflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\nreflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD).rgb;\n#else\nfloat lodReflectionNormalized=clamp(reflectionLOD,0.,1.);\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec3 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords).rgb;\nif(lodReflectionNormalizedDoubled<1.0){\nreflectionColor=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords).rgb,\nreflectionSpecularMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nreflectionColor=mix(\nreflectionSpecularMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords).rgb,\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#else\nvec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);\nreflectionColor=reflectionSample.rgb;\n#endif\n#ifdef GAMMAREFLECTION\nreflectionColor=toLinearSpace(reflectionColor.rgb);\n#endif\n\nreflectionColor*=vReflectionInfos.x;\n#endif\n\nvec3 diffuseColor=vec3(1.,1.,1.);\nfloat finalAlpha=alpha;\n#ifdef DIFFUSE\nvec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef GAMMADIFFUSE\ndiffuseMap.rgb=toLinearSpace(diffuseMap.rgb);\n#endif\n\ndiffuseMap.rgb*=vDiffuseInfos.y;\n#ifdef DIFFUSEHASALPHA\nfinalAlpha*=diffuseMap.a;\n#endif\ndiffuseColor=diffuseMap.rgb;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 colorBase=diffuseColor;\n#else\nvec3 colorBase=reflectionColor*diffuseColor;\n#endif\ncolorBase=max(colorBase,0.0);\n\n#ifdef USERGBCOLOR\nvec3 finalColor=colorBase;\n#else\nvec3 finalColor=colorBase.r*vPrimaryColor.rgb*vPrimaryColor.a;\nfinalColor+=colorBase.g*vSecondaryColor.rgb*vSecondaryColor.a;\nfinalColor+=colorBase.b*vTertiaryColor.rgb*vTertiaryColor.a;\n#endif\n\n#ifdef REFLECTIONFRESNEL\nvec3 reflectionAmount=vReflectionControl.xxx;\nvec3 reflectionReflectance0=vReflectionControl.yyy;\nvec3 reflectionReflectance90=vReflectionControl.zzz;\nfloat VdotN=dot(normalize(vEyePosition),normalW);\nvec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(clamp(VdotN,0.0,1.0),reflectionReflectance0,reflectionReflectance90,1.0);\nreflectionAmount*=planarReflectionFresnel;\n#ifdef REFLECTIONFALLOFF\nfloat reflectionDistanceFalloff=1.0-clamp(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w,0.0,1.0);\nreflectionDistanceFalloff*=reflectionDistanceFalloff;\nreflectionAmount*=reflectionDistanceFalloff;\n#endif\nfinalColor=mix(finalColor,reflectionColor,clamp(reflectionAmount,0.,1.));\n#endif\n#ifdef OPACITYFRESNEL\nfloat viewAngleToFloor=dot(normalW,normalize(vEyePosition-vBackgroundCenter));\n\nconst float startAngle=0.1;\nfloat fadeFactor=clamp(viewAngleToFloor/startAngle,0.0,1.0);\nfinalAlpha*=fadeFactor*fadeFactor;\n#endif\n\n#ifdef SHADOWINUSE\nfinalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);\n#endif\n\nvec4 color=vec4(finalColor,finalAlpha);\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\n\ncolor.rgb=clamp(color.rgb,0.,30.0);\n#else\n\ncolor=applyImageProcessing(color);\n#endif\n#ifdef PREMULTIPLYALPHA\n\ncolor.rgb*=color.a;\n#endif\n#ifdef NOISE\ncolor.rgb=dither(vPositionW.xy,color.rgb);\n#endif\ngl_FragColor=color;\n}"},r.Effect.IncludesShadersStore={depthPrePass:"#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif",bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",bumpVertexDeclaration:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying vec3 vFogDistance;\n#endif",morphTargetsVertexGlobalDeclaration:"#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#endif",morphTargetsVertexDeclaration:"#ifdef MORPHTARGETS\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#endif",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",morphTargetsVertex:"#ifdef MORPHTARGETS\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpVertex:"#if defined(BUMP) || defined(PARALLAX)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",fogVertex:"#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\nvDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));\n#endif\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",helperFunctions:"const float PI=3.1415926535897932384626433832795;\nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\n\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.0,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\nvec3 applyEaseInOut(vec3 x){\nreturn x*x*(3.0-2.0*x);\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn pow(color,vec3(LinearEncodePowerApprox));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn pow(color,vec3(GammaEncodePowerApprox));\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\n\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nvec3 dither(vec2 seed,vec3 color) {\nfloat rand=getRand(seed);\ncolor.rgb+=mix(-0.5/255.0,0.5/255.0,rand);\nreturn color;\n}",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#else\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform sampler2D shadowSampler{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",lightUboDeclaration:"#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec3 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\n#endif\n#ifdef HEMILIGHT{X}\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#if defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform sampler2D shadowSampler{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif",defaultVertexDeclaration:"\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n",defaultFragmentDeclaration:"uniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_SKYBOX\n#else\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif",defaultUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor; \nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix; \nvec4 vTangentSpaceParams;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nfloat pointSize; \n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",shadowsFragmentFunctions:"#ifdef SHADOWS\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadow=texture2D(shadowSampler,uv).x;\n#endif\nif (shadowPixelDepth>shadow)\n{\nreturn computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff);\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\n#ifndef SHADOWFLOAT\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;\n#else\nif (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;\nif (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(texture2D(shadowSampler,uv));\n#else\nfloat shadowMapSample=texture2D(shadowSampler,uv).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n#endif\n",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nreturn vec3(1.0-s,t,0);\n#else\nreturn vec3(s,t,0);\n#endif\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition.xyz);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition.xyz;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",imageProcessingDeclaration:"#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#ifdef VIGNETTE\nuniform vec2 vInverseScreenSize;\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif",imageProcessingFunctions:"#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=clamp(sliceUV,0.,1.);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\nvec4 applyImageProcessing(vec4 result) {\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\n\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\n\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=clamp(result.rgb,0.0,1.0);\n#ifdef CONTRAST\n\nvec3 resultHighContrast=applyEaseInOut(result.rgb);\nif (contrast<1.0) {\n\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\n\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\n\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\nreturn result;\n}",bumpFragmentFunctions:"#ifdef BUMP\n#if BUMPDIRECTUV == 1\n#define vBumpUV vMainUV1\n#elif BUMPDIRECTUV == 2\n#define vBumpUV vMainUV2\n#else\nvarying vec2 vBumpUV;\n#endif\nuniform sampler2D bumpSampler;\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nuv=gl_FrontFacing ? uv : -uv;\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\n\ntangent*=vTangentSpaceParams.x;\nbitangent*=vTangentSpaceParams.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\nmap=map*2.0-1.0;\n#ifdef NORMALXYSCALE\nmap=normalize(map*vec3(vBumpInfos.y,vBumpInfos.y,1.0));\n#endif\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",bumpFragment:"vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#else \nfloat normalScale=vBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(TBN,vBumpUV+uvOffset);\n#endif",lightFragment:"#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || (defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X}))\n\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,roughness,NdotV,specularEnvironmentR0,specularEnvironmentR90,NdotL);\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightGround,glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCLOSEESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#else\n#ifdef SHADOWESM{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#else \n#ifdef SHADOWPCF{X}\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPCFCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor;\n#endif\n#endif\n#else\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif\n#endif\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",pbrVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n",pbrFragmentDeclaration:"uniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec3 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\nuniform vec3 vRefractionMicrosurfaceInfos;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif",pbrUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec2 vAlbedoInfos;\nuniform vec3 vAmbientInfos;\nuniform vec2 vOpacityInfos;\nuniform vec2 vEmissiveInfos;\nuniform vec2 vLightmapInfos;\nuniform vec3 vReflectivityInfos;\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform vec4 vRefractionInfos;\nuniform vec2 vReflectionInfos;\nuniform vec3 vBumpInfos;\nuniform mat4 albedoMatrix;\nuniform mat4 ambientMatrix;\nuniform mat4 opacityMatrix;\nuniform mat4 emissiveMatrix;\nuniform mat4 lightmapMatrix;\nuniform mat4 reflectivityMatrix;\nuniform mat4 microSurfaceSamplerMatrix;\nuniform mat4 bumpMatrix;\nuniform vec2 vTangentSpaceParams;\nuniform mat4 refractionMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec3 vRefractionMicrosurfaceInfos;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\nuniform float pointSize;\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 reflectance0,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nvec3 fresnel=fresnelSchlickGGX(VdotH,reflectance0,reflectance90);\nreturn fresnel*specTerm;\n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel*NdotL/PI;\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n\n\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=clamp(reflectance0*25.0,0.0,1.0);\nreturn reflectance90;\n}\n\n\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\n\n\n\n\n\n\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nfloat microsurfaceAverageSlopeTexels=microsurfaceAverageSlope*cubeMapDimensionPixels;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\n\n\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn clamp(square(temp)-1.0+ambientOcclusion,0.0,1.0);\n}\nfloat environmentHorizonOcclusion(vec3 reflection,vec3 normal) {\n\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflection.z*=-1.0;\n#endif\nfloat temp=clamp( 1.0+1.1*dot(reflection,normal),0.0,1.0);\nreturn square(temp);\n}",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 quaternionVectorRotation_ScaledSqrtTwo(vec4 Q,vec3 V){\nvec3 T=cross(Q.xyz,V);\nT+=Q.www*V;\nreturn cross(Q.xyz,T)+V;\n}\nvec3 environmentIrradianceJones(vec3 normal)\n{\n\n\n\n\n\n\n\n\n\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz*Nz+C1;\nvec3 t2=a2*Ny+t1;\nvec3 t3=b3*Nx+t2;\nreturn t3;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=clamp(dot(vNormal,lightDirection),0.00000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+directionToLightCenterW);\nNdotL=clamp(dot(vNormal,directionToLightCenterW),0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance0,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=clamp(dot(vNormal,H),0.000000000001,1.0);\nNdotL=clamp(NdotL,0.000000000001,1.0);\nfloat VdotH=clamp(dot(viewDirectionW,H),0.0,1.0);\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,reflectance0,reflectance90);\nresult.specular=specTerm*diffuseColor;\n#endif\nreturn result;\n}",mrtFragmentDeclaration:"#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n",bones300Declaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nin vec4 matricesIndices;\nin vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nin vec4 matricesIndicesExtra;\nin vec4 matricesWeightsExtra;\n#endif\n#endif",instances300Declaration:"#ifdef INSTANCES\nin vec4 world0;\nin vec4 world1;\nin vec4 world2;\nin vec4 world3;\n#else\nuniform mat4 world;\n#endif",kernelBlurFragment:"#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*KERNEL_WEIGHT{X};\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*KERNEL_WEIGHT{X};\n#endif",kernelBlurFragment2:"#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*KERNEL_DEP_WEIGHT{X};\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*KERNEL_DEP_WEIGHT{X};\n#endif",kernelBlurVaryingDeclaration:"varying vec2 sampleCoord{X};",kernelBlurVertex:"sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};",backgroundVertexDeclaration:"uniform mat4 view;\nuniform mat4 viewProjection;\nuniform float shadowLevel;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif",backgroundFragmentDeclaration:" uniform vec4 vPrimaryColor;\nuniform vec4 vSecondaryColor;\nuniform vec4 vTertiaryColor;\nuniform float shadowLevel;\nuniform float alpha;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#endif\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif",backgroundUboDeclaration:"layout(std140,column_major) uniform;\nuniform Material\n{\nuniform vec4 vPrimaryColor;\nuniform vec4 vSecondaryColor;\nuniform vec4 vTertiaryColor;\nuniform vec2 vDiffuseInfos;\nuniform vec2 vReflectionInfos;\nuniform mat4 diffuseMatrix;\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\nuniform float pointSize;\nuniform float shadowLevel;\nuniform float alpha;\n#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)\nuniform vec3 vBackgroundCenter;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 vReflectionControl;\n#endif\n};\nuniform Scene {\nmat4 viewProjection;\nmat4 view;\n};"},function(i,r){var n=r();if(!i||!i.BABYLON){(void 0!==t?t:"undefined"!=typeof window?window:this).BABYLON=n,e.exports=n}}(this,function(){return r})}).call(t,i(1))},function(e,t,i){"use strict";function r(e,t){instance.nbTable=this;var i=document.createElement("div");i.id="nbTable",i.innerHTML=e,$("body").append(i);var r=$("#nbTable");r.css("position","absolute"),r.css("left",$(window).width()-or.width()),r.css("top",100),$("#nbTable").draggabilly({handle:"#table_tr"}),this.hide()}r.prototype.show=function(){$("#nbTable").show()},r.prototype.hide=function(){$("#nbTable").hide()},r.prototype.get$=function(){return $("#nbTable")},r.constructor=r,e.exports=r},function(e,t,i){"use strict";window.nb=window.nb||{},nb.GraphicsUtils={};var r={MOVE_TO:1,LINE_TO:2,CURVO_TO:3,LINE_STYLE:32,BEGIN_FILL:33,END_FILL:255};nb.GraphicsUtils.draw=function(e,t){e.lastMovePos={x:NaN,y:NaN};for(var i="",n=nb.GraphicsUtils.__moveTo__;t.length;){var o=t.pop();if(o==r.MOVE_TO){var s=t.pop(),a=t.pop(),l=n(e,s,a);l&&(i+="g.moveTo("+s+","+a+")\n")}else if(o==r.LINE_TO){var s=t.pop(),a=t.pop();e.lastMovePos.x==s&&e.lastMovePos.y==a||(i+="g.lineTo("+s+","+a+")\n",e.lineTo(s,a),e.lastMovePos.x=s,e.lastMovePos.y=a)}else if(o==r.CURVO_TO){var s=t.pop(),a=t.pop(),l=n(e,s,a);l&&(i+="g.moveTo("+s+","+a+")\n");var h=t.pop(),c=t.pop(),u=t.pop(),f=t.pop();e.lastMovePos.x=u,e.lastMovePos.y=f,e.quadraticCurveTo(h,c,u,f),i+="g.quadraticCurveTo("+h+","+c+","+u+","+f+")\n"}else if(o==r.LINE_STYLE){var d=t.pop(),p=t.pop(),m=t.pop();e.lineStyle(d,p,m),i+="g.lineStyle("+d+","+p+","+m+")\n"}else if(o==r.BEGIN_FILL){var d=t.pop(),p=t.pop();e.beginFill(d,p),i+="g.beginFill("+d+","+p+")\n"}else o==r.END_FILL&&(e.endFill(),i+="g.endFill();\n")}},nb.GraphicsUtils.__moveTo__=function(e,t,i){return(e.lastMovePos.x!=t||e.lastMovePos.y!=i)&&(e.moveTo(t,i),e.lastMovePos.x=t,e.lastMovePos.y=i,!0)},nb.GraphicsUtils.drawPolygon=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];0==i?e.moveTo(r.x,r.y):e.lineTo(r.x,r.y)}},e.exports=nb.GraphicsUtils},function(e,t,i){"use strict";function r(){}function n(){for(var e=0;e<l.length;e++){o(l[e])}}function o(e){var t=e.dis.toGlobal({x:0,y:0});void 0!=e.prop.right&&(t.x=s.W-e.prop.right),void 0!=e.prop.left&&(t.x=e.prop.left),void 0!=e.prop.top&&(t.y=e.prop.top),void 0!=e.prop.bottom&&(t.y=s.H-e.prop.bottom),e.dis.parent&&(t=e.dis.parent.toLocal(t,instance.stage),e.dis.x=t.x,e.dis.y=t.y)}var s=i(39),a=!0,l=[];r.add=function(e,t){a&&(window.addEventListener("resize",n),a=!1),l.push({dis:e,prop:t}),o(l[l.length-1])},e.exports=r},function(e,t,i){"use strict";function r(){o<640?($(".timeline-logo").addClass("caidan-bg"),$(".mobile-hide").css({"margin-left":"-400px"}),$(".timeline-wrapper").css("margin-left","0").addClass("timeline-wrapper2 clear-before"),$(".timeline-logo h2").css("padding-left","0.3em"),$(".mobile-hide,.timeline-background,.timeline-icon").hide()):($(".timeline-logo").removeClass("caidan-bg"),$(".mobile-hide").css({"margin-left":"0px"}),$(".timeline-wrapper").css("margin-left","5.7em").removeClass("timeline-wrapper2 clear-before"),$(".timeline-logo h2").css("padding-left","3.6em"),$(".mobile-hide,.timeline-background,.timeline-icon").show())}function n(e){}var o;n.constructor=n;var s=0;n.prototype.getConfig=function(){return this.config},n.prototype.randomColor=function(){var e=["rgba(245, 157, 0, 1)","rgba(219, 19, 95, 1)","rgba(0, 192, 242, 1)","rgba(96, 90, 170, 1)","rgba(255, 185, 0, 1)","rgba(119, 184, 233, 1)","rgba(232, 74, 76, 1)","rgba(115, 194, 56, 1)"];return e[s++%e.length]},n.prototype.setVisible=function(e){e?($("#logo").show(),$(".timeline-parent").show()):($("#logo").hide(),$(".timeline-parent").hide())},n.prototype.parse=function(e){function t(e,t){var i;i=1==arguments.length||t,s&&e[0]===s[0]||(s&&s.removeClass(o),i&&$(e[0]).addClass(o),s=$(e[0]))}function i(e,i){function r(){n&&n.threeSystem&&span.parent().next().find("dt").removeClass(o)}if(!a||e[0]!==a){if(a){a.find("span").removeClass(o)}span=e.find("span"),$(span[0]).addClass(o),a=e;var n,s=e.find("dl").find("dt");if(i){span.on("click",function(){flag=!0}),span.parent().on("click",function(){flag=!0});var l=i.dispatch;if(void 0!=s[0]){var h=s[0].getAttribute("goto");void 0!=h&&(n=instance.gotoStep(h),n&&l&&n.emit(l.type,l),console.log(!n),t(s,!n.threeSystem))}else{var h=e.find("h2")[0].getAttribute("goto");void 0!=h&&(n=instance.gotoStep(h))&&l&&n.emit(l.type,l),console.log(!n),t(s,!n.threeSystem)}}span.on("click",r),span.parent().on("click",r)}}for(var n=this.div,o="timeline-selected",s=null,a=null,l=[],h=0;h<e.length;h++){var c=e.length,u=e[h],f=$('<div class="timeline-wrapper" id="timeline-wrapper'+h+'"></div>'),d=this.randomColor(),p="menuCircle3"+h,m=$('<div class="timeline-icon"><svg height="100" width="100"> <circle cx="40" class="menuCircle1" cy="40" r="7" fill="'+d+'" /> <circle cx="40" class= "'+p+'" cy="40" r="8" fill="'+d+'" /> <circle cx="40" class="menuCircle2" cy="40" r="14" stroke="'+d+'" stroke-width="5" fill="rgba(0, 0, 0, 0)" /> </svg> </div>');f.append(m),l.push(m);var g=$('<h2 goto="'+u.goto+'" class="timeline-time"><span>'+u.name+"</span></h2>");f.append(g),f.click(function(e){var t=p;return function(){for(var r=0;r<c;r++)$("[class='menuCircle3"+r+"']").attr("fill","rgba(255, 247, 153, 0)");if($("[class='"+t+"']").attr("fill","rgba(255, 247, 153, 1)"),e.dispatch){instance.getCurrentFrame().emit(e.dispatch.type,e.dispatch)}void 0!==e.goto&&(null==a?i($(this),e):(a[0],i($(this),e)))}}(u)),"discuss"===u.goto&&(u.items=[{name:"点击问题可显示参考答案"}]),n.append(f);var v=u.items;if(void 0==v||0==v.length)g.css("background-image",'url("#")');else{var y=$('<dl class="timeline-series" id="timeline-series'+h+'"></dl>');f.append(y);for(var _=0;_<v.length;_++){var b=v[_];void 0===b.goto&&(b.goto=u.goto),b.name=function(e){return e=e.replace(/,/g,"，"),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/!/g,"！"),e=e.replace(/\?/g,"？")}(b.name);var x=$('<dt goto="'+b.goto+'" id="custom'+h+_+'" class="timeline-event"><a class="mobile-hide">'+b.name+"</a></dt>");void 0!=b.click&&x.click(function(e,t,i){return r(),function(){controller.dispatchEvent({type:e,data:t})}}(b.click,b.clickParams,b.goto)),x.click(function(e,r){var n=p;return function(a){if($(this).addClass(o),a.stopImmediatePropagation(),void 0!=e){for(var l=0;l<c;l++)$("[class='menuCircle3"+l+"']").attr("fill","rgba(255, 247, 153, 0)");if($("[class='"+n+"']").attr("fill","rgba(255, 247, 153, 1)"),s&&$(this)[0]===s[0]){if(r){instance.getCurrentFrame().emit(r.type,r)}return}var h=instance.gotoStep(e);h&&r&&h.emit(r.type,r);var u=$(this);t($(this)),i(u.parent().parent())}}}(b.goto,b.dispatch)),y.append(x)}}}},n.prototype.updateStyle=function(e){if(1===e)$(".menuCircle1").attr("fill","rgba(0, 183, 238, 1)"),$(".menuCircle1").css({r:"14px"}),$(".menuCircle2").attr("stroke","rgba(255, 255, 255, 1)"),$(".menuCircle2").css({"stroke-width":"2px"}),$(".menuCircle30").attr("fill","rgba(255, 247, 153, 1)"),$(".menuCircle31").attr("fill","rgba(255, 247, 153, 0)"),$(".menuCircle32").attr("fill","rgba(255, 247, 153, 0)"),$(".menuCircle33").attr("fill","rgba(255, 247, 153, 0)"),$(".menuCircle34").attr("fill","rgba(255, 247, 153, 0)"),$(".menuCircle35").attr("fill","rgba(255, 247, 153, 0)");else{$(".menuCircle3").hide(),$(".menuCircle1").css({r:"7px"}),$(".menuCircle2").css({"stroke-width":"5px"}),s=0;for(var t=$(".menuCircle1"),i=$(".menuCircle2"),r=t.length,n=0;n<r;n++){var o=this.randomColor();$(t[n]).attr("fill",o),$(i[n]).attr("stroke",o)}}},n.prototype.gotoStep=function(e){this.currentFrame=e},n.prototype.getSelectMenuIndex=function(){return this.currentFrame},e.exports=n},function(e,t,i){"use strict";function r(e){function t(e,t,i){e.global=s(i);for(var r=e.dispatchEvent?e:e.object;r;){var n=!1,o={type:t,data:e,stopPropagation:function(){n=!0}};if(r.dispatchEvent(o),n)break;r=r.parent}}function i(e){var i=o(e);i&&t(i,TouchEvent.TOUCH_BEGIN,e)}function r(e){var i=o(e);e instanceof MouseEvent&&(void 0==i?f&&(t(f,MouseEvent.MOUSE_OUT,e),f=void 0):i.object!=f&&(f&&t(f,MouseEvent.MOUSE_OUT,e),f=i.object,t(i,MouseEvent.MOUSE_OVER,e))),i&&t(i,TouchEvent.TOUCH_MOVE,e)}function n(e){var i=o(e);i&&t(i,TouchEvent.TOUCH_END,e)}function o(e){return l(s(e))}function s(e){if(e instanceof TouchEvent){var t=e.changedTouches[0];return{x:t.clientX,y:t.clientY}}return{x:e.offsetX||e.clientX,y:e.offsetY||e.clientY}}function a(e){var i=o(e);i&&t(i,TouchEvent.TOUCH_END_OUDSIDE,e)}function l(e,t,i){var r=h(),n=c();if(null==r||null==n)return null;var o=e.x,s=e.y,a={x:0,y:0};if(!0===i)a.x=e.x,a.y=e.y;else{var l=$("#threeJS").width(),f=$("#threeJS").height();a.x=o/l*2-1,a.y=-s/f*2+1}u.setFromCamera(a,n);var d;if(null==t){d=r.children.concat();for(var p=0;p<d.length;p++){0===d[p].name.indexOf("nbRef_")&&(d.splice(p,1),p--)}}else d=t;return u.intersectObjects(d,!0)[0]||r}function h(){if(instance.getCurrentFrame){var e,t=instance.getCurrentFrame();return t&&(e=t.threeSystem),e?e.scene:null}}function c(){if(instance.getCurrentFrame){var e,t=instance.getCurrentFrame();return t&&(e=t.threeSystem),e?e.camera:null}}e.addEventListener(MouseEvent.TOUCH_BEGIN,i,!0),e.addEventListener(MouseEvent.TOUCH_MOVE,r,!0),e.addEventListener(MouseEvent.TOUCH_END,n,!0),e.addEventListener(MouseEvent.TOUCH_END_OUDSIDE,a,!0),e.addEventListener(TouchEvent.TOUCH_BEGIN,i,!0),e.addEventListener(TouchEvent.TOUCH_MOVE,r,!0),e.addEventListener(TouchEvent.TOUCH_END,n,!0),e.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,a,!0);var u=this.raycaster=new THREE.Raycaster,f=null;this.getInteractiveObject=l}i(41),e.exports=r},function(e,t,i){var r=i(224);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){e.exports=i.p+"7809726215ef02cc052075c07fe0f487.png"},function(e,t,i){"use strict";function r(){PIXI.Container.call(this);var e=new PIXI.Graphics;e.beginFill(10066329,0),e.drawCircle(0,0,50),e.lineStyle(4,16777215,.7),e.drawCircle(0,0,30),e.drawCircle(0,0,20),e.endFill(),this.addChild(e),TweenMax.to(e,2,{alpha:0,repeat:-1}),TweenMax.to(e.scale,2,{x:1.5,y:1.5,repeat:-1}),this.gra=e}r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.stop=function(){TweenMax.killTweensOf(this.gra)},e.exports=r},function(e,t,i){"use strict";function r(){PIXI.Container.apply(this),this.txt=new PIXI.Text("",l),this.graphics=new PIXI.Graphics,this.addChild(this.graphics),this.addChild(this.txt),this.visible=!1}function n(){for(var e=[0,0,0,0],t=0;t<f.length;t++){var i=f[t],r=i.tip,n=r,l=r.graphics,d=r.txt,p=i.bind;if(0!=n.visible){var m=n.parent.stepRoot.threeSystem.camera,g=new THREE.Vector3;void 0!=p.geometry&&(null===p.geometry.boundingSphere&&p.geometry.computeBoundingSphere(),g=p.geometry.boundingSphere.center),n.tipoffset&&(g=g.clone().add(n.tipoffset));var v=o.obj3DVecToDisPoint(p,g,m,n.parent),y=nb.canvasWidth-nb.stackPosX,_=s.H;n.x=v.x,n.y=v.y;var b={x:Math.floor(v.x/y*2),y:Math.floor(v.y/_*2)},x={},T=Math.PI/2,E=(b.x<<1)+b.y,S=e[E];if(S<4){var w=T/8+3*T/4*S/4;x.x=400*Math.cos(w),x.y=450*Math.sin(w),0==b.x&&(x.x*=-1,x.x-=d.width),0==b.y&&(x.y*=-1)}else{x.x=0==b.x?-400:400,x.y=0==b.y?-300:300}e[E]++,d.x+=(x.x-d.x)/6,d.y+=(x.y-d.y)/6,l.clear(),l.lineStyle(c,u>>8,(255&u)/255);l.drawCircle(0,0,10),l.drawCircle(0,0,15);var M={x:d.x,y:d.y};0==b.x&&(M.x+=d.width);var A=a.interpolate(M,{x:0,y:0},15/a.distance(M,{x:0,y:0}));l.moveTo(A.x,A.y),l.lineTo(M.x,M.y),l.beginFill(h>>8,(255&h)/255),l.drawRect(d.x-4,d.y-4,d.width+8,d.height+8)}}}var o=i(78),s=i(39),a=i(83),l={fill:"#222222",font:'normal 30px "Microsoft Yahei"'},h=4294967193,c=4,u=4294967108,f=[];PIXI.ticker.shared.add(n),r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.setTip=function(e){this.txt.text=e},r.prototype.setOffSet=function(e){e&&(this.tipoffset=new THREE.Vector3,this.tipoffset.setX(e.x||0),this.tipoffset.setY(e.y||0),this.tipoffset.setZ(e.z||0))},r.prototype.bindToObject3D=function(e){for(var t=0;t<f.length;t++)if(f[t].bind===e)throw"已经绑定过了";this.bindTarget=e,f.push({tip:this,bind:e})},r.prototype.removeBind=function(){for(var e=0;e<f.length;e++)if(f[e].bind===this.bindTarget){f.splice(e,1);break}this.bindTarget=void 0},r.prototype.showTip=function(){this.visible=!0,TweenMax.to(this,.4,{alpha:1})},r.showAllTips=function(e){for(var t=0;t<f.length;t++){var i=f[t].tip;i.system===e&&i.showTip()}},r.hideAllTips=function(e){for(var t=0;t<f.length;t++){var i=f[t].tip;i.system===e&&i.hideTip()}},r.prototype.hideTip=function(){var e=this;TweenMax.to(this,.4,{alpha:0,onComplete:function(){e.visible=!1}})},e.exports=r},function(e,t,i){"use strict";(function(t){var i={EYES_OVER:"eyesOver",EYES_OUT:"eyesOut",EYES_HANG_ON:"eyesHangOn"};t.VREvent=i,e.exports=i}).call(t,i(1))},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(e){function t(e,i,o){r(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=PIXI.Sprite.fromFrame("stepPrompt");s.delY=-a.height-30,s.delX=a.width/5,s.addChild(a);var l=new PIXI.Text(e||" ");return l.style.font='24px "Microsoft YaHei"',l.style.fill="#ffffff",l.style.wordWrap=!0,l.style.wordWrapWidth=a.width-120,s.addChildWithSamePos(l),s.transDuration=.5,s.alpha=0,l.x=92,e.length<=7?l.y=35:l.y=20,s.x=(i||0)+s.delX,s.y=(o||0)+s.delY,s}return o(t,e),t}(PIXI.Container);s.prototype.setTip=function(e,t,i){0===this.alpha&&this.hideNotes(),this.setText(e),this.setPosition(t,i)},s.prototype.setText=function(){this.children[1].text=arguments[0]||" ",this.children[1].text.length<=7?this.children[1].y=35:this.children[1].y=20},s.prototype.setPosition=function(e,t){this.x=(e||0)+this.delX,this.y=(t||0)+this.delY},s.prototype.setDuration=function(e){this.transDuration=e||.5},s.prototype.displayNotes=function(){TweenMax.to(this,this.transDuration,{alpha:1})},s.prototype.hideNotes=function(){TweenMax.to(this,this.transDuration,{alpha:0})},e.exports=s},function(e,t,i){(function(e){function i(){if(void 0!==o)return o;if(e.XMLHttpRequest){o=new e.XMLHttpRequest;try{o.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){o=null}}else o=null;return o}function r(e){var t=i();if(!t)return!1;try{return t.responseType=e,t.responseType===e}catch(e){}return!1}function n(e){return"function"==typeof e}t.fetch=n(e.fetch)&&n(e.ReadableStream),t.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),t.blobConstructor=!0}catch(e){}var o,s=void 0!==e.ArrayBuffer,a=s&&n(e.ArrayBuffer.prototype.slice);t.arraybuffer=t.fetch||s&&r("arraybuffer"),t.msstream=!t.fetch&&a&&r("ms-stream"),t.mozchunkedarraybuffer=!t.fetch&&s&&r("moz-chunked-arraybuffer"),t.overrideMimeType=t.fetch||!!i()&&n(i().overrideMimeType),t.vbArray=n(e.VBArray),o=null}).call(t,i(1))},function(e,t,i){"use strict";function r(){}window.THREE&&(r.prototype=Object.create(THREE.EventDispatcher.prototype));var n=new r;e.exports=n},function(e,t,i){"use strict";function r(e){THREE.EventDispatcher.call(this),this.ticker=new PIXI.ticker.Ticker,this.ticker.start(),this.mixer=e;var t=this;e.addEventListener("finished",function(e){t.dispatchEvent(e)})}r.prototype=Object.create(THREE.EventDispatcher.prototype),r.constructor=r,Object.defineProperty(r.prototype,"loop",{get:function(){return this._loop},set:function(e){for(var t=0;t<this.mixer.actions.length;t++){var i=this.mixer.actions[t];i.loop=!0===e?THREE.LoopRepeat:!1===e?THREE.LoopOnce:e}this._loop=e}}),r.prototype.replay=function(){this.play()},r.prototype.play=function(){this.ticker.add(this.update())},r.prototype.stop=function(){this.ticker.remove(this.update())},r.prototype.update=function(){if(void 0==this.updateFunc){var e=this;this.updateFunc=function(t){e.mixer.update(t)}}return 1===arguments.length?void this.updateFunc(arguments[0]):this.updateFunc},r.prototype.setSpeed=function(e){this.ticker.speed=e},e.exports=r},function(e,t,i){"use strict";function r(){}function n(e,t,i){e.name=t.name;var r=t.m.elements;for(var n in r)e.matrix.elements[n]=r[n];void 0!=t.v&&(e.visible=t.v),void 0!=t.ca&&(e.castShadow=t.ca),void 0!=t.re&&(e.receiveShadow=t.re),e.matrix.decompose(e.position,e.quaternion,e.scale),o(e,i)}function o(e,t){window.editor?window.editor.addObject(e):(t.add(e),void 0!=t[e.name]?console.warn(e.name+" 命名重复"):t[e.name]=e)}r.parse=function(e,t){var i;switch(e.type){case 0:n(new THREE.PerspectiveCamera(e.fov,1,e.near,e.far),e,t);break;case 1:var r=new THREE.PointLight(e.hex,e.intensity,e.distance,e.decay);n(r,e,t);break;case 2:var r=new THREE.SpotLight(e.hex,e.intensity,e.distance,e.angle,e.exponent,e.decay);n(r,e,t);break;case 3:var r=new THREE.DirectionalLight(e.hex,e.intensity);n(r,e,t);break;case 4:var r=new THREE.HemisphereLight(e.hex,e.groundColor,e.intensity);n(r,e,t);break;case 5:var r=new THREE.AmbientLight(e.hex);n(r,e,t);break;case 10:var s=e.parameters;if(e.jsonData){var a=new THREE.ObjectLoader,l=a.parse(e.jsonData);o(l,t),i=l}else{var h=new THREE.PlaneGeometry(s.width,s.height,s.widthSegments,s.heightSegments),c=new THREE.MeshPhongMaterial({});i=new THREE.Mesh(h,c),n(i,e,t)}break;case 11:var s=e.parameters;if(e.jsonData){var a=new THREE.ObjectLoader,l=a.parse(e.jsonData);o(l,t),i=l}else{var h=new THREE.BoxGeometry(s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments),c=new THREE.MeshPhongMaterial({});i=new THREE.Mesh(h,c),n(i,e,t)}break;case 12:var s=e.parameters,a=new THREE.ObjectLoader,l=a.parse(e.jsonData);o(l,t),i=l;break;case 30:void 0===t.materialConfMap&&(t.materialConfMap=e);break;case 50:var s=e,u=s.color,f=s.near,d=s.far,p=new THREE.Fog(u,f,d);t.fog=p}i&&(i.ref=e.ref,void 0!=e.ref&&void 0==window.editor&&(i.visible=!e.ref))},e.exports=r},function(e,t,i){"use strict";function r(){this.animations={},this.weightSchedule=[],this.warpSchedule=[],this.reverse=!1,this.parse=function(e){var t=e.material;t.skinning=!0;var i=e.geometry;THREE.SkinnedMesh.call(this,i,t),this.name=e.name,this.mixer=new THREE.AnimationMixer(this);for(var r=0;r<i.animations.length;++r){var n=i.animations[r].name;this.animations[n]=i.animations[r]}};var e=this;this.update=function(t){!0===e.reverse&&(t*=-1),e.mixer.update(1*t/60)},this.setRatio=function(e){e<0&&(e=0),e>1&&(e=1);for(var t=0;t<this.mixer.actions.length;t++){var i=this.mixer.actions[t],r=i.clip.duration;i.actionTime=r*e,i.clipTime=r*e}},this.play=function(e,t){this.mixer.removeAllActions(),t=t||{};for(var i in this.animations)-1!=i.indexOf(e)&&this.mixer.play(new THREE.AnimationAction(this.animations[i],t.startTime,t.timeScale,t.weight,t.loop))},this.crossfade=function(e,t,i){this.mixer.removeAllActions();var r=new THREE.AnimationAction(this.animations[e]),n=new THREE.AnimationAction(this.animations[t]);this.mixer.play(r),this.mixer.play(n),this.mixer.crossFade(r,n,i,!1)},this.warp=function(e,t,i){this.mixer.removeAllActions();var r=new THREE.AnimationAction(this.animations[e]),n=new THREE.AnimationAction(this.animations[t]);this.mixer.play(r),this.mixer.play(n),this.mixer.crossFade(r,n,i,!0)},this.applyWeight=function(e,t){var i=this.mixer.findActionByName(e);i&&(i.weight=t)},this.pauseAll=function(){this.mixer.timeScale=0},this.unPauseAll=function(){this.mixer.timeScale=1},this.stopAll=function(){this.mixer.removeAllActions()},this.showModel=function(e){this.visible=e},this.ticker=PIXI.ticker.shared,this.ticker.add(this.update)}r.prototype=Object.create(THREE.SkinnedMesh.prototype),r.prototype.constructor=THREE.BlendCharacter,r.prototype.setAutoUpdate=function(e){!1===e?this.ticker.remove(this.update):this.ticker.add(this.update)},r.prototype.getForward=function(){var e=new THREE.Vector3;return function(){return e.set(-this.matrix.elements[8],-this.matrix.elements[9],-this.matrix.elements[10]),e}},e.exports=r},,,function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,r=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var n=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(n))return e;var o;return o=0===n.indexOf("//")?n:0===n.indexOf("/")?i+n:r+n.replace(/^\.\//,""),"url("+JSON.stringify(o)+")"})}},function(e,t,i){(function(t){var r,n=void 0!==t?t:"undefined"!=typeof window?window:this,o=n&&n.BABYLON||r||i(173),r=o,s=this&&this.__decorate||function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,i,s):n(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(e,t){return i.call(this,e,t)||this}return a(r,i),r.prototype.needAlphaBlending=function(){return!0},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(r.prototype,"activeLight",{get:function(){return this._activeLight},set:function(e){this._activeLight=e},enumerable:!0,configurable:!0}),r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(this._activeLight)for(var l=0,h=i._lightSources;l<h.length;l++){var c=h[l];if(c.shadowEnabled){if(this._activeLight===c)break;var u=i._lightSources.indexOf(this._activeLight);-1!==u&&(i._lightSources.splice(u,1),i._lightSources.splice(0,0,this._activeLight));break}}if(e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,1),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!1,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var f=new e.EffectFallbacks;o.FOG&&f.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,f,1),o.NUM_BONE_INFLUENCERS>0&&f.addCPUSkinningFallback(0,i);var d=[e.VertexBuffer.PositionKind];o.NORMAL&&d.push(e.VertexBuffer.NormalKind),e.MaterialHelper.PrepareAttributesForBones(d,i,o,f),e.MaterialHelper.PrepareAttributesForInstances(d,o);var p=o.toString(),m=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","mBones","vClipPlane"],g=new Array,v=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:m,uniformBuffersNames:v,samplers:g,defines:o,maxSimultaneousLights:1}),r.setEffect(s.getEngine().createEffect("shadowOnly",{attributes:d,uniformsNames:m,uniformBuffersNames:v,samplers:g,defines:p,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),e.MaterialHelper.BindEyePosition(s,n)),n.lightsEnabled&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,1),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.ShadowOnlyMaterial",t},r.prototype.getClassName=function(){return"ShadowOnlyMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},r}(e.PushMaterial);e.ShadowOnlyMaterial=i}(r||(r={})),r.Effect.ShadersStore.shadowOnlyVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.shadowOnlyPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform float alpha;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..1]\n\nvec4 color=vec4(0.,0.,0.,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n._maxSimultaneousLights=4,n.topColor=new e.Color3(1,0,0),n.topColorAlpha=1,n.bottomColor=new e.Color3(0,0,1),n.bottomColorAlpha=1,n.offset=0,n.smoothness=1,n.disableLighting=!1,n._scaledDiffuse=new e.Color3,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},r.prototype.needAlphaTesting=function(){return!0},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!1,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix","topColor","bottomColor","offset","smoothness"],f=["diffuseSampler"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:4}),r.setEffect(s.getEngine().createEffect("gradient",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,s),this._mustRebind(n,s)&&(e.MaterialHelper.BindClipPlane(s,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){return[]},r.prototype.dispose=function(e){i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.GradientMaterial",t},r.prototype.getClassName=function(){return"GradientMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),s([e.serializeAsColor3()],r.prototype,"topColor",void 0),s([e.serialize()],r.prototype,"topColorAlpha",void 0),s([e.serializeAsColor3()],r.prototype,"bottomColor",void 0),s([e.serialize()],r.prototype,"bottomColorAlpha",void 0),s([e.serialize()],r.prototype,"offset",void 0),s([e.serialize()],r.prototype,"smoothness",void 0),s([e.serialize()],r.prototype,"disableLighting",void 0),r}(e.PushMaterial);e.GradientMaterial=i}(r||(r={})),r.Effect.ShadersStore.gradientVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex> \ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.gradientPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nuniform vec4 topColor;\nuniform vec4 bottomColor;\nuniform float offset;\nuniform float smoothness;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\nfloat h=normalize(vPositionW).y+offset;\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\n\nvec3 diffuseColor=baseColor.rgb;\n\nfloat alpha=baseColor.a;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n._disableLighting=!1,n._maxSimultaneousLights=4,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled&&this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix"],f=["diffuseSampler"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:4}),r.setEffect(s.getEngine().createEffect("normal",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this.diffuseTexture===e},r.prototype.dispose=function(e){this.diffuseTexture&&this.diffuseTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.NormalMaterial",t},r.prototype.getClassName=function(){return"NormalMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.NormalMaterial=i}(r||(r={})),r.Effect.ShadersStore.normalVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.normalPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef NORMAL\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.speed=1,n.movingSpeed=1,n.lowFrequencySpeed=1,n.fogDensity=.15,n._lastTime=0,n.diffuseColor=new e.Color3(1,1,1),n._disableLighting=!1,n._maxSimultaneousLights=4,n._scaledDiffuse=new e.Color3,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled&&this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],f=["diffuseSampler","noiseTexture"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("lava",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._lastTime+=n.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1e3),this.fogColor||(this.fogColor=e.Color3.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&e.push(this.noiseTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this.diffuseTexture===e},r.prototype.dispose=function(e){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.LavaMaterial",t},r.prototype.getClassName=function(){return"LavaMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsTexture()],r.prototype,"noiseTexture",void 0),s([e.serializeAsColor3()],r.prototype,"fogColor",void 0),s([e.serialize()],r.prototype,"speed",void 0),s([e.serialize()],r.prototype,"movingSpeed",void 0),s([e.serialize()],r.prototype,"lowFrequencySpeed",void 0),s([e.serialize()],r.prototype,"fogDensity",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.LavaMaterial=i}(r||(r={})),r.Effect.ShadersStore.lavaVertexShader="precision highp float;\n\nuniform float time;\nuniform float lowFrequencySpeed;\n\nvarying float noise;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n\n\nvec3 mod289(vec3 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 mod289(vec4 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 permute(vec4 x)\n{\nreturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159-0.85373472095314*r;\n}\nvec3 fade(vec3 t) {\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nfloat pnoise(vec3 P,vec3 rep)\n{\nvec3 Pi0=mod(floor(P),rep); \nvec3 Pi1=mod(Pi0+vec3(1.0),rep); \nPi0=mod289(Pi0);\nPi1=mod289(Pi1);\nvec3 Pf0=fract(P); \nvec3 Pf1=Pf0-vec3(1.0); \nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);\nvec4 iy=vec4(Pi0.yy,Pi1.yy);\nvec4 iz0=Pi0.zzzz;\nvec4 iz1=Pi1.zzzz;\nvec4 ixy=permute(permute(ix)+iy);\nvec4 ixy0=permute(ixy+iz0);\nvec4 ixy1=permute(ixy+iz1);\nvec4 gx0=ixy0*(1.0/7.0);\nvec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;\ngx0=fract(gx0);\nvec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);\nvec4 sz0=step(gz0,vec4(0.0));\ngx0-=sz0*(step(0.0,gx0)-0.5);\ngy0-=sz0*(step(0.0,gy0)-0.5);\nvec4 gx1=ixy1*(1.0/7.0);\nvec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;\ngx1=fract(gx1);\nvec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);\nvec4 sz1=step(gz1,vec4(0.0));\ngx1-=sz1*(step(0.0,gx1)-0.5);\ngy1-=sz1*(step(0.0,gy1)-0.5);\nvec3 g000=vec3(gx0.x,gy0.x,gz0.x);\nvec3 g100=vec3(gx0.y,gy0.y,gz0.y);\nvec3 g010=vec3(gx0.z,gy0.z,gz0.z);\nvec3 g110=vec3(gx0.w,gy0.w,gz0.w);\nvec3 g001=vec3(gx1.x,gy1.x,gz1.x);\nvec3 g101=vec3(gx1.y,gy1.y,gz1.y);\nvec3 g011=vec3(gx1.z,gy1.z,gz1.z);\nvec3 g111=vec3(gx1.w,gy1.w,gz1.w);\nvec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));\ng000*=norm0.x;\ng010*=norm0.y;\ng100*=norm0.z;\ng110*=norm0.w;\nvec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));\ng001*=norm1.x;\ng011*=norm1.y;\ng101*=norm1.z;\ng111*=norm1.w;\nfloat n000=dot(g000,Pf0);\nfloat n100=dot(g100,vec3(Pf1.x,Pf0.yz));\nfloat n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));\nfloat n110=dot(g110,vec3(Pf1.xy,Pf0.z));\nfloat n001=dot(g001,vec3(Pf0.xy,Pf1.z));\nfloat n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));\nfloat n011=dot(g011,vec3(Pf0.x,Pf1.yz));\nfloat n111=dot(g111,Pf1);\nvec3 fade_xyz=fade(Pf0);\nvec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);\nvec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);\nfloat n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);\nreturn 2.2*n_xyz;\n}\n\nfloat turbulence( vec3 p ) {\nfloat w=100.0;\nfloat t=-.5;\nfor (float f=1.0 ; f<=10.0 ; f++ ){\nfloat power=pow( 2.0,f );\nt+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );\n}\nreturn t;\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef NORMAL\n\nnoise=10.0*-.10*turbulence( .5*normal+time*1.15 );\n\nfloat b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );\n\nfloat displacement =-1.5*noise+b;\n\nvec3 newPosition=position+normal*displacement;\ngl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}",r.Effect.ShadersStore.lavaPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n\nuniform float time;\nuniform float speed;\nuniform float movingSpeed;\nuniform vec3 fogColor;\nuniform sampler2D noiseTexture;\nuniform float fogDensity;\n\nvarying float noise;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nfloat random( vec3 scale,float seed ){\nreturn fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;\n}\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\n\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );\nvec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;\nvec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;\nT1.x+=noiseTex.x*2.0;\nT1.y+=noiseTex.y*2.0;\nT2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;\nT2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;\nfloat p=texture2D( noiseTexture,T1*3.0 ).a;\nvec4 lavaColor=texture2D( diffuseSampler,T2*4.0);\nvec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );\nbaseColor=temp;\nfloat depth=gl_FragCoord.z*4.0;\nconst float LOG2=1.442695;\nfloat fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );\nfogFactor=1.0-clamp( fogFactor,0.0,1.0 );\nbaseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );\ndiffuseColor=baseColor.rgb;\n\n\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n._disableLighting=!1,n._maxSimultaneousLights=4,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled&&this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix"],f=["diffuseSampler"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("simple",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this.maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this.diffuseTexture===e},r.prototype.dispose=function(e){this._diffuseTexture&&this._diffuseTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.SimpleMaterial",t},r.prototype.getClassName=function(){return"SimpleMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsColor3("diffuse")],r.prototype,"diffuseColor",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.SimpleMaterial=i}(r||(r={})),r.Effect.ShadersStore.simpleVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.simplePixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif \n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.BUMP=!1,t.REFLECTION=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SPECULARTERM=!1,t.LOGARITHMICDEPTH=!1,t.FRESNELSEPARATE=!1,t.BUMPSUPERIMPOSE=!1,t.BUMPAFFECTSREFLECTION=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r,n){void 0===n&&(n=new e.Vector2(512,512));var o=i.call(this,t,r)||this;return o.renderTargetSize=n,o.diffuseColor=new e.Color3(1,1,1),o.specularColor=new e.Color3(0,0,0),o.specularPower=64,o._disableLighting=!1,o._maxSimultaneousLights=4,o.windForce=6,o.windDirection=new e.Vector2(0,1),o.waveHeight=.4,o.bumpHeight=.4,o._bumpSuperimpose=!1,o._fresnelSeparate=!1,o._bumpAffectsReflection=!1,o.waterColor=new e.Color3(.1,.1,.6),o.colorBlendFactor=.2,o.waterColor2=new e.Color3(.1,.1,.6),o.colorBlendFactor2=.2,o.waveLength=.1,o.waveSpeed=1,o._renderTargets=new e.SmartArray(16),o._mesh=null,o._reflectionTransform=e.Matrix.Zero(),o._lastTime=0,o._lastDeltaTime=0,o._createRenderTargets(r,n),o.getRenderTargetTextures=function(){return o._renderTargets.reset(),o._renderTargets.push(o._reflectionRTT),o._renderTargets.push(o._refractionRTT),o._renderTargets},o}return a(r,i),Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!0,configurable:!0}),r.prototype.addToRenderList=function(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)},r.prototype.enableRenderTargets=function(e){var t=e?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)},r.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(r.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled)){if(this.bumpTexture&&e.StandardMaterial.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;o._needUVs=!0,o.BUMP=!0}e.StandardMaterial.ReflectionTextureEnabled&&(o.REFLECTION=!0)}if(e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForMisc(i,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,o),o._areMiscDirty&&(this._fresnelSeparate&&(o.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(o.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(o.BUMPAFFECTSREFLECTION=!0)),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!0,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),this._mesh=i,this._waitingRenderList){for(var l=0;l<this._waitingRenderList.length;l++)this.addToRenderList(s.getNodeByID(this._waitingRenderList[l]));this._waitingRenderList=null}if(o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var h=new e.EffectFallbacks;o.FOG&&h.addFallback(1,"FOG"),o.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(o,h,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&h.addCPUSkinningFallback(0,i);var c=[e.VertexBuffer.PositionKind];o.NORMAL&&c.push(e.VertexBuffer.NormalKind),o.UV1&&c.push(e.VertexBuffer.UVKind),o.UV2&&c.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&c.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(c,i,o,h),e.MaterialHelper.PrepareAttributesForInstances(c,o);var u=o.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed"],d=["normalSampler","refractionSampler","reflectionSampler"],p=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("water",{attributes:c,uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:u,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;if(s&&this._mesh){this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this.bumpTexture&&e.StandardMaterial.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this.maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),e.MaterialHelper.BindLogDepth(o,this._activeEffect,n),e.StandardMaterial.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var a=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(n.getProjectionMatrix()),l=n.getEngine().getDeltaTime();l!==this._lastDeltaTime&&(this._lastDeltaTime=l,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",a),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._afterBind(i,this._activeEffect)}}},r.prototype._createRenderTargets=function(t,i){var r=this;this._refractionRTT=new e.RenderTargetTexture(name+"_refraction",{width:i.x,height:i.y},t,!1,!0),this._refractionRTT.wrapU=e.Texture.MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=e.Texture.MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new e.RenderTargetTexture(name+"_reflection",{width:i.x,height:i.y},t,!1,!0),this._reflectionRTT.wrapU=e.Texture.MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=e.Texture.MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var n,o,s=null,a=e.Matrix.Zero();this._refractionRTT.onBeforeRender=function(){r._mesh&&(n=r._mesh.isVisible,r._mesh.isVisible=!1),s=t.clipPlane;var i=r._mesh?r._mesh.position.y:0;t.clipPlane=e.Plane.FromPositionAndNormal(new e.Vector3(0,i+.05,0),new e.Vector3(0,1,0))},this._refractionRTT.onAfterRender=function(){r._mesh&&(r._mesh.isVisible=n),t.clipPlane=s},this._reflectionRTT.onBeforeRender=function(){r._mesh&&(n=r._mesh.isVisible,r._mesh.isVisible=!1),s=t.clipPlane;var i=r._mesh?r._mesh.position.y:0;t.clipPlane=e.Plane.FromPositionAndNormal(new e.Vector3(0,i-.05,0),new e.Vector3(0,-1,0)),e.Matrix.ReflectionToRef(t.clipPlane,a),o=t.getViewMatrix(),a.multiplyToRef(o,r._reflectionTransform),t.setTransformMatrix(r._reflectionTransform,t.getProjectionMatrix()),t.getEngine().cullBackFaces=!1,t._mirroredCameraPosition=e.Vector3.TransformCoordinates(t.activeCamera.position,a)},this._reflectionRTT.onAfterRender=function(){r._mesh&&(r._mesh.isVisible=n),t.clipPlane=s,t.setTransformMatrix(o,t.getProjectionMatrix()),t.getEngine().cullBackFaces=!0,t._mirroredCameraPosition=null}},r.prototype.getAnimatables=function(){var e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._bumpTexture&&e.push(this._bumpTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._bumpTexture===e},r.prototype.dispose=function(e){this.bumpTexture&&this.bumpTexture.dispose();var t=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=t&&this.getScene().customRenderTargets.splice(t,1),t=-1,t=this.getScene().customRenderTargets.indexOf(this._reflectionRTT),-1!=t&&this.getScene().customRenderTargets.splice(t,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);if(t.customType="BABYLON.WaterMaterial",t.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var i=0;i<this._refractionRTT.renderList.length;i++)t.renderList.push(this._refractionRTT.renderList[i].id);return t},r.prototype.getClassName=function(){return"WaterMaterial"},r.Parse=function(t,i,n){var o=e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n);return o._waitingRenderList=t.renderList,o},r.CreateDefaultMesh=function(t,i){return e.Mesh.CreateGround(t,512,512,32,i,!1)},s([e.serializeAsTexture("bumpTexture")],r.prototype,"_bumpTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serializeAsColor3()],r.prototype,"specularColor",void 0),s([e.serialize()],r.prototype,"specularPower",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),s([e.serialize()],r.prototype,"windForce",void 0),s([e.serializeAsVector2()],r.prototype,"windDirection",void 0),s([e.serialize()],r.prototype,"waveHeight",void 0),s([e.serialize()],r.prototype,"bumpHeight",void 0),s([e.serialize("bumpSuperimpose")],r.prototype,"_bumpSuperimpose",void 0),s([e.expandToProperty("_markAllSubMeshesAsMiscDirty")],r.prototype,"bumpSuperimpose",void 0),s([e.serialize("fresnelSeparate")],r.prototype,"_fresnelSeparate",void 0),s([e.expandToProperty("_markAllSubMeshesAsMiscDirty")],r.prototype,"fresnelSeparate",void 0),s([e.serialize("bumpAffectsReflection")],r.prototype,"_bumpAffectsReflection",void 0),s([e.expandToProperty("_markAllSubMeshesAsMiscDirty")],r.prototype,"bumpAffectsReflection",void 0),s([e.serializeAsColor3()],r.prototype,"waterColor",void 0),s([e.serialize()],r.prototype,"colorBlendFactor",void 0),s([e.serializeAsColor3()],r.prototype,"waterColor2",void 0),s([e.serialize()],r.prototype,"colorBlendFactor2",void 0),s([e.serialize()],r.prototype,"waveLength",void 0),s([e.serialize()],r.prototype,"waveSpeed",void 0),s([e.serialize()],r.prototype,"useLogarithmicDepth",null),r}(e.PushMaterial);e.WaterMaterial=i}(r||(r={})),r.Effect.ShadersStore.waterVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\n\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\n\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x == 0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\nvec3 p=position;\nfloat newY=(sin(((p.x/0.05)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+(cos(((p.z/0.05)+time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\n\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n}\n",r.Effect.ShadersStore.waterPixelShader="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef BUMP\nvarying vec2 vNormalUV;\nvarying vec2 vNormalUV2;\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\n\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\n\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\n\nvec3 eyeVector=normalize(vEyePosition-vPosition);\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(eyeVector,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else \n#ifdef REFLECTION\n\nvec3 eyeVector=normalize(vEyePosition-vPosition);\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(eyeVector,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.UV1=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.BonesPerMesh=0,t.NUM_BONE_INFLUENCERS=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n.speed=1,n._scaledDiffuse=new e.Color3,n._lastTime=0,n}return a(r,i),r.prototype.needAlphaBlending=function(){return!1},r.prototype.needAlphaTesting=function(){return!0},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(o._areMiscDirty&&(o.POINTSIZE=this.pointsCloud||s.forcePointsCloud,o.FOG=s.fogEnabled&&i.applyFog&&s.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!1,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.UV1&&h.push(e.VertexBuffer.UVKind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString();r.setEffect(s.getEngine().createEffect("fire",{attributes:h,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene();if(r._materialDefines){var o=r.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,o)){if(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),n.clipPlane){var s=n.clipPlane;this._activeEffect.setFloat4("vClipPlane",s.normal.x,s.normal.y,s.normal.z,s.d)}this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(o,n)}this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*i.visibility),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._lastTime+=n.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&e.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._distortionTexture&&e.push(this._distortionTexture),this._opacityTexture&&e.push(this._opacityTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this._diffuseTexture===e||(this._distortionTexture===e||this._opacityTexture===e))},r.prototype.getClassName=function(){return"FireMaterial"},r.prototype.dispose=function(e){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.customType="BABYLON.FireMaterial",e.diffuseColor=this.diffuseColor.asArray(),e.speed=this.speed,this._diffuseTexture&&(e._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(e._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(e._opacityTexture=this._opacityTexture.serialize()),e},r.Parse=function(t,i,n){var o=new r(t.name,i);return o.diffuseColor=e.Color3.FromArray(t.diffuseColor),o.speed=t.speed,o.alpha=t.alpha,o.id=t.id,e.Tags.AddTagsTo(o,t.tags),o.backFaceCulling=t.backFaceCulling,o.wireframe=t.wireframe,t._diffuseTexture&&(o._diffuseTexture=e.Texture.Parse(t._diffuseTexture,i,n)),t._distortionTexture&&(o._distortionTexture=e.Texture.Parse(t._distortionTexture,i,n)),t._opacityTexture&&(o._opacityTexture=e.Texture.Parse(t._opacityTexture,i,n)),t.checkReadyOnlyOnce&&(o.checkReadyOnlyOnce=t.checkReadyOnlyOnce),o},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsTexture("distortionTexture")],r.prototype,"_distortionTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"distortionTexture",void 0),s([e.serializeAsTexture("opacityTexture")],r.prototype,"_opacityTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"opacityTexture",void 0),s([e.serializeAsColor3("diffuse")],r.prototype,"diffuseColor",void 0),s([e.serialize()],r.prototype,"speed",void 0),r}(e.PushMaterial);e.FireMaterial=i}(r||(r={})),r.Effect.ShadersStore.fireVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n\nuniform float time;\nuniform float speed;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#ifdef DIFFUSE\nvDiffuseUV=uv;\nvDiffuseUV.y-=0.2;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n#ifdef DIFFUSE\n\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;\nvDistortionCoords1.x=uv.x;\nvDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;\nvDistortionCoords2.x=uv.x;\nvDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;\nvDistortionCoords3.x=uv.x;\nvDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\n#endif\n}\n",r.Effect.ShadersStore.firePixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\nuniform sampler2D distortionSampler;\nuniform sampler2D opacitySampler;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvec4 bx2(vec4 x)\n{\nreturn vec4(2.0)*x-vec4(1.0);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\n\nfloat alpha=1.0;\n#ifdef DIFFUSE\n\nconst float distortionAmount0=0.092;\nconst float distortionAmount1=0.092;\nconst float distortionAmount2=0.092;\nvec2 heightAttenuation=vec2(0.3,0.39);\nvec4 noise0=texture2D(distortionSampler,vDistortionCoords1);\nvec4 noise1=texture2D(distortionSampler,vDistortionCoords2);\nvec4 noise2=texture2D(distortionSampler,vDistortionCoords3);\nvec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;\nvec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);\nvec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\n#ifdef ALPHATEST\nif (opacityColor.r<0.1)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;\nbaseColor*=opacityColor;\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=vec4(baseColor.rgb,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.HEIGHTMAP=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.HIGHLEVEL=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n.furLength=1,n.furAngle=0,n.furColor=new e.Color3(.44,.21,.02),n.furOffset=0,n.furSpacing=12,n.furGravity=new e.Vector3(0,0,0),n.furSpeed=100,n.furDensity=20,n._disableLighting=!1,n._maxSimultaneousLights=4,n.highLevelFur=!0,n._furTime=0,n}return a(r,i),Object.defineProperty(r.prototype,"furTime",{get:function(){return this._furTime},set:function(e){this._furTime=e},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.updateFur=function(){for(var e=1;e<this._meshes.length;e++){var t=this._meshes[e].material;t.furLength=this.furLength,t.furAngle=this.furAngle,t.furGravity=this.furGravity,t.furSpacing=this.furSpacing,t.furSpeed=this.furSpeed,t.furColor=this.furColor,t.diffuseTexture=this.diffuseTexture,t.furTexture=this.furTexture,t.highLevelFur=this.highLevelFur,t.furTime=this.furTime,t.furDensity=this.furDensity}},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&s.texturesEnabled){if(this.diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(this.heightTexture&&a.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;o._needUVs=!0,o.HEIGHTMAP=!0}}if(this.highLevelFur!==o.HIGHLEVEL&&(o.HIGHLEVEL=!0,o.markAsUnprocessed()),e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity"],f=["diffuseSampler","heightTexture","furTexture"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("fur",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),n.getCachedMaterial()!==this&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this.maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._heightTexture&&e.push(this._heightTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this.diffuseTexture===e||this._heightTexture===e)},r.prototype.dispose=function(e){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var t=1;t<this._meshes.length;t++){var r=this._meshes[t].material;r&&r.dispose(e),this._meshes[t].dispose()}i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.FurMaterial",this._meshes&&(t.sourceMeshName=this._meshes[0].name,t.quality=this._meshes.length),t},r.prototype.getClassName=function(){return"FurMaterial"},r.Parse=function(t,i,n){var o=e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n);return t.sourceMeshName&&o.highLevelFur&&i.executeWhenReady(function(){var e=i.getMeshByName(t.sourceMeshName);if(e){var n=r.GenerateTexture("Fur Texture",i);o.furTexture=n,r.FurifyMesh(e,t.quality)}}),o},r.GenerateTexture=function(t,i){for(var r=new e.DynamicTexture("FurTexture "+t,256,i,!0),n=r.getContext(),o=0;o<2e4;++o)n.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",n.fillRect(Math.random()*r.getSize().width,Math.random()*r.getSize().height,2,2);return r.update(!1),r.wrapU=e.Texture.WRAP_ADDRESSMODE,r.wrapV=e.Texture.WRAP_ADDRESSMODE,r},r.FurifyMesh=function(t,i){var n,o=[t],s=t.material;if(!(s instanceof r))throw"The material of the source mesh must be a Fur Material";for(n=1;n<i;n++){var a=new e.FurMaterial(s.name+n,t.getScene());t.getScene().materials.pop(),e.Tags.EnableFor(a),e.Tags.AddTagsTo(a,"furShellMaterial"),a.furLength=s.furLength,a.furAngle=s.furAngle,a.furGravity=s.furGravity,a.furSpacing=s.furSpacing,a.furSpeed=s.furSpeed,a.furColor=s.furColor,a.diffuseTexture=s.diffuseTexture,a.furOffset=n/i,a.furTexture=s.furTexture,a.highLevelFur=s.highLevelFur,a.furTime=s.furTime,a.furDensity=s.furDensity;var l=t.clone(t.name+n);l.material=a,l.skeleton=t.skeleton,l.position=e.Vector3.Zero(),o.push(l)}for(n=1;n<o.length;n++)o[n].parent=t;return t.material._meshes=o,o},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsTexture("heightTexture")],r.prototype,"_heightTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"heightTexture",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serialize()],r.prototype,"furLength",void 0),s([e.serialize()],r.prototype,"furAngle",void 0),s([e.serializeAsColor3()],r.prototype,"furColor",void 0),s([e.serialize()],r.prototype,"furOffset",void 0),s([e.serialize()],r.prototype,"furSpacing",void 0),s([e.serializeAsVector3()],r.prototype,"furGravity",void 0),s([e.serialize()],r.prototype,"furSpeed",void 0),s([e.serialize()],r.prototype,"furDensity",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),s([e.serialize()],r.prototype,"highLevelFur",void 0),s([e.serialize()],r.prototype,"furTime",null),r}(e.PushMaterial);e.FurMaterial=i}(r||(r={})),r.Effect.ShadersStore.furVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform float furLength;\nuniform float furAngle;\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform vec3 furGravity;\nuniform float furTime;\nuniform float furSpacing;\nuniform float furDensity;\n#endif\n#ifdef HEIGHTMAP\nuniform sampler2D heightTexture;\n#endif\n#ifdef HIGHLEVEL\nvarying vec2 vFurUV;\n#endif\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\nvarying float vfur_length;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n\nfloat r=Rand(position);\n#ifdef HEIGHTMAP\n#if __VERSION__>100\nvfur_length=furLength*texture(heightTexture,uv).x;\n#else\nvfur_length=furLength*texture2D(heightTexture,uv).r;\n#endif\n#else \nvfur_length=(furLength*r);\n#endif\nvec3 tangent1=vec3(normal.y,-normal.x,0);\nvec3 tangent2=vec3(-normal.z,0,normal.x);\nr=Rand(tangent1*r);\nfloat J=(2.0+4.0*r);\nr=Rand(tangent2*r);\nfloat K=(2.0+2.0*r);\ntangent1=tangent1*J+tangent2*K;\ntangent1=normalize(tangent1);\nvec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\n#ifdef HIGHLEVEL\n\nvec3 forceDirection=vec3(0.0,0.0,0.0);\nforceDirection.x=sin(furTime+position.x*0.05)*0.2;\nforceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;\nforceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;\nvec3 displacement=vec3(0.0,0.0,0.0);\ndisplacement=furGravity+forceDirection;\nfloat displacementFactor=pow(furOffset,3.0);\nvec3 aNormal=normal;\naNormal.xyz+=displacement*displacementFactor;\nnewPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\n#endif\n#ifdef NORMAL\n#ifdef HIGHLEVEL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0))*aNormal);\n#else\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#endif\n\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#ifdef HIGHLEVEL\nvFurUV=vDiffuseUV*furDensity;\n#endif\n#else\n#ifdef HIGHLEVEL\nvFurUV=uv*furDensity;\n#endif\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.furPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nuniform vec4 furColor;\nuniform float furLength;\nvarying vec3 vPositionW;\nvarying float vfur_length;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform sampler2D furTexture;\nvarying vec2 vFurUV;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<fogFragmentDeclaration>\n#include<clipPlaneFragmentDeclaration>\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=furColor;\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef HIGHLEVEL\n\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));\nif (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {\ndiscard;\n}\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);\nbaseColor=vec4(baseColor.xyz*occlusion,1.1-furOffset);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\n\n#ifdef HIGHLEVEL\nvec4 color=vec4(finalDiffuse,alpha);\n#else\nfloat r=vfur_length/furLength*0.5;\nvec4 color=vec4(finalDiffuse*(0.5+r),alpha);\n#endif\n#include<fogFragment>\ngl_FragColor=color;\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.BUMP=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n.specularColor=new e.Color3(0,0,0),n.specularPower=64,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(s.texturesEnabled){if(this.mixTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this.mixTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}(this.bumpTexture1||this.bumpTexture2||this.bumpTexture3)&&e.StandardMaterial.BumpTextureEnabled&&(o._needUVs=!0,o._needNormals=!0,o.BUMP=!0)}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],f=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("terrain",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),e.StandardMaterial.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),e.StandardMaterial.BumpTextureEnabled&&n.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this.maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._mixTexture&&e.push(this._mixTexture),this._diffuseTexture1&&e.push(this._diffuseTexture1),this._diffuseTexture2&&e.push(this._diffuseTexture2),this._diffuseTexture3&&e.push(this._diffuseTexture3),this._bumpTexture1&&e.push(this._bumpTexture1),this._bumpTexture2&&e.push(this._bumpTexture2),this._bumpTexture3&&e.push(this._bumpTexture3),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this._mixTexture===e||(this._diffuseTexture1===e||(this._diffuseTexture2===e||(this._diffuseTexture3===e||(this._bumpTexture1===e||(this._bumpTexture2===e||this._bumpTexture3===e))))))},r.prototype.dispose=function(e){this.mixTexture&&this.mixTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.TerrainMaterial",t},r.prototype.getClassName=function(){return"TerrainMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture("mixTexture")],r.prototype,"_mixTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"mixTexture",void 0),s([e.serializeAsTexture("diffuseTexture1")],r.prototype,"_diffuseTexture1",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture1",void 0),s([e.serializeAsTexture("diffuseTexture2")],r.prototype,"_diffuseTexture2",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture2",void 0),s([e.serializeAsTexture("diffuseTexture3")],r.prototype,"_diffuseTexture3",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture3",void 0),s([e.serializeAsTexture("bumpTexture1")],r.prototype,"_bumpTexture1",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture1",void 0),s([e.serializeAsTexture("bumpTexture2")],r.prototype,"_bumpTexture2",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture2",void 0),s([e.serializeAsTexture("bumpTexture3")],r.prototype,"_bumpTexture3",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture3",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serializeAsColor3()],r.prototype,"specularColor",void 0),s([e.serialize()],r.prototype,"specularPower",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.TerrainMaterial=i}(r||(r={})),r.Effect.ShadersStore.terrainVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.terrainPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D textureSampler;\nuniform vec2 vTextureInfos;\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\n#endif\n#ifdef BUMP\nuniform sampler2D bump1Sampler;\nuniform sampler2D bump2Sampler;\nuniform sampler2D bump3Sampler;\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\n{ \nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\nbump1Color.rgb*=mixColor.r;\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\nmap=map*255./127.-128./127.;\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\nreturn normalize(TBN*map);\n}\n#endif\nvoid main(void) {\n\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(textureSampler,vTextureUV);\n#if defined(BUMP) && defined(DIFFUSE)\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\ndiffuse1Color.rgb*=baseColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSEX=!1,t.DIFFUSEY=!1,t.DIFFUSEZ=!1,t.BUMPX=!1,t.BUMPY=!1,t.BUMPZ=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.tileSize=1,n.diffuseColor=new e.Color3(1,1,1),n.specularColor=new e.Color3(.2,.2,.2),n.specularPower=64,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&s.texturesEnabled){if(e.StandardMaterial.DiffuseTextureEnabled)for(var l=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],h=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],c=0;c<l.length;c++)if(l[c]){if(!l[c].isReady())return!1;o[h[c]]=!0}if(e.StandardMaterial.BumpTextureEnabled)for(var l=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],h=["BUMPX","BUMPY","BUMPZ"],c=0;c<l.length;c++)if(l[c]){if(!l[c].isReady())return!1;o[h[c]]=!0}}if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var u=new e.EffectFallbacks;o.FOG&&u.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,u,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&u.addCPUSkinningFallback(0,i);var f=[e.VertexBuffer.PositionKind];o.NORMAL&&f.push(e.VertexBuffer.NormalKind),o.VERTEXCOLOR&&f.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(f,i,o,u),e.MaterialHelper.PrepareAttributesForInstances(f,o);var d=o.toString(),p=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","tileSize"],m=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],g=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:p,uniformBuffersNames:g,samplers:m,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("triplanar",{attributes:f,uniformsNames:p,uniformBuffersNames:g,samplers:m,defines:d,fallbacks:u,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),n.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),o.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this.maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&e.push(this._diffuseTextureX),this._diffuseTextureY&&e.push(this._diffuseTextureY),this._diffuseTextureZ&&e.push(this._diffuseTextureZ),this._normalTextureX&&e.push(this._normalTextureX),this._normalTextureY&&e.push(this._normalTextureY),this._normalTextureZ&&e.push(this._normalTextureZ),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||(this._diffuseTextureX===e||(this._diffuseTextureY===e||(this._diffuseTextureZ===e||(this._normalTextureX===e||(this._normalTextureY===e||this._normalTextureZ===e)))))},r.prototype.dispose=function(e){this.mixTexture&&this.mixTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.TriPlanarMaterial",t},r.prototype.getClassName=function(){return"TriPlanarMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture()],r.prototype,"mixTexture",void 0),s([e.serializeAsTexture("diffuseTextureX")],r.prototype,"_diffuseTextureX",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTextureX",void 0),s([e.serializeAsTexture("diffuseTexturY")],r.prototype,"_diffuseTextureY",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTextureY",void 0),s([e.serializeAsTexture("diffuseTextureZ")],r.prototype,"_diffuseTextureZ",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTextureZ",void 0),s([e.serializeAsTexture("normalTextureX")],r.prototype,"_normalTextureX",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"normalTextureX",void 0),s([e.serializeAsTexture("normalTextureY")],r.prototype,"_normalTextureY",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"normalTextureY",void 0),s([e.serializeAsTexture("normalTextureZ")],r.prototype,"_normalTextureZ",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"normalTextureZ",void 0),s([e.serialize()],r.prototype,"tileSize",void 0),s([e.serializeAsColor3()],r.prototype,"diffuseColor",void 0),s([e.serializeAsColor3()],r.prototype,"specularColor",void 0),s([e.serialize()],r.prototype,"specularPower",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.TriPlanarMaterial=i}(r||(r={})),r.Effect.ShadersStore.triplanarVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\n#endif\nuniform float tileSize;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef DIFFUSEX\nvTextureUVX=worldPos.zy/tileSize;\n#endif\n#ifdef DIFFUSEY\nvTextureUVY=worldPos.xz/tileSize;\n#endif\n#ifdef DIFFUSEZ\nvTextureUVZ=worldPos.xy/tileSize;\n#endif\n#ifdef NORMAL\n\nvec3 xtan=vec3(0,0,1);\nvec3 xbin=vec3(0,1,0);\nvec3 ytan=vec3(1,0,0);\nvec3 ybin=vec3(0,0,1);\nvec3 ztan=vec3(1,0,0);\nvec3 zbin=vec3(0,1,0);\nvec3 normalizedNormal=normalize(normal);\nnormalizedNormal*=normalizedNormal;\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\nworldTangent=(world*vec4(worldTangent,1.0)).xyz;\nworldBinormal=(world*vec4(worldBinormal,1.0)).xyz;\nvec3 worldNormal=normalize(cross(worldTangent,worldBinormal));\ntangentSpace[0]=worldTangent;\ntangentSpace[1]=worldBinormal;\ntangentSpace[2]=worldNormal;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.triplanarPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\nuniform sampler2D diffuseSamplerX;\n#ifdef BUMPX\nuniform sampler2D normalSamplerX;\n#endif\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\nuniform sampler2D diffuseSamplerY;\n#ifdef BUMPY\nuniform sampler2D normalSamplerY;\n#endif\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\nuniform sampler2D diffuseSamplerZ;\n#ifdef BUMPZ\nuniform sampler2D normalSamplerZ;\n#endif\n#endif\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(0.,0.,0.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=tangentSpace[2];\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\nnormalW*=normalW;\n#ifdef DIFFUSEX\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\n#ifdef BUMPX\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\n#endif\n#endif\n#ifdef DIFFUSEY\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\n#ifdef BUMPY\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\n#endif\n#endif\n#ifdef DIFFUSEZ\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\n#ifdef BUMPZ\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\n#endif\n#endif\n#ifdef NORMAL\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.POINTSIZE=!1,t.FOG=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.luminance=1,n.turbidity=10,n.rayleigh=2,n.mieCoefficient=.005,n.mieDirectionalG=.8,n.distance=500,n.inclination=.49,n.azimuth=.25,n.sunPosition=new e.Vector3(0,100,0),n.useSunPosition=!1,n._cameraPosition=e.Vector3.Zero(),n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;if(e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!1),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var a=new e.EffectFallbacks;o.FOG&&a.addFallback(1,"FOG");var l=[e.VertexBuffer.PositionKind];o.VERTEXCOLOR&&l.push(e.VertexBuffer.ColorKind);var h=o.toString();r.setEffect(s.getEngine().createEffect("sky",l,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition"],[],h,a,this.onCompiled,this.onError),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene();if(r._materialDefines){var o=r.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,o)){if(n.clipPlane){var s=n.clipPlane;this._activeEffect.setFloat4("vClipPlane",s.normal.x,s.normal.y,s.normal.z,s.d)}this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)}n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect);var a=n.activeCamera;if(a){var l=a.getWorldMatrix();this._cameraPosition.x=l.m[12],this._cameraPosition.y=l.m[13],this._cameraPosition.z=l.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var h=Math.PI*(this.inclination-.5),c=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(c),this.sunPosition.y=this.distance*Math.sin(c)*Math.sin(h),this.sunPosition.z=this.distance*Math.sin(c)*Math.cos(h)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){return[]},r.prototype.dispose=function(e){i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.SkyMaterial",t},r.prototype.getClassName=function(){return"SkyMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serialize()],r.prototype,"luminance",void 0),s([e.serialize()],r.prototype,"turbidity",void 0),s([e.serialize()],r.prototype,"rayleigh",void 0),s([e.serialize()],r.prototype,"mieCoefficient",void 0),s([e.serialize()],r.prototype,"mieDirectionalG",void 0),s([e.serialize()],r.prototype,"distance",void 0),s([e.serialize()],r.prototype,"inclination",void 0),s([e.serialize()],r.prototype,"azimuth",void 0),s([e.serializeAsVector3()],r.prototype,"sunPosition",void 0),s([e.serialize()],r.prototype,"useSunPosition",void 0),r}(e.PushMaterial);e.SkyMaterial=i}(r||(r={})),r.Effect.ShadersStore.skyVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.skyPixelShader="precision highp float;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\nuniform vec3 cameraPosition;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n\n#include<fogFragmentDeclaration>\n\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst vec3 up=vec3(0.0,1.0,0.0);\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\n\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0); \ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n\n\n\nvec3 retColor=curr*whiteScale;\n\n\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n\n#include<fogFragment>\ngl_FragColor=color;\n}\n";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.TRANSPARENT=!1,t.FOG=!1,t.PREMULTIPLYALPHA=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.mainColor=e.Color3.Black(),n.lineColor=e.Color3.Teal(),n.gridRatio=1,n.gridOffset=e.Vector3.Zero(),n.majorUnitFrequency=10,n.minorUnitVisibility=.33,n.opacity=1,n.preMultiplyAlpha=!1,n._gridControl=new e.Vector4(n.gridRatio,n.majorUnitFrequency,n.minorUnitVisibility,n.opacity),n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.opacity<1},r.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;if(o.TRANSPARENT!==this.opacity<1&&(o.TRANSPARENT=!o.TRANSPARENT,o.markAsUnprocessed()),o.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(o.PREMULTIPLYALPHA=!o.PREMULTIPLYALPHA,o.markAsUnprocessed()),e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,!1,this.fogEnabled,o),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var a=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],l=o.toString();r.setEffect(s.getEngine().createEffect("grid",a,["projection","worldView","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view"],[],l,void 0,this.onCompiled,this.onError),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene();if(r._materialDefines){var o=r.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("worldView",t.multiply(n.getViewMatrix())),this._activeEffect.setMatrix("view",n.getViewMatrix()),this._activeEffect.setMatrix("projection",n.getProjectionMatrix()),this._mustRebind(n,o)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl)),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.dispose=function(e){i.prototype.dispose.call(this,e)},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.GridMaterial",t},r.prototype.getClassName=function(){return"GridMaterial"},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsColor3()],r.prototype,"mainColor",void 0),s([e.serializeAsColor3()],r.prototype,"lineColor",void 0),s([e.serialize()],r.prototype,"gridRatio",void 0),s([e.serializeAsColor3()],r.prototype,"gridOffset",void 0),s([e.serialize()],r.prototype,"majorUnitFrequency",void 0),s([e.serialize()],r.prototype,"minorUnitVisibility",void 0),s([e.serialize()],r.prototype,"opacity",void 0),s([e.serialize()],r.prototype,"preMultiplyAlpha",void 0),r}(e.PushMaterial);e.GridMaterial=i}(r||(r={})),r.Effect.ShadersStore.gridVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nuniform mat4 projection;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 worldView;\n\n#ifdef TRANSPARENT\nvarying vec4 vCameraSpacePosition;\n#endif\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\nvoid main(void) {\n#ifdef FOG\nvec4 worldPos=world*vec4(position,1.0);\n#endif\n#include<fogVertex>\nvec4 cameraSpacePosition=worldView*vec4(position,1.0);\ngl_Position=projection*cameraSpacePosition;\n#ifdef TRANSPARENT\nvCameraSpacePosition=cameraSpacePosition;\n#endif\nvPosition=position;\nvNormal=normal;\n}",r.Effect.ShadersStore.gridPixelShader="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\n#ifdef TRANSPARENT\nvarying vec4 vCameraSpacePosition;\n#endif\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\nfloat getVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n} \nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5); \nfractionPartOfPosition/=differentialLength; \nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI); \nreturn result; \n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2; \n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat visibility=getVisibility(position);\nresult*=visibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\n#ifdef TRANSPARENT\nfloat distanceToFragment=length(vCameraSpacePosition.xyz);\nfloat cameraPassThrough=clamp(distanceToFragment-0.25,0.0,1.0);\nfloat opacity=clamp(grid,0.08,cameraPassThrough*gridControl.w*grid);\ngl_FragColor=vec4(color.rgb,opacity);\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n\ngl_FragColor=vec4(color.rgb,1.0);\n#endif\n}";var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.AMBIENT=!1,t.OPACITY=!1,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.SPECULAR=!1,t.BUMP=!1,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.NUM_MORPH_INFLUENCERS=0,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return a(t,e),t.prototype.setReflectionMode=function(e){for(var t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"],i=0,r=t;i<r.length;i++){var n=r[i];this[n]=n===e}},t}(e.MaterialDefines);e.StandardMaterialDefines_OldVer=t;var i=function(i){function r(t,n){var o=i.call(this,t,n)||this;return o.ambientColor=new e.Color3(0,0,0),o.diffuseColor=new e.Color3(1,1,1),o.specularColor=new e.Color3(1,1,1),o.emissiveColor=new e.Color3(0,0,0),o.specularPower=64,o._useAlphaFromDiffuseTexture=!1,o._useEmissiveAsIllumination=!1,o._linkEmissiveWithDiffuse=!1,o._useSpecularOverAlpha=!1,o._useReflectionOverAlpha=!1,o._disableLighting=!1,o._useParallax=!1,o._useParallaxOcclusion=!1,o.parallaxScaleBias=.05,o._roughness=0,o.indexOfRefraction=.98,o.invertRefractionY=!0,o._useLightmapAsShadowmap=!1,o._useReflectionFresnelFromSpecular=!1,o._useGlossinessFromSpecularMapAlpha=!1,o._maxSimultaneousLights=4,o._invertNormalMapX=!1,o._invertNormalMapY=!1,o._twoSidedLighting=!1,o._renderTargets=new e.SmartArray(16),o._worldViewProjectionMatrix=e.Matrix.Zero(),o._globalAmbientColor=new e.Color3(0,0,0),o._attachImageProcessingConfiguration(null),o.getRenderTargetTextures=function(){return o._renderTargets.reset(),r.ReflectionTextureEnabled&&o._reflectionTexture&&o._reflectionTexture.isRenderTarget&&o._renderTargets.push(o._reflectionTexture),r.RefractionTextureEnabled&&o._refractionTexture&&o._refractionTexture.isRenderTarget&&o._renderTargets.push(o._refractionTexture),o._renderTargets},o}return a(r,i),Object.defineProperty(r.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!0,configurable:!0}),r.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(e){t._markAllSubMeshesAsImageProcessingDirty()}))},Object.defineProperty(r.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!0,configurable:!0}),r.prototype.getClassName=function(){return"StandardMaterial_OldVer"},Object.defineProperty(r.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!0,configurable:!0}),r.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},r.prototype.needAlphaTesting=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha},r.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture},r.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},r.prototype.isReadyForSubMesh=function(i,n,o){if(this.isFrozen&&this._wasPreviouslyReady&&n.effect)return!0;n._materialDefines||(n._materialDefines=new t);var s=this.getScene(),a=n._materialDefines;if(!this.checkReadyOnEveryCall&&n.effect&&a._renderId===s.getRenderId())return!0;var l=s.getEngine();if(a._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,a,!0,this._maxSimultaneousLights,this._disableLighting),a._areTexturesDirty){if(a._needUVs=!1,s.texturesEnabled){if(this._diffuseTexture&&r.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.DIFFUSE=!0}else a.DIFFUSE=!1;if(this._ambientTexture&&r.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.AMBIENT=!0}else a.AMBIENT=!1;if(this._opacityTexture&&r.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.OPACITY=!0,a.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else a.OPACITY=!1;if(this._reflectionTexture&&r.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(a._needNormals=!0,a.REFLECTION=!0,a.ROUGHNESS=this._roughness>0,a.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,a.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===e.Texture.INVCUBIC_MODE,a.REFLECTIONMAP_3D=this._reflectionTexture.isCube,this._reflectionTexture.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:a.setReflectionMode("REFLECTIONMAP_CUBIC");break;case e.Texture.EXPLICIT_MODE:a.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case e.Texture.PLANAR_MODE:a.setReflectionMode("REFLECTIONMAP_PLANAR");break;case e.Texture.PROJECTION_MODE:a.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case e.Texture.SKYBOX_MODE:a.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case e.Texture.SPHERICAL_MODE:a.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case e.Texture.EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:a.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case e.Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:a.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED")}}else a.REFLECTION=!1;if(this._emissiveTexture&&r.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.EMISSIVE=!0}else a.EMISSIVE=!1;if(this._lightmapTexture&&r.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.LIGHTMAP=!0,a.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap}else a.LIGHTMAP=!1;if(this._specularTexture&&r.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.SPECULAR=!0,a.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else a.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&r.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;a._needUVs=!0,a.BUMP=!0,a.PARALLAX=this._useParallax,a.PARALLAXOCCLUSION=this._useParallaxOcclusion}else a.BUMP=!1;if(this._refractionTexture&&r.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;a._needUVs=!0,a.REFRACTION=!0,a.REFRACTIONMAP_3D=this._refractionTexture.isCube}else a.REFRACTION=!1;a.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else a.DIFFUSE=!1,a.AMBIENT=!1,a.OPACITY=!1,a.REFLECTION=!1,a.EMISSIVE=!1,a.LIGHTMAP=!1,a.BUMP=!1,a.REFRACTION=!1;a.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),a.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,a.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,a.SPECULAROVERALPHA=this._useSpecularOverAlpha}if(a._areImageProcessingDirty){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(a)}if(a._areFresnelDirty&&(r.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(a.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,a.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,a.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,a.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,a.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,a.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,a._needNormals=!0,a.FRESNEL=!0):a.FRESNEL=!1),e.MaterialHelper.PrepareDefinesForMisc(i,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,a),e.MaterialHelper.PrepareDefinesForAttributes(i,a,!0,!0,!0),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,l,a,!!o),a.isDirty){a.markAsProcessed(),s.resetCachedMaterial();var h=new e.EffectFallbacks;a.REFLECTION&&h.addFallback(0,"REFLECTION"),a.SPECULAR&&h.addFallback(0,"SPECULAR"),a.BUMP&&h.addFallback(0,"BUMP"),a.PARALLAX&&h.addFallback(1,"PARALLAX"),a.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),a.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),a.FOG&&h.addFallback(1,"FOG"),a.POINTSIZE&&h.addFallback(0,"POINTSIZE"),a.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(a,h,this._maxSimultaneousLights),a.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),a.DIFFUSEFRESNEL&&h.addFallback(1,"DIFFUSEFRESNEL"),a.OPACITYFRESNEL&&h.addFallback(2,"OPACITYFRESNEL"),a.REFLECTIONFRESNEL&&h.addFallback(3,"REFLECTIONFRESNEL"),a.EMISSIVEFRESNEL&&h.addFallback(4,"EMISSIVEFRESNEL"),a.FRESNEL&&h.addFallback(4,"FRESNEL");var c=[e.VertexBuffer.PositionKind];a.NORMAL&&c.push(e.VertexBuffer.NormalKind),a.UV1&&c.push(e.VertexBuffer.UVKind),a.UV2&&c.push(e.VertexBuffer.UV2Kind),a.VERTEXCOLOR&&c.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(c,i,a,h),e.MaterialHelper.PrepareAttributesForInstances(c,a),e.MaterialHelper.PrepareAttributesForMorphTargets(c,i,a);var u="default",f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","logarithmicDepthConstant","vTangentSpaceParams"],d=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"],p=["Material","Scene"];e.ImageProcessingConfiguration.PrepareUniforms(f,a),e.ImageProcessingConfiguration.PrepareSamplers(d,a),e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:a,maxSimultaneousLights:this._maxSimultaneousLights}),this.customShaderNameResolve&&(u=this.customShaderNameResolve(u,f,p,d,a));var m=a.toString();n.setEffect(s.getEngine().createEffect(u,{attributes:c,uniformsNames:f,uniformBuffersNames:p,samplers:d,defines:m,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:a.NUM_MORPH_INFLUENCERS}},l),a),this.buildUniformLayout()}return!(!n.effect||!n.effect.isReady())&&(a._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.buildUniformLayout=function(){this._uniformBuffer.addUniform("diffuseLeftColor",4),this._uniformBuffer.addUniform("diffuseRightColor",4),this._uniformBuffer.addUniform("opacityParts",4),this._uniformBuffer.addUniform("reflectionLeftColor",4),this._uniformBuffer.addUniform("reflectionRightColor",4),this._uniformBuffer.addUniform("refractionLeftColor",4),this._uniformBuffer.addUniform("refractionRightColor",4),this._uniformBuffer.addUniform("emissiveLeftColor",4),this._uniformBuffer.addUniform("emissiveRightColor",4),this._uniformBuffer.addUniform("vDiffuseInfos",2),this._uniformBuffer.addUniform("vAmbientInfos",2),this._uniformBuffer.addUniform("vOpacityInfos",2),this._uniformBuffer.addUniform("vReflectionInfos",2),this._uniformBuffer.addUniform("vEmissiveInfos",2),this._uniformBuffer.addUniform("vLightmapInfos",2),this._uniformBuffer.addUniform("vSpecularInfos",2),this._uniformBuffer.addUniform("vBumpInfos",3),this._uniformBuffer.addUniform("diffuseMatrix",16),this._uniformBuffer.addUniform("ambientMatrix",16),this._uniformBuffer.addUniform("opacityMatrix",16),this._uniformBuffer.addUniform("reflectionMatrix",16),this._uniformBuffer.addUniform("emissiveMatrix",16),this._uniformBuffer.addUniform("lightmapMatrix",16),this._uniformBuffer.addUniform("specularMatrix",16),this._uniformBuffer.addUniform("bumpMatrix",16),this._uniformBuffer.addUniform("vTangentSpaceParams",2),this._uniformBuffer.addUniform("refractionMatrix",16),this._uniformBuffer.addUniform("vRefractionInfos",4),this._uniformBuffer.addUniform("vSpecularColor",4),this._uniformBuffer.addUniform("vEmissiveColor",3),this._uniformBuffer.addUniform("vDiffuseColor",4),this._uniformBuffer.addUniform("pointSize",1),this._uniformBuffer.create()},r.prototype.unbind=function(){this._activeEffect&&(this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._activeEffect.setTexture("reflection2DSampler",null),this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._activeEffect.setTexture("refraction2DSampler",null)),i.prototype.unbind.call(this)},r.prototype.bindForSubMesh=function(t,i,n){var o=this.getScene(),s=n._materialDefines;if(s){var a=n.effect;if(a){if(this._activeEffect=a,this.bindOnlyWorldMatrix(t),e.MaterialHelper.BindBonesParameters(i,a),this._mustRebind(o,a,i.visibility)){if(this._uniformBuffer.bindToEffect(a,"Material"),this.bindViewProjection(a),!this._uniformBuffer.useUbo||!this.isFrozen||!this._uniformBuffer.isSync){if(r.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._uniformBuffer.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._uniformBuffer.updateColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._uniformBuffer.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._uniformBuffer.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._uniformBuffer.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._uniformBuffer.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),o.texturesEnabled&&(this._diffuseTexture&&r.DiffuseTextureEnabled&&(this._uniformBuffer.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._uniformBuffer.updateMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._ambientTexture&&r.AmbientTextureEnabled&&(this._uniformBuffer.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),this._uniformBuffer.updateMatrix("ambientMatrix",this._ambientTexture.getTextureMatrix())),this._opacityTexture&&r.OpacityTextureEnabled&&(this._uniformBuffer.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._uniformBuffer.updateMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix())),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._uniformBuffer.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),this._uniformBuffer.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix())),this._emissiveTexture&&r.EmissiveTextureEnabled&&(this._uniformBuffer.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),this._uniformBuffer.updateMatrix("emissiveMatrix",this._emissiveTexture.getTextureMatrix())),this._lightmapTexture&&r.LightmapTextureEnabled&&(this._uniformBuffer.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),this._uniformBuffer.updateMatrix("lightmapMatrix",this._lightmapTexture.getTextureMatrix())),this._specularTexture&&r.SpecularTextureEnabled&&(this._uniformBuffer.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),this._uniformBuffer.updateMatrix("specularMatrix",this._specularTexture.getTextureMatrix())),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&(this._uniformBuffer.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),this._uniformBuffer.updateMatrix("bumpMatrix",this._bumpTexture.getTextureMatrix()),o._mirroredCameraPosition?this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):this._uniformBuffer.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&r.RefractionTextureEnabled)){var l=1;this._refractionTexture.isCube||(this._uniformBuffer.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(l=this._refractionTexture.depth)),this._uniformBuffer.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,l,this.invertRefractionY?-1:1)}this.pointsCloud&&this._uniformBuffer.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&this._uniformBuffer.updateColor4("vSpecularColor",this.specularColor,this.specularPower),this._uniformBuffer.updateColor3("vEmissiveColor",this.emissiveColor),this._uniformBuffer.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility)}if(o.texturesEnabled&&(this._diffuseTexture&&r.DiffuseTextureEnabled&&a.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&r.AmbientTextureEnabled&&a.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&r.OpacityTextureEnabled&&a.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&r.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?a.setTexture("reflectionCubeSampler",this._reflectionTexture):a.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&r.EmissiveTextureEnabled&&a.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&r.LightmapTextureEnabled&&a.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&r.SpecularTextureEnabled&&a.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&o.getEngine().getCaps().standardDerivatives&&r.BumpTextureEnabled&&a.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&r.RefractionTextureEnabled)){var l=1;this._refractionTexture.isCube?a.setTexture("refractionCubeSampler",this._refractionTexture):a.setTexture("refraction2DSampler",this._refractionTexture)}e.MaterialHelper.BindClipPlane(a,o),o.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),e.MaterialHelper.BindEyePosition(a,o),a.setColor3("vAmbientColor",this._globalAmbientColor)}!this._mustRebind(o,a)&&this.isFrozen||(o.lightsEnabled&&!this._disableLighting&&e.MaterialHelper.BindLights(o,i,a,s,this._maxSimultaneousLights),(o.fogEnabled&&i.applyFog&&o.fogMode!==e.Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(a),e.MaterialHelper.BindFogParameters(o,i,a),s.NUM_MORPH_INFLUENCERS&&e.MaterialHelper.BindMorphTargetParameters(i,a),e.MaterialHelper.BindLogDepth(s,a,o),this._imageProcessingConfiguration.bind(this._activeEffect)),this._uniformBuffer.update(),this._afterBind(i,this._activeEffect)}}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),this._ambientTexture&&e.push(this._ambientTexture),this._opacityTexture&&e.push(this._opacityTexture),this._reflectionTexture&&e.push(this._reflectionTexture),this._emissiveTexture&&e.push(this._emissiveTexture),this._specularTexture&&e.push(this._specularTexture),this._bumpTexture&&e.push(this._bumpTexture),this._lightmapTexture&&e.push(this._lightmapTexture),this._refractionTexture&&e.push(this._refractionTexture),e},r.prototype.dispose=function(e,t){t&&(this._diffuseTexture&&this._diffuseTexture.dispose(),this._ambientTexture&&this._ambientTexture.dispose(),this._opacityTexture&&this._opacityTexture.dispose(),this._reflectionTexture&&this._reflectionTexture.dispose(),this._emissiveTexture&&this._emissiveTexture.dispose(),this._specularTexture&&this._specularTexture.dispose(),this._bumpTexture&&this._bumpTexture.dispose(),this._lightmapTexture&&this._lightmapTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose()),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),i.prototype.dispose.call(this,e,t)},r.prototype.clone=function(t){var i=this,n=e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this);return n.name=t,n.id=t,n},r.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},Object.defineProperty(r,"DiffuseTextureEnabled",{get:function(){return r._DiffuseTextureEnabled},set:function(t){r._DiffuseTextureEnabled!==t&&(r._DiffuseTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"AmbientTextureEnabled",{get:function(){return r._AmbientTextureEnabled},set:function(t){r._AmbientTextureEnabled!==t&&(r._AmbientTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"OpacityTextureEnabled",{get:function(){return r._OpacityTextureEnabled},set:function(t){r._OpacityTextureEnabled!==t&&(r._OpacityTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ReflectionTextureEnabled",{get:function(){return r._ReflectionTextureEnabled},set:function(t){r._ReflectionTextureEnabled!==t&&(r._ReflectionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"EmissiveTextureEnabled",{get:function(){return r._EmissiveTextureEnabled},set:function(t){r._EmissiveTextureEnabled!==t&&(r._EmissiveTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SpecularTextureEnabled",{get:function(){return r._SpecularTextureEnabled},set:function(t){r._SpecularTextureEnabled!==t&&(r._SpecularTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"BumpTextureEnabled",{get:function(){return r._BumpTextureEnabled},set:function(t){r._BumpTextureEnabled!==t&&(r._BumpTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"LightmapTextureEnabled",{get:function(){return r._LightmapTextureEnabled},set:function(t){r._LightmapTextureEnabled!==t&&(r._LightmapTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RefractionTextureEnabled",{get:function(){return r._RefractionTextureEnabled},set:function(t){r._RefractionTextureEnabled!==t&&(r._RefractionTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ColorGradingTextureEnabled",{get:function(){return r._ColorGradingTextureEnabled},set:function(t){r._ColorGradingTextureEnabled!==t&&(r._ColorGradingTextureEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.TextureDirtyFlag))},enumerable:!0,configurable:!0}),Object.defineProperty(r,"FresnelEnabled",{get:function(){return r._FresnelEnabled},set:function(t){r._FresnelEnabled!==t&&(r._FresnelEnabled=t,e.Engine.MarkAllMaterialsAsDirty(e.Material.FresnelDirtyFlag))},enumerable:!0,configurable:!0}),r._DiffuseTextureEnabled=!0,r._AmbientTextureEnabled=!0,r._OpacityTextureEnabled=!0,r._ReflectionTextureEnabled=!0,r._EmissiveTextureEnabled=!0,r._SpecularTextureEnabled=!0,r._BumpTextureEnabled=!0,r._LightmapTextureEnabled=!0,r._RefractionTextureEnabled=!0,r._ColorGradingTextureEnabled=!0,r._FresnelEnabled=!0,s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsTexture("ambientTexture")],r.prototype,"_ambientTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTexture",void 0),s([e.serializeAsTexture("opacityTexture")],r.prototype,"_opacityTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"opacityTexture",void 0),s([e.serializeAsTexture("reflectionTexture")],r.prototype,"_reflectionTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),s([e.serializeAsTexture("emissiveTexture")],r.prototype,"_emissiveTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),s([e.serializeAsTexture("specularTexture")],r.prototype,"_specularTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"specularTexture",void 0),s([e.serializeAsTexture("bumpTexture")],r.prototype,"_bumpTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),s([e.serializeAsTexture("lightmapTexture")],r.prototype,"_lightmapTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"lightmapTexture",void 0),s([e.serializeAsTexture("refractionTexture")],r.prototype,"_refractionTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"refractionTexture",void 0),s([e.serializeAsColor3("ambient")],r.prototype,"ambientColor",void 0),s([e.serializeAsColor3("diffuse")],r.prototype,"diffuseColor",void 0),s([e.serializeAsColor3("specular")],r.prototype,"specularColor",void 0),s([e.serializeAsColor3("emissive")],r.prototype,"emissiveColor",void 0),s([e.serialize()],r.prototype,"specularPower",void 0),s([e.serialize("useAlphaFromDiffuseTexture")],r.prototype,"_useAlphaFromDiffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAlphaFromDiffuseTexture",void 0),s([e.serialize("useEmissiveAsIllumination")],r.prototype,"_useEmissiveAsIllumination",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useEmissiveAsIllumination",void 0),s([e.serialize("linkEmissiveWithDiffuse")],r.prototype,"_linkEmissiveWithDiffuse",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"linkEmissiveWithDiffuse",void 0),s([e.serialize("useSpecularOverAlpha")],r.prototype,"_useSpecularOverAlpha",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useSpecularOverAlpha",void 0),s([e.serialize("useReflectionOverAlpha")],r.prototype,"_useReflectionOverAlpha",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useReflectionOverAlpha",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("useParallax")],r.prototype,"_useParallax",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallax",void 0),s([e.serialize("useParallaxOcclusion")],r.prototype,"_useParallaxOcclusion",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallaxOcclusion",void 0),s([e.serialize()],r.prototype,"parallaxScaleBias",void 0),s([e.serialize("roughness")],r.prototype,"_roughness",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),s([e.serialize()],r.prototype,"indexOfRefraction",void 0),s([e.serialize()],r.prototype,"invertRefractionY",void 0),s([e.serialize("useLightmapAsShadowmap")],r.prototype,"_useLightmapAsShadowmap",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),s([e.serializeAsFresnelParameters("diffuseFresnelParameters")],r.prototype,"_diffuseFresnelParameters",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"diffuseFresnelParameters",void 0),s([e.serializeAsFresnelParameters("opacityFresnelParameters")],r.prototype,"_opacityFresnelParameters",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"opacityFresnelParameters",void 0),s([e.serializeAsFresnelParameters("reflectionFresnelParameters")],r.prototype,"_reflectionFresnelParameters",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"reflectionFresnelParameters",void 0),s([e.serializeAsFresnelParameters("refractionFresnelParameters")],r.prototype,"_refractionFresnelParameters",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"refractionFresnelParameters",void 0),s([e.serializeAsFresnelParameters("emissiveFresnelParameters")],r.prototype,"_emissiveFresnelParameters",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"emissiveFresnelParameters",void 0),s([e.serialize("useReflectionFresnelFromSpecular")],r.prototype,"_useReflectionFresnelFromSpecular",void 0),s([e.expandToProperty("_markAllSubMeshesAsFresnelDirty")],r.prototype,"useReflectionFresnelFromSpecular",void 0),s([e.serialize("useGlossinessFromSpecularMapAlpha")],r.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useGlossinessFromSpecularMapAlpha",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),s([e.serialize("invertNormalMapX")],r.prototype,"_invertNormalMapX",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),s([e.serialize("invertNormalMapY")],r.prototype,"_invertNormalMapY",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),s([e.serialize("twoSidedLighting")],r.prototype,"_twoSidedLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"twoSidedLighting",void 0),s([e.serialize()],r.prototype,"useLogarithmicDepth",null),r}(e.PushMaterial);e.StandardMaterial_OldVer=i;var r=function(){function e(){}return e}();e.CustomShaderStructure=r;var n=function(){function e(){}return e}();e.ShaderSpecialParts=n;var o=function(e){function t(){var t=e.call(this)||this;return t.VertexStore="",t.FragmentStore="#include<__decl__defaultFragment>\n#[Fragment_Begin]\n#extension GL_OES_standard_derivatives : enable\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW_helper;\nvarying vec3 localNormal;\nvarying vec3 localPosition;\nvec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform sampler2D lightmapSampler;\n#endif\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n\n#[Fragment_Definitions]\n\nvoid main(void) {\n\nvNormalW = vNormalW_helper;\n#[Fragment_MainBegin]\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#[Fragment_Custom_Diffuse]\n\nfloat alpha=vDiffuseColor.a;\n#[Fragment_Custom_Alpha]\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset).rgb*vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\n\n// Apply image processing if relevant. As this applies in linear space, \n// We first move from gamma to linear.\n#ifdef IMAGEPROCESSINGPOSTPROCESS\n\tcolor.rgb = toLinearSpace(color.rgb);\n#else\n\t#ifdef IMAGEPROCESSING\n\t\tcolor.rgb = toLinearSpace(color.rgb);\n\t\tcolor = applyImageProcessing(color);\n\t#endif\n#endif\n\n#[Fragment_Before_FragColor]\ngl_FragColor=color;\n}",t.VertexStore="#include<__decl__defaultVertex>\n\n#[Vertex_Begin]\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 localPosition;\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW_helper;\nvarying vec3 localNormal;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n\n#[Vertex_Definitions]\n\nvoid main(void) {\n    \n    #[Vertex_MainBegin]\n    \nvec3 positionUpdated=position;\n#ifdef NORMAL \nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\n\nlocalPosition = positionUpdated;\n#[Vertex_Before_PositionUpdated]\n\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\n\n#[Vertex_Before_NormalUpdated]\n\nlocalNormal = normalUpdated;\nvNormalW_helper=normalize(vec3(finalWorld*vec4(normalUpdated,0.0)));\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",t}return a(t,e),t}(r);e.ShaderForVer3_0=o;var l=function(){function e(){}return e.Ver3_0="3.0.0",e}();e.StandardShaderVersions=l;var h=function(t){function i(e,i){var r=t.call(this,e,i)||this;return r.CustomParts=new n,r.customShaderNameResolve=r.Builder,r.SelectVersion("3.0.0"),r}return a(i,t),i.prototype.AttachAfterBind=function(e,t){for(var i in this._newUniformInstances){var r=i.toString().split("-");"vec2"==r[0]?t.setVector2(r[1],this._newUniformInstances[i]):"vec3"==r[0]?t.setVector3(r[1],this._newUniformInstances[i]):"vec4"==r[0]?t.setVector4(r[1],this._newUniformInstances[i]):"mat4"==r[0]?t.setMatrix(r[1],this._newUniformInstances[i]):"float"==r[0]&&t.setFloat(r[1],this._newUniformInstances[i])}for(var i in this._newSamplerInstances){var r=i.toString().split("-");"sampler2D"==r[0]&&this._newSamplerInstances[i].isReady&&this._newSamplerInstances[i].isReady()&&t.setTexture(r[1],this._newSamplerInstances[i])}},i.prototype.ReviewUniform=function(e,t){if("uniform"==e)for(var i in this._newUniforms)-1==this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);if("sampler"==e)for(var i in this._newUniforms)-1!=this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);return t},i.prototype.Builder=function(t,r,n,o,s){var a=this;if(this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,i.ShaderIndexer++;var l="custom_"+i.ShaderIndexer;this.ReviewUniform("uniform",r),this.ReviewUniform("sampler",o);var h=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){a.AttachAfterBind(e,t);try{h(e,t)}catch(t){}}},e.Effect.ShadersStore[l+"VertexShader"]=this.ShaderVersion.VertexStore.replace("#[Vertex_Begin]",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#[Vertex_Definitions]",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#[Vertex_MainBegin]",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#[Vertex_Before_PositionUpdated]",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#[Vertex_Before_NormalUpdated]",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:""),e.Effect.ShadersStore[l+"PixelShader"]=this.ShaderVersion.FragmentStore.replace("#[Fragment_Begin]",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#[Fragment_MainBegin]",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#[Fragment_Definitions]",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#[Fragment_Custom_Diffuse]",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#[Fragment_Custom_Alpha]",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#[Fragment_Before_FragColor]",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this._isCreatedShader=!0,this._createdShaderName=l,l},i.prototype.SelectVersion=function(e){switch(e){case"3.0.0":this.ShaderVersion=new o}},i.prototype.AddUniform=function(e,t,i){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances=new Array,this._newUniformInstances=new Array),i&&(t.indexOf("sampler"),this._newUniformInstances[t+"-"+e]=i),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},i.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},i.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},i.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},i.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},i.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},i.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},i.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},i.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},i.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},i.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},i.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},i.ShaderIndexer=1,i}(i);e.CustomMaterial=h}(r||(r={}));var r;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.ALPHATEST=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.NDOTL=!0,t.CUSTOMUSERLIGHTING=!0,t.CELLBASIC=!0,t.DEPTHPREPASS=!1,t.rebuild(),t}return a(t,e),t}(e.MaterialDefines),i=function(i){function r(t,r){var n=i.call(this,t,r)||this;return n.diffuseColor=new e.Color3(1,1,1),n._computeHighLevel=!1,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return a(r,i),r.prototype.needAlphaBlending=function(){return this.alpha<1},r.prototype.needAlphaTesting=function(){return!1},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.isReadyForSubMesh=function(i,r,n){if(this.isFrozen&&this._wasPreviouslyReady&&r.effect)return!0;r._materialDefines||(r._materialDefines=new t);var o=r._materialDefines,s=this.getScene();if(!this.checkReadyOnEveryCall&&r.effect&&this._renderId===s.getRenderId())return!0;var a=s.getEngine();if(o._areTexturesDirty&&(o._needUVs=!1,s.texturesEnabled&&this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;o._needUVs=!0,o.DIFFUSE=!0}if(o.CELLBASIC=!this.computeHighLevel,e.MaterialHelper.PrepareDefinesForMisc(i,s,!1,this.pointsCloud,this.fogEnabled,o),o._needNormals=e.MaterialHelper.PrepareDefinesForLights(s,i,o,!1,this._maxSimultaneousLights,this._disableLighting),e.MaterialHelper.PrepareDefinesForFrameBoundValues(s,a,o,!!n),e.MaterialHelper.PrepareDefinesForAttributes(i,o,!0,!0),o.isDirty){o.markAsProcessed(),s.resetCachedMaterial();var l=new e.EffectFallbacks;o.FOG&&l.addFallback(1,"FOG"),e.MaterialHelper.HandleFallbacksForShadows(o,l,this.maxSimultaneousLights),o.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,i);var h=[e.VertexBuffer.PositionKind];o.NORMAL&&h.push(e.VertexBuffer.NormalKind),o.UV1&&h.push(e.VertexBuffer.UVKind),o.UV2&&h.push(e.VertexBuffer.UV2Kind),o.VERTEXCOLOR&&h.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(h,i,o,l),e.MaterialHelper.PrepareAttributesForInstances(h,o);var c=o.toString(),u=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","diffuseMatrix"],f=["diffuseSampler"],d=new Array;e.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this.maxSimultaneousLights}),r.setEffect(s.getEngine().createEffect("cell",{attributes:h,uniformsNames:u,uniformBuffersNames:d,samplers:f,defines:c,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},a),o)}return!(!r.effect||!r.effect.isReady())&&(this._renderId=s.getRenderId(),this._wasPreviouslyReady=!0,!0)},r.prototype.bindForSubMesh=function(t,i,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;s&&(this._activeEffect=s,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),e.MaterialHelper.BindBonesParameters(i,this._activeEffect),this._mustRebind(n,s)&&(this._diffuseTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),e.MaterialHelper.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),e.MaterialHelper.BindEyePosition(s,n)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*i.visibility),n.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(n,i,this._activeEffect,o,this._maxSimultaneousLights),n.fogEnabled&&i.applyFog&&n.fogMode!==e.Scene.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),e.MaterialHelper.BindFogParameters(n,i,this._activeEffect),this._afterBind(i,this._activeEffect))}},r.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},r.prototype.getActiveTextures=function(){var e=i.prototype.getActiveTextures.call(this);return this._diffuseTexture&&e.push(this._diffuseTexture),e},r.prototype.hasTexture=function(e){return!!i.prototype.hasTexture.call(this,e)||this._diffuseTexture===e},r.prototype.dispose=function(e){this._diffuseTexture&&this._diffuseTexture.dispose(),i.prototype.dispose.call(this,e)},r.prototype.getClassName=function(){return"CellMaterial"},r.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new r(t,i.getScene())},this)},r.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.CellMaterial",t},r.Parse=function(t,i,n){return e.SerializationHelper.Parse(function(){return new r(t.name,i)},t,i,n)},s([e.serializeAsTexture("diffuseTexture")],r.prototype,"_diffuseTexture",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"diffuseTexture",void 0),s([e.serializeAsColor3("diffuse")],r.prototype,"diffuseColor",void 0),s([e.serialize("computeHighLevel")],r.prototype,"_computeHighLevel",void 0),s([e.expandToProperty("_markAllSubMeshesAsTexturesDirty")],r.prototype,"computeHighLevel",void 0),s([e.serialize("disableLighting")],r.prototype,"_disableLighting",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),s([e.serialize("maxSimultaneousLights")],r.prototype,"_maxSimultaneousLights",void 0),s([e.expandToProperty("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),r}(e.PushMaterial);e.CellMaterial=i}(r||(r={})),r.Effect.ShadersStore.cellVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n",r.Effect.ShadersStore.cellPixelShader="precision highp float;\n\nuniform vec3 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\n{\ndiffuseBase=info.diffuse*shadow;\n#ifdef CELLBASIC\nfloat level=1.0;\nif (info.ndl<0.5)\nlevel=0.5;\ndiffuseBase.rgb*vec3(level,level,level);\n#else\nfloat ToonThresholds[4];\nToonThresholds[0]=0.95;\nToonThresholds[1]=0.5;\nToonThresholds[2]=0.2;\nToonThresholds[3]=0.03;\nfloat ToonBrightnessLevels[5];\nToonBrightnessLevels[0]=1.0;\nToonBrightnessLevels[1]=0.8;\nToonBrightnessLevels[2]=0.6;\nToonBrightnessLevels[3]=0.35;\nToonBrightnessLevels[4]=0.2;\nif (info.ndl>ToonThresholds[0])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\n}\nelse if (info.ndl>ToonThresholds[1])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\n}\nelse if (info.ndl>ToonThresholds[2])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\n}\nelse if (info.ndl>ToonThresholds[3])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\n}\nelse\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\n}\n#endif\nreturn max(diffuseBase,vec3(0.2));\n}\nvoid main(void)\n{\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nlightingInfo info;\nvec3 diffuseBase=vec3(0.,0.,0.);\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif \n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",function(t,i){var r=i();t&&t.BABYLON||(e.exports=r)}(this,function(){return r})}).call(t,i(1))},function(e,t,i){"use strict";nb.commonFunc=function(){},nb.commonFunc.shake=function(e,t){if(e instanceof Array)if(0===e.length)console.log("Please input the object which you need!");else for(var i=0;i<e.length;i++)!function(i){var r=e[i],n=r.txt;t.add(TweenMax.to(r,.6,{rotation:1*Math.PI,yoyo:!0,repeat:4,onStart:function(){n.alpha=0}})),t.add(TweenMax.to(r,.6,{rotation:0,onComplete:function(){n.alpha=0}}))}(i);else if(e){var r=e.txt;t.add(TweenMax.to(e,.6,{rotation:1*Math.PI,yoyo:!0,repeat:4,onStart:function(){r.alpha=0}})),t.add(TweenMax.to(e,.6,{rotation:0,onComplete:function(){r.alpha=0}}))}else console.log("Please attach a element!")},nb.commonFunc.initContainer=function(e,t){if(!e)throw"容器不能为空";if(e.capacityScale){t.liquid&&e.liquid.addChild(t.liquid),e.addIntoMask(e.liquid),e.hideLiquid(),t.totalCapacity&&e.setTotalCapacity(t.totalCapacity),t.currentCapacity&&e.setCurrentCapacity(t.currentCapacity),t.text&&e.resetName(t.text);var i=t.color||16777215,r=t.alphaLiquid||0;e.setColor(i,r)}else t.text&&(e.txt.text=t.text);void 0===t.alpha&&(t.alpha=1),e.alpha=t.alpha,0===e.alpha&&(e.visible=!1)},nb.commonFunc.openLid=function(e,t){var i=t?0:1;return e.defaultX=e.x,e.defaultY=e.y,e.defaultAlpha=e.alpha,e.defaultRotation=e.rotation,e.isOpened=!0,TweenMax.to(e,1,{x:e.x-e.width/3,y:e.y-3*e.height,rotation:-120*Math.PI/180,alpha:i,ease:Back.easeOut})},nb.commonFunc.closeLid=function(e){if(e.isOpened)return e.isOpened=!1,TweenMax.to(e,1,{x:e.defaultX,y:e.defaultY,rotation:e.defaultRotation,alpha:e.defaultAlpha,ease:Back.easeIn,delay:-.8});throw"HaHa, you cannot close a closed lid!"},nb.commonFunc.addLid=function(e){e.alpha=0,e.visible=!0;var t=e.y;return e.y-=3*e.height,TweenMax.to(e,1,{alpha:1,y:t})},nb.commonFunc.overLid=function(e,t,i){var r=i||{},n=t?0:1;return e.defaultX=e.x,e.defaultY=e.y,e.defaultAlpha=e.alpha,e.defaultRotation=e.rotation,e.isOpened=!0,TweenMax.to(e,1,{x:e.x+r.x,y:e.y+r.y,alpha:n,ease:Back.easeOut})},nb.commonFunc.addSimpleDrag=function(e,t){e.startD=null,e.reachedD=null,e.notReachedD=null,e.reachedHit=null,e.progressHit=null,e.theD=0,e.scaD=1,t&&(e.startD=t.start||null,e.reachedD=t.reached||null,e.notReachedD=t.notReached||null,e.reachedHitD=t.onhitreach||null,e.progressHitD=t.hitprogress||null,e.theD=t.del||0,e.scaD=t.scale||1),nb.simpleDrag(e,e.theD,e.scaD),e.addEventListener(nb.simpleDrag.event.START_DRAG,e.startD),e.addEventListener(nb.simpleDrag.event.REACH_TARGET,e.reachedD),e.addEventListener(nb.simpleDrag.event.NOT_REACH_TARGET,e.notReachedD),e.addEventListener(nb.simpleDrag.event.REACH_TARGET_HITTED,e.reachedHitD),e.addEventListener(nb.simpleDrag.event.ON_HITTED,e.progressHitD)},nb.commonFunc.removeSimpleDrag=function(e){NBDrag.removeDrag(e),e.removeSimpleDrag(),e.removeEventListener(),e.removeEventListener(nb.simpleDrag.event.START_DRAG,e.startD),e.removeEventListener(nb.simpleDrag.event.REACH_TARGET,e.reachedD),e.removeEventListener(nb.simpleDrag.event.NOT_REACH_TARGET,e.notReachedD),e.removeEventListener(nb.simpleDrag.event.REACH_TARGET_HITTED,e.reachedHitD),e.removeEventListener(nb.simpleDrag.event.ON_HITTED,e.progressHitD)},nb.commonFunc.displayStepEnd=function(e,t){var i=t.width;if(e instanceof Array){if(e.length<=0)throw"elements 数组不能为空";var r=[],n=0,o=i/(e.length+1);return o=Math.min(o,400),e.forEach(function(e){t.addChildWithSamePos(e),r[n]=TweenMax.to(e,1.5,{x:++n*o,y:600,ease:Quad.easeInOut})}),r}return t.addChildWithSamePos(e),TweenMax.to(e,1.5,{x:i/2,y:600,ease:Quad.easeInOut})},nb.commonFunc.initMicroscope=function(e,t){function i(){var i=e.threeSystem,n=i.scene;r=n["0145/model.dae"],n.microscope=r,i.controls.setRotateType(2,{maxRangeY:.8,minRangeY:-.8}),t?nb.microscopeWithThree.apply(r,[i,e,t]):nb.microscopeWithThree.apply(r,[i,e]),r.showTips()}var r=void 0;if(e.threeSystem)i();else{var n=new nb.stem.plguin.THREE(e);e.on("update",function(){n.render()}),e.nbsLoadComplete=function(){i(),t&&(t[0].container?r.addContainerSlides(t):r.addSlides(),r.showSlidesList()),e.title&&(e.title.visible=!0),e.emit("loaded")}}return r},nb.commonFunc.setArg=function(e,t,i){var r=0,n=!0,o=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var h=a.value;try{h[t]=i,r++}catch(e){console.log("%cnb.commonFunc.setArg 发生错误， arr["+r+"]is not defined","color: red");continue}}}catch(e){o=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw s}}},nb.commonFunc.resetName=function(e,t,i){var r=Object.assign({timer:.3,color:"#ffffff",tweenMove:!1},i);TweenMax.to(e,r.timer,{alpha:0,ease:Linear.easeIn,onComplete:function(){e.text=t+"",TweenMax.to(e,r.timer,{alpha:1,ease:Linear.easeIn}),r.color&&(e.style.fill=r.color,e.updateText()),r.tweenMove&&TweenMax.to(e,.4,{x:"+=30",ease:Linear.easeIn,repeat:3,yoyo:!0,onComplete:function(){r.callback&&r.callback()}})}})},nb.commonFunc.getKB=function(e,t){var i=e.x,r=e.y,n=t.y,o=t.x,s=(r-n)/(i-o);return{k:s,b:r-i*s}},e.exports=nb.commonFunc},function(e,t,i){i(196),i(197),i(198),i(199),i(325),i(327),i(329),i(193),i(330),e.exports=i(333)},function(e,t){!function(){window.updateBrowser=function(){window.require?(console.log("xx"),console.log("xx")):nb.stem.isAndroid?(console.log("xx"),console.log("xx")):(console.log("xx"),window.location.href="http://shengwu.nobook.com.cn/browser.html")},"undefined"==typeof Worker&&updateBrowser()}()},function(e,t,i){(function(t,i){var r,r;/**
 * @license
 * pixi.js - v3.0.8
 * Compiled 2017-06-14T11:42:32.249Z
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 *
 *
 * The MIT License
 * 
 * Copyright (c) 2013-2015 Mathew Groves
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 * 
 */
!function(t){e.exports=t()}(function(){var e;return function e(t,i,n){function o(a,l){if(!i[a]){if(!t[a]){var h="function"==typeof r&&r;if(!l&&h)return r(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return o(i||e)},u,u.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof r&&r,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(r,n,o){(function(t,r){/*!
 * async
 * https://github.com/caolan/async
 *
 * Copyright 2010-2014 Caolan McMahon
 * Released under the MIT license
 */
!function(){function o(){}function s(e){return e}function a(e){return!!e}function l(e){return!e}function h(e){return function(){if(null===e)throw new Error("Callback was already called.");e.apply(this,arguments),e=null}}function c(e){return function(){null!==e&&(e.apply(this,arguments),e=null)}}function u(e){return z(e)||"number"==typeof e.length&&e.length>=0&&e.length%1==0}function f(e,t){for(var i=-1,r=e.length;++i<r;)t(e[i],i,e)}function d(e,t){for(var i=-1,r=e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}function p(e){return d(Array(e),function(e,t){return t})}function m(e,t,i){return f(e,function(e,r,n){i=t(i,e,r,n)}),i}function g(e,t){f(H(e),function(i){t(e[i],i)})}function v(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function y(e){var t,i,r=-1;return u(e)?(t=e.length,function(){return r++,r<t?r:null}):(i=H(e),t=i.length,function(){return r++,r<t?i[r]:null})}function _(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),r=Array(i),n=0;n<i;n++)r[n]=arguments[n+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r)}}}function b(e){return function(t,i,r){return e(t,r)}}function x(e){return function(t,i,r){r=c(r||o),t=t||[];var n=y(t);if(e<=0)return r(null);var s=!1,a=0,l=!1;!function o(){if(s&&a<=0)return r(null);for(;a<e&&!l;){var c=n();if(null===c)return s=!0,void(a<=0&&r(null));a+=1,i(t[c],c,h(function(e){a-=1,e?(r(e),l=!0):o()}))}}()}}function T(e){return function(t,i,r){return e(k.eachOf,t,i,r)}}function E(e){return function(t,i,r,n){return e(x(i),t,r,n)}}function S(e){return function(t,i,r){return e(k.eachOfSeries,t,i,r)}}function w(e,t,i,r){r=c(r||o),t=t||[];var n=u(t)?[]:{};e(t,function(e,t,r){i(e,function(e,i){n[t]=i,r(e)})},function(e){r(e,n)})}function M(e,t,i,r){var n=[];e(t,function(e,t,r){i(e,function(i){i&&n.push({index:t,value:e}),r()})},function(){r(d(n.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})}function A(e,t,i,r){M(e,t,function(e,t){i(e,function(e){t(!e)})},r)}function P(e,t,i){return function(r,n,o,s){function a(){s&&s(i(!1,void 0))}function l(e,r,n){if(!s)return n();o(e,function(r){s&&t(r)&&(s(i(!0,e)),s=o=!1),n()})}arguments.length>3?e(r,n,l,a):(s=o,o=n,e(r,l,a))}}function C(e,t){return t}function R(e,t,i){i=i||o;var r=u(t)?[]:{};e(t,function(e,t,i){e(_(function(e,n){n.length<=1&&(n=n[0]),r[t]=n,i(e)}))},function(e){i(e,r)})}function D(e,t,i,r){var n=[];e(t,function(e,t,r){i(e,function(e,t){n=n.concat(t||[]),r(e)})},function(e){r(e,n)})}function I(e,t,i){function r(e,t,i,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(e.started=!0,z(t)||(t=[t]),0===t.length&&e.idle())return k.setImmediate(function(){e.drain()});f(t,function(t){var n={data:t,callback:r||o};i?e.tasks.unshift(n):e.tasks.push(n),e.tasks.length===e.concurrency&&e.saturated()}),k.setImmediate(e.process)}function n(e,t){return function(){s-=1;var i=!1,r=arguments;f(t,function(e){f(a,function(t,r){t!==e||i||(a.splice(r,1),i=!0)}),e.callback.apply(e,r)}),e.tasks.length+s===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var s=0,a=[],l={tasks:[],concurrency:t,payload:i,saturated:o,empty:o,drain:o,started:!1,paused:!1,push:function(e,t){r(l,e,!1,t)},kill:function(){l.drain=o,l.tasks=[]},unshift:function(e,t){r(l,e,!0,t)},process:function(){for(;!l.paused&&s<l.concurrency&&l.tasks.length;){var t=l.payload?l.tasks.splice(0,l.payload):l.tasks.splice(0,l.tasks.length),i=d(t,function(e){return e.data});0===l.tasks.length&&l.empty(),s+=1,a.push(t[0]);var r=h(n(l,t));e(i,r)}},length:function(){return l.tasks.length},running:function(){return s},workersList:function(){return a},idle:function(){return l.tasks.length+s===0},pause:function(){l.paused=!0},resume:function(){if(!1!==l.paused){l.paused=!1;for(var e=Math.min(l.concurrency,l.tasks.length),t=1;t<=e;t++)k.setImmediate(l.process)}}};return l}function O(e){return _(function(t,i){t.apply(null,i.concat([_(function(t,i){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&f(i,function(t){console[e](t)}))})]))})}function F(e){return function(t,i,r){e(p(t),i,r)}}function L(e){return _(function(t,i){var r=_(function(i){var r=this,n=i.pop();return e(t,function(e,t,n){e.apply(r,i.concat([n]))},n)});return i.length?r.apply(this,i):r})}function B(e){return _(function(t){var i=t.pop();t.push(function(){var e=arguments;r?k.setImmediate(function(){i.apply(null,e)}):i.apply(null,e)});var r=!0;e.apply(this,t),r=!1})}var N,k={},V="object"==typeof self&&self.self===self&&self||"object"==typeof r&&r.global===r&&r||this;null!=V&&(N=V.async),k.noConflict=function(){return V.async=N,k};var U=Object.prototype.toString,z=Array.isArray||function(e){return"[object Array]"===U.call(e)},G=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},H=Object.keys||function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t},j="function"==typeof i&&i,W=j?function(e){j(e)}:function(e){setTimeout(e,0)};"object"==typeof t&&"function"==typeof t.nextTick?k.nextTick=t.nextTick:k.nextTick=W,k.setImmediate=j?W:k.nextTick,k.forEach=k.each=function(e,t,i){return k.eachOf(e,b(t),i)},k.forEachSeries=k.eachSeries=function(e,t,i){return k.eachOfSeries(e,b(t),i)},k.forEachLimit=k.eachLimit=function(e,t,i,r){return x(t)(e,b(i),r)},k.forEachOf=k.eachOf=function(e,t,i){function r(e){a--,e?i(e):null===n&&a<=0&&i(null)}i=c(i||o),e=e||[];for(var n,s=y(e),a=0;null!=(n=s());)a+=1,t(e[n],n,h(r));0===a&&i(null)},k.forEachOfSeries=k.eachOfSeries=function(e,t,i){function r(){var o=!0;if(null===s)return i(null);t(e[s],s,h(function(e){if(e)i(e);else{if(null===(s=n()))return i(null);o?k.setImmediate(r):r()}})),o=!1}i=c(i||o),e=e||[];var n=y(e),s=n();r()},k.forEachOfLimit=k.eachOfLimit=function(e,t,i,r){x(t)(e,i,r)},k.map=T(w),k.mapSeries=S(w),k.mapLimit=E(w),k.inject=k.foldl=k.reduce=function(e,t,i,r){k.eachOfSeries(e,function(e,r,n){i(t,e,function(e,i){t=i,n(e)})},function(e){r(e,t)})},k.foldr=k.reduceRight=function(e,t,i,r){var n=d(e,s).reverse();k.reduce(n,t,i,r)},k.transform=function(e,t,i,r){3===arguments.length&&(r=i,i=t,t=z(e)?[]:{}),k.eachOf(e,function(e,r,n){i(t,e,r,n)},function(e){r(e,t)})},k.select=k.filter=T(M),k.selectLimit=k.filterLimit=E(M),k.selectSeries=k.filterSeries=S(M),k.reject=T(A),k.rejectLimit=E(A),k.rejectSeries=S(A),k.any=k.some=P(k.eachOf,a,s),k.someLimit=P(k.eachOfLimit,a,s),k.all=k.every=P(k.eachOf,l,l),k.everyLimit=P(k.eachOfLimit,l,l),k.detect=P(k.eachOf,s,C),k.detectSeries=P(k.eachOfSeries,s,C),k.detectLimit=P(k.eachOfLimit,s,C),k.sortBy=function(e,t,i){function r(e,t){var i=e.criteria,r=t.criteria;return i<r?-1:i>r?1:0}k.map(e,function(e,i){t(e,function(t,r){t?i(t):i(null,{value:e,criteria:r})})},function(e,t){if(e)return i(e);i(null,d(t.sort(r),function(e){return e.value}))})},k.auto=function(e,t,i){function r(e){p.unshift(e)}function n(e){var t=v(p,e);t>=0&&p.splice(t,1)}function s(){l--,f(p.slice(0),function(e){e()})}"function"==typeof arguments[1]&&(i=t,t=null),i=c(i||o);var a=H(e),l=a.length;if(!l)return i(null);t||(t=l);var h={},u=0,d=!1,p=[];r(function(){l||i(null,h)}),f(a,function(o){function a(){return u<t&&m(y,function(e,t){return e&&h.hasOwnProperty(t)},!0)&&!h.hasOwnProperty(o)}function l(){a()&&(u++,n(l),f[f.length-1](p,h))}if(!d){for(var c,f=z(e[o])?e[o]:[e[o]],p=_(function(e,t){if(u--,t.length<=1&&(t=t[0]),e){var r={};g(h,function(e,t){r[t]=e}),r[o]=t,d=!0,i(e,r)}else h[o]=t,k.setImmediate(s)}),y=f.slice(0,f.length-1),b=y.length;b--;){if(!(c=e[y[b]]))throw new Error("Has nonexistent dependency in "+y.join(", "));if(z(c)&&v(c,o)>=0)throw new Error("Has cyclic dependencies")}a()?(u++,f[f.length-1](p,h)):r(l)}})},k.retry=function(e,t,i){function r(e,t){for(;a.times;){var i=!(a.times-=1);s.push(function(e,i){return function(r){e(function(e,t){r(!e||i,{err:e,result:t})},t)}}(a.task,i)),!i&&a.interval>0&&s.push(function(e){return function(t){setTimeout(function(){t(null)},e)}}(a.interval))}k.series(s,function(t,i){i=i[i.length-1],(e||a.callback)(i.err,i.result)})}var n=5,o=0,s=[],a={times:n,interval:o},l=arguments.length;if(l<1||l>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return l<=2&&"function"==typeof e&&(i=t,t=e),"function"!=typeof e&&function(e,t){if("number"==typeof t)e.times=parseInt(t,10)||n;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);e.times=parseInt(t.times,10)||n,e.interval=parseInt(t.interval,10)||o}}(a,e),a.callback=i,a.task=t,a.callback?r():r},k.waterfall=function(e,t){function i(e){return _(function(r,n){if(r)t.apply(null,[r].concat(n));else{var o=e.next();o?n.push(i(o)):n.push(t),B(e).apply(null,n)}})}if(t=c(t||o),!z(e)){var r=new Error("First argument to waterfall must be an array of functions");return t(r)}if(!e.length)return t();i(k.iterator(e))()},k.parallel=function(e,t){R(k.eachOf,e,t)},k.parallelLimit=function(e,t,i){R(x(t),e,i)},k.series=function(e,t){R(k.eachOfSeries,e,t)},k.iterator=function(e){function t(i){function r(){return e.length&&e[i].apply(null,arguments),r.next()}return r.next=function(){return i<e.length-1?t(i+1):null},r}return t(0)},k.apply=_(function(e,t){return _(function(i){return e.apply(null,t.concat(i))})}),k.concat=T(D),k.concatSeries=S(D),k.whilst=function(e,t,i){if(i=i||o,e()){var r=_(function(n,o){n?i(n):e.apply(this,o)?t(r):i.apply(null,[null].concat(o))});t(r)}else i(null)},k.doWhilst=function(e,t,i){var r=0;return k.whilst(function(){return++r<=1||t.apply(this,arguments)},e,i)},k.until=function(e,t,i){return k.whilst(function(){return!e.apply(this,arguments)},t,i)},k.doUntil=function(e,t,i){return k.doWhilst(e,function(){return!t.apply(this,arguments)},i)},k.during=function(e,t,i){i=i||o;var r=_(function(t,r){t?i(t):(r.push(n),e.apply(this,r))}),n=function(e,n){e?i(e):n?t(r):i(null)};e(n)},k.doDuring=function(e,t,i){var r=0;k.during(function(e){r++<1?e(null,!0):t.apply(this,arguments)},e,i)},k.queue=function(e,t){return I(function(t,i){e(t[0],i)},t,1)},k.priorityQueue=function(e,t){function i(e,t){return e.priority-t.priority}function r(e,t,i){for(var r=-1,n=e.length-1;r<n;){var o=r+(n-r+1>>>1);i(t,e[o])>=0?r=o:n=o-1}return r}function n(e,t,n,s){if(null!=s&&"function"!=typeof s)throw new Error("task callback must be a function");if(e.started=!0,z(t)||(t=[t]),0===t.length)return k.setImmediate(function(){e.drain()});f(t,function(t){var a={data:t,priority:n,callback:"function"==typeof s?s:o};e.tasks.splice(r(e.tasks,a,i)+1,0,a),e.tasks.length===e.concurrency&&e.saturated(),k.setImmediate(e.process)})}var s=k.queue(e,t);return s.push=function(e,t,i){n(s,e,t,i)},delete s.unshift,s},k.cargo=function(e,t){return I(e,1,t)},k.log=O("log"),k.dir=O("dir"),k.memoize=function(e,t){var i={},r={},n=Object.prototype.hasOwnProperty;t=t||s;var o=_(function(o){var s=o.pop(),a=t.apply(null,o);n.call(i,a)?k.setImmediate(function(){s.apply(null,i[a])}):n.call(r,a)?r[a].push(s):(r[a]=[s],e.apply(null,o.concat([_(function(e){i[a]=e;var t=r[a];delete r[a];for(var n=0,o=t.length;n<o;n++)t[n].apply(null,e)})])))});return o.memo=i,o.unmemoized=e,o},k.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},k.times=F(k.map),k.timesSeries=F(k.mapSeries),k.timesLimit=function(e,t,i,r){return k.mapLimit(p(e),t,i,r)},k.seq=function(){var e=arguments;return _(function(t){var i=this,r=t[t.length-1];"function"==typeof r?t.pop():r=o,k.reduce(e,t,function(e,t,r){t.apply(i,e.concat([_(function(e,t){r(e,t)})]))},function(e,t){r.apply(i,[e].concat(t))})})},k.compose=function(){return k.seq.apply(null,Array.prototype.reverse.call(arguments))},k.applyEach=L(k.eachOf),k.applyEachSeries=L(k.eachOfSeries),k.forever=function(e,t){function i(e){if(e)return r(e);n(i)}var r=h(t||o),n=B(e);i()},k.ensureAsync=B,k.constant=_(function(e){var t=[null].concat(e);return function(e){return e.apply(this,t)}}),k.wrapSync=k.asyncify=function(e){return _(function(t){var i,r=t.pop();try{i=e.apply(this,t)}catch(e){return r(e)}G(i)&&"function"==typeof i.then?i.then(function(e){r(null,e)}).catch(function(e){r(e.message?e:new Error(e))}):r(null,i)})},"object"==typeof n&&n.exports?n.exports=k:"function"==typeof e&&e.amd?e([],function(){return k}):V.async=k}()}).call(this,r("_process"),void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:7}],2:[function(e,t,i){"use strict";function r(e,t,i){i=i||2;var r=t&&t.length,o=r?t[0]*i:e.length,a=n(e,0,o,i,!0),l=[];if(!a)return l;var h,c,f,d,p,m,g;if(r&&(a=u(e,t,a,i)),e.length>80*i){h=f=e[0],c=d=e[1];for(var v=i;v<o;v+=i)p=e[v],m=e[v+1],p<h&&(h=p),m<c&&(c=m),p>f&&(f=p),m>d&&(d=m);g=Math.max(f-h,d-c)}return s(a,l,i,h,c,g),l}function n(e,t,i,r,n){var o,s;if(n===D(e,t,i,r)>0)for(o=t;o<i;o+=r)s=P(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=P(o,e[o],e[o+1],s);return s&&T(s,s.next)&&(C(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!T(r,r.next)&&0!==x(r.prev,r,r.next))r=r.next;else{if(C(r),(r=t=r.prev)===r.next)return null;i=!0}}while(i||r!==t);return t}function s(e,t,i,r,n,u,f){if(e){!f&&u&&m(e,r,n,u);for(var d,p,g=e;e.prev!==e.next;)if(d=e.prev,p=e.next,u?l(e,r,n,u):a(e))t.push(d.i/i),t.push(e.i/i),t.push(p.i/i),C(e),e=p.next,g=p.next;else if((e=p)===g){f?1===f?(e=h(e,t,i),s(e,t,i,r,n,u,2)):2===f&&c(e,t,i,r,n,u):s(o(e),t,i,r,n,u,1);break}}}function a(e){var t=e.prev,i=e,r=e.next;if(x(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(_(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&x(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function l(e,t,i,r){var n=e.prev,o=e,s=e.next;if(x(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,c=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,u=v(a,l,t,i,r),f=v(h,c,t,i,r),d=e.nextZ;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&_(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&x(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function h(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!T(n,o)&&E(n,r,r.next,o)&&w(n,o)&&w(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),C(r),C(r.next),r=e=o),r=r.next}while(r!==e);return r}function c(e,t,i,r,n,a){var l=e;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&b(l,h)){var c=A(l,h);return l=o(l,l.next),c=o(c,c.next),s(l,t,i,r,n,a),void s(c,t,i,r,n,a)}h=h.next}l=l.next}while(l!==e)}function u(e,t,i,r){var s,a,l,h,c,u=[];for(s=0,a=t.length;s<a;s++)l=t[s]*r,h=s<a-1?t[s+1]*r:e.length,c=n(e,l,h,r,!1),c===c.next&&(c.steiner=!0),u.push(y(c));for(u.sort(f),s=0;s<u.length;s++)d(u[s],i),i=o(i,i.next);return i}function f(e,t){return e.x-t.x}function d(e,t){if(t=p(e,t)){var i=A(t,e);o(i,i.next)}}function p(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var l,h=i,c=i.x,u=i.y,f=1/0;for(r=i.next;r!==h;)n>=r.x&&r.x>=c&&_(o<u?n:s,o,c,u,o<u?s:n,o,r.x,r.y)&&((l=Math.abs(o-r.y)/(n-r.x))<f||l===f&&r.x>i.x)&&w(r,e)&&(i=r,f=l),r=r.next;return i}function m(e,t,i,r){var n=e;do{null===n.z&&(n.z=v(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,g(n)}function g(e){var t,i,r,n,o,s,a,l,h=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<h&&(a++,r=r.nextZ);t++);for(l=h;a>0||l>0&&r;)0===a?(n=r,r=r.nextZ,l--):0!==l&&r?i.z<=r.z?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,a--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1);return e}function v(e,t,i,r,n){return e=32767*(e-i)/n,t=32767*(t-r)/n,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function y(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function _(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function b(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!S(e,t)&&w(e,t)&&w(t,e)&&M(e,t)}function x(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function T(e,t){return e.x===t.x&&e.y===t.y}function E(e,t,i,r){return!!(T(e,t)&&T(i,r)||T(e,r)&&T(i,t))||x(e,t,i)>0!=x(e,t,r)>0&&x(i,r,e)>0!=x(i,r,t)>0}function S(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&E(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function w(e,t){return x(e.prev,e,e.next)<0?x(e,t,e.next)>=0&&x(e,e.prev,t)>=0:x(e,t,e.prev)<0||x(e,e.next,t)<0}function M(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}function A(e,t){var i=new R(e.i,e.x,e.y),r=new R(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function P(e,t,i,r){var n=new R(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function D(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}t.exports=r,r.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(D(e,0,o,i));if(n)for(var a=0,l=t.length;a<l;a++){var h=t[a]*i,c=a<l-1?t[a+1]*i:e.length;s-=Math.abs(D(e,h,c,i))}var u=0;for(a=0;a<r.length;a+=3){var f=r[a]*i,d=r[a+1]*i,p=r[a+2]*i;u+=Math.abs((e[f]-e[p])*(e[d+1]-e[f+1])-(e[f]-e[d])*(e[p+1]-e[f+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},r.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i}},{}],3:[function(e,t,i){"use strict";function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(){}var o=Object.prototype.hasOwnProperty,s="function"!=typeof Object.create&&"~";n.prototype._events=void 0,n.prototype.eventNames=function(){var e,t=this._events,i=[];if(!t)return i;for(e in t)o.call(t,e)&&i.push(s?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},n.prototype.listeners=function(e,t){var i=s?s+e:e,r=this._events&&this._events[i];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,a=new Array(o);n<o;n++)a[n]=r[n].fn;return a},n.prototype.emit=function(e,t,i,r,n,o){var a=s?s+e:e;if(!this._events||!this._events[a])return!1;var l,h,c=this._events[a],u=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,n),!0;case 6:return c.fn.call(c.context,t,i,r,n,o),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var f,d=c.length;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,i);break;default:if(!l)for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c[h].fn.apply(c[h].context,l)}}return!0},n.prototype.on=function(e,t,i){var n=new r(t,i||this),o=s?s+e:e;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):this._events[o]=n,this},n.prototype.once=function(e,t,i){var n=new r(t,i||this,!0),o=s?s+e:e;return this._events||(this._events=s?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],n]:this._events[o].push(n):this._events[o]=n,this},n.prototype.removeListener=function(e,t,i,r){var n=s?s+e:e;if(!this._events||!this._events[n])return this;var o=this._events[n],a=[];if(t)if(o.fn)(o.fn!==t||r&&!o.once||i&&o.context!==i)&&a.push(o);else for(var l=0,h=o.length;l<h;l++)(o[l].fn!==t||r&&!o[l].once||i&&o[l].context!==i)&&a.push(o[l]);return a.length?this._events[n]=1===a.length?a[0]:a:delete this._events[n],this},n.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[s?s+e:e]:this._events=s?{}:Object.create(null),this):this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prototype.setMaxListeners=function(){return this},n.prefixed=s,void 0!==t&&(t.exports=n)},{}],4:[function(e,t,i){/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
"use strict";function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,l=r(e),h=1;h<arguments.length;h++){i=Object(arguments[h]);for(var c in i)o.call(i,c)&&(l[c]=i[c]);if(n){a=n(i);for(var u=0;u<a.length;u++)s.call(i,a[u])&&(l[a[u]]=i[a[u]])}}return l}},{}],5:[function(e,t,i){"use strict";t.exports=function(e,t){t=t||{};for(var i={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=i.parser[t.strictMode?"strict":"loose"].exec(e),n={},o=14;o--;)n[i.key[o]]=r[o]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,function(e,t,r){t&&(n[i.q.name][t]=r)}),n}},{}],6:[function(e,t,i){(function(e){function t(e,t){for(var i=0,r=e.length-1;r>=0;r--){var n=e[r];"."===n?e.splice(r,1):".."===n?(e.splice(r,1),i++):i&&(e.splice(r,1),i--)}if(t)for(;i--;i)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var i=[],r=0;r<e.length;r++)t(e[r],r,e)&&i.push(e[r]);return i}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return n.exec(e).slice(1)};i.resolve=function(){for(var i="",n=!1,o=arguments.length-1;o>=-1&&!n;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(i=s+"/"+i,n="/"===s.charAt(0))}return i=t(r(i.split("/"),function(e){return!!e}),!n).join("/"),(n?"/":"")+i||"."},i.normalize=function(e){var n=i.isAbsolute(e),o="/"===s(e,-1);return e=t(r(e.split("/"),function(e){return!!e}),!n).join("/"),e||n||(e="."),e&&o&&(e+="/"),(n?"/":"")+e},i.isAbsolute=function(e){return"/"===e.charAt(0)},i.join=function(){var e=Array.prototype.slice.call(arguments,0);return i.normalize(r(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},i.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=i.resolve(e).substr(1),t=i.resolve(t).substr(1);for(var n=r(e.split("/")),o=r(t.split("/")),s=Math.min(n.length,o.length),a=s,l=0;l<s;l++)if(n[l]!==o[l]){a=l;break}for(var h=[],l=a;l<n.length;l++)h.push("..");return h=h.concat(o.slice(a)),h.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(e){var t=o(e),i=t[0],r=t[1];return i||r?(r&&(r=r.substr(0,r.length-1)),i+r):"."},i.basename=function(e,t){var i=o(e)[2];return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},i.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,i){return e.substr(t,i)}:function(e,t,i){return t<0&&(t=e.length+t),e.substr(t,i)}}).call(this,e("_process"))},{_process:7}],7:[function(e,t,i){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===r||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&l())}function l(){if(!g){var e=o(a);g=!0;for(var t=m.length;t;){for(p=m,m=[];++v<t;)p&&p[v].run();v=-1,t=m.length}p=null,g=!1,s(e)}}function h(e,t){this.fun=e,this.array=t}function c(){}var u,f,d=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:r}catch(e){u=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var p,m=[],g=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];m.push(new h(e,t)),1!==m.length||g||o(l)},h.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.prependListener=c,d.prependOnceListener=c,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],8:[function(e,t,i){"use strict";function r(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(){this._events=new r,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,a="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(a=!1)),o.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)s.call(e,t)&&i.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e,t){var i=a?a+e:e,r=this._events[i];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},o.prototype.emit=function(e,t,i,r,n,o){var s=a?a+e:e;if(!this._events[s])return!1;var l,h,c=this._events[s],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,n),!0;case 6:return c.fn.call(c.context,t,i,r,n,o),!0}for(h=1,l=new Array(u-1);h<u;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var f,d=c.length;for(h=0;h<d;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,i);break;case 4:c[h].fn.call(c[h].context,t,i,r);break;default:if(!l)for(f=1,l=new Array(u-1);f<u;f++)l[f-1]=arguments[f];c[h].fn.apply(c[h].context,l)}}return!0},o.prototype.on=function(e,t,i){var r=new n(t,i||this),o=a?a+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},o.prototype.once=function(e,t,i){var r=new n(t,i||this,!0),o=a?a+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):(this._events[o]=r,this._eventsCount++),this},o.prototype.removeListener=function(e,t,i,n){var o=a?a+e:e;if(!this._events[o])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[o],this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||(0==--this._eventsCount?this._events=new r:delete this._events[o]);else{for(var l=0,h=[],c=s.length;l<c;l++)(s[l].fn!==t||n&&!s[l].once||i&&s[l].context!==i)&&h.push(s[l]);h.length?this._events[o]=1===h.length?h[0]:h:0==--this._eventsCount?this._events=new r:delete this._events[o]}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=a,o.EventEmitter=o,void 0!==t&&(t.exports=o)},{}],9:[function(e,t,i){"use strict";function r(e,t){a.call(this),t=t||l,this.baseUrl=e||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._buffer=[],this._numToLoad=0,this._queue=o.queue(this._boundLoadResource,t),this.resources={}}var n=e("parse-uri"),o=e("./async"),s=e("./Resource"),a=e("eventemitter3"),l=10;r.prototype=Object.create(a.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.add=r.prototype.enqueue=function(e,t,i,r){if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.add(e[n]);return this}if("object"==typeof e&&(r=t||e.callback||e.onComplete,i=e,t=e.url,e=e.name||e.key||e.url),"string"!=typeof t&&(r=i,i=t,t=e),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(r=i,i=null),this.resources[e])throw new Error('Resource with name "'+e+'" already exists.');return t=this._prepareUrl(t),this.resources[e]=new s(e,t,i),"function"==typeof r&&this.resources[e].once("afterMiddleware",r),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[e]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[e]),this._progressChunk=100/this._buffer.length),this},r.prototype.before=r.prototype.pre=function(e){return this._beforeMiddleware.push(e),this},r.prototype.after=r.prototype.use=function(e){return this._afterMiddleware.push(e),this},r.prototype.reset=function(){this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1;for(var e in this.resources){var t=this.resources[e];t.off("complete",this._onLoad,this),t.isLoading&&t.abort()}return this.resources={},this},r.prototype.load=function(e){if("function"==typeof e&&this.once("complete",e),this._queue.started)return this;this.emit("start",this),this.loading=!0;for(var t=0;t<this._buffer.length;++t)this._queue.push(this._buffer[t]);return this._buffer.length=0,this},r.prototype._prepareUrl=function(e){var t=n(e,{strictMode:!0});return t.protocol||!t.path||0===t.path.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e},r.prototype._loadResource=function(e,t){var i=this;e._dequeue=t,o.eachSeries(this._beforeMiddleware,function(t,r){t.call(i,e,function(){r(e.isComplete?{}:null)})},function(){e.isComplete?i._onLoad(e):(e.once("complete",i._onLoad,i),e.load())})},r.prototype._onComplete=function(){this.loading=!1,this.emit("complete",this,this.resources)},r.prototype._onLoad=function(e){var t=this;o.eachSeries(this._afterMiddleware,function(i,r){i.call(t,e,r)},function(){e.emit("afterMiddleware",e),t._numToLoad--,t.progress+=t._progressChunk,t.emit("progress",t,e),e.error?t.emit("error",e.error,t,e):t.emit("load",t,e),0===t._numToLoad&&(t.progress=100,t._onComplete())}),e._dequeue()},r.LOAD_TYPE=s.LOAD_TYPE,r.XHR_RESPONSE_TYPE=s.XHR_RESPONSE_TYPE},{"./Resource":10,"./async":11,eventemitter3:8,"parse-uri":5}],10:[function(e,t,i){"use strict";function r(e,t,i){if(s.call(this),i=i||{},"string"!=typeof e||"string"!=typeof t)throw new Error("Both name and url are required for constructing a resource.");this.name=e,this.url=t,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this.isComplete=!1,this.isLoading=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function n(e){return e.toString().replace("object ","")}function o(e,t,i){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e[t]=i)}var s=e("eventemitter3"),a=e("parse-uri"),l=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),h=null;r.prototype=Object.create(s.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.complete=function(){if(this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.isComplete)throw new Error("Complete called again for an already completed resource.");this.isComplete=!0,this.isLoading=!1,this.emit("complete",this)},r.prototype.abort=function(e){if(!this.error){if(this.error=new Error(e),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(void 0!==this.data.src)this.data.src="";else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}},r.prototype.load=function(e){if(!this.isLoading)if(this.isComplete){if(e){var t=this;setTimeout(function(){e(t)},1)}}else switch(e&&this.once("complete",e),this.isLoading=!0,this.emit("start",this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case r.LOAD_TYPE.IMAGE:this._loadElement("image");break;case r.LOAD_TYPE.AUDIO:this._loadSourceElement("audio");break;case r.LOAD_TYPE.VIDEO:this._loadSourceElement("video");break;case r.LOAD_TYPE.XHR:default:l&&this.crossOrigin?this._loadXdr():this._loadXhr()}},r.prototype._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===e&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url);var t="is"+e[0].toUpperCase()+e.substring(1);!1===this[t]&&(this[t]=!0),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},r.prototype._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===e&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(e),null===this.data)return void this.abort("Unsupported element "+e);if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=0;t<this.url.length;++t)this.data.appendChild(this._createSource(e,this.url[t]));else this.data.appendChild(this._createSource(e,this.url));this["is"+e[0].toUpperCase()+e.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()},r.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),this.xhrType===r.XHR_RESPONSE_TYPE.JSON||this.xhrType===r.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=r.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},r.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XDomainRequest;e.timeout=5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXdrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){e.send()},0)},r.prototype._createSource=function(e,t,i){i||(i=e+"/"+t.substr(t.lastIndexOf(".")+1));var r=document.createElement("source");return r.src=t,r.type=i,r},r.prototype._onError=function(e){this.abort("Failed to load element using "+e.target.nodeName)},r.prototype._onProgress=function(e){e&&e.lengthComputable&&this.emit("progress",this,e.loaded/e.total)},r.prototype._xhrOnError=function(){var e=this.xhr;this.abort(n(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},r.prototype._xhrOnAbort=function(){this.abort(n(this.xhr)+" Request was aborted by the user.")},r.prototype._xdrOnTimeout=function(){this.abort(n(this.xhr)+" Request timed out.")},r.prototype._xhrOnLoad=function(){var e=this.xhr,t=void 0===e.status?e.status:200;if(!(200===t||204===t||0===t&&e.responseText.length>0))return void this.abort("["+e.status+"]"+e.statusText+":"+e.responseURL);if(this.xhrType===r.XHR_RESPONSE_TYPE.TEXT)this.data=e.responseText;else if(this.xhrType===r.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(e.responseText),this.isJson=!0}catch(e){return void this.abort("Error trying to parse loaded json:",e)}else if(this.xhrType===r.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(e.responseText,"text/xml")}else{var n=document.createElement("div");n.innerHTML=e.responseText,this.data=n}this.isXml=!0}catch(e){return void this.abort("Error trying to parse loaded xml:",e)}else this.data=e.response||e.responseText;this.complete()},r.prototype._determineCrossOrigin=function(e,t){if(0===e.indexOf("data:"))return"";t=t||window.location,h||(h=document.createElement("a")),h.href=e,e=a(h.href,{strictMode:!0});var i=!e.port&&""===t.port||e.port===t.port,r=e.protocol?e.protocol+":":"";return e.host===t.hostname&&i&&r===t.protocol?"":"anonymous"},r.prototype._determineXhrType=function(){return r._xhrTypeMap[this._getExtension()]||r.XHR_RESPONSE_TYPE.TEXT},r.prototype._determineLoadType=function(){return r._loadTypeMap[this._getExtension()]||r.LOAD_TYPE.XHR},r.prototype._getExtension=function(){var e=this.url,t="";if(this.isDataUrl){var i=e.indexOf("/");t=e.substring(i+1,e.indexOf(";",i))}else{var r=e.indexOf("?");-1!==r&&(e=e.substring(0,r)),t=e.substring(e.lastIndexOf(".")+1)}return t.toLowerCase()},r.prototype._getMimeFromXhrType=function(e){switch(e){case r.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case r.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case r.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case r.XHR_RESPONSE_TYPE.JSON:return"application/json";case r.XHR_RESPONSE_TYPE.DEFAULT:case r.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},r.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},r.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},r._loadTypeMap={gif:r.LOAD_TYPE.IMAGE,png:r.LOAD_TYPE.IMAGE,bmp:r.LOAD_TYPE.IMAGE,jpg:r.LOAD_TYPE.IMAGE,jpeg:r.LOAD_TYPE.IMAGE,tif:r.LOAD_TYPE.IMAGE,tiff:r.LOAD_TYPE.IMAGE,webp:r.LOAD_TYPE.IMAGE,tga:r.LOAD_TYPE.IMAGE,"svg+xml":r.LOAD_TYPE.IMAGE},r._xhrTypeMap={xhtml:r.XHR_RESPONSE_TYPE.DOCUMENT,html:r.XHR_RESPONSE_TYPE.DOCUMENT,htm:r.XHR_RESPONSE_TYPE.DOCUMENT,xml:r.XHR_RESPONSE_TYPE.DOCUMENT,tmx:r.XHR_RESPONSE_TYPE.DOCUMENT,tsx:r.XHR_RESPONSE_TYPE.DOCUMENT,svg:r.XHR_RESPONSE_TYPE.DOCUMENT,gif:r.XHR_RESPONSE_TYPE.BLOB,png:r.XHR_RESPONSE_TYPE.BLOB,bmp:r.XHR_RESPONSE_TYPE.BLOB,jpg:r.XHR_RESPONSE_TYPE.BLOB,jpeg:r.XHR_RESPONSE_TYPE.BLOB,tif:r.XHR_RESPONSE_TYPE.BLOB,tiff:r.XHR_RESPONSE_TYPE.BLOB,webp:r.XHR_RESPONSE_TYPE.BLOB,tga:r.XHR_RESPONSE_TYPE.BLOB,json:r.XHR_RESPONSE_TYPE.JSON,text:r.XHR_RESPONSE_TYPE.TEXT,txt:r.XHR_RESPONSE_TYPE.TEXT},r.setExtensionLoadType=function(e,t){o(r._loadTypeMap,e,t)},r.setExtensionXhrType=function(e,t){o(r._xhrTypeMap,e,t)}},{eventemitter3:8,"parse-uri":5}],11:[function(e,t,i){"use strict";function r(){}function n(e,t,i){var r=0,n=e.length;!function o(s){if(s||r===n)return void(i&&i(s));t(e[r++],o)}()}function o(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function s(e,t){function i(e,t,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");if(a.started=!0,null==e&&a.idle())return void setTimeout(function(){a.drain()},1);var n={data:e,callback:"function"==typeof i?i:r};t?a._tasks.unshift(n):a._tasks.push(n),setTimeout(function(){a.process()},1)}function n(e){return function(){s-=1,e.callback.apply(e,arguments),null!=arguments[0]&&a.error(arguments[0],e.data),s<=a.concurrency-a.buffer&&a.unsaturated(),a.idle()&&a.drain(),a.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var s=0,a={_tasks:[],concurrency:t,saturated:r,unsaturated:r,buffer:t/4,empty:r,drain:r,error:r,started:!1,paused:!1,push:function(e,t){i(e,!1,t)},kill:function(){a.drain=r,a._tasks=[]},unshift:function(e,t){i(e,!0,t)},process:function(){for(;!a.paused&&s<a.concurrency&&a._tasks.length;){var t=a._tasks.shift();0===a._tasks.length&&a.empty(),s+=1,s===a.concurrency&&a.saturated(),e(t.data,o(n(t)))}},length:function(){return a._tasks.length},running:function(){return s},idle:function(){return a._tasks.length+s===0},pause:function(){!0!==a.paused&&(a.paused=!0)},resume:function(){if(!1!==a.paused){a.paused=!1;for(var e=1;e<=a.concurrency;e++)a.process()}}};return a}t.exports={eachSeries:n,queue:s}},{}],12:[function(e,t,i){"use strict";t.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(e){for(var t,i="",r=new Array(4),n=0,o=0;n<e.length;){for(t=new Array(3),o=0;o<t.length;o++)n<e.length?t[o]=255&e.charCodeAt(n++):t[o]=0;switch(r[0]=t[0]>>2,r[1]=(3&t[0])<<4|t[1]>>4,r[2]=(15&t[1])<<2|t[2]>>6,r[3]=63&t[2],n-(e.length-1)){case 2:r[3]=64,r[2]=64;break;case 1:r[3]=64}for(o=0;o<r.length;o++)i+=this._keyStr.charAt(r[o])}return i}}},{}],13:[function(e,t,i){"use strict";t.exports=e("./Loader"),t.exports.Resource=e("./Resource"),t.exports.middleware={caching:{memory:e("./middlewares/caching/memory")},parsing:{blob:e("./middlewares/parsing/blob")}},t.exports.async=e("./async")},{"./Loader":9,"./Resource":10,"./async":11,"./middlewares/caching/memory":14,"./middlewares/parsing/blob":15}],14:[function(e,t,i){"use strict";var r={};t.exports=function(){return function(e,t){r[e.url]?(e.data=r[e.url],e.complete()):e.once("complete",function(){r[this.url]=this.data}),t()}}},{}],15:[function(e,t,i){"use strict";var r=e("../../Resource"),n=e("../../b64"),o=window.URL||window.webkitURL;t.exports=function(){return function(e,t){if(!e.data)return void t();if(e.xhr&&e.xhrType===r.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof e.data){if(0===e.data.type.indexOf("image")){var i=o.createObjectURL(e.data);return e.blob=e.data,e.data=new Image,e.data.src=i,e.isImage=!0,void(e.data.onload=function(){o.revokeObjectURL(i),e.data.onload=null,t()})}}else{var s=e.xhr.getResponseHeader("content-type");if(s&&0===s.indexOf("image"))return e.data=new Image,e.data.src="data:"+s+";base64,"+n.encodeBinary(e.xhr.responseText),e.isImage=!0,void(e.data.onload=function(){e.data.onload=null,t()})}t()}}},{"../../Resource":10,"../../b64":12}],16:[function(e,t,i){t.exports={name:"pixi.js",version:"3.0.8",description:"Pixi.js is a fast lightweight 2D library that works across all devices.",author:"Mat Groves",contributors:["Chad Engler <chad@pantherdev.com>","Richard Davey <rdavey@gmail.com>"],main:"./src/index.js",homepage:"http://goodboydigital.com/",bugs:"https://github.com/pixijs/pixi.js/issues",license:"MIT",repository:{type:"git",url:"https://github.com/pixijs/pixi.js.git"},scripts:{start:"gulp && gulp watch",test:"gulp && testem ci",build:"gulp",postbuild:"cp bin/pixi.js ../pixi.js",docs:"jsdoc -c ./gulp/util/jsdoc.conf.json -R README.md"},files:["bin/","src/","CONTRIBUTING.md","LICENSE","package.json","README.md"],dependencies:{async:"^1.4.2",brfs:"^1.4.1",earcut:"^2.0.2",eventemitter3:"^1.1.1","gulp-header":"^1.7.1","object-assign":"^4.0.1","resource-loader":"^1.6.2"},devDependencies:{browserify:"^11.1.0",chai:"^3.2.0",del:"^2.0.2",gulp:"^3.9.1","gulp-cached":"^1.1.0","gulp-concat":"^2.6.0","gulp-debug":"^2.1.0","gulp-jshint":"^1.11.2","gulp-mirror":"^0.4.0","gulp-plumber":"^1.0.1","gulp-rename":"^1.2.2","gulp-sourcemaps":"^1.5.2","gulp-uglify":"^1.4.1","gulp-util":"^3.0.6","jaguarjs-jsdoc":"git+https://github.com/davidshimjs/jaguarjs-jsdoc.git",jsdoc:"^3.3.2","jshint-summary":"^0.4.0",minimist:"^1.2.0",mocha:"^2.3.2","require-dir":"^0.3.0","run-sequence":"^1.1.2",testem:"^0.9.4","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.4.0"},browserify:{transform:["brfs"]}}},{}],17:[function(e,t,i){function r(e){var t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=2,this.div=t,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,window.addEventListener("keydown",this._onKeyDown,!1)}var n=e("../core");Object.assign(n.DisplayObject.prototype,e("./accessibleTarget")),r.prototype.constructor=r,t.exports=r,r.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode.appendChild(this.div))},r.prototype.deactivate=function(){this.isActive&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode.removeChild(this.div))},r.prototype.updateAccessibleObjects=function(e){if(e.visible){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,i=t.length-1;i>=0;i--)this.updateAccessibleObjects(t[i])}},r.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),t=e.width/this.renderer.width,i=e.height/this.renderer.height,r=this.div;r.style.left=e.left+"px",r.style.top=e.top+"px",r.style.width=this.renderer.width+"px",r.style.height=this.renderer.height+"px";for(var o=0;o<this.children.length;o++){var s=this.children[o];if(s.renderId!==this.renderId)s._accessibleActive=!1,n.utils.removeItems(this.children,o,1),this.div.removeChild(s._accessibleDiv),this.pool.push(s._accessibleDiv),s._accessibleDiv=null,o--,0===this.children.length&&this.deactivate();else{r=s._accessibleDiv;var a=s.hitArea,l=s.worldTransform;s.hitArea?(r.style.left=(l.tx+a.x*l.a)*t+"px",r.style.top=(l.ty+a.y*l.d)*i+"px",r.style.width=a.width*l.a*t+"px",r.style.height=a.height*l.d*i+"px"):(a=s.getBounds(),this.capHitArea(a),r.style.left=a.x*t+"px",r.style.top=a.y*i+"px",r.style.width=a.width*t+"px",r.style.height=a.height*i+"px")}}this.renderId++},r.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},r.prototype.addChild=function(e){var t=this.pool.pop();t||(t=document.createElement("button"),t.style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2,t.style.borderStyle="none",t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.title=e.accessibleTitle||"displayObject "+this.tabIndex,e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},r.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData)},r.prototype._onFocus=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},r.prototype._onFocusOut=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},r.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},r.prototype._onMouseMove=function(){this.deactivate()},r.prototype.destroy=function(){this.div=null;for(var e=0;e<this.children.length;e++)this.children[e].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},n.WebGLRenderer.registerPlugin("accessibility",r),n.CanvasRenderer.registerPlugin("accessibility",r)},{"../core":27,"./accessibleTarget":18}],18:[function(e,t,i){var r={accessible:!1,accessibleTitle:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1};t.exports=r},{}],19:[function(e,t,i){/**
 * @file        Main export of the PIXI accessibility library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
t.exports={accessibleTarget:e("./accessibleTarget"),AccessibilityManager:e("./AccessibilityManager")}},{"./AccessibilityManager":17,"./accessibleTarget":18}],20:[function(e,t,i){var r={VERSION:e("../../package.json").version,PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};t.exports=r},{"../../package.json":16}],21:[function(e,t,i){function r(){s.call(this),this.children=[]}var n=e("../math"),o=e("../utils"),s=e("./DisplayObject"),a=e("../textures/RenderTexture"),l=new n.Matrix;r.prototype=Object.create(s.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.addChildWithSamePos=function(e){var t=this.toLocal({x:0,y:0},e);e.x=t.x,e.y=t.y,this.addChild(e)},r.prototype.clone=function(){if(void 0!==this._nbData_){var e=instance.createChildFromData(this.parent,this._nbData_);return this.name&&""!==this.name&&(this.parent[this.name]=this),delete this.name,e}return console.warn("无法克隆"),null},Object.defineProperties(r.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e}}}),r.prototype.onChildrenChange=function(){},r.prototype.addChild=function(e){var t=arguments.length;if(t>1)for(var i=0;i<t;i++)this.addChild(arguments[i]);else e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.onChildrenChange(this.children.length-1),e.emit("added",this);return e},r.prototype.addChildAt=function(e,t){if(e===this)return e;if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.onChildrenChange(t),e.emit("added",this),e;throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length)},r.prototype.swapChildren=function(e,t){if(e!==t){var i=this.getChildIndex(e),r=this.getChildIndex(t);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[i]=t,this.children[r]=e,this.onChildrenChange(i<r?i:r)}},r.prototype.getChildIndex=function(e){return this.children.indexOf(e)},r.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(e);o.removeItems(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)},r.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Supplied index "+e+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[e]},r.prototype.removeChild=function(e){var t=arguments.length;if(t>1)for(var i=0;i<t;i++)this.removeChild(arguments[i]);else{var r=this.children.indexOf(e);if(-1===r)return;e.parent=null,o.removeItems(this.children,r,1),this.onChildrenChange(r),e.emit("removed",this)}return e},r.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return t.parent=null,o.removeItems(this.children,e,1),this.onChildrenChange(e),t.emit("removed",this),t},r.prototype.removeChildren=function(e,t){var i,r,n=e||0,o="number"==typeof t?t:this.children.length,s=o-n;if(s>0&&s<=o){for(i=this.children.splice(n,s),r=0;r<i.length;++r)i[r].parent=null;for(this.onChildrenChange(e),r=0;r<i.length;++r)i[r].emit("removed",this);return i}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},r.prototype.generateTexture=function(e,t,i){var r=this.getLocalBounds(),n=new a(e,0|r.width,0|r.height,i,t);return l.tx=-r.x,l.ty=-r.y,n.render(this,l),n},r.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var e=0,t=this.children.length;e<t;++e)this.children[e].updateTransform()}},r.prototype.containerUpdateTransform=r.prototype.updateTransform,r.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return n.Rectangle.EMPTY;for(var e,t,i,r=1/0,o=1/0,s=-1/0,a=-1/0,l=!1,h=0,c=this.children.length;h<c;++h){this.children[h].visible&&(l=!0,e=this.children[h].getBounds(),e.width*e.height!=0&&Math.abs(e.width)!==1/0&&Math.abs(e.height)!==1/0&&(r=r<e.x?r:e.x,o=o<e.y?o:e.y,t=e.width+e.x,i=e.height+e.y,s=s>t?s:t,a=a>i?a:i))}if(!l)return n.Rectangle.EMPTY;var u=this._bounds;u.x=r,u.y=o,u.width=s-r,u.height=a-o,this._currentBounds=u}return this._currentBounds},r.prototype.containerGetBounds=r.prototype.getBounds,r.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=n.Matrix.IDENTITY;for(var t=0,i=this.children.length;t<i;++t)this.children[t].updateTransform();return this.worldTransform=e,this._currentBounds=null,this.getBounds(n.Matrix.IDENTITY)},r.prototype.renderWebGL=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t,i;if(this._mask||this._filters){for(e.currentRenderer.flush(),this._filters&&this._filters.length&&e.filterManager.pushFilter(this,this._filters),this._mask&&e.maskManager.pushMask(this,this._mask),e.currentRenderer.start(),this._renderWebGL(e),t=0,i=this.children.length;t<i;t++)this.children[t].renderWebGL(e);e.currentRenderer.flush(),this._mask&&e.maskManager.popMask(this,this._mask),this._filters&&e.filterManager.popFilter(),e.currentRenderer.start()}else for(this._renderWebGL(e),t=0,i=this.children.length;t<i;++t)this.children[t].renderWebGL(e)}},r.prototype._renderWebGL=function(e){},r.prototype._renderCanvas=function(e){},r.prototype.renderCanvas=function(e){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&e.maskManager.pushMask(this._mask,e),this._renderCanvas(e);for(var t=0,i=this.children.length;t<i;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},r.prototype.destroy=function(e){if(s.prototype.destroy.call(this),e)for(var t=0,i=this.children.length;t<i;++t)this.children[t].destroy(e);this.removeChildren(),this.children=null}},{"../math":30,"../textures/RenderTexture":68,"../utils":74,"./DisplayObject":22}],22:[function(e,t,i){function r(){a.call(this),u.apply(this),this.position=new o.Point,this.scale=new o.Point(1,1),this.pivot=new o.Point(0,0),this.skew=new o.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.worldTransform=new o.Matrix,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new o.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1,this.bubble=!1,this.capture=!1}var o=e("../math"),s=e("../textures/RenderTexture"),a=e("eventemitter3"),l=e("../const"),h=new o.Matrix,c={worldTransform:new o.Matrix,worldAlpha:1,children:[]};r.prototype=Object.create(a.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{x:{get:function(){return this.position.x},set:function(e){this.position.x=e}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e}},worldVisible:{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}},mask:{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.renderable=!0),this._mask=e,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(e){this._filters=e&&e.slice()}}}),r.prototype.updateTransform=function(){var e,t,i,r,n,o,s=this.parent.worldTransform,a=this.worldTransform;this.skew.x||this.skew.y?(h.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y),a.a=h.a*s.a+h.b*s.c,a.b=h.a*s.b+h.b*s.d,a.c=h.c*s.a+h.d*s.c,a.d=h.c*s.b+h.d*s.d,a.tx=h.tx*s.a+h.ty*s.c+s.tx,a.ty=h.tx*s.b+h.ty*s.d+s.ty):this.rotation%l.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,t=this._sr*this.scale.x,i=-this._sr*this.scale.y,r=this._cr*this.scale.y,n=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(n-=this.pivot.x*e+this.pivot.y*i,o-=this.pivot.x*t+this.pivot.y*r),a.a=e*s.a+t*s.c,a.b=e*s.b+t*s.d,a.c=i*s.a+r*s.c,a.d=i*s.b+r*s.d,a.tx=n*s.a+o*s.c+s.tx,a.ty=n*s.b+o*s.d+s.ty):(e=this.scale.x,r=this.scale.y,n=this.position.x-this.pivot.x*e,o=this.position.y-this.pivot.y*r,a.a=e*s.a,a.b=e*s.b,a.c=r*s.c,a.d=r*s.d,a.tx=n*s.a+o*s.c+s.tx,a.ty=n*s.b+o*s.d+s.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null},r.prototype.displayObjectUpdateTransform=r.prototype.updateTransform,r.prototype.addEventListener=function(){this.interactive=!0,this.on.apply(this,arguments)},r.prototype.getBounds=function(e){return o.Rectangle.EMPTY},r.prototype.hitTest=function(e){return NBHitTest.hitTest(this,e)},r.prototype.hitTestPoint=function(e){return this.getBounds().contains(e.x,e.y)},r.prototype.hitTestPixel=function(e,t){var i=this.getLocalBounds();return this.generateTexture(e).getPixel(t.x-i.x,t.y-i.y)[3]>0},r.prototype.getLocalBounds=function(){return this.getBounds(o.Matrix.IDENTITY)},r.prototype.toGlobal=function(e){return this.parent?this.displayObjectUpdateTransform():(this.parent=c,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.apply(e)},r.prototype.toLocal=function(e,t,i){return t&&(e=t.toGlobal(e)),this.parent?this.displayObjectUpdateTransform():(this.parent=c,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.applyInverse(e,i)},r.prototype.renderWebGL=function(e){},r.prototype.renderCanvas=function(e){},r.prototype.generateTexture=function(e,t,i){var r=this.getLocalBounds(),n=new s(e,0|r.width,0|r.height,t,i);return h.tx=-r.x,h.ty=-r.y,n.render(this,h),n},r.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},r.prototype.has=a.prototype.hasEventListener=function(e){var t=e;return!(!this._events||!this._events[t])},r.prototype.emit=function(e,t,i,r,n,o){var s=e;if(t&&void 0===t.capture&&(t.capture=!1),!this._events||!this._events[s])return!1;var a,l,h=this._events[s],c=arguments.length;if("function"==typeof h.fn)if(h.once&&this.removeListener(e,h.fn,void 0,!0),void 0!==t){for(l=1,a=[];l<c;l++)a[l-1]=arguments[l];h.capture!==t.capture&&void 0!==t.capture||h.fn.apply(h.context,a)}else h.fn.call(h.context);else{var u,f=h.length;for(l=0;l<f&&(h[l].once&&this.removeListener(e,h[l].fn,void 0,!0),!t||!0!==t.stopImmediate);l++)if(void 0!==t){for(u=1,a=[];u<c;u++)a[u-1]=arguments[u];h[l].capture!==t.capture&&void 0!==t.capture||h[l].fn.apply(h[l].context,a)}else h[l].fn.apply(h[l].context)}return!0},r.prototype.once=function(e,t,i){var r=new n(t,i||this,!0),o=e;return this._events||(this._events=Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.$on=function(e,t,i,r){var o=new n(t,this),s=e;if(void 0===i&&(i=!1),o.capture=i,o.priority=r||0,this._events||(this._events=Object.create(null)),this._events[s]){var a=this._events[s];if(a.fn)a.fn!==o.fn&&(a=[a,o],this._events[s]=a);else{for(var l=0;l<a.length;l++){if(a[l].fn===t)break}l===a.length&&a.push(o)}a instanceof Array&&a.sort(function(e,t){return t.priority-e.priority})}else this._events[s]=o;return this},r.prototype.on=function(e,t,i,r){return e===TouchEvent.TOUCH_BEGIN?(this.$on("mousedown",t,i,r),this.$on("touchstart",t,i,r),this):e===TouchEvent.TOUCH_MOVE?(this.$on("mousemove",t,i,r),this.$on("touchmove",t,i,r),this):e===TouchEvent.TOUCH_END?(this.$on("mouseup",t,i,r),this.$on("touchend",t,i,r),this):e===TouchEvent.TAP?(this.$on("click",t,i,r),this.$on("tap",t,i,r),this):e===TouchEvent.TOUCH_END_OUDSIDE?(this.$on("mouseupoutside",t,i,r),this.$on("touchendoutside",t,i,r),this):void this.$on(e,t,i,r)},r.prototype.$removeListener=function(e,t,i,r){var n=e;if(!this._events||!this._events[n])return this;var o=this._events[n],s=[];if(t){if(o.fn)(o.fn!==t||r&&!o.once||!o.capture===i)&&s.push(o);else for(var a=0,l=o.length;a<l;a++)(o[a].fn!==t||r&&!o[a].once||!o[a].capture===i)&&s.push(o[a]);return s.length?this._events[n]=1===s.length?s[0]:s:delete this._events[n],this}},r.prototype.removeEventListener=r.prototype.removeListener=function(e,t,i,r){return e===TouchEvent.TOUCH_BEGIN?(this.$removeListener("mousedown",t,i,r),void this.$removeListener("touchstart",t,i,r)):e===TouchEvent.TOUCH_MOVE?(this.$removeListener("mousemove",t,i,r),void this.$removeListener("touchmove",t,i,r)):e===TouchEvent.TOUCH_END?(this.$removeListener("mouseup",t,i,r),void this.$removeListener("touchend",t,i,r)):e===TouchEvent.TAP?(this.$removeListener("click",t,i,r),void this.$removeListener("tap",t,i,r)):e===TouchEvent.TOUCH_END_OUDSIDE?(this.$removeListener("mouseupoutside",t,i,r),void this.$removeListener("touchendoutside",t,i,r)):void this.$removeListener(e,t,i,r)},r.prototype.setTransform=function(e,t,i,r,n,o,s,a,l){return this.position.x=e||0,this.position.y=t||0,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n||0,this.skew.x=o||0,this.skew.y=s||0,this.pivot.x=a||0,this.pivot.y=l||0,this},r.prototype.destroy=function(){this.position=null,this.scale=null,this.pivot=null,this.skew=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.worldTransform=null,this.filterArea=null};var u=function(){var e=this;this.hide=function(t){if(t)var i=t.direction||"center",r=t.time||0,n=t.callback;else var i="center",r=0,n=null;TweenMax.to(e,r,{alpha:0,onComplete:function(){e.visible=!1,n&&n()}});var o=0,s=0;switch(i){case"top":s-=150;break;case"bottom":s+=150;break;case"left":o-=150;break;case"right":o+=150}TweenMax.to(e,r,{x:e.x+o,y:e.y+s})},this.show=function(t){if(t)var i=t.direction||"center",r=t.time||0,n=t.callback;else var i="center",r=0,n=null;e.visible=!0,TweenMax.to(e,r,{alpha:1,onComplete:function(){n&&n()}});var o=0,s=0;switch(i){case"top":s+=150;break;case"bottom":s-=150;break;case"left":o+=150;break;case"right":o-=150}TweenMax.to(e,r,{x:e.x+o,y:e.y+s})},this.getPos=function(){e.pos={x:e.x,y:e.y,scale:e.scale}},this.goPoint=function(t,i){if(i)var r=i.time||0,n=i.callback||!1,o=i.x||0,s=i.y||0;else var r=0,n=!1,o=0,s=0;TweenMax.to(e,r,{x:t.x+o,y:t.y+s,onComplete:function(){n&&n()}})},this.backScale=function(){for(var t=[],i=e;;){if("frame"==i.name.substr(0,5))break;if(t.push(i.scale),i=i.parent,t.length>100){console.log("层级嵌套超过100层，避免死循环提前退出，请检测问题所在");break}}for(var r=1,n=1,o=0;o<t.length;o++)r/=t[o].x,n/=t[o].y;e.scale.x*=r,e.scale.y*=n}}},{"../const":20,"../math":30,"../textures/RenderTexture":68,eventemitter3:3}],23:[function(e,t,i){function r(){n.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=c.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new h.Rectangle(0,0,1,1),this.dirty=!0,this.glDirty=!1,this.boundsDirty=!0,this.cachedSpriteDirty=!1}var n=e("../display/Container"),o=e("../textures/Texture"),s=e("../renderers/canvas/utils/CanvasBuffer"),a=e("../renderers/canvas/utils/CanvasGraphics"),l=e("./GraphicsData"),h=e("../math"),c=e("../const"),u=new h.Point;r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){var e=new r;e.renderable=this.renderable,e.fillAlpha=this.fillAlpha,e.lineWidth=this.lineWidth,e.lineColor=this.lineColor,e.tint=this.tint,e.blendMode=this.blendMode,e.isMask=this.isMask,e.boundsPadding=this.boundsPadding,e.dirty=!0,e.glDirty=!0,e.cachedSpriteDirty=this.cachedSpriteDirty;for(var t=0;t<this.graphicsData.length;++t)e.graphicsData.push(this.graphicsData[t].clone());return e.currentPath=e.graphicsData[e.graphicsData.length-1],e.updateLocalBounds(),e},r.prototype.lineStyle=function(e,t,i){if(this.lineWidth=e||0,this.lineColor=t||0,this.lineAlpha=void 0===i?1:i,this.currentPath)if(this.currentPath.shape.points.length){var r=new h.Polygon(this.currentPath.shape.points.slice(-2));r.closed=!1,this.drawShape(r)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},r.prototype.moveTo=function(e,t){var i=new h.Polygon([e,t]);return i.closed=!1,this.drawShape(i),this},r.prototype.lineTo=function(e,t){return this.currentPath.shape.points.push(e,t),this.dirty=!0,this},r.prototype.quadraticCurveTo=function(e,t,i,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var n,o,s=this.currentPath.shape.points;0===s.length&&this.moveTo(0,0);for(var a=s[s.length-2],l=s[s.length-1],h=0,c=1;c<=20;++c)h=c/20,n=a+(e-a)*h,o=l+(t-l)*h,s.push(n+(e+(i-e)*h-n)*h,o+(t+(r-t)*h-o)*h);return this.dirty=this.boundsDirty=!0,this},r.prototype.bezierCurveTo=function(e,t,i,r,n,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var s,a,l,h,c,u=this.currentPath.shape.points,f=u[u.length-2],d=u[u.length-1],p=0,m=1;m<=20;++m)p=m/20,s=1-p,a=s*s,l=a*s,h=p*p,c=h*p,u.push(l*f+3*a*p*e+3*s*h*i+c*n,l*d+3*a*p*t+3*s*h*r+c*o);return this.dirty=this.boundsDirty=!0,this},r.prototype.arcTo=function(e,t,i,r,n){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(e,t):this.moveTo(e,t);var o=this.currentPath.shape.points,s=o[o.length-2],a=o[o.length-1],l=a-t,h=s-e,c=r-t,u=i-e,f=Math.abs(l*u-h*c);if(f<1e-8||0===n)o[o.length-2]===e&&o[o.length-1]===t||o.push(e,t);else{var d=l*l+h*h,p=c*c+u*u,m=l*c+h*u,g=n*Math.sqrt(d)/f,v=n*Math.sqrt(p)/f,y=g*m/d,_=v*m/p,b=g*u+v*h,x=g*c+v*l,T=h*(v+y),E=l*(v+y),S=u*(g+_),w=c*(g+_),M=Math.atan2(E-x,T-b),A=Math.atan2(w-x,S-b);this.arc(b+e,x+t,n,M,A,h*c>u*l)}return this.dirty=this.boundsDirty=!0,this},r.prototype.arc=function(e,t,i,r,n,o){if(o=o||!1,r===n)return this;!o&&n<=r?n+=2*Math.PI:o&&r<=n&&(r+=2*Math.PI);var s=o?-1*(r-n):n-r,a=40*Math.ceil(Math.abs(s)/(2*Math.PI));if(0===s)return this;var l=e+Math.cos(r)*i,h=t+Math.sin(r)*i;this.currentPath?this.currentPath.shape.points.push(l,h):this.moveTo(l,h);for(var c=this.currentPath.shape.points,u=s/(2*a),f=2*u,d=Math.cos(u),p=Math.sin(u),m=a-1,g=m%1/m,v=0;v<=m;v++){var y=v+g*v,_=u+r+f*y,b=Math.cos(_),x=-Math.sin(_);c.push((d*b+p*x)*i+e,(d*-x+p*b)*i+t)}return this.dirty=this.boundsDirty=!0,this},r.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},r.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},r.prototype.drawRect=function(e,t,i,r){return this.drawShape(new h.Rectangle(e,t,i,r)),this},r.prototype.drawRoundedRect=function(e,t,i,r,n){return this.drawShape(new h.RoundedRectangle(e,t,i,r,n)),this},r.prototype.drawCircle=function(e,t,i){return this.drawShape(new h.Circle(e,t,i)),this},r.prototype.drawEllipse=function(e,t,i,r){return this.drawShape(new h.Ellipse(e,t,i,r)),this},r.prototype.drawPolygon=function(e){var t=e,i=!0;if(t instanceof h.Polygon&&(i=t.closed,t=t.points),!Array.isArray(t)){t=new Array(arguments.length);for(var r=0;r<t.length;++r)t[r]=arguments[r]}var n=new h.Polygon(t);return n.closed=i,this.drawShape(n),this},r.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},r.prototype.generateTexture=function(e,t,i){t=t||1;var r=this.getLocalBounds(),n=new s(r.width*t,r.height*t),l=o.fromCanvas(n.canvas,i);return l.baseTexture.resolution=t,n.context.scale(t,t),n.context.translate(-r.x,-r.y),a.renderGraphics(this,n.context),l},r.prototype._renderWebGL=function(e){this.glDirty&&(this.dirty=!0,this.glDirty=!1),e.setObjectRenderer(e.plugins.graphics),e.plugins.graphics.render(this)},r.prototype._renderCanvas=function(e){if(!0!==this.isMask){this._prevTint!==this.tint&&(this.dirty=!0);var t=e.context,i=this.worldTransform,r=e.blendModes[this.blendMode];r!==t.globalCompositeOperation&&(t.globalCompositeOperation=r);var n=e.resolution;t.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n,i.ty*n),a.renderGraphics(this,t)}},r.prototype.getBounds=function(e){if(!this._currentBounds){if(!this.renderable)return h.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),this.glDirty=!0,this.cachedSpriteDirty=!0,this.boundsDirty=!1);var t=this._localBounds,i=t.x,r=t.width+t.x,n=t.y,o=t.height+t.y,s=e||this.worldTransform,a=s.a,l=s.b,c=s.c,u=s.d,f=s.tx,d=s.ty,p=a*r+c*o+f,m=u*o+l*r+d,g=a*i+c*o+f,v=u*o+l*i+d,y=a*i+c*n+f,_=u*n+l*i+d,b=a*r+c*n+f,x=u*n+l*r+d,T=p,E=m,S=p,w=m;S=g<S?g:S,S=y<S?y:S,S=b<S?b:S,w=v<w?v:w,w=_<w?_:w,w=x<w?x:w,T=g>T?g:T,T=y>T?y:T,T=b>T?b:T,E=v>E?v:E,E=_>E?_:E,E=x>E?x:E,this._bounds.x=S,this._bounds.width=T-S,this._bounds.y=w,this._bounds.height=E-w,this._currentBounds=this._bounds}return this._currentBounds},r.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,u);for(var t=this.graphicsData,i=0;i<t.length;i++){var r=t[i];if(r.fill&&(r.shape&&r.shape.contains(u.x,u.y)))return!0}return!1},r.prototype.updateLocalBounds=function(){var e=1/0,t=-1/0,i=1/0,r=-1/0;if(this.graphicsData.length)for(var n,o,s,a,l,h,u=0;u<this.graphicsData.length;u++){var f=this.graphicsData[u],d=f.type,p=f.lineWidth;if(n=f.shape,d===c.SHAPES.RECT||d===c.SHAPES.RREC)s=n.x-p/2,a=n.y-p/2,l=n.width+p,h=n.height+p,e=s<e?s:e,t=s+l>t?s+l:t,i=a<i?a:i,r=a+h>r?a+h:r;else if(d===c.SHAPES.CIRC)s=n.x,a=n.y,l=n.radius+p/2,h=n.radius+p/2,e=s-l<e?s-l:e,t=s+l>t?s+l:t,i=a-h<i?a-h:i,r=a+h>r?a+h:r;else if(d===c.SHAPES.ELIP)s=n.x,a=n.y,l=n.width+p/2,h=n.height+p/2,e=s-l<e?s-l:e,t=s+l>t?s+l:t,i=a-h<i?a-h:i,r=a+h>r?a+h:r;else{o=n.points;for(var m=0;m<o.length;m+=2)s=o[m],a=o[m+1],e=s-p<e?s-p:e,t=s+p>t?s+p:t,i=a-p<i?a-p:i,r=a+p>r?a+p:r}}else e=0,t=0,i=0,r=0;var g=this.boundsPadding;this._localBounds.x=e-g,this._localBounds.width=t-e+2*g,this._localBounds.y=i-g,this._localBounds.height=r-i+2*g},r.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var t=new l(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(t),t.type===c.SHAPES.POLY&&(t.shape.closed=t.shape.closed&&this.filling,t.shape.closed=t.shape.closed||this.filling,this.currentPath=t),this.dirty=this.boundsDirty=!0,t},r.prototype.destroy=function(){n.prototype.destroy.apply(this,arguments);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();for(var t in this._webgl)for(var i=0;i<this._webgl[t].data.length;++i)this._webgl[t].data[i].destroy();this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":20,"../display/Container":21,"../math":30,"../renderers/canvas/utils/CanvasBuffer":42,"../renderers/canvas/utils/CanvasGraphics":43,"../textures/Texture":69,"./GraphicsData":24}],24:[function(e,t,i){function r(e,t,i,r,n,o,s){this.lineWidth=e,this.lineColor=t,this.lineAlpha=i,this._lineTint=t,this.fillColor=r,this.fillAlpha=n,this._fillTint=r,this.fill=o,this.shape=s,this.type=s.type}r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},r.prototype.destroy=function(){this.shape=null}},{}],25:[function(e,t,i){function r(e){a.call(this,e),this.graphicsDataPool=[],this.primitiveShader=null,this.complexPrimitiveShader=null,this.maximumSimplePolySize=200}var n=e("../../utils"),o=e("../../math"),s=e("../../const"),a=e("../../renderers/webgl/utils/ObjectRenderer"),l=e("../../renderers/webgl/WebGLRenderer"),h=e("./WebGLGraphicsData"),c=e("earcut");r.prototype=Object.create(a.prototype),r.prototype.constructor=r,t.exports=r,l.registerPlugin("graphics",r),r.prototype.onContextChange=function(){},r.prototype.destroy=function(){a.prototype.destroy.call(this);for(var e=0;e<this.graphicsDataPool.length;++e)this.graphicsDataPool[e].destroy();this.graphicsDataPool=null},r.prototype.render=function(e){var t,i=this.renderer,r=i.gl,o=i.shaderManager.plugins.primitiveShader;!e.dirty&&e._webGL[r.id]||this.updateGraphics(e);var s=e._webGL[r.id];i.blendModeManager.setBlendMode(e.blendMode);for(var a=0,l=s.data.length;a<l;a++)t=s.data[a],1===s.data[a].mode?(i.stencilManager.pushStencil(e,t),r.uniform1f(i.shaderManager.complexPrimitiveShader.uniforms.alpha._location,e.worldAlpha*t.alpha),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(t.indices.length-4)),i.stencilManager.popStencil(e,t)):(o=i.shaderManager.primitiveShader,i.shaderManager.setShader(o),r.uniformMatrix3fv(o.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),r.uniformMatrix3fv(o.uniforms.projectionMatrix._location,!1,i.currentRenderTarget.projectionMatrix.toArray(!0)),r.uniform3fv(o.uniforms.tint._location,n.hex2rgb(e.tint)),r.uniform1f(o.uniforms.alpha._location,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(o.attributes.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(o.attributes.aColor,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0)),i.drawCount++},r.prototype.updateGraphics=function(e){var t=this.renderer.gl,i=e._webGL[t.id];i||(i=e._webGL[t.id]={lastIndex:0,data:[],gl:t}),e.dirty=!1;var r;if(e.clearDirty){for(e.clearDirty=!1,r=0;r<i.data.length;r++){var n=i.data[r];n.reset(),this.graphicsDataPool.push(n)}i.data=[],i.lastIndex=0}var o;for(r=i.lastIndex;r<e.graphicsData.length;r++){var a=e.graphicsData[r];if(a.type===s.SHAPES.POLY){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]===a.points[a.points.length-2]&&a.points[1]===a.points[a.points.length-1]||a.points.push(a.points[0],a.points[1])),a.fill&&a.points.length>=6)if(a.points.length<2*this.maximumSimplePolySize){o=this.switchMode(i,0);var l=this.buildPoly(a,o);l||(o=this.switchMode(i,1),this.buildComplexPoly(a,o))}else o=this.switchMode(i,1),this.buildComplexPoly(a,o);a.lineWidth>0&&(o=this.switchMode(i,0),this.buildLine(a,o))}else o=this.switchMode(i,0),a.type===s.SHAPES.RECT?this.buildRectangle(a,o):a.type===s.SHAPES.CIRC||a.type===s.SHAPES.ELIP?this.buildCircle(a,o):a.type===s.SHAPES.RREC&&this.buildRoundedRectangle(a,o);i.lastIndex++}for(r=0;r<i.data.length;r++)o=i.data[r],o.dirty&&o.upload()},r.prototype.switchMode=function(e,t){var i;return e.data.length?(i=e.data[e.data.length-1],(i.points.length>32e4||i.mode!==t||1===t)&&(i=this.graphicsDataPool.pop()||new h(e.gl),i.mode=t,e.data.push(i))):(i=this.graphicsDataPool.pop()||new h(e.gl),i.mode=t,e.data.push(i)),i.dirty=!0,i},r.prototype.buildRectangle=function(e,t){var i=e.shape,r=i.x,o=i.y,s=i.width,a=i.height;if(e.fill){var l=n.hex2rgb(e.fillColor),h=e.fillAlpha,c=l[0]*h,u=l[1]*h,f=l[2]*h,d=t.points,p=t.indices,m=d.length/6;d.push(r,o),d.push(c,u,f,h),d.push(r+s,o),d.push(c,u,f,h),d.push(r,o+a),d.push(c,u,f,h),d.push(r+s,o+a),d.push(c,u,f,h),p.push(m,m,m+1,m+2,m+3,m+3)}if(e.lineWidth){var g=e.points;e.points=[r,o,r+s,o,r+s,o+a,r,o+a,r,o],this.buildLine(e,t),e.points=g}},r.prototype.buildRoundedRectangle=function(e,t){var i=e.shape,r=i.x,o=i.y,s=i.width,a=i.height,l=i.radius,h=[];if(h.push(r,o+l),this.quadraticBezierCurve(r,o+a-l,r,o+a,r+l,o+a,h),this.quadraticBezierCurve(r+s-l,o+a,r+s,o+a,r+s,o+a-l,h),this.quadraticBezierCurve(r+s,o+l,r+s,o,r+s-l,o,h),this.quadraticBezierCurve(r+l,o,r,o,r,o+l+1e-10,h),e.fill){var u=n.hex2rgb(e.fillColor),f=e.fillAlpha,d=u[0]*f,p=u[1]*f,m=u[2]*f,g=t.points,v=t.indices,y=g.length/6,_=c(h,null,2),b=0;for(b=0;b<_.length;b+=3)v.push(_[b]+y),v.push(_[b]+y),v.push(_[b+1]+y),v.push(_[b+2]+y),v.push(_[b+2]+y);for(b=0;b<h.length;b++)g.push(h[b],h[++b],d,p,m,f)}if(e.lineWidth){var x=e.points;e.points=h,this.buildLine(e,t),e.points=x}},r.prototype.quadraticBezierCurve=function(e,t,i,r,n,o,s){function a(e,t,i){return e+(t-e)*i}for(var l,h,c,u,f,d,p=s||[],m=0,g=0;g<=20;g++)m=g/20,l=a(e,i,m),h=a(t,r,m),c=a(i,n,m),u=a(r,o,m),f=a(l,c,m),d=a(h,u,m),p.push(f,d);return p},r.prototype.buildCircle=function(e,t){var i,r,o=e.shape,a=o.x,l=o.y;e.type===s.SHAPES.CIRC?(i=o.radius,r=o.radius):(i=o.width,r=o.height);var h=Math.floor(30*Math.sqrt(o.radius))||Math.floor(15*Math.sqrt(o.width+o.height)),c=2*Math.PI/h,u=0;if(e.fill){var f=n.hex2rgb(e.fillColor),d=e.fillAlpha,p=f[0]*d,m=f[1]*d,g=f[2]*d,v=t.points,y=t.indices,_=v.length/6;for(y.push(_),u=0;u<h+1;u++)v.push(a,l,p,m,g,d),v.push(a+Math.sin(c*u)*i,l+Math.cos(c*u)*r,p,m,g,d),y.push(_++,_++);y.push(_-1)}if(e.lineWidth){var b=e.points;for(e.points=[],u=0;u<h+1;u++)e.points.push(a+Math.sin(c*u)*i,l+Math.cos(c*u)*r);this.buildLine(e,t),e.points=b}},r.prototype.buildLine=function(e,t){var i=0,r=e.points;if(0!==r.length){var s=new o.Point(r[0],r[1]),a=new o.Point(r[r.length-2],r[r.length-1]);if(s.x===a.x&&s.y===a.y){r=r.slice(),r.pop(),r.pop(),a=new o.Point(r[r.length-2],r[r.length-1]);var l=a.x+.5*(s.x-a.x),h=a.y+.5*(s.y-a.y);r.unshift(l,h),r.push(l,h)}var c,u,f,d,p,m,g,v,y,_,b,x,T,E,S,w,M,A,P,C,R,D,I,O=t.points,F=t.indices,L=r.length/2,B=r.length,N=O.length/6,k=e.lineWidth/2,V=n.hex2rgb(e.lineColor),U=e.lineAlpha,z=V[0]*U,G=V[1]*U,H=V[2]*U;for(f=r[0],d=r[1],p=r[2],m=r[3],y=-(d-m),_=f-p,I=Math.sqrt(y*y+_*_),y/=I,_/=I,y*=k,_*=k,O.push(f-y,d-_,z,G,H,U),O.push(f+y,d+_,z,G,H,U),i=1;i<L-1;i++)f=r[2*(i-1)],d=r[2*(i-1)+1],p=r[2*i],m=r[2*i+1],g=r[2*(i+1)],v=r[2*(i+1)+1],y=-(d-m),_=f-p,I=Math.sqrt(y*y+_*_),y/=I,_/=I,y*=k,_*=k,b=-(m-v),x=p-g,I=Math.sqrt(b*b+x*x),b/=I,x/=I,b*=k,x*=k,S=-_+d-(-_+m),w=-y+p-(-y+f),M=(-y+f)*(-_+m)-(-y+p)*(-_+d),A=-x+v-(-x+m),P=-b+p-(-b+g),C=(-b+g)*(-x+m)-(-b+p)*(-x+v),R=S*P-A*w,Math.abs(R)<.1?(R+=10.1,O.push(p-y,m-_,z,G,H,U),O.push(p+y,m+_,z,G,H,U)):(c=(w*C-P*M)/R,u=(A*M-S*C)/R,D=(c-p)*(c-p)+(u-m)*(u-m),D>19600?(T=y-b,E=_-x,I=Math.sqrt(T*T+E*E),T/=I,E/=I,T*=k,E*=k,O.push(p-T,m-E),O.push(z,G,H,U),O.push(p+T,m+E),O.push(z,G,H,U),O.push(p-T,m-E),O.push(z,G,H,U),B++):(O.push(c,u),O.push(z,G,H,U),O.push(p-(c-p),m-(u-m)),O.push(z,G,H,U)));for(f=r[2*(L-2)],d=r[2*(L-2)+1],p=r[2*(L-1)],m=r[2*(L-1)+1],y=-(d-m),_=f-p,I=Math.sqrt(y*y+_*_),y/=I,_/=I,y*=k,_*=k,O.push(p-y,m-_),O.push(z,G,H,U),O.push(p+y,m+_),O.push(z,G,H,U),F.push(N),i=0;i<B;i++)F.push(N++);F.push(N-1)}},r.prototype.buildComplexPoly=function(e,t){var i=e.points.slice();if(!(i.length<6)){var r=t.indices;t.points=i,t.alpha=e.fillAlpha,t.color=n.hex2rgb(e.fillColor);for(var o,s,a=1/0,l=-1/0,h=1/0,c=-1/0,u=0;u<i.length;u+=2)o=i[u],s=i[u+1],a=o<a?o:a,l=o>l?o:l,h=s<h?s:h,c=s>c?s:c;i.push(a,h,l,h,l,c,a,c);var f=i.length/2;for(u=0;u<f;u++)r.push(u)}},r.prototype.buildPoly=function(e,t){var i=e.points;if(!(i.length<6)){var r=t.points,o=t.indices,s=i.length/2,a=n.hex2rgb(e.fillColor),l=e.fillAlpha,h=a[0]*l,u=a[1]*l,f=a[2]*l,d=c(i,null,2);if(!d)return!1;var p=r.length/6,m=0;for(m=0;m<d.length;m+=3)o.push(d[m]+p),o.push(d[m]+p),o.push(d[m+1]+p),o.push(d[m+2]+p),o.push(d[m+2]+p);for(m=0;m<s;m++)r.push(i[2*m],i[2*m+1],h,u,f,l);return!0}}},{"../../const":20,"../../math":30,"../../renderers/webgl/WebGLRenderer":46,"../../renderers/webgl/utils/ObjectRenderer":60,"../../utils":74,"./WebGLGraphicsData":26,earcut:2}],26:[function(e,t,i){function r(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0,this.glPoints=null,this.glIndices=null}r.prototype.constructor=r,t.exports=r,r.prototype.reset=function(){this.points.length=0,this.indices.length=0},r.prototype.upload=function(){var e=this.gl;this.glPoints=new Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndices=new Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndices,e.STATIC_DRAW),this.dirty=!1},r.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.gl.deleteBuffer(this.buffer),this.gl.deleteBuffer(this.indexBuffer),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{}],27:[function(e,t,i){/**
 * @file        Main export of the PIXI core library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
var r=t.exports=Object.assign(e("./const"),e("./math"),{utils:e("./utils"),ticker:e("./ticker"),DisplayObject:e("./display/DisplayObject"),Container:e("./display/Container"),Sprite:e("./sprites/Sprite"),ParticleContainer:e("./particles/ParticleContainer"),SpriteRenderer:e("./sprites/webgl/SpriteRenderer"),ParticleRenderer:e("./particles/webgl/ParticleRenderer"),Text:e("./text/Text"),Graphics:e("./graphics/Graphics"),GraphicsData:e("./graphics/GraphicsData"),GraphicsRenderer:e("./graphics/webgl/GraphicsRenderer"),Texture:e("./textures/Texture"),BaseTexture:e("./textures/BaseTexture"),RenderTexture:e("./textures/RenderTexture"),VideoBaseTexture:e("./textures/VideoBaseTexture"),TextureUvs:e("./textures/TextureUvs"),CanvasRenderer:e("./renderers/canvas/CanvasRenderer"),CanvasGraphics:e("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:e("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:e("./renderers/webgl/WebGLRenderer"),WebGLManager:e("./renderers/webgl/managers/WebGLManager"),ShaderManager:e("./renderers/webgl/managers/ShaderManager"),Shader:e("./renderers/webgl/shaders/Shader"),ObjectRenderer:e("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:e("./renderers/webgl/utils/RenderTarget"),AbstractFilter:e("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:e("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:e("./renderers/webgl/filters/SpriteMaskFilter"),EventEmitter:e("eventemitter3"),autoDetectRenderer:function(e,t,i,n){return e=e||800,t=t||600,!n&&r.utils.isWebGLSupported()?new r.WebGLRenderer(e,t,i):new r.CanvasRenderer(e,t,i)}})},{"./const":20,"./display/Container":21,"./display/DisplayObject":22,"./graphics/Graphics":23,"./graphics/GraphicsData":24,"./graphics/webgl/GraphicsRenderer":25,"./math":30,"./particles/ParticleContainer":36,"./particles/webgl/ParticleRenderer":38,"./renderers/canvas/CanvasRenderer":41,"./renderers/canvas/utils/CanvasBuffer":42,"./renderers/canvas/utils/CanvasGraphics":43,"./renderers/webgl/WebGLRenderer":46,"./renderers/webgl/filters/AbstractFilter":47,"./renderers/webgl/filters/FXAAFilter":48,"./renderers/webgl/filters/SpriteMaskFilter":49,"./renderers/webgl/managers/ShaderManager":53,"./renderers/webgl/managers/WebGLManager":55,"./renderers/webgl/shaders/Shader":58,"./renderers/webgl/utils/ObjectRenderer":60,"./renderers/webgl/utils/RenderTarget":62,"./sprites/Sprite":64,"./sprites/webgl/SpriteRenderer":65,"./text/Text":66,"./textures/BaseTexture":67,"./textures/RenderTexture":68,"./textures/Texture":69,"./textures/TextureUvs":70,"./textures/VideoBaseTexture":71,"./ticker":73,"./utils":74,eventemitter3:3}],28:[function(e,t,i){function r(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}var n=e("./Point");r.prototype.constructor=r,t.exports=r,r.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},r.prototype.set=function(e,t,i,r,n,o){return this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o,this},r.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},r.prototype.apply=function(e,t){t=t||new n;var i=e.x,r=e.y;return t.x=this.a*i+this.c*r+this.tx,t.y=this.b*i+this.d*r+this.ty,t},r.prototype.applyInverse=function(e,t){t=t||new n;var i=1/(this.a*this.d+this.c*-this.b),r=e.x,o=e.y;return t.x=this.d*i*r+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*o+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,t},r.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},r.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},r.prototype.rotate=function(e){var t=Math.cos(e),i=Math.sin(e),r=this.a,n=this.c,o=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=n*t-this.d*i,this.d=n*i+this.d*t,this.tx=o*t-this.ty*i,this.ty=o*i+this.ty*t,this},r.prototype.append=function(e){var t=this.a,i=this.b,r=this.c,n=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*i+e.b*n,this.c=e.c*t+e.d*r,this.d=e.c*i+e.d*n,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*i+e.ty*n+this.ty,this},r.prototype.setTransform=function(e,t,i,r,n,o,s,a,l){var h,c,u,f,d,p,m,g,v,y;return d=Math.sin(s),p=Math.cos(s),m=Math.cos(l),g=Math.sin(l),v=-Math.sin(a),y=Math.cos(a),h=p*n,c=d*n,u=-d*o,f=p*o,this.a=m*h+g*u,this.b=m*c+g*f,this.c=v*h+y*u,this.d=v*c+y*f,this.tx=e+(i*h+r*u),this.ty=t+(i*c+r*f),this},r.prototype.prepend=function(e){var t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){var i=this.a,r=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=r*e.a+this.d*e.c,this.d=r*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},r.prototype.invert=function(){var e=this.a,t=this.b,i=this.c,r=this.d,n=this.tx,o=e*r-t*i;return this.a=r/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(e*this.ty-t*n)/o,this},r.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},r.prototype.clone=function(){var e=new r;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},r.prototype.copy=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},r.IDENTITY=new r,r.TEMP_MATRIX=new r},{"./Point":29}],29:[function(e,t,i){function r(e,t){this.x=e||0,this.y=t||0}r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.copy=function(e){this.set(e.x,e.y)},r.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},r.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)}},{}],30:[function(e,t,i){t.exports={Point:e("./Point"),Matrix:e("./Matrix"),Circle:e("./shapes/Circle"),Ellipse:e("./shapes/Ellipse"),Polygon:e("./shapes/Polygon"),Rectangle:e("./shapes/Rectangle"),RoundedRectangle:e("./shapes/RoundedRectangle")}},{"./Matrix":28,"./Point":29,"./shapes/Circle":31,"./shapes/Ellipse":32,"./shapes/Polygon":33,"./shapes/Rectangle":34,"./shapes/RoundedRectangle":35}],31:[function(e,t,i){function r(e,t,i){this.x=e||0,this.y=t||0,this.radius=i||0,this.type=o.SHAPES.CIRC}var n=e("./Rectangle"),o=e("../../const");r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.radius)},r.prototype.contains=function(e,t){if(this.radius<=0)return!1;var i=this.x-e,r=this.y-t,n=this.radius*this.radius;return i*=i,r*=r,i+r<=n},r.prototype.getBounds=function(){return new n(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":20,"./Rectangle":34}],32:[function(e,t,i){function r(e,t,i,r){this.x=e||0,this.y=t||0,this.width=i||0,this.height=r||0,this.type=o.SHAPES.ELIP}var n=e("./Rectangle"),o=e("../../const");r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var i=(e-this.x)/this.width,r=(t-this.y)/this.height;return i*=i,r*=r,i+r<=1},r.prototype.getBounds=function(){return new n(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":20,"./Rectangle":34}],33:[function(e,t,i){function r(e){var t=e;if(!Array.isArray(t)){t=new Array(arguments.length);for(var i=0;i<t.length;++i)t[i]=arguments[i]}if(t[0]instanceof n){for(var r=[],s=0,a=t.length;s<a;s++)r.push(t[s].x,t[s].y);t=r}this.closed=!0,this.points=t,this.type=o.SHAPES.POLY}var n=e("../Point"),o=e("../../const");r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.points.slice())},r.prototype.contains=function(e,t){for(var i=!1,r=this.points.length/2,n=0,o=r-1;n<r;o=n++){var s=this.points[2*n],a=this.points[2*n+1],l=this.points[2*o],h=this.points[2*o+1];a>t!=h>t&&e<(l-s)*(t-a)/(h-a)+s&&(i=!i)}return i}},{"../../const":20,"../Point":29}],34:[function(e,t,i){function r(e,t,i,r){this.x=e||0,this.y=t||0,this.width=i||0,this.height=r||0,this.type=n.SHAPES.RECT}var n=e("../../const");r.prototype.constructor=r,t.exports=r,r.EMPTY=new r(0,0,0,0),r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height)}},{"../../const":20}],35:[function(e,t,i){function r(e,t,i,r,o){this.x=e||0,this.y=t||0,this.width=i||0,this.height=r||0,this.radius=o||20,this.type=n.SHAPES.RREC}var n=e("../../const");r.prototype.constructor=r,t.exports=r,r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height,this.radius)},r.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height)}},{"../../const":20}],36:[function(e,t,i){function r(e,t,i){n.call(this),i=i||15e3,e=e||15e3;i>16384&&(i=16384),i>e&&(i=e),this._properties=[!1,!0,!1,!1,!1],this._maxSize=e,this._batchSize=i,this._buffers=null,this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=o.BLEND_MODES.NORMAL,this.roundPixels=!0,this.setProperties(t)}var n=e("../display/Container"),o=e("../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.setProperties=function(e){e&&(this._properties[0]="scale"in e?!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="alpha"in e?!!e.alpha:this._properties[4])},r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},r.prototype.renderWebGL=function(e){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(e.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},r.prototype.onChildrenChange=function(e){var t=Math.floor(e/this._batchSize);t<this._bufferToUpdate&&(this._bufferToUpdate=t)},r.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var t=e.context,i=this.worldTransform,r=!0,n=0,o=0,s=0,a=0,l=e.blendModes[this.blendMode];l!==t.globalCompositeOperation&&(t.globalCompositeOperation=l),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var h=0;h<this.children.length;++h){var c=this.children[h];if(c.visible){var u=c.texture.frame;if(t.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(2*Math.PI)==0)r&&(t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),r=!1),n=c.anchor.x*(-u.width*c.scale.x)+c.position.x+.5,o=c.anchor.y*(-u.height*c.scale.y)+c.position.y+.5,s=u.width*c.scale.x,a=u.height*c.scale.y;else{r||(r=!0),c.displayObjectUpdateTransform();var f=c.worldTransform;e.roundPixels?t.setTransform(f.a,f.b,f.c,f.d,0|f.tx,0|f.ty):t.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),n=c.anchor.x*-u.width+.5,o=c.anchor.y*-u.height+.5,s=u.width,a=u.height}t.drawImage(c.texture.baseTexture.source,u.x,u.y,u.width,u.height,n,o,s,a)}}}},r.prototype.destroy=function(){if(n.prototype.destroy.apply(this,arguments),this._buffers)for(var e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._properties=null,this._buffers=null}},{"../const":20,"../display/Container":21}],37:[function(e,t,i){function r(e,t,i,r){this.gl=e,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<t.length;n++){var o=t[n];i[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}r.prototype.constructor=r,t.exports=r,r.prototype.initBuffers=function(){var e,t,i=this.gl,r=0;for(this.dynamicStride=0,e=0;e<this.dynamicProperties.length;e++)t=this.dynamicProperties[e],t.offset=r,r+=t.size,this.dynamicStride+=t.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),i.bufferData(i.ARRAY_BUFFER,this.dynamicData,i.DYNAMIC_DRAW);var n=0;for(this.staticStride=0,e=0;e<this.staticProperties.length;e++)t=this.staticProperties[e],t.offset=n,n+=t.size,this.staticStride+=t.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),i.bufferData(i.ARRAY_BUFFER,this.staticData,i.DYNAMIC_DRAW)},r.prototype.uploadDynamic=function(e,t,i){for(var r=this.gl,n=0;n<this.dynamicProperties.length;n++){var o=this.dynamicProperties[n];o.uploadFunction(e,t,i,this.dynamicData,this.dynamicStride,o.offset)}r.bindBuffer(r.ARRAY_BUFFER,this.dynamicBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.dynamicData)},r.prototype.uploadStatic=function(e,t,i){for(var r=this.gl,n=0;n<this.staticProperties.length;n++){var o=this.staticProperties[n];o.uploadFunction(e,t,i,this.staticData,this.staticStride,o.offset)}r.bindBuffer(r.ARRAY_BUFFER,this.staticBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this.staticData)},r.prototype.bind=function(){var e,t,i=this.gl;for(i.bindBuffer(i.ARRAY_BUFFER,this.dynamicBuffer),e=0;e<this.dynamicProperties.length;e++)t=this.dynamicProperties[e],i.vertexAttribPointer(t.attribute,t.size,i.FLOAT,!1,4*this.dynamicStride,4*t.offset);for(i.bindBuffer(i.ARRAY_BUFFER,this.staticBuffer),e=0;e<this.staticProperties.length;e++)t=this.staticProperties[e],i.vertexAttribPointer(t.attribute,t.size,i.FLOAT,!1,4*this.staticStride,4*t.offset)},r.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.gl.deleteBuffer(this.dynamicBuffer),this.staticProperties=null,this.staticData=null,this.gl.deleteBuffer(this.staticBuffer)}},{}],38:[function(e,t,i){function r(e){n.call(this,e);this.indices=new Uint16Array(98304);for(var t=0,i=0;t<98304;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new l.Matrix}var n=e("../../renderers/webgl/utils/ObjectRenderer"),o=e("../../renderers/webgl/WebGLRenderer"),s=e("./ParticleShader"),a=e("./ParticleBuffer"),l=e("../../math");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,o.registerPlugin("particle",r),r.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=new s(this.renderer.shaderManager),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]},r.prototype.start=function(){var e=this.renderer.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.shader;this.renderer.shaderManager.setShader(t)},r.prototype.render=function(e){var t=e.children,i=t.length,r=e._maxSize,n=e._batchSize;if(0!==i){i>r&&(i=r),e._buffers||(e._buffers=this.generateBuffers(e)),this.renderer.blendModeManager.setBlendMode(e.blendMode);var o=this.renderer.gl,s=e.worldTransform.copy(this.tempMatrix);s.prepend(this.renderer.currentRenderTarget.projectionMatrix),o.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,s.toArray(!0)),o.uniform1f(this.shader.uniforms.uAlpha._location,e.worldAlpha);var a=t[0]._texture.baseTexture;if(a._glTextures[o.id])o.bindTexture(o.TEXTURE_2D,a._glTextures[o.id]);else{if(!this.renderer.updateTexture(a))return;e._properties[0]&&e._properties[3]||(e._bufferToUpdate=0)}for(var l=0,h=0;l<i;l+=n,h+=1){var c=i-l;c>n&&(c=n);var u=e._buffers[h];u.uploadDynamic(t,l,c),e._bufferToUpdate===h&&(u.uploadStatic(t,l,c),e._bufferToUpdate=h+1),u.bind(this.shader),o.drawElements(o.TRIANGLES,6*c,o.UNSIGNED_SHORT,0),this.renderer.drawCount++}}},r.prototype.generateBuffers=function(e){var t,i=this.renderer.gl,r=[],n=e._maxSize,o=e._batchSize,s=e._properties;for(t=0;t<n;t+=o)r.push(new a(i,this.properties,s,o));return r},r.prototype.uploadVertices=function(e,t,i,r,n,o){for(var s,a,l,h,c,u,f,d,p,m=0;m<i;m++)s=e[t+m],a=s._texture,h=s.scale.x,c=s.scale.y,a.trim?(l=a.trim,f=l.x-s.anchor.x*l.width,u=f+a.crop.width,p=l.y-s.anchor.y*l.height,d=p+a.crop.height):(u=a._frame.width*(1-s.anchor.x),f=a._frame.width*-s.anchor.x,d=a._frame.height*(1-s.anchor.y),p=a._frame.height*-s.anchor.y),r[o]=f*h,r[o+1]=p*c,r[o+n]=u*h,r[o+n+1]=p*c,r[o+2*n]=u*h,r[o+2*n+1]=d*c,r[o+3*n]=f*h,r[o+3*n+1]=d*c,o+=4*n},r.prototype.uploadPosition=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s].position;r[o]=a.x,r[o+1]=a.y,r[o+n]=a.x,r[o+n+1]=a.y,r[o+2*n]=a.x,r[o+2*n+1]=a.y,r[o+3*n]=a.x,r[o+3*n+1]=a.y,o+=4*n}},r.prototype.uploadRotation=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s].rotation;r[o]=a,r[o+n]=a,r[o+2*n]=a,r[o+3*n]=a,o+=4*n}},r.prototype.uploadUvs=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s]._texture._uvs;a?(r[o]=a.x0,r[o+1]=a.y0,r[o+n]=a.x1,r[o+n+1]=a.y1,r[o+2*n]=a.x2,r[o+2*n+1]=a.y2,r[o+3*n]=a.x3,r[o+3*n+1]=a.y3,o+=4*n):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+2*n]=0,r[o+2*n+1]=0,r[o+3*n]=0,r[o+3*n+1]=0,o+=4*n)}},r.prototype.uploadAlpha=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s].alpha;r[o]=a,r[o+n]=a,r[o+2*n]=a,r[o+3*n]=a,o+=4*n}},r.prototype.destroy=function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),n.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../math":30,"../../renderers/webgl/WebGLRenderer":46,"../../renderers/webgl/utils/ObjectRenderer":60,"./ParticleBuffer":37,"./ParticleShader":39}],39:[function(e,t,i){function r(e){n.call(this,e,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var n=e("../../renderers/webgl/shaders/TextureShader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r},{"../../renderers/webgl/shaders/TextureShader":59}],40:[function(e,t,i){function r(e,t,i,r){if(a.call(this),n.sayHello(e),r)for(var l in s.DEFAULT_RENDER_OPTIONS)void 0===r[l]&&(r[l]=s.DEFAULT_RENDER_OPTIONS[l]);else r=s.DEFAULT_RENDER_OPTIONS;this.type=s.RENDERER_TYPE.UNKNOWN,this.width=t||800,this.height=i||600,this.view=r.view||document.createElement("canvas"),this.resolution=r.resolution,this.transparent=r.transparent,this.autoResize=r.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.roundPixels=r.roundPixels,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=r.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent={worldTransform:new o.Matrix,worldAlpha:1,children:[]},this._lastObjectRendered=this._tempDisplayObjectParent}var n=e("../utils"),o=e("../math"),s=e("../const"),a=e("eventemitter3");r.prototype=Object.create(a.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=n.hex2string(e),n.hex2rgb(e,this._backgroundColorRgb)}}}),r.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},r.prototype.destroy=function(e){e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=s.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgb=null,this._backgroundColorString=null}},{"../const":20,"../math":30,"../utils":74,eventemitter3:3}],41:[function(e,t,i){function r(e,t,i){i=i||{},n.call(this,"Canvas",e,t,i),this.type=l.RENDERER_TYPE.CANVAS,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.maskManager=new o,this.smoothProperty="imageSmoothingEnabled",this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this._mapBlendModes(),this._tempDisplayObjectParent={worldTransform:new a.Matrix,worldAlpha:1},this.resize(e,t)}var n=e("../SystemRenderer"),o=e("./utils/CanvasMaskManager"),s=e("../../utils"),a=e("../../math"),l=e("../../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,s.pluginTarget.mixin(r),r.prototype.render=function(e){this.emit("prerender");var t=e.parent;this._lastObjectRendered=e,e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=t,this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation=this.blendModes[l.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e,this.context),this.emit("postrender")},r.prototype.destroy=function(e){this.destroyPlugins(),n.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},r.prototype.renderDisplayObject=function(e,t){var i=this.context;this.context=t,e.renderCanvas(this),this.context=i},r.prototype.resize=function(e,t){n.prototype.resize.call(this,e,t),this.smoothProperty&&(this.context[this.smoothProperty]=l.SCALE_MODES.DEFAULT===l.SCALE_MODES.LINEAR)},r.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},s.canUseNewCanvasBlendModes()?(this.blendModes[l.BLEND_MODES.NORMAL]="source-over",this.blendModes[l.BLEND_MODES.ADD]="lighter",this.blendModes[l.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[l.BLEND_MODES.SCREEN]="screen",this.blendModes[l.BLEND_MODES.OVERLAY]="overlay",this.blendModes[l.BLEND_MODES.DARKEN]="darken",this.blendModes[l.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[l.BLEND_MODES.COLOR_DODGE]="color-dodge",this.blendModes[l.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[l.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[l.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[l.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[l.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[l.BLEND_MODES.HUE]="hue",this.blendModes[l.BLEND_MODES.SATURATION]="saturate",this.blendModes[l.BLEND_MODES.COLOR]="color",this.blendModes[l.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[l.BLEND_MODES.NORMAL]="source-over",this.blendModes[l.BLEND_MODES.ADD]="lighter",this.blendModes[l.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[l.BLEND_MODES.SCREEN]="source-over",this.blendModes[l.BLEND_MODES.OVERLAY]="source-over",this.blendModes[l.BLEND_MODES.DARKEN]="source-over",this.blendModes[l.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[l.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[l.BLEND_MODES.COLOR_BURN]="source-over",this.blendModes[l.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[l.BLEND_MODES.SOFT_LIGHT]="source-over",this.blendModes[l.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[l.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[l.BLEND_MODES.HUE]="source-over",this.blendModes[l.BLEND_MODES.SATURATION]="source-over",this.blendModes[l.BLEND_MODES.COLOR]="source-over",this.blendModes[l.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":20,"../../math":30,"../../utils":74,"../SystemRenderer":40,"./utils/CanvasMaskManager":44}],42:[function(e,t,i){function r(e,t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t}r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e}},height:{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e}}}),r.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},r.prototype.resize=function(e,t){this.canvas.width=e,this.canvas.height=t},r.prototype.destroy=function(){this.context=null,this.canvas=null}},{}],43:[function(e,t,i){var r=e("../../../const"),n={};t.exports=n,n.renderGraphics=function(e,t){var i=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var n=0;n<e.graphicsData.length;n++){var o=e.graphicsData[n],s=o.shape,a=o._fillTint,l=o._lineTint;if(t.lineWidth=o.lineWidth,o.type===r.SHAPES.POLY){t.beginPath();var h=s.points;t.moveTo(h[0],h[1]);for(var c=1;c<h.length/2;c++)t.lineTo(h[2*c],h[2*c+1]);s.closed&&t.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*i,t.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*i,t.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),t.stroke())}else if(o.type===r.SHAPES.RECT)(o.fillColor||0===o.fillColor)&&(t.globalAlpha=o.fillAlpha*i,t.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.fillRect(s.x,s.y,s.width,s.height)),o.lineWidth&&(t.globalAlpha=o.lineAlpha*i,t.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),t.strokeRect(s.x,s.y,s.width,s.height));else if(o.type===r.SHAPES.CIRC)t.beginPath(),t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*i,t.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*i,t.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),t.stroke());else if(o.type===r.SHAPES.ELIP){var u=2*s.width,f=2*s.height,d=s.x-u/2,p=s.y-f/2;t.beginPath();var m=u/2*.5522848,g=f/2*.5522848,v=d+u,y=p+f,_=d+u/2,b=p+f/2;t.moveTo(d,b),t.bezierCurveTo(d,b-g,_-m,p,_,p),t.bezierCurveTo(_+m,p,v,b-g,v,b),t.bezierCurveTo(v,b+g,_+m,y,_,y),t.bezierCurveTo(_-m,y,d,b+g,d,b),t.closePath(),o.fill&&(t.globalAlpha=o.fillAlpha*i,t.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*i,t.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),t.stroke())}else if(o.type===r.SHAPES.RREC){var x=s.x,T=s.y,E=s.width,S=s.height,w=s.radius,M=Math.min(E,S)/2|0;w=w>M?M:w,t.beginPath(),t.moveTo(x,T+w),t.lineTo(x,T+S-w),t.quadraticCurveTo(x,T+S,x+w,T+S),t.lineTo(x+E-w,T+S),t.quadraticCurveTo(x+E,T+S,x+E,T+S-w),t.lineTo(x+E,T+w),t.quadraticCurveTo(x+E,T,x+E-w,T),t.lineTo(x+w,T),t.quadraticCurveTo(x,T,x,T+w),t.closePath(),(o.fillColor||0===o.fillColor)&&(t.globalAlpha=o.fillAlpha*i,t.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.fill()),o.lineWidth&&(t.globalAlpha=o.lineAlpha*i,t.strokeStyle="#"+("00000"+(0|l).toString(16)).substr(-6),t.stroke())}}},n.renderGraphicsMask=function(e,t){var i=e.graphicsData.length;if(0!==i){t.beginPath();for(var n=0;n<i;n++){var o=e.graphicsData[n],s=o.shape;if(o.type===r.SHAPES.POLY){var a=s.points;t.moveTo(a[0],a[1]);for(var l=1;l<a.length/2;l++)t.lineTo(a[2*l],a[2*l+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath()}else if(o.type===r.SHAPES.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(o.type===r.SHAPES.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(o.type===r.SHAPES.ELIP){var h=2*s.width,c=2*s.height,u=s.x-h/2,f=s.y-c/2,d=h/2*.5522848,p=c/2*.5522848,m=u+h,g=f+c,v=u+h/2,y=f+c/2;t.moveTo(u,y),t.bezierCurveTo(u,y-p,v-d,f,v,f),t.bezierCurveTo(v+d,f,m,y-p,m,y),t.bezierCurveTo(m,y+p,v+d,g,v,g),t.bezierCurveTo(v-d,g,u,y+p,u,y),t.closePath()}else if(o.type===r.SHAPES.RREC){var _=s.x,b=s.y,x=s.width,T=s.height,E=s.radius,S=Math.min(x,T)/2|0;E=E>S?S:E,t.moveTo(_,b+E),t.lineTo(_,b+T-E),t.quadraticCurveTo(_,b+T,_+E,b+T),t.lineTo(_+x-E,b+T),t.quadraticCurveTo(_+x,b+T,_+x,b+T-E),t.lineTo(_+x,b+E),t.quadraticCurveTo(_+x,b,_+x-E,b),t.lineTo(_+E,b),t.quadraticCurveTo(_,b,_,b+E),t.closePath()}}}},n.updateGraphicsTint=function(e){if(16777215!==e.tint||e._prevTint!==e.tint){e._prevTint=e.tint;for(var t=(e.tint>>16&255)/255,i=(e.tint>>8&255)/255,r=(255&e.tint)/255,n=0;n<e.graphicsData.length;n++){var o=e.graphicsData[n],s=0|o.fillColor,a=0|o.lineColor;o._fillTint=((s>>16&255)/255*t*255<<16)+((s>>8&255)/255*i*255<<8)+(255&s)/255*r*255,o._lineTint=((a>>16&255)/255*t*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*r*255}}}},{"../../../const":20}],44:[function(e,t,i){function r(){}var n=e("./CanvasGraphics");r.prototype.constructor=r,t.exports=r,r.prototype.pushMask=function(e,t){t.context.save();var i=e.alpha,r=e.worldTransform,o=t.resolution;t.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*o,r.ty*o),e.texture||(n.renderGraphicsMask(e,t.context),t.context.clip()),e.worldAlpha=i},r.prototype.popMask=function(e){e.context.restore()},r.prototype.destroy=function(){}},{"./CanvasGraphics":43}],45:[function(e,t,i){var r=e("../../../utils"),n={};t.exports=n,n.getTintedTexture=function(e,t){var i=e.texture;t=n.roundColor(t);var r="#"+("00000"+(0|t).toString(16)).substr(-6);if(i.tintCache=i.tintCache||{},i.tintCache[r])return i.tintCache[r];var o=n.canvas||document.createElement("canvas");if(n.tintMethod(i,t,o),n.convertTintToImage){var s=new Image;s.src=o.toDataURL(),i.tintCache[r]=s}else i.tintCache[r]=o,n.canvas=null;return o},n.tintWithMultiply=function(e,t,i){var r=i.getContext("2d"),n=e.baseTexture.resolution,o=e.crop.clone();o.x*=n,o.y*=n,o.width*=n,o.height*=n,i.width=o.width,i.height=o.height,r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="multiply",r.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},n.tintWithOverlay=function(e,t,i){var r=i.getContext("2d"),n=e.baseTexture.resolution,o=e.crop.clone();o.x*=n,o.y*=n,o.width*=n,o.height*=n,i.width=o.width,i.height=o.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),r.fillRect(0,0,o.width,o.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height)},n.tintWithPerPixel=function(e,t,i){var n=i.getContext("2d"),o=e.baseTexture.resolution,s=e.crop.clone();s.x*=o,s.y*=o,s.width*=o,s.height*=o,i.width=s.width,i.height=s.height,n.globalCompositeOperation="copy",n.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);for(var a=r.hex2rgb(t),l=a[0],h=a[1],c=a[2],u=n.getImageData(0,0,s.width,s.height),f=u.data,d=0;d<f.length;d+=4)f[d+0]*=l,f[d+1]*=h,f[d+2]*=c;n.putImageData(u,0,0)},n.roundColor=function(e){var t=n.cacheStepsPerColorChannel,i=r.hex2rgb(e);return i[0]=Math.min(255,i[0]/t*t),i[1]=Math.min(255,i[1]/t*t),i[2]=Math.min(255,i[2]/t*t),r.rgb2hex(i)},n.cacheStepsPerColorChannel=8,n.convertTintToImage=!1,n.canUseMultiply=r.canUseNewCanvasBlendModes(),n.tintMethod=n.canUseMultiply?n.tintWithMultiply:n.tintWithPerPixel},{"../../../utils":74}],46:[function(e,t,i){function r(e,t,i){i=i||{},n.call(this,"WebGL",e,t,i),this.type=p.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!i.forceFXAA&&i.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:i.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:i.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new o(this),this.maskManager=new s(this),this.stencilManager=new a(this),this.filterManager=new l(this),this.blendModeManager=new h(this),this.currentRenderTarget=null,this.currentRenderer=new u(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._managedTextures=[],this._renderTargetStack=[]}var n=e("../SystemRenderer"),o=e("./managers/ShaderManager"),s=e("./managers/MaskManager"),a=e("./managers/StencilManager"),l=e("./managers/FilterManager"),h=e("./managers/BlendModeManager"),c=e("./utils/RenderTarget"),u=e("./utils/ObjectRenderer"),f=e("./filters/FXAAFilter"),d=e("../../utils"),p=e("../../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,d.pluginTarget.mixin(r),r.glContextId=0,r.prototype._createContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=e,!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=r.glContextId++,e.id=this.glContextId,e.renderer=this},r.prototype._initContext=function(){var e=this.gl;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.renderTarget=new c(e,this.width,this.height,null,this.resolution,!0),this.setRenderTarget(this.renderTarget),this.emit("context",e),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!e.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new f])},r.prototype.render=function(e){if(this.emit("prerender"),!this.gl.isContextLost()){this.drawCount=0,this._lastObjectRendered=e,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,e.filterArea=this.renderTarget.size,e.filters=this._FXAAFilter);var t=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=t;var i=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?i.clearColor(0,0,0,0):i.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),i.clear(i.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.renderTarget),this.emit("postrender")}},r.prototype.renderDisplayObject=function(e,t,i){this.setRenderTarget(t),i&&t.clear(),this.filterManager.setFilterStack(t.filterStack),e.renderWebGL(this),this.currentRenderer.flush()},r.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},r.prototype.setRenderTarget=function(e){this.currentRenderTarget!==e&&(this.currentRenderTarget=e,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(e.stencilMaskStack))},r.prototype.resize=function(e,t){n.prototype.resize.call(this,e,t),this.filterManager.resize(e,t),this.renderTarget.resize(e,t),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},r.prototype.updateTexture=function(e){if(e=e.baseTexture||e,e.hasLoaded){var t=this.gl;return e._glTextures[t.id]||(e._glTextures[t.id]=t.createTexture(),e.on("update",this.updateTexture,this),e.on("dispose",this.destroyTexture,this),this._managedTextures.push(e)),t.bindTexture(t.TEXTURE_2D,e._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.scaleMode===p.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.mipmap&&e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===p.SCALE_MODES.LINEAR?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===p.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),e._glTextures[t.id]}},r.prototype.destroyTexture=function(e,t){if(e=e.baseTexture||e,e.hasLoaded&&e._glTextures[this.gl.id]&&(this.gl.deleteTexture(e._glTextures[this.gl.id]),delete e._glTextures[this.gl.id],!t)){var i=this._managedTextures.indexOf(e);-1!==i&&d.removeItems(this._managedTextures,i,1)}},r.prototype.handleContextLost=function(e){e.preventDefault()},r.prototype.handleContextRestored=function(){this._initContext();for(var e=0;e<this._managedTextures.length;++e){var t=this._managedTextures[e];t._glTextures[this.gl.id]&&delete t._glTextures[this.gl.id]}},r.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var t=0;t<this._managedTextures.length;++t){var i=this._managedTextures[t];this.destroyTexture(i,!0),i.off("update",this.updateTexture,this),i.off("dispose",this.destroyTexture,this)}n.prototype.destroy.call(this,e),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.blendModeManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this._managedTextures=null,this.drawCount=0,this.gl.useProgram(null),this.gl=null},r.prototype._mapGlModes=function(){var e=this.gl;this.blendModes||(this.blendModes={},this.blendModes[p.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],this.blendModes[p.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.SCREEN]=[e.SRC_ALPHA,e.ONE],this.blendModes[p.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[p.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[p.DRAW_MODES.POINTS]=e.POINTS,this.drawModes[p.DRAW_MODES.LINES]=e.LINES,this.drawModes[p.DRAW_MODES.LINE_LOOP]=e.LINE_LOOP,this.drawModes[p.DRAW_MODES.LINE_STRIP]=e.LINE_STRIP,this.drawModes[p.DRAW_MODES.TRIANGLES]=e.TRIANGLES,this.drawModes[p.DRAW_MODES.TRIANGLE_STRIP]=e.TRIANGLE_STRIP,this.drawModes[p.DRAW_MODES.TRIANGLE_FAN]=e.TRIANGLE_FAN)}},{"../../const":20,"../../utils":74,"../SystemRenderer":40,"./filters/FXAAFilter":48,"./managers/BlendModeManager":50,"./managers/FilterManager":51,"./managers/MaskManager":52,"./managers/ShaderManager":53,"./managers/StencilManager":54,"./utils/ObjectRenderer":60,"./utils/RenderTarget":62}],47:[function(e,t,i){function r(e,t,i){this.shaders=[],this.padding=0,this.uniforms=i||{},this.vertexSrc=e||n.defaultVertexSrc,this.fragmentSrc=t||n.defaultFragmentSrc}var n=e("../shaders/TextureShader");r.prototype.constructor=r,t.exports=r,r.prototype.getShader=function(e){var t=e.gl,i=this.shaders[t.id];return i||(i=new n(e.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[t.id]=i),i},r.prototype.applyFilter=function(e,t,i,r){var n=this.getShader(e);e.filterManager.applyFilter(n,t,i,r)},r.prototype.syncUniform=function(e){for(var t=0,i=this.shaders.length;t<i;++t)this.shaders[t].syncUniform(e)}},{"../shaders/TextureShader":59}],48:[function(e,t,i){function r(){n.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{resolution:{type:"v2",value:{x:1,y:1}}})}var n=e("./AbstractFilter");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager,n=this.getShader(e);r.applyFilter(n,t,i)}},{"./AbstractFilter":47}],49:[function(e,t,i){function r(e){var t=new o.Matrix;n.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:e._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:t.toArray(!0)}}),this.maskSprite=e,this.maskMatrix=t}var n=e("./AbstractFilter"),o=e("../../../math");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager;this.uniforms.mask.value=this.maskSprite._texture,r.calculateMappedMatrix(t.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.alpha.value=this.maskSprite.worldAlpha;var n=this.getShader(e);r.applyFilter(n,t,i)},Object.defineProperties(r.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(e){this.uniforms.mask.value=e}},offset:{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}}})},{"../../../math":30,"./AbstractFilter":47}],50:[function(e,t,i){function r(e){n.call(this,e),this.currentBlendMode=99999}var n=e("./WebGLManager");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var t=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(t[0],t[1]),!0}},{"./WebGLManager":55}],51:[function(e,t,i){function r(e){n.call(this,e),this.filterStack=[],this.filterStack.push({renderTarget:e.currentRenderTarget,filter:[],bounds:null}),this.texturePool=[],this.textureSize=new l.Rectangle(0,0,e.width,e.height),this.currentFrame=null}var n=e("./WebGLManager"),o=e("../utils/RenderTarget"),s=e("../../../const"),a=e("../utils/Quad"),l=e("../../../math");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.onContextChange=function(){this.texturePool.length=0;var e=this.renderer.gl;this.quad=new a(e)},r.prototype.setFilterStack=function(e){this.filterStack=e},r.prototype.pushFilter=function(e,t){var i=e.filterArea?e.filterArea.clone():e.getBounds();i.x=0|i.x,i.y=0|i.y,i.width=0|i.width,i.height=0|i.height;var r=0|t[0].padding;if(i.x-=r,i.y-=r,i.width+=2*r,i.height+=2*r,this.renderer.currentRenderTarget.transform){var n=this.renderer.currentRenderTarget.transform;i.x+=n.tx,i.y+=n.ty,this.capFilterArea(i),i.x-=n.tx,i.y-=n.ty}else this.capFilterArea(i);if(i.width>0&&i.height>0){this.currentFrame=i;var o=this.getRenderTarget();this.renderer.setRenderTarget(o),o.clear(),this.filterStack.push({renderTarget:o,filter:t})}else this.filterStack.push({renderTarget:null,filter:t})},r.prototype.popFilter=function(){var e=this.filterStack.pop(),t=this.filterStack[this.filterStack.length-1],i=e.renderTarget;if(e.renderTarget){var r=t.renderTarget,n=this.renderer.gl;this.currentFrame=i.frame,this.quad.map(this.textureSize,i.frame),n.bindBuffer(n.ARRAY_BUFFER,this.quad.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var o=e.filter;if(n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,n.FLOAT,!1,0,0),n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,n.FLOAT,!1,0,32),n.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,n.FLOAT,!1,0,64),this.renderer.blendModeManager.setBlendMode(s.BLEND_MODES.NORMAL),1===o.length)o[0].uniforms.dimensions&&(o[0].uniforms.dimensions.value[0]=this.renderer.width,o[0].uniforms.dimensions.value[1]=this.renderer.height,o[0].uniforms.dimensions.value[2]=this.quad.vertices[0],o[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),o[0].applyFilter(this.renderer,i,r),this.returnRenderTarget(i);else{for(var a=i,l=this.getRenderTarget(!0),h=0;h<o.length-1;h++){var c=o[h];c.uniforms.dimensions&&(c.uniforms.dimensions.value[0]=this.renderer.width,c.uniforms.dimensions.value[1]=this.renderer.height,c.uniforms.dimensions.value[2]=this.quad.vertices[0],c.uniforms.dimensions.value[3]=this.quad.vertices[5]),c.applyFilter(this.renderer,a,l);var u=a;a=l,l=u}o[o.length-1].applyFilter(this.renderer,a,r),this.returnRenderTarget(a),this.returnRenderTarget(l)}return e.filter}},r.prototype.getRenderTarget=function(e){var t=this.texturePool.pop()||new o(this.renderer.gl,this.textureSize.width,this.textureSize.height,s.SCALE_MODES.LINEAR,this.renderer.resolution*s.FILTER_RESOLUTION);return t.frame=this.currentFrame,e&&t.clear(!0),t},r.prototype.returnRenderTarget=function(e){this.texturePool.push(e)},r.prototype.applyFilter=function(e,t,i,r){var n=this.renderer.gl;this.renderer.setRenderTarget(i),r&&i.clear(),this.renderer.shaderManager.setShader(e),e.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),e.syncUniforms(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.texture),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),this.renderer.drawCount++},r.prototype.calculateMappedMatrix=function(e,t,i){var r=t.worldTransform.copy(l.Matrix.TEMP_MATRIX),n=t._texture.baseTexture,o=i.identity(),s=this.textureSize.height/this.textureSize.width;o.translate(e.x/this.textureSize.width,e.y/this.textureSize.height),o.scale(1,s);var a=this.textureSize.width/n.width,h=this.textureSize.height/n.height;return r.tx/=n.width*a,r.ty/=n.width*a,r.invert(),o.prepend(r),o.scale(1,1/s),o.scale(a,h),o.translate(t.anchor.x,t.anchor.y),o},r.prototype.capFilterArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.textureSize.width&&(e.width=this.textureSize.width-e.x),e.y+e.height>this.textureSize.height&&(e.height=this.textureSize.height-e.y)},r.prototype.resize=function(e,t){this.textureSize.width=e,this.textureSize.height=t;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].resize(e,t)},r.prototype.destroy=function(){this.quad.destroy(),n.prototype.destroy.call(this),this.filterStack=null,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null}},{"../../../const":20,"../../../math":30,"../utils/Quad":61,"../utils/RenderTarget":62,"./WebGLManager":55}],52:[function(e,t,i){function r(e){n.call(this,e),this.stencilStack=[],this.reverse=!0,this.count=0,this.alphaMaskPool=[]}var n=e("./WebGLManager"),o=e("../filters/SpriteMaskFilter");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.pushMask=function(e,t){t.texture?this.pushSpriteMask(e,t):this.pushStencilMask(e,t)},r.prototype.popMask=function(e,t){t.texture?this.popSpriteMask(e,t):this.popStencilMask(e,t)},r.prototype.pushSpriteMask=function(e,t){var i=this.alphaMaskPool.pop();i||(i=[new o(t)]),i[0].maskSprite=t,this.renderer.filterManager.pushFilter(e,i)},r.prototype.popSpriteMask=function(){var e=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(e)},r.prototype.pushStencilMask=function(e,t){this.renderer.stencilManager.pushMask(t)},r.prototype.popStencilMask=function(e,t){this.renderer.stencilManager.popMask(t)}},{"../filters/SpriteMaskFilter":49,"./WebGLManager":55}],53:[function(e,t,i){function r(e){n.call(this,e),this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[],this._currentId=-1,this.currentShader=null}var n=e("./WebGLManager"),o=e("../shaders/TextureShader"),s=e("../shaders/ComplexPrimitiveShader"),a=e("../shaders/PrimitiveShader"),l=e("../../../utils");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,l.pluginTarget.mixin(r),t.exports=r,r.prototype.onContextChange=function(){this.initPlugins();var e=this.renderer.gl;this.maxAttibs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.attribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.defaultShader=new o(this),this.primitiveShader=new a(this),this.complexPrimitiveShader=new s(this)},r.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(var i in e)this.tempAttribState[e[i]]=!0;var r=this.renderer.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.attribState[t]?r.enableVertexAttribArray(t):r.disableVertexAttribArray(t))},r.prototype.setShader=function(e){return this._currentId!==e.uid&&(this._currentId=e.uid,this.currentShader=e,this.renderer.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},r.prototype.destroy=function(){this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),n.prototype.destroy.call(this),this.destroyPlugins(),this.attribState=null,this.tempAttribState=null}},{"../../../utils":74,"../shaders/ComplexPrimitiveShader":56,"../shaders/PrimitiveShader":57,"../shaders/TextureShader":59,"./WebGLManager":55}],54:[function(e,t,i){function r(e){n.call(this,e),this.stencilMaskStack=null}var n=e("./WebGLManager"),o=e("../../../utils");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.setMaskStack=function(e){this.stencilMaskStack=e;var t=this.renderer.gl;0===e.stencilStack.length?t.disable(t.STENCIL_TEST):t.enable(t.STENCIL_TEST)},r.prototype.pushStencil=function(e,t){this.renderer.currentRenderTarget.attachStencilBuffer();var i=this.renderer.gl,r=this.stencilMaskStack;this.bindGraphics(e,t),0===r.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),r.reverse=!0,r.count=0),r.stencilStack.push(t);var n=r.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),1===t.mode?(i.drawElements(i.TRIANGLE_FAN,t.indices.length-4,i.UNSIGNED_SHORT,0),r.reverse?(i.stencilFunc(i.EQUAL,255-n,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,n,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(t.indices.length-4)),r.reverse?i.stencilFunc(i.EQUAL,255-(n+1),255):i.stencilFunc(i.EQUAL,n+1,255),r.reverse=!r.reverse):(r.reverse?(i.stencilFunc(i.EQUAL,n,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-n,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_STRIP,t.indices.length,i.UNSIGNED_SHORT,0),r.reverse?i.stencilFunc(i.EQUAL,n+1,255):i.stencilFunc(i.EQUAL,255-(n+1),255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),r.count++},r.prototype.bindGraphics=function(e,t){var i,r=this.renderer.gl;1===t.mode?(i=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(i),r.uniformMatrix3fv(i.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),r.uniformMatrix3fv(i.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),r.uniform3fv(i.uniforms.tint._location,o.hex2rgb(e.tint)),r.uniform3fv(i.uniforms.color._location,t.color),r.uniform1f(i.uniforms.alpha._location,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(i.attributes.aVertexPosition,2,r.FLOAT,!1,8,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer)):(i=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(i),r.uniformMatrix3fv(i.uniforms.translationMatrix._location,!1,e.worldTransform.toArray(!0)),r.uniformMatrix3fv(i.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),r.uniform3fv(i.uniforms.tint._location,o.hex2rgb(e.tint)),r.uniform1f(i.uniforms.alpha._location,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(i.attributes.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(i.attributes.aColor,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer))},r.prototype.popStencil=function(e,t){var i=this.renderer.gl,r=this.stencilMaskStack;if(r.stencilStack.pop(),r.count--,0===r.stencilStack.length)i.disable(i.STENCIL_TEST);else{var n=r.count;this.bindGraphics(e,t),i.colorMask(!1,!1,!1,!1),1===t.mode?(r.reverse=!r.reverse,r.reverse?(i.stencilFunc(i.EQUAL,255-(n+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,n+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,2*(t.indices.length-4)),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),i.drawElements(i.TRIANGLE_FAN,t.indices.length-4,i.UNSIGNED_SHORT,0),this.renderer.drawCount+=2,r.reverse?i.stencilFunc(i.EQUAL,n,255):i.stencilFunc(i.EQUAL,255-n,255)):(r.reverse?(i.stencilFunc(i.EQUAL,n+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(n+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),i.drawElements(i.TRIANGLE_STRIP,t.indices.length,i.UNSIGNED_SHORT,0),this.renderer.drawCount++,r.reverse?i.stencilFunc(i.EQUAL,n,255):i.stencilFunc(i.EQUAL,255-n,255)),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},r.prototype.destroy=function(){n.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},r.prototype.pushMask=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),e.dirty&&this.renderer.plugins.graphics.updateGraphics(e,this.renderer.gl),e._webGL[this.renderer.gl.id].data.length&&this.pushStencil(e,e._webGL[this.renderer.gl.id].data[0])},r.prototype.popMask=function(e){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.popStencil(e,e._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":74,"./WebGLManager":55}],55:[function(e,t,i){function r(e){this.renderer=e,this.renderer.on("context",this.onContextChange,this)}r.prototype.constructor=r,t.exports=r,r.prototype.onContextChange=function(){},r.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],56:[function(e,t,i){function r(e){n.call(this,e,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var n=e("./Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r},{"./Shader":58}],57:[function(e,t,i){function r(e){n.call(this,e,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var n=e("./Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r},{"./Shader":58}],58:[function(e,t,i){function r(e,t,i,r,o){if(!t||!i)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=n.uid(),this.gl=e.renderer.gl,this.shaderManager=e,this.program=null,this.uniforms=r||{},this.attributes=o||{},this.textureCount=1,this.vertexSrc=t,this.fragmentSrc=i,this.init()}var n=e("../../../utils");r.prototype.constructor=r,t.exports=r,r.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},r.prototype.cacheUniformLocations=function(e){for(var t=0;t<e.length;++t)this.uniforms[e[t]]._location=this.gl.getUniformLocation(this.program,e[t])},r.prototype.cacheAttributeLocations=function(e){for(var t=0;t<e.length;++t)this.attributes[e[t]]=this.gl.getAttribLocation(this.program,e[t])},r.prototype.compile=function(){var e=this.gl,t=this._glCompile(e.VERTEX_SHADER,this.vertexSrc),i=this._glCompile(e.FRAGMENT_SHADER,this.fragmentSrc),r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(r,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),""!==e.getProgramInfoLog(r)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(r)),e.deleteProgram(r),r=null),e.deleteShader(t),e.deleteShader(i),this.program=r},r.prototype.syncUniform=function(e){var t,i,r=e._location,o=e.value,s=this.gl;switch(e.type){case"b":case"bool":case"boolean":s.uniform1i(r,o?1:0);break;case"i":case"1i":s.uniform1i(r,o);break;case"f":case"1f":s.uniform1f(r,o);break;case"2f":s.uniform2f(r,o[0],o[1]);break;case"3f":s.uniform3f(r,o[0],o[1],o[2]);break;case"4f":s.uniform4f(r,o[0],o[1],o[2],o[3]);break;case"v2":s.uniform2f(r,o.x,o.y);break;case"v3":s.uniform3f(r,o.x,o.y,o.z);break;case"v4":s.uniform4f(r,o.x,o.y,o.z,o.w);break;case"1iv":s.uniform1iv(r,o);break;case"2iv":s.uniform2iv(r,o);break;case"3iv":s.uniform3iv(r,o);break;case"4iv":s.uniform4iv(r,o);break;case"1fv":s.uniform1fv(r,o);break;case"2fv":s.uniform2fv(r,o);break;case"3fv":s.uniform3fv(r,o);break;case"4fv":s.uniform4fv(r,o);break;case"m2":case"mat2":case"Matrix2fv":s.uniformMatrix2fv(r,e.transpose,o);break;case"m3":case"mat3":case"Matrix3fv":s.uniformMatrix3fv(r,e.transpose,o);break;case"m4":case"mat4":case"Matrix4fv":s.uniformMatrix4fv(r,e.transpose,o);break;case"c":"number"==typeof o&&(o=n.hex2rgb(o)),s.uniform3f(r,o[0],o[1],o[2]);break;case"iv1":s.uniform1iv(r,o);break;case"iv":s.uniform3iv(r,o);break;case"fv1":s.uniform1fv(r,o);break;case"fv":s.uniform3fv(r,o);break;case"v2v":for(e._array||(e._array=new Float32Array(2*o.length)),t=0,i=o.length;t<i;++t)e._array[2*t]=o[t].x,e._array[2*t+1]=o[t].y;s.uniform2fv(r,e._array);break;case"v3v":for(e._array||(e._array=new Float32Array(3*o.length)),t=0,i=o.length;t<i;++t)e._array[3*t]=o[t].x,e._array[3*t+1]=o[t].y,e._array[3*t+2]=o[t].z;s.uniform3fv(r,e._array);break;case"v4v":for(e._array||(e._array=new Float32Array(4*o.length)),t=0,i=o.length;t<i;++t)e._array[4*t]=o[t].x,e._array[4*t+1]=o[t].y,e._array[4*t+2]=o[t].z,e._array[4*t+3]=o[t].w;s.uniform4fv(r,e._array);break;case"t":case"sampler2D":if(!e.value||!e.value.baseTexture.hasLoaded)break;s.activeTexture(s["TEXTURE"+this.textureCount]);var a=e.value.baseTexture._glTextures[s.id];a||(this.initSampler2D(e),a=e.value.baseTexture._glTextures[s.id]),s.bindTexture(s.TEXTURE_2D,a),s.uniform1i(e._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+e.type)}},r.prototype.syncUniforms=function(){this.textureCount=1;for(var e in this.uniforms)this.syncUniform(this.uniforms[e])},r.prototype.initSampler2D=function(e){var t=this.gl,i=e.value.baseTexture;if(i.hasLoaded)if(e.textureData){var r=e.textureData;i._glTextures[t.id]=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,r.luminance?t.LUMINANCE:t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r.magFilter?r.magFilter:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r.wrapS?r.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r.wrapS?r.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r.wrapT?r.wrapT:t.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(i)},r.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},r.prototype._glCompile=function(e,t){var i=this.gl.createShader(e);return this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(console.log(this.gl.getShaderInfoLog(i)),null)}},{"../../../utils":74}],59:[function(e,t,i){function r(e,t,i,o,s){var a={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(o)for(var l in o)a[l]=o[l];var h={aVertexPosition:0,aTextureCoord:0,aColor:0};if(s)for(var c in s)h[c]=s[c];t=t||r.defaultVertexSrc,i=i||r.defaultFragmentSrc,n.call(this,e,t,i,a,h)}var n=e("./Shader");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),r.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":58}],60:[function(e,t,i){function r(e){n.call(this,e)}var n=e("../managers/WebGLManager");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.start=function(){},r.prototype.stop=function(){this.flush()},r.prototype.flush=function(){},r.prototype.render=function(e){}},{"../managers/WebGLManager":55}],61:[function(e,t,i){function r(e){this.gl=e,this.vertices=new Float32Array([0,0,200,0,200,200,0,200]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.indices=new Uint16Array([0,1,2,0,3,2]),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,128,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),this.upload()}r.prototype.constructor=r,r.prototype.map=function(e,t){var i=0,r=0;this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+t.width/e.width,this.uvs[3]=r,this.uvs[4]=i+t.width/e.width,this.uvs[5]=r+t.height/e.height,this.uvs[6]=i,this.uvs[7]=r+t.height/e.height,i=t.x,r=t.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+t.width,this.vertices[3]=r,this.vertices[4]=i+t.width,this.vertices[5]=r+t.height,this.vertices[6]=i,this.vertices[7]=r+t.height,this.upload()},r.prototype.upload=function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.bufferSubData(e.ARRAY_BUFFER,32,this.uvs),e.bufferSubData(e.ARRAY_BUFFER,64,this.colors)},r.prototype.destroy=function(){var e=this.gl;e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer)},t.exports=r},{}],62:[function(e,t,i){var r=e("../../../math"),n=e("../../../utils"),o=e("../../../const"),s=e("./StencilMaskStack"),a=function(e,t,i,a,l,h){if(this.gl=e,this.frameBuffer=null,this.texture=null,this.size=new r.Rectangle(0,0,1,1),this.resolution=l||o.RESOLUTION,this.projectionMatrix=new r.Matrix,this.transform=null,this.frame=null,this.stencilBuffer=null,this.stencilMaskStack=new s,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.scaleMode=a||o.SCALE_MODES.DEFAULT,this.root=h,!this.root){this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a===o.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a===o.SCALE_MODES.LINEAR?e.LINEAR:e.NEAREST);n.isPowerOfTwo(t,i)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0)}this.resize(t,i)};a.prototype.constructor=a,t.exports=a,a.prototype.clear=function(e){var t=this.gl;e&&t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},a.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var e=this.gl;this.stencilBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.stencilBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}},a.prototype.activate=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer);var t=this.frame||this.size;this.calculateProjection(t),this.transform&&this.projectionMatrix.append(this.transform),e.viewport(0,0,t.width*this.resolution,t.height*this.resolution)},a.prototype.calculateProjection=function(e){var t=this.projectionMatrix;t.identity(),this.root?(t.a=1/e.width*2,t.d=-1/e.height*2,t.tx=-1-e.x*t.a,t.ty=1-e.y*t.d):(t.a=1/e.width*2,t.d=1/e.height*2,t.tx=-1-e.x*t.a,t.ty=-1-e.y*t.d)},a.prototype.resize=function(e,t){if(e|=0,t|=0,this.size.width!==e||this.size.height!==t){if(this.size.width=e,this.size.height=t,!this.root){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e*this.resolution,t*this.resolution,0,i.RGBA,i.UNSIGNED_BYTE,null),this.stencilBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,this.stencilBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e*this.resolution,t*this.resolution))}var r=this.frame||this.size;this.calculateProjection(r)}},a.prototype.destroy=function(){var e=this.gl;e.deleteRenderbuffer(this.stencilBuffer),e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null}},{"../../../const":20,"../../../math":30,"../../../utils":74,"./StencilMaskStack":63}],63:[function(e,t,i){function r(){this.stencilStack=[],this.reverse=!0,this.count=0}r.prototype.constructor=r,t.exports=r},{}],64:[function(e,t,i){function r(e){s.call(this),this.anchor=new n.Point,this._texture=null,this._width=0,this._height=0,this.tint=16777215,this.blendMode=h.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=e||o.EMPTY}var n=e("../math"),o=e("../textures/Texture"),s=e("../display/Container"),a=e("../renderers/canvas/utils/CanvasTinter"),l=e("../utils"),h=e("../const"),c=new n.Point;r.prototype=Object.create(s.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(e){var t=l.sign(this.scale.x)||1;this.scale.x=t*e/this.texture._frame.width,this._width=e}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(e){var t=l.sign(this.scale.y)||1;this.scale.y=t*e/this.texture._frame.height,this._height=e}},texture:{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this.cachedTint=16777215,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}}),r.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=l.sign(this.scale.x)*this._width/this.texture.frame.width),this._height&&(this.scale.y=l.sign(this.scale.y)*this._height/this.texture.frame.height)},r.prototype._renderWebGL=function(e){e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this)},r.prototype.getBounds=function(e){if(!this._currentBounds){var t,i,r,n,o=this._texture._frame.width,s=this._texture._frame.height,a=o*(1-this.anchor.x),l=o*-this.anchor.x,h=s*(1-this.anchor.y),c=s*-this.anchor.y,u=e||this.worldTransform,f=u.a,d=u.b,p=u.c,m=u.d,g=u.tx,v=u.ty,y=f*l+p*c+g,_=m*c+d*l+v,b=f*a+p*c+g,x=m*c+d*a+v,T=f*a+p*h+g,E=m*h+d*a+v,S=f*l+p*h+g,w=m*h+d*l+v;if(t=y,t=b<t?b:t,t=T<t?T:t,t=S<t?S:t,r=_,r=x<r?x:r,r=E<r?E:r,r=w<r?w:r,i=y,i=b>i?b:i,i=T>i?T:i,i=S>i?S:i,n=_,n=x>n?x:n,n=E>n?E:n,n=w>n?w:n,this.children.length){var M=this.containerGetBounds();a=M.x,l=M.x+M.width,h=M.y,c=M.y+M.height,t=t<a?t:a,r=r<h?r:h,i=i>l?i:l,n=n>c?n:c}var A=this._bounds;A.x=t,A.width=i-t,A.y=r,A.height=n-r,this._currentBounds=A}return this._currentBounds},r.prototype.getLocalBounds=function(){return this._bounds.x=-this._texture._frame.width*this.anchor.x,this._bounds.y=-this._texture._frame.height*this.anchor.y,this._bounds.width=this._texture._frame.width,this._bounds.height=this._texture._frame.height,this._bounds},r.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,c);var t,i=this._texture._frame.width,r=this._texture._frame.height,n=-i*this.anchor.x;return c.x>n&&c.x<n+i&&(t=-r*this.anchor.y,c.y>t&&c.y<t+r)},r.prototype._renderCanvas=function(e){if(!(this.texture.crop.width<=0||this.texture.crop.height<=0)){var t=e.blendModes[this.blendMode];if(t!==e.context.globalCompositeOperation&&(e.context.globalCompositeOperation=t),this.texture.valid){var i,r,n,o,s=this._texture,l=this.worldTransform;e.context.globalAlpha=this.worldAlpha;var c=s.baseTexture.scaleMode===h.SCALE_MODES.LINEAR;if(e.smoothProperty&&e.context[e.smoothProperty]!==c&&(e.context[e.smoothProperty]=c),s.rotate){n=s.crop.height,o=s.crop.width,i=s.trim?s.trim.y-this.anchor.y*s.trim.height:this.anchor.y*-s._frame.height,r=s.trim?s.trim.x-this.anchor.x*s.trim.width:this.anchor.x*-s._frame.width,i+=n,l.tx=r*l.a+i*l.c+l.tx,l.ty=r*l.b+i*l.d+l.ty;var u=l.a;l.a=-l.c,l.c=u,u=l.b,l.b=-l.d,l.d=u,i=0,r=0}else n=s.crop.width,o=s.crop.height,i=s.trim?s.trim.x-this.anchor.x*s.trim.width:this.anchor.x*-s._frame.width,r=s.trim?s.trim.y-this.anchor.y*s.trim.height:this.anchor.y*-s._frame.height;e.roundPixels?(e.context.setTransform(l.a,l.b,l.c,l.d,l.tx*e.resolution|0,l.ty*e.resolution|0),i|=0,r|=0):e.context.setTransform(l.a,l.b,l.c,l.d,l.tx*e.resolution,l.ty*e.resolution);var f=s.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=a.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,n*f,o*f,i*e.resolution,r*e.resolution,n*e.resolution,o*e.resolution)):e.context.drawImage(s.baseTexture.source,s.crop.x*f,s.crop.y*f,n*f,o*f,i*e.resolution,r*e.resolution,n*e.resolution,o*e.resolution)}}},r.prototype.destroy=function(e,t){s.prototype.destroy.call(this),this.anchor=null,e&&this._texture.destroy(t),this._texture=null,this.shader=null},r.fromFrame=function(e){var t=l.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return new r(t)},r.fromImage=function(e,t,i){return new r(o.fromImage(e,t,i))}},{"../const":20,"../display/Container":21,"../math":30,"../renderers/canvas/utils/CanvasTinter":45,"../textures/Texture":69,"../utils":74}],65:[function(e,t,i){function r(e){n.call(this,e),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=s.SPRITE_BATCH_SIZE;var t=4*this.size*this.vertByteSize,i=6*this.size;this.vertices=new ArrayBuffer(t),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(i);for(var r=0,o=0;r<i;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.currentBatchSize=0,this.sprites=[],this.shader=null}var n=e("../../renderers/webgl/utils/ObjectRenderer"),o=e("../../renderers/webgl/WebGLRenderer"),s=e("../../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,o.registerPlugin("sprite",r),r.prototype.onContextChange=function(){var e=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},r.prototype.render=function(e){var t=e._texture;this.currentBatchSize>=this.size&&this.flush();var i=t._uvs;if(i){var r,n,o,s,a=e.anchor.x,l=e.anchor.y;if(t.trim&&void 0===e.tileScale){var h=t.trim;n=h.x-a*h.width,r=n+t.crop.width,s=h.y-l*h.height,o=s+t.crop.height}else r=t._frame.width*(1-a),n=t._frame.width*-a,o=t._frame.height*(1-l),s=t._frame.height*-l;var c=this.currentBatchSize*this.vertByteSize,u=e.worldTransform,f=u.a,d=u.b,p=u.c,m=u.d,g=u.tx,v=u.ty,y=this.colors,_=this.positions;if(this.renderer.roundPixels){var b=this.renderer.resolution;_[c]=((f*n+p*s+g)*b|0)/b,_[c+1]=((m*s+d*n+v)*b|0)/b,_[c+5]=((f*r+p*s+g)*b|0)/b,_[c+6]=((m*s+d*r+v)*b|0)/b,_[c+10]=((f*r+p*o+g)*b|0)/b,_[c+11]=((m*o+d*r+v)*b|0)/b,_[c+15]=((f*n+p*o+g)*b|0)/b,_[c+16]=((m*o+d*n+v)*b|0)/b}else _[c]=f*n+p*s+g,_[c+1]=m*s+d*n+v,_[c+5]=f*r+p*s+g,_[c+6]=m*s+d*r+v,_[c+10]=f*r+p*o+g,_[c+11]=m*o+d*r+v,_[c+15]=f*n+p*o+g,_[c+16]=m*o+d*n+v;_[c+2]=i.x0,_[c+3]=i.y0,_[c+7]=i.x1,_[c+8]=i.y1,_[c+12]=i.x2,_[c+13]=i.y2,_[c+17]=i.x3,_[c+18]=i.y3;var x=e.tint;y[c+4]=y[c+9]=y[c+14]=y[c+19]=(x>>16)+(65280&x)+((255&x)<<16)+(255*e.worldAlpha<<24),this.sprites[this.currentBatchSize++]=e}},r.prototype.flush=function(){if(0!==this.currentBatchSize){var e,t=this.renderer.gl;if(this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var i=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);t.bufferSubData(t.ARRAY_BUFFER,0,i)}for(var r,n,o,s,a=0,l=0,h=null,c=this.renderer.blendModeManager.currentBlendMode,u=null,f=!1,d=!1,p=0,m=this.currentBatchSize;p<m;p++)s=this.sprites[p],r=s._texture.baseTexture,n=s.blendMode,o=s.shader||this.shader,f=c!==n,d=u!==o,(h!==r||f||d)&&(this.renderBatch(h,a,l),l=p,a=0,h=r,f&&(c=n,this.renderer.blendModeManager.setBlendMode(c)),d&&(u=o,e=u.shaders?u.shaders[t.id]:u,e||(e=u.getShader(this.renderer)),this.renderer.shaderManager.setShader(e),e.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),e.syncUniforms(),t.activeTexture(t.TEXTURE0))),a++;this.renderBatch(h,a,l),this.currentBatchSize=0}},r.prototype.renderBatch=function(e,t,i){if(0!==t){var r=this.renderer.gl;e._glTextures[r.id]?r.bindTexture(r.TEXTURE_2D,e._glTextures[r.id]):this.renderer.updateTexture(e),r.drawElements(r.TRIANGLES,6*t,r.UNSIGNED_SHORT,6*i*2),this.renderer.drawCount++}},r.prototype.start=function(){var e=this.renderer.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.vertByteSize;e.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,e.FLOAT,!1,t,0),e.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,e.FLOAT,!1,t,8),e.vertexAttribPointer(this.shader.attributes.aColor,4,e.UNSIGNED_BYTE,!0,t,16)},r.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer),this.renderer.gl.deleteBuffer(this.indexBuffer),n.prototype.destroy.call(this),this.shader.destroy(),this.renderer=null,this.vertices=null,this.positions=null,this.colors=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.sprites=null,this.shader=null}},{"../../const":20,"../../renderers/webgl/WebGLRenderer":46,"../../renderers/webgl/utils/ObjectRenderer":60}],66:[function(e,t,i){function r(e,t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||l.RESOLUTION,this._text=null,this._style=null;var r=o.fromCanvas(this.canvas);r.trim=new s.Rectangle,n.call(this,r),this.text=e,this.style=t}var n=e("../sprites/Sprite"),o=e("../textures/Texture"),s=e("../math"),a=e("../utils"),l=e("../const");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.fontPropertiesCache={},r.fontPropertiesCanvas=document.createElement("canvas"),r.fontPropertiesContext=r.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(r.prototype,{width:{get:function(){return this.dirty&&this.updateText(),this.scale.x*this._texture._frame.width},set:function(e){this.scale.x=e/this._texture._frame.width,this._width=e}},height:{get:function(){return this.dirty&&this.updateText(),this.scale.y*this._texture._frame.height},set:function(e){this.scale.y=e/this._texture._frame.height,this._height=e}},style:{get:function(){return this._style},set:function(e){e=e||{},"number"==typeof e.fill&&(e.fill=a.hex2string(e.fill)),"number"==typeof e.stroke&&(e.stroke=a.hex2string(e.stroke)),"number"==typeof e.dropShadowColor&&(e.dropShadowColor=a.hex2string(e.dropShadowColor)),e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowColor=e.dropShadowColor||"#000000",e.dropShadowAngle=e.dropShadowAngle||Math.PI/6,e.dropShadowDistance=e.dropShadowDistance||5,e.padding=e.padding||0,e.textBaseline=e.textBaseline||"alphabetic",e.lineJoin=e.lineJoin||"miter",e.miterLimit=e.miterLimit||10,this._style=e,this.dirty=!0}},text:{get:function(){return this._text},set:function(e){e=e.toString()||" ",this._text!==e&&(this._text=e,this.dirty=!0)}}}),r.prototype.updateText=function(){var e=this._style;this.context.font=e.font;for(var t=e.wordWrap?this.wordWrap(this._text,this.text_join||""):this._text,i=t.split(/(?:\r\n|\r|\n)/),r=new Array(i.length),n=0,o=this.determineFontProperties(e.font),s=0;s<i.length;s++){var a=this.context.measureText(i[s]).width;r[s]=a,n=Math.max(n,a)}!0===e.wordWrap&&(n=Math.max(n,e.wordWrapWidth));var l=n+e.strokeThickness;e.dropShadow&&(l+=e.dropShadowDistance),this.canvas.width=(l+this.context.lineWidth)*this.resolution;var h=this.style.lineHeight||o.fontSize+e.strokeThickness,c=h*i.length;e.dropShadow&&(c+=e.dropShadowDistance),this.canvas.height=(c+2*this._style.padding)*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=e.font,this.context.strokeStyle=e.stroke,this.context.lineWidth=e.strokeThickness,this.context.textBaseline=e.textBaseline,this.context.lineJoin=e.lineJoin,this.context.miterLimit=e.miterLimit;var u,f;if(e.dropShadow){e.dropShadowBlur>0?(this.context.shadowColor=e.dropShadowColor,this.context.shadowBlur=e.dropShadowBlur):this.context.fillStyle=e.dropShadowColor;var d=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,p=Math.sin(e.dropShadowAngle)*e.dropShadowDistance;for(s=0;s<i.length;s++)u=e.strokeThickness/2,f=e.strokeThickness/2+s*h+o.ascent,"right"===e.align?u+=n-r[s]:"center"===e.align&&(u+=(n-r[s])/2),e.fill&&this.context.fillText(i[s],u+d,f+p+this._style.padding)}for(this.context.fillStyle=e.fill,s=0;s<i.length;s++)u=e.strokeThickness/2,f=e.strokeThickness/2+s*h+o.ascent,"right"===e.align?u+=n-r[s]:"center"===e.align&&(u+=(n-r[s])/2),e.stroke&&e.strokeThickness&&this.context.strokeText(i[s],u,f+this._style.padding),e.fill&&this.context.fillText(i[s],u,f+this._style.padding);this.updateTexture()},r.prototype.updateTexture=function(){var e=this._texture;e.baseTexture.hasLoaded=!0,e.baseTexture.resolution=this.resolution,e.baseTexture.width=this.canvas.width/this.resolution,e.baseTexture.height=this.canvas.height/this.resolution,e.crop.width=e._frame.width=this.canvas.width/this.resolution,e.crop.height=e._frame.height=this.canvas.height/this.resolution,e.trim.x=0,e.trim.y=-this._style.padding,e.trim.width=e._frame.width,e.trim.height=e._frame.height-2*this._style.padding,this._width=this.canvas.width/this.resolution,this._height=this.canvas.height/this.resolution,e.baseTexture.emit("update",e.baseTexture),this.dirty=!1},r.prototype.renderWebGL=function(e){this.dirty&&this.updateText(),n.prototype.renderWebGL.call(this,e)},r.prototype._renderCanvas=function(e){this.dirty&&this.updateText(),n.prototype._renderCanvas.call(this,e)},r.prototype.determineFontProperties=function(e){var t=r.fontPropertiesCache[e];if(!t){t={};var i=r.fontPropertiesCanvas,n=r.fontPropertiesContext;n.font=e;var o=Math.ceil(n.measureText("|MÉq").width),s=Math.ceil(n.measureText("M").width),a=2*s;s=1.4*s|0,i.width=o,i.height=a,n.fillStyle="#f00",n.fillRect(0,0,o,a),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText("|MÉq",0,s);var l,h,c=n.getImageData(0,0,o,a).data,u=c.length,f=4*o,d=0,p=!1;for(l=0;l<s;l++){for(h=0;h<f;h+=4)if(255!==c[d+h]){p=!0;break}if(p)break;d+=f}for(t.ascent=s-l,d=u-f,p=!1,l=a;l>s;l--){for(h=0;h<f;h+=4)if(255!==c[d+h]){p=!0;break}if(p)break;d-=f}t.descent=l-s,t.fontSize=t.ascent+t.descent,r.fontPropertiesCache[e]=t}return t},r.prototype.wordWrap=function(e,t){for(var i="",r=e.split("\n"),n=this._style.wordWrapWidth,o=0;o<r.length;o++){for(var s=n,a=r[o].split(""),l=0;l<a.length;l++){var h=this.context.measureText(a[l]).width,c=h+this.context.measureText(t).width;0===l||c>s?(l>0&&(i+="\n"),i+=a[l],s=n-h):(s-=c,i+=t+a[l])}o<r.length-1&&(i+="\n")}return i},r.prototype.getBounds=function(e){return this.dirty&&this.updateText(),n.prototype.getBounds.call(this,e)},r.prototype.destroy=function(e){this.context=null,this.canvas=null,this._style=null,this._texture.destroy(void 0===e||e)}},{"../const":20,"../math":30,"../sprites/Sprite":64,"../textures/Texture":69,"../utils":74}],67:[function(e,t,i){function r(e,t,i){s.call(this),this.uid=n.uid(),this.resolution=i||1,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=t||o.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,this._glTextures={},e&&this.loadSource(e)}var n=e("../utils"),o=e("../const"),s=e("eventemitter3");r.prototype=Object.create(s.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=n.isPowerOfTwo(this.realWidth,this.realHeight),this.emit("update",this)},r.prototype.loadSource=function(e){var t=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,t&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=e,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!e.getContext){this.isLoading=!0;var i=this;e.onload=function(){e.onload=null,e.onerror=null,i.isLoading&&(i.isLoading=!1,i._sourceLoaded(),i.emit("loaded",i))},e.onerror=function(){e.onload=null,e.onerror=null,i.isLoading&&(i.isLoading=!1,i.emit("error",i))},e.complete&&e.src&&(this.isLoading=!1,e.onload=null,e.onerror=null,e.width&&e.height?(this._sourceLoaded(),t&&this.emit("loaded",this)):t&&this.emit("error",this))}},r.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},r.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},r.prototype.dispose=function(){this.emit("dispose",this)},r.prototype.updateSourceImage=function(e){this.source.src=e,this.loadSource(this.source)},r.fromImage=function(e,t,i){var o=n.BaseTextureCache[e];if(void 0===t&&0!==e.indexOf("data:")&&(t=!0),!o){var s=new Image;t&&(s.crossOrigin=""),o=new r(s,i),o.imageUrl=e,s.src=e,n.BaseTextureCache[e]=o,o.resolution=n.getResolutionOfUrl(e)}return o},r.fromCanvas=function(e,t){e._pixiId||(e._pixiId="canvas_"+n.uid());var i=n.BaseTextureCache[e._pixiId];return i||(i=new r(e,t),n.BaseTextureCache[e._pixiId]=i),i}},{"../const":20,"../utils":74,eventemitter3:3}],68:[function(e,t,i){function r(e,t,i,r,u){if(!e)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");t=t||100,i=i||100,u=u||c.RESOLUTION;var f=new n;if(f.width=t,f.height=i,f.resolution=u,f.scaleMode=r||c.SCALE_MODES.DEFAULT,f.hasLoaded=!0,o.call(this,f,new h.Rectangle(0,0,t,i)),this.width=t,this.height=i,this.resolution=u,this.render=null,this.renderer=e,this.renderer.type===c.RENDERER_TYPE.WEBGL){var d=this.renderer.gl;this.textureBuffer=new s(d,this.width,this.height,f.scaleMode,this.resolution),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.filterManager=new a(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(t,i),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new l(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var n=e("./BaseTexture"),o=e("./Texture"),s=e("../renderers/webgl/utils/RenderTarget"),a=e("../renderers/webgl/managers/FilterManager"),l=e("../renderers/canvas/utils/CanvasBuffer"),h=e("../math"),c=e("../const"),u=new h.Matrix;r.prototype=Object.create(o.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.resize=function(e,t,i){e===this.width&&t===this.height||(this.valid=e>0&&t>0,this.width=this._frame.width=this.crop.width=e,this.height=this._frame.height=this.crop.height=t,i&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)))},r.prototype.clear=function(){this.valid&&(this.renderer.type===c.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},r.prototype.renderWebGL=function(e,t,i,r){if(this.valid){if(r=void 0===r||r,//!updateTransform;
this.textureBuffer.transform=t,this.textureBuffer.activate(),e.worldAlpha=1,r){e.worldTransform.identity(),e.currentBounds=null;var n,o,s=e.children;for(n=0,o=s.length;n<o;++n)s[n].updateTransform()}var a=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(e,this.textureBuffer,i),this.renderer.filterManager=a}},r.prototype.renderCanvas=function(e,t,i,r){if(this.valid){r=!!r;var n=u;n.identity(),t&&n.append(t);var o=e.worldTransform;e.worldTransform=n,e.worldAlpha=1;var s,a,l=e.children;for(s=0,a=l.length;s<a;++s)l[s].updateTransform();i&&this.textureBuffer.clear();var h=this.textureBuffer.context,c=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,h),this.renderer.resolution=c,e.worldTransform===n&&(e.worldTransform=o)}},r.prototype.destroy=function(){o.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},r.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},r.prototype.getBase64=function(){return this.getCanvas().toDataURL()},r.prototype.getCanvas=function(){if(this.renderer.type===c.RENDERER_TYPE.WEBGL){var e=this.renderer.gl,t=this.textureBuffer.size.width,i=this.textureBuffer.size.height,r=new Uint8Array(4*t*i);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,t,i,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var n=new l(t,i),o=n.context.getImageData(0,0,t,i);return o.data.set(r),n.context.putImageData(o,0,0),n.canvas}return this.textureBuffer.canvas},r.prototype.getPixels=function(){var e,t;if(this.renderer.type===c.RENDERER_TYPE.WEBGL){var i=this.renderer.gl;e=this.textureBuffer.size.width,t=this.textureBuffer.size.height;var r=new Uint8Array(4*e*t);return i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),i.readPixels(0,0,e,t,i.RGBA,i.UNSIGNED_BYTE,r),i.bindFramebuffer(i.FRAMEBUFFER,null),r}return e=this.textureBuffer.canvas.width,t=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,e,t).data},r.prototype.getPixel=function(e,t){if(this.renderer.type===c.RENDERER_TYPE.WEBGL){var i=this.renderer.gl,r=new Uint8Array(4);return i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer),i.readPixels(e,t,1,1,i.RGBA,i.UNSIGNED_BYTE,r),i.bindFramebuffer(i.FRAMEBUFFER,null),r}return this.textureBuffer.canvas.getContext("2d").getImageData(e,t,1,1).data}},{"../const":20,"../math":30,"../renderers/canvas/utils/CanvasBuffer":42,"../renderers/webgl/managers/FilterManager":51,"../renderers/webgl/utils/RenderTarget":62,"./BaseTexture":67,"./Texture":69}],69:[function(e,t,i){function r(e,t,i,n,o){a.call(this),this.noFrame=!1,t||(this.noFrame=!0,t=new l.Rectangle(0,0,1,1)),e instanceof r&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=n,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=i||t,this.rotate=!!o,e.hasLoaded?(this.noFrame&&(t=new l.Rectangle(0,0,e.width,e.height),e.on("update",this.onBaseTextureUpdated,this)),this.frame=t):e.once("loaded",this.onBaseTextureLoaded,this)}var n=e("./BaseTexture"),o=e("./VideoBaseTexture"),s=e("./TextureUvs"),a=e("eventemitter3"),l=e("../math"),h=e("../utils");r.prototype=Object.create(a.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{frame:{get:function(){return this._frame},set:function(e){if(this._frame=e,this.noFrame=!1,this.width=e.width,this.height=e.height,!this.trim&&!this.rotate&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=e&&e.width&&e.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=e,this.valid&&this._updateUvs()}}}),r.prototype.update=function(){this.baseTexture.update()},r.prototype.onBaseTextureLoaded=function(e){this.noFrame?this.frame=new l.Rectangle(0,0,e.width,e.height):this.frame=this._frame,this.emit("update",this)},r.prototype.onBaseTextureUpdated=function(e){this._frame.width=e.width,this._frame.height=e.height,this.emit("update",this)},r.prototype.destroy=function(e){this.baseTexture&&(e&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},r.prototype.clone=function(){return new r(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},r.prototype._updateUvs=function(){this._uvs||(this._uvs=new s),this._uvs.set(this.crop,this.baseTexture,this.rotate)},r.fromImage=function(e,t,i){var o=h.TextureCache[e];return o||(o=new r(n.fromImage(e,t,i)),h.TextureCache[e]=o),o},r.fromFrame=function(e){var t=h.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return t},r.fromCanvas=function(e,t){return new r(n.fromCanvas(e,t))},r.fromVideo=function(e,t){return"string"==typeof e?r.fromVideoUrl(e,t):new r(o.fromVideo(e,t))},r.fromVideoUrl=function(e,t){return new r(o.fromUrl(e,t))},r.addTextureToCache=function(e,t){h.TextureCache[t]=e},r.removeTextureFromCache=function(e){var t=h.TextureCache[e];return delete h.TextureCache[e],delete h.BaseTextureCache[e],t},r.EMPTY=new r(new n)},{"../math":30,"../utils":74,"./BaseTexture":67,"./TextureUvs":70,"./VideoBaseTexture":71,eventemitter3:3}],70:[function(e,t,i){function r(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}t.exports=r,r.prototype.set=function(e,t,i){var r=t.width,n=t.height;i?(this.x0=(e.x+e.height)/r,this.y0=e.y/n,this.x1=(e.x+e.height)/r,this.y1=(e.y+e.width)/n,this.x2=e.x/r,this.y2=(e.y+e.width)/n,this.x3=e.x/r,this.y3=e.y/n):(this.x0=e.x/r,this.y0=e.y/n,this.x1=(e.x+e.width)/r,this.y1=e.y/n,this.x2=(e.x+e.width)/r,this.y2=(e.y+e.height)/n,this.x3=e.x/r,this.y3=(e.y+e.height)/n)}},{}],71:[function(e,t,i){function r(e,t){if(!e)throw new Error("No video source element specified.");(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),o.call(this,e,t),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),e.complete||(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function n(e,t){t||(t="video/"+e.substr(e.lastIndexOf(".")+1));var i=document.createElement("source");return i.src=e,i.type=t,i}var o=e("./BaseTexture"),s=e("../utils");r.prototype=Object.create(o.prototype),r.prototype.constructor=r,t.exports=r,r.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},r.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},r.prototype._onPlayStop=function(){this.autoUpdate=!1},r.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},r.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete s.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),o.prototype.destroy.call(this)},r.fromVideo=function(e,t){e._pixiId||(e._pixiId="video_"+s.uid());var i=s.BaseTextureCache[e._pixiId];return i||(i=new r(e,t),s.BaseTextureCache[e._pixiId]=i),i},r.fromUrl=function(e,t){var i=document.createElement("video");if(Array.isArray(e))for(var o=0;o<e.length;++o)i.appendChild(n(e[o].src||e[o],e[o].mime));else i.appendChild(n(e.src||e,e.mime));return i.crossOrigin="anonymous",i.load(),i.play(),r.fromVideo(i,t)},r.fromUrls=r.fromUrl},{"../utils":74,"./BaseTexture":67}],72:[function(e,t,i){function r(){var e=this;this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._emitter.listeners(s,!0)&&(e._requestId=requestAnimationFrame(e._tick)))},this._emitter=new o,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/n.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var n=e("../const"),o=e("eventemitter3"),s="tick";Object.defineProperties(r.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(Math.max(0,e)/1e3,n.TARGET_FPMS);this._maxElapsedMS=1/t}}}),r.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(s,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},r.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},r.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},r.prototype.add=function(e,t){return this._emitter.on(s,e,t),this._startIfPossible(),this},r.prototype.addOnce=function(e,t){return this._emitter.once(s,e,t),this._startIfPossible(),this},r.prototype.remove=function(e,t){return this._emitter.off(s,e,t),this._emitter.listeners(s,!0)||this._cancelIfNeeded(),this},r.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},r.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},r.prototype.update=function(e){var t;e=e||performance.now(),t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),this.deltaTime=t*n.TARGET_FPMS*this.speed,this._emitter.emit(s,this.deltaTime),this.lastTime=e},t.exports=r},{"../const":20,eventemitter3:3}],73:[function(e,t,i){var r=e("./Ticker"),n=new r;n.autoStart=!0,t.exports={shared:n,Ticker:r}},{"./Ticker":72}],74:[function(e,t,i){var r=e("../const"),n=t.exports={_uid:0,_saidHello:!1,EventEmitter:e("eventemitter3"),pluginTarget:e("./pluginTarget"),async:e("async"),uid:function(){return++n._uid},hex2rgb:function(e,t){return t=t||[],t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t},hex2string:function(e){return e=e.toString(16),"#"+(e="000000".substr(0,6-e.length)+e)},rgb2hex:function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},canUseNewCanvasBlendModes:function(){if("undefined"==typeof document)return!1;var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",t="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",i=new Image;i.src=e+"AP804Oa6"+t;var r=new Image;r.src=e+"/wCKxvRF"+t;var n=document.createElement("canvas");n.width=6,n.height=1;var o=n.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(i,0,0),o.drawImage(r,2,0);var s=o.getImageData(2,0,1,1).data;return 255===s[0]&&0===s[1]&&0===s[2]},getNextPowerOfTwo:function(e){if(e>0&&0==(e&e-1))return e;for(var t=1;t<e;)t<<=1;return t},isPowerOfTwo:function(e,t){return e>0&&0==(e&e-1)&&t>0&&0==(t&t-1)},getResolutionOfUrl:function(e){var t=r.RETINA_PREFIX.exec(e);return t?parseFloat(t[1]):1},sayHello:function(e){},isWebGLSupported:function(){var e={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);return!(!i||!i.getContextAttributes().stencil)}catch(e){return!1}},sign:function(e){return e?e<0?-1:1:0},removeItems:function(e,t,i){var r=e.length;if(!(t>=r||0===i)){i=t+i>r?r-t:i;for(var n=t,o=r-i;n<o;++n)e[n]=e[n+i];e.length=o}},TextureCache:{},BaseTextureCache:{}}},{"../const":20,"./pluginTarget":75,async:1,eventemitter3:3}],75:[function(e,t,i){function r(e){e.__plugins={},e.registerPlugin=function(t,i){e.__plugins[t]=i},e.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var t in e.__plugins)this.plugins[t]=new e.__plugins[t](this)},e.prototype.destroyPlugins=function(){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;this.plugins=null}}t.exports={mixin:function(e){r(e)}}},{}],76:[function(e,t,i){var r=e("./core"),n=e("./mesh"),o=e("./extras"),s=e("./filters");r.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},r.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(r,{Stage:{get:function(){return console.warn("You do not need to use a PIXI Stage any more, you can simply render any container."),r.Container}},DisplayObjectContainer:{get:function(){return console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),r.Container}},Strip:{get:function(){return console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),n.Mesh}},Rope:{get:function(){return console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),n.Rope}},MovieClip:{get:function(){return console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on."),o.MovieClip}},TilingSprite:{get:function(){return console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),o.TilingSprite}},BitmapText:{get:function(){return console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),o.BitmapText}},blendModes:{get:function(){return console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),r.BLEND_MODES}},scaleModes:{get:function(){return console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),r.SCALE_MODES}},BaseTextureCache:{get:function(){return console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),r.utils.BaseTextureCache}},TextureCache:{get:function(){return console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),r.utils.TextureCache}},math:{get:function(){return console.warn("The math namespace is deprecated, please access members already accessible on PIXI."),r}}}),r.Sprite.prototype.setTexture=function(e){this.texture=e,console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},o.BitmapText.prototype.setText=function(e){this.text=e,console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")},r.Text.prototype.setText=function(e){this.text=e,console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},r.Text.prototype.setStyle=function(e){this.style=e,console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},r.Texture.prototype.setFrame=function(e){this.frame=e,console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")},Object.defineProperties(s,{AbstractFilter:{get:function(){return console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on."),r.AbstractFilter}},FXAAFilter:{get:function(){return console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on."),r.FXAAFilter}},SpriteMaskFilter:{get:function(){return console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),r.SpriteMaskFilter}}}),r.utils.uuid=function(){return console.warn("utils.uuid() is deprecated, please use utils.uid() from now on."),r.utils.uid()}},{"./core":27,"./extras":83,"./filters":100,"./mesh":125}],77:[function(e,t,i){function r(e,t){n.Container.call(this),t=t||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==t.tint?t.tint:16777215,align:t.align||"left",name:null,size:0},this.font=t.font,this._text=e,this.maxWidth=0,this.maxLineHeight=0,this.dirty=!1,this.updateText()}var n=e("../core");r.prototype=Object.create(n.Container.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{tint:{get:function(){return this._font.tint},set:function(e){this._font.tint="number"==typeof e&&e>=0?e:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(e){this._font.align=e||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(e){e&&("string"==typeof e?(e=e.split(" "),this._font.name=1===e.length?e[0]:e.slice(1).join(" "),this._font.size=e.length>=2?parseInt(e[0],10):r.fonts[this._font.name].size):(this._font.name=e.name,this._font.size="number"==typeof e.size?e.size:parseInt(e.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(e){e=e.toString()||" ",this._text!==e&&(this._text=e,this.dirty=!0)}}}),r.prototype.updateText=function(){for(var e=r.fonts[this._font.name],t=new n.Point,i=null,o=[],s=0,a=0,l=[],h=0,c=this._font.size/e.size,u=-1,f=0,d=0;d<this.text.length;d++){var p=this.text.charCodeAt(d);if(u=/(\s)/.test(this.text.charAt(d))?d:u,/(?:\r\n|\r|\n)/.test(this.text.charAt(d)))l.push(s),a=Math.max(a,s),h++,t.x=0,t.y+=e.lineHeight,i=null;else if(-1!==u&&this.maxWidth>0&&t.x*c>this.maxWidth)n.utils.removeItems(o,u,d-u),d=u,u=-1,l.push(s),a=Math.max(a,s),h++,t.x=0,t.y+=e.lineHeight,i=null;else{var m=e.chars[p];m&&(i&&m.kerning[i]&&(t.x+=m.kerning[i]),o.push({texture:m.texture,line:h,charCode:p,position:new n.Point(t.x+m.xOffset,t.y+m.yOffset)}),s=t.x+(m.texture.width+m.xOffset),t.x+=m.xAdvance,f=Math.max(f,m.yOffset+m.texture.height),i=p)}}l.push(s),a=Math.max(a,s);var g=[];for(d=0;d<=h;d++){var v=0;"right"===this._font.align?v=a-l[d]:"center"===this._font.align&&(v=(a-l[d])/2),g.push(v)}var y=o.length,_=this.tint;for(d=0;d<y;d++){var b=this._glyphs[d];b?b.texture=o[d].texture:(b=new n.Sprite(o[d].texture),this._glyphs.push(b)),b.position.x=(o[d].position.x+g[o[d].line])*c,b.position.y=o[d].position.y*c,b.scale.x=b.scale.y=c,b.tint=_,b.parent||this.addChild(b)}for(d=y;d<this._glyphs.length;++d)this.removeChild(this._glyphs[d]);this.textWidth=a*c,this.textHeight=(t.y+e.lineHeight)*c,this.maxLineHeight=f*c},r.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},r.prototype.getLocalBounds=function(){return this.validate(),n.Container.prototype.getLocalBounds.call(this)},r.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},r.fonts={}},{"../core":27}],78:[function(e,t,i){function r(e){n.Sprite.call(this,e[0]instanceof n.Texture?e[0]:e[0].texture),this._textures=null,this._durations=null,this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var n=e("../core");r.prototype=Object.create(n.Sprite.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(e){if(e[0]instanceof n.Texture)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}}},currentFrame:{get:function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}}}),r.prototype.stop=function(){this.playing&&(this.playing=!1,n.ticker.shared.remove(this.update,this))},r.prototype.play=function(){this.playing||(this.playing=!0,n.ticker.shared.add(this.update,this))},r.prototype.gotoAndStop=function(e){this.stop(),this._currentTime=e,this._texture=this._textures[this.currentFrame]},r.prototype.gotoAndPlay=function(e){this._currentTime=e,this.play()},r.prototype.update=function(e){var t=this.animationSpeed*e;if(null!==this._durations){var i=this._currentTime%1*this._durations[this.currentFrame];for(i+=t/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];var r=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*r,this._currentTime+=r;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):this._texture=this._textures[this.currentFrame]},r.prototype.destroy=function(){this.stop(),n.Sprite.prototype.destroy.call(this)},r.fromFrames=function(e){for(var t=[],i=0;i<e.length;++i)t.push(new n.Texture.fromFrame(e[i]));return new r(t)},r.fromImages=function(e){for(var t=[],i=0;i<e.length;++i)t.push(new n.Texture.fromImage(e[i]));return new r(t)}},{"../core":27}],79:[function(e,t,i){function r(e,t,i){n.Sprite.call(this,e),this.tileScale=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this._width=t||100,this._height=i||100,this._uvs=new n.TextureUvs,this._canvasPattern=null,this.shader=new n.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var n=e("../core"),o=new n.Point,s=e("../core/renderers/canvas/utils/CanvasTinter");r.prototype=Object.create(n.Sprite.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{width:{get:function(){return this._width},set:function(e){this._width=e}},height:{get:function(){return this._height},set:function(e){this._height=e}}}),r.prototype._onTextureUpdate=function(){},r.prototype._renderWebGL=function(e){var t=this._texture;if(t&&t._uvs){var i=t._uvs,r=t._frame.width,n=t._frame.height,o=t.baseTexture.width,s=t.baseTexture.height;t._uvs=this._uvs,t._frame.width=this.width,t._frame.height=this.height,this.shader.uniforms.uPixelSize.value[0]=1/o,this.shader.uniforms.uPixelSize.value[1]=1/s,this.shader.uniforms.uFrame.value[0]=i.x0,this.shader.uniforms.uFrame.value[1]=i.y0,this.shader.uniforms.uFrame.value[2]=i.x1-i.x0,this.shader.uniforms.uFrame.value[3]=i.y2-i.y0,this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(r*this.tileScale.x)/this._width,this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(n*this.tileScale.y)/this._height,this.shader.uniforms.uTransform.value[2]=o/this._width*this.tileScale.x,this.shader.uniforms.uTransform.value[3]=s/this._height*this.tileScale.y,e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this),t._uvs=i,t._frame.width=r,t._frame.height=n}},r.prototype._renderCanvas=function(e){var t=this._texture;if(t.baseTexture.hasLoaded){var i=e.context,r=this.worldTransform,o=e.resolution,a=t.baseTexture,l=this.tilePosition.x/this.tileScale.x%t._frame.width,h=this.tilePosition.y/this.tileScale.y%t._frame.height;if(!this._canvasPattern){var c=new n.CanvasBuffer(t._frame.width,t._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=s.getTintedTexture(this,this.tint)),c.context.drawImage(this.tintedTexture,0,0)):c.context.drawImage(a.source,-t._frame.x,-t._frame.y),this._canvasPattern=c.context.createPattern(c.canvas,"repeat")}i.globalAlpha=this.worldAlpha,i.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*o,r.ty*o),i.scale(this.tileScale.x,this.tileScale.y),i.translate(l+this.anchor.x*-this._width,h+this.anchor.y*-this._height);var u=e.blendModes[this.blendMode];u!==e.context.globalCompositeOperation&&(i.globalCompositeOperation=u),i.fillStyle=this._canvasPattern,i.fillRect(-l,-h,this._width/this.tileScale.x,this._height/this.tileScale.y)}},r.prototype.getBounds=function(){var e,t,i,r,n=this._width,o=this._height,s=n*(1-this.anchor.x),a=n*-this.anchor.x,l=o*(1-this.anchor.y),h=o*-this.anchor.y,c=this.worldTransform,u=c.a,f=c.b,d=c.c,p=c.d,m=c.tx,g=c.ty,v=u*a+d*h+m,y=p*h+f*a+g,_=u*s+d*h+m,b=p*h+f*s+g,x=u*s+d*l+m,T=p*l+f*s+g,E=u*a+d*l+m,S=p*l+f*a+g;e=v,e=_<e?_:e,e=x<e?x:e,e=E<e?E:e,i=y,i=b<i?b:i,i=T<i?T:i,i=S<i?S:i,t=v,t=_>t?_:t,t=x>t?x:t,t=E>t?E:t,r=y,r=b>r?b:r,r=T>r?T:r,r=S>r?S:r;var w=this._bounds;return w.x=e,w.width=t-e,w.y=i,w.height=r-i,this._currentBounds=w,w},r.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,o);var t,i=this._width,r=this._height,n=-i*this.anchor.x;return o.x>n&&o.x<n+i&&(t=-r*this.anchor.y,o.y>t&&o.y<t+r)},r.prototype.destroy=function(){n.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},r.fromFrame=function(e,t,i){var o=n.utils.TextureCache[e];if(!o)throw new Error('The frameId "'+e+'" does not exist in the texture cache '+this);return new r(o,t,i)},r.fromImage=function(e,t,i,o,s){return new r(n.Texture.fromImage(e,o,s),t,i)}},{"../core":27,"../core/renderers/canvas/utils/CanvasTinter":45}],80:[function(e,t,i){var r=e("../core"),n=r.DisplayObject,o=new r.Matrix;n.prototype._cacheAsBitmap=!1,n.prototype._originalRenderWebGL=null,n.prototype._originalRenderCanvas=null,n.prototype._originalUpdateTransform=null,n.prototype._originalHitTest=null,n.prototype._originalDestroy=null,n.prototype._cachedSprite=null,Object.defineProperties(n.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap!==e&&(this._cacheAsBitmap=e,e?(this._originalRenderWebGL=this.renderWebGL,this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}}),n.prototype._renderCachedWebGL=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cachedSprite.worldAlpha=this.worldAlpha,e.setObjectRenderer(e.plugins.sprite),e.plugins.sprite.render(this._cachedSprite))},n.prototype._initCachedDisplayObject=function(e){if(!this._cachedSprite){e.currentRenderer.flush();var t=this.getLocalBounds().clone();if(this._filters){var i=this._filters[0].padding;t.x-=i,t.y-=i,t.width+=2*i,t.height+=2*i}var n=e.currentRenderTarget,s=e.filterManager.filterStack,a=new r.RenderTexture(e,0|t.width,0|t.height),l=o;l.tx=-t.x,l.ty=-t.y,this.renderWebGL=this._originalRenderWebGL,a.render(this,l,!0,!0),e.setRenderTarget(n),e.filterManager.filterStack=s,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new r.Sprite(a),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},n.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(e))},n.prototype._initCachedDisplayObjectCanvas=function(e){if(!this._cachedSprite){var t=this.getLocalBounds(),i=e.context,n=new r.RenderTexture(e,0|t.width,0|t.height),s=o;s.tx=-t.x,s.ty=-t.y,this.renderCanvas=this._originalRenderCanvas,n.render(this,s,!0),e.context=i,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new r.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},n.prototype._getCachedBounds=function(){return this._cachedSprite._currentBounds=null,this._cachedSprite.getBounds()},n.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy(),this._cachedSprite=null},n.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this._originalDestroy()}},{"../core":27}],81:[function(e,t,i){var r=e("../core");r.DisplayObject.prototype.name=null,r.Container.prototype.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null}},{"../core":27}],82:[function(e,t,i){var r=e("../core");r.DisplayObject.prototype.getGlobalPosition=function(e){return e=e||new r.Point,this.parent?(this.displayObjectUpdateTransform(),e.x=this.worldTransform.tx,e.y=this.worldTransform.ty):(e.x=this.position.x,e.y=this.position.y),e}},{"../core":27}],83:[function(e,t,i){/**
 * @file        Main export of the PIXI extras library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
e("./cacheAsBitmap"),e("./getChildByName"),e("./getGlobalPosition"),t.exports={MovieClip:e("./MovieClip"),TilingSprite:e("./TilingSprite"),BitmapText:e("./BitmapText")}},{"./BitmapText":77,"./MovieClip":78,"./TilingSprite":79,"./cacheAsBitmap":80,"./getChildByName":81,"./getGlobalPosition":82}],84:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.uniforms.pixelSize.value=e}}})},{"../../core":27}],85:[function(e,t,i){function r(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new s,this.defaultFilter=new n.AbstractFilter}var n=e("../../core"),o=e("../blur/BlurXFilter"),s=e("../blur/BlurYFilter");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(e,t,i),this.blurXFilter.applyFilter(e,t,r),e.blendModeManager.setBlendMode(n.BLEND_MODES.SCREEN),this.blurYFilter.applyFilter(e,r,i),e.blendModeManager.setBlendMode(n.BLEND_MODES.NORMAL),e.filterManager.returnRenderTarget(r)},Object.defineProperties(r.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}})},{"../../core":27,"../blur/BlurXFilter":88,"../blur/BlurYFilter":89}],86:[function(e,t,i){function r(e,t){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:e||0},dirY:{type:"1f",value:t||0}}),this.defaultFilter=new n.AbstractFilter,this.passes=1,this.dirX=e||0,this.dirY=t||0,this.strength=4}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i,r){var n=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.width/t.size.width),1===this.passes)e.filterManager.applyFilter(n,t,i,r);else{var o=e.filterManager.getRenderTarget(!0);e.filterManager.applyFilter(n,t,o,r);for(var s=0;s<this.passes-2;s++)e.filterManager.applyFilter(n,o,o,r);e.filterManager.applyFilter(n,o,i,r),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*e,this.strength=e}},dirX:{get:function(){return this.dirX},set:function(e){this.uniforms.dirX.value=e}},dirY:{get:function(){return this.dirY},set:function(e){this.uniforms.dirY.value=e}}})},{"../../core":27}],87:[function(e,t,i){function r(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYFilter=new s}var n=e("../../core"),o=e("./BlurXFilter"),s=e("./BlurYFilter");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(e,t,r),this.blurYFilter.applyFilter(e,r,i),e.filterManager.returnRenderTarget(r)},Object.defineProperties(r.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.padding=.5*Math.abs(e),this.blurXFilter.blur=this.blurYFilter.blur=e}},passes:{get:function(){return this.blurXFilter.passes},set:function(e){this.blurXFilter.passes=this.blurYFilter.passes=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}})},{"../../core":27,"./BlurXFilter":88,"./BlurYFilter":89}],88:[function(e,t,i){function r(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i,r){var n=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.width/t.size.width),1===this.passes)e.filterManager.applyFilter(n,t,i,r);else{for(var o=e.filterManager.getRenderTarget(!0),s=t,a=o,l=0;l<this.passes-1;l++){e.filterManager.applyFilter(n,s,a,!0);var h=a;a=s,s=h}e.filterManager.applyFilter(n,s,i,r),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*Math.abs(e),this.strength=e}}})},{"../../core":27}],89:[function(e,t,i){function r(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i,r){var n=this.getShader(e);if(this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(t.frame.height/t.size.height),1===this.passes)e.filterManager.applyFilter(n,t,i,r);else{for(var o=e.filterManager.getRenderTarget(!0),s=t,a=o,l=0;l<this.passes-1;l++){e.filterManager.applyFilter(n,s,a,!0);var h=a;a=s,s=h}e.filterManager.applyFilter(n,s,i,r),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*Math.abs(e),this.strength=e}}})},{"../../core":27}],90:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r},{"../../core":27}],91:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4];\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9];\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14];\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19];\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype._loadMatrix=function(e,t){t=!!t;var i=e;t&&(this._multiply(i,this.uniforms.m.value,e),i=this._colorMatrix(i)),this.uniforms.m.value=i},r.prototype._multiply=function(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19],e},r.prototype._colorMatrix=function(e){var t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t},r.prototype.brightness=function(e,t){var i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)},r.prototype.greyscale=function(e,t){var i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)},r.prototype.grayscale=r.prototype.greyscale,r.prototype.blackAndWhite=function(e){var t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.hue=function(e,t){e=(e||0)/180*Math.PI;var i=Math.cos(e),r=Math.sin(e),n=[.213+.787*i+-.213*r,.715+-.715*i+-.715*r,.072+-.072*i+.928*r,0,0,.213+-.213*i+.143*r,.715+i*(1-.715)+.14*r,.072+-.072*i+-.283*r,0,0,.213+-.213*i+-.787*r,.715+-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,0,1,0];this._loadMatrix(n,t)},r.prototype.contrast=function(e,t){var i=(e||0)+1,r=-128*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,t)},r.prototype.saturate=function(e,t){var i=2*(e||0)/3+1,r=-.5*(i-1),n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,t)},r.prototype.desaturate=function(e){this.saturate(-1)},r.prototype.negative=function(e){var t=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.sepia=function(e){var t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.technicolor=function(e){var t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.polaroid=function(e){var t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.toBGR=function(e){var t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.kodachrome=function(e){var t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.browni=function(e){var t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.vintage=function(e){var t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.colorTone=function(e,t,i,r,n){e=e||.2,t=t||.15,i=i||16770432,r=r||3375104;var o=(i>>16&255)/255,s=(i>>8&255)/255,a=(255&i)/255,l=(r>>16&255)/255,h=(r>>8&255)/255,c=(255&r)/255,u=[.3,.59,.11,0,0,o,s,a,e,0,l,h,c,t,0,o-l,s-h,a-c,0,0];this._loadMatrix(u,n)},r.prototype.night=function(e,t){e=e||.1;var i=[-2*e,-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(i,t)},r.prototype.predator=function(e,t){var i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)},r.prototype.lsd=function(e){var t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)},r.prototype.reset=function(){var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)},Object.defineProperties(r.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(e){this.uniforms.m.value=e}}})},{"../../core":27}],92:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(e){this.uniforms.step.value=e}}})},{"../../core":27}],93:[function(e,t,i){function r(e,t,i){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(e)},texelSize:{type:"v2",value:{x:1/t,y:1/i}}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=new Float32Array(e)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(e){this.uniforms.texelSize.value.x=1/e}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(e){this.uniforms.texelSize.value.y=1/e}}})},{"../../core":27}],94:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n")}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r},{"../../core":27}],95:[function(e,t,i){function r(e,t){var i=new n.Matrix;e.renderable=!1,n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:e.texture},otherMatrix:{type:"mat3",value:i.toArray(!0)},scale:{type:"v2",value:{x:1,y:1}}}),this.maskSprite=e,this.maskMatrix=i,null!==t&&void 0!==t||(t=20),this.scale=new n.Point(t,t)}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager;r.calculateMappedMatrix(t.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/t.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/t.frame.height);var n=this.getShader(e);r.applyFilter(n,t,i)},Object.defineProperties(r.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(e){this.uniforms.mapSampler.value=e}}})},{"../../core":27}],96:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}},angle:{get:function(){return this.uniforms.angle.value},set:function(e){this.uniforms.angle.value=e}}})},{"../../core":27}],97:[function(e,t,i){function r(){n.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i,r){var n=this.getShader(e);if(this.uniforms.strength.value=this.strength/4/this.passes*(t.frame.height/t.size.height),1===this.passes)e.filterManager.applyFilter(n,t,i,r);else{for(var o=e.filterManager.getRenderTarget(!0),s=t,a=o,l=0;l<this.passes-1;l++){e.filterManager.applyFilter(n,s,a,r);var h=a;a=s,s=h}e.filterManager.applyFilter(n,s,i,r),e.filterManager.returnRenderTarget(o)}},Object.defineProperties(r.prototype,{blur:{get:function(){return this.strength},set:function(e){this.padding=.5*e,this.strength=e}}})},{"../../core":27}],98:[function(e,t,i){function r(){n.AbstractFilter.call(this),this.blurXFilter=new o,this.blurYTintFilter=new s,this.defaultFilter=new n.AbstractFilter,this.padding=30,this._dirtyPosition=!0,this._angle=45*Math.PI/180,this._distance=10,this.alpha=.75,this.hideObject=!1,this.blendMode=n.BLEND_MODES.MULTIPLY}var n=e("../../core"),o=e("../blur/BlurXFilter"),s=e("./BlurYTintFilter");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance),this.blurXFilter.applyFilter(e,t,r),e.blendModeManager.setBlendMode(this.blendMode),this.blurYTintFilter.applyFilter(e,r,i),e.blendModeManager.setBlendMode(n.BLEND_MODES.NORMAL),this.hideObject||this.defaultFilter.applyFilter(e,t,i),e.filterManager.returnRenderTarget(r)},Object.defineProperties(r.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYTintFilter.blur=e}},blurX:{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(e){this.blurYTintFilter.blur=e}},color:{get:function(){return n.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(e){this.blurYTintFilter.uniforms.color.value=n.utils.hex2rgb(e)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(e){this.blurYTintFilter.uniforms.alpha.value=e}},distance:{get:function(){return this._distance},set:function(e){this._dirtyPosition=!0,this._distance=e}},angle:{get:function(){return this._angle},set:function(e){this._dirtyPosition=!0,this._angle=e}}})},{"../../core":27,"../blur/BlurXFilter":88,"./BlurYTintFilter":97}],99:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(e){this.uniforms.gray.value=e}}})},{"../../core":27}],100:[function(e,t,i){/**
 * @file        Main export of the PIXI filters library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
t.exports={AsciiFilter:e("./ascii/AsciiFilter"),BloomFilter:e("./bloom/BloomFilter"),BlurFilter:e("./blur/BlurFilter"),BlurXFilter:e("./blur/BlurXFilter"),BlurYFilter:e("./blur/BlurYFilter"),BlurDirFilter:e("./blur/BlurDirFilter"),ColorMatrixFilter:e("./color/ColorMatrixFilter"),ColorStepFilter:e("./color/ColorStepFilter"),ConvolutionFilter:e("./convolution/ConvolutionFilter"),CrossHatchFilter:e("./crosshatch/CrossHatchFilter"),DisplacementFilter:e("./displacement/DisplacementFilter"),DotScreenFilter:e("./dot/DotScreenFilter"),GrayFilter:e("./gray/GrayFilter"),DropShadowFilter:e("./dropshadow/DropShadowFilter"),InvertFilter:e("./invert/InvertFilter"),NoiseFilter:e("./noise/NoiseFilter"),PixelateFilter:e("./pixelate/PixelateFilter"),RGBSplitFilter:e("./rgb/RGBSplitFilter"),ShockwaveFilter:e("./shockwave/ShockwaveFilter"),SepiaFilter:e("./sepia/SepiaFilter"),SmartBlurFilter:e("./blur/SmartBlurFilter"),TiltShiftFilter:e("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:e("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:e("./tiltshift/TiltShiftYFilter"),TwistFilter:e("./twist/TwistFilter")}},{"./ascii/AsciiFilter":84,"./bloom/BloomFilter":85,"./blur/BlurDirFilter":86,"./blur/BlurFilter":87,"./blur/BlurXFilter":88,"./blur/BlurYFilter":89,"./blur/SmartBlurFilter":90,"./color/ColorMatrixFilter":91,"./color/ColorStepFilter":92,"./convolution/ConvolutionFilter":93,"./crosshatch/CrossHatchFilter":94,"./displacement/DisplacementFilter":95,"./dot/DotScreenFilter":96,"./dropshadow/DropShadowFilter":98,"./gray/GrayFilter":99,"./invert/InvertFilter":101,"./noise/NoiseFilter":102,"./pixelate/PixelateFilter":103,"./rgb/RGBSplitFilter":104,"./sepia/SepiaFilter":105,"./shockwave/ShockwaveFilter":106,"./tiltshift/TiltShiftFilter":108,"./tiltshift/TiltShiftXFilter":109,"./tiltshift/TiltShiftYFilter":110,"./twist/TwistFilter":111}],101:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{invert:{type:"1f",value:1}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(e){this.uniforms.invert.value=e}}})},{"../../core":27}],102:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(e){this.uniforms.noise.value=e}}})},{"../../core":27}],103:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.uniforms.pixelSize.value=e}}})},{"../../core":27}],104:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(e){this.uniforms.red.value=e}},green:{get:function(){return this.uniforms.green.value},set:function(e){this.uniforms.green.value=e}},blue:{get:function(){return this.uniforms.blue.value},set:function(e){this.uniforms.blue.value=e}}})},{"../../core":27}],105:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(e){this.uniforms.sepia.value=e}}})},{"../../core":27}],106:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(e){this.uniforms.center.value=e}},params:{get:function(){return this.uniforms.params.value},set:function(e){this.uniforms.params.value=e}},time:{get:function(){return this.uniforms.time.value},set:function(e){this.uniforms.time.value=e}}})},{"../../core":27}],107:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}}),this.updateDelta()}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.updateDelta=function(){this.uniforms.delta.value.x=0,this.uniforms.delta.value.y=0},Object.defineProperties(r.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(e){this.uniforms.blur.value=e}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(e){this.uniforms.gradientBlur.value=e}},start:{get:function(){return this.uniforms.start.value},set:function(e){this.uniforms.start.value=e,this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(e){this.uniforms.end.value=e,this.updateDelta()}}})},{"../../core":27}],108:[function(e,t,i){function r(){n.AbstractFilter.call(this),this.tiltShiftXFilter=new o,this.tiltShiftYFilter=new s}var n=e("../../core"),o=e("./TiltShiftXFilter"),s=e("./TiltShiftYFilter");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.applyFilter=function(e,t,i){var r=e.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(e,t,r),this.tiltShiftYFilter.applyFilter(e,r,i),e.filterManager.returnRenderTarget(r)},Object.defineProperties(r.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(e){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=e}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(e){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=e}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(e){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=e}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(e){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=e}}})},{"../../core":27,"./TiltShiftXFilter":109,"./TiltShiftYFilter":110}],109:[function(e,t,i){function r(){n.call(this)}var n=e("./TiltShiftAxisFilter");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.updateDelta=function(){var e=this.uniforms.end.value.x-this.uniforms.start.value.x,t=this.uniforms.end.value.y-this.uniforms.start.value.y,i=Math.sqrt(e*e+t*t);this.uniforms.delta.value.x=e/i,this.uniforms.delta.value.y=t/i}},{"./TiltShiftAxisFilter":107}],110:[function(e,t,i){function r(){n.call(this)}var n=e("./TiltShiftAxisFilter");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.updateDelta=function(){var e=this.uniforms.end.value.x-this.uniforms.start.value.x,t=this.uniforms.end.value.y-this.uniforms.start.value.y,i=Math.sqrt(e*e+t*t);this.uniforms.delta.value.x=-t/i,this.uniforms.delta.value.y=e/i}},{"./TiltShiftAxisFilter":107}],111:[function(e,t,i){function r(){n.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var n=e("../../core");r.prototype=Object.create(n.AbstractFilter.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}},radius:{get:function(){return this.uniforms.radius.value},set:function(e){this.uniforms.radius.value=e}},angle:{get:function(){return this.uniforms.angle.value},set:function(e){this.uniforms.angle.value=e}}})},{"../../core":27}],112:[function(e,i,r){(function(t){e("./polyfill");var r=i.exports=e("./core");r.extras=e("./extras"),r.filters=e("./filters"),r.interaction=e("./interaction"),r.loaders=e("./loaders"),r.mesh=e("./mesh"),r.accessibility=e("./accessibility"),r.loader=new r.loaders.Loader,Object.assign(r,e("./deprecation")),t.PIXI=r}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":19,"./core":27,"./deprecation":76,"./extras":83,"./filters":100,"./interaction":115,"./loaders":118,"./mesh":125,"./polyfill":130}],113:[function(e,t,i){function r(){this.global=new n.Point,this.target=null,this.originalEvent=null}var n=e("../core");r.prototype.constructor=r,t.exports=r,r.prototype.getLocalPosition=function(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}},{"../core":27}],114:[function(e,t,i){function r(e,t){t=t||{},this.renderer=e,this.autoPreventDefault=void 0===t.autoPreventDefault||t.autoPreventDefault,this.interactionFrequency=t.interactionFrequency||10,this.mouse=new o,Object.defineProperty(this.mouse,"isPropagationStopped",{get:function(){return this.originalEvent._isPropagationStopped||!1},set:function(e){this.originalEvent._isPropagationStopped=e}}),this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this._tempPoint=new n.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var n=e("../core"),o=e("./InteractionData");Object.assign(n.DisplayObject.prototype,e("./interactiveTarget")),r.prototype.constructor=r,t.exports=r,r.prototype.setTargetElement=function(e,t){this.removeEvents(),this.interactionDOMElement=e,this.resolution=t||1,this.addEvents()},r.prototype.addEvents=function(){this.interactionDOMElement&&(n.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},r.prototype.removeEvents=function(){this.interactionDOMElement&&(n.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},r.prototype.update=function(e){if(this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement)){if(this.didMove)return void(this.didMove=!1);this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)}},r.prototype.dispatchEvent=function(e,t,i){i.stopped||(i.target=e,i.type=t,e.emit(t,i),e[t]&&e[t](i))},r.prototype.mapPositionToPoint=function(e,t,i){if(this.interactionDOMElement==window.document)e.x=t,e.y=i;else{var r=this.interactionDOMElement.getBoundingClientRect();e.x=(t-r.left)*(this.interactionDOMElement.width/r.width)/this.resolution,e.y=(i-r.top)*(this.interactionDOMElement.height/r.height)/this.resolution}},r.prototype.processInteractive=function(e,t,i,r,n){if(!t||!t.visible)return!1;var o=!1,s=n=t.interactive||n;if(t.hitArea&&(s=!1),t.interactiveChildren)for(var a=t.children,l=a.length-1;l>=0;l--)if(this.processInteractive(e,a[l],i,r,s)){if(o=!0,s=!1,!a[l]||!a[l].interactive)break;r=!1}return n&&(r&&!o&&(t.hitArea?(t.worldTransform.applyInverse(e,this._tempPoint),o=t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):t.containsPoint&&(o=t.containsPoint(e))),t.interactive&&i(t,o)),o},r.prototype.onMouseDown=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)},r.prototype.processMouseDown=function(e,t){var i=this.mouse.originalEvent,r=2===i.button||3===i.which;t&&(e[r?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(e,r?"rightdown":"mousedown",this.eventData))},r.prototype.onMouseUp=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)},r.prototype.processMouseUp=function(e,t){var i=this.mouse.originalEvent,r=2===i.button||3===i.which,n=r?"_isRightDown":"_isLeftDown";t?(this.dispatchEvent(e,r?"rightup":"mouseup",this.eventData),e[n]&&(e[n]=!1,this.dispatchEvent(e,r?"rightclick":"click",this.eventData))):e[n]&&(e[n]=!1,this.dispatchEvent(e,r?"rightupoutside":"mouseupoutside",this.eventData))},r.prototype.onMouseMove=function(e){this.mouse.originalEvent=e,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.didMove=!0,this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},r.prototype.processMouseMove=function(e,t){this.eventData.hit=t,this.dispatchEvent(e,"mousemove",this.eventData),this.processMouseOverOut(e,t)},r.prototype.onMouseOut=function(e){this.mouse.originalEvent=e,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.interactionDOMElement.style.cursor="inherit",this.mapPositionToPoint(this.mouse.global,e.clientX,e.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)},r.prototype.processMouseOverOut=function(e,t){t?(e._over||(e._over=!0,this.dispatchEvent(e,"mouseover",this.eventData)),e.buttonMode&&(this.cursor=e.defaultCursor)):e._over&&(e._over=!1,this.dispatchEvent(e,"mouseout",this.eventData))},r.prototype.onTouchStart=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,i=t.length,r=0;r<i;r++){var n=t[r],o=this.getTouchData(n);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.returnTouchData(o)}},r.prototype.processTouchStart=function(e,t){t&&(e._touchDown=!0,this.dispatchEvent(e,"touchstart",this.eventData))},r.prototype.onTouchEnd=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,i=t.length,r=0;r<i;r++){var n=t[r],o=this.getTouchData(n);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.returnTouchData(o)}},r.prototype.processTouchEnd=function(e,t){t?(this.dispatchEvent(e,"touchend",this.eventData),e._touchDown&&(e._touchDown=!1,this.dispatchEvent(e,"tap",this.eventData))):e._touchDown&&(e._touchDown=!1,this.dispatchEvent(e,"touchendoutside",this.eventData))},r.prototype.onTouchMove=function(e){this.autoPreventDefault&&e.preventDefault();for(var t=e.changedTouches,i=t.length,r=0;r<i;r++){var n=t[r],o=this.getTouchData(n);o.originalEvent=e,this.eventData.data=o,this.eventData.stopped=!1,this.processInteractive(o.global,this.renderer._lastObjectRendered,this.processTouchMove,!0),this.returnTouchData(o)}},r.prototype.processTouchMove=function(e,t){this.eventData.hit=t,this.dispatchEvent(e,"touchmove",this.eventData)},r.prototype.getTouchData=function(e){var t=this.interactiveDataPool.pop();return t||(t=new o),t.isPropagationStopped=!1,t.identifier=e.identifier,this.mapPositionToPoint(t.global,e.clientX,e.clientY),navigator.isCocoonJS&&(t.global.x=t.global.x/this.resolution,t.global.y=t.global.y/this.resolution),e.globalX=t.global.x,e.globalY=t.global.y,t},r.prototype.returnTouchData=function(e){this.interactiveDataPool.push(e)},r.prototype.destroy=function(){this.removeEvents(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},n.WebGLRenderer.registerPlugin("interaction",r),n.CanvasRenderer.registerPlugin("interaction",r)},{"../core":27,"./InteractionData":113,"./interactiveTarget":116}],115:[function(e,t,i){/**
 * @file        Main export of the PIXI interactions library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
t.exports={InteractionData:e("./InteractionData"),InteractionManager:e("./InteractionManager"),interactiveTarget:e("./interactiveTarget")}},{"./InteractionData":113,"./InteractionManager":114,"./interactiveTarget":116}],116:[function(e,t,i){var r={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1};t.exports=r},{}],117:[function(e,t,i){function r(e,t){var i={},r=e.data.getElementsByTagName("info")[0],n=e.data.getElementsByTagName("common")[0];i.font=r.getAttribute("face"),i.size=parseInt(r.getAttribute("size"),10),i.lineHeight=parseInt(n.getAttribute("lineHeight"),10),i.chars={};for(var a=e.data.getElementsByTagName("char"),l=0;l<a.length;l++){var h=parseInt(a[l].getAttribute("id"),10),c=new o.Rectangle(parseInt(a[l].getAttribute("x"),10)+t.frame.x,parseInt(a[l].getAttribute("y"),10)+t.frame.y,parseInt(a[l].getAttribute("width"),10),parseInt(a[l].getAttribute("height"),10));i.chars[h]={xOffset:parseInt(a[l].getAttribute("xoffset"),10),yOffset:parseInt(a[l].getAttribute("yoffset"),10),xAdvance:parseInt(a[l].getAttribute("xadvance"),10),kerning:{},texture:new o.Texture(t.baseTexture,c)}}var u=e.data.getElementsByTagName("kerning");for(l=0;l<u.length;l++){var f=parseInt(u[l].getAttribute("first"),10),d=parseInt(u[l].getAttribute("second"),10),p=parseInt(u[l].getAttribute("amount"),10);i.chars[d].kerning[f]=p}e.bitmapFont=i,s.BitmapText.fonts[i.font]=i}var n=e("resource-loader").Resource,o=e("../core"),s=e("../extras"),a=e("path");t.exports=function(){return function(e,t){if(!e.data||!e.isXml)return t();if(0===e.data.getElementsByTagName("page").length||0===e.data.getElementsByTagName("info").length||null===e.data.getElementsByTagName("info")[0].getAttribute("face"))return t();var i=a.dirname(e.url);"."===i&&(i=""),this.baseUrl&&i&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(i+="/"),i=i.replace(this.baseUrl,"")),i&&"/"!==i.charAt(i.length-1)&&(i+="/");var s=i+e.data.getElementsByTagName("page")[0].getAttribute("file");if(o.utils.TextureCache[s])r(e,o.utils.TextureCache[s]),t();else{var l={crossOrigin:e.crossOrigin,loadType:n.LOAD_TYPE.IMAGE,metadata:e.metadata.imageMetadata};this.add(e.name+"_image",s,l,function(i){r(e,i.texture),t()})}}}},{"../core":27,"../extras":83,path:6,"resource-loader":13}],118:[function(e,t,i){/**
 * @file        Main export of the PIXI loaders library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
t.exports={Loader:e("./loader"),bitmapFontParser:e("./bitmapFontParser"),spritesheetParser:e("./spritesheetParser"),textureParser:e("./textureParser"),Resource:e("resource-loader").Resource}},{"./bitmapFontParser":117,"./loader":119,"./spritesheetParser":120,"./textureParser":121,"resource-loader":13}],119:[function(e,t,i){function r(e,t){n.call(this,e,t);for(var i=0;i<r._pixiMiddleware.length;++i)this.use(r._pixiMiddleware[i]())}var n=e("resource-loader"),o=e("./textureParser"),s=e("./spritesheetParser"),a=e("./bitmapFontParser");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r._pixiMiddleware=[n.middleware.parsing.blob,o,s,a],r.addPixiMiddleware=function(e){r._pixiMiddleware.push(e)};var l=n.Resource;l.setExtensionXhrType("fnt",l.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":117,"./spritesheetParser":120,"./textureParser":121,"resource-loader":13}],120:[function(e,t,i){var r=e("resource-loader").Resource,n=e("path"),o=e("../core");t.exports=function(){return function(e,t){if(!e.data||!e.isJson||!e.data.frames)return t();var i={crossOrigin:e.crossOrigin,loadType:r.LOAD_TYPE.IMAGE,metadata:e.metadata.imageMetadata},s=n.dirname(e.url.replace(this.baseUrl,"")),a=o.utils.getResolutionOfUrl(e.url);this.add(e.name+"_image",s+"/"+e.data.meta.image,i,function(i){e.textures={};var r=e.data.frames;for(var n in r){var s=r[n].frame;if(s){var l=null,h=null;if(l=r[n].rotated?new o.Rectangle(s.x,s.y,s.h,s.w):new o.Rectangle(s.x,s.y,s.w,s.h),r[n].trimmed&&(h=new o.Rectangle(r[n].spriteSourceSize.x/a,r[n].spriteSourceSize.y/a,r[n].sourceSize.w/a,r[n].sourceSize.h/a)),r[n].rotated){var c=l.width;l.width=l.height,l.height=c}l.x/=a,l.y/=a,l.width/=a,l.height/=a,e.textures[n]=new o.Texture(i.texture.baseTexture,l,l.clone(),h,r[n].rotated),o.utils.TextureCache[n]=e.textures[n]}}t()})}}},{"../core":27,path:6,"resource-loader":13}],121:[function(e,t,i){var r=e("../core");t.exports=function(){return function(e,t){if(e.data&&e.isImage){var i=new r.BaseTexture(e.data,null,r.utils.getResolutionOfUrl(e.url));i.imageUrl=e.url,e.texture=new r.Texture(i),r.utils.BaseTextureCache[e.url]=i,r.utils.TextureCache[e.url]=e.texture}t()}}},{"../core":27}],122:[function(e,t,i){function r(e,t,i,o,s){n.Container.call(this),this._texture=null,this.uvs=i||new Float32Array([0,0,1,0,1,1,0,1]),this.vertices=t||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=o||new Uint16Array([0,1,3,2]),this.dirty=!0,this.blendMode=n.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=s||r.DRAW_MODES.TRIANGLE_MESH,this.texture=e,this.shader=null}var n=e("../core"),o=new n.Point,s=new n.Polygon;r.prototype=Object.create(n.Container.prototype),r.prototype.constructor=r,t.exports=r,Object.defineProperties(r.prototype,{texture:{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}}),r.prototype._renderWebGL=function(e){e.setObjectRenderer(e.plugins.mesh),e.plugins.mesh.render(this)},r.prototype._renderCanvas=function(e){var t=e.context,i=this.worldTransform;e.roundPixels?t.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.drawMode===r.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(t):this._renderCanvasTriangles(t)},r.prototype._renderCanvasTriangleMesh=function(e){for(var t=this.vertices,i=this.uvs,r=t.length/2,n=0;n<r-2;n++){var o=2*n;this._renderCanvasDrawTriangle(e,t,i,o,o+2,o+4)}},r.prototype._renderCanvasTriangles=function(e){for(var t=this.vertices,i=this.uvs,r=this.indices,n=r.length,o=0;o<n;o+=3){var s=2*r[o],a=2*r[o+1],l=2*r[o+2];this._renderCanvasDrawTriangle(e,t,i,s,a,l)}},r.prototype._renderCanvasDrawTriangle=function(e,t,i,r,n,o){var s=this._texture.baseTexture.source,a=this._texture.baseTexture.width,l=this._texture.baseTexture.height,h=t[r],c=t[n],u=t[o],f=t[r+1],d=t[n+1],p=t[o+1],m=i[r]*a,g=i[n]*a,v=i[o]*a,y=i[r+1]*l,_=i[n+1]*l,b=i[o+1]*l;if(this.canvasPadding>0){var x=this.canvasPadding/this.worldTransform.a,T=this.canvasPadding/this.worldTransform.d,E=(h+c+u)/3,S=(f+d+p)/3,w=h-E,M=f-S,A=Math.sqrt(w*w+M*M);h=E+w/A*(A+x),f=S+M/A*(A+T),w=c-E,M=d-S,A=Math.sqrt(w*w+M*M),c=E+w/A*(A+x),d=S+M/A*(A+T),w=u-E,M=p-S,A=Math.sqrt(w*w+M*M),u=E+w/A*(A+x),p=S+M/A*(A+T)}e.save(),e.beginPath(),e.moveTo(h,f),e.lineTo(c,d),e.lineTo(u,p),e.closePath(),e.clip();var P=m*_+y*v+g*b-_*v-y*g-m*b,C=h*_+y*u+c*b-_*u-y*c-h*b,R=m*c+h*v+g*u-c*v-h*g-m*u,D=m*_*u+y*c*v+h*g*b-h*_*v-y*g*u-m*c*b,I=f*_+y*p+d*b-_*p-y*d-f*b,O=m*d+f*v+g*p-d*v-f*g-m*p,F=m*_*p+y*d*v+f*g*b-f*_*v-y*g*p-m*d*b;e.transform(C/P,I/P,R/P,O/P,D/P,F/P),e.drawImage(s,0,0),e.restore()},r.prototype.renderMeshFlat=function(e){var t=this.context,i=e.vertices,r=i.length/2;t.beginPath();for(var n=1;n<r-2;n++){var o=2*n,s=i[o],a=i[o+2],l=i[o+4],h=i[o+1],c=i[o+3],u=i[o+5];t.moveTo(s,h),t.lineTo(a,c),t.lineTo(l,u)}t.fillStyle="#FF0000",t.fill(),t.closePath()},r.prototype._onTextureUpdate=function(){this.updateFrame=!0},r.prototype.getBounds=function(e){if(!this._currentBounds){for(var t=e||this.worldTransform,i=t.a,r=t.b,o=t.c,s=t.d,a=t.tx,l=t.ty,h=-1/0,c=-1/0,u=1/0,f=1/0,d=this.vertices,p=0,m=d.length;p<m;p+=2){var g=d[p],v=d[p+1],y=i*g+o*v+a,_=s*v+r*g+l;u=y<u?y:u,f=_<f?_:f,h=y>h?y:h,c=_>c?_:c}if(u===-1/0||c===1/0)return n.Rectangle.EMPTY;var b=this._bounds;b.x=u,b.width=h-u,b.y=f,b.height=c-f,this._currentBounds=b}return this._currentBounds},r.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,o);var t,i,n=this.vertices,a=s.points;if(this.drawMode===r.DRAW_MODES.TRIANGLES){var l=this.indices;for(i=this.indices.length,t=0;t<i;t+=3){var h=2*l[t],c=2*l[t+1],u=2*l[t+2];if(a[0]=n[h],a[1]=n[h+1],a[2]=n[c],a[3]=n[c+1],a[4]=n[u],a[5]=n[u+1],s.contains(o.x,o.y))return!0}}else for(i=n.length,t=0;t<i;t+=6)if(a[0]=n[t],a[1]=n[t+1],a[2]=n[t+2],a[3]=n[t+3],a[4]=n[t+4],a[5]=n[t+5],s.contains(o.x,o.y))return!0;return!1},r.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":27}],123:[function(e,t,i){function r(e,t,i){n.call(this,e),this._ready=!0,this.segmentsX=t||10,this.segmentsY=i||10,this.drawMode=n.DRAW_MODES.TRIANGLES,this.refresh()}var n=e("./Mesh");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.refresh=function(){var e=this.segmentsX*this.segmentsY,t=[],i=[],r=[],n=[],o=this.texture,s=this.segmentsX-1,a=this.segmentsY-1,l=0,h=o.width/s,c=o.height/a;for(l=0;l<e;l++){var u=l%this.segmentsX,f=l/this.segmentsX|0;t.push(u*h,f*c),r.push(u/(this.segmentsX-1),f/(this.segmentsY-1))}var d=s*a;for(l=0;l<d;l++){var p=l%s,m=l/s|0,g=m*this.segmentsX+p,v=m*this.segmentsX+p+1,y=(m+1)*this.segmentsX+p,_=(m+1)*this.segmentsX+p+1;n.push(g,v,y),n.push(v,_,y)}this.vertices=new Float32Array(t),this.uvs=new Float32Array(r),this.colors=new Float32Array(i),this.indices=new Uint16Array(n)},r.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}},{"./Mesh":122}],124:[function(e,t,i){function r(e,t){n.call(this,e),this.points=t,this.vertices=new Float32Array(4*t.length),this.uvs=new Float32Array(4*t.length),this.colors=new Float32Array(2*t.length),this.indices=new Uint16Array(2*t.length),this._ready=!0,this.refresh()}var n=e("./Mesh"),o=e("../core");r.prototype=Object.create(n.prototype),r.prototype.constructor=r,t.exports=r,r.prototype.refresh=function(){var e=this.points;if(!(e.length<1)&&this._texture._uvs){var t=this.uvs,i=this.indices,r=this.colors,n=this._texture._uvs,s=new o.Point(n.x0,n.y0),a=new o.Point(n.x2-n.x0,n.y2-n.y0);t[0]=0+s.x,t[1]=0+s.y,t[2]=0+s.x,t[3]=1*a.y+s.y,r[0]=1,r[1]=1,i[0]=0,i[1]=1;for(var l,h,c=e.length,u=1;u<c;u++)e[u],l=4*u,h=u/(c-1),t[l]=h*a.x+s.x,t[l+1]=0+s.y,t[l+2]=h*a.x+s.x,t[l+3]=1*a.y+s.y,l=2*u,r[l]=1,r[l+1]=1,l=2*u,i[l]=l,i[l+1]=l+1;this.dirty=!0}},r.prototype._onTextureUpdate=function(){n.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},r.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){for(var t,i,r,n,o,s,a=e[0],l=0,h=0,c=this.vertices,u=e.length,f=0;f<u;f++)i=e[f],r=4*f,t=f<e.length-1?e[f+1]:i,h=-(t.x-a.x),l=t.y-a.y,n=10*(1-f/(u-1)),n>1&&(n=1),o=Math.sqrt(l*l+h*h),s=this._texture.height/2,l/=o,h/=o,l*=s,h*=s,c[r]=i.x+l,c[r+1]=i.y+h,c[r+2]=i.x-l,c[r+3]=i.y-h,a=i;this.containerUpdateTransform()}}},{"../core":27,"./Mesh":122}],125:[function(e,t,i){/**
 * @file        Main export of the PIXI extras library
 * @author      Mat Groves <mat@goodboydigital.com>
 * @copyright   2013-2015 GoodBoyDigital
 * @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
 */
t.exports={Mesh:e("./Mesh"),Plane:e("./Plane"),Rope:e("./Rope"),MeshRenderer:e("./webgl/MeshRenderer"),MeshShader:e("./webgl/MeshShader")}},{"./Mesh":122,"./Plane":123,"./Rope":124,"./webgl/MeshRenderer":126,"./webgl/MeshShader":127}],126:[function(e,t,i){function r(e){n.ObjectRenderer.call(this,e),this.indices=new Uint16Array(15e3);for(var t=0,i=0;t<15e3;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.currentShader=null}var n=e("../../core"),o=e("../Mesh");r.prototype=Object.create(n.ObjectRenderer.prototype),r.prototype.constructor=r,t.exports=r,n.WebGLRenderer.registerPlugin("mesh",r),r.prototype.onContextChange=function(){},r.prototype.render=function(e){e._vertexBuffer||this._initWebGL(e);var t=this.renderer,i=t.gl,r=e._texture.baseTexture,n=e.shader,s=e.drawMode===o.DRAW_MODES.TRIANGLE_MESH?i.TRIANGLE_STRIP:i.TRIANGLES;t.blendModeManager.setBlendMode(e.blendMode),n=n?n.shaders[i.id]||n.getShader(t):t.shaderManager.plugins.meshShader,this.renderer.shaderManager.setShader(n),n.uniforms.translationMatrix.value=e.worldTransform.toArray(!0),n.uniforms.projectionMatrix.value=t.currentRenderTarget.projectionMatrix.toArray(!0),n.uniforms.alpha.value=e.worldAlpha,n.syncUniforms(),e.dirty?(e.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,e._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,e.vertices,i.STATIC_DRAW),i.vertexAttribPointer(n.attributes.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,e._uvBuffer),i.bufferData(i.ARRAY_BUFFER,e.uvs,i.STATIC_DRAW),i.vertexAttribPointer(n.attributes.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),r._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,r._glTextures[i.id]):this.renderer.updateTexture(r),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,e._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,e.vertices),i.vertexAttribPointer(n.attributes.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,e._uvBuffer),i.vertexAttribPointer(n.attributes.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),r._glTextures[i.id]?i.bindTexture(i.TEXTURE_2D,r._glTextures[i.id]):this.renderer.updateTexture(r),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e._indexBuffer),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.indices)),i.drawElements(s,e.indices.length,i.UNSIGNED_SHORT,0)},r.prototype._initWebGL=function(e){var t=this.renderer.gl;e._vertexBuffer=t.createBuffer(),e._indexBuffer=t.createBuffer(),e._uvBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,e._uvBuffer),t.bufferData(t.ARRAY_BUFFER,e.uvs,t.STATIC_DRAW),e.colors&&(e._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,e._colorBuffer),t.bufferData(t.ARRAY_BUFFER,e.colors,t.STATIC_DRAW)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW)},r.prototype.flush=function(){},r.prototype.start=function(){this.currentShader=null},r.prototype.destroy=function(){n.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":27,"../Mesh":122}],127:[function(e,t,i){function r(e){n.Shader.call(this,e,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var n=e("../../core");r.prototype=Object.create(n.Shader.prototype),r.prototype.constructor=r,t.exports=r,n.ShaderManager.registerPlugin("meshShader",r)},{"../../core":27}],128:[function(e,t,i){Math.sign||(Math.sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1})},{}],129:[function(e,t,i){Object.assign||(Object.assign=e("object-assign"))},{"object-assign":4}],130:[function(e,t,i){e("./Object.assign"),e("./requestAnimationFrame"),e("./Math.sign")},{"./Math.sign":128,"./Object.assign":129,"./requestAnimationFrame":131}],131:[function(e,i,r){(function(e){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!e.performance||!e.performance.now){var t=Date.now();e.performance||(e.performance={}),e.performance.now=function(){return Date.now()-t}}for(var i=Date.now(),r=["ms","moz","webkit","o"],n=0;n<r.length&&!e.requestAnimationFrame;++n)e.requestAnimationFrame=e[r[n]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[r[n]+"CancelAnimationFrame"]||e[r[n]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),r=16+i-t;return r<0&&(r=0),i=t,setTimeout(function(){i=Date.now(),e(performance.now())},r)}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[112])(112)})}).call(t,i(1),i(40).setImmediate)},function(e,t,i){(function(i){var r,n,o=void 0!==e&&e.exports&&void 0!==i?i:this||window;(o._gsQueue||(o._gsQueue=[])).push(function(){"use strict";o._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,i){var r=function(e){var t,i=[],r=e.length;for(t=0;t!==r;i.push(e[t++]));return i},n=function(e,t,r){i.call(this,e,t,r),this._cycle=0,this._yoyo=!0===this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=n.prototype.render},o=1e-10,s=i._internals,a=s.isSelector,l=s.isArray,h=n.prototype=i.to({},.1,{}),c=[];n.version="1.17.0",h.constructor=n,h.kill()._gc=!1,n.killTweensOf=n.killDelayedCallsTo=i.killTweensOf,n.getTweensOf=i.getTweensOf,n.lagSmoothing=i.lagSmoothing,n.ticker=i.ticker,n.render=i.render,h.invalidate=function(){return this._yoyo=!0===this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),i.prototype.invalidate.call(this)},h.updateTo=function(e,t){var r,n=this.ratio,o=this.vars.immediateRender||e.immediateRender;t&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(r in e)this.vars[r]=e[r];if(this._initted||o)if(t)this._initted=!1,o&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&i._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var s=this._time;this.render(0,!0,!1),this._initted=!1,this.render(s,!0,!1)}else if(this._time>0||o){this._initted=!1,this._init();for(var a,l=1/(1-n),h=this._firstPT;h;)a=h.s+h.c,h.c*=l,h.s=a-h.c,h=h._next}return this},h.render=function(e,t,i){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var r,n,a,l,h,c,u,f,d=this._dirty?this.totalDuration():this._totalDuration,p=this._time,m=this._totalTime,g=this._cycle,v=this._duration,y=this._rawPrevTime;if(e>=d?(this._totalTime=d,this._cycle=this._repeat,this._yoyo&&0!=(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=v,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(r=!0,n="onComplete",i=i||this._timeline.autoRemoveChildren),0===v&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(e=0),(0===e||0>y||y===o)&&y!==e&&(i=!0,y>o&&(n="onReverseComplete")),this._rawPrevTime=f=!t||e||y===e?e:o)):1e-7>e?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==m||0===v&&y>0)&&(n="onReverseComplete",r=this._reversed),0>e&&(this._active=!1,0===v&&(this._initted||!this.vars.lazy||i)&&(y>=0&&(i=!0),this._rawPrevTime=f=!t||e||y===e?e:o)),this._initted||(i=!0)):(this._totalTime=this._time=e,0!==this._repeat&&(l=v+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!=(1&this._cycle)&&(this._time=v-this._time),this._time>v?this._time=v:0>this._time&&(this._time=0)),this._easeType?(h=this._time/v,c=this._easeType,u=this._easePower,(1===c||3===c&&h>=.5)&&(h=1-h),3===c&&(h*=2),1===u?h*=h:2===u?h*=h*h:3===u?h*=h*h*h:4===u&&(h*=h*h*h*h),this.ratio=1===c?1-h:2===c?h:.5>this._time/v?h/2:1-h/2):this.ratio=this._ease.getRatio(this._time/v)),p===this._time&&!i&&g===this._cycle)return void(m!==this._totalTime&&this._onUpdate&&(t||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration))return this._time=p,this._totalTime=m,this._rawPrevTime=y,this._cycle=g,s.lazyTweens.push(this),void(this._lazy=[e,t]);this._time&&!r?this.ratio=this._ease.getRatio(this._time/v):r&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(!1!==this._lazy&&(this._lazy=!1),this._active||!this._paused&&this._time!==p&&e>=0&&(this._active=!0),0===m&&(2===this._initted&&e>0&&this._init(),this._startAt&&(e>=0?this._startAt.render(e,t,i):n||(n="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===v)&&(t||this._callback("onStart"))),a=this._firstPT;a;)a.f?a.t[a.p](a.c*this.ratio+a.s):a.t[a.p]=a.c*this.ratio+a.s,a=a._next;this._onUpdate&&(0>e&&this._startAt&&this._startTime&&this._startAt.render(e,t,i),t||(this._totalTime!==m||r)&&this._callback("onUpdate")),this._cycle!==g&&(t||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),n&&(!this._gc||i)&&(0>e&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(e,t,i),r&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[n]&&this._callback(n),0===v&&this._rawPrevTime===o&&f!==o&&(this._rawPrevTime=0))},n.to=function(e,t,i){return new n(e,t,i)},n.from=function(e,t,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new n(e,t,i)},n.fromTo=function(e,t,i,r){return r.startAt=i,r.immediateRender=0!=r.immediateRender&&0!=i.immediateRender,new n(e,t,r)},n.staggerTo=n.allTo=function(e,t,o,s,h,u,f){s=s||0;var d,p,m,g,v=o.delay||0,y=[],_=function(){o.onComplete&&o.onComplete.apply(o.onCompleteScope||this,arguments),h.apply(f||o.callbackScope||this,u||c)};for(l(e)||("string"==typeof e&&(e=i.selector(e)||e),a(e)&&(e=r(e))),e=e||[],0>s&&(e=r(e),e.reverse(),s*=-1),d=e.length-1,m=0;d>=m;m++){p={};for(g in o)p[g]=o[g];p.delay=v,m===d&&h&&(p.onComplete=_),y[m]=new n(e[m],t,p),v+=s}return y},n.staggerFrom=n.allFrom=function(e,t,i,r,o,s,a){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,n.staggerTo(e,t,i,r,o,s,a)},n.staggerFromTo=n.allFromTo=function(e,t,i,r,o,s,a,l){return r.startAt=i,r.immediateRender=0!=r.immediateRender&&0!=i.immediateRender,n.staggerTo(e,t,r,o,s,a,l)},n.delayedCall=function(e,t,i,r,o){return new n(t,0,{delay:e,onComplete:t,onCompleteParams:i,callbackScope:r,onReverseComplete:t,onReverseCompleteParams:i,immediateRender:!1,useFrames:o,overwrite:0})},n.set=function(e,t){return new n(e,0,t)},n.isTweening=function(e){return i.getTweensOf(e,!0).length>0};var u=function(e,t){for(var r=[],n=0,o=e._first;o;)o instanceof i?r[n++]=o:(t&&(r[n++]=o),r=r.concat(u(o,t)),n=r.length),o=o._next;return r},f=n.getAllTweens=function(t){return u(e._rootTimeline,t).concat(u(e._rootFramesTimeline,t))};n.killAll=function(e,i,r,n){null==i&&(i=!0),null==r&&(r=!0);var o,s,a,l=f(0!=n),h=l.length,c=i&&r&&n;for(a=0;h>a;a++)s=l[a],(c||s instanceof t||(o=s.target===s.vars.onComplete)&&r||i&&!o)&&(e?s.totalTime(s._reversed?0:s.totalDuration()):s._enabled(!1,!1))},n.killChildTweensOf=function(e,t){if(null!=e){var o,h,c,u,f,d=s.tweenLookup;if("string"==typeof e&&(e=i.selector(e)||e),a(e)&&(e=r(e)),l(e))for(u=e.length;--u>-1;)n.killChildTweensOf(e[u],t);else{o=[];for(c in d)for(h=d[c].target.parentNode;h;)h===e&&(o=o.concat(d[c].tweens)),h=h.parentNode;for(f=o.length,u=0;f>u;u++)t&&o[u].totalTime(o[u].totalDuration()),o[u]._enabled(!1,!1)}}};var d=function(e,i,r,n){i=!1!==i,r=!1!==r,n=!1!==n;for(var o,s,a=f(n),l=i&&r&&n,h=a.length;--h>-1;)s=a[h],(l||s instanceof t||(o=s.target===s.vars.onComplete)&&r||i&&!o)&&s.paused(e)};return n.pauseAll=function(e,t,i){d(!0,e,t,i)},n.resumeAll=function(e,t,i){d(!1,e,t,i)},n.globalTimeScale=function(t){var r=e._rootTimeline,n=i.ticker.time;return arguments.length?(t=t||o,r._startTime=n-(n-r._startTime)*r._timeScale/t,r=e._rootFramesTimeline,n=i.ticker.frame,r._startTime=n-(n-r._startTime)*r._timeScale/t,r._timeScale=e._rootTimeline._timeScale=t,t):r._timeScale},h.progress=function(e){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!=(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},h.totalProgress=function(e){return arguments.length?this.totalTime(this.totalDuration()*e,!1):this._totalTime/this.totalDuration()},h.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!=(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},h.duration=function(t){return arguments.length?e.prototype.duration.call(this,t):this._duration},h.totalDuration=function(e){return arguments.length?-1===this._repeat?this:this.duration((e-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},h.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},h.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},h.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},n},!0),o._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,i){var r=function(e){t.call(this,e),this._labels={},this.autoRemoveChildren=!0===this.vars.autoRemoveChildren,this.smoothChildTiming=!0===this.vars.smoothChildTiming,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,r,n=this.vars;for(r in n)i=n[r],h(i)&&-1!==i.join("").indexOf("{self}")&&(n[r]=this._swapSelfInParams(i));h(n.tweens)&&this.add(n.tweens,0,n.align,n.stagger)},n=1e-10,s=i._internals,a=r._internals={},l=s.isSelector,h=s.isArray,c=s.lazyTweens,u=s.lazyRender,f=[],d=o._gsDefine.globals,p=function(e){var t,i={};for(t in e)i[t]=e[t];return i},m=a.pauseCallback=function(e,t,i,r){var o,s=e._timeline,a=s._totalTime,l=e._startTime,h=0>e._rawPrevTime||0===e._rawPrevTime&&s._reversed,c=h?0:n,u=h?n:0;if(t||!this._forcingPlayhead){for(s.pause(l),o=e._prev;o&&o._startTime===l;)o._rawPrevTime=u,o=o._prev;for(o=e._next;o&&o._startTime===l;)o._rawPrevTime=c,o=o._next;t&&t.apply(r||s.vars.callbackScope||s,i||f),(this._forcingPlayhead||!s._paused)&&s.seek(a)}},g=function(e){var t,i=[],r=e.length;for(t=0;t!==r;i.push(e[t++]));return i},v=r.prototype=new t;return r.version="1.17.0",v.constructor=r,v.kill()._gc=v._forcingPlayhead=!1,v.to=function(e,t,r,n){var o=r.repeat&&d.TweenMax||i;return t?this.add(new o(e,t,r),n):this.set(e,r,n)},v.from=function(e,t,r,n){return this.add((r.repeat&&d.TweenMax||i).from(e,t,r),n)},v.fromTo=function(e,t,r,n,o){var s=n.repeat&&d.TweenMax||i;return t?this.add(s.fromTo(e,t,r,n),o):this.set(e,n,o)},v.staggerTo=function(e,t,n,o,s,a,h,c){var u,f=new r({onComplete:a,onCompleteParams:h,callbackScope:c,smoothChildTiming:this.smoothChildTiming});for("string"==typeof e&&(e=i.selector(e)||e),e=e||[],l(e)&&(e=g(e)),o=o||0,0>o&&(e=g(e),e.reverse(),o*=-1),u=0;e.length>u;u++)n.startAt&&(n.startAt=p(n.startAt)),f.to(e[u],t,p(n),u*o);return this.add(f,s)},v.staggerFrom=function(e,t,i,r,n,o,s,a){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(e,t,i,r,n,o,s,a)},v.staggerFromTo=function(e,t,i,r,n,o,s,a,l){return r.startAt=i,r.immediateRender=0!=r.immediateRender&&0!=i.immediateRender,this.staggerTo(e,t,r,n,o,s,a,l)},v.call=function(e,t,r,n){return this.add(i.delayedCall(0,e,t,r),n)},v.set=function(e,t,r){return r=this._parseTimeOrLabel(r,0,!0),null==t.immediateRender&&(t.immediateRender=r===this._time&&!this._paused),this.add(new i(e,0,t),r)},r.exportRoot=function(e,t){e=e||{},null==e.smoothChildTiming&&(e.smoothChildTiming=!0);var n,o,s=new r(e),a=s._timeline;for(null==t&&(t=!0),a._remove(s,!0),s._startTime=0,s._rawPrevTime=s._time=s._totalTime=a._time,n=a._first;n;)o=n._next,t&&n instanceof i&&n.target===n.vars.onComplete||s.add(n,n._startTime-n._delay),n=o;return a.add(s,0),s},v.add=function(n,o,s,a){var l,c,u,f,d,p;if("number"!=typeof o&&(o=this._parseTimeOrLabel(o,0,!0,n)),!(n instanceof e)){if(n instanceof Array||n&&n.push&&h(n)){for(s=s||"normal",a=a||0,l=o,c=n.length,u=0;c>u;u++)h(f=n[u])&&(f=new r({tweens:f})),this.add(f,l),"string"!=typeof f&&"function"!=typeof f&&("sequence"===s?l=f._startTime+f.totalDuration()/f._timeScale:"start"===s&&(f._startTime-=f.delay())),l+=a;return this._uncache(!0)}if("string"==typeof n)return this.addLabel(n,o);if("function"!=typeof n)throw"Cannot add "+n+" into the timeline; it is not a tween, timeline, function, or string.";n=i.delayedCall(0,n)}if(t.prototype.add.call(this,n,o),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(d=this,p=d.rawTime()>n._startTime;d._timeline;)p&&d._timeline.smoothChildTiming?d.totalTime(d._totalTime,!0):d._gc&&d._enabled(!0,!1),d=d._timeline;return this},v.remove=function(t){if(t instanceof e)return this._remove(t,!1);if(t instanceof Array||t&&t.push&&h(t)){for(var i=t.length;--i>-1;)this.remove(t[i]);return this}return"string"==typeof t?this.removeLabel(t):this.kill(null,t)},v._remove=function(e,i){t.prototype._remove.call(this,e,i);var r=this._last;return r?this._time>r._startTime+r._totalDuration/r._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},v.append=function(e,t){return this.add(e,this._parseTimeOrLabel(null,t,!0,e))},v.insert=v.insertMultiple=function(e,t,i,r){return this.add(e,t||0,i,r)},v.appendMultiple=function(e,t,i,r){return this.add(e,this._parseTimeOrLabel(null,t,!0,e),i,r)},v.addLabel=function(e,t){return this._labels[e]=this._parseTimeOrLabel(t),this},v.addPause=function(e,t,r,n){var o=i.delayedCall(0,m,["{self}",t,r,n],this);return o.data="isPause",this.add(o,e)},v.removeLabel=function(e){return delete this._labels[e],this},v.getLabelTime=function(e){return null!=this._labels[e]?this._labels[e]:-1},v._parseTimeOrLabel=function(t,i,r,n){var o;if(n instanceof e&&n.timeline===this)this.remove(n);else if(n&&(n instanceof Array||n.push&&h(n)))for(o=n.length;--o>-1;)n[o]instanceof e&&n[o].timeline===this&&this.remove(n[o]);if("string"==typeof i)return this._parseTimeOrLabel(i,r&&"number"==typeof t&&null==this._labels[i]?t-this.duration():0,r);if(i=i||0,"string"!=typeof t||!isNaN(t)&&null==this._labels[t])null==t&&(t=this.duration());else{if(-1===(o=t.indexOf("=")))return null==this._labels[t]?r?this._labels[t]=this.duration()+i:i:this._labels[t]+i;i=parseInt(t.charAt(o-1)+"1",10)*Number(t.substr(o+1)),t=o>1?this._parseTimeOrLabel(t.substr(0,o-1),0,r):this.duration()}return Number(t)+i},v.seek=function(e,t){return this.totalTime("number"==typeof e?e:this._parseTimeOrLabel(e),!1!==t)},v.stop=function(){return this.paused(!0)},v.gotoAndPlay=function(e,t){return this.play(e,t)},v.gotoAndStop=function(e,t){return this.pause(e,t)},v.render=function(e,t,i){this._gc&&this._enabled(!0,!1);var r,o,s,a,l,h=this._dirty?this.totalDuration():this._totalDuration,f=this._time,d=this._startTime,p=this._timeScale,m=this._paused;if(e>=h)this._totalTime=this._time=h,this._reversed||this._hasPausedChild()||(o=!0,a="onComplete",l=!!this._timeline.autoRemoveChildren,0===this._duration&&(0===e||0>this._rawPrevTime||this._rawPrevTime===n)&&this._rawPrevTime!==e&&this._first&&(l=!0,this._rawPrevTime>n&&(a="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:n,e=h+1e-4;else if(1e-7>e)if(this._totalTime=this._time=0,(0!==f||0===this._duration&&this._rawPrevTime!==n&&(this._rawPrevTime>0||0>e&&this._rawPrevTime>=0))&&(a="onReverseComplete",o=this._reversed),0>e)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(l=o=!0,a="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(l=!0),this._rawPrevTime=e;else{if(this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:n,0===e&&o)for(r=this._first;r&&0===r._startTime;)r._duration||(o=!1),r=r._next;e=0,this._initted||(l=!0)}else this._totalTime=this._time=this._rawPrevTime=e;if(this._time!==f&&this._first||i||l){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==f&&e>0&&(this._active=!0),0===f&&this.vars.onStart&&0!==this._time&&(t||this._callback("onStart")),this._time>=f)for(r=this._first;r&&(s=r._next,!this._paused||m);)(r._active||r._startTime<=this._time&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,i):r.render((e-r._startTime)*r._timeScale,t,i)),r=s;else for(r=this._last;r&&(s=r._prev,!this._paused||m);)(r._active||f>=r._startTime&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,i):r.render((e-r._startTime)*r._timeScale,t,i)),r=s;this._onUpdate&&(t||(c.length&&u(),this._callback("onUpdate"))),a&&(this._gc||(d===this._startTime||p!==this._timeScale)&&(0===this._time||h>=this.totalDuration())&&(o&&(c.length&&u(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[a]&&this._callback(a)))}},v._hasPausedChild=function(){for(var e=this._first;e;){if(e._paused||e instanceof r&&e._hasPausedChild())return!0;e=e._next}return!1},v.getChildren=function(e,t,r,n){n=n||-9999999999;for(var o=[],s=this._first,a=0;s;)n>s._startTime||(s instanceof i?!1!==t&&(o[a++]=s):(!1!==r&&(o[a++]=s),!1!==e&&(o=o.concat(s.getChildren(!0,t,r)),a=o.length))),s=s._next;return o},v.getTweensOf=function(e,t){var r,n,o=this._gc,s=[],a=0;for(o&&this._enabled(!0,!0),r=i.getTweensOf(e),n=r.length;--n>-1;)(r[n].timeline===this||t&&this._contains(r[n]))&&(s[a++]=r[n]);return o&&this._enabled(!1,!0),s},v.recent=function(){return this._recent},v._contains=function(e){for(var t=e.timeline;t;){if(t===this)return!0;t=t.timeline}return!1},v.shiftChildren=function(e,t,i){i=i||0;for(var r,n=this._first,o=this._labels;n;)n._startTime>=i&&(n._startTime+=e),n=n._next;if(t)for(r in o)o[r]>=i&&(o[r]+=e);return this._uncache(!0)},v._kill=function(e,t){if(!e&&!t)return this._enabled(!1,!1);for(var i=t?this.getTweensOf(t):this.getChildren(!0,!0,!1),r=i.length,n=!1;--r>-1;)i[r]._kill(e,t)&&(n=!0);return n},v.clear=function(e){var t=this.getChildren(!1,!0,!0),i=t.length;for(this._time=this._totalTime=0;--i>-1;)t[i]._enabled(!1,!1);return!1!==e&&(this._labels={}),this._uncache(!0)},v.invalidate=function(){for(var t=this._first;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},v._enabled=function(e,i){if(e===this._gc)for(var r=this._first;r;)r._enabled(e,!0),r=r._next;return t.prototype._enabled.call(this,e,i)},v.totalTime=function(){this._forcingPlayhead=!0;var t=e.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,t},v.duration=function(e){return arguments.length?(0!==this.duration()&&0!==e&&this.timeScale(this._duration/e),this):(this._dirty&&this.totalDuration(),this._duration)},v.totalDuration=function(e){if(!arguments.length){if(this._dirty){for(var t,i,r=0,n=this._last,o=999999999999;n;)t=n._prev,n._dirty&&n.totalDuration(),n._startTime>o&&this._sortChildren&&!n._paused?this.add(n,n._startTime-n._delay):o=n._startTime,0>n._startTime&&!n._paused&&(r-=n._startTime,this._timeline.smoothChildTiming&&(this._startTime+=n._startTime/this._timeScale),this.shiftChildren(-n._startTime,!1,-9999999999),o=0),i=n._startTime+n._totalDuration/n._timeScale,i>r&&(r=i),n=t;this._duration=this._totalDuration=r,this._dirty=!1}return this._totalDuration}return 0!==this.totalDuration()&&0!==e&&this.timeScale(this._totalDuration/e),this},v.paused=function(t){if(!t)for(var i=this._first,r=this._time;i;)i._startTime===r&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return e.prototype.paused.apply(this,arguments)},v.usesFrames=function(){for(var t=this._timeline;t._timeline;)t=t._timeline;return t===e._rootFramesTimeline},v.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},r},!0),o._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(e,t,i){var r=function(t){e.call(this,t),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=!0===this.vars.yoyo,this._dirty=!0},n=1e-10,o=t._internals,s=o.lazyTweens,a=o.lazyRender,l=new i(null,null,1,0),h=r.prototype=new e;return h.constructor=r,h.kill()._gc=!1,r.version="1.17.0",h.invalidate=function(){return this._yoyo=!0===this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),e.prototype.invalidate.call(this)},h.addCallback=function(e,i,r,n){return this.add(t.delayedCall(0,e,r,n),i)},h.removeCallback=function(e,t){if(e)if(null==t)this._kill(null,e);else for(var i=this.getTweensOf(e,!1),r=i.length,n=this._parseTimeOrLabel(t);--r>-1;)i[r]._startTime===n&&i[r]._enabled(!1,!1);return this},h.removePause=function(t){return this.removeCallback(e._internals.pauseCallback,t)},h.tweenTo=function(e,i){i=i||{};var r,n,o,s={ease:l,useFrames:this.usesFrames(),immediateRender:!1};for(n in i)s[n]=i[n];return s.time=this._parseTimeOrLabel(e),r=Math.abs(Number(s.time)-this._time)/this._timeScale||.001,o=new t(this,r,s),s.onStart=function(){o.target.paused(!0),o.vars.time!==o.target.time()&&r===o.duration()&&o.duration(Math.abs(o.vars.time-o.target.time())/o.target._timeScale),i.onStart&&o._callback("onStart")},o},h.tweenFromTo=function(e,t,i){i=i||{},e=this._parseTimeOrLabel(e),i.startAt={onComplete:this.seek,onCompleteParams:[e],callbackScope:this},i.immediateRender=!1!==i.immediateRender;var r=this.tweenTo(t,i);return r.duration(Math.abs(r.vars.time-e)/this._timeScale||.001)},h.render=function(e,t,i){this._gc&&this._enabled(!0,!1);var r,o,l,h,c,u,f=this._dirty?this.totalDuration():this._totalDuration,d=this._duration,p=this._time,m=this._totalTime,g=this._startTime,v=this._timeScale,y=this._rawPrevTime,_=this._paused,b=this._cycle;if(e>=f)this._locked||(this._totalTime=f,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(o=!0,h="onComplete",c=!!this._timeline.autoRemoveChildren,0===this._duration&&(0===e||0>y||y===n)&&y!==e&&this._first&&(c=!0,y>n&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:n,this._yoyo&&0!=(1&this._cycle)?this._time=e=0:(this._time=d,e=d+1e-4);else if(1e-7>e)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==p||0===d&&y!==n&&(y>0||0>e&&y>=0)&&!this._locked)&&(h="onReverseComplete",o=this._reversed),0>e)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(c=o=!0,h="onReverseComplete"):y>=0&&this._first&&(c=!0),this._rawPrevTime=e;else{if(this._rawPrevTime=d||!t||e||this._rawPrevTime===e?e:n,0===e&&o)for(r=this._first;r&&0===r._startTime;)r._duration||(o=!1),r=r._next;e=0,this._initted||(c=!0)}else 0===d&&0>y&&(c=!0),this._time=this._rawPrevTime=e,this._locked||(this._totalTime=e,0!==this._repeat&&(u=d+this._repeatDelay,this._cycle=this._totalTime/u>>0,0!==this._cycle&&this._cycle===this._totalTime/u&&this._cycle--,this._time=this._totalTime-this._cycle*u,this._yoyo&&0!=(1&this._cycle)&&(this._time=d-this._time),this._time>d?(this._time=d,e=d+1e-4):0>this._time?this._time=e=0:e=this._time));if(this._cycle!==b&&!this._locked){var x=this._yoyo&&0!=(1&b),T=x===(this._yoyo&&0!=(1&this._cycle)),E=this._totalTime,S=this._cycle,w=this._rawPrevTime,M=this._time;if(this._totalTime=b*d,b>this._cycle?x=!x:this._totalTime+=d,this._time=p,this._rawPrevTime=0===d?y-1e-4:y,this._cycle=b,this._locked=!0,p=x?0:d,this.render(p,t,0===d),t||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),T&&(p=x?d+1e-4:-1e-4,this.render(p,!0,!1)),this._locked=!1,this._paused&&!_)return;this._time=M,this._totalTime=E,this._cycle=S,this._rawPrevTime=w}if(!(this._time!==p&&this._first||i||c))return void(m!==this._totalTime&&this._onUpdate&&(t||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==m&&e>0&&(this._active=!0),0===m&&this.vars.onStart&&0!==this._totalTime&&(t||this._callback("onStart")),this._time>=p)for(r=this._first;r&&(l=r._next,!this._paused||_);)(r._active||r._startTime<=this._time&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,i):r.render((e-r._startTime)*r._timeScale,t,i)),r=l;else for(r=this._last;r&&(l=r._prev,!this._paused||_);)(r._active||p>=r._startTime&&!r._paused&&!r._gc)&&(r._reversed?r.render((r._dirty?r.totalDuration():r._totalDuration)-(e-r._startTime)*r._timeScale,t,i):r.render((e-r._startTime)*r._timeScale,t,i)),r=l;this._onUpdate&&(t||(s.length&&a(),this._callback("onUpdate"))),h&&(this._locked||this._gc||(g===this._startTime||v!==this._timeScale)&&(0===this._time||f>=this.totalDuration())&&(o&&(s.length&&a(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[h]&&this._callback(h)))},h.getActive=function(e,t,i){null==e&&(e=!0),null==t&&(t=!0),null==i&&(i=!1);var r,n,o=[],s=this.getChildren(e,t,i),a=0,l=s.length;for(r=0;l>r;r++)n=s[r],n.isActive()&&(o[a++]=n);return o},h.getLabelAfter=function(e){e||0!==e&&(e=this._time);var t,i=this.getLabelsArray(),r=i.length;for(t=0;r>t;t++)if(i[t].time>e)return i[t].name;return null},h.getLabelBefore=function(e){null==e&&(e=this._time);for(var t=this.getLabelsArray(),i=t.length;--i>-1;)if(e>t[i].time)return t[i].name;return null},h.getLabelsArray=function(){var e,t=[],i=0;for(e in this._labels)t[i++]={time:this._labels[e],name:e};return t.sort(function(e,t){return e.time-t.time}),t},h.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!=(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),t):this._time/this.duration()},h.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this._totalTime/this.totalDuration()},h.totalDuration=function(t){return arguments.length?-1===this._repeat?this:this.duration((t-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(e.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},h.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!=(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},h.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},h.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},h.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},h.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.getLabelBefore(this._time+1e-8)},r},!0),function(){var e=180/Math.PI,t=[],i=[],r=[],n={},s=o._gsDefine.globals,a=function(e,t,i,r){this.a=e,this.b=t,this.c=i,this.d=r,this.da=r-e,this.ca=i-e,this.ba=t-e},l=function(e,t,i,r){var n={a:e},o={},s={},a={c:r},l=(e+t)/2,h=(t+i)/2,c=(i+r)/2,u=(l+h)/2,f=(h+c)/2,d=(f-u)/8;return n.b=l+(e-l)/4,o.b=u+d,n.c=o.a=(n.b+o.b)/2,o.c=s.a=(u+f)/2,s.b=f-d,a.b=c+(r-c)/4,s.c=a.a=(s.b+a.b)/2,[n,o,s,a]},h=function(e,n,o,s,a){var h,c,u,f,d,p,m,g,v,y,_,b,x,T=e.length-1,E=0,S=e[0].a;for(h=0;T>h;h++)d=e[E],c=d.a,u=d.d,f=e[E+1].d,a?(_=t[h],b=i[h],x=.25*(b+_)*n/(s?.5:r[h]||.5),p=u-(u-c)*(s?.5*n:0!==_?x/_:0),m=u+(f-u)*(s?.5*n:0!==b?x/b:0),g=u-(p+((m-p)*(3*_/(_+b)+.5)/4||0))):(p=u-.5*(u-c)*n,m=u+.5*(f-u)*n,g=u-(p+m)/2),p+=g,m+=g,d.c=v=p,d.b=0!==h?S:S=d.a+.6*(d.c-d.a),d.da=u-c,d.ca=v-c,d.ba=S-c,o?(y=l(c,S,v,u),e.splice(E,1,y[0],y[1],y[2],y[3]),E+=4):E++,S=m;d=e[E],d.b=S,d.c=S+.4*(d.d-S),d.da=d.d-d.a,d.ca=d.c-d.a,d.ba=S-d.a,o&&(y=l(d.a,S,d.c,d.d),e.splice(E,1,y[0],y[1],y[2],y[3]))},c=function(e,r,n,o){var s,l,h,c,u,f,d=[];if(o)for(e=[o].concat(e),l=e.length;--l>-1;)"string"==typeof(f=e[l][r])&&"="===f.charAt(1)&&(e[l][r]=o[r]+Number(f.charAt(0)+f.substr(2)));if(0>(s=e.length-2))return d[0]=new a(e[0][r],0,0,e[-1>s?0:1][r]),d;for(l=0;s>l;l++)h=e[l][r],c=e[l+1][r],d[l]=new a(h,0,0,c),n&&(u=e[l+2][r],t[l]=(t[l]||0)+(c-h)*(c-h),i[l]=(i[l]||0)+(u-c)*(u-c));return d[l]=new a(e[l][r],0,0,e[l+1][r]),d},u=function(e,o,s,a,l,u){var f,d,p,m,g,v,y,_,b={},x=[],T=u||e[0];l="string"==typeof l?","+l+",":",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",null==o&&(o=1);for(d in e[0])x.push(d);if(e.length>1){for(_=e[e.length-1],y=!0,f=x.length;--f>-1;)if(d=x[f],Math.abs(T[d]-_[d])>.05){y=!1;break}y&&(e=e.concat(),u&&e.unshift(u),e.push(e[1]),u=e[e.length-3])}for(t.length=i.length=r.length=0,f=x.length;--f>-1;)d=x[f],n[d]=-1!==l.indexOf(","+d+","),b[d]=c(e,d,n[d],u);for(f=t.length;--f>-1;)t[f]=Math.sqrt(t[f]),i[f]=Math.sqrt(i[f]);if(!a){for(f=x.length;--f>-1;)if(n[d])for(p=b[x[f]],v=p.length-1,m=0;v>m;m++)g=p[m+1].da/i[m]+p[m].da/t[m],r[m]=(r[m]||0)+g*g;for(f=r.length;--f>-1;)r[f]=Math.sqrt(r[f])}for(f=x.length,m=s?4:1;--f>-1;)d=x[f],p=b[d],h(p,o,s,a,n[d]),y&&(p.splice(0,m),p.splice(p.length-m,m));return b},f=function(e,t,i){t=t||"soft";var r,n,o,s,l,h,c,u,f,d,p,m={},g="cubic"===t?3:2,v="soft"===t,y=[];if(v&&i&&(e=[i].concat(e)),null==e||g+1>e.length)throw"invalid Bezier data";for(f in e[0])y.push(f);for(h=y.length;--h>-1;){for(f=y[h],m[f]=l=[],d=0,u=e.length,c=0;u>c;c++)r=null==i?e[c][f]:"string"==typeof(p=e[c][f])&&"="===p.charAt(1)?i[f]+Number(p.charAt(0)+p.substr(2)):Number(p),v&&c>1&&u-1>c&&(l[d++]=(r+l[d-2])/2),l[d++]=r;for(u=d-g+1,d=0,c=0;u>c;c+=g)r=l[c],n=l[c+1],o=l[c+2],s=2===g?0:l[c+3],l[d++]=p=3===g?new a(r,n,o,s):new a(r,(2*n+r)/3,(2*n+o)/3,o);l.length=d}return m},d=function(e,t,i){for(var r,n,o,s,a,l,h,c,u,f,d,p=1/i,m=e.length;--m>-1;)for(f=e[m],o=f.a,s=f.d-o,a=f.c-o,l=f.b-o,r=n=0,c=1;i>=c;c++)h=p*c,u=1-h,r=n-(n=(h*h*s+3*u*(h*a+u*l))*h),d=m*i+c-1,t[d]=(t[d]||0)+r*r},p=function(e,t){t=t>>0||6;var i,r,n,o,s=[],a=[],l=0,h=0,c=t-1,u=[],f=[];for(i in e)d(e[i],s,t);for(n=s.length,r=0;n>r;r++)l+=Math.sqrt(s[r]),o=r%t,f[o]=l,o===c&&(h+=l,o=r/t>>0,u[o]=f,a[o]=h,l=0,f=[]);return{length:h,lengths:a,segments:u}},m=o._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.4",API:2,global:!0,init:function(e,t,i){this._target=e,t instanceof Array&&(t={values:t}),this._func={},this._round={},this._props=[],this._timeRes=null==t.timeResolution?6:parseInt(t.timeResolution,10);var r,n,o,s,a,l=t.values||[],h={},c=l[0],d=t.autoRotate||i.vars.orientToBezier;this._autoRotate=d?d instanceof Array?d:[["x","y","rotation",!0===d?0:Number(d)||0]]:null;for(r in c)this._props.push(r);for(o=this._props.length;--o>-1;)r=this._props[o],this._overwriteProps.push(r),n=this._func[r]="function"==typeof e[r],h[r]=n?e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)]():parseFloat(e[r]),a||h[r]!==l[0][r]&&(a=h);if(this._beziers="cubic"!==t.type&&"quadratic"!==t.type&&"soft"!==t.type?u(l,isNaN(t.curviness)?1:t.curviness,!1,"thruBasic"===t.type,t.correlate,a):f(l,t.type,h),this._segCount=this._beziers[r].length,this._timeRes){var m=p(this._beziers,this._timeRes);this._length=m.length,this._lengths=m.lengths,this._segments=m.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(d=this._autoRotate)for(this._initialRotations=[],d[0]instanceof Array||(this._autoRotate=d=[d]),o=d.length;--o>-1;){for(s=0;3>s;s++)r=d[o][s],this._func[r]="function"==typeof e[r]&&e[r.indexOf("set")||"function"!=typeof e["get"+r.substr(3)]?r:"get"+r.substr(3)];r=d[o][2],this._initialRotations[o]=this._func[r]?this._func[r].call(this._target):this._target[r]}return this._startRatio=i.vars.runBackwards?1:0,!0},set:function(t){var i,r,n,o,s,a,l,h,c,u,f=this._segCount,d=this._func,p=this._target,m=t!==this._startRatio;if(this._timeRes){if(c=this._lengths,u=this._curSeg,t*=this._length,n=this._li,t>this._l2&&f-1>n){for(h=f-1;h>n&&t>=(this._l2=c[++n]););this._l1=c[n-1],this._li=n,this._curSeg=u=this._segments[n],this._s2=u[this._s1=this._si=0]}else if(this._l1>t&&n>0){for(;n>0&&(this._l1=c[--n])>=t;);0===n&&this._l1>t?this._l1=0:n++,this._l2=c[n],this._li=n,this._curSeg=u=this._segments[n],this._s1=u[(this._si=u.length-1)-1]||0,this._s2=u[this._si]}if(i=n,t-=this._l1,n=this._si,t>this._s2&&u.length-1>n){for(h=u.length-1;h>n&&t>=(this._s2=u[++n]););this._s1=u[n-1],this._si=n}else if(this._s1>t&&n>0){for(;n>0&&(this._s1=u[--n])>=t;);0===n&&this._s1>t?this._s1=0:n++,this._s2=u[n],this._si=n}a=(n+(t-this._s1)/(this._s2-this._s1))*this._prec}else i=0>t?0:t>=1?f-1:f*t>>0,a=(t-i*(1/f))*f;for(r=1-a,n=this._props.length;--n>-1;)o=this._props[n],s=this._beziers[o][i],l=(a*a*s.da+3*r*(a*s.ca+r*s.ba))*a+s.a,this._round[o]&&(l=Math.round(l)),d[o]?p[o](l):p[o]=l;if(this._autoRotate){var g,v,y,_,b,x,T,E=this._autoRotate;for(n=E.length;--n>-1;)o=E[n][2],x=E[n][3]||0,T=!0===E[n][4]?1:e,s=this._beziers[E[n][0]],g=this._beziers[E[n][1]],s&&g&&(s=s[i],g=g[i],v=s.a+(s.b-s.a)*a,_=s.b+(s.c-s.b)*a,v+=(_-v)*a,_+=(s.c+(s.d-s.c)*a-_)*a,y=g.a+(g.b-g.a)*a,b=g.b+(g.c-g.b)*a,y+=(b-y)*a,b+=(g.c+(g.d-g.c)*a-b)*a,l=m?Math.atan2(b-y,_-v)*T+x:this._initialRotations[n],d[o]?p[o](l):p[o]=l)}}}),g=m.prototype;m.bezierThrough=u,m.cubicToQuadratic=l,m._autoCSS=!0,m.quadraticToCubic=function(e,t,i){return new a(e,(2*t+e)/3,(2*t+i)/3,i)},m._cssRegister=function(){var e=s.CSSPlugin;if(e){var t=e._internals,i=t._parseToProxy,r=t._setPluginRatio,n=t.CSSPropTween;t._registerComplexSpecialProp("bezier",{parser:function(e,t,o,s,a,l){t instanceof Array&&(t={values:t}),l=new m;var h,c,u,f=t.values,d=f.length-1,p=[],g={};if(0>d)return a;for(h=0;d>=h;h++)u=i(e,f[h],s,a,l,d!==h),p[h]=u.end;for(c in t)g[c]=t[c];return g.values=p,a=new n(e,"bezier",0,0,u.pt,2),a.data=u,a.plugin=l,a.setRatio=r,0===g.autoRotate&&(g.autoRotate=!0),!g.autoRotate||g.autoRotate instanceof Array||(h=!0===g.autoRotate?0:Number(g.autoRotate),g.autoRotate=null!=u.end.left?[["left","top","rotation",h,!1]]:null!=u.end.x&&[["x","y","rotation",h,!1]]),g.autoRotate&&(s._transform||s._enableTransforms(!1),u.autoRotate=s._target._gsTransform),l._onInitTween(u.proxy,g,s._tween),a}})}},g._roundProps=function(e,t){for(var i=this._overwriteProps,r=i.length;--r>-1;)(e[i[r]]||e.bezier||e.bezierThrough)&&(this._round[i[r]]=t)},g._kill=function(e){var t,i,r=this._props;for(t in this._beziers)if(t in e)for(delete this._beziers[t],delete this._func[t],i=r.length;--i>-1;)r[i]===t&&r.splice(i,1);return this._super._kill.call(this,e)}}(),o._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(e,t){var i,r,n,s,a=function(){e.call(this,"css"),this._overwriteProps.length=0,this.setRatio=a.prototype.setRatio},l=o._gsDefine.globals,h={},c=a.prototype=new e("css");c.constructor=a,a.version="1.17.0",a.API=2,a.defaultTransformPerspective=0,a.defaultSkewType="compensated",a.defaultSmoothOrigin=!0,c="px",a.suffixMap={top:c,right:c,bottom:c,left:c,width:c,height:c,fontSize:c,padding:c,margin:c,perspective:c,lineHeight:""};var u,f,d,p,m,g,v=/(?:\d|\-\d|\.\d|\-\.\d)+/g,y=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,_=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,b=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,T=/opacity *= *([^)]*)/i,E=/opacity:([^;]*)/i,S=/alpha\(opacity *=.+?\)/i,w=/^(rgb|hsl)/,M=/([A-Z])/g,A=/-([a-z])/gi,P=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,C=function(e,t){return t.toUpperCase()},R=/(?:Left|Right|Width)/i,D=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,I=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,O=/,(?=[^\)]*(?:\(|$))/gi,F=Math.PI/180,L=180/Math.PI,B={},N=document,k=function(e){return N.createElementNS?N.createElementNS("http://www.w3.org/1999/xhtml",e):N.createElement(e)},V=k("div"),U=k("img"),z=a._internals={_specialProps:h},G=navigator.userAgent,H=function(){var e=G.indexOf("Android"),t=k("a");return d=-1!==G.indexOf("Safari")&&-1===G.indexOf("Chrome")&&(-1===e||Number(G.substr(e+8,1))>3),m=d&&6>Number(G.substr(G.indexOf("Version/")+8,1)),p=-1!==G.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(G)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(G))&&(g=parseFloat(RegExp.$1)),!!t&&(t.style.cssText="top:1px;opacity:.55;",/^0.55/.test(t.style.opacity))}(),j=function(e){return T.test("string"==typeof e?e:(e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100:1},W=function(e){window.console&&console.log(e)},X="",Y="",K=function(e,t){t=t||V;var i,r,n=t.style;if(void 0!==n[e])return e;for(e=e.charAt(0).toUpperCase()+e.substr(1),i=["O","Moz","ms","Ms","Webkit"],r=5;--r>-1&&void 0===n[i[r]+e];);return r>=0?(Y=3===r?"ms":i[r],X="-"+Y.toLowerCase()+"-",Y+e):null},q=N.defaultView?N.defaultView.getComputedStyle:function(){},Q=a.getStyle=function(e,t,i,r,n){var o;return H||"opacity"!==t?(!r&&e.style[t]?o=e.style[t]:(i=i||q(e))?o=i[t]||i.getPropertyValue(t)||i.getPropertyValue(t.replace(M,"-$1").toLowerCase()):e.currentStyle&&(o=e.currentStyle[t]),null==n||o&&"none"!==o&&"auto"!==o&&"auto auto"!==o?o:n):j(e)},Z=z.convertToPixels=function(e,i,r,n,o){if("px"===n||!n)return r;if("auto"===n||!r)return 0;var s,l,h,c=R.test(i),u=e,f=V.style,d=0>r;if(d&&(r=-r),"%"===n&&-1!==i.indexOf("border"))s=r/100*(c?e.clientWidth:e.clientHeight);else{if(f.cssText="border:0 solid red;position:"+Q(e,"position")+";line-height:0;","%"!==n&&u.appendChild)f[c?"borderLeftWidth":"borderTopWidth"]=r+n;else{if(u=e.parentNode||N.body,l=u._gsCache,h=t.ticker.frame,l&&c&&l.time===h)return l.width*r/100;f[c?"width":"height"]=r+n}u.appendChild(V),s=parseFloat(V[c?"offsetWidth":"offsetHeight"]),u.removeChild(V),c&&"%"===n&&!1!==a.cacheWidths&&(l=u._gsCache=u._gsCache||{},l.time=h,l.width=s/r*100),0!==s||o||(s=Z(e,i,r,n,!0))}return d?-s:s},J=z.calculateOffset=function(e,t,i){if("absolute"!==Q(e,"position",i))return 0;var r="left"===t?"Left":"Top",n=Q(e,"margin"+r,i);return e["offset"+r]-(Z(e,t,parseFloat(n),n.replace(x,""))||0)},$=function(e,t){var i,r,n,o={};if(t=t||q(e,null))if(i=t.length)for(;--i>-1;)n=t[i],(-1===n.indexOf("-transform")||Se===n)&&(o[n.replace(A,C)]=t.getPropertyValue(n));else for(i in t)(-1===i.indexOf("Transform")||Ee===i)&&(o[i]=t[i]);else if(t=e.currentStyle||e.style)for(i in t)"string"==typeof i&&void 0===o[i]&&(o[i.replace(A,C)]=t[i]);return H||(o.opacity=j(e)),r=Be(e,t,!1),o.rotation=r.rotation,o.skewX=r.skewX,o.scaleX=r.scaleX,o.scaleY=r.scaleY,o.x=r.x,o.y=r.y,Me&&(o.z=r.z,o.rotationX=r.rotationX,o.rotationY=r.rotationY,o.scaleZ=r.scaleZ),o.filters&&delete o.filters,o},ee=function(e,t,i,r,n){var o,s,a,l={},h=e.style;for(s in i)"cssText"!==s&&"length"!==s&&isNaN(s)&&(t[s]!==(o=i[s])||n&&n[s])&&-1===s.indexOf("Origin")&&("number"==typeof o||"string"==typeof o)&&(l[s]="auto"!==o||"left"!==s&&"top"!==s?""!==o&&"auto"!==o&&"none"!==o||"string"!=typeof t[s]||""===t[s].replace(b,"")?o:0:J(e,s),void 0!==h[s]&&(a=new pe(h,s,h[s],a)));if(r)for(s in r)"className"!==s&&(l[s]=r[s]);return{difs:l,firstMPT:a}},te={width:["Left","Right"],height:["Top","Bottom"]},ie=["marginLeft","marginRight","marginTop","marginBottom"],re=function(e,t,i){var r=parseFloat("width"===t?e.offsetWidth:e.offsetHeight),n=te[t],o=n.length;for(i=i||q(e,null);--o>-1;)r-=parseFloat(Q(e,"padding"+n[o],i,!0))||0,r-=parseFloat(Q(e,"border"+n[o]+"Width",i,!0))||0;return r},ne=function(e,t){(null==e||""===e||"auto"===e||"auto auto"===e)&&(e="0 0");var i=e.split(" "),r=-1!==e.indexOf("left")?"0%":-1!==e.indexOf("right")?"100%":i[0],n=-1!==e.indexOf("top")?"0%":-1!==e.indexOf("bottom")?"100%":i[1];return null==n?n="center"===r?"50%":"0":"center"===n&&(n="50%"),("center"===r||isNaN(parseFloat(r))&&-1===(r+"").indexOf("="))&&(r="50%"),e=r+" "+n+(i.length>2?" "+i[2]:""),t&&(t.oxp=-1!==r.indexOf("%"),t.oyp=-1!==n.indexOf("%"),t.oxr="="===r.charAt(1),t.oyr="="===n.charAt(1),t.ox=parseFloat(r.replace(b,"")),t.oy=parseFloat(n.replace(b,"")),t.v=e),t||e},oe=function(e,t){return"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2)):parseFloat(e)-parseFloat(t)},se=function(e,t){return null==e?t:"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2))+t:parseFloat(e)},ae=function(e,t,i,r){var n,o,s,a,l;return null==e?a=t:"number"==typeof e?a=e:(n=360,o=e.split("_"),l="="===e.charAt(1),s=(l?parseInt(e.charAt(0)+"1",10)*parseFloat(o[0].substr(2)):parseFloat(o[0]))*(-1===e.indexOf("rad")?1:L)-(l?0:t),o.length&&(r&&(r[i]=t+s),-1!==e.indexOf("short")&&(s%=n)!==s%(n/2)&&(s=0>s?s+n:s-n),-1!==e.indexOf("_cw")&&0>s?s=(s+9999999999*n)%n-(0|s/n)*n:-1!==e.indexOf("ccw")&&s>0&&(s=(s-9999999999*n)%n-(0|s/n)*n)),a=t+s),1e-6>a&&a>-1e-6&&(a=0),a},le={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},he=function(e,t,i){return e=0>e?e+1:e>1?e-1:e,0|255*(1>6*e?t+6*(i-t)*e:.5>e?i:2>3*e?t+6*(i-t)*(2/3-e):t)+.5},ce=a.parseColor=function(e){var t,i,r,n,o,s;return e&&""!==e?"number"==typeof e?[e>>16,255&e>>8,255&e]:(","===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),le[e]?le[e]:"#"===e.charAt(0)?(4===e.length&&(t=e.charAt(1),i=e.charAt(2),r=e.charAt(3),e="#"+t+t+i+i+r+r),e=parseInt(e.substr(1),16),[e>>16,255&e>>8,255&e]):"hsl"===e.substr(0,3)?(e=e.match(v),n=Number(e[0])%360/360,o=Number(e[1])/100,s=Number(e[2])/100,i=.5>=s?s*(o+1):s+o-s*o,t=2*s-i,e.length>3&&(e[3]=Number(e[3])),e[0]=he(n+1/3,t,i),e[1]=he(n,t,i),e[2]=he(n-1/3,t,i),e):(e=e.match(v)||le.transparent,e[0]=Number(e[0]),e[1]=Number(e[1]),e[2]=Number(e[2]),e.length>3&&(e[3]=Number(e[3])),e)):le.black},ue="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(c in le)ue+="|"+c+"\\b";ue=RegExp(ue+")","gi");var fe=function(e,t,i,r){if(null==e)return function(e){return e};var n,o=t?(e.match(ue)||[""])[0]:"",s=e.split(o).join("").match(_)||[],a=e.substr(0,e.indexOf(s[0])),l=")"===e.charAt(e.length-1)?")":"",h=-1!==e.indexOf(" ")?" ":",",c=s.length,u=c>0?s[0].replace(v,""):"";return c?n=t?function(e){var t,f,d,p;if("number"==typeof e)e+=u;else if(r&&O.test(e)){for(p=e.replace(O,"|").split("|"),d=0;p.length>d;d++)p[d]=n(p[d]);return p.join(",")}if(t=(e.match(ue)||[o])[0],f=e.split(t).join("").match(_)||[],d=f.length,c>d--)for(;c>++d;)f[d]=i?f[0|(d-1)/2]:s[d];return a+f.join(h)+h+t+l+(-1!==e.indexOf("inset")?" inset":"")}:function(e){var t,o,f;if("number"==typeof e)e+=u;else if(r&&O.test(e)){for(o=e.replace(O,"|").split("|"),f=0;o.length>f;f++)o[f]=n(o[f]);return o.join(",")}if(t=e.match(_)||[],f=t.length,c>f--)for(;c>++f;)t[f]=i?t[0|(f-1)/2]:s[f];return a+t.join(h)+l}:function(e){return e}},de=function(e){return e=e.split(","),function(t,i,r,n,o,s,a){var l,h=(i+"").split(" ");for(a={},l=0;4>l;l++)a[e[l]]=h[l]=h[l]||h[(l-1)/2>>0];return n.parse(t,a,o,s)}},pe=(z._setPluginRatio=function(e){this.plugin.setRatio(e);for(var t,i,r,n,o=this.data,s=o.proxy,a=o.firstMPT;a;)t=s[a.v],a.r?t=Math.round(t):1e-6>t&&t>-1e-6&&(t=0),a.t[a.p]=t,a=a._next;if(o.autoRotate&&(o.autoRotate.rotation=s.rotation),1===e)for(a=o.firstMPT;a;){if(i=a.t,i.type){if(1===i.type){for(n=i.xs0+i.s+i.xs1,r=1;i.l>r;r++)n+=i["xn"+r]+i["xs"+(r+1)];i.e=n}}else i.e=i.s+i.xs0;a=a._next}},function(e,t,i,r,n){this.t=e,this.p=t,this.v=i,this.r=n,r&&(r._prev=this,this._next=r)}),me=(z._parseToProxy=function(e,t,i,r,n,o){var s,a,l,h,c,u=r,f={},d={},p=i._transform,m=B;for(i._transform=null,B=t,r=c=i.parse(e,t,r,n),B=m,o&&(i._transform=p,u&&(u._prev=null,u._prev&&(u._prev._next=null)));r&&r!==u;){if(1>=r.type&&(a=r.p,d[a]=r.s+r.c,f[a]=r.s,o||(h=new pe(r,"s",a,h,r.r),r.c=0),1===r.type))for(s=r.l;--s>0;)l="xn"+s,a=r.p+"_"+l,d[a]=r.data[l],f[a]=r[l],o||(h=new pe(r,l,a,h,r.rxp[l]));r=r._next}return{proxy:f,end:d,firstMPT:h,pt:c}},z.CSSPropTween=function(e,t,r,n,o,a,l,h,c,u,f){this.t=e,this.p=t,this.s=r,this.c=n,this.n=l||t,e instanceof me||s.push(this.n),this.r=h,this.type=a||0,c&&(this.pr=c,i=!0),this.b=void 0===u?r:u,this.e=void 0===f?r+n:f,o&&(this._next=o,o._prev=this)}),ge=function(e,t,i,r,n,o){var s=new me(e,t,i,r-i,n,-1,o);return s.b=i,s.e=s.xs0=r,s},ve=a.parseComplex=function(e,t,i,r,n,o,s,a,l,h){i=i||o||"",s=new me(e,t,0,0,s,h?2:1,null,!1,a,i,r),r+="";var c,f,d,p,m,g,_,b,x,T,E,S,M=i.split(", ").join(",").split(" "),A=r.split(", ").join(",").split(" "),P=M.length,C=!1!==u;for((-1!==r.indexOf(",")||-1!==i.indexOf(","))&&(M=M.join(" ").replace(O,", ").split(" "),A=A.join(" ").replace(O,", ").split(" "),P=M.length),P!==A.length&&(M=(o||"").split(" "),P=M.length),s.plugin=l,s.setRatio=h,c=0;P>c;c++)if(p=M[c],m=A[c],(b=parseFloat(p))||0===b)s.appendXtra("",b,oe(m,b),m.replace(y,""),C&&-1!==m.indexOf("px"),!0);else if(n&&("#"===p.charAt(0)||le[p]||w.test(p)))S=","===m.charAt(m.length-1)?"),":")",p=ce(p),m=ce(m),x=p.length+m.length>6,x&&!H&&0===m[3]?(s["xs"+s.l]+=s.l?" transparent":"transparent",s.e=s.e.split(A[c]).join("transparent")):(H||(x=!1),s.appendXtra(x?"rgba(":"rgb(",p[0],m[0]-p[0],",",!0,!0).appendXtra("",p[1],m[1]-p[1],",",!0).appendXtra("",p[2],m[2]-p[2],x?",":S,!0),x&&(p=4>p.length?1:p[3],s.appendXtra("",p,(4>m.length?1:m[3])-p,S,!1)));else if(g=p.match(v)){if(!(_=m.match(y))||_.length!==g.length)return s;for(d=0,f=0;g.length>f;f++)E=g[f],T=p.indexOf(E,d),s.appendXtra(p.substr(d,T-d),Number(E),oe(_[f],E),"",C&&"px"===p.substr(T+E.length,2),0===f),d=T+E.length;s["xs"+s.l]+=p.substr(d)}else s["xs"+s.l]+=s.l?" "+p:p;if(-1!==r.indexOf("=")&&s.data){for(S=s.xs0+s.data.s,c=1;s.l>c;c++)S+=s["xs"+c]+s.data["xn"+c];s.e=S+s["xs"+c]}return s.l||(s.type=-1,s.xs0=s.e),s.xfirst||s},ye=9;for(c=me.prototype,c.l=c.pr=0;--ye>0;)c["xn"+ye]=0,c["xs"+ye]="";c.xs0="",c._next=c._prev=c.xfirst=c.data=c.plugin=c.setRatio=c.rxp=null,c.appendXtra=function(e,t,i,r,n,o){var s=this,a=s.l;return s["xs"+a]+=o&&a?" "+e:e||"",i||0===a||s.plugin?(s.l++,s.type=s.setRatio?2:1,s["xs"+s.l]=r||"",a>0?(s.data["xn"+a]=t+i,s.rxp["xn"+a]=n,s["xn"+a]=t,s.plugin||(s.xfirst=new me(s,"xn"+a,t,i,s.xfirst||s,0,s.n,n,s.pr),s.xfirst.xs0=0),s):(s.data={s:t+i},s.rxp={},s.s=t,s.c=i,s.r=n,s)):(s["xs"+a]+=t+(r||""),s)};var _e=function(e,t){t=t||{},this.p=t.prefix?K(e)||e:e,h[e]=h[this.p]=this,this.format=t.formatter||fe(t.defaultValue,t.color,t.collapsible,t.multi),t.parser&&(this.parse=t.parser),this.clrs=t.color,this.multi=t.multi,this.keyword=t.keyword,this.dflt=t.defaultValue,this.pr=t.priority||0},be=z._registerComplexSpecialProp=function(e,t,i){"object"!=typeof t&&(t={parser:i});var r,n=e.split(","),o=t.defaultValue;for(i=i||[o],r=0;n.length>r;r++)t.prefix=0===r&&t.prefix,t.defaultValue=i[r]||o,new _e(n[r],t)};c=_e.prototype,c.parseComplex=function(e,t,i,r,n,o){var s,a,l,h,c,u,f=this.keyword;if(this.multi&&(O.test(i)||O.test(t)?(a=t.replace(O,"|").split("|"),l=i.replace(O,"|").split("|")):f&&(a=[t],l=[i])),l){for(h=l.length>a.length?l.length:a.length,s=0;h>s;s++)t=a[s]=a[s]||this.dflt,i=l[s]=l[s]||this.dflt,f&&(c=t.indexOf(f),u=i.indexOf(f),c!==u&&(-1===u?a[s]=a[s].split(f).join(""):-1===c&&(a[s]+=" "+f)));t=a.join(", "),i=l.join(", ")}return ve(e,this.p,t,i,this.clrs,this.dflt,r,this.pr,n,o)},c.parse=function(e,t,i,r,o,s){return this.parseComplex(e.style,this.format(Q(e,this.p,n,!1,this.dflt)),this.format(t),o,s)},a.registerSpecialProp=function(e,t,i){be(e,{parser:function(e,r,n,o,s,a){var l=new me(e,n,0,0,s,2,n,!1,i);return l.plugin=a,l.setRatio=t(e,r,o._tween,n),l},priority:i})},a.useSVGTransformAttr=d||p;var xe,Te="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Ee=K("transform"),Se=X+"transform",we=K("transformOrigin"),Me=null!==K("perspective"),Ae=z.Transform=function(){this.perspective=parseFloat(a.defaultTransformPerspective)||0,this.force3D=!(!1===a.defaultForce3D||!Me)&&(a.defaultForce3D||"auto")},Pe=window.SVGElement,Ce=function(e,t,i){var r,n=N.createElementNS("http://www.w3.org/2000/svg",e),o=/([a-z])([A-Z])/g;for(r in i)n.setAttributeNS(null,r.replace(o,"$1-$2").toLowerCase(),i[r]);return t.appendChild(n),n},Re=N.documentElement,De=function(){var e,t,i,r=g||/Android/i.test(G)&&!window.chrome;return N.createElementNS&&!r&&(e=Ce("svg",Re),t=Ce("rect",e,{width:100,height:50,x:100}),i=t.getBoundingClientRect().width,t.style[we]="50% 50%",t.style[Ee]="scaleX(0.5)",r=i===t.getBoundingClientRect().width&&!(p&&Me),Re.removeChild(e)),r}(),Ie=function(e,t,i,r,n){var o,s,l,h,c,u,f,d,p,m,g,v,y,_,b=e._gsTransform,x=Le(e,!0);b&&(y=b.xOrigin,_=b.yOrigin),(!r||2>(o=r.split(" ")).length)&&(f=e.getBBox(),t=ne(t).split(" "),o=[(-1!==t[0].indexOf("%")?parseFloat(t[0])/100*f.width:parseFloat(t[0]))+f.x,(-1!==t[1].indexOf("%")?parseFloat(t[1])/100*f.height:parseFloat(t[1]))+f.y]),i.xOrigin=h=parseFloat(o[0]),i.yOrigin=c=parseFloat(o[1]),r&&x!==Fe&&(u=x[0],f=x[1],d=x[2],p=x[3],m=x[4],g=x[5],v=u*p-f*d,s=h*(p/v)+c*(-d/v)+(d*g-p*m)/v,l=h*(-f/v)+c*(u/v)-(u*g-f*m)/v,h=i.xOrigin=o[0]=s,c=i.yOrigin=o[1]=l),b&&(n||!1!==n&&!1!==a.defaultSmoothOrigin?(s=h-y,l=c-_,b.xOffset+=s*x[0]+l*x[2]-s,b.yOffset+=s*x[1]+l*x[3]-l):b.xOffset=b.yOffset=0),e.setAttribute("data-svg-origin",o.join(" "))},Oe=function(e){return!!(Pe&&"function"==typeof e.getBBox&&e.getCTM&&(!e.parentNode||e.parentNode.getBBox&&e.parentNode.getCTM))},Fe=[1,0,0,1,0,0],Le=function(e,t){var i,r,n,o,s,a=e._gsTransform||new Ae;if(Ee?r=Q(e,Se,null,!0):e.currentStyle&&(r=e.currentStyle.filter.match(D),r=r&&4===r.length?[r[0].substr(4),Number(r[2].substr(4)),Number(r[1].substr(4)),r[3].substr(4),a.x||0,a.y||0].join(","):""),i=!r||"none"===r||"matrix(1, 0, 0, 1, 0, 0)"===r,(a.svg||e.getBBox&&Oe(e))&&(i&&-1!==(e.style[Ee]+"").indexOf("matrix")&&(r=e.style[Ee],i=0),n=e.getAttribute("transform"),i&&n&&(-1!==n.indexOf("matrix")?(r=n,i=0):-1!==n.indexOf("translate")&&(r="matrix(1,0,0,1,"+n.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",i=0))),i)return Fe;for(n=(r||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],ye=n.length;--ye>-1;)o=Number(n[ye]),n[ye]=(s=o-(o|=0))?(0|1e5*s+(0>s?-.5:.5))/1e5+o:o;return t&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n},Be=z.getTransform=function(e,i,r,o){if(e._gsTransform&&r&&!o)return e._gsTransform;var s,l,h,c,u,f,d=r?e._gsTransform||new Ae:new Ae,p=0>d.scaleX,m=1e5,g=Me?parseFloat(Q(e,we,i,!1,"0 0 0").split(" ")[2])||d.zOrigin||0:0,v=parseFloat(a.defaultTransformPerspective)||0;if(d.svg=!(!e.getBBox||!Oe(e)),d.svg&&(Ie(e,Q(e,we,n,!1,"50% 50%")+"",d,e.getAttribute("data-svg-origin")),xe=a.useSVGTransformAttr||De),(s=Le(e))!==Fe){if(16===s.length){var y,_,b,x,T,E=s[0],S=s[1],w=s[2],M=s[3],A=s[4],P=s[5],C=s[6],R=s[7],D=s[8],I=s[9],O=s[10],F=s[12],B=s[13],N=s[14],k=s[11],V=Math.atan2(C,O);d.zOrigin&&(N=-d.zOrigin,F=D*N-s[12],B=I*N-s[13],N=O*N+d.zOrigin-s[14]),d.rotationX=V*L,V&&(x=Math.cos(-V),T=Math.sin(-V),y=A*x+D*T,_=P*x+I*T,b=C*x+O*T,D=A*-T+D*x,I=P*-T+I*x,O=C*-T+O*x,k=R*-T+k*x,A=y,P=_,C=b),V=Math.atan2(D,O),d.rotationY=V*L,V&&(x=Math.cos(-V),T=Math.sin(-V),y=E*x-D*T,_=S*x-I*T,b=w*x-O*T,I=S*T+I*x,O=w*T+O*x,k=M*T+k*x,E=y,S=_,w=b),V=Math.atan2(S,E),d.rotation=V*L,V&&(x=Math.cos(-V),T=Math.sin(-V),E=E*x+A*T,_=S*x+P*T,P=S*-T+P*x,C=w*-T+C*x,S=_),d.rotationX&&Math.abs(d.rotationX)+Math.abs(d.rotation)>359.9&&(d.rotationX=d.rotation=0,d.rotationY+=180),d.scaleX=(0|Math.sqrt(E*E+S*S)*m+.5)/m,d.scaleY=(0|Math.sqrt(P*P+I*I)*m+.5)/m,d.scaleZ=(0|Math.sqrt(C*C+O*O)*m+.5)/m,d.skewX=0,d.perspective=k?1/(0>k?-k:k):0,d.x=F,d.y=B,d.z=N,d.svg&&(d.x-=d.xOrigin-(d.xOrigin*E-d.yOrigin*A),d.y-=d.yOrigin-(d.yOrigin*S-d.xOrigin*P))}else if(!(Me&&!o&&s.length&&d.x===s[4]&&d.y===s[5]&&(d.rotationX||d.rotationY)||void 0!==d.x&&"none"===Q(e,"display",i))){var U=s.length>=6,z=U?s[0]:1,G=s[1]||0,H=s[2]||0,j=U?s[3]:1;d.x=s[4]||0,d.y=s[5]||0,h=Math.sqrt(z*z+G*G),c=Math.sqrt(j*j+H*H),u=z||G?Math.atan2(G,z)*L:d.rotation||0,f=H||j?Math.atan2(H,j)*L+u:d.skewX||0,Math.abs(f)>90&&270>Math.abs(f)&&(p?(h*=-1,f+=0>=u?180:-180,u+=0>=u?180:-180):(c*=-1,f+=0>=f?180:-180)),d.scaleX=h,d.scaleY=c,d.rotation=u,d.skewX=f,Me&&(d.rotationX=d.rotationY=d.z=0,d.perspective=v,d.scaleZ=1),d.svg&&(d.x-=d.xOrigin-(d.xOrigin*z+d.yOrigin*H),d.y-=d.yOrigin-(d.xOrigin*G+d.yOrigin*j))}d.zOrigin=g;for(l in d)2e-5>d[l]&&d[l]>-2e-5&&(d[l]=0)}return r&&(e._gsTransform=d,d.svg&&(xe&&e.style[Ee]?t.delayedCall(.001,function(){Ue(e.style,Ee)}):!xe&&e.getAttribute("transform")&&t.delayedCall(.001,function(){e.removeAttribute("transform")}))),d},Ne=function(e){var t,i,r=this.data,n=-r.rotation*F,o=n+r.skewX*F,s=1e5,a=(0|Math.cos(n)*r.scaleX*s)/s,l=(0|Math.sin(n)*r.scaleX*s)/s,h=(0|Math.sin(o)*-r.scaleY*s)/s,c=(0|Math.cos(o)*r.scaleY*s)/s,u=this.t.style,f=this.t.currentStyle;if(f){i=l,l=-h,h=-i,t=f.filter,u.filter="";var d,p,m=this.t.offsetWidth,v=this.t.offsetHeight,y="absolute"!==f.position,_="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+l+", M21="+h+", M22="+c,b=r.x+m*r.xPercent/100,E=r.y+v*r.yPercent/100;if(null!=r.ox&&(d=(r.oxp?.01*m*r.ox:r.ox)-m/2,p=(r.oyp?.01*v*r.oy:r.oy)-v/2,b+=d-(d*a+p*l),E+=p-(d*h+p*c)),y?(d=m/2,p=v/2,_+=", Dx="+(d-(d*a+p*l)+b)+", Dy="+(p-(d*h+p*c)+E)+")"):_+=", sizingMethod='auto expand')",u.filter=-1!==t.indexOf("DXImageTransform.Microsoft.Matrix(")?t.replace(I,_):_+" "+t,(0===e||1===e)&&1===a&&0===l&&0===h&&1===c&&(y&&-1===_.indexOf("Dx=0, Dy=0")||T.test(t)&&100!==parseFloat(RegExp.$1)||-1===t.indexOf(t.indexOf("Alpha"))&&u.removeAttribute("filter")),!y){var S,w,M,A=8>g?1:-1;for(d=r.ieOffsetX||0,p=r.ieOffsetY||0,r.ieOffsetX=Math.round((m-((0>a?-a:a)*m+(0>l?-l:l)*v))/2+b),r.ieOffsetY=Math.round((v-((0>c?-c:c)*v+(0>h?-h:h)*m))/2+E),ye=0;4>ye;ye++)w=ie[ye],S=f[w],i=-1!==S.indexOf("px")?parseFloat(S):Z(this.t,w,parseFloat(S),S.replace(x,""))||0,M=i!==r[w]?2>ye?-r.ieOffsetX:-r.ieOffsetY:2>ye?d-r.ieOffsetX:p-r.ieOffsetY,u[w]=(r[w]=Math.round(i-M*(0===ye||2===ye?1:A)))+"px"}}},ke=z.set3DTransformRatio=z.setTransformRatio=function(e){var t,i,r,n,o,s,a,l,h,c,u,f,d,m,g,v,y,_,b,x,T,E,S,w=this.data,M=this.t.style,A=w.rotation,P=w.rotationX,C=w.rotationY,R=w.scaleX,D=w.scaleY,I=w.scaleZ,O=w.x,L=w.y,B=w.z,N=w.svg,k=w.perspective,V=w.force3D;if(!((1!==e&&0!==e||"auto"!==V||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&V||B||k||C||P)||xe&&N||!Me)return void(A||w.skewX||N?(A*=F,E=w.skewX*F,S=1e5,t=Math.cos(A)*R,n=Math.sin(A)*R,i=Math.sin(A-E)*-D,o=Math.cos(A-E)*D,E&&"simple"===w.skewType&&(y=Math.tan(E),y=Math.sqrt(1+y*y),i*=y,o*=y,w.skewY&&(t*=y,n*=y)),N&&(O+=w.xOrigin-(w.xOrigin*t+w.yOrigin*i)+w.xOffset,L+=w.yOrigin-(w.xOrigin*n+w.yOrigin*o)+w.yOffset,xe&&(w.xPercent||w.yPercent)&&(m=this.t.getBBox(),O+=.01*w.xPercent*m.width,L+=.01*w.yPercent*m.height),m=1e-6,m>O&&O>-m&&(O=0),m>L&&L>-m&&(L=0)),b=(0|t*S)/S+","+(0|n*S)/S+","+(0|i*S)/S+","+(0|o*S)/S+","+O+","+L+")",N&&xe?this.t.setAttribute("transform","matrix("+b):M[Ee]=(w.xPercent||w.yPercent?"translate("+w.xPercent+"%,"+w.yPercent+"%) matrix(":"matrix(")+b):M[Ee]=(w.xPercent||w.yPercent?"translate("+w.xPercent+"%,"+w.yPercent+"%) matrix(":"matrix(")+R+",0,0,"+D+","+O+","+L+")");if(p&&(m=1e-4,m>R&&R>-m&&(R=I=2e-5),m>D&&D>-m&&(D=I=2e-5),!k||w.z||w.rotationX||w.rotationY||(k=0)),A||w.skewX)A*=F,g=t=Math.cos(A),v=n=Math.sin(A),w.skewX&&(A-=w.skewX*F,g=Math.cos(A),v=Math.sin(A),"simple"===w.skewType&&(y=Math.tan(w.skewX*F),y=Math.sqrt(1+y*y),g*=y,v*=y,w.skewY&&(t*=y,n*=y))),i=-v,o=g;else{if(!(C||P||1!==I||k||N))return void(M[Ee]=(w.xPercent||w.yPercent?"translate("+w.xPercent+"%,"+w.yPercent+"%) translate3d(":"translate3d(")+O+"px,"+L+"px,"+B+"px)"+(1!==R||1!==D?" scale("+R+","+D+")":""));t=o=1,i=n=0}h=1,r=s=a=l=c=u=0,f=k?-1/k:0,d=w.zOrigin,m=1e-6,x=",",T="0",A=C*F,A&&(g=Math.cos(A),v=Math.sin(A),a=-v,c=f*-v,r=t*v,s=n*v,h=g,f*=g,t*=g,n*=g),A=P*F,A&&(g=Math.cos(A),v=Math.sin(A),y=i*g+r*v,_=o*g+s*v,l=h*v,u=f*v,r=i*-v+r*g,s=o*-v+s*g,h*=g,f*=g,i=y,o=_),1!==I&&(r*=I,s*=I,h*=I,f*=I),1!==D&&(i*=D,o*=D,l*=D,u*=D),1!==R&&(t*=R,n*=R,a*=R,c*=R),(d||N)&&(d&&(O+=r*-d,L+=s*-d,B+=h*-d+d),N&&(O+=w.xOrigin-(w.xOrigin*t+w.yOrigin*i)+w.xOffset,L+=w.yOrigin-(w.xOrigin*n+w.yOrigin*o)+w.yOffset),m>O&&O>-m&&(O=T),m>L&&L>-m&&(L=T),m>B&&B>-m&&(B=0)),b=w.xPercent||w.yPercent?"translate("+w.xPercent+"%,"+w.yPercent+"%) matrix3d(":"matrix3d(",b+=(m>t&&t>-m?T:t)+x+(m>n&&n>-m?T:n)+x+(m>a&&a>-m?T:a),b+=x+(m>c&&c>-m?T:c)+x+(m>i&&i>-m?T:i)+x+(m>o&&o>-m?T:o),P||C?(b+=x+(m>l&&l>-m?T:l)+x+(m>u&&u>-m?T:u)+x+(m>r&&r>-m?T:r),b+=x+(m>s&&s>-m?T:s)+x+(m>h&&h>-m?T:h)+x+(m>f&&f>-m?T:f)+x):b+=",0,0,0,0,1,0,",b+=O+x+L+x+B+x+(k?1+-B/k:1)+")",M[Ee]=b};c=Ae.prototype,c.x=c.y=c.z=c.skewX=c.skewY=c.rotation=c.rotationX=c.rotationY=c.zOrigin=c.xPercent=c.yPercent=c.xOffset=c.yOffset=0,c.scaleX=c.scaleY=c.scaleZ=1,be("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(e,t,i,r,o,s,l){if(r._lastParsedTransform===l)return o;r._lastParsedTransform=l;var h,c,u,f,d,p,m,g,v,y=e._gsTransform,_=r._transform=Be(e,n,!0,l.parseTransform),b=e.style,x=Te.length,T=l,E={},S="transformOrigin";if("string"==typeof T.transform&&Ee)u=V.style,u[Ee]=T.transform,u.display="block",u.position="absolute",N.body.appendChild(V),h=Be(V,null,!1),N.body.removeChild(V),null!=T.xPercent&&(h.xPercent=se(T.xPercent,_.xPercent)),null!=T.yPercent&&(h.yPercent=se(T.yPercent,_.yPercent));else if("object"==typeof T){if(h={scaleX:se(null!=T.scaleX?T.scaleX:T.scale,_.scaleX),scaleY:se(null!=T.scaleY?T.scaleY:T.scale,_.scaleY),scaleZ:se(T.scaleZ,_.scaleZ),x:se(T.x,_.x),y:se(T.y,_.y),z:se(T.z,_.z),xPercent:se(T.xPercent,_.xPercent),yPercent:se(T.yPercent,_.yPercent),perspective:se(T.transformPerspective,_.perspective)},null!=(m=T.directionalRotation))if("object"==typeof m)for(u in m)T[u]=m[u];else T.rotation=m;"string"==typeof T.x&&-1!==T.x.indexOf("%")&&(h.x=0,h.xPercent=se(T.x,_.xPercent)),"string"==typeof T.y&&-1!==T.y.indexOf("%")&&(h.y=0,h.yPercent=se(T.y,_.yPercent)),h.rotation=ae("rotation"in T?T.rotation:"shortRotation"in T?T.shortRotation+"_short":"rotationZ"in T?T.rotationZ:_.rotation,_.rotation,"rotation",E),Me&&(h.rotationX=ae("rotationX"in T?T.rotationX:"shortRotationX"in T?T.shortRotationX+"_short":_.rotationX||0,_.rotationX,"rotationX",E),h.rotationY=ae("rotationY"in T?T.rotationY:"shortRotationY"in T?T.shortRotationY+"_short":_.rotationY||0,_.rotationY,"rotationY",E)),h.skewX=null==T.skewX?_.skewX:ae(T.skewX,_.skewX),h.skewY=null==T.skewY?_.skewY:ae(T.skewY,_.skewY),(c=h.skewY-_.skewY)&&(h.skewX+=c,h.rotation+=c)}for(Me&&null!=T.force3D&&(_.force3D=T.force3D,p=!0),_.skewType=T.skewType||_.skewType||a.defaultSkewType,(d=_.force3D||_.z||_.rotationX||_.rotationY||h.z||h.rotationX||h.rotationY||h.perspective)||null==T.scale||(h.scaleZ=1);--x>-1;)i=Te[x],((f=h[i]-_[i])>1e-6||-1e-6>f||null!=T[i]||null!=B[i])&&(p=!0,o=new me(_,i,_[i],f,o),i in E&&(o.e=E[i]),o.xs0=0,o.plugin=s,r._overwriteProps.push(o.n));return f=T.transformOrigin,_.svg&&(f||T.svgOrigin)&&(g=_.xOffset,v=_.yOffset,Ie(e,ne(f),h,T.svgOrigin,T.smoothOrigin),o=ge(_,"xOrigin",(y?_:h).xOrigin,h.xOrigin,o,S),o=ge(_,"yOrigin",(y?_:h).yOrigin,h.yOrigin,o,S),(g!==_.xOffset||v!==_.yOffset)&&(o=ge(_,"xOffset",y?g:_.xOffset,_.xOffset,o,S),o=ge(_,"yOffset",y?v:_.yOffset,_.yOffset,o,S)),f=xe?null:"0px 0px"),(f||Me&&d&&_.zOrigin)&&(Ee?(p=!0,i=we,f=(f||Q(e,i,n,!1,"50% 50%"))+"",o=new me(b,i,0,0,o,-1,S),o.b=b[i],o.plugin=s,Me?(u=_.zOrigin,f=f.split(" "),_.zOrigin=(f.length>2&&(0===u||"0px"!==f[2])?parseFloat(f[2]):u)||0,o.xs0=o.e=f[0]+" "+(f[1]||"50%")+" 0px",o=new me(_,"zOrigin",0,0,o,-1,o.n),o.b=u,o.xs0=o.e=_.zOrigin):o.xs0=o.e=f):ne(f+"",_)),p&&(r._transformType=_.svg&&xe||!d&&3!==this._transformType?2:3),o},prefix:!0}),be("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),be("borderRadius",{defaultValue:"0px",parser:function(e,t,i,o,s){t=this.format(t);var a,l,h,c,u,f,d,p,m,g,v,y,_,b,x,T,E=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],S=e.style;for(m=parseFloat(e.offsetWidth),g=parseFloat(e.offsetHeight),a=t.split(" "),l=0;E.length>l;l++)this.p.indexOf("border")&&(E[l]=K(E[l])),u=c=Q(e,E[l],n,!1,"0px"),-1!==u.indexOf(" ")&&(c=u.split(" "),u=c[0],c=c[1]),f=h=a[l],d=parseFloat(u),y=u.substr((d+"").length),_="="===f.charAt(1),_?(p=parseInt(f.charAt(0)+"1",10),f=f.substr(2),p*=parseFloat(f),v=f.substr((p+"").length-(0>p?1:0))||""):(p=parseFloat(f),v=f.substr((p+"").length)),""===v&&(v=r[i]||y),v!==y&&(b=Z(e,"borderLeft",d,y),x=Z(e,"borderTop",d,y),"%"===v?(u=b/m*100+"%",c=x/g*100+"%"):"em"===v?(T=Z(e,"borderLeft",1,"em"),u=b/T+"em",c=x/T+"em"):(u=b+"px",c=x+"px"),_&&(f=parseFloat(u)+p+v,h=parseFloat(c)+p+v)),s=ve(S,E[l],u+" "+c,f+" "+h,!1,"0px",s);return s},prefix:!0,formatter:fe("0px 0px 0px 0px",!1,!0)}),be("backgroundPosition",{defaultValue:"0 0",parser:function(e,t,i,r,o,s){var a,l,h,c,u,f,d="background-position",p=n||q(e,null),m=this.format((p?g?p.getPropertyValue(d+"-x")+" "+p.getPropertyValue(d+"-y"):p.getPropertyValue(d):e.currentStyle.backgroundPositionX+" "+e.currentStyle.backgroundPositionY)||"0 0"),v=this.format(t);if(-1!==m.indexOf("%")!=(-1!==v.indexOf("%"))&&(f=Q(e,"backgroundImage").replace(P,""))&&"none"!==f){for(a=m.split(" "),l=v.split(" "),U.setAttribute("src",f),h=2;--h>-1;)m=a[h],(c=-1!==m.indexOf("%"))!==(-1!==l[h].indexOf("%"))&&(u=0===h?e.offsetWidth-U.width:e.offsetHeight-U.height,a[h]=c?parseFloat(m)/100*u+"px":parseFloat(m)/u*100+"%");m=a.join(" ")}return this.parseComplex(e.style,m,v,o,s)},formatter:ne}),be("backgroundSize",{defaultValue:"0 0",formatter:ne}),be("perspective",{defaultValue:"0px",prefix:!0}),be("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),be("transformStyle",{prefix:!0}),be("backfaceVisibility",{prefix:!0}),be("userSelect",{prefix:!0}),be("margin",{parser:de("marginTop,marginRight,marginBottom,marginLeft")}),be("padding",{parser:de("paddingTop,paddingRight,paddingBottom,paddingLeft")}),be("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(e,t,i,r,o,s){var a,l,h;return 9>g?(l=e.currentStyle,h=8>g?" ":",",a="rect("+l.clipTop+h+l.clipRight+h+l.clipBottom+h+l.clipLeft+")",t=this.format(t).split(",").join(h)):(a=this.format(Q(e,this.p,n,!1,this.dflt)),t=this.format(t)),this.parseComplex(e.style,a,t,o,s)}}),be("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),be("autoRound,strictUnits",{parser:function(e,t,i,r,n){return n}}),be("border",{defaultValue:"0px solid #000",parser:function(e,t,i,r,o,s){return this.parseComplex(e.style,this.format(Q(e,"borderTopWidth",n,!1,"0px")+" "+Q(e,"borderTopStyle",n,!1,"solid")+" "+Q(e,"borderTopColor",n,!1,"#000")),this.format(t),o,s)},color:!0,formatter:function(e){var t=e.split(" ");return t[0]+" "+(t[1]||"solid")+" "+(e.match(ue)||["#000"])[0]}}),be("borderWidth",{parser:de("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),be("float,cssFloat,styleFloat",{parser:function(e,t,i,r,n){var o=e.style,s="cssFloat"in o?"cssFloat":"styleFloat";return new me(o,s,0,0,n,-1,i,!1,0,o[s],t)}});var Ve=function(e){var t,i=this.t,r=i.filter||Q(this.data,"filter")||"",n=0|this.s+this.c*e;100===n&&(-1===r.indexOf("atrix(")&&-1===r.indexOf("radient(")&&-1===r.indexOf("oader(")?(i.removeAttribute("filter"),t=!Q(this.data,"filter")):(i.filter=r.replace(S,""),t=!0)),t||(this.xn1&&(i.filter=r=r||"alpha(opacity="+n+")"),-1===r.indexOf("pacity")?0===n&&this.xn1||(i.filter=r+" alpha(opacity="+n+")"):i.filter=r.replace(T,"opacity="+n))};be("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(e,t,i,r,o,s){var a=parseFloat(Q(e,"opacity",n,!1,"1")),l=e.style,h="autoAlpha"===i;return"string"==typeof t&&"="===t.charAt(1)&&(t=("-"===t.charAt(0)?-1:1)*parseFloat(t.substr(2))+a),h&&1===a&&"hidden"===Q(e,"visibility",n)&&0!==t&&(a=0),H?o=new me(l,"opacity",a,t-a,o):(o=new me(l,"opacity",100*a,100*(t-a),o),o.xn1=h?1:0,l.zoom=1,o.type=2,o.b="alpha(opacity="+o.s+")",o.e="alpha(opacity="+(o.s+o.c)+")",o.data=e,o.plugin=s,o.setRatio=Ve),h&&(o=new me(l,"visibility",0,0,o,-1,null,!1,0,0!==a?"inherit":"hidden",0===t?"hidden":"inherit"),o.xs0="inherit",r._overwriteProps.push(o.n),r._overwriteProps.push(i)),o}});var Ue=function(e,t){t&&(e.removeProperty?(("ms"===t.substr(0,2)||"webkit"===t.substr(0,6))&&(t="-"+t),e.removeProperty(t.replace(M,"-$1").toLowerCase())):e.removeAttribute(t))},ze=function(e){if(this.t._gsClassPT=this,1===e||0===e){this.t.setAttribute("class",0===e?this.b:this.e);for(var t=this.data,i=this.t.style;t;)t.v?i[t.p]=t.v:Ue(i,t.p),t=t._next;1===e&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};be("className",{parser:function(e,t,r,o,s,a,l){var h,c,u,f,d,p=e.getAttribute("class")||"",m=e.style.cssText;if(s=o._classNamePT=new me(e,r,0,0,s,2),s.setRatio=ze,s.pr=-11,i=!0,s.b=p,c=$(e,n),u=e._gsClassPT){for(f={},d=u.data;d;)f[d.p]=1,d=d._next;u.setRatio(1)}return e._gsClassPT=s,s.e="="!==t.charAt(1)?t:p.replace(RegExp("\\s*\\b"+t.substr(2)+"\\b"),"")+("+"===t.charAt(0)?" "+t.substr(2):""),e.setAttribute("class",s.e),h=ee(e,c,$(e),l,f),e.setAttribute("class",p),s.data=h.firstMPT,e.style.cssText=m,s=s.xfirst=o.parse(e,h.difs,s,a)}});var Ge=function(e){if((1===e||0===e)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var t,i,r,n,o,s=this.t.style,a=h.transform.parse;if("all"===this.e)s.cssText="",n=!0;else for(t=this.e.split(" ").join("").split(","),r=t.length;--r>-1;)i=t[r],h[i]&&(h[i].parse===a?n=!0:i="transformOrigin"===i?we:h[i].p),Ue(s,i);n&&(Ue(s,Ee),(o=this.t._gsTransform)&&(o.svg&&this.t.removeAttribute("data-svg-origin"),delete this.t._gsTransform))}};for(be("clearProps",{parser:function(e,t,r,n,o){return o=new me(e,r,0,0,o,2),o.setRatio=Ge,o.e=t,o.pr=-10,o.data=n._tween,i=!0,o}}),c="bezier,throwProps,physicsProps,physics2D".split(","),ye=c.length;ye--;)!function(e){if(!h[e]){var t=e.charAt(0).toUpperCase()+e.substr(1)+"Plugin";be(e,{parser:function(e,i,r,n,o,s,a){var c=l.com.greensock.plugins[t];return c?(c._cssRegister(),h[r].parse(e,i,r,n,o,s,a)):(W("Error: "+t+" js file not loaded."),o)}})}}(c[ye]);c=a.prototype,c._firstPT=c._lastParsedTransform=c._transform=null,c._onInitTween=function(e,t,o){if(!e.nodeType)return!1;this._target=e,this._tween=o,this._vars=t,u=t.autoRound,i=!1,r=t.suffixMap||a.suffixMap,n=q(e,""),s=this._overwriteProps;var l,c,p,g,v,y,_,b,x,T=e.style;if(f&&""===T.zIndex&&("auto"===(l=Q(e,"zIndex",n))||""===l)&&this._addLazySet(T,"zIndex",0),"string"==typeof t&&(g=T.cssText,l=$(e,n),T.cssText=g+";"+t,l=ee(e,l,$(e)).difs,!H&&E.test(t)&&(l.opacity=parseFloat(RegExp.$1)),t=l,T.cssText=g),this._firstPT=c=t.className?h.className.parse(e,t.className,"className",this,null,null,t):this.parse(e,t,null),this._transformType){for(x=3===this._transformType,Ee?d&&(f=!0,""===T.zIndex&&("auto"===(_=Q(e,"zIndex",n))||""===_)&&this._addLazySet(T,"zIndex",0),m&&this._addLazySet(T,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(x?"visible":"hidden"))):T.zoom=1,p=c;p&&p._next;)p=p._next;b=new me(e,"transform",0,0,null,2),this._linkCSSP(b,null,p),b.setRatio=Ee?ke:Ne,b.data=this._transform||Be(e,n,!0),b.tween=o,b.pr=-1,s.pop()}if(i){for(;c;){for(y=c._next,p=g;p&&p.pr>c.pr;)p=p._next;(c._prev=p?p._prev:v)?c._prev._next=c:g=c,(c._next=p)?p._prev=c:v=c,c=y}this._firstPT=g}return!0},c.parse=function(e,t,i,o){var s,a,l,c,f,d,p,m,g,v,y=e.style;for(s in t)d=t[s],a=h[s],a?i=a.parse(e,d,s,this,i,o,t):(f=Q(e,s,n)+"",g="string"==typeof d,"color"===s||"fill"===s||"stroke"===s||-1!==s.indexOf("Color")||g&&w.test(d)?(g||(d=ce(d),d=(d.length>3?"rgba(":"rgb(")+d.join(",")+")"),i=ve(y,s,f,d,!0,"transparent",i,0,o)):!g||-1===d.indexOf(" ")&&-1===d.indexOf(",")?(l=parseFloat(f),p=l||0===l?f.substr((l+"").length):"",(""===f||"auto"===f)&&("width"===s||"height"===s?(l=re(e,s,n),p="px"):"left"===s||"top"===s?(l=J(e,s,n),p="px"):(l="opacity"!==s?0:1,p="")),v=g&&"="===d.charAt(1),v?(c=parseInt(d.charAt(0)+"1",10),d=d.substr(2),c*=parseFloat(d),m=d.replace(x,"")):(c=parseFloat(d),m=g?d.replace(x,""):""),""===m&&(m=s in r?r[s]:p),d=c||0===c?(v?c+l:c)+m:t[s],p!==m&&""!==m&&(c||0===c)&&l&&(l=Z(e,s,l,p),"%"===m?(l/=Z(e,s,100,"%")/100,!0!==t.strictUnits&&(f=l+"%")):"em"===m?l/=Z(e,s,1,"em"):"px"!==m&&(c=Z(e,s,c,m),m="px"),v&&(c||0===c)&&(d=c+l+m)),v&&(c+=l),!l&&0!==l||!c&&0!==c?void 0!==y[s]&&(d||"NaN"!=d+""&&null!=d)?(i=new me(y,s,c||l||0,0,i,-1,s,!1,0,f,d),i.xs0="none"!==d||"display"!==s&&-1===s.indexOf("Style")?d:f):W("invalid "+s+" tween value: "+t[s]):(i=new me(y,s,l,c-l,i,0,s,!1!==u&&("px"===m||"zIndex"===s),0,f,d),i.xs0=m)):i=ve(y,s,f,d,!0,null,i,0,o)),o&&i&&!i.plugin&&(i.plugin=o);return i},c.setRatio=function(e){var t,i,r,n=this._firstPT;if(1!==e||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(e||this._tween._time!==this._tween._duration&&0!==this._tween._time||-1e-6===this._tween._rawPrevTime)for(;n;){if(t=n.c*e+n.s,n.r?t=Math.round(t):1e-6>t&&t>-1e-6&&(t=0),n.type)if(1===n.type)if(2===(r=n.l))n.t[n.p]=n.xs0+t+n.xs1+n.xn1+n.xs2;else if(3===r)n.t[n.p]=n.xs0+t+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3;else if(4===r)n.t[n.p]=n.xs0+t+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3+n.xn3+n.xs4;else if(5===r)n.t[n.p]=n.xs0+t+n.xs1+n.xn1+n.xs2+n.xn2+n.xs3+n.xn3+n.xs4+n.xn4+n.xs5;else{for(i=n.xs0+t+n.xs1,r=1;n.l>r;r++)i+=n["xn"+r]+n["xs"+(r+1)];n.t[n.p]=i}else-1===n.type?n.t[n.p]=n.xs0:n.setRatio&&n.setRatio(e);else n.t[n.p]=t+n.xs0;n=n._next}else for(;n;)2!==n.type?n.t[n.p]=n.b:n.setRatio(e),n=n._next;else for(;n;){if(2!==n.type)if(n.r&&-1!==n.type)if(t=Math.round(n.s+n.c),n.type){if(1===n.type){for(r=n.l,i=n.xs0+t+n.xs1,r=1;n.l>r;r++)i+=n["xn"+r]+n["xs"+(r+1)];n.t[n.p]=i}}else n.t[n.p]=t+n.xs0;else n.t[n.p]=n.e;else n.setRatio(e);n=n._next}},c._enableTransforms=function(e){this._transform=this._transform||Be(this._target,n,!0),this._transformType=this._transform.svg&&xe||!e&&3!==this._transformType?2:3};var He=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};c._addLazySet=function(e,t,i){var r=this._firstPT=new me(e,t,0,0,this._firstPT,2);r.e=i,r.setRatio=He,r.data=this},c._linkCSSP=function(e,t,i,r){return e&&(t&&(t._prev=e),e._next&&(e._next._prev=e._prev),e._prev?e._prev._next=e._next:this._firstPT===e&&(this._firstPT=e._next,r=!0),i?i._next=e:r||null!==this._firstPT||(this._firstPT=e),e._next=t,e._prev=i),e},c._kill=function(t){var i,r,n,o=t;if(t.autoAlpha||t.alpha){o={};for(r in t)o[r]=t[r];o.opacity=1,o.autoAlpha&&(o.visibility=1)}return t.className&&(i=this._classNamePT)&&(n=i.xfirst,n&&n._prev?this._linkCSSP(n._prev,i._next,n._prev._prev):n===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,n._prev),this._classNamePT=null),e.prototype._kill.call(this,o)};var je=function(e,t,i){var r,n,o,s;if(e.slice)for(n=e.length;--n>-1;)je(e[n],t,i);else for(r=e.childNodes,n=r.length;--n>-1;)o=r[n],s=o.type,o.style&&(t.push($(o)),i&&i.push(o)),1!==s&&9!==s&&11!==s||!o.childNodes.length||je(o,t,i)};return a.cascadeTo=function(e,i,r){var n,o,s,a,l=t.to(e,i,r),h=[l],c=[],u=[],f=[],d=t._internals.reservedProps;for(e=l._targets||l.target,je(e,c,f),l.render(i,!0,!0),je(e,u),l.render(0,!0,!0),l._enabled(!0),n=f.length;--n>-1;)if(o=ee(f[n],c[n],u[n]),o.firstMPT){o=o.difs;for(s in r)d[s]&&(o[s]=r[s]);a={};for(s in o)a[s]=c[n][s];h.push(t.fromTo(f[n],i,a,o))}return h},e.activate([a]),a},!0),function(){var e=o._gsDefine.plugin({propName:"roundProps",priority:-1,API:2,init:function(e,t,i){return this._tween=i,!0}}),t=e.prototype;t._onInitAllProps=function(){for(var e,t,i,r=this._tween,n=r.vars.roundProps instanceof Array?r.vars.roundProps:r.vars.roundProps.split(","),o=n.length,s={},a=r._propLookup.roundProps;--o>-1;)s[n[o]]=1;for(o=n.length;--o>-1;)for(e=n[o],t=r._firstPT;t;)i=t._next,t.pg?t.t._roundProps(s,!0):t.n===e&&(this._add(t.t,e,t.s,t.c),i&&(i._prev=t._prev),t._prev?t._prev._next=i:r._firstPT===t&&(r._firstPT=i),t._next=t._prev=null,r._propLookup[e]=a),t=i;return!1},t._add=function(e,t,i,r){this._addTween(e,t,i,i+r,t,!0),this._overwriteProps.push(t)}}(),function(){var e=/(?:\d|\-|\+|=|#|\.)*/g,t=/[A-Za-z%]/g;o._gsDefine.plugin({propName:"attr",API:2,version:"0.4.0",init:function(i,r){var n,o,s,a,l;if("function"!=typeof i.setAttribute)return!1;this._target=i,this._proxy={},this._start={},this._end={},this._suffix={};for(n in r)this._start[n]=this._proxy[n]=o=i.getAttribute(n)+"",this._end[n]=s=r[n]+"",this._suffix[n]=a=t.test(s)?s.replace(e,""):t.test(o)?o.replace(e,""):"",a&&-1!==(l=s.indexOf(a))&&(s=s.substr(0,l)),this._addTween(this._proxy,n,parseFloat(o),s,n)||(this._suffix[n]=""),"="===s.charAt(1)&&(this._end[n]=this._firstPT.s+this._firstPT.c+a),this._overwriteProps.push(n);return!0},set:function(e){this._super.setRatio.call(this,e);for(var t,i=this._overwriteProps,r=i.length,n=1===e?this._end:e?this._proxy:this._start,o=n===this._proxy;--r>-1;)t=i[r],this._target.setAttribute(t,n[t]+(o?this._suffix[t]:""))}})}(),o._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(e,t){"object"!=typeof t&&(t={rotation:t}),this.finals={};var i,r,n,o,s,a,l=!0===t.useRadians?2*Math.PI:360;for(i in t)"useRadians"!==i&&(a=(t[i]+"").split("_"),r=a[0],n=parseFloat("function"!=typeof e[i]?e[i]:e[i.indexOf("set")||"function"!=typeof e["get"+i.substr(3)]?i:"get"+i.substr(3)]()),o=this.finals[i]="string"==typeof r&&"="===r.charAt(1)?n+parseInt(r.charAt(0)+"1",10)*Number(r.substr(2)):Number(r)||0,s=o-n,a.length&&(r=a.join("_"),-1!==r.indexOf("short")&&(s%=l)!==s%(l/2)&&(s=0>s?s+l:s-l),-1!==r.indexOf("_cw")&&0>s?s=(s+9999999999*l)%l-(0|s/l)*l:-1!==r.indexOf("ccw")&&s>0&&(s=(s-9999999999*l)%l-(0|s/l)*l)),(s>1e-6||-1e-6>s)&&(this._addTween(e,i,n,n+s,i),this._overwriteProps.push(i)));return!0},set:function(e){var t;if(1!==e)this._super.setRatio.call(this,e);else for(t=this._firstPT;t;)t.f?t.t[t.p](this.finals[t.p]):t.t[t.p]=this.finals[t.p],t=t._next}})._autoCSS=!0,o._gsDefine("easing.Back",["easing.Ease"],function(e){var t,i,r,n=o.GreenSockGlobals||o,s=n.com.greensock,a=2*Math.PI,l=Math.PI/2,h=s._class,c=function(t,i){var r=h("easing."+t,function(){},!0),n=r.prototype=new e;return n.constructor=r,n.getRatio=i,r},u=e.register||function(){},f=function(e,t,i,r){var n=h("easing."+e,{easeOut:new t,easeIn:new i,easeInOut:new r},!0);return u(n,e),n},d=function(e,t,i){this.t=e,this.v=t,i&&(this.next=i,i.prev=this,this.c=i.v-t,this.gap=i.t-e)},p=function(t,i){var r=h("easing."+t,function(e){this._p1=e||0===e?e:1.70158,this._p2=1.525*this._p1},!0),n=r.prototype=new e;return n.constructor=r,n.getRatio=i,n.config=function(e){return new r(e)},r},m=f("Back",p("BackOut",function(e){return(e-=1)*e*((this._p1+1)*e+this._p1)+1}),p("BackIn",function(e){return e*e*((this._p1+1)*e-this._p1)}),p("BackInOut",function(e){return 1>(e*=2)?.5*e*e*((this._p2+1)*e-this._p2):.5*((e-=2)*e*((this._p2+1)*e+this._p2)+2)})),g=h("easing.SlowMo",function(e,t,i){t=t||0===t?t:.7,null==e?e=.7:e>1&&(e=1),this._p=1!==e?t:0,this._p1=(1-e)/2,this._p2=e,this._p3=this._p1+this._p2,this._calcEnd=!0===i},!0),v=g.prototype=new e;return v.constructor=g,v.getRatio=function(e){var t=e+(.5-e)*this._p;return this._p1>e?this._calcEnd?1-(e=1-e/this._p1)*e:t-(e=1-e/this._p1)*e*e*e*t:e>this._p3?this._calcEnd?1-(e=(e-this._p3)/this._p1)*e:t+(e-t)*(e=(e-this._p3)/this._p1)*e*e*e:this._calcEnd?1:t},g.ease=new g(.7,.7),v.config=g.config=function(e,t,i){return new g(e,t,i)},t=h("easing.SteppedEase",function(e){e=e||1,this._p1=1/e,this._p2=e+1},!0),v=t.prototype=new e,v.constructor=t,v.getRatio=function(e){return 0>e?e=0:e>=1&&(e=.999999999),(this._p2*e>>0)*this._p1},v.config=t.config=function(e){return new t(e)},i=h("easing.RoughEase",function(t){t=t||{};for(var i,r,n,o,s,a,l=t.taper||"none",h=[],c=0,u=0|(t.points||20),f=u,p=!1!==t.randomize,m=!0===t.clamp,g=t.template instanceof e?t.template:null,v="number"==typeof t.strength?.4*t.strength:.4;--f>-1;)i=p?Math.random():1/u*f,r=g?g.getRatio(i):i,"none"===l?n=v:"out"===l?(o=1-i,n=o*o*v):"in"===l?n=i*i*v:.5>i?(o=2*i,n=.5*o*o*v):(o=2*(1-i),n=.5*o*o*v),p?r+=Math.random()*n-.5*n:f%2?r+=.5*n:r-=.5*n,m&&(r>1?r=1:0>r&&(r=0)),h[c++]={x:i,y:r};for(h.sort(function(e,t){return e.x-t.x}),a=new d(1,1,null),f=u;--f>-1;)s=h[f],a=new d(s.x,s.y,a);this._prev=new d(0,0,0!==a.t?a:a.next)},!0),v=i.prototype=new e,v.constructor=i,v.getRatio=function(e){var t=this._prev;if(e>t.t){for(;t.next&&e>=t.t;)t=t.next;t=t.prev}else for(;t.prev&&t.t>=e;)t=t.prev;return this._prev=t,t.v+(e-t.t)/t.gap*t.c},v.config=function(e){return new i(e)},i.ease=new i,f("Bounce",c("BounceOut",function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}),c("BounceIn",function(e){return 1/2.75>(e=1-e)?1-7.5625*e*e:2/2.75>e?1-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)}),c("BounceInOut",function(e){var t=.5>e;return e=t?1-2*e:2*e-1,e=1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5})),f("Circ",c("CircOut",function(e){return Math.sqrt(1-(e-=1)*e)}),c("CircIn",function(e){return-(Math.sqrt(1-e*e)-1)}),c("CircInOut",function(e){return 1>(e*=2)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)})),r=function(t,i,r){var n=h("easing."+t,function(e,t){this._p1=e>=1?e:1,this._p2=(t||r)/(1>e?e:1),this._p3=this._p2/a*(Math.asin(1/this._p1)||0),this._p2=a/this._p2},!0),o=n.prototype=new e;return o.constructor=n,o.getRatio=i,o.config=function(e,t){return new n(e,t)},n},f("Elastic",r("ElasticOut",function(e){return this._p1*Math.pow(2,-10*e)*Math.sin((e-this._p3)*this._p2)+1},.3),r("ElasticIn",function(e){return-this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2)},.3),r("ElasticInOut",function(e){return 1>(e*=2)?-.5*this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2):.5*this._p1*Math.pow(2,-10*(e-=1))*Math.sin((e-this._p3)*this._p2)+1},.45)),f("Expo",c("ExpoOut",function(e){return 1-Math.pow(2,-10*e)}),c("ExpoIn",function(e){return Math.pow(2,10*(e-1))-.001}),c("ExpoInOut",function(e){return 1>(e*=2)?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))})),f("Sine",c("SineOut",function(e){return Math.sin(e*l)}),c("SineIn",function(e){return 1-Math.cos(e*l)}),c("SineInOut",function(e){return-.5*(Math.cos(Math.PI*e)-1)})),h("easing.EaseLookup",{find:function(t){return e.map[t]}},!0),u(n.SlowMo,"SlowMo","ease,"),u(i,"RoughEase","ease,"),u(t,"SteppedEase","ease,"),m},!0)}),o._gsDefine&&o._gsQueue.pop()(),function(i,o){"use strict";var s=i.GreenSockGlobals=i.GreenSockGlobals||i;if(!s.TweenLite){var a,l,h,c,u,f=function(e){var t,i=e.split("."),r=s;for(t=0;i.length>t;t++)r[i[t]]=r=r[i[t]]||{};return r},d=f("com.greensock"),p=1e-10,m=function(e){var t,i=[],r=e.length;for(t=0;t!==r;i.push(e[t++]));return i},g=function(){},v=function(){var e=Object.prototype.toString,t=e.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&e.call(i)===t)}}(),y={},_=function(i,o,a,l){this.sc=y[i]?y[i].sc:[],y[i]=this,this.gsClass=null,this.func=a;var h=[];this.check=function(c){for(var u,d,p,m,g=o.length,v=g;--g>-1;)(u=y[o[g]]||new _(o[g],[])).gsClass?(h[g]=u.gsClass,v--):c&&u.sc.push(this);if(0===v&&a)for(d=("com.greensock."+i).split("."),p=d.pop(),m=f(d.join("."))[p]=this.gsClass=a.apply(a,h),l&&(s[p]=m,r=[],void 0!==(n=function(){return m}.apply(t,r))&&(e.exports=n)),g=0;this.sc.length>g;g++)this.sc[g].check()},this.check(!0)},b=i._gsDefine=function(e,t,i,r){return new _(e,t,i,r)},x=d._class=function(e,t,i){return t=t||function(){},b(e,[],function(){return t},i),t};b.globals=s;var T=[0,0,1,1],E=[],S=x("easing.Ease",function(e,t,i,r){this._func=e,this._type=i||0,this._power=r||0,this._params=t?T.concat(t):T},!0),w=S.map={},M=S.register=function(e,t,i,r){for(var n,o,s,a,l=t.split(","),h=l.length,c=(i||"easeIn,easeOut,easeInOut").split(",");--h>-1;)for(o=l[h],n=r?x("easing."+o,null,!0):d.easing[o]||{},s=c.length;--s>-1;)a=c[s],w[o+"."+a]=w[a+o]=n[a]=e.getRatio?e:e[a]||new e};for(h=S.prototype,h._calcEnd=!1,h.getRatio=function(e){if(this._func)return this._params[0]=e,this._func.apply(null,this._params);var t=this._type,i=this._power,r=1===t?1-e:2===t?e:.5>e?2*e:2*(1-e);return 1===i?r*=r:2===i?r*=r*r:3===i?r*=r*r*r:4===i&&(r*=r*r*r*r),1===t?1-r:2===t?r:.5>e?r/2:1-r/2},a=["Linear","Quad","Cubic","Quart","Quint,Strong"],l=a.length;--l>-1;)h=a[l]+",Power"+l,M(new S(null,null,1,l),h,"easeOut",!0),M(new S(null,null,2,l),h,"easeIn"+(0===l?",easeNone":"")),M(new S(null,null,3,l),h,"easeInOut");w.linear=d.easing.Linear.easeIn,w.swing=d.easing.Quad.easeInOut;var A=x("events.EventDispatcher",function(e){this._listeners={},this._eventTarget=e||this});h=A.prototype,h.addEventListener=function(e,t,i,r,n){n=n||0;var o,s,a=this._listeners[e],l=0;for(null==a&&(this._listeners[e]=a=[]),s=a.length;--s>-1;)o=a[s],o.c===t&&o.s===i?a.splice(s,1):0===l&&n>o.pr&&(l=s+1);a.splice(l,0,{c:t,s:i,up:r,pr:n}),this!==c||u||c.wake()},h.removeEventListener=function(e,t){var i,r=this._listeners[e];if(r)for(i=r.length;--i>-1;)if(r[i].c===t)return void r.splice(i,1)},h.dispatchEvent=function(e){var t,i,r,n=this._listeners[e];if(n)for(t=n.length,i=this._eventTarget;--t>-1;)(r=n[t])&&(r.up?r.c.call(r.s||i,{type:e,target:i}):r.c.call(r.s||i))};var P=i.requestAnimationFrame,C=i.cancelAnimationFrame,R=Date.now||function(){return(new Date).getTime()},D=R();for(a=["ms","moz","webkit","o"],l=a.length;--l>-1&&!P;)P=i[a[l]+"RequestAnimationFrame"],C=i[a[l]+"CancelAnimationFrame"]||i[a[l]+"CancelRequestAnimationFrame"];x("Ticker",function(e,t){var i,r,n,o,s,a=this,l=R(),h=!1!==t&&P,f=500,d=33,m=function(e){var t,h,c=R()-D;c>f&&(l+=c-d),D+=c,a.time=(D-l)/1e3,t=a.time-s,(!i||t>0||!0===e)&&(a.frame++,s+=t+(t>=o?.004:o-t),h=!0),!0!==e&&(n=r(m)),h&&a.dispatchEvent("tick")};A.call(a),a.time=a.frame=0,a.tick=function(){m(!0)},a.lagSmoothing=function(e,t){f=e||1/p,d=Math.min(t,f,0)},a.sleep=function(){null!=n&&(h&&C?C(n):clearTimeout(n),r=g,n=null,a===c&&(u=!1))},a.wake=function(){null!==n?a.sleep():a.frame>10&&(D=R()-f+5),r=0===i?g:h&&P?P:function(e){return setTimeout(e,0|1e3*(s-a.time)+1)},a===c&&(u=!0),m(2)},a.fps=function(e){return arguments.length?(i=e,o=1/(i||60),s=this.time+o,void a.wake()):i},a.useRAF=function(e){return arguments.length?(a.sleep(),h=e,void a.fps(i)):h},a.fps(e),setTimeout(function(){h&&5>a.frame&&a.useRAF(!1)},1500)}),h=d.Ticker.prototype=new d.events.EventDispatcher,h.constructor=d.Ticker;var I=x("core.Animation",function(e,t){if(this.vars=t=t||{},this._duration=this._totalDuration=e||0,this._delay=Number(t.delay)||0,this._timeScale=1,this._active=!0===t.immediateRender,this.data=t.data,this._reversed=!0===t.reversed,Y){u||c.wake();var i=this.vars.useFrames?X:Y;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});c=I.ticker=new d.Ticker,h=I.prototype,h._dirty=h._gc=h._initted=h._paused=!1,h._totalTime=h._time=0,h._rawPrevTime=-1,h._next=h._last=h._onUpdate=h._timeline=h.timeline=null,h._paused=!1;var O=function(){u&&R()-D>2e3&&c.wake(),setTimeout(O,2e3)};O(),h.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},h.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},h.resume=function(e,t){return null!=e&&this.seek(e,t),this.paused(!1)},h.seek=function(e,t){return this.totalTime(Number(e),!1!==t)},h.restart=function(e,t){return this.reversed(!1).paused(!1).totalTime(e?-this._delay:0,!1!==t,!0)},h.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},h.render=function(){},h.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},h.isActive=function(){var e,t=this._timeline,i=this._startTime;return!t||!this._gc&&!this._paused&&t.isActive()&&(e=t.rawTime())>=i&&i+this.totalDuration()/this._timeScale>e},h._enabled=function(e,t){return u||c.wake(),this._gc=!e,this._active=this.isActive(),!0!==t&&(e&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!e&&this.timeline&&this._timeline._remove(this,!0)),!1},h._kill=function(){return this._enabled(!1,!1)},h.kill=function(e,t){return this._kill(e,t),this},h._uncache=function(e){for(var t=e?this:this.timeline;t;)t._dirty=!0,t=t.timeline;return this},h._swapSelfInParams=function(e){for(var t=e.length,i=e.concat();--t>-1;)"{self}"===e[t]&&(i[t]=this);return i},h._callback=function(e){var t=this.vars;t[e].apply(t[e+"Scope"]||t.callbackScope||this,t[e+"Params"]||E)},h.eventCallback=function(e,t,i,r){if("on"===(e||"").substr(0,2)){var n=this.vars;if(1===arguments.length)return n[e];null==t?delete n[e]:(n[e]=t,n[e+"Params"]=v(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,n[e+"Scope"]=r),"onUpdate"===e&&(this._onUpdate=t)}return this},h.delay=function(e){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+e-this._delay),this._delay=e,this):this._delay},h.duration=function(e){return arguments.length?(this._duration=this._totalDuration=e,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==e&&this.totalTime(this._totalTime*(e/this._duration),!0),this):(this._dirty=!1,this._duration)},h.totalDuration=function(e){return this._dirty=!1,arguments.length?this.duration(e):this._totalDuration},h.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(e>this._duration?this._duration:e,t)):this._time},h.totalTime=function(e,t,i){if(u||c.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>e&&!i&&(e+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var r=this._totalDuration,n=this._timeline;if(e>r&&!i&&(e=r),this._startTime=(this._paused?this._pauseTime:n._time)-(this._reversed?r-e:e)/this._timeScale,n._dirty||this._uncache(!1),n._timeline)for(;n._timeline;)n._timeline._time!==(n._startTime+n._totalTime)/n._timeScale&&n.totalTime(n._totalTime,!0),n=n._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==e||0===this._duration)&&(this.render(e,t,!1),k.length&&q())}return this},h.progress=h.totalProgress=function(e,t){return arguments.length?this.totalTime(this.duration()*e,t):this._time/this.duration()},h.startTime=function(e){return arguments.length?(e!==this._startTime&&(this._startTime=e,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,e-this._delay)),this):this._startTime},h.endTime=function(e){return this._startTime+(0!=e?this.totalDuration():this.duration())/this._timeScale},h.timeScale=function(e){if(!arguments.length)return this._timeScale;if(e=e||p,this._timeline&&this._timeline.smoothChildTiming){var t=this._pauseTime,i=t||0===t?t:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/e}return this._timeScale=e,this._uncache(!1)},h.reversed=function(e){return arguments.length?(e!=this._reversed&&(this._reversed=e,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},h.paused=function(e){if(!arguments.length)return this._paused;var t,i,r=this._timeline;return e!=this._paused&&r&&(u||e||c.wake(),t=r.rawTime(),i=t-this._pauseTime,!e&&r.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=e?t:null,this._paused=e,this._active=this.isActive(),!e&&0!==i&&this._initted&&this.duration()&&this.render(r.smoothChildTiming?this._totalTime:(t-this._startTime)/this._timeScale,!0,!0)),this._gc&&!e&&this._enabled(!0,!1),this};var F=x("core.SimpleTimeline",function(e){I.call(this,0,e),this.autoRemoveChildren=this.smoothChildTiming=!0});h=F.prototype=new I,h.constructor=F,h.kill()._gc=!1,h._first=h._last=h._recent=null,h._sortChildren=!1,h.add=h.insert=function(e,t){var i,r;if(e._startTime=Number(t||0)+e._delay,e._paused&&this!==e._timeline&&(e._pauseTime=e._startTime+(this.rawTime()-e._startTime)/e._timeScale),e.timeline&&e.timeline._remove(e,!0),e.timeline=e._timeline=this,e._gc&&e._enabled(!0,!0),i=this._last,this._sortChildren)for(r=e._startTime;i&&i._startTime>r;)i=i._prev;return i?(e._next=i._next,i._next=e):(e._next=this._first,this._first=e),e._next?e._next._prev=e:this._last=e,e._prev=i,this._recent=e,this._timeline&&this._uncache(!0),this},h._remove=function(e,t){return e.timeline===this&&(t||e._enabled(!1,!0),e._prev?e._prev._next=e._next:this._first===e&&(this._first=e._next),e._next?e._next._prev=e._prev:this._last===e&&(this._last=e._prev),e._next=e._prev=e.timeline=null,e===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},h.render=function(e,t,i){var r,n=this._first;for(this._totalTime=this._time=this._rawPrevTime=e;n;)r=n._next,(n._active||e>=n._startTime&&!n._paused)&&(n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)),n=r},h.rawTime=function(){return u||c.wake(),this._totalTime};var L=x("TweenLite",function(e,t,r){if(I.call(this,t,r),this.render=L.prototype.render,null==e)throw"Cannot tween a null target.";this.target=e="string"!=typeof e?e:L.selector(e)||e;var n,o,s,a=e.jquery||e.length&&e!==i&&e[0]&&(e[0]===i||e[0].nodeType&&e[0].style&&!e.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?W[L.defaultOverwrite]:"number"==typeof l?l>>0:W[l],(a||e instanceof Array||e.push&&v(e))&&"number"!=typeof e[0])for(this._targets=s=m(e),this._propLookup=[],this._siblings=[],n=0;s.length>n;n++)o=s[n],o?"string"!=typeof o?o.length&&o!==i&&o[0]&&(o[0]===i||o[0].nodeType&&o[0].style&&!o.nodeType)?(s.splice(n--,1),this._targets=s=s.concat(m(o))):(this._siblings[n]=Q(o,this,!1),1===l&&this._siblings[n].length>1&&J(o,this,null,1,this._siblings[n])):"string"==typeof(o=s[n--]=L.selector(o))&&s.splice(n+1,1):s.splice(n--,1);else this._propLookup={},this._siblings=Q(e,this,!1),1===l&&this._siblings.length>1&&J(e,this,null,1,this._siblings);(this.vars.immediateRender||0===t&&0===this._delay&&!1!==this.vars.immediateRender)&&(this._time=-p,this.render(-this._delay))},!0),B=function(e){return e&&e.length&&e!==i&&e[0]&&(e[0]===i||e[0].nodeType&&e[0].style&&!e.nodeType)},N=function(e,t){var i,r={};for(i in e)j[i]||i in t&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!z[i]||z[i]&&z[i]._autoCSS)||(r[i]=e[i],delete e[i]);e.css=r};h=L.prototype=new I,h.constructor=L,h.kill()._gc=!1,h.ratio=0,h._firstPT=h._targets=h._overwrittenProps=h._startAt=null,h._notifyPluginsOfEnabled=h._lazy=!1,L.version="1.17.0",L.defaultEase=h._ease=new S(null,null,1,1),L.defaultOverwrite="auto",L.ticker=c,L.autoSleep=120,L.lagSmoothing=function(e,t){c.lagSmoothing(e,t)},L.selector=i.$||i.jQuery||function(e){var t=i.$||i.jQuery;return t?(L.selector=t,t(e)):"undefined"==typeof document?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById("#"===e.charAt(0)?e.substr(1):e)};var k=[],V={},U=L._internals={isArray:v,isSelector:B,lazyTweens:k},z=L._plugins={},G=U.tweenLookup={},H=0,j=U.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1},W={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},X=I._rootFramesTimeline=new F,Y=I._rootTimeline=new F,K=30,q=U.lazyRender=function(){var e,t=k.length;for(V={};--t>-1;)(e=k[t])&&!1!==e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0),e._lazy=!1);k.length=0};Y._startTime=c.time,X._startTime=c.frame,Y._active=X._active=!0,setTimeout(q,1),I._updateRoot=L.render=function(){var e,t,i;if(k.length&&q(),Y.render((c.time-Y._startTime)*Y._timeScale,!1,!1),X.render((c.frame-X._startTime)*X._timeScale,!1,!1),k.length&&q(),c.frame>=K){K=c.frame+(parseInt(L.autoSleep,10)||120);for(i in G){for(t=G[i].tweens,e=t.length;--e>-1;)t[e]._gc&&t.splice(e,1);0===t.length&&delete G[i]}if((!(i=Y._first)||i._paused)&&L.autoSleep&&!X._first&&1===c._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||c.sleep()}}},c.addEventListener("tick",I._updateRoot);var Q=function(e,t,i){var r,n,o=e._gsTweenID;if(G[o||(e._gsTweenID=o="t"+H++)]||(G[o]={target:e,tweens:[]}),t&&(r=G[o].tweens,r[n=r.length]=t,i))for(;--n>-1;)r[n]===t&&r.splice(n,1);return G[o].tweens},Z=function(e,t,i,r){var n,o,s=e.vars.onOverwrite;return s&&(n=s(e,t,i,r)),s=L.onOverwrite,s&&(o=s(e,t,i,r)),!1!==n&&!1!==o},J=function(e,t,i,r,n){var o,s,a,l;if(1===r||r>=4){for(l=n.length,o=0;l>o;o++)if((a=n[o])!==t)a._gc||a._kill(null,e,t)&&(s=!0);else if(5===r)break;return s}var h,c=t._startTime+p,u=[],f=0,d=0===t._duration;for(o=n.length;--o>-1;)(a=n[o])===t||a._gc||a._paused||(a._timeline!==t._timeline?(h=h||$(t,0,d),0===$(a,h,d)&&(u[f++]=a)):c>=a._startTime&&a._startTime+a.totalDuration()/a._timeScale>c&&((d||!a._initted)&&2e-10>=c-a._startTime||(u[f++]=a)));for(o=f;--o>-1;)if(a=u[o],2===r&&a._kill(i,e,t)&&(s=!0),2!==r||!a._firstPT&&a._initted){if(2!==r&&!Z(a,t))continue;a._enabled(!1,!1)&&(s=!0)}return s},$=function(e,t,i){for(var r=e._timeline,n=r._timeScale,o=e._startTime;r._timeline;){if(o+=r._startTime,n*=r._timeScale,r._paused)return-100;r=r._timeline}return o/=n,o>t?o-t:i&&o===t||!e._initted&&2*p>o-t?p:(o+=e.totalDuration()/e._timeScale/n)>t+p?0:o-t-p};h._init=function(){var e,t,i,r,n,o=this.vars,s=this._overwrittenProps,a=this._duration,l=!!o.immediateRender,h=o.ease;if(o.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),n={};for(r in o.startAt)n[r]=o.startAt[r];if(n.overwrite=!1,n.immediateRender=!0,n.lazy=l&&!1!==o.lazy,n.startAt=n.delay=null,this._startAt=L.to(this.target,0,n),l)if(this._time>0)this._startAt=null;else if(0!==a)return}else if(o.runBackwards&&0!==a)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(l=!1),i={};for(r in o)j[r]&&"autoCSS"!==r||(i[r]=o[r]);if(i.overwrite=0,i.data="isFromStart",i.lazy=l&&!1!==o.lazy,i.immediateRender=l,this._startAt=L.to(this.target,0,i),l){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=h=h?h instanceof S?h:"function"==typeof h?new S(h,o.easeParams):w[h]||L.defaultEase:L.defaultEase,o.easeParams instanceof Array&&h.config&&(this._ease=h.config.apply(h,o.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(e=this._targets.length;--e>-1;)this._initProps(this._targets[e],this._propLookup[e]={},this._siblings[e],s?s[e]:null)&&(t=!0);else t=this._initProps(this.target,this._propLookup,this._siblings,s);if(t&&L._onPluginEvent("_onInitAllProps",this),s&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),o.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=o.onUpdate,this._initted=!0},h._initProps=function(e,t,r,n){var o,s,a,l,h,c;if(null==e)return!1;V[e._gsTweenID]&&q(),this.vars.css||e.style&&e!==i&&e.nodeType&&z.css&&!1!==this.vars.autoCSS&&N(this.vars,e);for(o in this.vars){if(c=this.vars[o],j[o])c&&(c instanceof Array||c.push&&v(c))&&-1!==c.join("").indexOf("{self}")&&(this.vars[o]=c=this._swapSelfInParams(c,this));else if(z[o]&&(l=new z[o])._onInitTween(e,this.vars[o],this)){for(this._firstPT=h={_next:this._firstPT,t:l,p:"setRatio",s:0,c:1,f:!0,n:o,pg:!0,pr:l._priority},s=l._overwriteProps.length;--s>-1;)t[l._overwriteProps[s]]=this._firstPT;(l._priority||l._onInitAllProps)&&(a=!0),(l._onDisable||l._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=t[o]=h={_next:this._firstPT,t:e,p:o,f:"function"==typeof e[o],n:o,pg:!1,pr:0},h.s=h.f?e[o.indexOf("set")||"function"!=typeof e["get"+o.substr(3)]?o:"get"+o.substr(3)]():parseFloat(e[o]),h.c="string"==typeof c&&"="===c.charAt(1)?parseInt(c.charAt(0)+"1",10)*Number(c.substr(2)):Number(c)-h.s||0;h&&h._next&&(h._next._prev=h)}return n&&this._kill(n,e)?this._initProps(e,t,r,n):this._overwrite>1&&this._firstPT&&r.length>1&&J(e,this,t,this._overwrite,r)?(this._kill(t,e),this._initProps(e,t,r,n)):(this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration)&&(V[e._gsTweenID]=!0),a)},h.render=function(e,t,i){var r,n,o,s,a=this._time,l=this._duration,h=this._rawPrevTime;if(e>=l)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(r=!0,n="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(e=0),(0===e||0>h||h===p&&"isPause"!==this.data)&&h!==e&&(i=!0,h>p&&(n="onReverseComplete")),this._rawPrevTime=s=!t||e||h===e?e:p);else if(1e-7>e)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==a||0===l&&h>0)&&(n="onReverseComplete",r=this._reversed),0>e&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(h>=0&&(h!==p||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=s=!t||e||h===e?e:p)),this._initted||(i=!0);else if(this._totalTime=this._time=e,this._easeType){var c=e/l,u=this._easeType,f=this._easePower;(1===u||3===u&&c>=.5)&&(c=1-c),3===u&&(c*=2),1===f?c*=c:2===f?c*=c*c:3===f?c*=c*c*c:4===f&&(c*=c*c*c*c),this.ratio=1===u?1-c:2===u?c:.5>e/l?c/2:1-c/2}else this.ratio=this._ease.getRatio(e/l);if(this._time!==a||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=a,this._rawPrevTime=h,k.push(this),void(this._lazy=[e,t]);this._time&&!r?this.ratio=this._ease.getRatio(this._time/l):r&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(!1!==this._lazy&&(this._lazy=!1),this._active||!this._paused&&this._time!==a&&e>=0&&(this._active=!0),0===a&&(this._startAt&&(e>=0?this._startAt.render(e,t,i):n||(n="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(t||this._callback("onStart"))),o=this._firstPT;o;)o.f?o.t[o.p](o.c*this.ratio+o.s):o.t[o.p]=o.c*this.ratio+o.s,o=o._next;this._onUpdate&&(0>e&&this._startAt&&-1e-4!==e&&this._startAt.render(e,t,i),t||(this._time!==a||r)&&this._callback("onUpdate")),n&&(!this._gc||i)&&(0>e&&this._startAt&&!this._onUpdate&&-1e-4!==e&&this._startAt.render(e,t,i),r&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[n]&&this._callback(n),0===l&&this._rawPrevTime===p&&s!==p&&(this._rawPrevTime=0))}},h._kill=function(e,t,i){if("all"===e&&(e=null),null==e&&(null==t||t===this.target))return this._lazy=!1,this._enabled(!1,!1);t="string"!=typeof t?t||this._targets||this.target:L.selector(t)||t;var r,n,o,s,a,l,h,c,u,f=i&&this._time&&i._startTime===this._startTime&&this._timeline===i._timeline;if((v(t)||B(t))&&"number"!=typeof t[0])for(r=t.length;--r>-1;)this._kill(e,t[r],i)&&(l=!0);else{if(this._targets){for(r=this._targets.length;--r>-1;)if(t===this._targets[r]){a=this._propLookup[r]||{},this._overwrittenProps=this._overwrittenProps||[],n=this._overwrittenProps[r]=e?this._overwrittenProps[r]||{}:"all";break}}else{if(t!==this.target)return!1;a=this._propLookup,n=this._overwrittenProps=e?this._overwrittenProps||{}:"all"}if(a){if(h=e||a,c=e!==n&&"all"!==n&&e!==a&&("object"!=typeof e||!e._tempKill),i&&(L.onOverwrite||this.vars.onOverwrite)){for(o in h)a[o]&&(u||(u=[]),u.push(o));if((u||!e)&&!Z(this,i,t,u))return!1}for(o in h)(s=a[o])&&(f&&(s.f?s.t[s.p](s.s):s.t[s.p]=s.s,l=!0),s.pg&&s.t._kill(h)&&(l=!0),s.pg&&0!==s.t._overwriteProps.length||(s._prev?s._prev._next=s._next:s===this._firstPT&&(this._firstPT=s._next),s._next&&(s._next._prev=s._prev),s._next=s._prev=null),delete a[o]),c&&(n[o]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},h.invalidate=function(){return this._notifyPluginsOfEnabled&&L._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],I.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-p,this.render(-this._delay)),this},h._enabled=function(e,t){if(u||c.wake(),e&&this._gc){var i,r=this._targets;if(r)for(i=r.length;--i>-1;)this._siblings[i]=Q(r[i],this,!0);else this._siblings=Q(this.target,this,!0)}return I.prototype._enabled.call(this,e,t),!(!this._notifyPluginsOfEnabled||!this._firstPT)&&L._onPluginEvent(e?"_onEnable":"_onDisable",this)},L.to=function(e,t,i){return new L(e,t,i)},L.from=function(e,t,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new L(e,t,i)},L.fromTo=function(e,t,i,r){return r.startAt=i,r.immediateRender=0!=r.immediateRender&&0!=i.immediateRender,new L(e,t,r)},L.delayedCall=function(e,t,i,r,n){return new L(t,0,{delay:e,onComplete:t,onCompleteParams:i,callbackScope:r,onReverseComplete:t,onReverseCompleteParams:i,immediateRender:!1,lazy:!1,useFrames:n,overwrite:0})},L.set=function(e,t){return new L(e,0,t)},L.getTweensOf=function(e,t){if(null==e)return[];e="string"!=typeof e?e:L.selector(e)||e;var i,r,n,o;if((v(e)||B(e))&&"number"!=typeof e[0]){for(i=e.length,r=[];--i>-1;)r=r.concat(L.getTweensOf(e[i],t));for(i=r.length;--i>-1;)for(o=r[i],n=i;--n>-1;)o===r[n]&&r.splice(i,1)}else for(r=Q(e).concat(),i=r.length;--i>-1;)(r[i]._gc||t&&!r[i].isActive())&&r.splice(i,1);return r},L.killTweensOf=L.killDelayedCallsTo=function(e,t,i){"object"==typeof t&&(i=t,t=!1);for(var r=L.getTweensOf(e,t),n=r.length;--n>-1;)r[n]._kill(i,e)};var ee=x("plugins.TweenPlugin",function(e,t){this._overwriteProps=(e||"").split(","),this._propName=this._overwriteProps[0],this._priority=t||0,this._super=ee.prototype},!0);if(h=ee.prototype,ee.version="1.10.1",ee.API=2,h._firstPT=null,h._addTween=function(e,t,i,r,n,o){var s,a;return null!=r&&(s="number"==typeof r||"="!==r.charAt(1)?Number(r)-Number(i):parseInt(r.charAt(0)+"1",10)*Number(r.substr(2)))?(this._firstPT=a={_next:this._firstPT,t:e,p:t,s:i,c:s,f:"function"==typeof e[t],n:n||t,r:o},a._next&&(a._next._prev=a),a):void 0},h.setRatio=function(e){for(var t,i=this._firstPT;i;)t=i.c*e+i.s,i.r?t=Math.round(t):1e-6>t&&t>-1e-6&&(t=0),i.f?i.t[i.p](t):i.t[i.p]=t,i=i._next},h._kill=function(e){var t,i=this._overwriteProps,r=this._firstPT;if(null!=e[this._propName])this._overwriteProps=[];else for(t=i.length;--t>-1;)null!=e[i[t]]&&i.splice(t,1);for(;r;)null!=e[r.n]&&(r._next&&(r._next._prev=r._prev),r._prev?(r._prev._next=r._next,r._prev=null):this._firstPT===r&&(this._firstPT=r._next)),r=r._next;return!1},h._roundProps=function(e,t){for(var i=this._firstPT;i;)(e[this._propName]||null!=i.n&&e[i.n.split(this._propName+"_").join("")])&&(i.r=t),i=i._next},L._onPluginEvent=function(e,t){var i,r,n,o,s,a=t._firstPT;if("_onInitAllProps"===e){for(;a;){for(s=a._next,r=n;r&&r.pr>a.pr;)r=r._next;(a._prev=r?r._prev:o)?a._prev._next=a:n=a,(a._next=r)?r._prev=a:o=a,a=s}a=t._firstPT=n}for(;a;)a.pg&&"function"==typeof a.t[e]&&a.t[e]()&&(i=!0),a=a._next;return i},ee.activate=function(e){for(var t=e.length;--t>-1;)e[t].API===ee.API&&(z[(new e[t])._propName]=e[t]);return!0},b.plugin=function(e){if(!(e&&e.propName&&e.init&&e.API))throw"illegal plugin definition.";var t,i=e.propName,r=e.priority||0,n=e.overwriteProps,o={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},s=x("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){ee.call(this,i,r),this._overwriteProps=n||[]},!0===e.global),a=s.prototype=new ee(i);a.constructor=s,s.API=e.API;for(t in o)"function"==typeof e[t]&&(a[o[t]]=e[t]);return s.version=e.version,ee.activate([s]),s},a=i._gsQueue){for(l=0;a.length>l;l++)a[l]();for(h in y)y[h].func||i.console.log("GSAP encountered missing dependency: com.greensock."+h)}u=!1}}(void 0!==e&&e.exports&&void 0!==i?i:this||window)}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r=window.nb;void 0===r&&(r={},window.nb=r),r.table=i(174),i(200),window.THREE=i(201),i(202),window.GlobalEffect=i(245),r.timelineSprite=i(246),r.ToolsMenu=i(247),r.MovieClip=i(248),r.iconList=i(249),r.clock=i(250),r.matches=i(251),r.box2dSwitchComponent=i(252),r.drawPicture=i(253),r.judgebox=i(254),r.longRuler=i(255),r.whiteScene=i(256),r.injector=i(257),r.thermometer=i(258),r.nbTimeline=i(259),r.magGlass=i(260),r.VernierCaliper=i(261),r.SetSquaresAndRuler=i(262),r.setDefaultAsHide=i(263),r.balance=i(264),r.DrawUtil=i(265),r.SlideSwitch=i(266),r.colorSelector=i(267),r.pictureView=i(268),r.pictureView2=i(269),r.picTransform=i(270),r.wallOfPic=i(271),r.wallOfVideo=i(272),r.slidesList=i(273),r.mapViewer=i(274),r.vr=i(275),r.curette=i(277),window.textControl=i(278);var n={STEMMain:i(39),display:i(279),plguin:i(280),utils:{NBGesture:i(77),NBPoint:i(83),MeshUtil:i(305),NBHitTest:i(306),ThreeUtil:i(307),NBMath:i(82),ParticleUtil:i(308),SomeUtil:i(309),Fitting:i(310),NBTrimImage:i(311)},NBTable:i(174),frames:{discuss:i(312),purpose:i(313)},collada:{Animation:i(314),AnimationHandler:i(315),KeyFrameAniamtion:i(316),ColladaLoader:i(317)}};r.eq=i(318),r.geom=i(320),r.BaseFrame=i(321),t.extendsClass=i(171),t.SoundManager=i(322),t.FrameManager=i(323),t.NBDrag=i(172),t.nb.GraphicsUtils=i(175),window.NbFile=i(324),window.BioController=i(186),t.StemMain=n.STEMMain,e.exports=t.nb.stem=n}).call(t,i(1))},function(e,t,i){"use strict";nb.SolidMedicine=function(){this.addCover=function(){var e=this;return new Promise(function(){console.log(e)})},this.removeCover=function(){}},e.exports=nb.SolidMedicine},function(e,t,i){var r,n,o={REVISION:"73"};r=o,void 0!==(n="function"==typeof r?r.call(t,i,t,e):r)&&(e.exports=n),void 0!==self.requestAnimationFrame&&void 0!==self.cancelAnimationFrame||function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!self.requestAnimationFrame;++i)self.requestAnimationFrame=self[t[i]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[i]+"CancelAnimationFrame"]||self[t[i]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var i=Date.now(),r=Math.max(0,16-(i-e)),n=self.setTimeout(function(){t(i+r)},r);return e=i+r,n}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),void 0===self.performance&&(self.performance={}),void 0===self.performance.now&&function(){var e=Date.now();self.performance.now=function(){return Date.now()-e}}(),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),o.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},o.CullFaceNone=0,o.CullFaceBack=1,o.CullFaceFront=2,o.CullFaceFrontBack=3,o.FrontFaceDirectionCW=0,o.FrontFaceDirectionCCW=1,o.BasicShadowMap=0,o.PCFShadowMap=1,o.PCFSoftShadowMap=2,o.FrontSide=0,o.BackSide=1,o.DoubleSide=2,o.FlatShading=1,o.SmoothShading=2,o.NoColors=0,o.FaceColors=1,o.VertexColors=2,o.NoBlending=0,o.NormalBlending=1,o.AdditiveBlending=2,o.SubtractiveBlending=3,o.MultiplyBlending=4,o.CustomBlending=5,o.AddEquation=100,o.SubtractEquation=101,o.ReverseSubtractEquation=102,o.MinEquation=103,o.MaxEquation=104,o.ZeroFactor=200,o.OneFactor=201,o.SrcColorFactor=202,o.OneMinusSrcColorFactor=203,o.SrcAlphaFactor=204,o.OneMinusSrcAlphaFactor=205,o.DstAlphaFactor=206,o.OneMinusDstAlphaFactor=207,o.DstColorFactor=208,o.OneMinusDstColorFactor=209,o.SrcAlphaSaturateFactor=210,o.NeverDepth=0,o.AlwaysDepth=1,o.LessDepth=2,o.LessEqualDepth=3,o.EqualDepth=4,o.GreaterEqualDepth=5,o.GreaterDepth=6,o.NotEqualDepth=7,o.MultiplyOperation=0,o.MixOperation=1,o.AddOperation=2,o.UVMapping=300,o.CubeReflectionMapping=301,o.CubeRefractionMapping=302,o.EquirectangularReflectionMapping=303,o.EquirectangularRefractionMapping=304,o.SphericalReflectionMapping=305,o.RepeatWrapping=1e3,o.ClampToEdgeWrapping=1001,o.MirroredRepeatWrapping=1002,o.NearestFilter=1003,o.NearestMipMapNearestFilter=1004,o.NearestMipMapLinearFilter=1005,o.LinearFilter=1006,o.LinearMipMapNearestFilter=1007,o.LinearMipMapLinearFilter=1008,o.UnsignedByteType=1009,o.ByteType=1010,o.ShortType=1011,o.UnsignedShortType=1012,o.IntType=1013,o.UnsignedIntType=1014,o.FloatType=1015,o.HalfFloatType=1025,o.UnsignedShort4444Type=1016,o.UnsignedShort5551Type=1017,o.UnsignedShort565Type=1018,o.AlphaFormat=1019,o.RGBFormat=1020,o.RGBAFormat=1021,o.LuminanceFormat=1022,o.LuminanceAlphaFormat=1023,o.RGBEFormat=o.RGBAFormat,o.RGB_S3TC_DXT1_Format=2001,o.RGBA_S3TC_DXT1_Format=2002,o.RGBA_S3TC_DXT3_Format=2003,o.RGBA_S3TC_DXT5_Format=2004,o.RGB_PVRTC_4BPPV1_Format=2100,o.RGB_PVRTC_2BPPV1_Format=2101,o.RGBA_PVRTC_4BPPV1_Format=2102,o.RGBA_PVRTC_2BPPV1_Format=2103,o.LoopOnce=2200,o.LoopRepeat=2201,o.LoopPingPong=2202,o.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},o.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},o.Color=function(e){return 3===arguments.length?this.fromArray(arguments):this.set(e)},o.Color.prototype={constructor:o.Color,r:1,g:1,b:1,set:function(e){return e instanceof o.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,r){if(t=o.Math.euclideanModulo(t,1),i=o.Math.clamp(i,0,1),r=o.Math.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+i):r+i-r*i,s=2*r-n;this.r=e(s,n,t+1/3),this.g=e(s,n,t),this.b=e(s,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(s)){var a=parseFloat(r[1])/360,l=parseInt(r[2],10)/100,h=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(a,l,h)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=i[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=o.ColorKeywords[e];void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,r=e||{h:0,s:0,l:0},n=this.r,o=this.g,s=this.b,a=Math.max(n,o,s),l=Math.min(n,o,s),h=(l+a)/2;if(l===a)t=0,i=0;else{var c=a-l;switch(i=h<=.5?c/(a+l):c/(2-a-l),a){case n:t=(o-s)/c+(o<s?6:0);break;case o:t=(s-n)/c+2;break;case s:t=(n-o)/c+4}t/=6}return r.h=t,r.s=i,r.l=h,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},o.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},o.Quaternion=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1},o.Quaternion.prototype={constructor:o.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof o.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i=Math.cos(e._x/2),r=Math.cos(e._y/2),n=Math.cos(e._z/2),s=Math.sin(e._x/2),a=Math.sin(e._y/2),l=Math.sin(e._z/2),h=e.order;return"XYZ"===h?(this._x=s*r*n+i*a*l,this._y=i*a*n-s*r*l,this._z=i*r*l+s*a*n,this._w=i*r*n-s*a*l):"YXZ"===h?(this._x=s*r*n+i*a*l,this._y=i*a*n-s*r*l,this._z=i*r*l-s*a*n,this._w=i*r*n+s*a*l):"ZXY"===h?(this._x=s*r*n-i*a*l,this._y=i*a*n+s*r*l,this._z=i*r*l+s*a*n,this._w=i*r*n-s*a*l):"ZYX"===h?(this._x=s*r*n-i*a*l,this._y=i*a*n+s*r*l,this._z=i*r*l-s*a*n,this._w=i*r*n+s*a*l):"YZX"===h?(this._x=s*r*n+i*a*l,this._y=i*a*n+s*r*l,this._z=i*r*l-s*a*n,this._w=i*r*n-s*a*l):"XZY"===h&&(this._x=s*r*n-i*a*l,this._y=i*a*n-s*r*l,this._z=i*r*l+s*a*n,this._w=i*r*n+s*a*l),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],l=i[9],h=i[2],c=i[6],u=i[10],f=r+a+u;return f>0?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-h)*t,this._z=(s-n)*t):r>a&&r>u?(t=2*Math.sqrt(1+r-a-u),this._w=(c-l)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+h)/t):a>u?(t=2*Math.sqrt(1+a-r-u),this._w=(o-h)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+u-r-a),this._w=(s-n)/t,this._x=(o+h)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t;return function(i,r){return void 0===e&&(e=new o.Vector3),t=i.dot(r)+1,t<1e-6?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,l=t._z,h=t._w;return this._x=i*h+o*s+r*l-n*a,this._y=r*h+o*a+n*s-i*l,this._z=n*h+o*l+i*a-r*s,this._w=o*h-i*s-r*a-n*l,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var h=Math.sin((1-t)*a)/l,c=Math.sin(t*a)/l;return this._w=o*h+this._w*c,this._x=i*h+this._x*c,this._y=r*h+this._y*c,this._z=n*h+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},o.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},o.Vector2=function(e,t){this.x=e||0,this.y=t||0},o.Vector2.prototype={constructor:o.Vector2,get width(){return this.x},set width(e){this.x=e},get height(){return this.y},set height(e){this.y=e},set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e):(this.x=0,this.y=0),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new o.Vector2,t=new o.Vector2),e.set(i,i),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}},o.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},o.Vector3.prototype={constructor:o.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return t instanceof o.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),void 0===e&&(e=new o.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,i){return void 0===e&&(e=new o.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,h=a*i+s*t-n*r,c=a*r+n*i-o*t,u=-n*t-o*i-s*r;return this.x=l*a+u*-n+h*-s-c*-o,this.y=h*a+u*-o+c*-n-l*-s,this.z=c*a+u*-s+l*-o-h*-n,this},project:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new o.Vector3,t=new o.Vector3),e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.multiplyScalar(Math.max(e,Math.min(t,i))/i),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},projectOnVector:function(){var e,t;return function(i){return void 0===e&&(e=new o.Vector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new o.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new o.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(o.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){var i=4*e,r=t.elements;return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},o.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},o.Vector4.prototype={constructor:o.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return isFinite(e)?(this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=e.elements,s=o[0],a=o[4],l=o[8],h=o[1],c=o[5],u=o[9],f=o[2],d=o[6],p=o[10];if(Math.abs(a-h)<.01&&Math.abs(l-f)<.01&&Math.abs(u-d)<.01){if(Math.abs(a+h)<.1&&Math.abs(l+f)<.1&&Math.abs(u+d)<.1&&Math.abs(s+c+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(s+1)/2,g=(c+1)/2,v=(p+1)/2,y=(a+h)/4,_=(l+f)/4,b=(u+d)/4;return m>g&&m>v?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=y/i,n=_/i):g>v?g<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(g),i=y/r,n=b/r):v<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(v),i=_/n,r=b/n),this.set(i,r,n,t),this}var x=Math.sqrt((d-u)*(d-u)+(l-f)*(l-f)+(h-a)*(h-a));return Math.abs(x)<.001&&(x=1),this.x=(d-u)/x,this.y=(l-f)/x,this.z=(h-a)/x,this.w=Math.acos((s+c+p-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new o.Vector4,t=new o.Vector4),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.multiplyScalar(e/this.length())},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},o.Euler=function(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||o.Euler.DefaultOrder},o.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],o.Euler.DefaultOrder="XYZ",o.Euler.prototype={constructor:o.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=o.Math.clamp,n=e.elements,s=n[0],a=n[4],l=n[8],h=n[1],c=n[5],u=n[9],f=n[2],d=n[6],p=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(l,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-f,s),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(h,s))):"ZYX"===t?(this._y=Math.asin(-r(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-a,c))):"YZX"===t?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-f,s)):(this._x=0,this._y=Math.atan2(l,p))):"XZY"===t?(this._z=Math.asin(-r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-u,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,i,r){return void 0===e&&(e=new o.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new o.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},o.Line3=function(e,t){this.start=void 0!==e?e:new o.Vector3,this.end=void 0!==t?t:new o.Vector3},o.Line3.prototype={constructor:o.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new o.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new o.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new o.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o.Vector3,t=new o.Vector3;return function(i,r){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),s=t.dot(e),a=s/n;return r&&(a=o.Math.clamp(a,0,1)),a}}(),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),n=i||new o.Vector3;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},o.Box2=function(e,t){this.min=void 0!==e?e:new o.Vector2(1/0,1/0),this.max=void 0!==t?t:new o.Vector2(-1/0,-1/0)},o.Box2.prototype={constructor:o.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o.Vector2;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new o.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new o.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new o.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},o.Box3=function(e,t){this.min=void 0!==e?e:new o.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.Vector3(-1/0,-1/0,-1/0)},o.Box3.prototype={constructor:o.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o.Vector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new o.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var r=t.geometry;if(void 0!==r)if(r instanceof o.Geometry)for(var n=r.vertices,s=0,a=n.length;s<a;s++)e.copy(n[s]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e);else if(r instanceof o.BufferGeometry&&void 0!==r.attributes.position)for(var l=r.attributes.position.array,s=0,a=l.length;s<a;s+=3)e.set(l[s],l[s+1],l[s+2]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new o.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new o.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new o.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new o.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o.Vector3;return function(t){var i=t||new o.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},o.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},o.Matrix3.prototype={constructor:o.Matrix3,set:function(e,t,i,r,n,o,s,a,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=n,h[7]=o,h[2]=s,h[5]=a,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,i,r){void 0===e&&(e=new o.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,s=i;n<r;n+=3,s+=3)e.fromArray(t,s),e.applyMatrix3(this),e.toArray(t,s);return t}}(),applyToBuffer:function(){var e;return function(t,i,r){void 0===e&&(e=new o.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var n=0,s=i;n<r;n++,s++)e.x=t.getX(s),e.y=t.getY(s),e.z=t.getZ(s),e.applyMatrix3(this),t.setXYZ(e.x,e.y,e.z);return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8];return t*o*h-t*s*l-i*n*h+i*s*a+r*n*l-r*o*a},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var n=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},o.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},o.Matrix4.prototype={constructor:o.Matrix4,set:function(e,t,i,r,n,o,s,a,l,h,c,u,f,d,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=n,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new o.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){var r=this.elements;return e.set(r[0],r[1],r[2]),t.set(r[4],r[5],r[6]),i.set(r[8],r[9],r[10]),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){void 0===e&&(e=new o.Vector3);var i=this.elements,r=t.elements,n=1/e.set(r[0],r[1],r[2]).length(),s=1/e.set(r[4],r[5],r[6]).length(),a=1/e.set(r[8],r[9],r[10]).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,this}}(),makeRotationFromEuler:function(e){e instanceof o.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),l=Math.cos(r),h=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if("XYZ"===e.order){var f=s*c,d=s*u,p=a*c,m=a*u;t[0]=l*c,t[4]=-l*u,t[8]=h,t[1]=d+p*h,t[5]=f-m*h,t[9]=-a*l,t[2]=m-f*h,t[6]=p+d*h,t[10]=s*l}else if("YXZ"===e.order){var g=l*c,v=l*u,y=h*c,_=h*u;t[0]=g+_*a,t[4]=y*a-v,t[8]=s*h,t[1]=s*u,t[5]=s*c,t[9]=-a,t[2]=v*a-y,t[6]=_+g*a,t[10]=s*l}else if("ZXY"===e.order){var g=l*c,v=l*u,y=h*c,_=h*u;t[0]=g-_*a,t[4]=-s*u,t[8]=y+v*a,t[1]=v+y*a,t[5]=s*c,t[9]=_-g*a,t[2]=-s*h,t[6]=a,t[10]=s*l}else if("ZYX"===e.order){var f=s*c,d=s*u,p=a*c,m=a*u;t[0]=l*c,t[4]=p*h-d,t[8]=f*h+m,t[1]=l*u,t[5]=m*h+f,t[9]=d*h-p,t[2]=-h,t[6]=a*l,t[10]=s*l}else if("YZX"===e.order){var b=s*l,x=s*h,T=a*l,E=a*h;t[0]=l*c,t[4]=E-b*u,t[8]=T*u+x,t[1]=u,t[5]=s*c,t[9]=-a*c,t[2]=-h*c,t[6]=x*u+T,t[10]=b-E*u}else if("XZY"===e.order){var b=s*l,x=s*h,T=a*l,E=a*h;t[0]=l*c,t[4]=-u,t[8]=h*c,t[1]=b*u+E,t[5]=s*c,t[9]=x*u-T,t[2]=T*u-x,t[6]=a*c,t[10]=E*u+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,s=i+i,a=r+r,l=n+n,h=i*s,c=i*a,u=i*l,f=r*a,d=r*l,p=n*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(f+p),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+p),t[9]=d-m,t[2]=u-g,t[6]=d+m,t[10]=1-(h+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,i;return function(r,n,s){void 0===e&&(e=new o.Vector3),void 0===t&&(t=new o.Vector3),void 0===i&&(i=new o.Vector3);var a=this.elements;return i.subVectors(r,n).normalize(),0===i.lengthSq()&&(i.z=1),e.crossVectors(s,i).normalize(),0===e.lengthSq()&&(i.x+=1e-4,e.crossVectors(s,i).normalize()),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],f=i[13],d=i[2],p=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],b=i[15],x=r[0],T=r[4],E=r[8],S=r[12],w=r[1],M=r[5],A=r[9],P=r[13],C=r[2],R=r[6],D=r[10],I=r[14],O=r[3],F=r[7],L=r[11],B=r[15];return n[0]=o*x+s*w+a*C+l*O,n[4]=o*T+s*M+a*R+l*F,n[8]=o*E+s*A+a*D+l*L,n[12]=o*S+s*P+a*I+l*B,n[1]=h*x+c*w+u*C+f*O,n[5]=h*T+c*M+u*R+f*F,n[9]=h*E+c*A+u*D+f*L,n[13]=h*S+c*P+u*I+f*B,n[2]=d*x+p*w+m*C+g*O,n[6]=d*T+p*M+m*R+g*F,n[10]=d*E+p*A+m*D+g*L,n[14]=d*S+p*P+m*I+g*B,n[3]=v*x+y*w+_*C+b*O,n[7]=v*T+y*M+_*R+b*F,n[11]=v*E+y*A+_*D+b*L,n[15]=v*S+y*P+_*I+b*B,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,i,r){void 0===e&&(e=new o.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length);for(var n=0,s=i;n<r;n+=3,s+=3)e.fromArray(t,s),e.applyMatrix4(this),e.toArray(t,s);return t}}(),applyToBuffer:function(){var e;return function(t,i,r){void 0===e&&(e=new o.Vector3),void 0===i&&(i=0),void 0===r&&(r=t.length/t.itemSize);for(var n=0,s=i;n<r;n++,s++)e.x=t.getX(s),e.y=t.getY(s),e.z=t.getZ(s),e.applyMatrix4(this),t.setXYZ(e.x,e.y,e.z);return t}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],f=e[14];return e[3]*(+n*a*c-r*l*c-n*s*u+i*l*u+r*s*f-i*a*f)+e[7]*(+t*a*f-t*l*u+n*o*u-r*o*f+r*l*h-n*a*h)+e[11]*(+t*l*c-t*s*f-n*o*c+i*o*f+n*s*h-i*l*h)+e[15]*(-r*s*h-t*a*c+t*s*u+r*o*c-i*o*u+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e;return function(){void 0===e&&(e=new o.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[4],s=r[8],a=r[12],l=r[1],h=r[5],c=r[9],u=r[13],f=r[2],d=r[6],p=r[10],m=r[14],g=r[3],v=r[7],y=r[11],_=r[15];i[0]=c*m*v-u*p*v+u*d*y-h*m*y-c*d*_+h*p*_,i[4]=a*p*v-s*m*v-a*d*y+o*m*y+s*d*_-o*p*_,i[8]=s*u*v-a*c*v+a*h*y-o*u*y-s*h*_+o*c*_,i[12]=a*c*d-s*u*d-a*h*p+o*u*p+s*h*m-o*c*m,i[1]=u*p*g-c*m*g-u*f*y+l*m*y+c*f*_-l*p*_,i[5]=s*m*g-a*p*g+a*f*y-n*m*y-s*f*_+n*p*_,i[9]=a*c*g-s*u*g-a*l*y+n*u*y+s*l*_-n*c*_,i[13]=s*u*f-a*c*f+a*l*p-n*u*p-s*l*m+n*c*m,i[2]=h*m*g-u*d*g+u*f*v-l*m*v-h*f*_+l*d*_,i[6]=a*d*g-o*m*g-a*f*v+n*m*v+o*f*_-n*d*_,i[10]=o*u*g-a*h*g+a*l*v-n*u*v-o*l*_+n*h*_,i[14]=a*h*f-o*u*f-a*l*d+n*u*d+o*l*m-n*h*m,i[3]=c*d*g-h*p*g-c*f*v+l*p*v+h*f*y-l*d*y,i[7]=o*p*g-s*d*g+s*f*v-n*p*v-o*f*y+n*d*y,i[11]=s*h*g-o*c*g-s*l*v+n*c*v+o*l*y-n*h*y,i[15]=o*c*f-s*h*f+s*l*d-n*c*d-o*l*p+n*h*p;var b=n*i[0]+l*i[4]+f*i[8]+g*i[12];if(0===b){var x="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,h=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,h*s+i,h*a-r*o,0,l*a-r*s,h*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e,t;return function(i,r,n){void 0===e&&(e=new o.Vector3),void 0===t&&(t=new o.Matrix4);var s=this.elements,a=e.set(s[0],s[1],s[2]).length(),l=e.set(s[4],s[5],s[6]).length(),h=e.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),i.x=s[12],i.y=s[13],i.z=s[14],t.elements.set(this.elements);var c=1/a,u=1/l,f=1/h;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=u,t.elements[5]*=u,t.elements[6]*=u,t.elements[8]*=f,t.elements[9]*=f,t.elements[10]*=f,r.setFromRotationMatrix(t),n.x=a,n.y=l,n.z=h,this}}(),makeFrustum:function(e,t,i,r,n,o){var s=this.elements,a=2*n/(t-e),l=2*n/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),u=-(o+n)/(o-n),f=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=f,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,i,r){var n=i*Math.tan(o.Math.degToRad(.5*e)),s=-n,a=s*t,l=n*t;return this.makeFrustum(a,l,s,n,i,r)},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=t-e,l=i-r,h=o-n,c=(t+e)/a,u=(i+r)/l,f=(o+n)/h;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2/h,s[14]=-f,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},o.Ray=function(e,t){this.origin=void 0!==e?e:new o.Vector3,this.direction=void 0!==t?t:new o.Vector3},o.Ray.prototype={constructor:o.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new o.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new o.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new o.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Vector3;return function(r,n,o,s){e.copy(r).add(n).multiplyScalar(.5),t.copy(n).sub(r).normalize(),i.copy(this.origin).sub(e);var a,l,h,c,u=.5*r.distanceTo(n),f=-this.direction.dot(t),d=i.dot(this.direction),p=-i.dot(t),m=i.lengthSq(),g=Math.abs(1-f*f);if(g>0)if(a=f*p-d,l=f*d-p,c=u*g,a>=0)if(l>=-c)if(l<=c){var v=1/g;a*=v,l*=v,h=a*(a+f*l+2*d)+l*(f*a+l+2*p)+m}else l=u,a=Math.max(0,-(f*l+d)),h=-a*a+l*(l+2*p)+m;else l=-u,a=Math.max(0,-(f*l+d)),h=-a*a+l*(l+2*p)+m;else l<=-c?(a=Math.max(0,-(-f*u+d)),l=a>0?-u:Math.min(Math.max(-u,-p),u),h=-a*a+l*(l+2*p)+m):l<=c?(a=0,l=Math.min(Math.max(-u,-p),u),h=l*(l+2*p)+m):(a=Math.max(0,-(f*u+d)),l=a>0?u:Math.min(Math.max(-u,-p),u),h=-a*a+l*(l+2*p)+m);else l=f>0?-u:u,a=Math.max(0,-(f*l+d)),h=-a*a+l*(l+2*p)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),h}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new o.Vector3;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var s=Math.sqrt(o-n),a=r-s,l=r+s;return a<0&&l<0?null:a<0?this.at(l,i):this.at(a,i)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:function(){var e=new o.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var i,r,n,o,s,a,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,r=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,r=(e.min.x-u.x)*l),h>=0?(n=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(n=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||n>r?null:((n>i||i!==i)&&(i=n),(o<r||r!==r)&&(r=o),c>=0?(s=(e.min.z-u.z)*c,a=(e.max.z-u.z)*c):(s=(e.max.z-u.z)*c,a=(e.min.z-u.z)*c),i>a||s>r?null:((s>i||i!==i)&&(i=s),(a<r||r!==r)&&(r=a),r<0?null:this.at(i>=0?i:r,t)))},intersectTriangle:function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Vector3,r=new o.Vector3;return function(n,o,s,a,l){t.subVectors(o,n),i.subVectors(s,n),r.crossVectors(t,i);var h,c=this.direction.dot(r);if(c>0){if(a)return null;h=1}else{if(!(c<0))return null;h=-1,c=-c}e.subVectors(this.origin,n);var u=h*this.direction.dot(i.crossVectors(e,i));if(u<0)return null;var f=h*this.direction.dot(t.cross(e));if(f<0)return null;if(u+f>c)return null;var d=-h*e.dot(r);return d<0?null:this.at(d/c,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},o.Sphere=function(e,t){this.center=void 0!==e?e:new o.Vector3,this.radius=void 0!==t?t:0},o.Sphere.prototype={constructor:o.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new o.Box3;return function(t,i){var r=this.center;void 0!==i?r.copy(i):e.setFromPoints(t).center(r);for(var n=0,o=0,s=t.length;o<s;o++)n=Math.max(n,r.distanceToSquared(t[o]));return this.radius=Math.sqrt(n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new o.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new o.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},o.Frustum=function(e,t,i,r,n,s){this.planes=[void 0!==e?e:new o.Plane,void 0!==t?t:new o.Plane,void 0!==i?i:new o.Plane,void 0!==r?r:new o.Plane,void 0!==n?n:new o.Plane,void 0!==s?s:new o.Plane]},o.Frustum.prototype={constructor:o.Frustum,set:function(e,t,i,r,n,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(n),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],f=i[9],d=i[10],p=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-r,c-a,p-u,y-m).normalize(),t[1].setComponents(s+r,c+a,p+u,y+m).normalize(),t[2].setComponents(s+n,c+l,p+f,y+g).normalize(),t[3].setComponents(s-n,c-l,p-f,y-g).normalize(),t[4].setComponents(s-o,c-h,p-d,y-v).normalize(),t[5].setComponents(s+o,c+h,p+d,y+v).normalize(),this},intersectsObject:function(){var e=new o.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:function(){var e=new o.Vector3,t=new o.Vector3;return function(i){for(var r=this.planes,n=0;n<6;n++){var o=r[n];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}},o.Plane=function(e,t){this.normal=void 0!==e?e:new o.Vector3(1,0,0),this.constant=void 0!==t?t:0},o.Plane.prototype={constructor:o.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o.Vector3,t=new o.Vector3;return function(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e);return(t||new o.Vector3).copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectLine:function(){var e=new o.Vector3;return function(t,i){var r=i||new o.Vector3,n=t.delta(e),s=this.normal.dot(n);if(0!==s){var a=-(t.start.dot(this.normal)+this.constant)/s;if(!(a<0||a>1))return r.copy(n).multiplyScalar(a).add(t.start)}else if(0===this.distanceToPoint(t.start))return r.copy(t.start)}}(),coplanarPoint:function(e){return(e||new o.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Matrix3;return function(r,n){var o=n||i.getNormalMatrix(r),s=e.copy(this.normal).applyMatrix3(o),a=this.coplanarPoint(t);return a.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},o.Math={generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),r=0;return function(){for(var n=0;n<36;n++)8===n||13===n||18===n||23===n?i[n]="-":14===n?i[n]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,i[n]=t[19===n?3&e|8:e]);return i.join("")}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}},o.Spline=function(e){function t(e,t,i,r,n,o,s){var a=.5*(i-e),l=.5*(r-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*n+t}this.points=e;var i,r,n,s,a,l,h,c,u,f=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,r=Math.floor(i),n=i-r,f[0]=0===r?r:r-1,f[1]=r,f[2]=r>this.points.length-2?this.points.length-1:r+1,f[3]=r>this.points.length-3?this.points.length-1:r+2,l=this.points[f[0]],h=this.points[f[1]],c=this.points[f[2]],u=this.points[f[3]],s=n*n,a=n*s,d.x=t(l.x,h.x,c.x,u.x,n,s,a),d.y=t(l.y,h.y,c.y,u.y,n,s,a),d.z=t(l.z,h.z,c.z,u.z,n,s,a),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,n,s=0,a=0,l=0,h=new o.Vector3,c=new o.Vector3,u=[],f=0;for(u[0]=0,e||(e=100),r=this.points.length*e,h.copy(this.points[0]),t=1;t<r;t++)i=t/r,n=this.getPoint(i),c.copy(n),f+=c.distanceTo(h),h.copy(n),s=(this.points.length-1)*i,(a=Math.floor(s))!==l&&(u[a]=f,l=a);return u[u.length]=f,{chunks:u,total:f}},this.reparametrizeByArcLength=function(e){var t,i,r,n,s,a,l,h,c=[],u=new o.Vector3,f=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(a=f.chunks[t]-f.chunks[t-1],l=Math.ceil(e*a/f.total),n=(t-1)/(this.points.length-1),s=t/(this.points.length-1),i=1;i<l-1;i++)r=n+i*(1/l)*(s-n),h=this.getPoint(r),c.push(u.copy(h).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},o.Triangle=function(e,t,i){this.a=void 0!==e?e:new o.Vector3,this.b=void 0!==t?t:new o.Vector3,this.c=void 0!==i?i:new o.Vector3},o.Triangle.normal=function(){var e=new o.Vector3;return function(t,i,r,n){var s=n||new o.Vector3;s.subVectors(r,i),e.subVectors(t,i),s.cross(e);var a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}}(),o.Triangle.barycoordFromPoint=function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Vector3;return function(r,n,s,a,l){e.subVectors(a,n),t.subVectors(s,n),i.subVectors(r,n);var h=e.dot(e),c=e.dot(t),u=e.dot(i),f=t.dot(t),d=t.dot(i),p=h*f-c*c,m=l||new o.Vector3;if(0===p)return m.set(-2,-1,-1);var g=1/p,v=(f*u-c*d)*g,y=(h*d-c*u)*g;return m.set(1-v-y,y,v)}}(),o.Triangle.containsPoint=function(){var e=new o.Vector3;return function(t,i,r,n){var s=o.Triangle.barycoordFromPoint(t,i,r,n,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}(),o.Triangle.prototype={constructor:o.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new o.Vector3,t=new o.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new o.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return o.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new o.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return o.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return o.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},o.Channels=function(){this.mask=1},o.Channels.prototype={constructor:o.Channels,set:function(e){this.mask=1<<e},enable:function(e){this.mask|=1<<e},toggle:function(e){this.mask^=1<<e},disable:function(e){this.mask&=~(1<<e)}},o.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},o.Clock.prototype={constructor:o.Clock,start:function(){this.startTime=self.performance.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=self.performance.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},o.EventDispatcher=function(){},o.EventDispatcher.prototype={constructor:o.EventDispatcher,apply:function(e){e.addEventListener=o.EventDispatcher.prototype.addEventListener,e.hasEventListener=o.EventDispatcher.prototype.hasEventListener,e.removeEventListener=o.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=o.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,r=i[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;for(var r=[],n=i.length,o=0;o<n;o++)r[o]=i[o];for(var o=0;o<n;o++)r[o].call(this,e)}}}},function(e){function t(e,t){return e.distance-t.distance}function i(e,t,r,n){if(!1!==e.visible&&(e.raycast(t,r),!0===n))for(var o=e.children,s=0,a=o.length;s<a;s++)i(o[s],t,r,!0)}e.Raycaster=function(t,i,r,n){this.ray=new e.Ray(t,i),this.near=r||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,i){i instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize()):i instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,r){var n=[];return i(e,this,n,r),n.sort(t),n},intersectObjects:function(e,r){var n=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var o=0,s=e.length;o<s;o++)i(e[o],this,n,r);return n.sort(t),n}}}(o),o.Object3D=function(){function e(){n.setFromEuler(r,!1)}function t(){r.setFromQuaternion(n,void 0,!1)}Object.defineProperty(this,"id",{value:o.Object3DIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.channels=new o.Channels,this.children=[],this.up=o.Object3D.DefaultUp.clone();var i=new o.Vector3,r=new o.Euler,n=new o.Quaternion,s=new o.Vector3(1,1,1);r.onChange(e),n.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:i},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:s},modelViewMatrix:{value:new o.Matrix4},normalMatrix:{value:new o.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new o.Matrix4,this.matrixWorld=new o.Matrix4,this.matrixAutoUpdate=o.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},o.Object3D.DefaultUp=new o.Vector3(0,1,0),o.Object3D.DefaultMatrixAutoUpdate=!0,o.Object3D.prototype={constructor:o.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new o.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new o.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o.Vector3;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new o.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new o.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new o.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof o.Object3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var i=this.children.indexOf(e);-1!==i&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1))},getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i],o=n.getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){var t=e||new o.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o.Vector3,t=new o.Vector3;return function(i){var r=i||new o.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new o.Quaternion;return function(t){var i=t||new o.Euler;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new o.Vector3,t=new o.Quaternion;return function(i){var r=i||new o.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new o.Quaternion;return function(t){var i=t||new o.Vector3;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function t(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}var i=void 0===e,r={};i&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===e.geometries[this.geometry.uuid]&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),n.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===e.materials[this.material.uuid]&&(e.materials[this.material.uuid]=this.material.toJSON(e)),n.material=this.material.uuid),this.children.length>0){n.children=[];for(var o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(i){var s=t(e.geometries),a=t(e.materials),l=t(e.textures),h=t(e.images);s.length>0&&(r.geometries=s),a.length>0&&(r.materials=a),l.length>0&&(r.textures=l),h.length>0&&(r.images=h)}return r.object=n,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}},o.EventDispatcher.prototype.apply(o.Object3D.prototype),o.Object3DIdCount=0,o.Face3=function(e,t,i,r,n,s){this.a=e,this.b=t,this.c=i,this.normal=r instanceof o.Vector3?r:new o.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=n instanceof o.Color?n:new o.Color,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==s?s:0},o.Face3.prototype={constructor:o.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},o.Face4=function(e,t,i,r,n,s,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new o.Face3(e,t,i,n,s,a)},o.BufferAttribute=function(e,t){this.uuid=o.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},o.BufferAttribute.prototype={constructor:o.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var s=e[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new o.Color),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];t[i++]=o.a,t[i++]=o.b,t[i++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var s=e[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new o.Vector2),t[i++]=s.x,t[i++]=s.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var s=e[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new o.Vector3),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var s=e[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new o.Vector4),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},clone:function(){return(new this.constructor).copy(this)}},o.Int8Attribute=function(e,t){return new o.BufferAttribute(new Int8Array(e),t)},o.Uint8Attribute=function(e,t){return new o.BufferAttribute(new Uint8Array(e),t)},o.Uint8ClampedAttribute=function(e,t){return new o.BufferAttribute(new Uint8ClampedArray(e),t)},o.Int16Attribute=function(e,t){return new o.BufferAttribute(new Int16Array(e),t)},o.Uint16Attribute=function(e,t){return new o.BufferAttribute(new Uint16Array(e),t)},o.Int32Attribute=function(e,t){return new o.BufferAttribute(new Int32Array(e),t)},o.Uint32Attribute=function(e,t){return new o.BufferAttribute(new Uint32Array(e),t)},o.Float32Attribute=function(e,t){return new o.BufferAttribute(new Float32Array(e),t)},o.Float64Attribute=function(e,t){return new o.BufferAttribute(new Float64Array(e),t)},o.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new o.BufferAttribute(e,t).setDynamic(!0)},o.InstancedBufferAttribute=function(e,t,i){o.BufferAttribute.call(this,e,t),this.meshPerAttribute=i||1},o.InstancedBufferAttribute.prototype=Object.create(o.BufferAttribute.prototype),o.InstancedBufferAttribute.prototype.constructor=o.InstancedBufferAttribute,o.InstancedBufferAttribute.prototype.copy=function(e){return o.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},o.InterleavedBuffer=function(e,t){this.uuid=o.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},o.InterleavedBuffer.prototype={constructor:o.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){!0===e&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},o.InstancedInterleavedBuffer=function(e,t,i){o.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=i||1},o.InstancedInterleavedBuffer.prototype=Object.create(o.InterleavedBuffer.prototype),o.InstancedInterleavedBuffer.prototype.constructor=o.InstancedInterleavedBuffer,o.InstancedInterleavedBuffer.prototype.copy=function(e){return o.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},o.InterleavedBufferAttribute=function(e,t,i){this.uuid=o.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=i},o.InterleavedBufferAttribute.prototype={constructor:o.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}},o.Geometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},o.Geometry.prototype={constructor:o.Geometry,applyMatrix:function(e){for(var t=(new o.Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(var i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,r){return void 0===e&&(e=new o.Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,r){return void 0===e&&(e=new o.Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new o.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,r){var n=void 0!==a?[u[e].clone(),u[t].clone(),u[r].clone()]:[],s=void 0!==l?[i.colors[e].clone(),i.colors[t].clone(),i.colors[r].clone()]:[],p=new o.Face3(e,t,r,n,s);i.faces.push(p),void 0!==h&&i.faceVertexUvs[0].push([f[e].clone(),f[t].clone(),f[r].clone()]),void 0!==c&&i.faceVertexUvs[1].push([d[e].clone(),d[t].clone(),d[r].clone()])}var i=this,r=null!==e.index?e.index.array:void 0,n=e.attributes,s=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,l=void 0!==n.color?n.color.array:void 0,h=void 0!==n.uv?n.uv.array:void 0,c=void 0!==n.uv2?n.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=[],f=[],d=[],p=0,m=0,g=0;p<s.length;p+=3,m+=2,g+=4)i.vertices.push(new o.Vector3(s[p],s[p+1],s[p+2])),void 0!==a&&u.push(new o.Vector3(a[p],a[p+1],a[p+2])),void 0!==l&&i.colors.push(new o.Color(l[p],l[p+1],l[p+2])),void 0!==h&&f.push(new o.Vector2(h[m],h[m+1])),void 0!==c&&d.push(new o.Vector2(c[m],c[m+1]));if(void 0!==r){var v=e.groups;if(v.length>0)for(var p=0;p<v.length;p++)for(var y=v[p],_=y.start,b=y.count,m=_,x=_+b;m<x;m+=3)t(r[m],r[m+1],r[m+2]);else for(var p=0;p<r.length;p+=3)t(r[p],r[p+1],r[p+2])}else for(var p=0;p<s.length/3;p+=3)t(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new o.Matrix4;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new o.Vector3,t=new o.Vector3,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],l=this.vertices[n.c];e.subVectors(l,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,s,a;for(a=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)a[t]=new o.Vector3;if(e){var l,h,c,u=new o.Vector3,f=new o.Vector3;for(r=0,n=this.faces.length;r<n;r++)s=this.faces[r],l=this.vertices[s.a],h=this.vertices[s.b],c=this.vertices[s.c],u.subVectors(c,h),f.subVectors(l,h),u.cross(f),a[s.a].add(u),a[s.b].add(u),a[s.c].add(u)}else for(r=0,n=this.faces.length;r<n;r++)s=this.faces[r],a[s.a].add(s.normal),a[s.b].add(s.normal),a[s.c].add(s.normal);for(t=0,i=this.vertices.length;t<i;t++)a[t].normalize();for(r=0,n=this.faces.length;r<n;r++){s=this.faces[r];var d=s.vertexNormals;3===d.length?(d[0].copy(a[s.a]),d[1].copy(a[s.b]),d[2].copy(a[s.c])):(d[0]=a[s.a].clone(),d[1]=a[s.b].clone(),d[2]=a[s.c].clone())}},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for(n=this.faces[i],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var s=new o.Geometry;for(s.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var a,l,h=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)a=new o.Vector3,l={a:new o.Vector3,b:new o.Vector3,c:new o.Vector3},h.push(a),c.push(l)}var u=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var a,l;for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],a=u.faceNormals[i],l=u.vertexNormals[i],a.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)n=this.faces[i],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e instanceof o.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var r,n=this.vertices.length,s=this.vertices,a=e.vertices,l=this.faces,h=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0];void 0===i&&(i=0),void 0!==t&&(r=(new o.Matrix3).getNormalMatrix(t));for(var f=0,d=a.length;f<d;f++){var p=a[f],m=p.clone();void 0!==t&&m.applyMatrix4(t),s.push(m)}for(f=0,d=h.length;f<d;f++){var g,v,y,_=h[f],b=_.vertexNormals,x=_.vertexColors;g=new o.Face3(_.a+n,_.b+n,_.c+n),g.normal.copy(_.normal),void 0!==r&&g.normal.applyMatrix3(r).normalize();for(var T=0,E=b.length;T<E;T++)v=b[T].clone(),void 0!==r&&v.applyMatrix3(r).normalize(),g.vertexNormals.push(v);g.color.copy(_.color);for(var T=0,E=x.length;T<E;T++)y=x[T],g.vertexColors.push(y.clone());g.materialIndex=_.materialIndex+i,l.push(g)}for(f=0,d=u.length;f<d;f++){var S=u[f],w=[];if(void 0!==S){for(var T=0,E=S.length;T<E;T++)w.push(S[T].clone());c.push(w)}}},mergeMesh:function(e){if(e instanceof o.Mesh==!1)return void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e,t,i,r,n,o,s,a,l={},h=[],c=[],u=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u),void 0===l[t]?(l[t]=i,h.push(this.vertices[i]),c[i]=h.length-1):c[i]=c[l[t]];var f=[];for(i=0,r=this.faces.length;i<r;i++){n=this.faces[i],n.a=c[n.a],n.b=c[n.b],n.c=c[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){d,f.push(i);break}}for(i=f.length-1;i>=0;i--){var p=f[i];for(this.faces.splice(p,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(p,1)}var m=this.vertices.length-h.length;return this.vertices=h,m},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,i=t.length,r=0;r<i;r++)t[r]._id=r;t.sort(e);var n,o,s=this.faceVertexUvs[0],a=this.faceVertexUvs[1];s&&s.length===i&&(n=[]),a&&a.length===i&&(o=[]);for(var r=0;r<i;r++){var l=t[r]._id;n&&n.push(s[l]),o&&o.push(a[l])}n&&(this.faceVertexUvs[0]=n),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==f[t]?f[t]:(f[t]=u.length/3,u.push(e.x,e.y,e.z),f[t])}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=d.length,d.push(e.getHex()),p[t])}function r(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var n={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var s in o)void 0!==o[s]&&(n[s]=o[s]);return n}for(var a=[],l=0;l<this.vertices.length;l++){var h=this.vertices[l];a.push(h.x,h.y,h.z)}for(var c=[],u=[],f={},d=[],p={},m=[],g={},l=0;l<this.faces.length;l++){var v=this.faces[l],y=void 0!==this.faceVertexUvs[0][l],_=v.normal.length()>0,b=v.vertexNormals.length>0,x=1!==v.color.r||1!==v.color.g||1!==v.color.b,T=v.vertexColors.length>0,E=0;if(E=e(E,0,0),E=e(E,1,!1),E=e(E,2,!1),E=e(E,3,y),E=e(E,4,_),E=e(E,5,b),E=e(E,6,x),E=e(E,7,T),c.push(E),c.push(v.a,v.b,v.c),y){var S=this.faceVertexUvs[0][l];c.push(r(S[0]),r(S[1]),r(S[2]))}if(_&&c.push(t(v.normal)),b){var w=v.vertexNormals;c.push(t(w[0]),t(w[1]),t(w[2]))}if(x&&c.push(i(v.color)),T){var M=v.vertexColors;c.push(i(M[0]),i(M[1]),i(M[2]))}}return n.data={},n.data.vertices=a,n.data.normals=u,d.length>0&&(n.data.colors=d),m.length>0&&(n.data.uvs=[m]),n.data.faces=c,n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var t=e.vertices,i=0,r=t.length;i<r;i++)this.vertices.push(t[i].clone());for(var n=e.faces,i=0,r=n.length;i<r;i++)this.faces.push(n[i].clone());for(var i=0,r=e.faceVertexUvs.length;i<r;i++){var o=e.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(var s=0,a=o.length;s<a;s++){for(var l=o[s],h=[],c=0,u=l.length;c<u;c++){var f=l[c];h.push(f.clone())}this.faceVertexUvs[i].push(h)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.Geometry.prototype),o.GeometryIdCount=0,o.DirectGeometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},o.DirectGeometry.prototype={constructor:o.DirectGeometry,computeBoundingBox:o.Geometry.prototype.computeBoundingBox,computeBoundingSphere:o.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){for(var t,i,r=[],n=e.faces,o=0;o<n.length;o++){var s=n[o];s.materialIndex!==i&&(i=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,r.push(t)),t={start:3*o,materialIndex:i})}void 0!==t&&(t.count=3*o-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,l=a.length;if(l>0){for(var h=[],c=0;c<l;c++)h[c]=[];this.morphTargets.position=h}var u=e.morphNormals,f=u.length;if(f>0){for(var d=[],c=0;c<f;c++)d[c]=[];this.morphTargets.normal=d}for(var p=e.skinIndices,m=e.skinWeights,g=p.length===i.length,v=m.length===i.length,c=0;c<t.length;c++){var y=t[c];this.vertices.push(i[y.a],i[y.b],i[y.c]);var _=y.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=y.normal;this.normals.push(b,b,b)}var x=y.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var T=y.color;this.colors.push(T,T,T)}if(!0===n){var E=r[0][c];void 0!==E?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new o.Vector2,new o.Vector2,new o.Vector2))}if(!0===s){var E=r[1][c];void 0!==E?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new o.Vector2,new o.Vector2,new o.Vector2))}for(var S=0;S<l;S++){var w=a[S].vertices;h[S].push(w[y.a],w[y.b],w[y.c])}for(var S=0;S<f;S++){var M=u[S].vertexNormals[c];d[S].push(M.a,M.b,M.c)}g&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.DirectGeometry.prototype),o.BufferGeometry=function(){Object.defineProperty(this,"id",{value:o.GeometryIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},o.BufferGeometry.prototype={constructor:o.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){return t instanceof o.BufferAttribute==!1&&t instanceof o.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new o.BufferAttribute(arguments[1],arguments[2]))):"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):void(this.attributes[e]=t)},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var i=this.attributes.normal;if(void 0!==i){(new o.Matrix3).getNormalMatrix(e).applyToVector3Array(i.array),i.needsUpdate=!0}null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere()},rotateX:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(t){return void 0===e&&(e=new o.Matrix4),e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e;return function(t,i,r){return void 0===e&&(e=new o.Matrix4),e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e;return function(t,i,r){return void 0===e&&(e=new o.Matrix4),e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(t){void 0===e&&(e=new o.Object3D),e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof o.Points||e instanceof o.Line){var i=new o.Float32Attribute(3*t.vertices.length,3),r=new o.Float32Attribute(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new o.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e instanceof o.Mesh&&t instanceof o.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof o.Mesh){var i=t.__directGeometry;if(void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}if(!0===t.verticesNeedUpdate){var r=this.attributes.position;void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){var r=this.attributes.normal;void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){var r=this.attributes.color;void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){var r=this.attributes.uv;void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var r=this.attributes.lineDistance;void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new o.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new o.BufferAttribute(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new o.BufferAttribute(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new o.BufferAttribute(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new o.BufferAttribute(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var s=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new o.BufferAttribute(s,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var a=e.vertices.length>65535?Uint32Array:Uint16Array,l=new a(3*e.indices.length);this.setIndex(new o.BufferAttribute(l,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var h in e.morphTargets){for(var c=[],u=e.morphTargets[h],f=0,d=u.length;f<d;f++){var p=u[f],m=new o.Float32Attribute(3*p.length,3);c.push(m.copyVector3sArray(p))}this.morphAttributes[h]=c}if(e.skinIndices.length>0){var g=new o.Float32Attribute(4*e.skinIndices.length,4);this.addAttribute("skinIndex",g.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var v=new o.Float32Attribute(4*e.skinWeights.length,4);this.addAttribute("skinWeight",v.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new o.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new o.Box3);var t=this.attributes.position.array;if(t){var i=this.boundingBox;i.makeEmpty();for(var r=0,n=t.length;r<n;r+=3)e.fromArray(t,r),i.expandByPoint(e)}void 0!==t&&0!==t.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new o.Box3,t=new o.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere);var i=this.attributes.position.array;if(i){e.makeEmpty();for(var r=this.boundingSphere.center,n=0,s=i.length;n<s;n+=3)t.fromArray(i,n),e.expandByPoint(t);e.center(r);for(var a=0,n=0,s=i.length;n<s;n+=3)t.fromArray(i,n),a=Math.max(a,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new o.BufferAttribute(new Float32Array(r.length),3));else for(var n=t.normal.array,s=0,a=n.length;s<a;s++)n[s]=0;var l,h,c,n=t.normal.array,u=new o.Vector3,f=new o.Vector3,d=new o.Vector3,p=new o.Vector3,m=new o.Vector3;if(e){var g=e.array;0===i.length&&this.addGroup(0,g.length);for(var v=0,y=i.length;v<y;++v)for(var _=i[v],b=_.start,x=_.count,s=b,a=b+x;s<a;s+=3)l=3*g[s+0],h=3*g[s+1],c=3*g[s+2],u.fromArray(r,l),f.fromArray(r,h),d.fromArray(r,c),p.subVectors(d,f),m.subVectors(u,f),p.cross(m),n[l]+=p.x,n[l+1]+=p.y,n[l+2]+=p.z,n[h]+=p.x,n[h+1]+=p.y,n[h+2]+=p.z,n[c]+=p.x,n[c+1]+=p.y,n[c+2]+=p.z}else for(var s=0,a=r.length;s<a;s+=9)u.fromArray(r,s),f.fromArray(r,s+3),d.fromArray(r,s+6),p.subVectors(d,f),m.subVectors(u,f),p.cross(m),n[s]=p.x,n[s+1]=p.y,n[s+2]=p.z,n[s+3]=p.x,n[s+4]=p.y,n[s+5]=p.z,n[s+6]=p.x,n[s+7]=p.y,n[s+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof o.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r],s=n.array,a=e.attributes[r],l=a.array,h=a.itemSize,c=0,u=h*t;c<l.length;c++,u++)s[u]=l[c];return this},normalizeNormals:function(){for(var e,t,i,r,n=this.attributes.normal.array,o=0,s=n.length;o<s;o+=3)e=n[o],t=n[o+1],i=n[o+2],r=1/Math.sqrt(e*e+t*t+i*i),n[o]*=r,n[o+1]*=r,n[o+2]*=r},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:n}}var o=this.attributes;for(var i in o){var s=o[i],n=Array.prototype.slice.call(s.array);e.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:n}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var o=e.groups,s=0,a=o.length;s<a;s++){var l=o[s];this.addGroup(l.start,l.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.BufferGeometry.prototype),o.BufferGeometry.MaxIndex=65535,o.InstancedBufferGeometry=function(){o.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},o.InstancedBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.InstancedBufferGeometry.prototype.constructor=o.InstancedBufferGeometry,o.InstancedBufferGeometry.prototype.addGroup=function(e,t,i){this.groups.push({start:e,count:t,instances:i})},o.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var i=e.attributes;for(var r in i){var n=i[r];this.addAttribute(r,n.clone())}for(var o=e.groups,s=0,a=o.length;s<a;s++){var l=o[s];this.addGroup(l.start,l.count,l.instances)}return this},o.EventDispatcher.prototype.apply(o.InstancedBufferGeometry.prototype),o.AnimationAction=function(e,t,i,r,n){if(void 0===e)throw new Error("clip is null");this.clip=e,this.localRoot=null,this.startTime=t||0,this.timeScale=i||1,this.weight=r||1,this.loop=n||o.LoopRepeat,this.loopCount=0,this.enabled=!0,this.actionTime=-this.startTime,this.clipTime=0,this.propertyBindings=[]},o.AnimationAction.prototype={constructor:o.AnimationAction,setLocalRoot:function(e){return this.localRoot=e,this},updateTime:function(e){var t=this.clipTime,i=this.loopCount,r=(this.actionTime,this.clip.duration);if(this.actionTime=this.actionTime+e,this.loop===o.LoopOnce)return this.loopCount=0,this.clipTime=Math.min(Math.max(this.actionTime,0),r),this.clipTime!==t&&(this.clipTime===r?this.mixer.dispatchEvent({type:"finished",action:this,direction:1}):0===this.clipTime&&this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})),this.clipTime;this.loopCount=Math.floor(this.actionTime/r);var n=this.actionTime-this.loopCount*r;return n%=r,this.loop==o.LoopPingPong&&1===Math.abs(this.loopCount%2)&&(n=r-n),this.clipTime=n,this.loopCount!==i&&this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount}),this.clipTime},syncWith:function(e){return this.actionTime=e.actionTime,this.timeScale=e.timeScale,this},warpToDuration:function(e){return this.timeScale=this.clip.duration/e,this},init:function(e){return this.clipTime=e-this.startTime,this},update:function(e){return this.updateTime(e),this.clip.getAt(this.clipTime)},getTimeScaleAt:function(e){return this.timeScale.getAt?this.timeScale.getAt(e):this.timeScale},getWeightAt:function(e){return this.weight.getAt?this.weight.getAt(e):this.weight}},o.AnimationClip=function(e,t,i){if(this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.duration<0)for(var r=0;r<this.tracks.length;r++){var n=this.tracks[r];this.duration=Math.max(this.duration,n.keys[n.keys.length-1].time)}this.trim(),this.optimize(),this.results=[]},o.AnimationClip.prototype={constructor:o.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++){var i=this.tracks[t];this.results[t]=i.getAt(e)}return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},o.AnimationClip.CreateFromMorphTargetSequence=function(e,t,i){for(var r=t.length,n=[],s=0;s<r;s++){var a=[];a.push({time:(s+r-1)%r,value:0}),a.push({time:s,value:1}),a.push({time:(s+1)%r,value:0}),a.sort(o.KeyframeTrack.keyComparer),0===a[0].time&&a.push({time:r,value:a[0].value}),n.push(new o.NumberKeyframeTrack(".morphTargetInfluences["+t[s].name+"]",a).scale(1/i))}return new o.AnimationClip(e,-1,n)},o.AnimationClip.findByName=function(e,t){for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},o.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){for(var i={},r=/^([\w-]*?)([\d]+)$/,n=0,s=e.length;n<s;n++){var a=e[n],l=a.name.match(r);if(l&&l.length>1){var h=l[1],c=i[h];c||(i[h]=c=[]),c.push(a)}}var u=[];for(var h in i)u.push(o.AnimationClip.CreateFromMorphTargetSequence(h,i[h],t));return u},o.AnimationClip.parse=function(e){for(var t=[],i=0;i<e.tracks.length;i++)t.push(o.KeyframeTrack.parse(e.tracks[i]).scale(1/e.fps));return new o.AnimationClip(e.name,e.duration,t)},o.AnimationClip.parseAnimation=function(e,t,i){if(!e)return console.error("  no animation in JSONLoader data"),null;for(var r=function(e,t,i,r,n){for(var o=[],s=0;s<t.length;s++){var a=t[s];void 0!==a[i]&&o.push({time:a.time,value:n(a)})}return o.length>0?new r(e,o):null},n=[],s=e.name||"default",a=e.length||-1,l=e.fps||30,h=e.hierarchy||[],c=0;c<h.length;c++){var u=h[c].keys;if(u&&0!=u.length)if(u[0].morphTargets){for(var f={},d=0;d<u.length;d++)if(u[d].morphTargets)for(var p=0;p<u[d].morphTargets.length;p++)f[u[d].morphTargets[p]]=-1;for(var m in f){for(var g=[],p=0;p<u[d].morphTargets.length;p++){var v=u[d];g.push({time:v.time,value:v.morphTarget===m?1:0})}n.push(new o.NumberKeyframeTrack(i+".morphTargetInfluence["+m+"]",g))}a=f.length*(l||1)}else{var y=i+".bones["+t[c].name+"]",_=r(y+".position",u,"pos",o.VectorKeyframeTrack,function(e){return(new o.Vector3).fromArray(e.pos)});_&&n.push(_);var b=r(y+".quaternion",u,"rot",o.QuaternionKeyframeTrack,function(e){return e.rot.slerp?e.rot.clone():(new o.Quaternion).fromArray(e.rot)});b&&n.push(b);var x=r(y+".scale",u,"scl",o.VectorKeyframeTrack,function(e){return(new o.Vector3).fromArray(e.scl)});x&&n.push(x)}}return 0===n.length?null:new o.AnimationClip(s,a,n)},o.AnimationMixer=function(e){this.root=e,this.time=0,this.timeScale=1,this.actions=[],this.propertyBindingMap={}},o.AnimationMixer.prototype={constructor:o.AnimationMixer,addAction:function(e){this.actions.push(e),e.init(this.time),e.mixer=this;for(var t=e.clip.tracks,i=e.localRoot||this.root,r=0;r<t.length;r++){var n=t[r],s=i.uuid+"-"+n.name,a=this.propertyBindingMap[s];void 0===a&&(a=new o.PropertyBinding(i,n.name),this.propertyBindingMap[s]=a),e.propertyBindings.push(a),a.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++)this.actions[e].mixer=null;for(var t in this.propertyBindingMap)this.propertyBindingMap[t].unbind();return this.actions=[],this.propertyBindingMap={},this},removeAction:function(e){var t=this.actions.indexOf(e);-1!==t&&(this.actions.splice(t,1),e.mixer=null);for(var i=e.localRoot||this.root,r=e.clip.tracks,n=0;n<r.length;n++){var o=r[n],s=i.uuid+"-"+o.name,a=this.propertyBindingMap[s];a.referenceCount-=1,a.referenceCount<=0&&(a.unbind(),delete this.propertyBindingMap[s])}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++)if(this.actions[t].name===e)return this.actions[t];return null},play:function(e,t){return e.startTime=this.time,this.addAction(e),this},fadeOut:function(e,t){var i=[];return i.push({time:this.time,value:1}),i.push({time:this.time+t,value:0}),e.weight=new o.NumberKeyframeTrack("weight",i),this},fadeIn:function(e,t){var i=[];return i.push({time:this.time,value:0}),i.push({time:this.time+t,value:1}),e.weight=new o.NumberKeyframeTrack("weight",i),this},warp:function(e,t,i,r){var n=[];return n.push({time:this.time,value:t}),n.push({time:this.time+r,value:i}),e.timeScale=new o.NumberKeyframeTrack("timeScale",n),this},crossFade:function(e,t,i,r){if(this.fadeOut(e,i),this.fadeIn(t,i),r){var n=e.clip.duration/t.clip.duration,o=1/n;this.warp(e,1,n,i),this.warp(t,o,1,i)}return this},update:function(e){var t=e*this.timeScale;this.time+=t;for(var i=0;i<this.actions.length;i++){var r=this.actions[i],n=r.getWeightAt(this.time),o=r.getTimeScaleAt(this.time),s=t*o,a=r.update(s);if(!(r.weight<=0)&&r.enabled)for(var l=0;l<a.length;l++){r.clip.tracks[l].name;r.propertyBindings[l].accumulate(a[l],n)}}for(var h in this.propertyBindingMap)this.propertyBindingMap[h].apply();return this}},o.EventDispatcher.prototype.apply(o.AnimationMixer.prototype),o.AnimationUtils={getEqualsFunc:function(e){return e.equals?function(e,t){return e.equals(t)}:function(e,t){return e===t}},clone:function(e){if("object"==typeof e){if(e.clone)return e.clone();console.error("can not figure out how to copy exemplarValue",e)}return e},lerp:function(e,t,i,r){return o.AnimationUtils.getLerpFunc(e,r)(e,t,i)},lerp_object:function(e,t,i){return e.lerp(t,i)},slerp_object:function(e,t,i){return e.slerp(t,i)},lerp_number:function(e,t,i){return e*(1-i)+t*i},lerp_boolean:function(e,t,i){return i<.5?e:t},lerp_boolean_immediate:function(e,t,i){return e},lerp_string:function(e,t,i){return i<.5?e:t},lerp_string_immediate:function(e,t,i){return e},getLerpFunc:function(e,t){if(void 0===e||null===e)throw new Error("examplarValue is null");switch(typeof e){case"object":if(e.lerp)return o.AnimationUtils.lerp_object;if(e.slerp)return o.AnimationUtils.slerp_object;break;case"number":return o.AnimationUtils.lerp_number;case"boolean":return t?o.AnimationUtils.lerp_boolean:o.AnimationUtils.lerp_boolean_immediate;case"string":return t?o.AnimationUtils.lerp_string:o.AnimationUtils.lerp_string_immediate}}},o.KeyframeTrack=function(e,t){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keys in track named "+e);this.name=e,this.keys=t,this.lastIndex=0,this.validate(),this.optimize()},o.KeyframeTrack.prototype={constructor:o.KeyframeTrack,getAt:function(e){for(;this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time;)this.lastIndex++;for(;this.lastIndex>0&&e<this.keys[this.lastIndex-1].time;)this.lastIndex--;if(this.lastIndex>=this.keys.length)return this.setResult(this.keys[this.keys.length-1].value),this.result;if(0===this.lastIndex)return this.setResult(this.keys[0].value),this.result;var t=this.keys[this.lastIndex-1];if(this.setResult(t.value),t.constantToNext)return this.result;var i=this.keys[this.lastIndex],r=(e-t.time)/(i.time-t.time);return this.result=this.lerpValues(this.result,i.value,r),this.result},shift:function(e){if(0!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time+=e;return this},scale:function(e){if(1!==e)for(var t=0;t<this.keys.length;t++)this.keys[t].time*=e;return this},trim:function(e,t){for(var i=0,r=1;r<this.keys.length;r++)this.keys[r]<=e&&i++;for(var n=0,r=this.keys.length-2;r>0&&this.keys[r]>=t;r++)n++;return i+n>0&&(this.keys=this.keys.splice(i,this.keys.length-n-i)),this},validate:function(){var e=null;if(0===this.keys.length)return void console.error("  track is empty, no keys",this);for(var t=0;t<this.keys.length;t++){var i=this.keys[t];if(!i)return void console.error("  key is null in track",this,t);if("number"!=typeof i.time||isNaN(i.time))return void console.error("  key.time is not a valid number",this,t,i);if(void 0===i.value||null===i.value)return void console.error("  key.value is null in track",this,t,i);if(e&&e.time>i.time)return void console.error("  key.time is less than previous key time, out of order keys",this,t,i,e);e=i}return this},optimize:function(){var e=[],t=this.keys[0];e.push(t);for(var i=(o.AnimationUtils.getEqualsFunc(t.value),1);i<this.keys.length-1;i++){var r=this.keys[i],n=this.keys[i+1];t.time!==r.time&&(this.compareValues(t.value,r.value)&&this.compareValues(r.value,n.value)||(t.constantToNext=this.compareValues(t.value,r.value),e.push(r),t=r))}return e.push(this.keys[this.keys.length-1]),this.keys=e,this}},o.KeyframeTrack.keyComparer=function(e,t){return e.time-t.time},o.KeyframeTrack.parse=function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");return o.KeyframeTrack.GetTrackTypeForTypeName(e.type).parse(e)},o.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return o.VectorKeyframeTrack;case"quaternion":return o.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return o.NumberKeyframeTrack;case"bool":case"boolean":return o.BooleanKeyframeTrack;case"string":return o.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)},o.PropertyBinding=function(e,t){this.rootNode=e,this.trackName=t,this.referenceCount=0,this.originalValue=null;var i=o.PropertyBinding.parseTrackName(t);this.directoryName=i.directoryName,this.nodeName=i.nodeName,this.objectName=i.objectName,this.objectIndex=i.objectIndex,this.propertyName=i.propertyName,this.propertyIndex=i.propertyIndex,this.node=o.PropertyBinding.findNode(e,this.nodeName)||e,this.cumulativeValue=null,this.cumulativeWeight=0},o.PropertyBinding.prototype={constructor:o.PropertyBinding,reset:function(){this.cumulativeValue=null,this.cumulativeWeight=0},accumulate:function(e,t){if(this.isBound||this.bind(),0===this.cumulativeWeight)t>0&&(null===this.cumulativeValue&&(this.cumulativeValue=o.AnimationUtils.clone(e)),this.cumulativeWeight=t);else{var i=t/(this.cumulativeWeight+t);this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,i),this.cumulativeWeight+=t}},unbind:function(){this.isBound&&(this.setValue(this.originalValue),this.setValue=null,this.getValue=null,this.lerpValue=null,this.equalsValue=null,this.triggerDirty=null,this.isBound=!1)},bind:function(){if(!this.isBound){var e=this.node;if(!e)return void console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.");if(this.objectName){if("materials"===this.objectName){if(!e.material)return void console.error("  can not bind to material as node does not have a material",this);if(!e.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);e=e.material.materials}else if("bones"===this.objectName){if(!e.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);e=e.skeleton.bones;for(var t=0;t<e.length;t++)if(e[t].name===this.objectIndex){this.objectIndex=t;break}}else{if(void 0===e[this.objectName])return void console.error("  can not bind to objectName of node, undefined",this);e=e[this.objectName]}if(void 0!==this.objectIndex){if(void 0===e[this.objectIndex])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);e=e[this.objectIndex]}}var i=e[this.propertyName];if(!i)return void console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",e);if(void 0!==this.propertyIndex){if("morphTargetInfluences"===this.propertyName){e.geometry||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this),e.geometry.morphTargets||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var t=0;t<this.node.geometry.morphTargets.length;t++)if(e.geometry.morphTargets[t].name===this.propertyIndex){this.propertyIndex=t;break}}this.setValue=function(e){return!this.equalsValue(i[this.propertyIndex],e)&&(i[this.propertyIndex]=e,!0)},this.getValue=function(){return i[this.propertyIndex]}}else i.copy?(this.setValue=function(e){return!this.equalsValue(i,e)&&(i.copy(e),!0)},this.getValue=function(){return i}):(this.setValue=function(t){return!this.equalsValue(e[this.propertyName],t)&&(e[this.propertyName]=t,!0)},this.getValue=function(){return e[this.propertyName]});void 0!==e.needsUpdate?this.triggerDirty=function(){this.node.needsUpdate=!0}:void 0!==e.matrixWorldNeedsUpdate&&(this.triggerDirty=function(){e.matrixWorldNeedsUpdate=!0}),this.originalValue=this.getValue(),this.equalsValue=o.AnimationUtils.getEqualsFunc(this.originalValue),this.lerpValue=o.AnimationUtils.getLerpFunc(this.originalValue,!0),this.isBound=!0}},apply:function(){if(this.isBound||this.bind(),this.cumulativeWeight>0){if(this.cumulativeWeight<1){var e=1-this.cumulativeWeight,t=e/(this.cumulativeWeight+e);this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,t)}this.setValue(this.cumulativeValue)&&this.triggerDirty&&this.triggerDirty(),this.cumulativeValue=null,this.cumulativeWeight=0}}},o.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,i=t.exec(e);if(!i)throw new Error("cannot parse trackName at all: "+e);i.index===t.lastIndex&&t.lastIndex++;var r={directoryName:i[1],nodeName:i[3],objectName:i[5],objectIndex:i[7],propertyName:i[9],propertyIndex:i[11]};if(null===r.propertyName||0===r.propertyName.length)throw new Error("can not parse propertyName from trackName: "+e);return r},o.PropertyBinding.findNode=function(e,t){function i(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.name===t||n.uuid===t)return n;var o=i(n.children);if(o)return o}return null}if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=function(e){for(var i=0;i<e.bones.length;i++){var r=e.bones[i];if(r.name===t)return r}return null}(e.skeleton);if(r)return r}if(e.children){var n=i(e.children);if(n)return n}return null},o.VectorKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},o.VectorKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.VectorKeyframeTrack.prototype.constructor=o.VectorKeyframeTrack,o.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},o.VectorKeyframeTrack.prototype.lerpValues=function(e,t,i){return e.lerp(t,i)},o.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},o.VectorKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var i=this.keys[t];e.push({time:i.time,value:i.value.clone()})}return new o.VectorKeyframeTrack(this.name,e)},o.VectorKeyframeTrack.parse=function(e){for(var t=e.keys[0].value.length,i=o["Vector"+t],r=[],n=0;n<e.keys.length;n++){var s=e.keys[n];r.push({value:(new i).fromArray(s.value),time:s.time})}return new o.VectorKeyframeTrack(e.name,r)},o.QuaternionKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},o.QuaternionKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.QuaternionKeyframeTrack.prototype.constructor=o.QuaternionKeyframeTrack,o.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},o.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,i){return e.slerp(t,i)},o.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},o.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].value.multiply(e);return this},o.QuaternionKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var i=this.keys[t];e.push({time:i.time,value:i.value.clone()})}return new o.QuaternionKeyframeTrack(this.name,e)},o.QuaternionKeyframeTrack.parse=function(e){for(var t=[],i=0;i<e.keys.length;i++){var r=e.keys[i];t.push({value:(new o.Quaternion).fromArray(r.value),time:r.time})}return new o.QuaternionKeyframeTrack(e.name,t)},o.StringKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.StringKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.StringKeyframeTrack.prototype.constructor=o.StringKeyframeTrack,o.StringKeyframeTrack.prototype.setResult=function(e){this.result=e},o.StringKeyframeTrack.prototype.lerpValues=function(e,t,i){return i<1?e:t},o.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.StringKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var i=this.keys[t];e.push({time:i.time,value:i.value})}return new o.StringKeyframeTrack(this.name,e)},o.StringKeyframeTrack.parse=function(e){return new o.StringKeyframeTrack(e.name,e.keys)},o.BooleanKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.BooleanKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.BooleanKeyframeTrack.prototype.constructor=o.BooleanKeyframeTrack,o.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e},o.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,i){return i<1?e:t},o.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.BooleanKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var i=this.keys[t];e.push({time:i.time,value:i.value})}return new o.BooleanKeyframeTrack(this.name,e)},o.BooleanKeyframeTrack.parse=function(e){return new o.BooleanKeyframeTrack(e.name,e.keys)},o.NumberKeyframeTrack=function(e,t){o.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},o.NumberKeyframeTrack.prototype=Object.create(o.KeyframeTrack.prototype),o.NumberKeyframeTrack.prototype.constructor=o.NumberKeyframeTrack,o.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e},o.NumberKeyframeTrack.prototype.lerpValues=function(e,t,i){return e*(1-i)+t*i},o.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t},o.NumberKeyframeTrack.prototype.clone=function(){for(var e=[],t=0;t<this.keys.length;t++){var i=this.keys[t];e.push({time:i.time,value:i.value})}return new o.NumberKeyframeTrack(this.name,e)},o.NumberKeyframeTrack.parse=function(e){return new o.NumberKeyframeTrack(e.name,e.keys)},o.Camera=function(){o.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new o.Matrix4,this.projectionMatrix=new o.Matrix4},o.Camera.prototype=Object.create(o.Object3D.prototype),o.Camera.prototype.constructor=o.Camera,o.Camera.prototype.getWorldDirection=function(){var e=new o.Quaternion;return function(t){var i=t||new o.Vector3;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),o.Camera.prototype.lookAt=function(){var e=new o.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),o.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},o.Camera.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},o.CubeCamera=function(e,t,i){o.Object3D.call(this),this.type="CubeCamera";var r=new o.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new o.Vector3(1,0,0)),this.add(r);var n=new o.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new o.Vector3(-1,0,0)),this.add(n);var s=new o.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new o.Vector3(0,1,0)),this.add(s);var a=new o.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1),a.lookAt(new o.Vector3(0,-1,0)),this.add(a);var l=new o.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new o.Vector3(0,0,1)),this.add(l);var h=new o.PerspectiveCamera(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new o.Vector3(0,0,-1)),this.add(h),this.renderTarget=new o.WebGLRenderTargetCube(i,i,{format:o.RGBFormat,magFilter:o.LinearFilter,minFilter:o.LinearFilter}),this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,o=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,n,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,l,i),i.texture.generateMipmaps=o,i.activeCubeFace=5,e.render(t,h,i),e.setRenderTarget(null)}},o.CubeCamera.prototype=Object.create(o.Object3D.prototype),o.CubeCamera.prototype.constructor=o.CubeCamera,o.OrthographicCamera=function(e,t,i,r,n,s){o.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},o.OrthographicCamera.prototype=Object.create(o.Camera.prototype),o.OrthographicCamera.prototype.constructor=o.OrthographicCamera,o.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(i-e,i+e,r+t,r-t,this.near,this.far)},o.OrthographicCamera.prototype.copy=function(e){return o.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},o.OrthographicCamera.prototype.toJSON=function(e){var t=o.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},o.PerspectiveCamera=function(e,t,i,r){o.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype=Object.create(o.Camera.prototype),o.PerspectiveCamera.prototype.constructor=o.PerspectiveCamera,o.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*o.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,n,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=n,this.height=o,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=o.Math.radToDeg(2*Math.atan(Math.tan(.5*o.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,i=Math.tan(o.Math.degToRad(.5*e))*this.near,r=-i,n=t*r,s=t*i,a=Math.abs(s-n),l=Math.abs(i-r);this.projectionMatrix.makeFrustum(n+this.x*a/this.fullWidth,n+(this.x+this.width)*a/this.fullWidth,i-(this.y+this.height)*l/this.fullHeight,i-this.y*l/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},o.PerspectiveCamera.prototype.copy=function(e){return o.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},o.PerspectiveCamera.prototype.toJSON=function(e){var t=o.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.fov=this.fov,t.object.aspect=this.aspect,t.object.near=this.near,t.object.far=this.far,t},o.Light=function(e){o.Object3D.call(this),this.type="Light",this.color=new o.Color(e),this.receiveShadow=void 0},o.Light.prototype=Object.create(o.Object3D.prototype),o.Light.prototype.constructor=o.Light,Object.defineProperties(o.Light.prototype,{onlyShadow:{set:function(e){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){this.shadow.camera.far=e}},shadowCameraVisible:{set:function(e){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow ) instead.")}},shadowBias:{set:function(e){this.shadow.bias=e}},shadowDarkness:{set:function(e){this.shadow.darkness=e}},shadowMapWidth:{set:function(e){this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){this.shadow.mapSize.height=e}}}),o.Light.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this},o.Light.prototype.toJSON=function(e){var t=o.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.intensity&&(t.object.intensity=this.intensity),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.exponent&&(t.object.exponent=this.exponent),t},o.LightShadow=function(e){this.camera=e,this.bias=0,this.darkness=1,this.mapSize=new o.Vector2(512,512),this.map=null,this.matrix=null},o.LightShadow.prototype={constructor:o.LightShadow,copy:function(e){this.camera=e.camera.clone(),this.bias=e.bias,this.darkness=e.darkness,this.mapSize.copy(e.mapSize)},clone:function(){return(new this.constructor).copy(this)}},o.AmbientLight=function(e){o.Light.call(this,e),this.type="AmbientLight",this.castShadow=void 0},o.AmbientLight.prototype=Object.create(o.Light.prototype),o.AmbientLight.prototype.constructor=o.AmbientLight,o.DirectionalLight=function(e,t){o.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.shadow=new o.LightShadow(new o.OrthographicCamera(-500,500,500,-500,50,5e3))},o.DirectionalLight.prototype=Object.create(o.Light.prototype),o.DirectionalLight.prototype.constructor=o.DirectionalLight,o.DirectionalLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},o.HemisphereLight=function(e,t,i){o.Light.call(this,e),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new o.Color(t),this.intensity=void 0!==i?i:1},o.HemisphereLight.prototype=Object.create(o.Light.prototype),o.HemisphereLight.prototype.constructor=o.HemisphereLight,o.HemisphereLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this.intensity=e.intensity,this},o.PointLight=function(e,t,i,r){o.Light.call(this,e),this.type="PointLight",this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new o.LightShadow(new o.PerspectiveCamera(90,1,1,500))},o.PointLight.prototype=Object.create(o.Light.prototype),o.PointLight.prototype.constructor=o.PointLight,o.PointLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this},o.SpotLight=function(e,t,i,r,n,s){o.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==n?n:10,this.decay=void 0!==s?s:1,this.shadow=new o.LightShadow(new o.PerspectiveCamera(50,1,50,5e3))},o.SpotLight.prototype=Object.create(o.Light.prototype),o.SpotLight.prototype.constructor=o.SpotLight,o.SpotLight.prototype.copy=function(e){return o.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this},o.Cache={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},o.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},o.Loader.prototype={constructor:o.Loader,crossOrigin:void 0,extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:function(){var e,t,i;return function(r,n,s){function a(e,i,r,a,h){var c,u=n+e,f=o.Loader.Handlers.get(u);null!==f?c=f.load(u):(t.setCrossOrigin(s),c=t.load(u)),void 0!==i&&(c.repeat.fromArray(i),1!==i[0]&&(c.wrapS=o.RepeatWrapping),1!==i[1]&&(c.wrapT=o.RepeatWrapping)),void 0!==r&&c.offset.fromArray(r),void 0!==a&&("repeat"===a[0]&&(c.wrapS=o.RepeatWrapping),"mirror"===a[0]&&(c.wrapS=o.MirroredRepeatWrapping),"repeat"===a[1]&&(c.wrapT=o.RepeatWrapping),"mirror"===a[1]&&(c.wrapT=o.MirroredRepeatWrapping)),void 0!==h&&(c.anisotropy=h);var d=o.Math.generateUUID();return l[d]=c,d}void 0===e&&(e=new o.Color),void 0===t&&(t=new o.TextureLoader),void 0===i&&(i=new o.MaterialLoader);var l={},h={uuid:o.Math.generateUUID(),type:"MeshLambertMaterial"};for(var c in r){var u=r[c];switch(c){case"DbgColor":h.color=u;break;case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":h.name=u;break;case"blending":h.blending=o[u];break;case"colorDiffuse":h.color=e.fromArray(u).getHex();break;case"colorSpecular":h.specular=e.fromArray(u).getHex();break;case"colorEmissive":h.emissive=e.fromArray(u).getHex();break;case"specularCoef":h.shininess=u;break;case"shading":"basic"===u.toLowerCase()&&(h.type="MeshBasicMaterial"),"phong"===u.toLowerCase()&&(h.type="MeshPhongMaterial");break;case"mapDiffuse":h.map=a(u,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":h.lightMap=a(u,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":h.aoMap=a(u,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":h.bumpMap=a(u,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":h.bumpScale=u;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":h.normalMap=a(u,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":h.normalScale=[u,u];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":h.specularMap=a(u,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":h.alphaMap=a(u,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":h.side=o.BackSide;break;case"doubleSided":h.side=o.DoubleSide;break;case"transparency":console.warn("THREE.Loader: transparency has been renamed to opacity"),h.opacity=u;break;case"opacity":case"transparent":case"depthTest":case"depthWrite":case"transparent":case"visible":case"wireframe":h[c]=u;break;case"vertexColors":!0===u&&(h.vertexColors=o.VertexColors),"face"===u&&(h.vertexColors=o.FaceColors);break;default:console.error("Loader.createMaterial: Unsupported",c,u)}}return"MeshPhongMaterial"!==h.type&&delete h.specular,h.opacity<1&&(h.transparent=!0),i.setTextures(l),i.parse(h)}}()},o.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;i<r;i+=2){var n=t[i],o=t[i+1];if(n.test(e))return o}return null}},o.XHRLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.XHRLoader.prototype={constructor:o.XHRLoader,load:function(e,t,i,r){var n=this,s=o.Cache.get(e);if(void 0!==s)return t&&setTimeout(function(){t(s)},0),s;var a=new XMLHttpRequest;return a.open("GET",e,!0),a.addEventListener("load",function(i){var r=i.target.response;o.Cache.add(e,r),t&&t(r),n.manager.itemEnd(e)},!1),void 0!==i&&a.addEventListener("progress",function(e){i(e)},!1),a.addEventListener("error",function(t){r&&r(t),n.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.send(null),n.manager.itemStart(e),a},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}},o.ImageLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.ImageLoader.prototype={constructor:o.ImageLoader,load:function(e,t,i,r){var n=this,s=o.Cache.get(e);if(void 0!==s)return n.manager.itemStart(e),t?setTimeout(function(){t(s),n.manager.itemEnd(e)},0):n.manager.itemEnd(e),s;var a=document.createElement("img");return a.addEventListener("load",function(i){o.Cache.add(e,this),t&&t(this),n.manager.itemEnd(e)},!1),void 0!==i&&a.addEventListener("progress",function(e){i(e)},!1),a.addEventListener("error",function(t){r&&r(t),console.log("-----\x3eerror",e),n.manager.itemError(e)},!1),void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a},setCrossOrigin:function(e){this.crossOrigin=e}},o.JSONLoader=function(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:o.DefaultLoadingManager,this.withCredentials=!1},o.JSONLoader.prototype={constructor:o.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,i,r){var n=this,s=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:o.Loader.prototype.extractUrlBase(e),a=new o.XHRLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setWithCredentials(this.withCredentials),a.load(e,function(i){var r=JSON.parse(i),o=r.metadata;if(void 0!==o){if("object"===o.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===o.type)return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}var a=n.parse(r,s);t(a.geometry,a.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){var i=new o.Geometry,r=void 0!==e.scale?1/e.scale:1;if(function(t){function r(e,t){return e&1<<t}var n,s,a,l,h,c,u,f,d,p,m,g,v,y,_,b,x,T,E,S,w,M,A,P,C,R,D,I=e.faces,O=e.vertices,F=e.normals,L=e.colors,B=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&B++;for(n=0;n<B;n++)i.faceVertexUvs[n]=[]}for(l=0,h=O.length;l<h;)T=new o.Vector3,T.x=O[l++]*t,T.y=O[l++]*t,T.z=O[l++]*t,i.vertices.push(T);for(l=0,h=I.length;l<h;)if(p=I[l++],m=r(p,0),g=r(p,1),v=r(p,3),y=r(p,4),_=r(p,5),b=r(p,6),x=r(p,7),m){if(S=new o.Face3,S.a=I[l],S.b=I[l+1],S.c=I[l+3],w=new o.Face3,w.a=I[l+1],w.b=I[l+2],w.c=I[l+3],l+=4,g&&(d=I[l++],S.materialIndex=d,w.materialIndex=d),a=i.faces.length,v)for(n=0;n<B;n++)for(P=e.uvs[n],i.faceVertexUvs[n][a]=[],i.faceVertexUvs[n][a+1]=[],s=0;s<4;s++)f=I[l++],R=P[2*f],D=P[2*f+1],C=new o.Vector2(R,D),2!==s&&i.faceVertexUvs[n][a].push(C),0!==s&&i.faceVertexUvs[n][a+1].push(C);if(y&&(u=3*I[l++],S.normal.set(F[u++],F[u++],F[u]),w.normal.copy(S.normal)),_)for(n=0;n<4;n++)u=3*I[l++],A=new o.Vector3(F[u++],F[u++],F[u]),2!==n&&S.vertexNormals.push(A),0!==n&&w.vertexNormals.push(A);if(b&&(c=I[l++],M=L[c],S.color.setHex(M),w.color.setHex(M)),x)for(n=0;n<4;n++)c=I[l++],M=L[c],2!==n&&S.vertexColors.push(new o.Color(M)),0!==n&&w.vertexColors.push(new o.Color(M));i.faces.push(S),i.faces.push(w)}else{if(E=new o.Face3,E.a=I[l++],E.b=I[l++],E.c=I[l++],g&&(d=I[l++],E.materialIndex=d),a=i.faces.length,v)for(n=0;n<B;n++)for(P=e.uvs[n],i.faceVertexUvs[n][a]=[],s=0;s<3;s++)f=I[l++],R=P[2*f],D=P[2*f+1],C=new o.Vector2(R,D),i.faceVertexUvs[n][a].push(C);if(y&&(u=3*I[l++],E.normal.set(F[u++],F[u++],F[u])),_)for(n=0;n<3;n++)u=3*I[l++],A=new o.Vector3(F[u++],F[u++],F[u]),E.vertexNormals.push(A);if(b&&(c=I[l++],E.color.setHex(L[c])),x)for(n=0;n<3;n++)c=I[l++],E.vertexColors.push(new o.Color(L[c]));i.faces.push(E)}}(r),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=t){var s=e.skinWeights[r],a=t>1?e.skinWeights[r+1]:0,l=t>2?e.skinWeights[r+2]:0,h=t>3?e.skinWeights[r+3]:0;i.skinWeights.push(new o.Vector4(s,a,l,h))}if(e.skinIndices)for(var r=0,n=e.skinIndices.length;r<n;r+=t){var c=e.skinIndices[r],u=t>1?e.skinIndices[r+1]:0,f=t>2?e.skinIndices[r+2]:0,d=t>3?e.skinIndices[r+3]:0;i.skinIndices.push(new o.Vector4(c,u,f,d))}i.bones=e.bones,i.bones&&i.bones.length>0&&(i.skinWeights.length!==i.skinIndices.length||i.skinIndices.length!==i.vertices.length)&&console.warn("When skinning, number of vertices ("+i.vertices.length+"), skinIndices ("+i.skinIndices.length+"), and skinWeights ("+i.skinWeights.length+") should match.")}(),function(t){if(void 0!==e.morphTargets)for(var r=0,n=e.morphTargets.length;r<n;r++){i.morphTargets[r]={},i.morphTargets[r].name=e.morphTargets[r].name,i.morphTargets[r].vertices=[];for(var s=i.morphTargets[r].vertices,a=e.morphTargets[r].vertices,l=0,h=a.length;l<h;l+=3){var c=new o.Vector3;c.x=a[l]*t,c.y=a[l+1]*t,c.z=a[l+2]*t,s.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var u=i.faces,f=e.morphColors[0].colors,r=0,n=u.length;r<n;r++)u[r].color.fromArray(f,3*r)}}(r),function(){var t=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var n=0;n<r.length;n++){var s=o.AnimationClip.parseAnimation(r[n],i.bones);s&&t.push(s)}if(i.morphTargets){var a=o.AnimationClip.CreateClipsFromMorphTargetSequences(i.morphTargets,10);t=t.concat(a)}t.length>0&&(i.animations=t)}(),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length)return{geometry:i};var n=o.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:i,materials:n}}},o.LoadingManager=function(e,t,i){var r=this,n=!1,o=0,s=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,s),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)}},o.DefaultLoadingManager=new o.LoadingManager,o.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.BufferGeometryLoader.prototype={constructor:o.BufferGeometryLoader,load:function(e,t,i,r){var n=this,s=new o.XHRLoader(n.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new o.BufferGeometry,i=e.data.index;if(void 0!==i){var r=new self[i.type](i.array);t.setIndex(new o.BufferAttribute(r,1))}var n=e.data.attributes;for(var s in n){var a=n[s],r=new self[a.type](a.array);t.addAttribute(s,new o.BufferAttribute(r,a.itemSize))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(var h=0,c=l.length;h!==c;++h){var u=l[h];t.addGroup(u.start,u.count)}var f=e.data.boundingSphere;if(void 0!==f){var d=new o.Vector3;void 0!==f.center&&d.fromArray(f.center),t.boundingSphere=new o.Sphere(d,f.radius)}return t}},o.MaterialLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this.textures={}},o.MaterialLoader.prototype={constructor:o.MaterialLoader,load:function(e,t,i,r){var n=this,s=new o.XHRLoader(n.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(n.parse(JSON.parse(e)))},i,r)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new o[e.type];if(t.uuid=e.uuid,void 0!==e.name&&(t.name=e.name),void 0!==e.color&&t.color.setHex(e.color),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.uniforms&&(t.uniforms=e.uniforms),void 0!==e.vertexShader&&(t.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(t.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.shading&&(t.shading=e.shading),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.alphaTest&&(t.alphaTest=e.alphaTest),void 0!==e.depthTest&&(t.depthTest=e.depthTest),void 0!==e.depthWrite&&(t.depthWrite=e.depthWrite),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(t.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.size&&(t.size=e.size),void 0!==e.sizeAttenuation&&(t.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(t.map=this.getTexture(e.map)),void 0!==e.alphaMap&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),void 0!==e.bumpMap&&(t.bumpMap=this.getTexture(e.bumpMap)),void 0!==e.bumpScale&&(t.bumpScale=e.bumpScale),void 0!==e.normalMap&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale&&(t.normalScale=new o.Vector2(e.normalScale,e.normalScale)),void 0!==e.displacementMap&&(t.displacementMap=this.getTexture(e.displacementMap)),void 0!==e.displacementScale&&(t.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(t.displacementBias=e.displacementBias),void 0!==e.specularMap&&(t.specularMap=this.getTexture(e.specularMap)),void 0!==e.envMap&&(t.envMap=this.getTexture(e.envMap),t.combine=o.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),void 0!==e.lightMap&&(t.lightMap=this.getTexture(e.lightMap)),void 0!==e.lightMapIntensity&&(t.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(t.aoMap=this.getTexture(e.aoMap)),void 0!==e.aoMapIntensity&&(t.aoMapIntensity=e.aoMapIntensity),void 0!==e.materials)for(var i=0,r=e.materials.length;i<r;i++)t.materials.push(this.parse(e.materials[i]));return t}},o.ObjectLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this.texturePath=""},o.ObjectLoader.prototype={constructor:o.ObjectLoader,load:function(e,t,i,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this,s=new o.XHRLoader(n.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){n.parse(JSON.parse(e),t)},i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseGeometries(e.geometries),r=this.parseImages(e.images,function(){void 0!==t&&t(s)}),n=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,n),s=this.parseObject(e.object,i,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new o.JSONLoader,r=new o.BufferGeometryLoader,n=0,s=e.length;n<s;n++){var a,l=e[n];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new o[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new o.BoxGeometry(l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleBufferGeometry":a=new o.CircleBufferGeometry(l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CircleGeometry":a=new o.CircleGeometry(l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":a=new o.CylinderGeometry(l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":a=new o.SphereGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"SphereBufferGeometry":a=new o.SphereBufferGeometry(l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":a=new o.DodecahedronGeometry(l.radius,l.detail);break;case"IcosahedronGeometry":a=new o.IcosahedronGeometry(l.radius,l.detail);break;case"OctahedronGeometry":a=new o.OctahedronGeometry(l.radius,l.detail);break;case"TetrahedronGeometry":a=new o.TetrahedronGeometry(l.radius,l.detail);break;case"RingGeometry":a=new o.RingGeometry(l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":a=new o.TorusGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":a=new o.TorusKnotGeometry(l.radius,l.tube,l.radialSegments,l.tubularSegments,l.p,l.q,l.heightScale);break;case"BufferGeometry":a=r.parse(l);break;case"Geometry":a=i.parse(l.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),t[l.uuid]=a}return t},parseMaterials:function(e,t){var i={};if(void 0!==e){var r=new o.MaterialLoader;r.setTextures(t);for(var n=0,s=e.length;n<s;n++){var a=r.parse(e[n]);i[a.uuid]=a}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=o.AnimationClip.parse(e[i]);t.push(r)}return t},parseImages:function(e,t){var i=this,r={};if(void 0!==e&&e.length>0){var n=new o.LoadingManager(t),s=new o.ImageLoader(n);s.setCrossOrigin(this.crossOrigin);for(var a=0,l=e.length;a<l;a++){var h=e[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:i.texturePath+h.url;r[h.uuid]=function(e){return i.manager.itemStart(e),s.load(e,function(){i.manager.itemEnd(e)})}(c)}}return r},parseTextures:function(e,t){function i(e){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),o[e])}var r={};if(void 0!==e)for(var n=0,s=e.length;n<s;n++){var a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);var l=new o.Texture(t[a.image]);l.needsUpdate=!0,l.uuid=a.uuid,void 0!==a.name&&(l.name=a.name),void 0!==a.mapping&&(l.mapping=i(a.mapping)),void 0!==a.offset&&(l.offset=new o.Vector2(a.offset[0],a.offset[1])),void 0!==a.repeat&&(l.repeat=new o.Vector2(a.repeat[0],a.repeat[1])),void 0!==a.minFilter&&(l.minFilter=i(a.minFilter)),void 0!==a.magFilter&&(l.magFilter=i(a.magFilter)),void 0!==a.anisotropy&&(l.anisotropy=a.anisotropy),Array.isArray(a.wrap)&&(l.wrapS=i(a.wrap[0]),l.wrapT=i(a.wrap[1])),r[a.uuid]=l}return r},parseObject:function(){var e=new o.Matrix4;return function(t,i,r){function n(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function s(e){if(void 0!==e)return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}var a;switch(t.type){case"Scene":a=new o.Scene;break;case"PerspectiveCamera":a=new o.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":a=new o.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":a=new o.AmbientLight(t.color);break;case"DirectionalLight":a=new o.DirectionalLight(t.color,t.intensity);break;case"PointLight":a=new o.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":a=new o.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":a=new o.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":a=new o.Mesh(n(t.geometry),s(t.material));break;case"LOD":a=new o.LOD;break;case"Line":a=new o.Line(n(t.geometry),s(t.material),t.mode);break;case"PointCloud":case"Points":a=new o.Points(n(t.geometry),s(t.material));break;case"Sprite":a=new o.Sprite(s(t.material));break;case"Group":a=new o.Group;break;default:a=new o.Object3D}if(a.uuid=t.uuid,void 0!==t.name&&(a.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(a.position,a.quaternion,a.scale)):(void 0!==t.position&&a.position.fromArray(t.position),void 0!==t.rotation&&a.rotation.fromArray(t.rotation),void 0!==t.scale&&a.scale.fromArray(t.scale)),void 0!==t.castShadow&&(a.castShadow=t.castShadow),void 0!==t.receiveShadow&&(a.receiveShadow=t.receiveShadow),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.userData&&(a.userData=t.userData),void 0!==t.children)for(var l in t.children)a.add(this.parseObject(t.children[l],i,r));if("LOD"===t.type)for(var h=t.levels,c=0;c<h.length;c++){var u=h[c],l=a.getObjectByProperty("uuid",u.object);void 0!==l&&a.addLevel(l,u.distance)}return a}}()},o.TextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.TextureLoader.prototype={constructor:o.TextureLoader,load:function(e,t,i,r){var n=new o.Texture,s=new o.ImageLoader(this.manager);return s.setCrossOrigin(this.crossOrigin),console.log("-----\x3eloading ",e),s.load(e,function(e){console.log("-----\x3eloaded image",e.src),n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)},i,r),n},setCrossOrigin:function(e){this.crossOrigin=e}},o.CubeTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager},o.CubeTextureLoader.prototype={constructor:o.CubeTextureLoader,load:function(e,t,i,r){var n=new o.CubeTexture([]),s=new o.ImageLoader;s.setCrossOrigin(this.crossOrigin);for(var a=0,l=0;l<e.length;++l)!function(i){s.load(e[i],function(e){n.images[i]=e,6==++a&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}(l);return n},setCrossOrigin:function(e){this.crossOrigin=e}},o.DataTextureLoader=o.BinaryTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this._parser=null},o.BinaryTextureLoader.prototype={constructor:o.BinaryTextureLoader,load:function(e,t,i,r){var n=this,s=new o.DataTexture,a=new o.XHRLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setResponseType("arraybuffer"),a.load(e,function(e){var i=n._parser(e);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:o.ClampToEdgeWrapping,s.wrapT=void 0!==i.wrapT?i.wrapT:o.ClampToEdgeWrapping,s.magFilter=void 0!==i.magFilter?i.magFilter:o.LinearFilter,s.minFilter=void 0!==i.minFilter?i.minFilter:o.LinearMipMapLinearFilter,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps),1===i.mipmapCount&&(s.minFilter=o.LinearFilter),s.needsUpdate=!0,t&&t(s,i))},i,r),s},setCrossOrigin:function(e){this.crossOrigin=e}},o.CompressedTextureLoader=function(e){this.manager=void 0!==e?e:o.DefaultLoadingManager,this._parser=null},o.CompressedTextureLoader.prototype={constructor:o.CompressedTextureLoader,load:function(e,t,i,r){var n=this,s=[],a=new o.CompressedTexture;a.image=s;var l=new o.XHRLoader(this.manager);if(l.setCrossOrigin(this.crossOrigin),l.setResponseType("arraybuffer"),Array.isArray(e))for(var h=0,c=0,u=e.length;c<u;++c)!function(c){l.load(e[c],function(e){var i=n._parser(e,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(h+=1)&&(1===i.mipmapCount&&(a.minFilter=o.LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a))},i,r)}(c);else l.load(e,function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,l=0;l<r;l++){s[l]={mipmaps:[]};for(var h=0;h<i.mipmapCount;h++)s[l].mipmaps.push(i.mipmaps[l*i.mipmapCount+h]),s[l].format=i.format,s[l].width=i.width,s[l].height=i.height}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=o.LinearFilter),a.format=i.format,a.needsUpdate=!0,t&&t(a)},i,r);return a},setCrossOrigin:function(e){this.crossOrigin=e}},o.Material=function(){Object.defineProperty(this,"id",{value:o.MaterialIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.type="Material",this.side=o.FrontSide,this.opacity=1,this.transparent=!1,this.blending=o.NormalBlending,this.blendSrc=o.SrcAlphaFactor,this.blendDst=o.OneMinusSrcAlphaFactor,this.blendEquation=o.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=o.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},o.Material.prototype={constructor:o.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){var r=this[t];void 0!==r?r instanceof o.Color?r.set(i):r instanceof o.Vector3&&i instanceof o.Vector3?r.copy(i):this[t]="overdraw"===t?Number(i):i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),this.color instanceof o.Color&&(t.color=this.color.getHex()),this.emissive instanceof o.Color&&(t.emissive=this.emissive.getHex()),this.specular instanceof o.Color&&(t.specular=this.specular.getHex()),void 0!==this.shininess&&(t.shininess=this.shininess),this.map instanceof o.Texture&&(t.map=this.map.toJSON(e).uuid),this.alphaMap instanceof o.Texture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof o.Texture&&(t.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof o.Texture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap instanceof o.Texture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalScale=this.normalScale),this.displacementMap instanceof o.Texture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.specularMap instanceof o.Texture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof o.Texture&&(t.envMap=this.envMap.toJSON(e).uuid,t.reflectivity=this.reflectivity),void 0!==this.size&&(t.size=this.size),void 0!==this.sizeAttenuation&&(t.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==o.NoColors&&(t.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==o.SmoothShading&&(t.shading=this.shading),void 0!==this.blending&&this.blending!==o.NormalBlending&&(t.blending=this.blending),void 0!==this.side&&this.side!==o.FrontSide&&(t.side=this.side),this.opacity<1&&(t.opacity=this.opacity),!0===this.transparent&&(t.transparent=this.transparent),this.alphaTest>0&&(t.alphaTest=this.alphaTest),!0===this.wireframe&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new o.Color}},o.EventDispatcher.prototype.apply(o.Material.prototype),o.MaterialIdCount=0,o.LineBasicMaterial=function(e){o.Material.call(this),this.type="LineBasicMaterial",this.color=new o.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=o.NoColors,this.fog=!0,this.setValues(e)},o.LineBasicMaterial.prototype=Object.create(o.Material.prototype),o.LineBasicMaterial.prototype.constructor=o.LineBasicMaterial,o.LineBasicMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.LineDashedMaterial=function(e){o.Material.call(this),this.type="LineDashedMaterial",this.color=new o.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineDashedMaterial.prototype=Object.create(o.Material.prototype),o.LineDashedMaterial.prototype.constructor=o.LineDashedMaterial,o.LineDashedMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.MeshBasicMaterial=function(e){o.Material.call(this),this.type="MeshBasicMaterial",this.color=new o.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},o.MeshBasicMaterial.prototype=Object.create(o.Material.prototype),o.MeshBasicMaterial.prototype.constructor=o.MeshBasicMaterial,o.MeshBasicMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},o.MeshLambertMaterial=function(e){o.Material.call(this),this.type="MeshLambertMaterial",this.color=new o.Color(16777215),this.emissive=new o.Color(0),this.map=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshLambertMaterial.prototype=Object.create(o.Material.prototype),o.MeshLambertMaterial.prototype.constructor=o.MeshLambertMaterial,o.MeshLambertMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.map=e.map,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},o.MeshPhongMaterial=function(e){o.Material.call(this),this.type="MeshPhongMaterial",this.color=new o.Color(16777215),this.emissive=new o.Color(0),this.specular=new o.Color(1118481),this.shininess=30,this.metal=!1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshPhongMaterial.prototype=Object.create(o.Material.prototype),o.MeshPhongMaterial.prototype.constructor=o.MeshPhongMaterial,o.MeshPhongMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.specular.copy(e.specular),this.shininess=e.shininess,this.metal=e.metal,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissiveMap=e.emissiveMap,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},o.MeshDepthMaterial=function(e){o.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshDepthMaterial.prototype=Object.create(o.Material.prototype),o.MeshDepthMaterial.prototype.constructor=o.MeshDepthMaterial,o.MeshDepthMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},o.MeshNormalMaterial=function(e){o.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},o.MeshNormalMaterial.prototype=Object.create(o.Material.prototype),o.MeshNormalMaterial.prototype.constructor=o.MeshNormalMaterial,o.MeshNormalMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},o.MultiMaterial=function(e){this.uuid=o.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},o.MultiMaterial.prototype={constructor:o.MultiMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},t=0,i=this.materials.length;t<i;t++)e.materials.push(this.materials[t].toJSON());return e.visible=this.visible,e},clone:function(){for(var e=new this.constructor,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},o.MeshFaceMaterial=o.MultiMaterial,o.PointsMaterial=function(e){o.Material.call(this),this.type="PointsMaterial",this.color=new o.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=o.NoColors,this.fog=!0,this.setValues(e)},o.PointsMaterial.prototype=Object.create(o.Material.prototype),o.PointsMaterial.prototype.constructor=o.PointsMaterial,o.PointsMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},o.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new o.PointsMaterial(e)},o.ShaderMaterial=function(e){o.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=o.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.derivatives=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},o.ShaderMaterial.prototype=Object.create(o.Material.prototype),o.ShaderMaterial.prototype.constructor=o.ShaderMaterial,o.ShaderMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=o.UniformsUtils.clone(e.uniforms),this.attributes=e.attributes,this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.derivatives=e.derivatives,this},o.ShaderMaterial.prototype.toJSON=function(e){var t=o.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.attributes=this.attributes,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},o.RawShaderMaterial=function(e){o.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},o.RawShaderMaterial.prototype=Object.create(o.ShaderMaterial.prototype),o.RawShaderMaterial.prototype.constructor=o.RawShaderMaterial,o.SpriteMaterial=function(e){o.Material.call(this),this.type="SpriteMaterial",this.color=new o.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},o.SpriteMaterial.prototype=Object.create(o.Material.prototype),o.SpriteMaterial.prototype.constructor=o.SpriteMaterial,o.SpriteMaterial.prototype.copy=function(e){return o.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},o.Texture=function(e,t,i,r,n,s,a,l,h){Object.defineProperty(this,"id",{value:o.TextureIdCount++}),this.uuid=o.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==e?e:o.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:o.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:o.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:o.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:o.LinearFilter,this.minFilter=void 0!==s?s:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==a?a:o.RGBAFormat,this.type=void 0!==l?l:o.UnsignedByteType,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},o.Texture.DEFAULT_IMAGE=void 0,o.Texture.DEFAULT_MAPPING=o.UVMapping,o.Texture.prototype={constructor:o.Texture,set needsUpdate(e){!0===e&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var t={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=o.Math.generateUUID()),void 0===e.images[i.uuid]&&(e.images[i.uuid]={uuid:i.uuid,url:function(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElement("canvas"),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(i)}),t.image=i.uuid}return e.textures[this.uuid]=t,t},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===o.UVMapping){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case o.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case o.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case o.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case o.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case o.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case o.MirroredRepeatWrapping:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}};o.EventDispatcher.prototype.apply(o.Texture.prototype),o.TextureIdCount=0,o.CanvasTexture=function(e,t,i,r,n,s,a,l,h){o.Texture.call(this,e,t,i,r,n,s,a,l,h),this.needsUpdate=!0},o.CanvasTexture.prototype=Object.create(o.Texture.prototype),o.CanvasTexture.prototype.constructor=o.CanvasTexture,o.CubeTexture=function(e,t,i,r,n,s,a,l,h){t=void 0!==t?t:o.CubeReflectionMapping,o.Texture.call(this,e,t,i,r,n,s,a,l,h),this.images=e,this.flipY=!1},o.CubeTexture.prototype=Object.create(o.Texture.prototype),o.CubeTexture.prototype.constructor=o.CubeTexture,o.CubeTexture.prototype.copy=function(e){return o.Texture.prototype.copy.call(this,e),this.images=e.images,this},o.CompressedTexture=function(e,t,i,r,n,s,a,l,h,c,u){o.Texture.call(this,null,s,a,l,h,c,r,n,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},o.CompressedTexture.prototype=Object.create(o.Texture.prototype),o.CompressedTexture.prototype.constructor=o.CompressedTexture,o.DataTexture=function(e,t,i,r,n,s,a,l,h,c,u){o.Texture.call(this,null,s,a,l,h,c,r,n,u),this.image={data:e,width:t,height:i},this.magFilter=void 0!==h?h:o.NearestFilter,this.minFilter=void 0!==c?c:o.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},o.DataTexture.prototype=Object.create(o.Texture.prototype),o.DataTexture.prototype.constructor=o.DataTexture,o.VideoTexture=function(e,t,i,r,n,s,a,l,h){function c(){requestAnimationFrame(c),e.readyState===e.HAVE_ENOUGH_DATA&&(u.needsUpdate=!0)}o.Texture.call(this,e,t,i,r,n,s,a,l,h),this.generateMipmaps=!1;var u=this;c()},o.VideoTexture.prototype=Object.create(o.Texture.prototype),o.VideoTexture.prototype.constructor=o.VideoTexture,o.Group=function(){o.Object3D.call(this),this.type="Group"},o.Group.prototype=Object.create(o.Object3D.prototype),o.Group.prototype.constructor=o.Group,o.Points=function(e,t){o.Object3D.call(this),this.type="Points",this.geometry=void 0!==e?e:new o.Geometry,this.material=void 0!==t?t:new o.PointsMaterial({color:16777215*Math.random()})},o.Points.prototype=Object.create(o.Object3D.prototype),o.Points.prototype.constructor=o.Points,o.Points.prototype.raycast=function(){var e=new o.Matrix4,t=new o.Ray;return function(i,r){function n(e,n){var o=t.distanceSqToPoint(e);if(o<c){var a=t.closestPointToPoint(e);a.applyMatrix4(s.matrixWorld);var l=i.ray.origin.distanceTo(a);if(l<i.near||l>i.far)return;r.push({distance:l,distanceToRay:Math.sqrt(o),point:a.clone(),index:n,face:null,object:s})}}var s=this,a=s.geometry,l=i.params.Points.threshold;if(e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e),null===a.boundingBox||!1!==t.isIntersectionBox(a.boundingBox)){var h=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=h*h,u=new o.Vector3;if(a instanceof o.BufferGeometry){var f=a.index,d=a.attributes,p=d.position.array;if(null!==f)for(var m=f.array,g=0,v=m.length;g<v;g++){var y=m[g];u.fromArray(p,3*y),n(u,y)}else for(var g=0,_=p.length/3;g<_;g++)u.fromArray(p,3*g),n(u,g)}else for(var b=a.vertices,g=0,_=b.length;g<_;g++)n(b[g],g)}}}(),o.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new o.Points(e,t)},o.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new o.Points(e,t)},o.Line=function(e,t,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new o.LineSegments(e,t);o.Object3D.call(this),this.type="Line",this.geometry=void 0!==e?e:new o.Geometry,this.material=void 0!==t?t:new o.LineBasicMaterial({color:16777215*Math.random()})},o.Line.prototype=Object.create(o.Object3D.prototype),o.Line.prototype.constructor=o.Line,o.Line.prototype.raycast=function(){var e=new o.Matrix4,t=new o.Ray,i=new o.Sphere;return function(r,n){var s=r.linePrecision,a=s*s,l=this.geometry;if(null===l.boundingSphere&&l.computeBoundingSphere(),i.copy(l.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==r.ray.isIntersectionSphere(i)){e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e);var h=new o.Vector3,c=new o.Vector3,u=new o.Vector3,f=new o.Vector3,d=this instanceof o.LineSegments?2:1;if(l instanceof o.BufferGeometry){var p=l.index,m=l.attributes;if(null!==p)for(var g=p.array,v=m.position.array,y=0,_=g.length-1;y<_;y+=d){var b=g[y],x=g[y+1];h.fromArray(v,3*b),c.fromArray(v,3*x);var T=t.distanceSqToSegment(h,c,f,u);if(!(T>a)){f.applyMatrix4(this.matrixWorld);var E=r.ray.origin.distanceTo(f);E<r.near||E>r.far||n.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else for(var v=m.position.array,y=0,_=v.length/3-1;y<_;y+=d){h.fromArray(v,3*y),c.fromArray(v,3*y+3);var T=t.distanceSqToSegment(h,c,f,u);if(!(T>a)){f.applyMatrix4(this.matrixWorld);var E=r.ray.origin.distanceTo(f);E<r.near||E>r.far||n.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else if(l instanceof o.Geometry)for(var S=l.vertices,w=S.length,y=0;y<w-1;y+=d){var T=t.distanceSqToSegment(S[y],S[y+1],f,u);if(!(T>a)){f.applyMatrix4(this.matrixWorld);var E=r.ray.origin.distanceTo(f);E<r.near||E>r.far||n.push({distance:E,point:u.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}(),o.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.LineStrip=0,o.LinePieces=1,o.LineSegments=function(e,t){o.Line.call(this,e,t),this.type="LineSegments"},o.LineSegments.prototype=Object.create(o.Line.prototype),o.LineSegments.prototype.constructor=o.LineSegments,o.Mesh=function(e,t){o.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new o.Geometry,this.material=void 0!==t?t:new o.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},o.Mesh.prototype=Object.create(o.Object3D.prototype),o.Mesh.prototype.constructor=o.Mesh,o.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},o.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},o.Mesh.prototype.raycast=function(){function e(e,t,i,r,n,s,a){return o.Triangle.barycoordFromPoint(e,t,i,r,g),n.multiplyScalar(g.x),s.multiplyScalar(g.y),a.multiplyScalar(g.z),n.add(s).add(a),n.clone()}function t(e,t,i,r,n,s,a){var l=e.material;if(null===(l.side===o.BackSide?i.intersectTriangle(s,n,r,!0,a):i.intersectTriangle(r,n,s,l.side!==o.DoubleSide,a)))return null;y.copy(a),y.applyMatrix4(e.matrixWorld);var h=t.ray.origin.distanceTo(y);return h<t.near||h>t.far?null:{distance:h,point:y.clone(),object:e}}function i(i,r,n,s,c,u,f,g){a.fromArray(s,3*u),l.fromArray(s,3*f),h.fromArray(s,3*g);var y=t(i,r,n,a,l,h,v);return y&&(c&&(d.fromArray(c,2*u),p.fromArray(c,2*f),m.fromArray(c,2*g),y.uv=e(v,a,l,h,d,p,m)),y.face=new o.Face3(u,f,g,o.Triangle.normal(a,l,h)),y.faceIndex=u),y}var r=new o.Matrix4,n=new o.Ray,s=new o.Sphere,a=new o.Vector3,l=new o.Vector3,h=new o.Vector3,c=new o.Vector3,u=new o.Vector3,f=new o.Vector3,d=new o.Vector2,p=new o.Vector2,m=new o.Vector2,g=new o.Vector3,v=new o.Vector3,y=new o.Vector3;return function(g,y){var _=this.geometry,b=this.material;if(void 0!==b){null===_.boundingSphere&&_.computeBoundingSphere();var x=this.matrixWorld;if(s.copy(_.boundingSphere),s.applyMatrix4(x),!1!==g.ray.isIntersectionSphere(s)&&(r.getInverse(x),n.copy(g.ray).applyMatrix4(r),null===_.boundingBox||!1!==n.isIntersectionBox(_.boundingBox))){var T,E;if(_ instanceof o.BufferGeometry){var S,w,M,A=_.index,P=_.attributes,C=P.position.array;if(void 0!==P.uv&&(T=P.uv.array),null!==A)for(var R=A.array,D=0,I=R.length;D<I;D+=3)S=R[D],w=R[D+1],M=R[D+2],(E=i(this,g,n,C,T,S,w,M))&&(E.faceIndex=Math.floor(D/3),y.push(E));else for(var D=0,I=C.length;D<I;D+=9)S=D/3,w=S+1,M=S+2,(E=i(this,g,n,C,T,S,w,M))&&(E.index=S,y.push(E))}else if(_ instanceof o.Geometry){var O,F,L,B=b instanceof o.MeshFaceMaterial,N=!0===B?b.materials:null,k=_.vertices,V=_.faces,U=_.faceVertexUvs[0];U.length>0&&(T=U);for(var z=0,G=V.length;z<G;z++){var H=V[z],j=!0===B?N[H.materialIndex]:b;if(void 0!==j){if(O=k[H.a],F=k[H.b],L=k[H.c],!0===j.morphTargets){var W=_.morphTargets,X=this.morphTargetInfluences;a.set(0,0,0),l.set(0,0,0),h.set(0,0,0);for(var Y=0,K=W.length;Y<K;Y++){var q=X[Y];if(0!==q){var Q=W[Y].vertices;a.addScaledVector(c.subVectors(Q[H.a],O),q),l.addScaledVector(u.subVectors(Q[H.b],F),q),h.addScaledVector(f.subVectors(Q[H.c],L),q)}}a.add(O),l.add(F),h.add(L),O=a,F=l,L=h}if(E=t(this,g,n,O,F,L,v)){if(T){var Z=T[z];d.copy(Z[0]),p.copy(Z[1]),m.copy(Z[2]),E.uv=e(v,O,F,L,d,p,m)}E.face=H,E.faceIndex=z,y.push(E)}}}}}}}}(),o.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},o.Bone=function(e){o.Object3D.call(this),this.type="Bone",this.skin=e},o.Bone.prototype=Object.create(o.Object3D.prototype),o.Bone.prototype.constructor=o.Bone,o.Bone.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},o.Skeleton=function(e,t,i){if(this.useVertexTexture=void 0===i||i,this.identityMatrix=new o.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var r=Math.sqrt(4*this.bones.length);r=o.Math.nextPowerOfTwo(Math.ceil(r)),r=Math.max(r,4),this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new o.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,o.RGBAFormat,o.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new o.Matrix4)}},o.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new o.Matrix4;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},o.Skeleton.prototype.pose=function(){for(var e,t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},o.Skeleton.prototype.update=function(){var e=new o.Matrix4;return function(){for(var t=0,i=this.bones.length;t<i;t++){var r=this.bones[t]?this.bones[t].matrixWorld:this.identityMatrix;e.multiplyMatrices(r,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),o.Skeleton.prototype.clone=function(){return new o.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},o.SkinnedMesh=function(e,t,i){o.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new o.Matrix4,this.bindMatrixInverse=new o.Matrix4;var r=[];if(this.geometry&&void 0!==this.geometry.bones){for(var n,s,a=0,l=this.geometry.bones.length;a<l;++a)s=this.geometry.bones[a],n=new o.Bone(this),r.push(n),n.name=s.name,n.position.fromArray(s.pos),n.quaternion.fromArray(s.rotq),void 0!==s.scl&&n.scale.fromArray(s.scl);for(var a=0,l=this.geometry.bones.length;a<l;++a)s=this.geometry.bones[a],-1!==s.parent&&null!==s.parent?r[s.parent]?r[s.parent].add(r[a]):console.log("----\x3e",s.parent):this.add(r[a])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new o.Skeleton(r,void 0,i),this.matrixWorld)},o.SkinnedMesh.prototype=Object.create(o.Mesh.prototype),o.SkinnedMesh.prototype.constructor=o.SkinnedMesh,o.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},o.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},o.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof o.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},o.SkinnedMesh.prototype.updateMatrixWorld=function(e){o.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},o.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},o.LOD=function(){o.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},o.LOD.prototype=Object.create(o.Object3D.prototype),o.LOD.prototype.constructor=o.LOD,o.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},o.LOD.prototype.getObjectForDistance=function(e){for(var t=this.levels,i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object},o.LOD.prototype.raycast=function(){var e=new o.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,i)}}(),o.LOD.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3;return function(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,s=r.length;o<s&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<s;o++)r[o].object.visible=!1}}}(),o.LOD.prototype.copy=function(e){o.Object3D.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this},o.LOD.prototype.toJSON=function(e){var t=o.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var s=i[r];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t},o.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),i=new Float32Array([0,0,1,0,1,1,0,1]),r=new o.BufferGeometry;return r.setIndex(new o.BufferAttribute(e,1)),r.addAttribute("position",new o.BufferAttribute(t,3)),r.addAttribute("uv",new o.BufferAttribute(i,2)),function(e){o.Object3D.call(this),this.type="Sprite",this.geometry=r,this.material=void 0!==e?e:new o.SpriteMaterial}}(),o.Sprite.prototype=Object.create(o.Object3D.prototype),o.Sprite.prototype.constructor=o.Sprite,o.Sprite.prototype.raycast=function(){var e=new o.Vector3;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.distanceSqToPoint(e);r>this.scale.x*this.scale.y||i.push({distance:Math.sqrt(r),point:this.position,face:null,object:this})}}(),o.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},o.Particle=o.Sprite,o.LensFlare=function(e,t,i,r,n){o.Object3D.call(this),this.lensFlares=[],this.positionScreen=new o.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,n)},o.LensFlare.prototype=Object.create(o.Object3D.prototype),o.LensFlare.prototype.constructor=o.LensFlare,o.LensFlare.prototype.add=function(e,t,i,r,n,s){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===s&&(s=1),void 0===n&&(n=new o.Color(16777215)),void 0===r&&(r=o.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:s,color:n,blending:r})},o.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},o.LensFlare.prototype.copy=function(e){o.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this},o.Scene=function(){o.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},o.Scene.prototype=Object.create(o.Object3D.prototype),o.Scene.prototype.constructor=o.Scene,o.Scene.prototype.copy=function(e){return o.Object3D.prototype.copy.call(this,e),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},o.Fog=function(e,t,i){this.name="",this.color=new o.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},o.Fog.prototype.clone=function(){return new o.Fog(this.color.getHex(),this.near,this.far)},o.FogExp2=function(e,t){this.name="",this.color=new o.Color(e),this.density=void 0!==t?t:25e-5},o.FogExp2.prototype.clone=function(){return new o.FogExp2(this.color.getHex(),this.density)},o.ShaderChunk={},o.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",o.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",o.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",o.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n\ttotalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",o.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif",o.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",o.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",o.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",o.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif",o.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n",o.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif",o.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n\tvColor.xyz = color.xyz;\n\n#endif",o.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n\tif ( decayExponent > 0.0 ) {\n\n\t  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n\n\tfloat fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n\n\treturn ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( lightDir, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n\t#ifdef GAMMA_INPUT\n\n\t\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n\t#ifdef GAMMA_OUTPUT\n\n\t\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n\t#else\n\n\t\treturn a;\n\n\t#endif\n\n}\n",o.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",o.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",o.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",o.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n\ttotalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",o.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",o.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",o.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n",o.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n",o.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n",o.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",o.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif",o.ShaderChunk.hemilight_fragment="#if MAX_HEMI_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalAmbientLight += lightColor;\n\n\t}\n\n#endif\n\n",o.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n\ttotalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",o.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif",o.ShaderChunk.lights_lambert_pars_vertex="#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",o.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition - mvPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\n\t\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\t\tvLightFront += lightColor * attenuation * saturate( dotProduct );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tvLightFront += lightColor * saturate( dotProduct );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += lightColor * saturate( - dotProduct );\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lightDir = hemisphereLightDirection[ i ];\n\n\n\t\tfloat dotProduct = dot( normal, lightDir );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tfloat hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n",o.ShaderChunk.lights_phong_fragment="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = pointLightColor[ i ];\n\n\t\tvec3 lightPosition = pointLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = spotLightColor[ i ];\n\n\t\tvec3 lightPosition = spotLightPosition[ i ];\n\t\tvec3 lVector = lightPosition + vViewPosition.xyz;\n\t\tvec3 lightDir = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tattenuation *= spotEffect;\n\n\n\t\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\t\ttotalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n\n\t\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\t\ttotalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 lightColor = directionalLightColor[ i ];\n\n\t\tvec3 lightDir = directionalLightDirection[ i ];\n\n\n\t\tfloat cosineTerm = saturate( dot( normal, lightDir ) );\n\n\t\ttotalDiffuseLight += lightColor * cosineTerm;\n\n\n\t\tvec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n\t\ttotalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n\t}\n\n#endif\n",o.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n",o.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n",o.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n",o.ShaderChunk.linear_to_gamma_fragment="\n\toutgoingLight = linearToOutput( outgoingLight );\n",o.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",o.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif\n",o.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif",o.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif",o.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif\n",o.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif",o.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",o.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n",o.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",o.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif",o.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",o.ShaderChunk.normal_phong_fragment="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n",o.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n",o.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",o.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n\tfor ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tfloat texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n\t\tfloat shadow = 0.0;\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n\t\tbool isPointLight = shadowDarkness[ i ] < 0.0;\n\n\t\tif ( isPointLight ) {\n\n\t\t\tfloat realShadowDarkness = abs( shadowDarkness[ i ] );\n\n\t\t\tvec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tfloat dp = length( lightToPosition );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tconst float Dr = 1.25;\n\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tconst float Dr = 2.25;\n\t#endif\n\n\t\t\tfloat os = Dr *  2.0 * texelSizeY;\n\n\t\t\tconst vec3 Gsd = vec3( - 1, 0, 1 );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xxy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xzy * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.zyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.xyx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxz * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yxx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D + Gsd.yzx * os, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tshadow *= realShadowDarkness * ( 1.0 / 21.0 );\n\n\t#else \n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tfloat dp = length( lightToPosition );\n\n\t\t\tadjustShadowValue1K( dp, texture2D( shadowMap[ i ], cubeToUV( bd3D, texelSizeY ) ), shadowBias[ i ], shadow );\n\n\t\t\tshadow *= realShadowDarkness;\n\n\t#endif\n\n\t\t} else {\n\n#endif \n\t\t\tfloat texelSizeX =  1.0 / shadowMapSize[ i ].x;\n\n\t\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\n\t\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t\tbool frustumTest = all( frustumTestVec );\n\n\t\t\tif ( frustumTest ) {\n\n\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\n\t\t\t\t/*\n\t\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\t\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\t\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\t\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\t\tshadow += 1.0;\n\t\t\t\t\t}\n\t\t\t\t\tshadow /= 9.0;\n\t\t\t\t*/\n\n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tconst float ShadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = texelSizeX;\n\t\t\t\tfloat yPixelOffset = texelSizeY;\n\n\t\t\t\tfloat dx0 = - 1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = - 1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfloat fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += ShadowDelta;\n\n\t\t\t\tshadow *= shadowDarkness[ i ];\n\n\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tfloat xPixelOffset = texelSizeX;\n\t\t\t\tfloat yPixelOffset = texelSizeY;\n\n\t\t\t\tfloat dx0 = - 1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = - 1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[ 0 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[ 0 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[ 0 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[ 1 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[ 1 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[ 1 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 0 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 1 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[ 2 ][ 2 ] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[ 0 ] = vec3( lessThan( depthKernel[ 0 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 0 ] *= vec3( 0.25 );\n\n\t\t\t\tshadowKernel[ 1 ] = vec3( lessThan( depthKernel[ 1 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 1 ] *= vec3( 0.25 );\n\n\t\t\t\tshadowKernel[ 2 ] = vec3( lessThan( depthKernel[ 2 ], shadowZ ) );\n\t\t\t\tshadowKernel[ 2 ] *= vec3( 0.25 );\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[ i ].xy );\n\n\t\t\t\tshadowKernel[ 0 ] = mix( shadowKernel[ 1 ], shadowKernel[ 0 ], fractionalCoord.x );\n\t\t\t\tshadowKernel[ 1 ] = mix( shadowKernel[ 2 ], shadowKernel[ 1 ], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[ 0 ][ 1 ], shadowKernel[ 0 ][ 0 ], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[ 0 ][ 2 ], shadowKernel[ 0 ][ 1 ], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[ 1 ][ 1 ], shadowKernel[ 1 ][ 0 ], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[ 1 ][ 2 ], shadowKernel[ 1 ][ 1 ], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) ) * shadowDarkness[ i ];\n\n\t#else \n\t\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\tshadow = shadowDarkness[ i ];\n\n\t#endif\n\n\t\t\t}\n\n#ifdef SHADOWMAP_DEBUG\n\n\t\t\tif ( inFrustum ) {\n\n\t\t\t\tif ( i == 0 ) {\n\n\t\t\t\t\toutgoingLight *= vec3( 1.0, 0.5, 0.0 );\n\n\t\t\t\t} else if ( i == 1 ) {\n\n\t\t\t\t\toutgoingLight *= vec3( 0.0, 1.0, 0.8 );\n\n\t\t\t\t} else {\n\n\t\t\t\t\toutgoingLight *= vec3( 0.0, 0.5, 1.0 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n#endif\n\n#if defined( POINT_LIGHT_SHADOWS )\n\n\t\t}\n\n#endif\n\n\t\tshadowMask = shadowMask * vec3( 1.0 - shadow );\n\n\t}\n\n#endif\n",o.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n\t#if defined(POINT_LIGHT_SHADOWS)\n\n\n\t\tvoid adjustShadowValue1K( const float testDepth, const vec4 textureData, const float bias, inout float shadowValue ) {\n\n\t\t\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\t\tif ( testDepth >= dot( textureData, bitSh ) * 1000.0 + bias )\n\t\t\t\tshadowValue += 1.0;\n\n\t\t}\n\n\n\t\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\n\t\t\tvec3 absV = abs( v );\n\n\n\t\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\t\tabsV *= scaleToCube;\n\n\n\t\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\n\n\t\t\tvec2 planar = v.xy;\n\n\t\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\t\tif ( absV.z >= almostOne ) {\n\n\t\t\t\tif ( v.z > 0.0 )\n\t\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\t\tfloat signX = sign( v.x );\n\t\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\t\tfloat signY = sign( v.y );\n\t\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t\t}\n\n\n\t\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t\t}\n\n\t#endif\n\n#endif\n",o.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif",o.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n\tfor ( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif",o.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",o.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",o.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n",o.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",o.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif",o.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif",o.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif",o.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n#endif",o.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = uv2;\n\n#endif",o.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\n#endif",o.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n",o.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",o.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n\t#endif\n\n#endif\n",o.UniformsUtils={merge:function(e){for(var t={},i=0;i<e.length;i++){var r=this.clone(e[i]);for(var n in r)t[n]=r[n]}return t},clone:function(e){var t={};for(var i in e){t[i]={};for(var r in e[i]){var n=e[i][r];n instanceof o.Color||n instanceof o.Vector2||n instanceof o.Vector3||n instanceof o.Vector4||n instanceof o.Matrix3||n instanceof o.Matrix4||n instanceof o.Texture?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}},o.UniformsLib={common:{diffuse:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new o.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},o.ShaderLib={basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.aomap,o.UniformsLib.fog,o.UniformsLib.shadowmap]),vertexShader:[o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.skinbase_vertex,"\t#ifdef USE_ENVMAP",o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"\t#endif",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.aomap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = vec3( 1.0 );","\tvec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.aomap_fragment,o.ShaderChunk.shadowmap_fragment,"\toutgoingLight = diffuseColor.rgb * totalAmbientLight * shadowMask;",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{emissive:{type:"c",value:new o.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_lambert_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_lambert_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","uniform vec3 ambientLightColor;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.shadowmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t#endif",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.aomap,o.UniformsLib.lightmap,o.UniformsLib.emissivemap,o.UniformsLib.bumpmap,o.UniformsLib.normalmap,o.UniformsLib.displacementmap,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{emissive:{type:"c",value:new o.Color(0)},specular:{type:"c",value:new o.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",o.ShaderChunk.common,o.ShaderChunk.uv_pars_vertex,o.ShaderChunk.uv2_pars_vertex,o.ShaderChunk.displacementmap_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_phong_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.uv_vertex,o.ShaderChunk.uv2_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.beginnormal_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",o.ShaderChunk.begin_vertex,o.ShaderChunk.displacementmap_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"\tvViewPosition = - mvPosition.xyz;",o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_phong_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.uv_pars_fragment,o.ShaderChunk.uv2_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.alphamap_pars_fragment,o.ShaderChunk.aomap_pars_fragment,o.ShaderChunk.lightmap_pars_fragment,o.ShaderChunk.emissivemap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.lights_phong_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.bumpmap_pars_fragment,o.ShaderChunk.normalmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 totalEmissiveLight = emissive;","\tvec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphamap_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.normal_phong_fragment,o.ShaderChunk.lightmap_fragment,o.ShaderChunk.hemilight_fragment,o.ShaderChunk.aomap_fragment,o.ShaderChunk.emissivemap_fragment,o.ShaderChunk.lights_phong_fragment,o.ShaderChunk.shadowmap_fragment,"totalDiffuseLight *= shadowMask;","totalSpecularLight *= shadowMask;","#ifdef METAL","\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;","#else","\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;","#endif",o.ShaderChunk.envmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:o.UniformsUtils.merge([o.UniformsLib.points,o.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",o.ShaderChunk.common,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_particle_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );","\tvec3 shadowMask = vec3( 1.0 );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.map_particle_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.shadowmap_fragment,"\toutgoingLight = diffuseColor.rgb * shadowMask;",o.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",o.ShaderChunk.common,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",o.ShaderChunk.common,o.ShaderChunk.color_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",o.ShaderChunk.logdepthbuf_fragment,o.ShaderChunk.color_fragment,"\toutgoingLight = diffuseColor.rgb;",o.ShaderChunk.fog_fragment,"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",o.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvNormal = normalize( normalMatrix * normal );",o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",o.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[o.ShaderChunk.common,o.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",o.ShaderChunk.logdepthbuf_fragment,"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new o.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",o.ShaderChunk.common,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.begin_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.project_vertex,o.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",o.ShaderChunk.common,"vec4 pack1K ( float depth ) {","   depth /= 1000.0;","   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = fract( depth * bitSh );","\tres -= res.xxyz * bitMsk;","\treturn res; ","}","float unpack1K ( vec4 color ) {","\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","\treturn dot( color, bitSh ) * 1000.0;","}","void main () {","\tgl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}},o.WebGLRenderer=function(e){function t(e,t,i,r){!0===se&&(e*=r,t*=r,i*=r),Ve.clearColor(e,t,i,r)}function i(){He.init(),Ve.viewport(we,Me,Ae,Pe),t(le.r,le.g,le.b,he)}function r(){_e=null,Ee=null,Te="",xe=-1,Le=!0,He.reset()}function n(e){e.preventDefault(),r(),i(),je.clear()}function s(e){var t=e.target;t.removeEventListener("dispose",s),h(t),Ne.textures--}function a(e){var t=e.target;t.removeEventListener("dispose",a),c(t),Ne.textures--}function l(e){var t=e.target;t.removeEventListener("dispose",l),u(t)}function h(e){var t=je.get(e);if(e.image&&t.__image__webglTextureCube)Ve.deleteTexture(t.__image__webglTextureCube);else{if(void 0===t.__webglInit)return;Ve.deleteTexture(t.__webglTexture)}je.delete(e)}function c(e){var t=je.get(e),i=je.get(e.texture);if(e&&void 0!==i.__webglTexture){if(Ve.deleteTexture(i.__webglTexture),e instanceof o.WebGLRenderTargetCube)for(var r=0;r<6;r++)Ve.deleteFramebuffer(t.__webglFramebuffer[r]),Ve.deleteRenderbuffer(t.__webglRenderbuffer[r]);else Ve.deleteFramebuffer(t.__webglFramebuffer),Ve.deleteRenderbuffer(t.__webglRenderbuffer);je.delete(e.texture),je.delete(e)}}function u(e){f(e),je.delete(e)}function f(e){var t=je.get(e).program;e.program=void 0,void 0!==t&&Xe.releaseProgram(t)}function d(e,t,i,r){var n;if(i instanceof o.InstancedBufferGeometry&&null===(n=ze.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===r&&(r=0),He.initAttributes();var s=i.attributes,a=t.getAttributes(),l=e.defaultAttributeValues;for(var h in a){var c=a[h];if(c>=0){var u=s[h];if(void 0!==u){var f=u.itemSize,d=We.getAttributeBuffer(u);if(u instanceof o.InterleavedBufferAttribute){var p=u.data,m=p.stride,g=u.offset;p instanceof o.InstancedInterleavedBuffer?(He.enableAttributeAndDivisor(c,p.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=p.meshPerAttribute*p.count)):He.enableAttribute(c),Ve.bindBuffer(Ve.ARRAY_BUFFER,d),Ve.vertexAttribPointer(c,f,Ve.FLOAT,!1,m*p.array.BYTES_PER_ELEMENT,(r*m+g)*p.array.BYTES_PER_ELEMENT)}else u instanceof o.InstancedBufferAttribute?(He.enableAttributeAndDivisor(c,u.meshPerAttribute,n),void 0===i.maxInstancedCount&&(i.maxInstancedCount=u.meshPerAttribute*u.count)):He.enableAttribute(c),Ve.bindBuffer(Ve.ARRAY_BUFFER,d),Ve.vertexAttribPointer(c,f,Ve.FLOAT,!1,0,r*f*4)}else if(void 0!==l){var v=l[h];if(void 0!==v)switch(v.length){case 2:Ve.vertexAttrib2fv(c,v);break;case 3:Ve.vertexAttrib3fv(c,v);break;case 4:Ve.vertexAttrib4fv(c,v);break;default:Ve.vertexAttrib1fv(c,v)}}}}He.disableUnusedAttributes()}function p(e,t){return t[0]-e[0]}function m(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function g(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function v(e,t,i,r,n){var o,s;i.transparent?(o=de,s=++pe):(o=ue,s=++fe);var a=o[s];void 0!==a?(a.id=e.id,a.object=e,a.geometry=t,a.material=i,a.z=Oe.z,a.group=n):(a={id:e.id,object:e,geometry:t,material:i,z:Oe.z,group:n},o.push(a))}function y(e,t){if(!1!==e.visible){if(0!=(e.channels.mask&t.channels.mask))if(e instanceof o.Light)ce.push(e);else if(e instanceof o.Sprite)ge.push(e);else if(e instanceof o.LensFlare)ve.push(e);else if(e instanceof o.ImmediateRenderObject)!0===ye.sortObjects&&(Oe.setFromMatrixPosition(e.matrixWorld),Oe.applyProjection(Ie)),v(e,null,e.material,Oe.z,null);else if((e instanceof o.Mesh||e instanceof o.Line||e instanceof o.Points)&&(e instanceof o.SkinnedMesh&&e.skeleton.update(),!1===e.frustumCulled||!0===De.intersectsObject(e))){var i=e.material;if(!0===i.visible){!0===ye.sortObjects&&(Oe.setFromMatrixPosition(e.matrixWorld),Oe.applyProjection(Ie));var r=We.update(e);if(i instanceof o.MeshFaceMaterial)for(var n=r.groups,s=i.materials,a=0,l=n.length;a<l;a++){var h=n[a],c=s[h.materialIndex];!0===c.visible&&v(e,r,c,Oe.z,h)}else v(e,r,i,Oe.z,null)}}for(var u=e.children,a=0,l=u.length;a<l;a++)y(u[a],t)}}function _(e,t,i,r,n){for(var s=0,a=e.length;s<a;s++){var l=e[s],h=l.object,c=l.geometry,u=void 0===n?l.material:n,f=l.group;if(h.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,h.matrixWorld),h.normalMatrix.getNormalMatrix(h.modelViewMatrix),h instanceof o.ImmediateRenderObject){x(u);var d=E(t,i,r,u,h);Te="",h.render(function(e){ye.renderBufferImmediate(e,d,u)})}else ye.renderBufferDirect(t,i,r,c,u,h,f)}}function b(e,t,i,r){var n=je.get(e),s=Xe.getParameters(e,t,i,r),a=Xe.getProgramCode(e,s),h=n.program,c=!0;if(void 0===h)e.addEventListener("dispose",l);else if(h.code!==a)f(e);else{if(void 0!==s.shaderID)return;c=!1}if(c){if(s.shaderID){var u=o.ShaderLib[s.shaderID];n.__webglShader={name:e.type,uniforms:o.UniformsUtils.clone(u.uniforms),vertexShader:u.vertexShader,fragmentShader:u.fragmentShader}}else n.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=n.__webglShader,h=Xe.acquireProgram(e,s,a),n.program=h,e.program=h}var d=h.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<ye.maxMorphTargets;p++)d["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals)for(e.numSupportedMorphNormals=0,p=0;p<ye.maxMorphNormals;p++)d["morphNormal"+p]>=0&&e.numSupportedMorphNormals++;n.uniformsList=[];var m=n.program.getUniforms();for(var g in n.__webglShader.uniforms){var v=m[g];v&&n.uniformsList.push([n.__webglShader.uniforms[g],v])}}function x(e){T(e),!0===e.transparent?He.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):He.setBlending(o.NoBlending),He.setDepthFunc(e.depthFunc),He.setDepthTest(e.depthTest),He.setDepthWrite(e.depthWrite),He.setColorWrite(e.colorWrite),He.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function T(e){e.side!==o.DoubleSide?He.enable(Ve.CULL_FACE):He.disable(Ve.CULL_FACE),He.setFlipSided(e.side===o.BackSide)}function E(e,t,i,r,n){Se=0;var s=je.get(r);!r.needsUpdate&&s.program||(b(r,t,i,n),r.needsUpdate=!1);var a=!1,l=!1,h=!1,c=s.program,u=c.getUniforms(),f=s.__webglShader.uniforms;if(c.id!==_e&&(Ve.useProgram(c.program),_e=c.id,a=!0,l=!0,h=!0),r.id!==xe&&(-1===xe&&(h=!0),xe=r.id,l=!0),(a||e!==Ee)&&(Ve.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),Ge.logarithmicDepthBuffer&&Ve.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Ee&&(Ee=e),(r instanceof o.ShaderMaterial||r instanceof o.MeshPhongMaterial||r.envMap)&&void 0!==u.cameraPosition&&(Oe.setFromMatrixPosition(e.matrixWorld),Ve.uniform3f(u.cameraPosition,Oe.x,Oe.y,Oe.z)),(r instanceof o.MeshPhongMaterial||r instanceof o.MeshLambertMaterial||r instanceof o.MeshBasicMaterial||r instanceof o.ShaderMaterial||r.skinning)&&void 0!==u.viewMatrix&&Ve.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)),r.skinning)if(n.bindMatrix&&void 0!==u.bindMatrix&&Ve.uniformMatrix4fv(u.bindMatrix,!1,n.bindMatrix.elements),n.bindMatrixInverse&&void 0!==u.bindMatrixInverse&&Ve.uniformMatrix4fv(u.bindMatrixInverse,!1,n.bindMatrixInverse.elements),Ge.floatVertexTextures&&n.skeleton&&n.skeleton.useVertexTexture){if(void 0!==u.boneTexture){var d=F();Ve.uniform1i(u.boneTexture,d),ye.setTexture(n.skeleton.boneTexture,d)}void 0!==u.boneTextureWidth&&Ve.uniform1i(u.boneTextureWidth,n.skeleton.boneTextureWidth),void 0!==u.boneTextureHeight&&Ve.uniform1i(u.boneTextureHeight,n.skeleton.boneTextureHeight)}else n.skeleton&&n.skeleton.boneMatrices&&void 0!==u.boneGlobalMatrices&&Ve.uniformMatrix4fv(u.boneGlobalMatrices,!1,n.skeleton.boneMatrices);return l&&(i&&r.fog&&P(f,i),(r instanceof o.MeshPhongMaterial||r instanceof o.MeshLambertMaterial||r.lights)&&(Le&&(h=!0,N(t,e),Le=!1),h?(R(f,Be),D(f,!0)):D(f,!1)),(r instanceof o.MeshBasicMaterial||r instanceof o.MeshLambertMaterial||r instanceof o.MeshPhongMaterial)&&S(f,r),r instanceof o.LineBasicMaterial?w(f,r):r instanceof o.LineDashedMaterial?(w(f,r),M(f,r)):r instanceof o.PointsMaterial?A(f,r):r instanceof o.MeshPhongMaterial?C(f,r):r instanceof o.MeshDepthMaterial?(f.mNear.value=e.near,f.mFar.value=e.far,f.opacity.value=r.opacity):r instanceof o.MeshNormalMaterial&&(f.opacity.value=r.opacity),n.receiveShadow&&!r._shadowPass&&I(f,t,e),L(s.uniformsList)),O(u,n),void 0!==u.modelMatrix&&Ve.uniformMatrix4fv(u.modelMatrix,!1,n.matrixWorld.elements),c}function S(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&(e.emissive.value=t.emissive),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i){i instanceof o.WebGLRenderTarget&&(i=i.texture);var r=i.offset,n=i.repeat;e.offsetRepeat.value.set(r.x,r.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof o.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function w(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function M(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function A(e,t){if(e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Z.height/2,e.map.value=t.map,null!==t.map){var i=t.map.offset,r=t.map.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}}function P(e,t){e.fogColor.value=t.color,t instanceof o.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof o.FogExp2&&(e.fogDensity.value=t.density)}function C(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function R(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function D(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function I(e,t,i){if(e.shadowMatrix)for(var r=0,n=0,s=t.length;n<s;n++){var a=t[n];if(!0===a.castShadow&&(a instanceof o.PointLight||a instanceof o.SpotLight||a instanceof o.DirectionalLight)){var l=a.shadow;a instanceof o.PointLight?(Oe.setFromMatrixPosition(a.matrixWorld).negate(),l.matrix.identity().setPosition(Oe),e.shadowDarkness.value[r]=-l.darkness):e.shadowDarkness.value[r]=l.darkness,e.shadowMatrix.value[r]=l.matrix,e.shadowMap.value[r]=l.map,e.shadowMapSize.value[r]=l.mapSize,e.shadowBias.value[r]=l.bias,r++}}}function O(e,t){Ve.uniformMatrix4fv(e.modelViewMatrix,!1,t.modelViewMatrix.elements),e.normalMatrix&&Ve.uniformMatrix3fv(e.normalMatrix,!1,t.normalMatrix.elements)}function F(){var e=Se;return e>=Ge.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ge.maxTextures),Se+=1,e}function L(e){for(var t,i,r=0,n=e.length;r<n;r++){var s=e[r][0];if(!1!==s.needsUpdate){var a=s.type,l=s.value,h=e[r][1];switch(a){case"1i":Ve.uniform1i(h,l);break;case"1f":Ve.uniform1f(h,l);break;case"2f":Ve.uniform2f(h,l[0],l[1]);break;case"3f":Ve.uniform3f(h,l[0],l[1],l[2]);break;case"4f":Ve.uniform4f(h,l[0],l[1],l[2],l[3]);break;case"1iv":Ve.uniform1iv(h,l);break;case"3iv":Ve.uniform3iv(h,l);break;case"1fv":Ve.uniform1fv(h,l);break;case"2fv":Ve.uniform2fv(h,l);break;case"3fv":Ve.uniform3fv(h,l);break;case"4fv":Ve.uniform4fv(h,l);break;case"Matrix3fv":Ve.uniformMatrix3fv(h,!1,l);break;case"Matrix4fv":Ve.uniformMatrix4fv(h,!1,l);break;case"i":Ve.uniform1i(h,l);break;case"f":Ve.uniform1f(h,l);break;case"v2":Ve.uniform2f(h,l.x,l.y);break;case"v3":Ve.uniform3f(h,l.x,l.y,l.z);break;case"v4":Ve.uniform4f(h,l.x,l.y,l.z,l.w);break;case"c":Ve.uniform3f(h,l.r,l.g,l.b);break;case"iv1":Ve.uniform1iv(h,l);break;case"iv":Ve.uniform3iv(h,l);break;case"fv1":Ve.uniform1fv(h,l);break;case"fv":Ve.uniform3fv(h,l);break;case"v2v":void 0===s._array&&(s._array=new Float32Array(2*l.length));for(var c=0,u=0,f=l.length;c<f;c++,u+=2)s._array[u+0]=l[c].x,s._array[u+1]=l[c].y;Ve.uniform2fv(h,s._array);break;case"v3v":void 0===s._array&&(s._array=new Float32Array(3*l.length));for(var c=0,d=0,f=l.length;c<f;c++,d+=3)s._array[d+0]=l[c].x,s._array[d+1]=l[c].y,s._array[d+2]=l[c].z;Ve.uniform3fv(h,s._array);break;case"v4v":void 0===s._array&&(s._array=new Float32Array(4*l.length));for(var c=0,p=0,f=l.length;c<f;c++,p+=4)s._array[p+0]=l[c].x,s._array[p+1]=l[c].y,s._array[p+2]=l[c].z,s._array[p+3]=l[c].w;Ve.uniform4fv(h,s._array);break;case"m3":Ve.uniformMatrix3fv(h,!1,l.elements);break;case"m3v":void 0===s._array&&(s._array=new Float32Array(9*l.length));for(var c=0,f=l.length;c<f;c++)l[c].flattenToArrayOffset(s._array,9*c);Ve.uniformMatrix3fv(h,!1,s._array);break;case"m4":Ve.uniformMatrix4fv(h,!1,l.elements);break;case"m4v":void 0===s._array&&(s._array=new Float32Array(16*l.length));for(var c=0,f=l.length;c<f;c++)l[c].flattenToArrayOffset(s._array,16*c);Ve.uniformMatrix4fv(h,!1,s._array);break;case"t":if(t=l,i=F(),Ve.uniform1i(h,i),!t)continue;t instanceof o.CubeTexture||Array.isArray(t.image)&&6===t.image.length?j(t,i):t instanceof o.WebGLRenderTargetCube?W(t.texture,i):t instanceof o.WebGLRenderTarget?ye.setTexture(t.texture,i):ye.setTexture(t,i);break;case"tv":void 0===s._array&&(s._array=[]);for(var c=0,f=s.value.length;c<f;c++)s._array[c]=F();Ve.uniform1iv(h,s._array);for(var c=0,f=s.value.length;c<f;c++)t=s.value[c],i=s._array[c],t&&(t instanceof o.CubeTexture||t.image instanceof Array&&6===t.image.length?j(t,i):t instanceof o.WebGLRenderTarget?ye.setTexture(t.texture,i):t instanceof o.WebGLRenderTargetCube?W(t.texture,i):ye.setTexture(t,i));break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+a)}}}}function B(e,t,i,r){e[t+0]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function N(e,t){var i,r,n,s,a,l,h,c,u=0,f=0,d=0,p=Be,m=t.matrixWorldInverse,g=p.directional.colors,v=p.directional.positions,y=p.point.colors,_=p.point.positions,b=p.point.distances,x=p.point.decays,T=p.spot.colors,E=p.spot.positions,S=p.spot.distances,w=p.spot.directions,M=p.spot.anglesCos,A=p.spot.exponents,P=p.spot.decays,C=p.hemi.skyColors,R=p.hemi.groundColors,D=p.hemi.positions,I=0,O=0,F=0,L=0,N=0,k=0,V=0,U=0,z=0,G=0,H=0,j=0;for(i=0,r=e.length;i<r;i++)if(n=e[i],s=n.color,h=n.intensity,c=n.distance,n instanceof o.AmbientLight){if(!n.visible)continue;u+=s.r,f+=s.g,d+=s.b}else if(n instanceof o.DirectionalLight){if(N+=1,!n.visible)continue;Fe.setFromMatrixPosition(n.matrixWorld),Oe.setFromMatrixPosition(n.target.matrixWorld),Fe.sub(Oe),Fe.transformDirection(m),z=3*I,v[z+0]=Fe.x,v[z+1]=Fe.y,v[z+2]=Fe.z,B(g,z,s,h),I+=1}else if(n instanceof o.PointLight){if(k+=1,!n.visible)continue;G=3*O,B(y,G,s,h),Oe.setFromMatrixPosition(n.matrixWorld),Oe.applyMatrix4(m),_[G+0]=Oe.x,_[G+1]=Oe.y,_[G+2]=Oe.z,b[O]=c,x[O]=0===n.distance?0:n.decay,O+=1}else if(n instanceof o.SpotLight){if(V+=1,!n.visible)continue;H=3*F,B(T,H,s,h),Fe.setFromMatrixPosition(n.matrixWorld),Oe.copy(Fe).applyMatrix4(m),E[H+0]=Oe.x,E[H+1]=Oe.y,E[H+2]=Oe.z,S[F]=c,Oe.setFromMatrixPosition(n.target.matrixWorld),Fe.sub(Oe),Fe.transformDirection(m),w[H+0]=Fe.x,w[H+1]=Fe.y,w[H+2]=Fe.z,M[F]=Math.cos(n.angle),A[F]=n.exponent,P[F]=0===n.distance?0:n.decay,F+=1}else if(n instanceof o.HemisphereLight){if(U+=1,!n.visible)continue;Fe.setFromMatrixPosition(n.matrixWorld),Fe.transformDirection(m),j=3*L,D[j+0]=Fe.x,D[j+1]=Fe.y,D[j+2]=Fe.z,a=n.color,l=n.groundColor,B(C,j,a,h),B(R,j,l,h),L+=1}for(i=3*I,r=Math.max(g.length,3*N);i<r;i++)g[i]=0;for(i=3*O,r=Math.max(y.length,3*k);i<r;i++)y[i]=0;for(i=3*F,r=Math.max(T.length,3*V);i<r;i++)T[i]=0;for(i=3*L,r=Math.max(C.length,3*U);i<r;i++)C[i]=0;for(i=3*L,r=Math.max(R.length,3*U);i<r;i++)R[i]=0;p.directional.length=I,p.point.length=O,p.spot.length=F,p.hemi.length=L,p.ambient[0]=u,p.ambient[1]=f,p.ambient[2]=d}function k(e,t,i){var r;if(i?(Ve.texParameteri(e,Ve.TEXTURE_WRAP_S,Q(t.wrapS)),Ve.texParameteri(e,Ve.TEXTURE_WRAP_T,Q(t.wrapT)),Ve.texParameteri(e,Ve.TEXTURE_MAG_FILTER,Q(t.magFilter)),Ve.texParameteri(e,Ve.TEXTURE_MIN_FILTER,Q(t.minFilter))):(Ve.texParameteri(e,Ve.TEXTURE_WRAP_S,Ve.CLAMP_TO_EDGE),Ve.texParameteri(e,Ve.TEXTURE_WRAP_T,Ve.CLAMP_TO_EDGE),t.wrapS===o.ClampToEdgeWrapping&&t.wrapT===o.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",t),Ve.texParameteri(e,Ve.TEXTURE_MAG_FILTER,q(t.magFilter)),Ve.texParameteri(e,Ve.TEXTURE_MIN_FILTER,q(t.minFilter)),t.minFilter!==o.NearestFilter&&t.minFilter!==o.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",t)),r=ze.get("EXT_texture_filter_anisotropic")){if(t.type===o.FloatType&&null===ze.get("OES_texture_float_linear"))return;if(t.type===o.HalfFloatType&&null===ze.get("OES_texture_half_float_linear"))return;(t.anisotropy>1||je.get(t).__currentAnisotropy)&&(Ve.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,ye.getMaxAnisotropy())),je.get(t).__currentAnisotropy=t.anisotropy)}}function V(e,t,i){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",s),e.__webglTexture=Ve.createTexture(),Ne.textures++),He.activeTexture(Ve.TEXTURE0+i),He.bindTexture(Ve.TEXTURE_2D,e.__webglTexture),Ve.pixelStorei(Ve.UNPACK_FLIP_Y_WEBGL,t.flipY),Ve.pixelStorei(Ve.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Ve.pixelStorei(Ve.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=U(t.image,Ge.maxTextureSize),G(t)&&!1===z(t.image)&&(t.image=H(t.image));var r=t.image,n=z(r),a=Q(t.format),l=Q(t.type);k(Ve.TEXTURE_2D,t,n);var h,c=t.mipmaps;if(t instanceof o.DataTexture)if(c.length>0&&n){for(var u=0,f=c.length;u<f;u++)h=c[u],He.texImage2D(Ve.TEXTURE_2D,u,a,h.width,h.height,0,a,l,h.data);t.generateMipmaps=!1}else He.texImage2D(Ve.TEXTURE_2D,0,a,r.width,r.height,0,a,l,r.data);else if(t instanceof o.CompressedTexture)for(var u=0,f=c.length;u<f;u++)h=c[u],t.format!==o.RGBAFormat&&t.format!==o.RGBFormat?He.getCompressedTextureFormats().indexOf(a)>-1?He.compressedTexImage2D(Ve.TEXTURE_2D,u,a,h.width,h.height,0,h.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):He.texImage2D(Ve.TEXTURE_2D,u,a,h.width,h.height,0,a,l,h.data);else if(c.length>0&&n){for(var u=0,f=c.length;u<f;u++)h=c[u],He.texImage2D(Ve.TEXTURE_2D,u,a,a,l,h);t.generateMipmaps=!1}else He.texImage2D(Ve.TEXTURE_2D,0,a,a,l,t.image);t.generateMipmaps&&n&&Ve.generateMipmap(Ve.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function U(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),r=document.createElement("canvas");r.width=Math.floor(e.width*i),r.height=Math.floor(e.height*i);return r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function z(e){return o.Math.isPowerOfTwo(e.width)&&o.Math.isPowerOfTwo(e.height)}function G(e){return e.wrapS!==o.ClampToEdgeWrapping||e.wrapT!==o.ClampToEdgeWrapping||e.minFilter!==o.NearestFilter&&e.minFilter!==o.LinearFilter}function H(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElement("canvas");t.width=o.Math.nearestPowerOfTwo(e.width),t.height=o.Math.nearestPowerOfTwo(e.height);return t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function j(e,t){var i=je.get(e);if(6===e.image.length)if(e.version>0&&i.__version!==e.version){i.__image__webglTextureCube||(e.addEventListener("dispose",s),i.__image__webglTextureCube=Ve.createTexture(),Ne.textures++),He.activeTexture(Ve.TEXTURE0+t),He.bindTexture(Ve.TEXTURE_CUBE_MAP,i.__image__webglTextureCube),Ve.pixelStorei(Ve.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof o.CompressedTexture,n=e.image[0]instanceof o.DataTexture,a=[],l=0;l<6;l++)!ye.autoScaleCubemaps||r||n?a[l]=n?e.image[l].image:e.image[l]:a[l]=U(e.image[l],Ge.maxCubemapSize);var h=a[0],c=z(h),u=Q(e.format),f=Q(e.type);k(Ve.TEXTURE_CUBE_MAP,e,c);for(var l=0;l<6;l++)if(r)for(var d,p=a[l].mipmaps,m=0,g=p.length;m<g;m++)d=p[m],e.format!==o.RGBAFormat&&e.format!==o.RGBFormat?He.getCompressedTextureFormats().indexOf(u)>-1?He.compressedTexImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+l,m,u,d.width,d.height,0,d.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):He.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+l,m,u,d.width,d.height,0,u,f,d.data);else n?He.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,u,a[l].width,a[l].height,0,u,f,a[l].data):He.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,u,u,f,a[l]);e.generateMipmaps&&c&&Ve.generateMipmap(Ve.TEXTURE_CUBE_MAP),i.__version=e.version,e.onUpdate&&e.onUpdate(e)}else He.activeTexture(Ve.TEXTURE0+t),He.bindTexture(Ve.TEXTURE_CUBE_MAP,i.__image__webglTextureCube)}function W(e,t){He.activeTexture(Ve.TEXTURE0+t),He.bindTexture(Ve.TEXTURE_CUBE_MAP,je.get(e).__webglTexture)}function X(e,t,i){Ve.bindFramebuffer(Ve.FRAMEBUFFER,e),Ve.framebufferTexture2D(Ve.FRAMEBUFFER,Ve.COLOR_ATTACHMENT0,i,je.get(t.texture).__webglTexture,0)}function Y(e,t){Ve.bindRenderbuffer(Ve.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Ve.renderbufferStorage(Ve.RENDERBUFFER,Ve.DEPTH_COMPONENT16,t.width,t.height),Ve.framebufferRenderbuffer(Ve.FRAMEBUFFER,Ve.DEPTH_ATTACHMENT,Ve.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Ve.renderbufferStorage(Ve.RENDERBUFFER,Ve.DEPTH_STENCIL,t.width,t.height),Ve.framebufferRenderbuffer(Ve.FRAMEBUFFER,Ve.DEPTH_STENCIL_ATTACHMENT,Ve.RENDERBUFFER,e)):Ve.renderbufferStorage(Ve.RENDERBUFFER,Ve.RGBA4,t.width,t.height)}function K(e){var t=e instanceof o.WebGLRenderTargetCube?Ve.TEXTURE_CUBE_MAP:Ve.TEXTURE_2D,i=je.get(e.texture).__webglTexture;He.bindTexture(t,i),Ve.generateMipmap(t),He.bindTexture(t,null)}function q(e){return e===o.NearestFilter||e===o.NearestMipMapNearestFilter||e===o.NearestMipMapLinearFilter?Ve.NEAREST:Ve.LINEAR}function Q(e){var t;if(e===o.RepeatWrapping)return Ve.REPEAT;if(e===o.ClampToEdgeWrapping)return Ve.CLAMP_TO_EDGE;if(e===o.MirroredRepeatWrapping)return Ve.MIRRORED_REPEAT;if(e===o.NearestFilter)return Ve.NEAREST;if(e===o.NearestMipMapNearestFilter)return Ve.NEAREST_MIPMAP_NEAREST;if(e===o.NearestMipMapLinearFilter)return Ve.NEAREST_MIPMAP_LINEAR;if(e===o.LinearFilter)return Ve.LINEAR;if(e===o.LinearMipMapNearestFilter)return Ve.LINEAR_MIPMAP_NEAREST;if(e===o.LinearMipMapLinearFilter)return Ve.LINEAR_MIPMAP_LINEAR;if(e===o.UnsignedByteType)return Ve.UNSIGNED_BYTE;if(e===o.UnsignedShort4444Type)return Ve.UNSIGNED_SHORT_4_4_4_4;if(e===o.UnsignedShort5551Type)return Ve.UNSIGNED_SHORT_5_5_5_1;if(e===o.UnsignedShort565Type)return Ve.UNSIGNED_SHORT_5_6_5;if(e===o.ByteType)return Ve.BYTE;if(e===o.ShortType)return Ve.SHORT;if(e===o.UnsignedShortType)return Ve.UNSIGNED_SHORT;if(e===o.IntType)return Ve.INT;if(e===o.UnsignedIntType)return Ve.UNSIGNED_INT;if(e===o.FloatType)return Ve.FLOAT;if(null!==(t=ze.get("OES_texture_half_float"))&&e===o.HalfFloatType)return t.HALF_FLOAT_OES;if(e===o.AlphaFormat)return Ve.ALPHA;if(e===o.RGBFormat)return Ve.RGB;if(e===o.RGBAFormat)return Ve.RGBA;if(e===o.LuminanceFormat)return Ve.LUMINANCE;if(e===o.LuminanceAlphaFormat)return Ve.LUMINANCE_ALPHA;if(e===o.AddEquation)return Ve.FUNC_ADD;if(e===o.SubtractEquation)return Ve.FUNC_SUBTRACT;if(e===o.ReverseSubtractEquation)return Ve.FUNC_REVERSE_SUBTRACT;if(e===o.ZeroFactor)return Ve.ZERO;if(e===o.OneFactor)return Ve.ONE;if(e===o.SrcColorFactor)return Ve.SRC_COLOR;if(e===o.OneMinusSrcColorFactor)return Ve.ONE_MINUS_SRC_COLOR;if(e===o.SrcAlphaFactor)return Ve.SRC_ALPHA;if(e===o.OneMinusSrcAlphaFactor)return Ve.ONE_MINUS_SRC_ALPHA;if(e===o.DstAlphaFactor)return Ve.DST_ALPHA;if(e===o.OneMinusDstAlphaFactor)return Ve.ONE_MINUS_DST_ALPHA;if(e===o.DstColorFactor)return Ve.DST_COLOR;if(e===o.OneMinusDstColorFactor)return Ve.ONE_MINUS_DST_COLOR;if(e===o.SrcAlphaSaturateFactor)return Ve.SRC_ALPHA_SATURATE;if(null!==(t=ze.get("WEBGL_compressed_texture_s3tc"))){if(e===o.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===o.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(t=ze.get("WEBGL_compressed_texture_pvrtc"))){if(e===o.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===o.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===o.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===o.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(t=ze.get("EXT_blend_minmax"))){if(e===o.MinEquation)return t.MIN_EXT;if(e===o.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",o.REVISION),e=e||{};var Z=void 0!==e.canvas?e.canvas:document.createElement("canvas"),J=void 0!==e.context?e.context:null,$=Z.width,ee=Z.height,te=1,ie=void 0!==e.alpha&&e.alpha,re=void 0===e.depth||e.depth,ne=void 0===e.stencil||e.stencil,oe=void 0!==e.antialias&&e.antialias,se=void 0===e.premultipliedAlpha||e.premultipliedAlpha,ae=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,le=new o.Color(0),he=0,ce=[],ue=[],fe=-1,de=[],pe=-1,me=new Float32Array(8),ge=[],ve=[];this.domElement=Z,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var ye=this,_e=null,be=null,xe=-1,Te="",Ee=null,Se=0,we=0,Me=0,Ae=Z.width,Pe=Z.height,Ce=0,Re=0,De=new o.Frustum,Ie=new o.Matrix4,Oe=new o.Vector3,Fe=new o.Vector3,Le=!0,Be={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Ne={geometries:0,textures:0},ke={calls:0,vertices:0,faces:0,points:0};this.info={render:ke,memory:Ne,programs:null};var Ve;try{var Ue={alpha:ie,depth:re,stencil:ne,antialias:oe,premultipliedAlpha:se,preserveDrawingBuffer:ae};if(null===(Ve=J||Z.getContext("webgl",Ue)||Z.getContext("experimental-webgl",Ue)))throw null!==Z.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";Z.addEventListener("webglcontextlost",n,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var ze=new o.WebGLExtensions(Ve);ze.get("OES_texture_float"),ze.get("OES_texture_float_linear"),ze.get("OES_texture_half_float"),ze.get("OES_texture_half_float_linear"),ze.get("OES_standard_derivatives"),ze.get("ANGLE_instanced_arrays"),ze.get("OES_element_index_uint")&&(o.BufferGeometry.MaxIndex=4294967296);var Ge=new o.WebGLCapabilities(Ve,ze,e),He=new o.WebGLState(Ve,ze,Q),je=new o.WebGLProperties,We=new o.WebGLObjects(Ve,je,this.info),Xe=new o.WebGLPrograms(this,Ge);this.info.programs=Xe.programs;var Ye=new o.WebGLBufferRenderer(Ve,ze,ke),Ke=new o.WebGLIndexedBufferRenderer(Ve,ze,ke);i(),this.context=Ve,this.capabilities=Ge,this.extensions=ze,this.state=He;var qe=new o.WebGLShadowMap(this,ce,We);this.shadowMap=qe;var Qe=new o.SpritePlugin(this,ge),Ze=new o.LensFlarePlugin(this,ve);this.getContext=function(){return Ve},this.getContextAttributes=function(){return Ve.getContextAttributes()},this.forceContextLoss=function(){ze.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(void 0!==e)return e;var t=ze.get("EXT_texture_filter_anisotropic");return e=null!==t?Ve.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Ge.precision},this.getPixelRatio=function(){return te},this.setPixelRatio=function(e){void 0!==e&&(te=e)},this.getSize=function(){return{width:$,height:ee}},this.setSize=function(e,t,i){$=e,ee=t,Z.width=e*te,Z.height=t*te,!1!==i&&(Z.style.width=e+"px",Z.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){we=e*te,Me=t*te,Ae=i*te,Pe=r*te,Ve.viewport(we,Me,Ae,Pe)},this.getViewport=function(e){e.x=we/te,e.y=Me/te,e.z=Ae/te,e.w=Pe/te},this.setScissor=function(e,t,i,r){Ve.scissor(e*te,t*te,i*te,r*te)},this.enableScissorTest=function(e){He.setScissorTest(e)},this.getClearColor=function(){return le},this.setClearColor=function(e,i){le.set(e),he=void 0!==i?i:1,t(le.r,le.g,le.b,he)},this.getClearAlpha=function(){return he},this.setClearAlpha=function(e){he=e,t(le.r,le.g,le.b,he)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=Ve.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=Ve.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=Ve.STENCIL_BUFFER_BIT),Ve.clear(r)},this.clearColor=function(){Ve.clear(Ve.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ve.clear(Ve.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ve.clear(Ve.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.resetGLState=r,this.dispose=function(){Z.removeEventListener("webglcontextlost",n,!1)},this.renderBufferImmediate=function(e,t,i){He.initAttributes();var r=je.get(e);e.hasPositions&&!r.position&&(r.position=Ve.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=Ve.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=Ve.createBuffer()),e.hasColors&&!r.color&&(r.color=Ve.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,r.position),Ve.bufferData(Ve.ARRAY_BUFFER,e.positionArray,Ve.DYNAMIC_DRAW),He.enableAttribute(n.position),Ve.vertexAttribPointer(n.position,3,Ve.FLOAT,!1,0,0)),e.hasNormals){if(Ve.bindBuffer(Ve.ARRAY_BUFFER,r.normal),"MeshPhongMaterial"!==i.type&&i.shading===o.FlatShading)for(var s=0,a=3*e.count;s<a;s+=9){var l=e.normalArray,h=(l[s+0]+l[s+3]+l[s+6])/3,c=(l[s+1]+l[s+4]+l[s+7])/3,u=(l[s+2]+l[s+5]+l[s+8])/3;l[s+0]=h,l[s+1]=c,l[s+2]=u,l[s+3]=h,l[s+4]=c,l[s+5]=u,l[s+6]=h,l[s+7]=c,l[s+8]=u}Ve.bufferData(Ve.ARRAY_BUFFER,e.normalArray,Ve.DYNAMIC_DRAW),He.enableAttribute(n.normal),Ve.vertexAttribPointer(n.normal,3,Ve.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,r.uv),Ve.bufferData(Ve.ARRAY_BUFFER,e.uvArray,Ve.DYNAMIC_DRAW),He.enableAttribute(n.uv),Ve.vertexAttribPointer(n.uv,2,Ve.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==o.NoColors&&(Ve.bindBuffer(Ve.ARRAY_BUFFER,r.color),Ve.bufferData(Ve.ARRAY_BUFFER,e.colorArray,Ve.DYNAMIC_DRAW),He.enableAttribute(n.color),Ve.vertexAttribPointer(n.color,3,Ve.FLOAT,!1,0,0)),He.disableUnusedAttributes(),Ve.drawArrays(Ve.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,s,a){x(n);var l=E(e,t,i,n,s),h=!1,c=r.id+"_"+l.id+"_"+n.wireframe;c!==Te&&(Te=c,h=!0);var u=s.morphTargetInfluences;if(void 0!==u){for(var f=[],m=0,g=u.length;m<g;m++){var v=u[m];f.push([v,m])}f.sort(p),f.length>8&&(f.length=8);for(var y=r.morphAttributes,m=0,g=f.length;m<g;m++){var v=f[m];if(me[m]=v[0],0!==v[0]){var _=v[1];!0===n.morphTargets&&y.position&&r.addAttribute("morphTarget"+m,y.position[_]),!0===n.morphNormals&&y.normal&&r.addAttribute("morphNormal"+m,y.normal[_])}else!0===n.morphTargets&&r.removeAttribute("morphTarget"+m),!0===n.morphNormals&&r.removeAttribute("morphNormal"+m)}var b=l.getUniforms();null!==b.morphTargetInfluences&&Ve.uniform1fv(b.morphTargetInfluences,me),h=!0}var _=r.index,T=r.attributes.position;!0===n.wireframe&&(_=We.getWireframeAttribute(r));var S;null!==_?(S=Ke,S.setIndex(_)):S=Ye,h&&(d(n,l,r),null!==_&&Ve.bindBuffer(Ve.ELEMENT_ARRAY_BUFFER,We.getAttributeBuffer(_)));var w=1/0;null!==_?w=_.count:void 0!==T&&(w=T.count);var M=r.drawRange.start,A=r.drawRange.count,P=null!==a?a.start:0,C=null!==a?a.count:1/0,R=Math.max(0,M,P),D=Math.min(0+w,M+A,P+C)-1,I=Math.max(0,D-R+1);if(s instanceof o.Mesh)!0===n.wireframe?(He.setLineWidth(n.wireframeLinewidth*te),S.setMode(Ve.LINES)):S.setMode(Ve.TRIANGLES),r instanceof o.InstancedBufferGeometry&&r.maxInstancedCount>0?S.renderInstances(r):S.render(R,I);else if(s instanceof o.Line){var O=n.linewidth;void 0===O&&(O=1),He.setLineWidth(O*te),s instanceof o.LineSegments?S.setMode(Ve.LINES):S.setMode(Ve.LINE_STRIP),S.render(R,I)}else s instanceof o.Points&&(S.setMode(Ve.POINTS),S.render(R,I))},this.render=function(e,t,i,r){if(t instanceof o.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var n=e.fog;if(Te="",xe=-1,Ee=null,Le=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Ie.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),De.setFromMatrix(Ie),ce.length=0,fe=-1,pe=-1,ge.length=0,ve.length=0,y(e,t),ue.length=fe+1,de.length=pe+1,!0===ye.sortObjects&&(ue.sort(m),de.sort(g)),qe.render(e),ke.calls=0,ke.vertices=0,ke.faces=0,ke.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),e.overrideMaterial){var s=e.overrideMaterial;_(ue,t,ce,n,s),_(de,t,ce,n,s)}else He.setBlending(o.NoBlending),_(ue,t,ce,n),_(de,t,ce,n);if(Qe.render(e,t),Ze.render(e,t,Ce,Re),i){var a=i.texture,l=z(i);a.generateMipmaps&&l&&a.minFilter!==o.NearestFilter&&a.minFilter!==o.LinearFilter&&K(i)}He.setDepthTest(!0),He.setDepthWrite(!0),He.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===o.CullFaceNone?He.disable(Ve.CULL_FACE):(t===o.FrontFaceDirectionCW?Ve.frontFace(Ve.CW):Ve.frontFace(Ve.CCW),e===o.CullFaceBack?Ve.cullFace(Ve.BACK):e===o.CullFaceFront?Ve.cullFace(Ve.FRONT):Ve.cullFace(Ve.FRONT_AND_BACK),He.enable(Ve.CULL_FACE))},this.setTexture=function(e,t){var i=je.get(e);if(e.version>0&&i.__version!==e.version){var r=e.image;return void 0===r?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e):!1===r.complete?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e):void V(i,e,t)}He.activeTexture(Ve.TEXTURE0+t),He.bindTexture(Ve.TEXTURE_2D,i.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof o.WebGLRenderTargetCube;if(e&&void 0===je.get(e).__webglFramebuffer){var i=je.get(e),r=je.get(e.texture);void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",a),r.__webglTexture=Ve.createTexture(),Ne.textures++;var n=z(e),s=Q(e.texture.format),l=Q(e.texture.type);if(t){i.__webglFramebuffer=[],i.__webglRenderbuffer=[],He.bindTexture(Ve.TEXTURE_CUBE_MAP,r.__webglTexture),k(Ve.TEXTURE_CUBE_MAP,e.texture,n);for(var h=0;h<6;h++)i.__webglFramebuffer[h]=Ve.createFramebuffer(),i.__webglRenderbuffer[h]=Ve.createRenderbuffer(),He.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,s,e.width,e.height,0,s,l,null),X(i.__webglFramebuffer[h],e,Ve.TEXTURE_CUBE_MAP_POSITIVE_X+h),Y(i.__webglRenderbuffer[h],e);e.texture.generateMipmaps&&n&&Ve.generateMipmap(Ve.TEXTURE_CUBE_MAP)}else i.__webglFramebuffer=Ve.createFramebuffer(),e.shareDepthFrom?i.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:i.__webglRenderbuffer=Ve.createRenderbuffer(),He.bindTexture(Ve.TEXTURE_2D,r.__webglTexture),k(Ve.TEXTURE_2D,e.texture,n),He.texImage2D(Ve.TEXTURE_2D,0,s,e.width,e.height,0,s,l,null),X(i.__webglFramebuffer,e,Ve.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Ve.framebufferRenderbuffer(Ve.FRAMEBUFFER,Ve.DEPTH_ATTACHMENT,Ve.RENDERBUFFER,i.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Ve.framebufferRenderbuffer(Ve.FRAMEBUFFER,Ve.DEPTH_STENCIL_ATTACHMENT,Ve.RENDERBUFFER,i.__webglRenderbuffer):Y(i.__webglRenderbuffer,e),e.texture.generateMipmaps&&n&&Ve.generateMipmap(Ve.TEXTURE_2D);t?He.bindTexture(Ve.TEXTURE_CUBE_MAP,null):He.bindTexture(Ve.TEXTURE_2D,null),Ve.bindRenderbuffer(Ve.RENDERBUFFER,null),Ve.bindFramebuffer(Ve.FRAMEBUFFER,null)}var c,u,f,d,p;if(e){var i=je.get(e);c=t?i.__webglFramebuffer[e.activeCubeFace]:i.__webglFramebuffer,u=e.width,f=e.height,d=0,p=0}else c=null,u=Ae,f=Pe,d=we,p=Me;if(c!==be&&(Ve.bindFramebuffer(Ve.FRAMEBUFFER,c),Ve.viewport(d,p,u,f),be=c),t){var r=je.get(e.texture);Ve.framebufferTexture2D(Ve.FRAMEBUFFER,Ve.COLOR_ATTACHMENT0,Ve.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,0)}Ce=u,Re=f},this.readRenderTargetPixels=function(e,t,i,r,n,s){if(e instanceof o.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var a=je.get(e).__webglFramebuffer;if(a){var l=!1;a!==be&&(Ve.bindFramebuffer(Ve.FRAMEBUFFER,a),l=!0);try{var h=e.texture;if(h.format!==o.RGBAFormat&&Q(h.format)!==Ve.getParameter(Ve.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h.type===o.UnsignedByteType||Q(h.type)===Ve.getParameter(Ve.IMPLEMENTATION_COLOR_READ_TYPE)||h.type===o.FloatType&&ze.get("WEBGL_color_buffer_float")||h.type===o.HalfFloatType&&ze.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ve.checkFramebufferStatus(Ve.FRAMEBUFFER)===Ve.FRAMEBUFFER_COMPLETE?Ve.readPixels(t,i,r,n,Q(h.format),Q(h.type),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&Ve.bindFramebuffer(Ve.FRAMEBUFFER,be)}}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),ze.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),ze.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),ze.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),ze.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),ze.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),ze.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return Ge.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),ze.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return qe.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),qe.enabled=e}},shadowMapType:{get:function(){return qe.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),qe.type=e}},shadowMapCullFace:{get:function(){return qe.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),qe.cullFace=e}},shadowMapDebug:{get:function(){return qe.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),qe.debug=e}}})},o.WebGLRenderTarget=function(e,t,i){this.uuid=o.Math.generateUUID(),this.width=e,this.height=t,i=i||{},void 0===i.minFilter&&(i.minFilter=o.LinearFilter),this.texture=new o.Texture(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.shareDepthFrom=void 0!==i.shareDepthFrom?i.shareDepthFrom:null},o.WebGLRenderTarget.prototype={constructor:o.WebGLRenderTarget,get wrapS(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set wrapS(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e},get wrapT(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set wrapT(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e},get magFilter(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set magFilter(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e},get minFilter(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set minFilter(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e},get anisotropy(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set anisotropy(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e},get offset(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set offset(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e},get repeat(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set repeat(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e},get format(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set format(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e},get type(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set type(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e},get generateMipmaps(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set generateMipmaps(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e},setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose())},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.EventDispatcher.prototype.apply(o.WebGLRenderTarget.prototype),o.WebGLRenderTargetCube=function(e,t,i){o.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},o.WebGLRenderTargetCube.prototype=Object.create(o.WebGLRenderTarget.prototype),o.WebGLRenderTargetCube.prototype.constructor=o.WebGLRenderTargetCube,o.WebGLBufferRenderer=function(e,t,i){function r(e){a=e}function n(t,r){e.drawArrays(a,t,r),i.calls++,i.vertices+=r,a===e.TRIANGLES&&(i.faces+=r/3)}function s(e){var i=t.get("ANGLE_instanced_arrays");if(null===i)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var r=e.attributes.position;r instanceof o.InterleavedBufferAttribute?i.drawArraysInstancedANGLE(a,0,r.data.count,e.maxInstancedCount):i.drawArraysInstancedANGLE(a,0,r.count,e.maxInstancedCount)}var a;this.setMode=r,this.render=n,this.renderInstances=s},o.WebGLIndexedBufferRenderer=function(e,t,i){function r(e){a=e}function n(i){i.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(l=e.UNSIGNED_INT,h=4):(l=e.UNSIGNED_SHORT,h=2)}function o(t,r){e.drawElements(a,r,l,t*h),i.calls++,i.vertices+=r,a===e.TRIANGLES&&(i.faces+=r/3)}function s(e){var i=t.get("ANGLE_instanced_arrays");if(null===i)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var r=e.index;i.drawElementsInstancedANGLE(a,r.array.length,l,0,e.maxInstancedCount)}var a,l,h;this.setMode=r,this.setIndex=n,this.render=o,this.renderInstances=s},o.WebGLExtensions=function(e){var t={};this.get=function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}},o.WebGLCapabilities=function(e,t,i){function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=r,this.precision=void 0!==i.precision?i.precision:"highp",this.logarithmicDepthBuffer=void 0!==i.logarithmicDepthBuffer&&i.logarithmicDepthBuffer,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var n=r(this.precision);n!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",n,"instead."),this.precision=n),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},o.WebGLGeometries=function(e,t,i){function r(e){var t=e.geometry;if(void 0!==c[t.id])return c[t.id];t.addEventListener("dispose",n);var r;return t instanceof o.BufferGeometry?r=t:t instanceof o.Geometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new o.BufferGeometry).setFromObject(e)),r=t._bufferGeometry),c[t.id]=r,i.memory.geometries++,r}function n(e){var r=e.target;l(c[r.id].attributes),r.removeEventListener("dispose",n),delete c[r.id];var o=t.get(r);o.wireframe&&a(o.wireframe),i.memory.geometries--}function s(e){return e instanceof o.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function a(t){var i=s(t);void 0!==i&&(e.deleteBuffer(i),h(t))}function l(e){for(var t in e)a(e[t])}function h(e){e instanceof o.InterleavedBufferAttribute?t.delete(e.data):t.delete(e)}var c={};this.get=r},o.WebGLObjects=function(e,t,i){function r(t){var i=u.get(t);t.geometry instanceof o.Geometry&&i.updateFromObject(t);var r=i.index,s=i.attributes;null!==r&&n(r,e.ELEMENT_ARRAY_BUFFER);for(var a in s)n(s[a],e.ARRAY_BUFFER);var l=i.morphAttributes;for(var a in l)for(var h=l[a],c=0,f=h.length;c<f;c++)n(h[c],e.ARRAY_BUFFER);return i}function n(e,i){var r=e instanceof o.InterleavedBufferAttribute?e.data:e,n=t.get(r);void 0===n.__webglBuffer?s(n,r,i):n.version!==r.version&&a(n,r,i)}function s(t,i,r){t.__webglBuffer=e.createBuffer(),e.bindBuffer(r,t.__webglBuffer);var n=i.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(r,i.array,n),t.version=i.version}function a(t,i,r){e.bindBuffer(r,t.__webglBuffer),!1===i.dynamic||-1===i.updateRange.count?e.bufferSubData(r,0,i.array):0===i.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,i.updateRange.offset*i.array.BYTES_PER_ELEMENT,i.array.subarray(i.updateRange.offset,i.updateRange.offset+i.updateRange.count)),i.updateRange.count=0),t.version=i.version}function l(e){return e instanceof o.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function h(i){var r=t.get(i);if(void 0!==r.wireframe)return r.wireframe;var s=[],a=i.index,l=i.attributes,h=l.position;if(null!==a)for(var u={},f=a.array,d=0,p=f.length;d<p;d+=3){var m=f[d+0],g=f[d+1],v=f[d+2];c(u,m,g)&&s.push(m,g),c(u,g,v)&&s.push(g,v),c(u,v,m)&&s.push(v,m)}else for(var f=l.position.array,d=0,p=f.length/3-1;d<p;d+=3){var m=d+0,g=d+1,v=d+2;s.push(m,g,g,v,v,m)}var y=h.count>65535?Uint32Array:Uint16Array,_=new o.BufferAttribute(new y(s),1);return n(_,e.ELEMENT_ARRAY_BUFFER),r.wireframe=_,_}function c(e,t,i){if(t>i){var r=t;t=i,i=r}var n=e[t];return void 0===n?(e[t]=[i],!0):-1===n.indexOf(i)&&(n.push(i),!0)}var u=new o.WebGLGeometries(e,t,i);this.getAttributeBuffer=l,this.getWireframeAttribute=h,this.update=r},o.WebGLProgram=function(){function e(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}function t(e,t,i){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<n;o++){var s=e.getActiveUniform(t,o),a=s.name,l=e.getUniformLocation(t,a),h=a.lastIndexOf("[0]");-1!==h&&h===a.length-3&&(r[a.substr(0,h)]=l),r[a]=l}return r}function i(e,t,i){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var s=e.getActiveAttrib(t,o),a=s.name;r[a]=e.getAttribLocation(t,a)}return r}function r(e){return""!==e}var n=0;return function(s,a,l,h){var c=s.context,u=l.defines,f=l.__webglShader.vertexShader,d=l.__webglShader.fragmentShader,p="SHADOWMAP_TYPE_BASIC";h.shadowMapType===o.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":h.shadowMapType===o.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var m="ENVMAP_TYPE_CUBE",g="ENVMAP_MODE_REFLECTION",v="ENVMAP_BLENDING_MULTIPLY";if(h.envMap){switch(l.envMap.mapping){case o.CubeReflectionMapping:case o.CubeRefractionMapping:m="ENVMAP_TYPE_CUBE";break;case o.EquirectangularReflectionMapping:case o.EquirectangularRefractionMapping:m="ENVMAP_TYPE_EQUIREC";break;case o.SphericalReflectionMapping:m="ENVMAP_TYPE_SPHERE"}switch(l.envMap.mapping){case o.CubeRefractionMapping:case o.EquirectangularRefractionMapping:g="ENVMAP_MODE_REFRACTION"}switch(l.combine){case o.MultiplyOperation:v="ENVMAP_BLENDING_MULTIPLY";break;case o.MixOperation:v="ENVMAP_BLENDING_MIX";break;case o.AddOperation:v="ENVMAP_BLENDING_ADD"}}var y,_,b=s.gammaFactor>0?s.gammaFactor:1,x=e(u),T=c.createProgram();l instanceof o.RawShaderMaterial?(y="",_=""):(y=["precision "+h.precision+" float;","precision "+h.precision+" int;","#define SHADER_NAME "+l.__webglShader.name,x,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+b,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+g:"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.displacementMap&&h.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals&&!1===h.flatShading?"#define USE_MORPHNORMALS":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+p:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(r).join("\n"),_=[h.bumpMap||h.normalMap||h.flatShading||l.derivatives?"#extension GL_OES_standard_derivatives : enable":"",h.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+h.precision+" float;","precision "+h.precision+" int;","#define SHADER_NAME "+l.__webglShader.name,x,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",s.gammaInput?"#define GAMMA_INPUT":"",s.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+b,h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.envMap?"#define "+m:"",h.envMap?"#define "+g:"",h.envMap?"#define "+v:"",h.lightMap?"#define USE_LIGHTMAP":"",h.aoMap?"#define USE_AOMAP":"",h.emissiveMap?"#define USE_EMISSIVEMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.flatShading?"#define FLAT_SHADED":"",h.metal?"#define METAL":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+p:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",h.logarithmicDepthBuffer&&s.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(r).join("\n"));var E=y+f,S=_+d,w=o.WebGLShader(c,c.VERTEX_SHADER,E),M=o.WebGLShader(c,c.FRAGMENT_SHADER,S);c.attachShader(T,w),c.attachShader(T,M),void 0!==l.index0AttributeName?c.bindAttribLocation(T,0,l.index0AttributeName):!0===h.morphTargets&&c.bindAttribLocation(T,0,"position"),c.linkProgram(T);var A=c.getProgramInfoLog(T),P=c.getShaderInfoLog(w),C=c.getShaderInfoLog(M),R=!0,D=!0;!1===c.getProgramParameter(T,c.LINK_STATUS)?(R=!1,console.error("THREE.WebGLProgram: shader error: ",c.getError(),"gl.VALIDATE_STATUS",c.getProgramParameter(T,c.VALIDATE_STATUS),"gl.getProgramInfoLog",A,P,C)):""!==A?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",A):""!==P&&""!==C||(D=!1),D&&(this.diagnostics={runnable:R,material:l,programLog:A,vertexShader:{log:P,prefix:y},fragmentShader:{log:C,prefix:_}}),c.deleteShader(w),c.deleteShader(M);var I;this.getUniforms=function(){return void 0===I&&(I=t(c,T)),I};var O;return this.getAttributes=function(){return void 0===O&&(O=i(c,T)),O},this.destroy=function(){c.deleteProgram(T),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=n++,this.code=a,this.usedTimes=1,this.program=T,this.vertexShader=w,this.fragmentShader=M,this}}(),o.WebGLPrograms=function(e,t){function i(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var i=t.maxVertexUniforms,r=Math.floor((i-20)/4),n=r;return void 0!==e&&e instanceof o.SkinnedMesh&&(n=Math.min(e.skeleton.bones.length,n))<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)"),n}function r(e){for(var t=0,i=0,r=0,n=0,s=0,a=e.length;s<a;s++){var l=e[s];!1!==l.visible&&(l instanceof o.DirectionalLight&&t++,l instanceof o.PointLight&&i++,l instanceof o.SpotLight&&r++,l instanceof o.HemisphereLight&&n++)}return{directional:t,point:i,spot:r,hemi:n}}function n(e){for(var t=0,i=0,r=0,n=e.length;r<n;r++){var s=e[r];s.castShadow&&((s instanceof o.SpotLight||s instanceof o.DirectionalLight)&&t++,s instanceof o.PointLight&&(t++,i++))}return{maxShadows:t,pointLightShadows:i}}var s=[],a={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},l=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","pointLightShadows","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];this.getParameters=function(s,l,h,c){var u=a[s.type],f=r(l),d=n(l),p=i(c),m=e.getPrecision();return null!==s.precision&&(m=t.getMaxPrecision(s.precision))!==s.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",s.precision,"not supported, using",m,"instead."),{shaderID:u,precision:m,supportsVertexTextures:t.vertexTextures,map:!!s.map,envMap:!!s.envMap,envMapMode:s.envMap&&s.envMap.mapping,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,displacementMap:!!s.displacementMap,specularMap:!!s.specularMap,alphaMap:!!s.alphaMap,combine:s.combine,vertexColors:s.vertexColors,fog:h,useFog:s.fog,fogExp:h instanceof o.FogExp2,flatShading:s.shading===o.FlatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:s.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&c&&c.skeleton&&c.skeleton.useVertexTexture,morphTargets:s.morphTargets,morphNormals:s.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:f.directional,maxPointLights:f.point,maxSpotLights:f.spot,maxHemiLights:f.hemi,maxShadows:d.maxShadows,pointLightShadows:d.pointLightShadows,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&d.maxShadows>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:s.alphaTest,metal:s.metal,doubleSided:s.side===o.DoubleSide,flipSided:s.side===o.BackSide}},this.getProgramCode=function(e,t){var i=[];if(t.shaderID?i.push(t.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(var r in e.defines)i.push(r),i.push(e.defines[r]);for(var n=0;n<l.length;n++){var o=l[n];i.push(o),i.push(t[o])}return i.join()},this.acquireProgram=function(t,i,r){for(var n,a=0,l=s.length;a<l;a++){var h=s[a];if(h.code===r){n=h,++n.usedTimes;break}}return void 0===n&&(n=new o.WebGLProgram(e,r,t,i),s.push(n)),n},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},this.programs=s},o.WebGLProperties=function(){var e={};this.get=function(t){var i=t.uuid,r=e[i];return void 0===r&&(r={},e[i]=r),r},this.delete=function(t){delete e[t.uuid]},this.clear=function(){e={}}},o.WebGLShader=function(){function e(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}return function(t,i,r){var n=t.createShader(i);return t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",i===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(n),e(r)),n}}(),o.WebGLShadowMap=function(e,t,i){function r(e,t,i,r){var n=e.geometry,s=null,a=g,l=e.customDepthMaterial;if(i&&(a=v,l=e.customDistanceMaterial),l)s=l;else{var h=void 0!==n.morphTargets&&n.morphTargets.length>0&&t.morphTargets,c=e instanceof o.SkinnedMesh&&t.skinning,u=0;h&&(u|=d),c&&(u|=p),s=a[u]}return s.visible=t.visible,s.wireframe=t.wireframe,s.wireframeLinewidth=t.wireframeLinewidth,i&&void 0!==s.uniforms.lightPos&&s.uniforms.lightPos.value.copy(r),s}function n(e,t){if(!1!==e.visible){if((e instanceof o.Mesh||e instanceof o.Line||e instanceof o.Points)&&e.castShadow&&(!1===e.frustumCulled||!0===l.intersectsObject(e))){!0===e.material.visible&&(e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),f.push(e))}for(var i=e.children,r=0,s=i.length;r<s;r++)n(i[r],t)}}for(var s=e.context,a=e.state,l=new o.Frustum,h=new o.Matrix4,c=(new o.Vector3,new o.Vector3,new o.Vector3),u=new o.Vector3,f=[],d=1,p=2,m=1+(d|p),g=new Array(m),v=new Array(m),y=[new o.Vector3(1,0,0),new o.Vector3(-1,0,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1),new o.Vector3(0,1,0),new o.Vector3(0,-1,0)],_=[new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,1,0),new o.Vector3(0,0,1),new o.Vector3(0,0,-1)],b=[new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4,new o.Vector4],x=new o.Vector4,T=o.ShaderLib.depthRGBA,E=o.UniformsUtils.clone(T.uniforms),S=o.ShaderLib.distanceRGBA,w=o.UniformsUtils.clone(S.uniforms),M=0;M!==m;++M){var A=0!=(M&d),P=0!=(M&p),C=new o.ShaderMaterial({uniforms:E,vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,morphTargets:A,skinning:P});C._shadowPass=!0,g[M]=C;var R=new o.ShaderMaterial({uniforms:w,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,morphTargets:A,skinning:P});R._shadowPass=!0,v[M]=R}var D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=o.PCFShadowMap,this.cullFace=o.CullFaceFront,this.render=function(d){var p,m;if(!1!==D.enabled&&(!1!==D.autoUpdate||!1!==D.needsUpdate)){s.clearColor(1,1,1,1),a.disable(s.BLEND),a.enable(s.CULL_FACE),s.frontFace(s.CCW),s.cullFace(D.cullFace===o.CullFaceFront?s.FRONT:s.BACK),a.setDepthTest(!0),e.getViewport(x);for(var g=0,v=t.length;g<v;g++){var T=t[g];if(!0===T.castShadow){var E=T.shadow,S=E.camera,w=E.mapSize;if(T instanceof o.PointLight){p=6,m=!0;var M=w.x/4,A=w.y/2;b[0].set(2*M,A,M,A),b[1].set(0,A,M,A),b[2].set(3*M,A,M,A),b[3].set(M,A,M,A),b[4].set(3*M,0,M,A),b[5].set(M,0,M,A)}else p=1,m=!1;if(null===E.map){var P=o.LinearFilter;D.type===o.PCFSoftShadowMap&&(P=o.NearestFilter);var C={minFilter:P,magFilter:P,format:o.RGBAFormat};E.map=new o.WebGLRenderTarget(w.x,w.y,C),E.matrix=new o.Matrix4,T instanceof o.SpotLight&&(S.aspect=w.x/w.y),S.updateProjectionMatrix()}var R=E.map,I=E.matrix;u.setFromMatrixPosition(T.matrixWorld),S.position.copy(u),e.setRenderTarget(R),e.clear();for(var O=0;O<p;O++){if(m){c.copy(S.position),c.add(y[O]),S.up.copy(_[O]),S.lookAt(c);var F=b[O];e.setViewport(F.x,F.y,F.z,F.w)}else c.setFromMatrixPosition(T.target.matrixWorld),S.lookAt(c);S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(S.projectionMatrix),I.multiply(S.matrixWorldInverse),h.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),l.setFromMatrix(h),f.length=0,n(d,S);for(var L=0,B=f.length;L<B;L++){var N=f[L],k=i.update(N),V=N.material;if(V instanceof o.MeshFaceMaterial)for(var U=k.groups,z=V.materials,G=0,H=U.length;G<H;G++){var j=U[G],W=z[j.materialIndex];if(!0===W.visible){var X=r(N,W,m,u);e.renderBufferDirect(S,t,null,k,X,N,j)}}else{var X=r(N,V,m,u);e.renderBufferDirect(S,t,null,k,X,N,null)}}}e.resetGLState()}}e.setViewport(x.x,x.y,x.z,x.w);var Y=e.getClearColor(),K=e.getClearAlpha();e.setClearColor(Y,K),a.enable(s.BLEND),D.cullFace===o.CullFaceFront&&s.cullFace(s.BACK),e.resetGLState(),D.needsUpdate=!1}}},o.WebGLState=function(e,t,i){var r=this,n=new Uint8Array(16),s=new Uint8Array(16),a=new Uint8Array(16),l={},h=null,c=null,u=null,f=null,d=null,p=null,m=null,g=null,v=null,y=null,_=null,b=null,x=null,T=null,E=null,S=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),w=void 0,M={};this.init=function(){e.clearColor(0,0,0,1),e.clearDepth(1),e.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=n.length;e<t;e++)n[e]=0},this.enableAttribute=function(i){if(n[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),0!==a[i]){t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),a[i]=0}},this.enableAttributeAndDivisor=function(t,i,r){n[t]=1,0===s[t]&&(e.enableVertexAttribArray(t),s[t]=1),a[t]!==i&&(r.vertexAttribDivisorANGLE(t,i),a[t]=i)},this.disableUnusedAttributes=function(){for(var t=0,i=s.length;t<i;t++)s[t]!==n[t]&&(e.disableVertexAttribArray(t),s[t]=0)},this.enable=function(t){!0!==l[t]&&(e.enable(t),l[t]=!0)},this.disable=function(t){!1!==l[t]&&(e.disable(t),l[t]=!1)},this.getCompressedTextureFormats=function(){if(null===h&&(h=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)h.push(i[r]);return h},this.setBlending=function(t,r,n,s,a,l,h){t!==c&&(t===o.NoBlending?this.disable(e.BLEND):t===o.AdditiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===o.SubtractiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===o.MultiplyBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):t===o.CustomBlending?this.enable(e.BLEND):(this.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),c=t),t===o.CustomBlending?(a=a||r,l=l||n,h=h||s,r===u&&a===p||(e.blendEquationSeparate(i(r),i(a)),u=r,p=a),n===f&&s===d&&l===m&&h===g||(e.blendFuncSeparate(i(n),i(s),i(l),i(h)),f=n,d=s,m=l,g=h)):(u=null,f=null,d=null,p=null,m=null,g=null)},this.setDepthFunc=function(t){if(v!==t){if(t)switch(t){case o.NeverDepth:e.depthFunc(e.NEVER);break;case o.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case o.LessDepth:e.depthFunc(e.LESS);break;case o.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case o.EqualDepth:e.depthFunc(e.EQUAL);break;case o.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case o.GreaterDepth:e.depthFunc(e.GREATER);break;case o.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);v=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){y!==t&&(e.depthMask(t),y=t)},this.setColorWrite=function(t){_!==t&&(e.colorMask(t,t,t,t),_=t)},this.setFlipSided=function(t){b!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),b=t)},this.setLineWidth=function(t){t!==x&&(e.lineWidth(t),x=t)},this.setPolygonOffset=function(t,i,r){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),!t||T===i&&E===r||(e.polygonOffset(i,r),T=i,E=r)},this.setScissorTest=function(t){t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){void 0===t&&(t=e.TEXTURE0+S-1),w!==t&&(e.activeTexture(t),w=t)},this.bindTexture=function(t,i){void 0===w&&r.activeTexture();var n=M[w];void 0===n&&(n={type:void 0,texture:void 0},M[w]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i),n.type=t,n.texture=i)},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error(e)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error(e)}},this.reset=function(){for(var t=0;t<s.length;t++)1===s[t]&&(e.disableVertexAttribArray(t),s[t]=0);l={},h=null,c=null,y=null,_=null,b=null}},o.LensFlarePlugin=function(e,t){function i(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);n=d.createBuffer(),s=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,n),d.bufferData(d.ARRAY_BUFFER,e,d.STATIC_DRAW),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),d.bufferData(d.ELEMENT_ARRAY_BUFFER,t,d.STATIC_DRAW),u=d.createTexture(),f=d.createTexture(),p.bindTexture(d.TEXTURE_2D,u),d.texImage2D(d.TEXTURE_2D,0,d.RGB,16,16,0,d.RGB,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),p.bindTexture(d.TEXTURE_2D,f),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,16,16,0,d.RGBA,d.UNSIGNED_BYTE,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),c=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var i;i=c?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},a=r(i),l={vertex:d.getAttribLocation(a,"position"),uv:d.getAttribLocation(a,"uv")},h={renderType:d.getUniformLocation(a,"renderType"),map:d.getUniformLocation(a,"map"),occlusionMap:d.getUniformLocation(a,"occlusionMap"),opacity:d.getUniformLocation(a,"opacity"),color:d.getUniformLocation(a,"color"),scale:d.getUniformLocation(a,"scale"),rotation:d.getUniformLocation(a,"rotation"),screenPosition:d.getUniformLocation(a,"screenPosition")}}function r(t){var i=d.createProgram(),r=d.createShader(d.FRAGMENT_SHADER),n=d.createShader(d.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return d.shaderSource(r,o+t.fragmentShader),d.shaderSource(n,o+t.vertexShader),d.compileShader(r),d.compileShader(n),d.attachShader(i,r),d.attachShader(i,n),d.linkProgram(i),i}var n,s,a,l,h,c,u,f,d=e.context,p=e.state;this.render=function(r,m,g,v){if(0!==t.length){var y=new o.Vector3,_=v/g,b=.5*g,x=.5*v,T=16/v,E=new o.Vector2(T*_,T),S=new o.Vector3(1,1,0),w=new o.Vector2(1,1);void 0===a&&i(),d.useProgram(a),p.initAttributes(),p.enableAttribute(l.vertex),p.enableAttribute(l.uv),p.disableUnusedAttributes(),d.uniform1i(h.occlusionMap,0),d.uniform1i(h.map,1),d.bindBuffer(d.ARRAY_BUFFER,n),d.vertexAttribPointer(l.vertex,2,d.FLOAT,!1,16,0),d.vertexAttribPointer(l.uv,2,d.FLOAT,!1,16,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),p.disable(d.CULL_FACE),d.depthMask(!1);for(var M=0,A=t.length;M<A;M++){T=16/v,E.set(T*_,T);var P=t[M];if(y.set(P.matrixWorld.elements[12],P.matrixWorld.elements[13],P.matrixWorld.elements[14]),y.applyMatrix4(m.matrixWorldInverse),y.applyProjection(m.projectionMatrix),S.copy(y),w.x=S.x*b+b,w.y=S.y*x+x,c||w.x>0&&w.x<g&&w.y>0&&w.y<v){p.activeTexture(d.TEXTURE0),p.bindTexture(d.TEXTURE_2D,null),p.activeTexture(d.TEXTURE1),p.bindTexture(d.TEXTURE_2D,u),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGB,w.x-8,w.y-8,16,16,0),d.uniform1i(h.renderType,0),d.uniform2f(h.scale,E.x,E.y),d.uniform3f(h.screenPosition,S.x,S.y,S.z),p.disable(d.BLEND),p.enable(d.DEPTH_TEST),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),p.activeTexture(d.TEXTURE0),p.bindTexture(d.TEXTURE_2D,f),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,w.x-8,w.y-8,16,16,0),d.uniform1i(h.renderType,1),p.disable(d.DEPTH_TEST),p.activeTexture(d.TEXTURE1),p.bindTexture(d.TEXTURE_2D,u),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0),P.positionScreen.copy(S),P.customUpdateCallback?P.customUpdateCallback(P):P.updateLensFlares(),d.uniform1i(h.renderType,2),p.enable(d.BLEND);for(var C=0,R=P.lensFlares.length;C<R;C++){var D=P.lensFlares[C];D.opacity>.001&&D.scale>.001&&(S.x=D.x,S.y=D.y,S.z=D.z,T=D.size*D.scale/v,E.x=T*_,E.y=T,d.uniform3f(h.screenPosition,S.x,S.y,S.z),d.uniform2f(h.scale,E.x,E.y),d.uniform1f(h.rotation,D.rotation),d.uniform1f(h.opacity,D.opacity),d.uniform3f(h.color,D.color.r,D.color.g,D.color.b),p.setBlending(D.blending,D.blendEquation,D.blendSrc,D.blendDst),e.setTexture(D.texture,1),d.drawElements(d.TRIANGLES,6,d.UNSIGNED_SHORT,0))}}}p.enable(d.CULL_FACE),p.enable(d.DEPTH_TEST),d.depthMask(!0),e.resetGLState()}}},o.SpritePlugin=function(e,t){function i(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);s=f.createBuffer(),a=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,s),f.bufferData(f.ARRAY_BUFFER,e,f.STATIC_DRAW),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),f.bufferData(f.ELEMENT_ARRAY_BUFFER,t,f.STATIC_DRAW),l=r(),h={position:f.getAttribLocation(l,"position"),uv:f.getAttribLocation(l,"uv")},c={uvOffset:f.getUniformLocation(l,"uvOffset"),uvScale:f.getUniformLocation(l,"uvScale"),rotation:f.getUniformLocation(l,"rotation"),scale:f.getUniformLocation(l,"scale"),color:f.getUniformLocation(l,"color"),map:f.getUniformLocation(l,"map"),opacity:f.getUniformLocation(l,"opacity"),modelViewMatrix:f.getUniformLocation(l,"modelViewMatrix"),projectionMatrix:f.getUniformLocation(l,"projectionMatrix"),fogType:f.getUniformLocation(l,"fogType"),fogDensity:f.getUniformLocation(l,"fogDensity"),fogNear:f.getUniformLocation(l,"fogNear"),fogFar:f.getUniformLocation(l,"fogFar"),fogColor:f.getUniformLocation(l,"fogColor"),alphaTest:f.getUniformLocation(l,"alphaTest")};var i=document.createElement("canvas");i.width=8,i.height=8;var n=i.getContext("2d");n.fillStyle="white",n.fillRect(0,0,8,8),u=new o.Texture(i),u.needsUpdate=!0}function r(){var t=f.createProgram(),i=f.createShader(f.VERTEX_SHADER),r=f.createShader(f.FRAGMENT_SHADER);return f.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),f.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),f.compileShader(i),f.compileShader(r),f.attachShader(t,i),f.attachShader(t,r),f.linkProgram(t),t}function n(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var s,a,l,h,c,u,f=e.context,d=e.state,p=new o.Vector3,m=new o.Quaternion,g=new o.Vector3;this.render=function(r,v){if(0!==t.length){void 0===l&&i(),f.useProgram(l),d.initAttributes(),d.enableAttribute(h.position),d.enableAttribute(h.uv),d.disableUnusedAttributes(),d.disable(f.CULL_FACE),d.enable(f.BLEND),f.bindBuffer(f.ARRAY_BUFFER,s),f.vertexAttribPointer(h.position,2,f.FLOAT,!1,16,0),f.vertexAttribPointer(h.uv,2,f.FLOAT,!1,16,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),f.uniformMatrix4fv(c.projectionMatrix,!1,v.projectionMatrix.elements),d.activeTexture(f.TEXTURE0),f.uniform1i(c.map,0);var y=0,_=0,b=r.fog;b?(f.uniform3f(c.fogColor,b.color.r,b.color.g,b.color.b),b instanceof o.Fog?(f.uniform1f(c.fogNear,b.near),f.uniform1f(c.fogFar,b.far),f.uniform1i(c.fogType,1),y=1,_=1):b instanceof o.FogExp2&&(f.uniform1f(c.fogDensity,b.density),f.uniform1i(c.fogType,2),y=2,_=2)):(f.uniform1i(c.fogType,0),y=0,_=0);for(var x=0,T=t.length;x<T;x++){var E=t[x];E.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,E.matrixWorld),E.z=-E.modelViewMatrix.elements[14]}t.sort(n);for(var S=[],x=0,T=t.length;x<T;x++){var E=t[x],w=E.material;f.uniform1f(c.alphaTest,w.alphaTest),f.uniformMatrix4fv(c.modelViewMatrix,!1,E.modelViewMatrix.elements),E.matrixWorld.decompose(p,m,g),S[0]=g.x,S[1]=g.y;var M=0;r.fog&&w.fog&&(M=_),y!==M&&(f.uniform1i(c.fogType,M),y=M),null!==w.map?(f.uniform2f(c.uvOffset,w.map.offset.x,w.map.offset.y),f.uniform2f(c.uvScale,w.map.repeat.x,w.map.repeat.y)):(f.uniform2f(c.uvOffset,0,0),f.uniform2f(c.uvScale,1,1)),f.uniform1f(c.opacity,w.opacity),f.uniform3f(c.color,w.color.r,w.color.g,w.color.b),f.uniform1f(c.rotation,w.rotation),f.uniform2fv(c.scale,S),d.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst),d.setDepthTest(w.depthTest),d.setDepthWrite(w.depthWrite),w.map&&w.map.image&&w.map.image.width?e.setTexture(w.map,0):e.setTexture(u,0),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0)}d.enable(f.CULL_FACE),e.resetGLState()}}},o.CurveUtils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,n){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*n},tangentSpline:function(e,t,i,r,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,n){var o=.5*(i-e),s=.5*(r-t),a=n*n;return(2*t-2*i+o+s)*(n*a)+(-3*t+3*i-2*o-s)*a+o*n+t}},o.GeometryUtils={merge:function(e,t,i){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t instanceof o.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},o.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture is being deprecated. Use THREE.TextureLoader() instead.");var n=new o.TextureLoader;n.setCrossOrigin(this.crossOrigin);var s=n.load(e,i,void 0,r);return t&&(s.mapping=t),s},loadTextureCube:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube is being deprecated. Use THREE.CubeTextureLoader() instead.");var n=new o.CubeTextureLoader;n.setCrossOrigin(this.crossOrigin);var s=n.load(e,i,void 0,r);return t&&(s.mapping=t),s},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},o.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new o.Group,r=0,n=t.length;r<n;r++)i.add(new o.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new o.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},o.ShapeUtils={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},triangulate:function(){function e(e,t,i,r,n,o){var s,a,l,h,c,u,f,d,p;if(a=e[o[t]].x,l=e[o[t]].y,h=e[o[i]].x,c=e[o[i]].y,u=e[o[r]].x,f=e[o[r]].y,Number.EPSILON>(h-a)*(f-l)-(c-l)*(u-a))return!1;var m,g,v,y,_,b,x,T,E,S,w,M,A,P,C;for(m=u-h,g=f-c,v=a-u,y=l-f,_=h-a,b=c-l,s=0;s<n;s++)if(d=e[o[s]].x,p=e[o[s]].y,!(d===a&&p===l||d===h&&p===c||d===u&&p===f)&&(x=d-a,T=p-l,E=d-h,S=p-c,w=d-u,M=p-f,C=m*S-g*E,A=_*T-b*x,P=v*M-y*w,C>=-Number.EPSILON&&P>=-Number.EPSILON&&A>=-Number.EPSILON))return!1;return!0}return function(t,i){var r=t.length;if(r<3)return null;var n,s,a,l=[],h=[],c=[];if(o.ShapeUtils.area(t)>0)for(s=0;s<r;s++)h[s]=s;else for(s=0;s<r;s++)h[s]=r-1-s;var u=r,f=2*u;for(s=u-1;u>2;){if(f--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),i?c:l;if(n=s,u<=n&&(n=0),s=n+1,u<=s&&(s=0),a=s+1,u<=a&&(a=0),e(t,n,s,a,u,h)){var d,p,m,g,v;for(d=h[n],p=h[s],m=h[a],l.push([t[d],t[p],t[m]]),c.push([h[n],h[s],h[a]]),g=s,v=s+1;v<u;g++,v++)h[g]=h[v];u--,f=2*u}}return i?c:l}}(),triangulateShape:function(e,t){function i(e,t,i){return e.x!==t.x?e.x<t.x?e.x<=i.x&&i.x<=t.x:t.x<=i.x&&i.x<=e.x:e.y<t.y?e.y<=i.y&&i.y<=t.y:t.y<=i.y&&i.y<=e.y}function r(e,t,r,n,o){var s=t.x-e.x,a=t.y-e.y,l=n.x-r.x,h=n.y-r.y,c=e.x-r.x,u=e.y-r.y,f=a*l-s*h,d=a*c-s*u;if(Math.abs(f)>Number.EPSILON){var p;if(f>0){if(d<0||d>f)return[];if((p=h*c-l*u)<0||p>f)return[]}else{if(d>0||d<f)return[];if((p=h*c-l*u)>0||p<f)return[]}if(0===p)return!o||0!==d&&d!==f?[e]:[];if(p===f)return!o||0!==d&&d!==f?[t]:[];if(0===d)return[r];if(d===f)return[n];var m=p/f;return[{x:e.x+m*s,y:e.y+m*a}]}if(0!==d||h*c!=l*u)return[];var g=0===s&&0===a,v=0===l&&0===h;if(g&&v)return e.x!==r.x||e.y!==r.y?[]:[e];if(g)return i(r,n,e)?[e]:[];if(v)return i(e,t,r)?[r]:[];var y,_,b,x,T,E,S,w;return 0!==s?(e.x<t.x?(y=e,b=e.x,_=t,x=t.x):(y=t,b=t.x,_=e,x=e.x),r.x<n.x?(T=r,S=r.x,E=n,w=n.x):(T=n,S=n.x,E=r,w=r.x)):(e.y<t.y?(y=e,b=e.y,_=t,x=t.y):(y=t,b=t.y,_=e,x=e.y),r.y<n.y?(T=r,S=r.y,E=n,w=n.y):(T=n,S=n.y,E=r,w=r.y)),b<=S?x<S?[]:x===S?o?[]:[T]:x<=w?[T,_]:[T,E]:b>w?[]:b===w?o?[]:[y]:x<=w?[y,_]:[y,E]}function n(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,s=i.x-e.x,a=i.y-e.y,l=r.x-e.x,h=r.y-e.y,c=n*a-o*s,u=n*h-o*l;if(Math.abs(c)>Number.EPSILON){var f=l*a-h*s;return c>0?u>=0&&f>=0:u>=0||f>=0}return u>0}for(var s,a,l,h,c,u,f={},d=e.concat(),p=0,m=t.length;p<m;p++)Array.prototype.push.apply(d,t[p]);for(s=0,a=d.length;s<a;s++)c=d[s].x+":"+d[s].y,void 0!==f[c]&&console.warn("THREE.Shape: Duplicate point",c),f[c]=s;var g=function(e,t){for(var i,o,s,a,l,h,c,u,f,d,p,m=e.concat(),g=[],v=[],y=0,_=t.length;y<_;y++)g.push(y);for(var b=0,x=2*g.length;g.length>0;){if(--x<0){console.log("Infinite Loop! Holes left:"+g.length+", Probably Hole outside Shape!");break}for(s=b;s<m.length;s++){a=m[s],o=-1;for(var y=0;y<g.length;y++)if(h=g[y],c=a.x+":"+a.y+":"+h,void 0===v[c]){i=t[h];for(var T=0;T<i.length;T++)if(l=i[T],function(e,t){var r=m.length-1,o=e-1;o<0&&(o=r);var s=e+1;s>r&&(s=0);var a=n(m[e],m[o],m[s],i[t]);if(!a)return!1;var l=i.length-1,h=t-1;h<0&&(h=l);var c=t+1;return c>l&&(c=0),!!(a=n(i[t],i[h],i[c],m[e]))}(s,T)&&!function(e,t){var i,n,o;for(i=0;i<m.length;i++)if(n=i+1,n%=m.length,o=r(e,t,m[i],m[n],!0),o.length>0)return!0;return!1}(a,l)&&!function(e,i){var n,o,s,a,l;for(n=0;n<g.length;n++)for(o=t[g[n]],s=0;s<o.length;s++)if(a=s+1,a%=o.length,l=r(e,i,o[s],o[a],!0),l.length>0)return!0;return!1}(a,l)){o=T,g.splice(y,1),u=m.slice(0,s+1),f=m.slice(s),d=i.slice(o),p=i.slice(0,o+1),m=u.concat(d).concat(p).concat(f),b=s;break}if(o>=0)break;v[c]=!0}if(o>=0)break}}return m}(e,t),v=o.ShapeUtils.triangulate(g,!1);for(s=0,a=v.length;s<a;s++)for(h=v[s],l=0;l<3;l++)c=h[l].x+":"+h[l].y,void 0!==(u=f[c])&&(h[l]=u);return v.concat()},isClockWise:function(e){return o.ShapeUtils.area(e)<0},b2:function(){function e(e,t){var i=1-e;return i*i*t}function t(e,t){return 2*(1-e)*e*t}function i(e,t){return e*e*t}return function(r,n,o,s){return e(r,n)+t(r,o)+i(r,s)}}(),b3:function(){function e(e,t){var i=1-e;return i*i*i*t}function t(e,t){var i=1-e;return 3*i*i*e*t}function i(e,t){return 3*(1-e)*e*e*t}function r(e,t){return e*e*e*t}return function(n,o,s,a,l){return e(n,o)+t(n,s)+i(n,a)+r(n,l)}}()},o.Audio=function(e){o.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},o.Audio.prototype=Object.create(o.Object3D.prototype),o.Audio.prototype.constructor=o.Audio,o.Audio.prototype.load=function(e){var t=this,i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},i.send(),this},o.Audio.prototype.play=function(){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},o.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},o.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},o.Audio.prototype.connect=function(){void 0!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},o.Audio.prototype.disconnect=function(){void 0!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},o.Audio.prototype.setFilter=function(e){!0===this.isPlaying?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},o.Audio.prototype.getFilter=function(){return this.filter},o.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate)},o.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},o.Audio.prototype.onEnded=function(){this.isPlaying=!1};o.Audio.prototype.setLoop=function(e){this.source.loop=e},o.Audio.prototype.getLoop=function(){return this.source.loop},o.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},o.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},o.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},o.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},o.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},o.Audio.prototype.getVolume=function(){return this.gain.gain.value},o.Audio.prototype.updateMatrixWorld=function(){var e=new o.Vector3;return function(t){o.Object3D.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),o.AudioListener=function(){o.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},o.AudioListener.prototype=Object.create(o.Object3D.prototype),o.AudioListener.prototype.constructor=o.AudioListener,o.AudioListener.prototype.updateMatrixWorld=function(){var e=new o.Vector3,t=new o.Quaternion,i=new o.Vector3,r=new o.Vector3;return function(n){o.Object3D.prototype.updateMatrixWorld.call(this,n);var s=this.context.listener,a=this.up;this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),s.setPosition(e.x,e.y,e.z),s.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z)}}(),o.Curve=function(){},o.Curve.prototype={constructor:o.Curve,getPoint:function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},getSpacedPoints:function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)t=this.getPoint(i/e),o+=t.distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var s,a=0,l=o-1;a<=l;)if(n=Math.floor(a+(l-a)/2),(s=r[n]-i)<0)a=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(n=l,r[n]===i){var h=n/(o-1);return h}var c=r[n],u=r[n+1],f=u-c,d=(i-c)/f,h=(n+d)/(o-1);return h},getTangent:function(e){var t=e-1e-4,i=e+1e-4;t<0&&(t=0),i>1&&(i=1);var r=this.getPoint(t);return this.getPoint(i).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)}},o.Curve.Utils=o.CurveUtils,o.Curve.create=function(e,t){return e.prototype=Object.create(o.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},o.CurvePath=function(){this.curves=[],this.autoClose=!1},o.CurvePath.prototype=Object.create(o.Curve.prototype),o.CurvePath.prototype.constructor=o.CurvePath,o.CurvePath.prototype.add=function(e){this.curves.push(e)},o.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new o.LineCurve(t,e))},o.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],s=1-n/o.getLength();return o.getPointAt(s)}r++}return null},o.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},o.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},o.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createGeometry=function(e){for(var t=new o.Geometry,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new o.Vector3(n.x,n.y,n.z||0))}return t},o.Path=function(e){o.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},o.Path.prototype=Object.create(o.CurvePath.prototype),o.Path.prototype.constructor=o.Path,o.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},o.Path.prototype.moveTo=function(e,t){this.actions.push({action:"moveTo",args:[e,t]})},o.Path.prototype.lineTo=function(e,t){var i=this.actions[this.actions.length-1].args,r=i[i.length-2],n=i[i.length-1],s=new o.LineCurve(new o.Vector2(r,n),new o.Vector2(e,t));this.curves.push(s),this.actions.push({action:"lineTo",args:[e,t]})},o.Path.prototype.quadraticCurveTo=function(e,t,i,r){var n=this.actions[this.actions.length-1].args,s=n[n.length-2],a=n[n.length-1],l=new o.QuadraticBezierCurve(new o.Vector2(s,a),new o.Vector2(e,t),new o.Vector2(i,r));this.curves.push(l),this.actions.push({action:"quadraticCurveTo",args:[e,t,i,r]})},o.Path.prototype.bezierCurveTo=function(e,t,i,r,n,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1],c=new o.CubicBezierCurve(new o.Vector2(l,h),new o.Vector2(e,t),new o.Vector2(i,r),new o.Vector2(n,s));this.curves.push(c),this.actions.push({action:"bezierCurveTo",args:[e,t,i,r,n,s]})},o.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],n=i[i.length-1],s=[new o.Vector2(r,n)];Array.prototype.push.apply(s,e);var a=new o.SplineCurve(s);this.curves.push(a),this.actions.push({action:"splineThru",args:t})},o.Path.prototype.arc=function(e,t,i,r,n,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,i,r,n,o)},o.Path.prototype.absarc=function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},o.Path.prototype.ellipse=function(e,t,i,r,n,o,s,a){var l=this.actions[this.actions.length-1].args,h=l[l.length-2],c=l[l.length-1];this.absellipse(e+h,t+c,i,r,n,o,s,a)},o.Path.prototype.absellipse=function(e,t,i,r,n,s,a,l){var h=[e,t,i,r,n,s,a,l||0],c=new o.EllipseCurve(e,t,i,r,n,s,a,l);this.curves.push(c);var u=c.getPoint(1);h.push(u.x),h.push(u.y),this.actions.push({action:"ellipse",args:h})},o.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},o.Path.prototype.getPoints=function(e,t){e=e||12;for(var i,r,n,s,a,l,h,c,u,f,d,p=o.ShapeUtils.b2,m=o.ShapeUtils.b3,g=[],v=0,y=this.actions.length;v<y;v++){var _=this.actions[v],b=_.action,x=_.args;switch(b){case"moveTo":case"lineTo":g.push(new o.Vector2(x[0],x[1]));break;case"quadraticCurveTo":i=x[2],r=x[3],a=x[0],l=x[1],g.length>0?(u=g[g.length-1],h=u.x,c=u.y):(u=this.actions[v-1].args,h=u[u.length-2],c=u[u.length-1]);for(var T=1;T<=e;T++){var E=T/e;f=p(E,h,a,i),d=p(E,c,l,r),g.push(new o.Vector2(f,d))}break;case"bezierCurveTo":i=x[4],r=x[5],a=x[0],l=x[1],n=x[2],s=x[3],g.length>0?(u=g[g.length-1],h=u.x,c=u.y):(u=this.actions[v-1].args,h=u[u.length-2],c=u[u.length-1]);for(var T=1;T<=e;T++){var E=T/e;f=m(E,h,a,n,i),d=m(E,c,l,s,r),g.push(new o.Vector2(f,d))}break;case"splineThru":u=this.actions[v-1].args;var S=new o.Vector2(u[u.length-2],u[u.length-1]),w=[S],M=e*x[0].length;w=w.concat(x[0]);for(var A=new o.SplineCurve(w),T=1;T<=M;T++)g.push(A.getPointAt(T/M));break;case"arc":for(var P,C=x[0],R=x[1],D=x[2],I=x[3],O=x[4],F=!!x[5],L=O-I,B=2*e,T=1;T<=B;T++){var E=T/B;F||(E=1-E),P=I+E*L,f=C+D*Math.cos(P),d=R+D*Math.sin(P),g.push(new o.Vector2(f,d))}break;case"ellipse":var P,N,k,C=x[0],R=x[1],V=x[2],U=x[3],I=x[4],O=x[5],F=!!x[6],z=x[7],L=O-I,B=2*e;0!==z&&(N=Math.cos(z),k=Math.sin(z));for(var T=1;T<=B;T++){var E=T/B;if(F||(E=1-E),P=I+E*L,f=C+V*Math.cos(P),d=R+U*Math.sin(P),0!==z){var G=f,H=d;f=(G-C)*N-(H-R)*k+C,d=(G-C)*k+(H-R)*N+R}g.push(new o.Vector2(f,d))}}}var j=g[g.length-1];return Math.abs(j.x-g[0].x)<Number.EPSILON&&Math.abs(j.y-g[0].y)<Number.EPSILON&&g.splice(g.length-1,1),t&&g.push(g[0]),g},o.Path.prototype.toShapes=function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],s=new o.Shape;s.actions=n.actions,s.curves=n.curves,t.push(s)}return t}var r=o.ShapeUtils.isClockWise,n=function(e){for(var t=[],i=new o.Path,r=0,n=e.length;r<n;r++){var s=e[r],a=s.args,l=s.action;"moveTo"===l&&0!==i.actions.length&&(t.push(i),i=new o.Path),i[l].apply(i,a)}return 0!==i.actions.length&&t.push(i),t}(this.actions);if(0===n.length)return[];if(!0===t)return i(n);var s,a,l,h=[];if(1===n.length)return a=n[0],l=new o.Shape,l.actions=a.actions,l.curves=a.curves,h.push(l),h;var c=!r(n[0].getPoints());c=e?!c:c;var u,f=[],d=[],p=[],m=0;d[m]=void 0,p[m]=[];for(var g=0,v=n.length;g<v;g++)a=n[g],u=a.getPoints(),s=r(u),s=e?!s:s,s?(!c&&d[m]&&m++,d[m]={s:new o.Shape,p:u},d[m].s.actions=a.actions,d[m].s.curves=a.curves,c&&m++,p[m]=[]):p[m].push({h:a,p:u[0]});if(!d[0])return i(n);if(d.length>1){for(var y=!1,_=[],b=0,x=d.length;b<x;b++)f[b]=[];for(var b=0,x=d.length;b<x;b++)for(var T=p[b],E=0;E<T.length;E++){for(var S=T[E],w=!0,M=0;M<d.length;M++)(function(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var s=t[n],a=t[o],l=a.x-s.x,h=a.y-s.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(s=t[o],l=-l,a=t[n],h=-h),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var c=h*(e.x-s.x)-l*(e.y-s.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r})(S.p,d[M].p)&&(b!==M&&_.push({froms:b,tos:M,hole:E}),w?(w=!1,f[M].push(S)):y=!0);w&&f[b].push(S)}_.length>0&&(y||(p=f))}for(var A,g=0,P=d.length;g<P;g++){l=d[g].s,h.push(l),A=p[g];for(var C=0,R=A.length;C<R;C++)l.holes.push(A[C].h)}return h},o.Shape=function(){o.Path.apply(this,arguments),this.holes=[]},o.Shape.prototype=Object.create(o.Path.prototype),o.Shape.prototype.constructor=o.Shape,o.Shape.prototype.extrude=function(e){return new o.ExtrudeGeometry(this,e)},o.Shape.prototype.makeGeometry=function(e){return new o.ShapeGeometry(this,e)},o.Shape.prototype.getPointsHoles=function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},o.Shape.prototype.extractAllPoints=function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},o.Shape.prototype.extractPoints=function(e){return this.extractAllPoints(e)},o.Shape.Utils=o.ShapeUtils,o.LineCurve=function(e,t){this.v1=e,this.v2=t},o.LineCurve.prototype=Object.create(o.Curve.prototype),o.LineCurve.prototype.constructor=o.LineCurve,o.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},o.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},o.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},o.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},o.QuadraticBezierCurve.prototype=Object.create(o.Curve.prototype),o.QuadraticBezierCurve.prototype.constructor=o.QuadraticBezierCurve,o.QuadraticBezierCurve.prototype.getPoint=function(e){var t=o.ShapeUtils.b2;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y))},o.QuadraticBezierCurve.prototype.getTangent=function(e){var t=o.CurveUtils.tangentQuadraticBezier;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y)).normalize()},o.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},o.CubicBezierCurve.prototype=Object.create(o.Curve.prototype),o.CubicBezierCurve.prototype.constructor=o.CubicBezierCurve,o.CubicBezierCurve.prototype.getPoint=function(e){var t=o.ShapeUtils.b3;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},o.CubicBezierCurve.prototype.getTangent=function(e){var t=o.CurveUtils.tangentCubicBezier;return new o.Vector2(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},o.SplineCurve=function(e){this.points=void 0==e?[]:e},o.SplineCurve.prototype=Object.create(o.Curve.prototype),o.SplineCurve.prototype.constructor=o.SplineCurve,o.SplineCurve.prototype.getPoint=function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,s=t[0===r?r:r-1],a=t[r],l=t[r>t.length-2?t.length-1:r+1],h=t[r>t.length-3?t.length-1:r+2],c=o.CurveUtils.interpolate;return new o.Vector2(c(s.x,a.x,l.x,h.x,n),c(s.y,a.y,l.y,h.y,n))},o.EllipseCurve=function(e,t,i,r,n,o,s,a){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a||0},o.EllipseCurve.prototype=Object.create(o.Curve.prototype),o.EllipseCurve.prototype.constructor=o.EllipseCurve,o.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;t<0&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI);var i;i=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t;var r=this.aX+this.xRadius*Math.cos(i),n=this.aY+this.yRadius*Math.sin(i);if(0!==this.aRotation){var s=Math.cos(this.aRotation),a=Math.sin(this.aRotation),l=r,h=n;r=(l-this.aX)*s-(h-this.aY)*a+this.aX,n=(l-this.aX)*a+(h-this.aY)*s+this.aY}return new o.Vector2(r,n)},o.ArcCurve=function(e,t,i,r,n,s){o.EllipseCurve.call(this,e,t,i,i,r,n,s)},o.ArcCurve.prototype=Object.create(o.EllipseCurve.prototype),o.ArcCurve.prototype.constructor=o.ArcCurve,o.LineCurve3=o.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new o.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),o.QuadraticBezierCurve3=o.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t=o.ShapeUtils.b2;return new o.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x),t(e,this.v0.y,this.v1.y,this.v2.y),t(e,this.v0.z,this.v1.z,this.v2.z))}),o.CubicBezierCurve3=o.Curve.create(function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},function(e){var t=o.ShapeUtils.b3;return new o.Vector3(t(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),o.SplineCurve3=o.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==e?[]:e},function(e){var t=this.points,i=(t.length-1)*e,r=Math.floor(i),n=i-r,s=t[0==r?r:r-1],a=t[r],l=t[r>t.length-2?t.length-1:r+1],h=t[r>t.length-3?t.length-1:r+2],c=o.CurveUtils.interpolate;return new o.Vector3(c(s.x,a.x,l.x,h.x,n),c(s.y,a.y,l.y,h.y,n),c(s.z,a.z,l.z,h.z,n))}),o.CatmullRomCurve3=function(){function e(){}var t=new o.Vector3,i=new e,r=new e,n=new e;return e.prototype.init=function(e,t,i,r){this.c0=e,this.c1=i,this.c2=-3*e+3*t-2*i-r,this.c3=2*e-2*t+i+r},e.prototype.initNonuniformCatmullRom=function(e,t,i,r,n,o,s){var a=(t-e)/n-(i-e)/(n+o)+(i-t)/o,l=(i-t)/o-(r-t)/(o+s)+(r-i)/s;a*=o,l*=o,this.init(t,i,a,l)},e.prototype.initCatmullRom=function(e,t,i,r,n){this.init(t,i,n*(i-e),n*(r-t))},e.prototype.calc=function(e){var t=e*e,i=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*i},o.Curve.create(function(e){this.points=e||[]},function(e){var s,a,l,h,c=this.points;h=c.length,h<2&&console.log("duh, you need at least 2 points"),s=(h-1)*e,a=Math.floor(s),0===(l=s-a)&&a===h-1&&(a=h-2,l=1);var u,f,d,p;if(0===a?(t.subVectors(c[0],c[1]).add(c[0]),u=t):u=c[a-1],f=c[a],d=c[a+1],a+2<h?p=c[a+2]:(t.subVectors(c[h-1],c[h-2]).add(c[h-2]),p=t),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var m="chordal"===this.type?.5:.25,g=Math.pow(u.distanceToSquared(f),m),v=Math.pow(f.distanceToSquared(d),m),y=Math.pow(d.distanceToSquared(p),m);v<1e-4&&(v=1),g<1e-4&&(g=v),y<1e-4&&(y=v),i.initNonuniformCatmullRom(u.x,f.x,d.x,p.x,g,v,y),r.initNonuniformCatmullRom(u.y,f.y,d.y,p.y,g,v,y),n.initNonuniformCatmullRom(u.z,f.z,d.z,p.z,g,v,y)}else if("catmullrom"===this.type){var _=void 0!==this.tension?this.tension:.5;i.initCatmullRom(u.x,f.x,d.x,p.x,_),r.initCatmullRom(u.y,f.y,d.y,p.y,_),n.initCatmullRom(u.z,f.z,d.z,p.z,_)}return new o.Vector3(i.calc(l),r.calc(l),n.calc(l))})}(),o.ClosedSplineCurve3=o.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=this.points,i=(t.length-0)*e,r=Math.floor(i),n=i-r;r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length;var s=t[(r-1)%t.length],a=t[r%t.length],l=t[(r+1)%t.length],h=t[(r+2)%t.length],c=o.CurveUtils.interpolate;return new o.Vector3(c(s.x,a.x,l.x,h.x,n),c(s.y,a.y,l.y,h.y,n),c(s.z,a.z,l.z,h.z,n))}),o.BoxGeometry=function(e,t,i,r,n,s){function a(e,t,i,r,n,s,a,h){var c,u,f,d=l.widthSegments,p=l.heightSegments,m=n/2,g=s/2,v=l.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",p=l.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",d=l.depthSegments);var y=d+1,_=p+1,b=n/d,x=s/p,T=new o.Vector3;for(T[c]=a>0?1:-1,f=0;f<_;f++)for(u=0;u<y;u++){var E=new o.Vector3;E[e]=(u*b-m)*i,E[t]=(f*x-g)*r,E[c]=a,l.vertices.push(E)}for(f=0;f<p;f++)for(u=0;u<d;u++){var S=u+y*f,w=u+y*(f+1),M=u+1+y*(f+1),A=u+1+y*f,P=new o.Vector2(u/d,1-f/p),C=new o.Vector2(u/d,1-(f+1)/p),R=new o.Vector2((u+1)/d,1-(f+1)/p),D=new o.Vector2((u+1)/d,1-f/p),I=new o.Face3(S+v,w+v,A+v);I.normal.copy(T),I.vertexNormals.push(T.clone(),T.clone(),T.clone()),I.materialIndex=h,l.faces.push(I),l.faceVertexUvs[0].push([P,C,D]),I=new o.Face3(w+v,M+v,A+v),I.normal.copy(T),I.vertexNormals.push(T.clone(),T.clone(),T.clone()),I.materialIndex=h,l.faces.push(I),l.faceVertexUvs[0].push([C.clone(),R,D.clone()])}}o.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s},this.widthSegments=r||1,this.heightSegments=n||1,this.depthSegments=s||1;var l=this,h=e/2,c=t/2,u=i/2;a("z","y",-1,-1,i,t,h,0),a("z","y",1,-1,i,t,-h,1),a("x","z",1,1,e,i,c,2),a("x","z",1,-1,e,i,-c,3),a("x","y",1,-1,e,t,u,4),a("x","y",-1,-1,e,t,-u,5),this.mergeVertices()},o.BoxGeometry.prototype=Object.create(o.Geometry.prototype),o.BoxGeometry.prototype.constructor=o.BoxGeometry,o.BoxGeometry.prototype.clone=function(){var e=this.parameters;return new o.BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)},o.CubeGeometry=o.BoxGeometry,o.CircleGeometry=function(e,t,i,r){o.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new o.CircleBufferGeometry(e,t,i,r))},o.CircleGeometry.prototype=Object.create(o.Geometry.prototype),o.CircleGeometry.prototype.constructor=o.CircleGeometry,o.CircleGeometry.prototype.clone=function(){var e=this.parameters;return new o.CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},o.CircleBufferGeometry=function(e,t,i,r){o.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n=t+2,s=new Float32Array(3*n),a=new Float32Array(3*n),l=new Float32Array(2*n);a[2]=1,l[0]=.5,l[1]=.5;for(var h=0,c=3,u=2;h<=t;h++,c+=3,u+=2){var f=i+h/t*r;s[c]=e*Math.cos(f),s[c+1]=e*Math.sin(f),a[c+2]=1,l[u]=(s[c]/e+1)/2,l[u+1]=(s[c+1]/e+1)/2}for(var d=[],c=1;c<=t;c++)d.push(c,c+1,0);this.setIndex(new o.BufferAttribute(new Uint16Array(d),1)),this.addAttribute("position",new o.BufferAttribute(s,3)),this.addAttribute("normal",new o.BufferAttribute(a,3)),this.addAttribute("uv",new o.BufferAttribute(l,2)),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.CircleBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.CircleBufferGeometry.prototype.constructor=o.CircleBufferGeometry,o.CircleBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.CircleBufferGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)},o.CylinderGeometry=function(e,t,i,r,n,s,a,l){o.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:l},e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100,r=r||8,n=n||1,s=void 0!==s&&s,a=void 0!==a?a:0,l=void 0!==l?l:2*Math.PI;var h,c,u=i/2,f=[],d=[];for(c=0;c<=n;c++){var p=[],m=[],g=c/n,v=g*(t-e)+e;for(h=0;h<=r;h++){var y=h/r,_=new o.Vector3;_.x=v*Math.sin(y*l+a),_.y=-g*i+u,_.z=v*Math.cos(y*l+a),this.vertices.push(_),p.push(this.vertices.length-1),m.push(new o.Vector2(y,1-g))}f.push(p),d.push(m)}var b,x,T=(t-e)/i;for(h=0;h<r;h++)for(0!==e?(b=this.vertices[f[0][h]].clone(),x=this.vertices[f[0][h+1]].clone()):(b=this.vertices[f[1][h]].clone(),x=this.vertices[f[1][h+1]].clone()),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*T).normalize(),x.setY(Math.sqrt(x.x*x.x+x.z*x.z)*T).normalize(),c=0;c<n;c++){var E=f[c][h],S=f[c+1][h],w=f[c+1][h+1],M=f[c][h+1],A=b.clone(),P=b.clone(),C=x.clone(),R=x.clone(),D=d[c][h].clone(),I=d[c+1][h].clone(),O=d[c+1][h+1].clone(),F=d[c][h+1].clone();this.faces.push(new o.Face3(E,S,M,[A,P,R])),this.faceVertexUvs[0].push([D,I,F]),this.faces.push(new o.Face3(S,w,M,[P.clone(),C,R.clone()])),this.faceVertexUvs[0].push([I.clone(),O,F.clone()])}if(!1===s&&e>0)for(this.vertices.push(new o.Vector3(0,u,0)),h=0;h<r;h++){var E=f[0][h],S=f[0][h+1],w=this.vertices.length-1,A=new o.Vector3(0,1,0),P=new o.Vector3(0,1,0),C=new o.Vector3(0,1,0),D=d[0][h].clone(),I=d[0][h+1].clone(),O=new o.Vector2(I.x,0);this.faces.push(new o.Face3(E,S,w,[A,P,C],void 0,1)),this.faceVertexUvs[0].push([D,I,O])}if(!1===s&&t>0)for(this.vertices.push(new o.Vector3(0,-u,0)),h=0;h<r;h++){var E=f[n][h+1],S=f[n][h],w=this.vertices.length-1,A=new o.Vector3(0,-1,0),P=new o.Vector3(0,-1,0),C=new o.Vector3(0,-1,0),D=d[n][h+1].clone(),I=d[n][h].clone(),O=new o.Vector2(I.x,1);this.faces.push(new o.Face3(E,S,w,[A,P,C],void 0,2)),this.faceVertexUvs[0].push([D,I,O])}this.computeFaceNormals()},o.CylinderGeometry.prototype=Object.create(o.Geometry.prototype),o.CylinderGeometry.prototype.constructor=o.CylinderGeometry,o.CylinderGeometry.prototype.clone=function(){var e=this.parameters;return new o.CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)},o.EdgesGeometry=function(e,t){function i(e,t){return e-t}o.BufferGeometry.call(this),t=void 0!==t?t:1;var r,n=Math.cos(o.Math.degToRad(t)),s=[0,0],a={},l=["a","b","c"];e instanceof o.BufferGeometry?(r=new o.Geometry,r.fromBufferGeometry(e)):r=e.clone(),r.mergeVertices(),r.computeFaceNormals();for(var h=r.vertices,c=r.faces,u=0,f=c.length;u<f;u++)for(var d=c[u],p=0;p<3;p++){s[0]=d[l[p]],s[1]=d[l[(p+1)%3]],s.sort(i);var m=s.toString();void 0===a[m]?a[m]={vert1:s[0],vert2:s[1],face1:u,face2:void 0}:a[m].face2=u}var g=[];for(var m in a){var v=a[m];if(void 0===v.face2||c[v.face1].normal.dot(c[v.face2].normal)<=n){var y=h[v.vert1];g.push(y.x),g.push(y.y),g.push(y.z),y=h[v.vert2],g.push(y.x),g.push(y.y),g.push(y.z)}}this.addAttribute("position",new o.BufferAttribute(new Float32Array(g),3))},o.EdgesGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.EdgesGeometry.prototype.constructor=o.EdgesGeometry,o.ExtrudeGeometry=function(e,t){if(void 0===e)return void(e=[]);o.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals()},o.ExtrudeGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry.prototype.constructor=o.ExtrudeGeometry,o.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++){var n=e[r];this.addShape(n,t)}},o.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function r(e,t,i){var r,n,s=1,a=e.x-t.x,l=e.y-t.y,h=i.x-e.x,c=i.y-e.y,u=a*a+l*l,f=a*c-l*h;if(Math.abs(f)>Number.EPSILON){var d=Math.sqrt(u),p=Math.sqrt(h*h+c*c),m=t.x-l/d,g=t.y+a/d,v=i.x-c/p,y=i.y+h/p,_=((v-m)*c-(y-g)*h)/(a*c-l*h);r=m+a*_-e.x,n=g+l*_-e.y;var b=r*r+n*n;if(b<=2)return new o.Vector2(r,n);s=Math.sqrt(b/2)}else{var x=!1;a>Number.EPSILON?h>Number.EPSILON&&(x=!0):a<-Number.EPSILON?h<-Number.EPSILON&&(x=!0):Math.sign(l)===Math.sign(c)&&(x=!0),x?(r=-l,n=a,s=Math.sqrt(u)):(r=a,n=l,s=Math.sqrt(u/2))}return new o.Vector2(r/s,n/s)}function n(e,t){var i,r;for(j=e.length;--j>=0;){i=j,r=j-1,r<0&&(r=e.length-1);var n=0,o=b+2*v;for(n=0;n<o;n++){var s=z*n,a=z*(n+1);l(t+i+s,t+r+s,t+r+a,t+i+a,e,n,o,i,r)}}}function s(e,t,i){A.vertices.push(new o.Vector3(e,t,i))}function a(e,t,i){e+=P,t+=P,i+=P,A.faces.push(new o.Face3(e,t,i,null,null,0));var r=E.generateTopUV(A,e,t,i);A.faceVertexUvs[0].push(r)}function l(e,t,i,r,n,s,a,l,h){e+=P,t+=P,i+=P,r+=P,A.faces.push(new o.Face3(e,t,r,null,null,1)),A.faces.push(new o.Face3(t,i,r,null,null,1));var c=E.generateSideWallUV(A,e,t,i,r);A.faceVertexUvs[0].push([c[0],c[1],c[3]]),A.faceVertexUvs[0].push([c[1],c[2],c[3]])}var h,c,u,f,d,p=void 0!==t.amount?t.amount:100,m=void 0!==t.bevelThickness?t.bevelThickness:6,g=void 0!==t.bevelSize?t.bevelSize:m-2,v=void 0!==t.bevelSegments?t.bevelSegments:3,y=void 0===t.bevelEnabled||t.bevelEnabled,_=void 0!==t.curveSegments?t.curveSegments:12,b=void 0!==t.steps?t.steps:1,x=t.extrudePath,T=!1,E=void 0!==t.UVGenerator?t.UVGenerator:o.ExtrudeGeometry.WorldUVGenerator;x&&(h=x.getSpacedPoints(b),T=!0,y=!1,c=void 0!==t.frames?t.frames:new o.TubeGeometry.FrenetFrames(x,b,!1),u=new o.Vector3,f=new o.Vector3,d=new o.Vector3),y||(v=0,m=0,g=0);var S,w,M,A=this,P=this.vertices.length,C=e.extractPoints(_),R=C.shape,D=C.holes,I=!o.ShapeUtils.isClockWise(R);if(I){for(R=R.reverse(),w=0,M=D.length;w<M;w++)S=D[w],o.ShapeUtils.isClockWise(S)&&(D[w]=S.reverse());I=!1}var O=o.ShapeUtils.triangulateShape(R,D),F=R;for(w=0,M=D.length;w<M;w++)S=D[w],R=R.concat(S);for(var L,B,N,k,V,U,z=R.length,G=O.length,H=[],j=0,W=F.length,X=W-1,Y=j+1;j<W;j++,X++,Y++)X===W&&(X=0),Y===W&&(Y=0),H[j]=r(F[j],F[X],F[Y]);var K,q=[],Q=H.concat();for(w=0,M=D.length;w<M;w++){for(S=D[w],K=[],j=0,W=S.length,X=W-1,Y=j+1;j<W;j++,X++,Y++)X===W&&(X=0),Y===W&&(Y=0),K[j]=r(S[j],S[X],S[Y]);q.push(K),Q=Q.concat(K)}for(L=0;L<v;L++){for(N=L/v,k=m*(1-N),B=g*Math.sin(N*Math.PI/2),j=0,W=F.length;j<W;j++)V=i(F[j],H[j],B),s(V.x,V.y,-k);for(w=0,M=D.length;w<M;w++)for(S=D[w],K=q[w],j=0,W=S.length;j<W;j++)V=i(S[j],K[j],B),s(V.x,V.y,-k)}for(B=g,j=0;j<z;j++)V=y?i(R[j],Q[j],B):R[j],T?(f.copy(c.normals[0]).multiplyScalar(V.x),u.copy(c.binormals[0]).multiplyScalar(V.y),d.copy(h[0]).add(f).add(u),s(d.x,d.y,d.z)):s(V.x,V.y,0);var Z;for(Z=1;Z<=b;Z++)for(j=0;j<z;j++)V=y?i(R[j],Q[j],B):R[j],T?(f.copy(c.normals[Z]).multiplyScalar(V.x),u.copy(c.binormals[Z]).multiplyScalar(V.y),d.copy(h[Z]).add(f).add(u),s(d.x,d.y,d.z)):s(V.x,V.y,p/b*Z);for(L=v-1;L>=0;L--){for(N=L/v,k=m*(1-N),B=g*Math.sin(N*Math.PI/2),j=0,W=F.length;j<W;j++)V=i(F[j],H[j],B),s(V.x,V.y,p+k);for(w=0,M=D.length;w<M;w++)for(S=D[w],K=q[w],j=0,W=S.length;j<W;j++)V=i(S[j],K[j],B),T?s(V.x,V.y+h[b-1].y,h[b-1].x+k):s(V.x,V.y,p+k)}!function(){if(y){var e=0,t=z*e;for(j=0;j<G;j++)U=O[j],a(U[2]+t,U[1]+t,U[0]+t);for(e=b+2*v,t=z*e,j=0;j<G;j++)U=O[j],a(U[0]+t,U[1]+t,U[2]+t)}else{for(j=0;j<G;j++)U=O[j],a(U[2],U[1],U[0]);for(j=0;j<G;j++)U=O[j],a(U[0]+z*b,U[1]+z*b,U[2]+z*b)}}(),function(){var e=0;for(n(F,e),e+=F.length,w=0,M=D.length;w<M;w++)S=D[w],n(S,e),e+=S.length}()},o.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r){var n=e.vertices,s=n[t],a=n[i],l=n[r];return[new o.Vector2(s.x,s.y),new o.Vector2(a.x,a.y),new o.Vector2(l.x,l.y)]},generateSideWallUV:function(e,t,i,r,n){var s=e.vertices,a=s[t],l=s[i],h=s[r],c=s[n];return Math.abs(a.y-l.y)<.01?[new o.Vector2(a.x,1-a.z),new o.Vector2(l.x,1-l.z),new o.Vector2(h.x,1-h.z),new o.Vector2(c.x,1-c.z)]:[new o.Vector2(a.y,1-a.z),new o.Vector2(l.y,1-l.z),new o.Vector2(h.y,1-h.z),new o.Vector2(c.y,1-c.z)]}},o.ShapeGeometry=function(e,t){o.Geometry.call(this),this.type="ShapeGeometry",!1===Array.isArray(e)&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},o.ShapeGeometry.prototype=Object.create(o.Geometry.prototype),o.ShapeGeometry.prototype.constructor=o.ShapeGeometry,o.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++)this.addShape(e[i],t);return this},o.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,n,s=void 0!==t.curveSegments?t.curveSegments:12,a=t.material,l=void 0===t.UVGenerator?o.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=this.vertices.length,c=e.extractPoints(s),u=c.shape,f=c.holes,d=!o.ShapeUtils.isClockWise(u);if(d){for(u=u.reverse(),i=0,r=f.length;i<r;i++)n=f[i],o.ShapeUtils.isClockWise(n)&&(f[i]=n.reverse());d=!1}var p=o.ShapeUtils.triangulateShape(u,f);for(i=0,r=f.length;i<r;i++)n=f[i],u=u.concat(n);var m,g,v=u.length,y=p.length;for(i=0;i<v;i++)m=u[i],this.vertices.push(new o.Vector3(m.x,m.y,0));for(i=0;i<y;i++){g=p[i];var _=g[0]+h,b=g[1]+h,x=g[2]+h;this.faces.push(new o.Face3(_,b,x,null,null,a)),this.faceVertexUvs[0].push(l.generateTopUV(this,_,b,x))}},o.LatheGeometry=function(e,t,i,r){o.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=t||12,i=i||0,r=r||2*Math.PI;for(var n=1/(e.length-1),s=1/t,a=0,l=t;a<=l;a++)for(var h=i+a*s*r,c=Math.cos(h),u=Math.sin(h),f=0,d=e.length;f<d;f++){var p=e[f],m=new o.Vector3;m.x=c*p.x-u*p.y,m.y=u*p.x+c*p.y,m.z=p.z,this.vertices.push(m)}for(var g=e.length,a=0,l=t;a<l;a++)for(var f=0,d=e.length-1;f<d;f++){var v=f+g*a,y=v,_=v+g,c=v+1+g,b=v+1,x=a*s,T=f*n,E=x+s,S=T+n;this.faces.push(new o.Face3(y,_,b)),this.faceVertexUvs[0].push([new o.Vector2(x,T),new o.Vector2(E,T),new o.Vector2(x,S)]),this.faces.push(new o.Face3(_,c,b)),this.faceVertexUvs[0].push([new o.Vector2(E,T),new o.Vector2(E,S),new o.Vector2(x,S)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},o.LatheGeometry.prototype=Object.create(o.Geometry.prototype),o.LatheGeometry.prototype.constructor=o.LatheGeometry,o.PlaneGeometry=function(e,t,i,r){o.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new o.PlaneBufferGeometry(e,t,i,r))},o.PlaneGeometry.prototype=Object.create(o.Geometry.prototype),o.PlaneGeometry.prototype.constructor=o.PlaneGeometry,o.PlaneGeometry.prototype.clone=function(){var e=this.parameters;return new o.PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},o.PlaneBufferGeometry=function(e,t,i,r){o.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};for(var n=e/2,s=t/2,a=Math.floor(i)||1,l=Math.floor(r)||1,h=a+1,c=l+1,u=e/a,f=t/l,d=new Float32Array(h*c*3),p=new Float32Array(h*c*3),m=new Float32Array(h*c*2),g=0,v=0,y=0;y<c;y++)for(var _=y*f-s,b=0;b<h;b++){var x=b*u-n;d[g]=x,d[g+1]=-_,p[g+2]=1,m[v]=b/a,m[v+1]=1-y/l,g+=3,v+=2}g=0;for(var T=new(d.length/3>65535?Uint32Array:Uint16Array)(a*l*6),y=0;y<l;y++)for(var b=0;b<a;b++){var E=b+h*y,S=b+h*(y+1),w=b+1+h*(y+1),M=b+1+h*y;T[g]=E,T[g+1]=S,T[g+2]=M,T[g+3]=S,T[g+4]=w,T[g+5]=M,g+=6}this.setIndex(new o.BufferAttribute(T,1)),this.addAttribute("position",new o.BufferAttribute(d,3)),this.addAttribute("normal",new o.BufferAttribute(p,3)),this.addAttribute("uv",new o.BufferAttribute(m,2))},o.PlaneBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.PlaneBufferGeometry.prototype.constructor=o.PlaneBufferGeometry,o.PlaneBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.PlaneBufferGeometry(e.width,e.height,e.widthSegments,e.heightSegments)},o.RingGeometry=function(e,t,i,r,n,s){o.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:s},e=e||0,t=t||50,n=void 0!==n?n:0,s=void 0!==s?s:2*Math.PI,i=void 0!==i?Math.max(3,i):8,r=void 0!==r?Math.max(1,r):8;var a,l,h=[],c=e,u=(t-e)/r;for(a=0;a<r+1;a++){for(l=0;l<i+1;l++){var f=new o.Vector3,d=n+l/i*s;f.x=c*Math.cos(d),f.y=c*Math.sin(d),this.vertices.push(f),h.push(new o.Vector2((f.x/t+1)/2,(f.y/t+1)/2))}c+=u}var p=new o.Vector3(0,0,1);for(a=0;a<r;a++){var m=a*(i+1);for(l=0;l<i;l++){var d=l+m,g=d,v=d+i+1,y=d+i+2;this.faces.push(new o.Face3(g,v,y,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[g].clone(),h[v].clone(),h[y].clone()]),g=d,v=d+i+2,y=d+1,this.faces.push(new o.Face3(g,v,y,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([h[g].clone(),h[v].clone(),h[y].clone()])}}this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,c)},o.RingGeometry.prototype=Object.create(o.Geometry.prototype),o.RingGeometry.prototype.constructor=o.RingGeometry,o.RingGeometry.prototype.clone=function(){var e=this.parameters;return new o.RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)},o.SphereGeometry=function(e,t,i,r,n,s,a){o.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new o.SphereBufferGeometry(e,t,i,r,n,s,a))},o.SphereGeometry.prototype=Object.create(o.Geometry.prototype),o.SphereGeometry.prototype.constructor=o.SphereGeometry,o.SphereGeometry.prototype.clone=function(){var e=this.parameters;return new o.SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},o.SphereBufferGeometry=function(e,t,i,r,n,s,a){o.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},e=e||50,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI,s=void 0!==s?s:0,a=void 0!==a?a:Math.PI;for(var l=s+a,h=(t+1)*(i+1),c=new o.BufferAttribute(new Float32Array(3*h),3),u=new o.BufferAttribute(new Float32Array(3*h),3),f=new o.BufferAttribute(new Float32Array(2*h),2),d=0,p=[],m=new o.Vector3,g=0;g<=i;g++){for(var v=[],y=g/i,_=0;_<=t;_++){var b=_/t,x=-e*Math.cos(r+b*n)*Math.sin(s+y*a),T=e*Math.cos(s+y*a),E=e*Math.sin(r+b*n)*Math.sin(s+y*a);m.set(x,T,E).normalize(),c.setXYZ(d,x,T,E),u.setXYZ(d,m.x,m.y,m.z),f.setXY(d,b,1-y),v.push(d),d++}p.push(v)}for(var S=[],g=0;g<i;g++)for(var _=0;_<t;_++){var w=p[g][_+1],M=p[g][_],A=p[g+1][_],P=p[g+1][_+1];(0!==g||s>0)&&S.push(w,M,P),(g!==i-1||l<Math.PI)&&S.push(M,A,P)}this.setIndex(new(c.count>65535?o.Uint32Attribute:o.Uint16Attribute)(S,1)),this.addAttribute("position",c),this.addAttribute("normal",u),this.addAttribute("uv",f),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.SphereBufferGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.SphereBufferGeometry.prototype.constructor=o.SphereBufferGeometry,o.SphereBufferGeometry.prototype.clone=function(){var e=this.parameters;return new o.SphereBufferGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)},o.TorusGeometry=function(e,t,i,r,n){o.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||100,t=t||40,i=i||8,r=r||6,n=n||2*Math.PI;for(var s=new o.Vector3,a=[],l=[],h=0;h<=i;h++)for(var c=0;c<=r;c++){var u=c/r*n,f=h/i*Math.PI*2;s.x=e*Math.cos(u),s.y=e*Math.sin(u);var d=new o.Vector3;d.x=(e+t*Math.cos(f))*Math.cos(u),d.y=(e+t*Math.cos(f))*Math.sin(u),d.z=t*Math.sin(f),this.vertices.push(d),a.push(new o.Vector2(c/r,h/i)),l.push(d.clone().sub(s).normalize())}for(var h=1;h<=i;h++)for(var c=1;c<=r;c++){var p=(r+1)*h+c-1,m=(r+1)*(h-1)+c-1,g=(r+1)*(h-1)+c,v=(r+1)*h+c,y=new o.Face3(p,m,v,[l[p].clone(),l[m].clone(),l[v].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[v].clone()]),y=new o.Face3(m,g,v,[l[m].clone(),l[g].clone(),l[v].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([a[m].clone(),a[g].clone(),a[v].clone()])}this.computeFaceNormals()},o.TorusGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusGeometry.prototype.constructor=o.TorusGeometry,o.TorusGeometry.prototype.clone=function(){var e=this.parameters;return new o.TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)},o.TorusKnotGeometry=function(e,t,i,r,n,s,a){function l(e,t,i,r,n){var s=Math.cos(e),a=Math.sin(e),l=t/i*e,h=Math.cos(l),c=r*(2+h)*.5*s,u=r*(2+h)*a*.5,f=n*r*Math.sin(l)*.5;return new o.Vector3(c,u,f)}o.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,p:n,q:s,heightScale:a},e=e||100,t=t||40,i=i||64,r=r||8,n=n||2,s=s||3,a=a||1;for(var h=new Array(i),c=new o.Vector3,u=new o.Vector3,f=new o.Vector3,d=0;d<i;++d){h[d]=new Array(r);var p=d/i*2*n*Math.PI,m=l(p,s,n,e,a),g=l(p+.01,s,n,e,a);c.subVectors(g,m),u.addVectors(g,m),f.crossVectors(c,u),u.crossVectors(f,c),f.normalize(),u.normalize();for(var v=0;v<r;++v){var y=v/r*2*Math.PI,_=-t*Math.cos(y),b=t*Math.sin(y),x=new o.Vector3;x.x=m.x+_*u.x+b*f.x,x.y=m.y+_*u.y+b*f.y,x.z=m.z+_*u.z+b*f.z,h[d][v]=this.vertices.push(x)-1}}for(var d=0;d<i;++d)for(var v=0;v<r;++v){var T=(d+1)%i,E=(v+1)%r,S=h[d][v],w=h[T][v],M=h[T][E],A=h[d][E],P=new o.Vector2(d/i,v/r),C=new o.Vector2((d+1)/i,v/r),R=new o.Vector2((d+1)/i,(v+1)/r),D=new o.Vector2(d/i,(v+1)/r);this.faces.push(new o.Face3(S,w,A)),this.faceVertexUvs[0].push([P,C,D]),this.faces.push(new o.Face3(w,M,A)),this.faceVertexUvs[0].push([C.clone(),R,D.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},o.TorusKnotGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusKnotGeometry.prototype.constructor=o.TorusKnotGeometry,o.TorusKnotGeometry.prototype.clone=function(){var e=this.parameters;return new o.TorusKnotGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.p,e.q,e.heightScale)},o.TubeGeometry=function(e,t,i,r,n,s){o.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:i,radialSegments:r,closed:n,taper:s},t=t||64,i=i||1,r=r||8,n=n||!1,s=s||o.TubeGeometry.NoTaper;var a,l,h,c,u,f,d,p,m,g,v,y,_,b,x,T,E,S,w,M,A=[],P=this,C=t+1,R=new o.Vector3,D=new o.TubeGeometry.FrenetFrames(e,t,n),I=D.tangents,O=D.normals,F=D.binormals;for(this.tangents=I,this.normals=O,this.binormals=F,m=0;m<C;m++)for(A[m]=[],h=m/(C-1),p=e.getPointAt(h),I[m],a=O[m],l=F[m],u=i*s(h),g=0;g<r;g++)c=g/r*2*Math.PI,f=-u*Math.cos(c),d=u*Math.sin(c),R.copy(p),R.x+=f*a.x+d*l.x,R.y+=f*a.y+d*l.y,R.z+=f*a.z+d*l.z,A[m][g]=function(e,t,i){return P.vertices.push(new o.Vector3(e,t,i))-1}(R.x,R.y,R.z);for(m=0;m<t;m++)for(g=0;g<r;g++)v=n?(m+1)%t:m+1,y=(g+1)%r,_=A[m][g],b=A[v][g],x=A[v][y],T=A[m][y],E=new o.Vector2(m/t,g/r),S=new o.Vector2((m+1)/t,g/r),w=new o.Vector2((m+1)/t,(g+1)/r),M=new o.Vector2(m/t,(g+1)/r),this.faces.push(new o.Face3(_,b,T)),this.faceVertexUvs[0].push([E,S,M]),this.faces.push(new o.Face3(b,x,T)),this.faceVertexUvs[0].push([S.clone(),w,M.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},o.TubeGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry.prototype.constructor=o.TubeGeometry,o.TubeGeometry.prototype.clone=function(){return new this.constructor(this.parameters.path,this.parameters.segments,this.parameters.radius,this.parameters.radialSegments,this.parameters.closed,this.parameters.taper)},o.TubeGeometry.NoTaper=function(e){return 1},o.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},o.TubeGeometry.FrenetFrames=function(e,t,i){var r,n,s,a,l,h,c,u=new o.Vector3,f=[],d=[],p=[],m=new o.Vector3,g=new o.Matrix4,v=t+1;for(this.tangents=f,this.normals=d,this.binormals=p,h=0;h<v;h++)c=h/(v-1),f[h]=e.getTangentAt(c),f[h].normalize();for(function(){d[0]=new o.Vector3,p[0]=new o.Vector3,n=Number.MAX_VALUE,s=Math.abs(f[0].x),a=Math.abs(f[0].y),l=Math.abs(f[0].z),s<=n&&(n=s,u.set(1,0,0)),a<=n&&(n=a,u.set(0,1,0)),l<=n&&u.set(0,0,1),m.crossVectors(f[0],u).normalize(),d[0].crossVectors(f[0],m),p[0].crossVectors(f[0],d[0])}(),h=1;h<v;h++)d[h]=d[h-1].clone(),p[h]=p[h-1].clone(),m.crossVectors(f[h-1],f[h]),m.length()>Number.EPSILON&&(m.normalize(),r=Math.acos(o.Math.clamp(f[h-1].dot(f[h]),-1,1)),d[h].applyMatrix4(g.makeRotationAxis(m,r))),p[h].crossVectors(f[h],d[h]);if(i)for(r=Math.acos(o.Math.clamp(d[0].dot(d[v-1]),-1,1)),r/=v-1,f[0].dot(m.crossVectors(d[0],d[v-1]))>0&&(r=-r),h=1;h<v;h++)d[h].applyMatrix4(g.makeRotationAxis(f[h],r*h)),p[h].crossVectors(f[h],d[h])},o.PolyhedronGeometry=function(e,t,i,r){function n(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var i=a(e)/2/Math.PI+.5,r=l(e)/Math.PI+.5;return t.uv=new o.Vector2(i,1-r),t}function s(e,t,i,r){var n=new o.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()],void 0,r);c.faces.push(n),_.copy(e).add(t).add(i).divideScalar(3);var s=a(_);c.faceVertexUvs[0].push([h(e.uv,e,s),h(t.uv,t,s),h(i.uv,i,s)])}function a(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function h(e,t,i){return i<0&&1===e.x&&(e=new o.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new o.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}o.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1,r=r||0;for(var c=this,u=0,f=e.length;u<f;u+=3)n(new o.Vector3(e[u],e[u+1],e[u+2]));for(var d=this.vertices,p=[],u=0,m=0,f=t.length;u<f;u+=3,m++){var g=d[t[u]],v=d[t[u+1]],y=d[t[u+2]];p[m]=new o.Face3(g.index,v.index,y.index,[g.clone(),v.clone(),y.clone()],void 0,m)}for(var _=new o.Vector3,u=0,f=p.length;u<f;u++)!function(e,t){for(var i=Math.pow(2,t),r=n(c.vertices[e.a]),o=n(c.vertices[e.b]),a=n(c.vertices[e.c]),l=[],h=e.materialIndex,u=0;u<=i;u++){l[u]=[];for(var f=n(r.clone().lerp(a,u/i)),d=n(o.clone().lerp(a,u/i)),p=i-u,m=0;m<=p;m++)l[u][m]=0===m&&u===i?f:n(f.clone().lerp(d,m/p))}for(var u=0;u<i;u++)for(var m=0;m<2*(i-u)-1;m++){var g=Math.floor(m/2);m%2==0?s(l[u][g+1],l[u+1][g],l[u][g],h):s(l[u][g+1],l[u+1][g+1],l[u+1][g],h)}}(p[u],r);for(var u=0,f=this.faceVertexUvs[0].length;u<f;u++){var b=this.faceVertexUvs[0][u],x=b[0].x,T=b[1].x,E=b[2].x,S=Math.max(x,T,E),w=Math.min(x,T,E);S>.9&&w<.1&&(x<.2&&(b[0].x+=1),T<.2&&(b[1].x+=1),E<.2&&(b[2].x+=1))}for(var u=0,f=this.vertices.length;u<f;u++)this.vertices[u].multiplyScalar(i);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,i)},o.PolyhedronGeometry.prototype=Object.create(o.Geometry.prototype),o.PolyhedronGeometry.prototype.constructor=o.PolyhedronGeometry,o.PolyhedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.PolyhedronGeometry(e.vertices,e.indices,e.radius,e.detail)},o.DodecahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];o.PolyhedronGeometry.call(this,n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},o.DodecahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.DodecahedronGeometry.prototype.constructor=o.DodecahedronGeometry,o.DodecahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.DodecahedronGeometry(e.radius,e.detail)},o.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];o.PolyhedronGeometry.call(this,r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},o.IcosahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.IcosahedronGeometry.prototype.constructor=o.IcosahedronGeometry,o.IcosahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.IcosahedronGeometry(e.radius,e.detail)},o.OctahedronGeometry=function(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];o.PolyhedronGeometry.call(this,i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},o.OctahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.OctahedronGeometry.prototype.constructor=o.OctahedronGeometry,o.OctahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.OctahedronGeometry(e.radius,e.detail)},o.TetrahedronGeometry=function(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];o.PolyhedronGeometry.call(this,i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},o.TetrahedronGeometry.prototype=Object.create(o.PolyhedronGeometry.prototype),o.TetrahedronGeometry.prototype.constructor=o.TetrahedronGeometry,o.TetrahedronGeometry.prototype.clone=function(){var e=this.parameters;return new o.TetrahedronGeometry(e.radius,e.detail)},o.ParametricGeometry=function(e,t,i){o.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,s,a,l,h=this.vertices,c=this.faces,u=this.faceVertexUvs[0],f=t+1;for(r=0;r<=i;r++)for(l=r/i,n=0;n<=t;n++)a=n/t,s=e(a,l),h.push(s);var d,p,m,g,v,y,_,b;for(r=0;r<i;r++)for(n=0;n<t;n++)d=r*f+n,p=r*f+n+1,m=(r+1)*f+n+1,g=(r+1)*f+n,v=new o.Vector2(n/t,r/i),y=new o.Vector2((n+1)/t,r/i),_=new o.Vector2((n+1)/t,(r+1)/i),b=new o.Vector2(n/t,(r+1)/i),c.push(new o.Face3(d,p,g)),u.push([v,y,b]),c.push(new o.Face3(p,m,g)),u.push([y.clone(),_,b.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},o.ParametricGeometry.prototype=Object.create(o.Geometry.prototype),o.ParametricGeometry.prototype.constructor=o.ParametricGeometry,o.WireframeGeometry=function(e){function t(e,t){return e-t}o.BufferGeometry.call(this);var i=[0,0],r={},n=["a","b","c"];if(e instanceof o.Geometry){for(var s=e.vertices,a=e.faces,l=0,h=new Uint32Array(6*a.length),c=0,u=a.length;c<u;c++)for(var f=a[c],d=0;d<3;d++){i[0]=f[n[d]],i[1]=f[n[(d+1)%3]],i.sort(t);var p=i.toString();void 0===r[p]&&(h[2*l]=i[0],h[2*l+1]=i[1],r[p]=!0,l++)}for(var m=new Float32Array(2*l*3),c=0,u=l;c<u;c++)for(var d=0;d<2;d++){var g=s[h[2*c+d]],v=6*c+3*d;m[v+0]=g.x,m[v+1]=g.y,m[v+2]=g.z}this.addAttribute("position",new o.BufferAttribute(m,3))}else if(e instanceof o.BufferGeometry)if(null!==e.index){var y=e.index.array,s=e.attributes.position,_=e.drawcalls,l=0;0===_.length&&e.addGroup(0,y.length);for(var h=new Uint32Array(2*y.length),b=0,x=_.length;b<x;++b)for(var T=_[b],E=T.start,S=T.count,c=E,w=E+S;c<w;c+=3)for(var d=0;d<3;d++){i[0]=y[c+d],i[1]=y[c+(d+1)%3],i.sort(t);var p=i.toString();void 0===r[p]&&(h[2*l]=i[0],h[2*l+1]=i[1],r[p]=!0,l++)}for(var m=new Float32Array(2*l*3),c=0,u=l;c<u;c++)for(var d=0;d<2;d++){var v=6*c+3*d,M=h[2*c+d];m[v+0]=s.getX(M),m[v+1]=s.getY(M),m[v+2]=s.getZ(M)}this.addAttribute("position",new o.BufferAttribute(m,3))}else{for(var s=e.attributes.position.array,l=s.length/3,A=l/3,m=new Float32Array(2*l*3),c=0,u=A;c<u;c++)for(var d=0;d<3;d++){var v=18*c+6*d,P=9*c+3*d;m[v+0]=s[P],m[v+1]=s[P+1],m[v+2]=s[P+2];var M=9*c+(d+1)%3*3;m[v+3]=s[M],m[v+4]=s[M+1],m[v+5]=s[M+2]}this.addAttribute("position",new o.BufferAttribute(m,3))}},o.WireframeGeometry.prototype=Object.create(o.BufferGeometry.prototype),o.WireframeGeometry.prototype.constructor=o.WireframeGeometry,o.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),i=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new o.BufferGeometry;r.addAttribute("position",new o.BufferAttribute(t,3)),r.addAttribute("color",new o.BufferAttribute(i,3));var n=new o.LineBasicMaterial({vertexColors:o.VertexColors});o.LineSegments.call(this,r,n)},o.AxisHelper.prototype=Object.create(o.LineSegments.prototype),o.AxisHelper.prototype.constructor=o.AxisHelper,o.ArrowHelper=function(){var e=new o.Geometry;e.vertices.push(new o.Vector3(0,0,0),new o.Vector3(0,1,0));var t=new o.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-.5,0),function(i,r,n,s,a,l){o.Object3D.call(this),void 0===s&&(s=16776960),void 0===n&&(n=1),void 0===a&&(a=.2*n),void 0===l&&(l=.2*a),this.position.copy(r),a<n&&(this.line=new o.Line(e,new o.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new o.Mesh(t,new o.MeshBasicMaterial({color:s})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(n,a,l)}}(),o.ArrowHelper.prototype=Object.create(o.Object3D.prototype),o.ArrowHelper.prototype.constructor=o.ArrowHelper,o.ArrowHelper.prototype.setDirection=function(){var e,t=new o.Vector3;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),o.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),t<e&&(this.line.scale.set(1,e-t,1),this.line.updateMatrix()),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},o.ArrowHelper.prototype.setColor=function(e){void 0!==this.line&&this.line.material.color.set(e),this.cone.material.color.set(e)},o.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new o.BufferGeometry;r.setIndex(new o.BufferAttribute(t,1)),r.addAttribute("position",new o.BufferAttribute(i,3)),o.LineSegments.call(this,r,new o.LineBasicMaterial({color:16776960})),void 0!==e&&this.update(e)},o.BoxHelper.prototype=Object.create(o.LineSegments.prototype),o.BoxHelper.prototype.constructor=o.BoxHelper,o.BoxHelper.prototype.update=function(){var e=new o.Box3;return function(t){if(e.setFromObject(t),!e.empty()){var i=e.min,r=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),o.BoundingBoxHelper=function(e,t){var i=void 0!==t?t:8947848;this.object=e,this.box=new o.Box3,o.Mesh.call(this,new o.BoxGeometry(1,1,1),new o.MeshBasicMaterial({color:i,wireframe:!0}))},o.BoundingBoxHelper.prototype=Object.create(o.Mesh.prototype),o.BoundingBoxHelper.prototype.constructor=o.BoundingBoxHelper,o.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},o.CameraHelper=function(e){function t(e,t,r){i(e,r),i(t,r)}function i(e,t){r.vertices.push(new o.Vector3),r.colors.push(new o.Color(t)),void 0===s[e]&&(s[e]=[]),s[e].push(r.vertices.length-1)}var r=new o.Geometry,n=new o.LineBasicMaterial({color:16777215,vertexColors:o.FaceColors}),s={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),o.LineSegments.call(this,r,n),this.camera=e,this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},o.CameraHelper.prototype=Object.create(o.LineSegments.prototype);o.CameraHelper.prototype.constructor=o.CameraHelper,o.CameraHelper.prototype.update=function(){function e(e,o,s,a){r.set(o,s,a).unproject(n);var l=i[e];if(void 0!==l)for(var h=0,c=l.length;h<c;h++)t.vertices[l[h]].copy(r)}var t,i,r=new o.Vector3,n=new o.Camera;return function(){t=this.geometry,i=this.pointMap;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.verticesNeedUpdate=!0}}(),o.DirectionalLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var i=new o.Geometry;i.vertices.push(new o.Vector3(-t,t,0),new o.Vector3(t,t,0),new o.Vector3(t,-t,0),new o.Vector3(-t,-t,0),new o.Vector3(-t,t,0));var r=new o.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new o.Line(i,r),this.add(this.lightPlane),i=new o.Geometry,i.vertices.push(new o.Vector3,new o.Vector3),r=new o.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new o.Line(i,r),this.add(this.targetLine),this.update()},o.DirectionalLightHelper.prototype=Object.create(o.Object3D.prototype),o.DirectionalLightHelper.prototype.constructor=o.DirectionalLightHelper,o.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},o.DirectionalLightHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),o.EdgesHelper=function(e,t,i){var r=void 0!==t?t:16777215;o.LineSegments.call(this,new o.EdgesGeometry(e.geometry,i),new o.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},o.EdgesHelper.prototype=Object.create(o.LineSegments.prototype),o.EdgesHelper.prototype.constructor=o.EdgesHelper,o.FaceNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,s=void 0!==r?r:1,a=0,l=this.object.geometry;l instanceof o.Geometry?a=l.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var h=new o.BufferGeometry,c=new o.Float32Attribute(2*a*3,3);h.addAttribute("position",c),o.LineSegments.call(this,h,new o.LineBasicMaterial({color:n,linewidth:s})),this.matrixAutoUpdate=!1,this.update()},o.FaceNormalsHelper.prototype=Object.create(o.LineSegments.prototype),o.FaceNormalsHelper.prototype.constructor=o.FaceNormalsHelper,o.FaceNormalsHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Matrix3;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,h=0,c=a.length;h<c;h++){var u=a[h],f=u.normal;e.copy(s[u.a]).add(s[u.b]).add(s[u.c]).divideScalar(3).applyMatrix4(r),t.copy(f).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(l,e.x,e.y,e.z),l+=1,n.setXYZ(l,t.x,t.y,t.z),l+=1}return n.needsUpdate=!0,this}}(),o.GridHelper=function(e,t){var i=new o.Geometry,r=new o.LineBasicMaterial({vertexColors:o.VertexColors});this.color1=new o.Color(4473924),this.color2=new o.Color(8947848);for(var n=-e;n<=e;n+=t){i.vertices.push(new o.Vector3(-e,0,n),new o.Vector3(e,0,n),new o.Vector3(n,0,-e),new o.Vector3(n,0,e));var s=0===n?this.color1:this.color2;i.colors.push(s,s,s,s)}o.LineSegments.call(this,i,r)},o.GridHelper.prototype=Object.create(o.LineSegments.prototype),o.GridHelper.prototype.constructor=o.GridHelper,o.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},o.HemisphereLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new o.Color,new o.Color];var i=new o.SphereGeometry(t,4,2);i.rotateX(-Math.PI/2);for(var r=0;r<8;r++)i.faces[r].color=this.colors[r<4?0:1];var n=new o.MeshBasicMaterial({vertexColors:o.FaceColors,wireframe:!0});this.lightSphere=new o.Mesh(i,n),this.add(this.lightSphere),this.update()},o.HemisphereLightHelper.prototype=Object.create(o.Object3D.prototype),o.HemisphereLightHelper.prototype.constructor=o.HemisphereLightHelper,o.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},o.HemisphereLightHelper.prototype.update=function(){var e=new o.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),o.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new o.SphereGeometry(t,4,2),r=new o.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),o.Mesh.call(this,i,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},o.PointLightHelper.prototype=Object.create(o.Mesh.prototype),o.PointLightHelper.prototype.constructor=o.PointLightHelper,o.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},o.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},o.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var t=new o.Geometry,i=0;i<this.bones.length;i++){this.bones[i].parent instanceof o.Bone&&(t.vertices.push(new o.Vector3),t.vertices.push(new o.Vector3),t.colors.push(new o.Color(0,0,1)),t.colors.push(new o.Color(0,1,0)))}t.dynamic=!0;var r=new o.LineBasicMaterial({vertexColors:o.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});o.LineSegments.call(this,t,r),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},o.SkeletonHelper.prototype=Object.create(o.LineSegments.prototype),o.SkeletonHelper.prototype.constructor=o.SkeletonHelper,o.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof o.Bone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,this.getBoneList(e.children[i]));return t},o.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=(new o.Matrix4).getInverse(this.root.matrixWorld),i=new o.Matrix4,r=0,n=0;n<this.bones.length;n++){var s=this.bones[n];s.parent instanceof o.Bone&&(i.multiplyMatrices(t,s.matrixWorld),e.vertices[r].setFromMatrixPosition(i),i.multiplyMatrices(t,s.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(i),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},o.SpotLightHelper=function(e){o.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new o.CylinderGeometry(0,1,1,8,1,!0);t.translate(0,-.5,0),t.rotateX(-Math.PI/2);var i=new o.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new o.Mesh(t,i),this.add(this.cone),this.update()},o.SpotLightHelper.prototype=Object.create(o.Object3D.prototype),o.SpotLightHelper.prototype.constructor=o.SpotLightHelper,o.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},o.SpotLightHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),o.VertexNormalsHelper=function(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,s=void 0!==r?r:1,a=0,l=this.object.geometry;l instanceof o.Geometry?a=3*l.faces.length:l instanceof o.BufferGeometry&&(a=l.attributes.normal.count);var h=new o.BufferGeometry,c=new o.Float32Attribute(2*a*3,3);h.addAttribute("position",c),o.LineSegments.call(this,h,new o.LineBasicMaterial({color:n,linewidth:s})),this.matrixAutoUpdate=!1,this.update()},o.VertexNormalsHelper.prototype=Object.create(o.LineSegments.prototype),o.VertexNormalsHelper.prototype.constructor=o.VertexNormalsHelper,o.VertexNormalsHelper.prototype.update=function(){var e=new o.Vector3,t=new o.Vector3,i=new o.Matrix3;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,s=this.geometry.attributes.position,a=this.object.geometry;if(a instanceof o.Geometry)for(var l=a.vertices,h=a.faces,c=0,u=0,f=h.length;u<f;u++)for(var d=h[u],p=0,m=d.vertexNormals.length;p<m;p++){var g=l[d[r[p]]],v=d.vertexNormals[p];e.copy(g).applyMatrix4(n),t.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),s.setXYZ(c,e.x,e.y,e.z),c+=1,s.setXYZ(c,t.x,t.y,t.z),c+=1}else if(a instanceof o.BufferGeometry)for(var y=a.attributes.position,_=a.attributes.normal,c=0,p=0,m=y.count;p<m;p++)e.set(y.getX(p),y.getY(p),y.getZ(p)).applyMatrix4(n),t.set(_.getX(p),_.getY(p),_.getZ(p)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),s.setXYZ(c,e.x,e.y,e.z),c+=1,s.setXYZ(c,t.x,t.y,t.z),c+=1;return s.needsUpdate=!0,this}}(),o.WireframeHelper=function(e,t){var i=void 0!==t?t:16777215;o.LineSegments.call(this,new o.WireframeGeometry(e.geometry),new o.LineBasicMaterial({color:i})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},o.WireframeHelper.prototype=Object.create(o.LineSegments.prototype),o.WireframeHelper.prototype.constructor=o.WireframeHelper,o.ImmediateRenderObject=function(e){o.Object3D.call(this),this.material=e,this.render=function(e){}},o.ImmediateRenderObject.prototype=Object.create(o.Object3D.prototype),o.ImmediateRenderObject.prototype.constructor=o.ImmediateRenderObject,o.MorphBlendMesh=function(e,t){o.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r=i-1,n=i/1;this.createAnimation("__default",0,r,n),this.setAnimationWeight("__default",1)},o.MorphBlendMesh.prototype=Object.create(o.Mesh.prototype),o.MorphBlendMesh.prototype.constructor=o.MorphBlendMesh,o.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var n={start:t,end:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},o.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)_?(\d+)/,r={},n=this.geometry,o=0,s=n.morphTargets.length;o<s;o++){var a=n.morphTargets[o],l=a.name.match(i);if(l&&l.length>1){var h=l[1];r[h]||(r[h]={start:1/0,end:-1/0});var c=r[h];o<c.start&&(c.start=o),o>c.end&&(c.end=o),t||(t=h)}}for(var h in r){var c=r[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=t},o.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},o.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},o.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},o.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},o.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},o.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},o.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},o.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},o.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},o.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},o.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var n=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var s=r.start+o.Math.clamp(Math.floor(r.time/n),0,r.length-1),a=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*a,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s);var l=r.time%n/n;r.directionBackwards&&(l=1-l),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=l*a,this.morphTargetInfluences[r.lastFrame]=(1-l)*a):this.morphTargetInfluences[r.currentFrame]=a}}}},function(e,t,i){"use strict";nb.burette=i(203),nb.capacity=i(204),nb.commonFunc=i(194),nb.dumpSolid=i(209),nb.filter=i(210),nb.simpleBurette=i(211),nb.simpleButton=i(212),nb.simpleDrag=i(213),nb.simpleThermometer=i(214),nb.spirit=i(215),nb.testtube=i(216),nb.timelineProcessing=i(217),nb.microscopeWithThree=i(219),nb.eyepiece=i(243)},function(e,t,i){"use strict";nb.buretteEvent={BURETTE_POP:"burettePop",BURETTE_TAP:"buretteTap"},nb.buretteInfo={EMPTY:"请先在滴管中吸入液体"};var r=[];nb.capacityContainer=function(){Object.defineProperty(this,"capacity",{get:function(){return this._capacity||0},set:function(e){e<=this.max_capacity&&e>=0&&(e<this.totalFrames&&this.gotoAndStop(e),this._capacity=e)}}),void 0==this.max_capacity&&(this.max_capacity=15),this.isFull=function(){return this.capacity==this.max_capacity},this.isEmpty=function(){return 0==this.capacity}},nb.burette=function(){function e(){s.emit(nb.buretteEvent.BURETTE_TAP);var e=l.burette.getCurrentCapacity(),i=.75*l.burette.getTotalCapacity(),r=0,o=l.isCorver()?.8:1.5;return TweenMax.to(s,o,{onComplete:function(){t()},onUpdate:function(){if(l.isCorver()){var o=e+(i-e)*this.progress(),a=o-l.burette.getCurrentCapacity();l.bottle.setCurrentCapacity(l.bottle.getCurrentCapacity()-.2*a),l.burette.setCurrentCapacity(o),c.length>0&&l.setEnabled(!1)}else{var h=null;if(c.length>0&&(h=c[0]),l.burette.getCurrentCapacity()>0){if(++r>5)return void(r=0);var u=l.burette.getCurrentCapacity(),f=e*(1-this.progress()),d=u-f;if(h&&(h.capacity-=d,h.capacity<=0)){TweenMax.killTweensOf(s);var p=c.shift();return l.emit("itemComplete",p),void setTimeout(t,500)}l.burette.setCurrentCapacity(f);var m=new PIXI.Graphics;n.push(m),m.beginFill(s.dropColor,s.dropAlpha),m.drawEllipse(0,0,6,12),l.stepRoot.addChild(m);var g=l.burette.getLocalBounds(),v=l.stepRoot.toLocal({x:g.x+g.width/2,y:g.y+g.height},l.burette);m.x=v.x,m.y=v.y,m.destory=function(){this.parent&&(TweenMax.killTweensOf(this),this.parent.removeChild(this),n.splice(this,1))},TweenMax.to(m,1.5,{y:m.y+800,alpha:0,onComplete:function(e){e.destory()},onCompleteParams:[m],onUpdate:function(){if(h){var e=h.container,t=e.liquidVertex;if(!t)return;var i=t[0],r=t[t.length-1];NBPoint.interpolate(i,r,.5),this.target.toGlobal({x:0,y:0}).y>r.y&&(this.target.destory(),e.addCapacity(d))}}}),l.emit(nb.buretteEvent.BURETTE_POP,{target:l.burette,drop:m})}}}})}function t(){var t=l.burette,i=new TimelineMax;if(c.length>0){var r=c[0];if(t.getCurrentCapacity()/t.getTotalCapacity()<.05)return void l.buretteReset().then(function(){e()});l.burette.parent===l?(l.parent.addChildWithSamePos(t),l.parent.addChildAt(t,0),i.add(TweenMax.to(l.burette,.5,{y:l.burette.y-300}))):l.parent.addChildWithSamePos(t);var n=c[0],o=n.container,s=l.burette.getBounds(),a=o.getBounds(),h=l.burette.getLocalBounds();l.burette.updateTransform(),o.updateTransform();var u={x:a.x+a.width/2,y:a.y},f={x:u.x,y:u.y-s.height};f=l.parent.toLocal(f),f.x-=h.x+h.width/2,f.y-=h.y+20,i.add(TweenMax.to(t,1,{x:f.x+(n.offsetX||0),y:f.y+(n.offsetY||0),onComplete:function(){e()}})),r.capacity>0&&TweenMax.to(l.burette,.8,{})}else{var d=l.buretteReset();d&&d.then(function(){l.emit("complete"),l.setEnabled(!0)})}}var i=this,n=[];this.burette.allowWave(!1);var o=!0,s=this;this.dropColor=16777215,this.dropAlpha=.3,this.bottle.setTotalCapacity(100),this.burette.setTotalCapacity(6),this.isCorver=function(){return this.burette.movie.hitTest(this.head)};var a={x:this.burette.x,y:this.burette.y},l=this;nb.capacityContainer.apply(this.burette.movie),this.burette.movie.isFull=this.bottle.isFull=function(){return this.capacity==this.max_capacity},this.burette.movie.isEmpty=this.bottle.isEmpty=function(){return 0==this.capacity},this.setEnabled=function(e){o=e,!1===e&&TweenMax.killTweensOf(this.burette)},this.addDripObj=function(e){-1===r.indexOf(e)&&r.push(e)},this.removeDripObj=function(e){var t=r.indexOf(e);-1!==t&&r.splice(t,1)},this.getEnabled=function(){return o},this.bottle.capacity=100;var h=this.parent;this.burette.on(NBDrag.event.START_DRAG,function(e){e.data.isPropagationStopped=!0,TweenMax.killTweensOf(this);var t=this.parent;h.addChildWithSamePos(this),t.parent.addChild(t)}),this.burette.on(NBDrag.event.STOP_DRAG,function(e){l.isCorver()&&(this.x=a.x,this.y=a.y,s.addChildAt(this,0))}),NBGesture.addGesture(this.burette,NBGesture.gesture.TAP,function(){!1!==o&&e()}),this.burette.on(TouchEvent.TOUCH_BEGIN,function(){i.burette.movie.gotoAndStop(1)}),this.burette.on(TouchEvent.TOUCH_END,function(){i.burette.movie.gotoAndStop(0)}),this.burette.on(TouchEvent.TOUCH_END_OUDSIDE,function(){i.burette.movie.gotoAndStop(0)}),this.tapCallBack=e,this.getDropAry=function(){return n},this.setCapacity=function(e){this.bottle.setCurrentCapacity(e),this.burette.setCurrentCapacity(0)},this.setTotalCapacity=function(e){this.bottle.setTotalCapacity(e)},this.setColor=function(e,t){this.bottle.setColor(e,t),this.burette.setColor(e,t)},this.setText=function(e,t,i,r){this.text.text=e,t&&(t+=" 'Microsoft YaHei'");var n={font:t||"40px 'Microsoft YaHei'",fill:i||0,align:r||"center"};this.text.style=n},this.setCapacity("75%");var c=[];this.bindContainer=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.bindContainer(e[t]);else e instanceof PIXI.DisplayObject?(e={container:e,capacity:4},c.push(e)):(e.capacity=e.capacity||4,c.push(e))},this.buretteReset=function(){if(l.burette.parent!==l){var e=l.parent.toLocal(a,l),t={x:e.x,y:e.y-300};return l.parent.addChild(l),new Promise(function(i,r){var n=new TimelineMax;n.add(GlobalEffect.bezierTo(l.burette,1,{x:t.x,y:t.y,ease:Sine.easeOut})),n.add(TweenMax.to(l.burette,1,{x:e.x,y:e.y,ease:Sine.easeIn,onComplete:function(){l.burette.emit(NBDrag.event.STOP_DRAG),i()}}))})}}},e.exports=nb.burette},function(e,t,i){"use strict";var r=i(76),n=i(205),o=i(175),s=i(82),a=i(208),l=i(77),h=.15,c=8/180*Math.PI,u=.1,f=80;e.exports=function(){function e(){if(this.parent&&!1!==this.visible&&0!==this.capacityVertex.length){var e=s.retrieveScale(this.worldTransform);if(A!=e){var t=Math.pow(A/e,2);this._currentCapacity/=t,A=e}m>c?m=c:m<-c&&(m=-c),m*=.99*S,y&&(g.identity(),g.rotate(m*Math.sin(v))),v+=u;var i=void 0,a=this.getGlobalVertexes(),l=n.getAABB(a),h=n.iterator,p=n.getDivideSpace,b=h(a,l,this.getCurrentCapacity()/this.capacityScale),T=Math.max(a[0].y,a[a.length-1].y);if(b){var E=this.liquidShape;if(!E){E=new PIXI.Graphics,this.liquidGra=[],this.liquidGra.push(E),this.liquidShape=E,this.addChild(this.liquidGraContainer),this.liquidGraContainer.addChild(E);var w=new PIXI.Graphics;this.addChild(w),w.beginFill(16711680,1),o.drawPolygon(w,x),this.liquidGraContainer.mask=w}E.clear();var M=b[0],P=b[b.length-1],C=p(a,M,P);if(C){this.liquidVertex=i=C.down,this.liquidVertexUp=C.up;for(var R=[],D=0;D<i.length;D++){var I=this.toLocal(i[D]);y&&g.applyInverse(I,I),R.push(I)}var O=R[0],F=R.length-1,L=R[F],B=this.waveAry;if(B&&(Math.abs(m)>.02||!0===_)){var N=NBPoint.distance(O,L),k=0;N>f&&(k=Math.min((NBPoint.distance(O,L)-f)/f,2,1));for(var V=1;V<B.length;V++){var U=B[V],z=NBPoint.interpolate(O,L,B[V-1].radio),G=NBPoint.interpolate(O,L,B[V].radio),H=NBPoint.interpolate(z,G,.5);U.angleX+=U.deltaOffset,U.angleY-=U.deltaOffset;var j=Math.abs(m/c)*k;_&&(j=1),H.x+=U.offsetX*Math.sin(U.angleX)*j,H.y+=U.offsetY*Math.sin(U.angleY)*j,R.push(H,G)}}E.beginFill(this._color,this._alpha);for(var W=0;W<R.length;W++){var X=R[W];if(W<=F)0==W?E.moveTo(X.x,X.y):E.lineTo(X.x,X.y);else{var Y=R[W-1],K=R[W],q=R[W+1];E.bezierCurveTo(Y.x,Y.y,K.x,K.y,q.x,q.y),W++}}E.endFill()}if(T-M.y>.01&&!this._hermetic){var Q=Math.min(T-M.y,1.5*this.liquidSpeed);if(b=n.lineIntersect(a,new r(0,M.y+Q),new r(1,M.y+Q)),b.length<=1)return;var Z=p(a,b[0],b[b.length-1]);if(!Z)return;i=Z.down;var J=this.getCurrentCapacity(),$=this.__bindContainer__,ee=J-n.getArea(i)*this.capacityScale;if($){var te=d([$,{getCurrentCapacity:function(){return ee},getRybColor:this.getRybColor.bind(this),getColor:this.getColor.bind(this)}]);$.setCurrentCapacity($.getCurrentCapacity()+ee),te&&$.setColor(te.color,te.alpha)}this.setCurrentCapacity(this.getCurrentCapacity()-ee)}}}}function t(e){var t={};return t.r=e>>16,t.g=e>>8&255,t.b=255&e,t}function i(e){return(e.r<<16)+(e.g<<8)+e.b}function d(e){var t=e[0],i=e[1],r=i.getColor();if(16777215===r.color&&.2===r.alpha){var n=t.getCurrentCapacity(),o=i.getCurrentCapacity(),s=t.getColor();s.alpha<h&&(s.alpha=h);var a=n/(n+o)*(s.alpha-h)+h;return{color:s.color,alpha:a}}return null}var p={},m=0,g=new PIXI.Matrix,v=0,y=!0,_=!1,b=this._nbData_;this.visible=!1;var x=b.capacityVertex,T=this.parent,E=n.getAABB(x).width,S=function(){return Math.min(Math.pow(E/f,2),1)}();if(void 0===T.capacityScale){if(x){T.capacityVertex=[];for(var w=0;w<x.length;w++){var M=x[w];T.capacityVertex.push(new r(M.x,M.y))}}var A=void 0;T.initProperty=function(){var e=this;this.liquidSpeed=1,this.capacityScale=1,this._color=16777215,this._alpha=.2,this._currentCapacity=0,this._hermetic=!1,this.liquidGraContainer=new PIXI.Container,A=s.retrieveScale(this.worldTransform),this.on(l.gesture.PAN,function(e){m-=e.accX/100}),E>100&&this.createWave(),T.frameRoot.on("update",function(){e.$render()})},T.createWave=function(e){e=e||{},e.randY=e.randY||[10,20],e.speed=e.speed||1;var t=e.count||2,i=[],r=s.random(.85*u,1.15*u);r*=e.speed;for(var n=0;n<=t;n++){var o=n%2?1:-1;i.push({radio:n/t,deltaOffset:r*o,offsetX:s.random(-10,10),offsetY:s.random(e.randY),angleX:0,angleY:0})}this.waveAry=i},T.addIntoMask=function(e){this.liquidGraContainer.addChildWithSamePos(e)},T.setCurrentCapacity=function(e){"string"==typeof e&&(e=parseFloat(e.replace("%",""))/100,e*=this.getTotalCapacity());var t=Math.min(e,this.getTotalCapacity()),i=t-this._currentCapacity;i>0&&0!==this._currentCapacity&&(m+=i/this.getTotalCapacity()),this._currentCapacity=t},T.addCapacity=function(e){this.setCurrentCapacity(this.getCurrentCapacity()+e)},T.getCurrentCapacity=function(){return this._currentCapacity},T.getTotalCapacity=function(){return this.totalCapacity=n.getArea(this.capacityVertex),this.totalCapacity*this.capacityScale*this.getWorldScalePower()},T.getWorldScalePower=function(){var e=s.retrieveScale(this.worldTransform);return e*e},T.setTotalCapacity=function(e){var t=this.getTotalCapacity(),i=e/t;return this.capacityScale=i,this.capacityScale},T.$render=e,T.getGlobalVertexes=function(){for(var e=this.capacityVertex,t=[],i=0;i<e.length;i++){var n=new r(e[i].x,e[i].y);g.apply(n,n),this.worldTransform.apply(n,n),t.push(n)}return t},T.setHermetic=function(e){this._hermetic=e},T.setColor=function(e,r,n){var o=this;if(n){var s=t(this._color);console.log(s);var a=this._alpha||1,l=t(e);console.log(l);var h=r,c=n.timer,u=TweenMax.to(this,c,Object.assign({onUpdate:function(){var e=u.progress();console.log(e);var t={r:s.r+(l.r-s.r)*e,g:s.g+(l.g-s.g)*e,b:s.b+(l.b-s.b)*e};console.log(t),console.log(a+(h-a)*e),o.setColor(i(t),a+(h-a)*e)},onComplete:function(){o._color=e,o._alpha=r}},n));return u}this._color=e,this._alpha=r},T.getColor=function(){return{color:this._color,alpha:this._alpha}},T.setCapacityTween=function(e,t){var i=this;TweenMax.killTweensOf(p);var r=this.getCurrentCapacity();"string"==typeof e&&(e=parseFloat(e.replace("%",""))/100,e*=this.getTotalCapacity());var n,o=TweenMax.to(p,t,{onUpdate:function(){n=o.progress(),T.setCurrentCapacity(r+(e-r)*n),console.log(i.getCurrentCapacity())}});return o},T.bindContainer=function(e){T.__bindContainer__=e},T.getRybColor=function(){if(void 0===this._ryb_){var e=this.getColor().color;if(!e)return null;e=a.rgbToRyb([e>>16,e>>8&255,255&e]),this._ryb_=e}return this._ryb_.concat()},T.allowWave=function(e){y=e},T.setName=function(e){T.txt.text=e},T.showLiquid=function(e){var t=void 0,i=void 0;if(e?(t=e.alpha||1,i=e.alphaCapacity||0):(t=1,i=0),console.log(i),T.liquid)return TweenMax.to(T.liquid,1.5,{alpha:t,onStart:function(){T.setColor(T.getColor().color,i*T.getColor().alpha,{timer:1.5})}});throw"not a liquid to show"},T.hideLiquid=function(){return T.liquid?TweenMax.to(T.liquid,.5,{alpha:0,ease:Cubic.easeIn}):void 0},T.showName=function(){if(T.txt)return T.txt.visible=!0,TweenMax.to(T.txt,.5,{alpha:1})},T.hideName=function(){if(T.txt)return TweenMax.to(T.txt,.5,{alpha:0})},T.resetName=function(e){if(T.txt){var t=[];return t[0]=TweenMax.to(T.txt,.3,{alpha:0,onComplete:function(){T.setName(e),T.txt.visible=!0}}),t[1]=TweenMax.to(T.txt,.5,{alpha:1,delay:.3}),t}},T.getFluidLevelPos=function(){var e=this.liquidVertex[this.liquidVertex.length-1],t=this.liquidVertex[0];return{left:e,right:t,center:NBPoint.interpolate(e,t,.5)}},T.initProperty()}}},function(e,t,i){"use strict";var r={},n=i(206),o=(i(207),i(76));r.getArea=function(e,t){return r.getRealArea(e)/nb.PIXELS_PER_ML},r.getRealArea=function(e){for(var t=new o,i=e.length,r=0,n=0;n<i;n++){var s=e[n],a=e[(n+1)%i],l=s.sub(t),h=a.sub(t);r+=l.cross(h)}return r<0&&(r=-r),r/2||0},r.lineIntersect=function(e,t,i){for(var r=[],o=e.length,s=0;s<o;s++){var a=e[s],l=e[(s+1)%o];if(!n.isParallel(a,l,t,i)){var h=n.lineIntersect(t,i,a,l);n.containsPoint(h,a,l)&&(h.vertexA=s,h.vertexB=(s+1)%o,r.push(h))}}return r},r.containsPoint=function(e,t){for(var i=t.x,r=t.y,n=!1,o=0,s=e.length-1;o<e.length;s=o++){var a=e[o].x,l=e[o].y,h=e[s].x,c=e[s].y;l>r!=c>r&&i<(h-a)*(r-l)/(c-l)+a&&(n=!n)}return n},r.minkowskiDifference=function(e,t){var i,n,o=e.length,s=t.length,a=o*s,l=new Array(a),h=0;for(i=0;i<o;++i){var c=e[i];for(n=0;n<s;++n){var u=t[n];l[h++]=[c.x-u.x,c.y-u.y]}}return r.createConvexHull(l)},r.createConvexHull=function(e){var t,i,r=0,n=e[0][0];for(t=1;t<e.length;t++)((i=e[t][0])>n||i===n&&e[t][1]<e[r][1])&&(r=t,n=i);var o,s,a,l=e.length,h=[],c=0,u=r,f=[0,0],d=[0,0];do{for(h[c]=u,o=0,s=1;s<l;++s)if(o!==u){f[0]=e[o][0]-e[h[c]][0],f[1]=e[o][1]-e[h[c]][1],d[0]=e[s][0]-e[h[c]][0],d[1]=e[s][1]-e[h[c]][1],a=f[0]*d[1]-f[1]*d[0],a<0&&(o=s);var p=Math.sqrt(d[0]*d[0]+d[1]*d[1]),m=Math.sqrt(f[0]*f[0]+f[1]*f[1]);0===a&&p>m&&(o=s)}else o=s;++c,u=o}while(o!==r);var g=[];for(t=0;t<c;++t)g.push(e[h[t]]);return g},r.getMassCenter=function(e){for(var t,i,n,o=0,s=0,a=e.length-1,l=0;l<e.length;a=l++)i=e[l],n=e[a],t=n.cross(i),o+=(i.x+n.x)*t,s+=(i.y+n.y)*t;return t=6*r.getRealArea(e),{x:o/t,y:s/t}},r.getAABB=function(e){for(var t={x:e[0].x,y:e[0].y},i={x:t.x,y:t.y},r=1;r<e.length;r++){var n=e[r];t.x=Math.min(t.x,n.x),t.y=Math.min(t.y,n.y),i.x=Math.max(i.x,n.x),i.y=Math.max(i.y,n.y)}return{x:t.x,y:t.y,width:i.x-t.x,height:i.y-t.y}},r.drawPoly=function(e,t){t||(void 0===window.gra&&(window.gra=new PIXI.Graphics,chemicalMain.viewStack.addChild(window.gra)),t=window.gra),t.clear(),t.beginFill(16711680,.5);for(var i=0;i<e.length;i++)t.drawCircle(e[i].x,e[i].y,6)},r.getMinDistance=function(e,t,i){for(var r,n=e.length,o=1/0,s=0;s<n;s++){var a=e[s],l=e[(s+1)%n],h=l.sub(a);t.sub;var c=t.sub(a),u=c.projectTo(h),f=0;if(u.length()>h.length()||u.dot(h)<0){f=Math.min(t.sub(a).length(),t.sub(l).length());var d=t.sub(a).length(),p=t.sub(l).length();o>f&&(o=f,r=d>p?{x:l.x,y:l.y}:{x:a.x,y:a.y})}else{f=c.sub(u).length(),o>f&&(o=f,r={x:a.x+u.x,y:a.y+u.y})}}return i&&(i.minDis=o,i.projectPoint=r),o},r.getMinPerpendicularDistance=function(e,t){for(var i=e.length,r=1/0,n=0;n<i;n++){var o=e[n],s=e[(n+1)%i],a=s.sub(o);t.sub;var l=t.sub(o),h=l.projectTo(a);if(!(h.length()>a.length()||h.dot(a)<0)){var c=l.sub(h),u=c.length();r>u&&(r=u)}}return r},r.getDivideSpace=function(e,t,i,o){var s=void 0,a=void 0,l=void 0;if(o)s=t,a=i,l=o;else{if(!t||!i)return;l=r.lineIntersect(e,t,i),s=l[0],a=l[l.length-1]}if(void 0===s||void 0===a)return null;var h=s.y,c=[],u=[];c.push(s),u.push(s);for(var f=s.vertexB,d=1;;){var p=(f-1+e.length)%e.length,m=f%e.length;if(d<l.length&&n.containsPoint(l[d],e[p],e[m])&&(c.push(l[d]),u.push(l[d]),d++),e[m].y>=h&&c.push(e[m]),e[m].y<=h&&u.push(e[m]),++f%e.length===s.vertexB)break}return{result:l,up:u,down:c}},r.iterator=function(e,t,i,n){n=n||1;var s=new o(t.x,t.y+t.height/2),a=new o(t.x+t.width,t.y+t.height/2),l=r.getDivideSpace(e,s,a);if(null===l)return null;var h=r.getArea(l.down);return h/=n,Math.abs(h-i)>.1?i>h?r.iterator(l.up,{x:t.x,y:t.y,width:t.width,height:t.height/2},i-h,n):r.iterator(l.down,{x:t.x,y:t.y+t.height/2,width:t.width,height:t.height/2},i,n):l.result},e.exports=r},function(e,t,i){"use strict";var r={},n=i(76);r.lineIntersect=function(e,t,i,r){var o,s=new n,a=e.x,l=e.y,h=t.x,c=t.y,u=i.x,f=i.y,d=r.x,p=r.y,m=1e-7;o=h==a?(c-l)/(h-a+m):(c-l)/(h-a);var g;return g=d==u?(p-f)/(d-u+m):(p-f)/(d-u),s.x=o==g?(o*a-g*u+f-l)/(o-g+m):(o*a-g*u+f-l)/(o-g),s.y=o*s.x-o*a+l,s},r.isParallel=function(e,t,i,r){var n=t.x-e.x,o=t.y-e.y,s=r.x-i.x,a=r.y-i.y;return Math.abs(n*a-o*s)<.01},r.containsPoint=function(e,t,i){var n=t.x-e.x,o=t.y-e.y,s=i.x-e.x,a=i.y-e.y;return!!r.isParallel(t,e,i,e)&&n*s+o*a<=1e-10},e.exports=r},function(e,t,i){"use strict";var r={};r.sub=function(e,t){return e.x-=t.x,e.y-=t.y,e},e.exports=r},function(e,t,i){"use strict";function r(){var e=JSON.parse(JSON.stringify(y)),t=arguments[arguments.length-1];if("object"==(void 0===t?"undefined":g(t))&&t.constructor!=Array){var i=t;e.result=i.result||e.result,e.hex=void 0!==i.hex?i.hex:e.hex,arguments.length--}var r=[];r=arguments[0].constructor==Array&&"number"!=typeof arguments[0][0]?arguments[0]:arguments;for(var o=[],a=0,h=r.length;a<h;a++){var c=r[a];"string"==typeof c&&(c=s(c)),o.push(c)}var u=n(o);return"rgb"==e.result&&(u=p(u)),e.hex&&(u=l(u)),u}function n(e){for(var t=0,i=0,r=0,n=0,o=e.length;n<o;n++){var s=e[n];t+=s[0],i+=s[1],r+=s[2]}var a=Math.max(t,i,r),l=Math.min(a,255);return[Math.floor(t/a*l),Math.floor(i/a*l),Math.floor(r/a*l)]}function o(e,t){var i=t.concat([]);return i.sort(function(t,i){var r=s(t),n=s(i),o=s(e);return r=a(r),n=a(n),o=a(o),Math.sqrt(Math.pow(o[0]-r[0],2)+Math.pow(o[1]-r[1],2)+Math.pow(o[2]-r[2],2))-Math.sqrt(Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)+Math.pow(o[2]-n[2],2))}),i[0].replace("#","")}function s(e){var e=e.replace("#","");return[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)]}function a(e){var t,i,r,n,o,s=e[0]/255,a=e[1]/255,l=e[2]/255,h=Math.max(s,a,l),c=h-Math.min(s,a,l),u=function(e){return(h-e)/6/c+.5};return 0==c?n=o=0:(o=c/h,t=u(s),i=u(a),r=u(l),s===h?n=r-i:a===h?n=1/3+t-r:l===h&&(n=2/3+i-t),n<0?n+=1:n>1&&(n-=1)),[Math.round(360*n),Math.round(100*o),Math.round(100*h)]}function l(e){var t=Math.round(e[0]).toString(16);t=1==t.length?"0"+t:t;var i=Math.round(e[1]).toString(16);i=1==i.length?"0"+i:i;var r=Math.round(e[2]).toString(16);return r=1==r.length?"0"+r:r,t+i+r}function h(e,t,i){return t+e*e*(3-2*e)*(i-t)}function c(e,t,i){var r=h(i,1,.163),n=h(i,1,0),o=h(i,1,.5),s=h(i,1,.2),a=h(t,r,n),l=h(t,o,s);return Math.ceil(255*h(e,a,l))}function u(e,t,i){var r=h(i,1,.373),n=h(i,1,.66),o=h(i,0,0),s=h(i,.5,.094),a=h(t,r,n),l=h(t,o,s);return Math.ceil(255*h(e,a,l))}function f(e,t,i){var r=h(i,1,.6),n=h(i,0,.2),o=h(i,0,.5),s=h(i,0,0),a=h(t,r,n),l=h(t,o,s);return Math.ceil(255*h(e,a,l))}function d(e){var t,i,r;"string"==typeof e?(e=parseInt("0x"+e),e=[e],t=e>>16,i=e>>8&255,r=255&e):(t=e[0],i=e[1],r=e[2]);var n=Math.min(t,i,r);t-=n,i-=n,r-=n;var o=Math.max(t,i,r),s=Math.min(i,r);i-=s,r-=s,r&&s&&(r*=2,s*=2),t+=i,s+=i;var a=Math.max(t,s,r);if(a){var l=o/a;t*=l,s*=l,r*=l}return t+=n,s+=n,r+=n,[t,s,r]}function p(e,t){"string"==typeof e&&(e=s(e));var i=e[0]/255,r=e[1]/255,n=e[2]/255,o=c(i,r,n),a=u(i,r,n),h=f(i,r,n),d=[o,a,h];return t&&1==t.hex&&(d=l(d)),d}function m(e){var t=e[0],i=e[1],r=e[2],n=Math.min(t,i,r);t-=n,i-=n,r-=n;var o=Math.max(t,i,r),s=Math.min(t,i);t-=s,i-=s,r&&i&&(r/=2,i/=2),s+=i,r+=i;var a=Math.max(t,s,r);if(a){var l=o/a;t*=l,s*=l,r*=l}return t+=n,s+=n,r+=n,[t,s,r]}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v={},y={result:"ryb",hex:!0};v.mix=r,v.rybToRgb=d,v.rgbToRyb=m,v.findNearest=o,e.exports=v},function(e,t,i){"use strict";nb.dumpSolid=function(){},nb.dumpSolid.freeFall=function(e){return ParticleUtil.particles.add_solid_block.texture=e,ParticleUtil.getParticle(ParticleUtil.particles.add_solid_block)},nb.dumpSolid.freeFallSequence=function(e,t,i,r){var n=[],o=r||0;if(e instanceof Array){var s=e[0].y;e.forEach(function(e){s=Math.max(s,e.y)}),e.forEach(function(e){o=Math.random()*e.width/4-e.width/8,n.concat(nb.dumpSolid.freeFallSequence(e,t-e.y+s,i,o))})}else n=[TweenMax.to(e,1,{y:e.y+t-e.height-5,x:e.x+o,rotation:(o-5)*Math.PI/180,ease:Quad.easeIn,delay:o/i}),TweenMax.to(e,.3,{y:e.y+t-e.height+5,rotation:0,ease:Back.easeOut,delay:o/i+.9})];return n},e.exports=nb.dumpSolid},function(e,t,i){"use strict";nb.filterEvent={ON_START:"onStart",ON_STOP:"onStop"},nb.filter=function(){var e=this,t=this.rod.top;t.rotation=Math.PI,t.setTotalCapacity(3);var i=this.filt.buttom;i.rotation=Math.PI,i.setTotalCapacity(2);var r=this.maskFilter;r.y-=r.height;var n=void 0,o=void 0,s=0;t.bindContainer(i);var a=function(e){if(e.initProperty){n=e;var i=e.getColor();t.setColor(i.color,i.alpha/2)}},l=function(e){if(e.initProperty){o=e;var t=e.getColor();i.setColor(t.color,t.alpha/3)}};this.setFromToContainer=function(e,t){a(e),l(t),n&&o&&n.bindContainer(o)},this.on(nb.filterEvent.ON_START,function(){s=1,TweenMax.to(r,2,{y:r.y+r.height,ease:Quad.easeIn,onComplete:function(){e.parent.on("update",function(){1===s&&(t.setCurrentCapacity(100),i.setCurrentCapacity(100)),n.getCurrentCapacity()<=.01&&(s=0,r.y-=r.height)})}})}),this.getFromContainer=function(){return n},this.getToContainer=function(){return o}},e.exports=nb.filter},function(e,t,i){"use strict";var r=40,n=.3;nb.simpleBurette=function(){function e(){if(h)for(var e=h.getBounds(),t=0;t<a.length;t++){var i=a[t];i.background||(i.background=h.clone(),i.background.alpha=0);var r=i.suckContainer.getBounds();i.suckContainer.parent.addChild(i.background);var o=e.width-e.x>>1,s=r.x+r.width/2-o,l=r.y-e.height-50,c=i.suckContainer.parent.toLocal({x:s,y:l});i.background.visible=!0,i.background.x=c.x+i.offsetX,i.background.y=c.y+i.offsetY,TweenMax.to(i.background,.4,{alpha:n})}}function t(){for(var e=!1,t=0;t<a.length;t++){var i=a[t];i.background&&(this.hitTest(i.background)&&!e?(e=!0,TweenMax.to(i.background,.3,{alpha:.6})):TweenMax.to(i.background,.3,{alpha:n}))}}function i(){for(var e=0;e<a.length;e++)!function(e){var t=a[e];t.background&&TweenMax.to(t.background,.4,{alpha:0,onComplete:function(){t.background.visible=!1}})}(e);var t=void 0,i=void 0,n=void 0;if(a.forEach(function(e){if(!t){var r=e.suckContainer;(r.hitTest(s)||r.background&&r.background.hitTest(s))&&(t=r,i=e.dropContainer,n=e)}}),t){NBDrag.removeDrag(this),s.updateTransform();var l=t.getBounds(),h=s.getBounds(),c=l.x+l.width/2-h.width/2,u=l.y-h.height-r,f=new TimelineMax,d=s.parent.toLocal({x:c,y:u});f.add(GlobalEffect.bezierTo(s,1,{x:d.x,y:d.y}));var p=t.liquidVertex.concat().sort(function(e,t){return e.y<t.y}),m=p[0].y,g=p[p.length-1].y,v=(m+g)/2-h.height,y=c;d=s.parent.toLocal({x:y,y:v}),f.add(TweenMax.to(s,1.2,{onStart:function(){var e=t.parent.getChildIndex(t);s.parent.addChildAt(s,e)},x:d.x,y:d.y,onComplete:function(){var e=s.getCurrentCapacity(),r=n.liquidRatio||.8,a=s.getTotalCapacity()*r;TweenMax.to(s,1,{onUpdate:function(){var r=this.progress(),l=e+(a-e)*r,h=l-s.getCurrentCapacity(),c=t.getCurrentCapacity();t.getCurrentCapacity()<h&&(h=t.getCurrentCapacity(),TweenMax.killTweensOf(s),o(i,n)),t.setCurrentCapacity(c-h),s.addCapacity(h)},onComplete:function(){o(i,n)}})}}))}}function o(e,t){function i(){if(s.getCurrentCapacity()>0){if(++d>5)return void(d=0);var t=s.getCurrentCapacity(),i=f*(1-this.progress()),r=t-i;e.addCapacity(r),s.setCurrentCapacity(i);var n=new PIXI.Graphics;l.push(n),n.beginFill(s._color,s._alpha),n.drawEllipse(0,0,6,12),s.stepRoot.addChild(n);var o=s.getBounds(),a=s.stepRoot.toLocal({x:o.x+o.width/2,y:o.y+o.height});n.x=a.x,n.y=a.y,n.destory=function(){this.parent&&(TweenMax.killTweensOf(this),this.parent.removeChild(this),l.splice(this,1))},TweenMax.to(n,1.5,{y:n.y+800,alpha:0,onComplete:function(e){e.destory()},onCompleteParams:[n],onUpdate:function(){var t=e.liquidVertex;if(t){var i=t[t.length-1];this.target.toGlobal({x:0,y:0}).y>i.y&&(this.target.destory(),e.addCapacity(r))}}})}}if(e){var n=e.getBounds(),o=s.getBounds(),a=new TimelineMax,h=n.x+n.width/2-o.width/2,c=n.y-o.height-r,u=s.parent.toLocal({x:h,y:c});a.add(GlobalEffect.bezierTo(s,1,{x:u.x,y:u.y})),a.add(TweenMax.to(s,1,{onUpdate:i,onComplete:function(){NBDrag.addDrag(s),s.emit("complete",t)}}));var f=s.getCurrentCapacity(),d=0}}var s=this,a=[],l=[],h=void 0;this.background&&(h=this.background,h.visible=!1,h.alpha=0),NBDrag.addDrag(this),this.on(NBDrag.event.START_DRAG,e),this.on(NBDrag.event.DRAG_MOVE,t),this.on(NBDrag.event.STOP_DRAG,i),this.setTotalCapacity(10),this.clearContainer=function(){a.length=0},this.removeContainer=function(e){for(var t=0;t<a.length;t++){var i=a[t];if(e instanceof PIXI.DisplayObject){if(i.suckContainer===e){a.splice(t,1);break}}else if(i===e){a.splice(t,1);break}}},this.addContainer=function(e){if(e instanceof Array){var t=this;e.forEach(function(e){t.addContainer(e)})}else e.offsetX=e.offsetX||0,e.offsetY=e.offsetY||0,a.push(e)},this.getBottom=function(){var e=this.getBounds();return{x:e.x+e.width/2,y:e.y}}},e.exports=nb.simpleBurette},function(e,t,i){"use strict";nb.simpleButton=function(){function e(){this.gotoAndStop(1)}function t(){this.gotoAndStop(0)}this.addEventListener(TouchEvent.TOUCH_BEGIN,e),this.addEventListener(TouchEvent.TOUCH_END,t),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,t)},e.exports=nb.simpleButton},function(e,t,i){"use strict";(function(t){var i=t.nb,r=.3;i.simpleDrag=function(){function e(e){var t,i=[],r=1,n=0;do{if(t=e+"Target"+n,!(r=a[t]))break;var o,l=new PIXI.Sprite,h=!1;s.totalFrames>0?(h=!0,o=s[0],o.reverse()):(o=s.children.concat(),s.background instanceof PIXI.DisplayObject&&(o=[s.background])),o.forEach(function(e){if(e instanceof PIXI.DisplayObject||(e=e.dis),!e.mask)if(h){if(e.dis instanceof PIXI.Text)return;var t=e.clone();t&&l.addChild(t)}else{if(e instanceof PIXI.Text)return;var i=e.clone();i&&l.addChild(i)}}),r.addChild(l),l.x=0,l.y=0,r=l,r.alpha=0,r.name=t,i[n]=r,n++}while(r);return i}function t(){if(!this.dragging){if(s.txt&&!0===s.txt.visible&&(s.txt.visible=!1),-1===f)c=s.width,u=s.height,f=e(s.name),0===f.length&&console.warn(f);else if(0===f.length)return;d=0;for(var t=0;t<f.length;t++)TweenMax.to(f[t],.5,{alpha:r});s.addEventListener(NBDrag.event.DRAG_MOVE,n),s.addEventListener(NBDrag.event.STOP_DRAG,o),s.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,o),s.emit(i.simpleDrag.event.START_DRAG),this.dragging=!0}}function n(){TweenMax.killTweensOf(s);for(var e=0;e<f.length;e++)s.hitTest(f[e].parent)?(TweenMax.to(f[e],.5,{alpha:.6}),s.emit(i.simpleDrag.event.ON_HITTED,f[e].name.valueOf())):TweenMax.to(f[e],.5,{alpha:r})}function o(){var e=-1,r=-1,a=0;s.removeEventListener(NBDrag.event.START_DRAG,t),s.removeEventListener(NBDrag.event.DRAG_MOVE,n),s.removeEventListener(NBDrag.event.STOP_DRAG,o),s.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,o),NBDrag.removeDrag(s);for(var c=0;c<f.length;c++)TweenMax.to(f[c],.5,{alpha:0}),!1!==(a=s.hitTest(f[c].parent))&&(d=1,(-1===e||r<a)&&(e=c,r=a),console.log(r+c.toString()));if(1!==d)return this.dragging=!1,console.log("提示：选择了"+d+"个目标位置"),s.emit(i.simpleDrag.event.NOT_REACH_TARGET,d),s.txt&&(s.txt.visible=!0),NBDrag.addDrag(s),s.addEventListener(NBDrag.event.START_DRAG,t),void(d=0);s.emit(i.simpleDrag.event.REACH_TARGET_HITTED,f[e].name.valueOf()),TweenMax.to(s.scale,.5,{x:h,y:h}),TweenMax.to(s,.5,{x:f[e].parent.x,y:f[e].parent.y,rotation:l*Math.PI/180,onComplete:function(){return this.target.dragging=!1,console.log("提示： 已经拖动到正确的位置"),s.emit(i.simpleDrag.event.REACH_TARGET,f[e].name.valueOf()),f.splice(e,1),0===f.length?void s.emit(i.simpleDrag.event.FINISH_DRAG):(d=0,NBDrag.addDrag(s),s.addEventListener(NBDrag.event.START_DRAG,t),void(s.interactive=!1))}})}var s=arguments[0]||this,a=s.parent,l=arguments[1]||0;this.setRotation=function(e){l=e};var h=arguments[2]||1;this.setScale=function(e){h=e};var c=void 0,u=void 0,f=-1,d=0;NBDrag.addDrag(s),s.addEventListener(NBDrag.event.START_DRAG,t),s.removeSimpleDrag=function(){s.removeEventListener(NBDrag.event.START_DRAG,t)},s.resetSimpleDrag=function(){f=-1,s.dragging=!1,s.removeSimpleDrag(),NBDrag.addDrag(s),s.addEventListener(NBDrag.event.START_DRAG,t)}},i.simpleDrag.event={START_DRAG:"startSimpleDrag",ON_HITTED:"hitted",REACH_TARGET_HITTED:"onReachHitted",REACH_TARGET:"onReachTarget",NOT_REACH_TARGET:"notReachTarget",FINISH_DRAG:"finishDrag"},e.exports=i.simpleDrag}).call(t,i(1))},function(e,t,i){"use strict";nb.simpleThermometer=function(e){function t(e){e?a.set(Math.min(Math.max(e,n),o)):a.set(s)}var i=e||this,r=i.pointer,n=10,o=100,s=20,a={get:function(){return r.scale.y},set:function(e){r.scale.y=e}};i.setTemperature=function(e){t(e)},i.tweensToTemperature=function(e,t){return TweenMax.to(r.scale,t,{y:e})}},e.exports=nb.simpleThermometer},function(e,t,i){"use strict";(function(t){var i=t.nb;i.spirit=function(e){function t(){if(u.removeEventListener(i.spirit.event.LIGHT,t),d.parent===u){var e=new TimelineMax({repeat:0,onComplete:function(){u.emit(i.spirit.event.ON_LIGHT_UP)}});w=i.spirit.state.ON,x.visible=!1,x.x+=E.x,x.y+=E.y,c(),e.add(TweenMax.to(d,1,{y:d.y-50,alpha:0})),e.add(GlobalEffect.fadeIn(x)),e.add(GlobalEffect.bezierTo(x,1,{x:x.x-E.x,y:x.y-E.y,angle:30*-Math.PI/180,ease:Quad.easeOut,onComplete:function(){l()}})),e.add(GlobalEffect.fadeOut(x))}}function r(){u.removeEventListener(i.spirit.event.PUTOFF,r),p=d.clone(),f.addChild(p),p.x=u.x+m.x,p.y=u.y+m.y,GlobalEffect.fadeIn(p),NBDrag.addDrag(p),p.addEventListener(NBDrag.event.START_DRAG,n)}function n(){d.x=S.x,d.y=S.y,p.addEventListener(NBDrag.event.STOP_DRAG,o),TweenMax.to(d,.1,{alpha:.2})}function o(){p.removeEventListener(NBDrag.event.STOP_DRAG,o),TweenMax.to(d,.1,{alpha:0}),TweenMax.killTweensOf(p),p.hitTest(u)&&(NBDrag.removeDrag(p),p.removeEventListener(NBDrag.event.START_DRAG,n),s())}function s(){var e=new TimelineMax({repeat:0,onComplete:h});e.add(TweenMax.to(p,.5,{x:u.x+S.x+g.x,y:u.y+S.y+g.y,rotation:v})),e.add(TweenMax.to(p,.5,{x:u.x+S.x,delay:-.5,rotation:0,onComplete:function(){a(y,.95),a(_,.95)}})),e.add(TweenMax.to(p,.5,{y:u.y+S.y,delay:-.3,ease:Quad.easeOut,onUpdate:function(){a(y,.95),a(_,.95)}}))}function a(e,t){e.scale.x*=t,e.scale.y*=t}function l(){y&&_||(y=ParticleUtil.getParticle(ParticleUtil.particles.outSide_fire),u.addChild(y),y.bind(u,b.x-5,b.y-5),y.alpha=.6,y.visible=!0,y.scale.x=1.2,y.scale.y=1.1,_=ParticleUtil.getParticle(ParticleUtil.particles.spirit_fire_blue),u.addChild(_),_.bind(u,b.x+15,b.y-5),_.alpha=.2,_.visible=!0,_.scale.x=.7)}function h(){y&&(y.visible=!1,y.destroy(),y=null),_&&(_.visible=!0,_.destroy(),_=null)}function c(){T||(T=ParticleUtil.getParticle(ParticleUtil.particles.match_fire),x.addChild(T),T.bind(x,3,5),T.alpha=.2,T.visible=!0)}var u=this||e,f=u.parent,d=u.cover,p=void 0,m={x:700,y:250},g=(u.body,{x:100,y:-120}),v=45*Math.PI/180,y=void 0,_=void 0,b={x:56,y:20},x=u.stick;x.visible=!1;var T=void 0,E={x:300,y:100},S={x:d.x,y:d.y},w=i.spirit.state.COVERED;u.render=function(){return w===i.spirit.state.ON&&(y&&y.render(),_&&_.render(),T&&T.render(),!0)},u.autoLightUp=function(){w=i.spirit.state.ON,!0!==d.visible&&1!==d.alpha||GlobalEffect.fadeOut(d),l()},u.autoPutOff=function(){h(),w=i.spirit.state.OFF},u.setLightUpWithMatch=function(){u.addEventListener(i.spirit.event.LIGHT,t)},u.setPutOffWithCover=function(){u.addEventListener(i.spirit.event.PUTOFF,r)}},i.spirit.event={LIGHT:"light",PUTOFF:"putOff",ON_LIGHT_UP:"onLightUp"},i.spirit.state={ON:"on",OFF:"off",COVERED:"covered"},e.exports=i.spirit}).call(t,i(1))},function(e,t,i){"use strict";nb.testtube=function(){this.shake=function(e){}}},function(e,t,i){"use strict";var r=100,n=i(218);nb.timelineProcessing=function(e){function t(e){return Math.floor((e-I)/A*r)}function i(e){if("mouseup"===e.type||"touchend"===e.type||"touchendoutside"===e.type||"mouseupoutside"===e.type)H.dragEnd();else if("None"!==H.current){var t=N;N=e.data.global.x-e.target.worldTransform.tx,"Dragging"===H.current&&(S=t-N>=3?-1:t-N<=-3?1:0),H.doDrag(e)}}function o(){k.clear(),k.beginFill(16777215,1,0),k.drawRect(w.x,y.y,A,P)}function s(){return V=-1,M.forEach(function(e,t,i){Math.abs(i[t].x-w.x)<=D&&i[t].x>=w.x?V=t:i[t].x<w.x?i[t].stateDone.alpha=1:i[t].stateDone.alpha=0}),-1!==V}function a(e){return e>=I+A-.3}function l(e){return e<=I}function h(e){TweenMax.killTweensOf(w),a(e)?e=I+A:l(e)&&(e=I),TweenMax.to(w,0,{x:e,y:O}),o()}function c(){T.rotation+=F*G*S,E.rotation+=L*G*S}function u(){var e=z;z=(new Date).valueOf(),G=z-e}function f(){H.activitiesDone()}function d(){H.initState(),B&&b.addEventListener(TouchEvent.TOUCH_BEGIN,i)}function p(){H.reset()}var m=this||e;m.getProgress=function(){return U()/r};for(var g=m.parent,v=/frame\d+/;g;){if(!g)return void console.error("没有配置正确， 需要将组将放到step对象中。");if(v.exec(g.name))break;g=g.parent}var y=m.timelineBar,_=y.timelineBottom,b=m.shade,x=m.timelineClock,T=x.timelineClockMinite,E=x.timelineClockHour,S=1,w=m.timelineTimePointer;w.stateOn.alpha=0;var M=[],A=y.width,P=y.height,C=6e3,R=A/C,D=2;this.setDuration=function(e){C=e;var t=R;R=A/C,D*=R/t};var I=w.x,O=w.y,F=.01,L=F/60,B=!0;this.setDragable=function(e){B=e},M=function(){for(var e=[],i=0,r=/^timelineMileStone.+/,n=/timelineMileStone/,o=0;o<m.children.length;o++){var s=m.getChildAt(o);r.exec(s.name)&&(s.timeStamp=t(s.x),s.textValue=s.name.split(n)[1],TweenMax.to(s,0,{y:O}),s.stateDone.alpha=0,e[i]=s,i++)}return e}();var N=0,k=new PIXI.Graphics;k.clear(),k.beginFill(16777215,1,0),k.drawRect(w.x,y.y,A,P),_.addChild(k),_.mask=k;var V=-1,U=function(){return t(w.x)},z=void 0;z=(new Date).valueOf();var G=0;m.currentProgress=function(){return U()/r};var H=new n.create({initial:"None",events:[{name:"initState",from:"None",to:"Playing"},{name:"doDrag",from:["Playing","Waiting","Completed","Dragging"],to:"Dragging"},{name:"dragEnd",from:"Dragging",to:"Ready"},{name:"reachMileStone",from:"Playing",to:"Waiting"},{name:"activitiesDone",from:"Waiting",to:"Ready"},{name:"doComplete",from:["Playing","Ready"],to:"Completed"},{name:"setPlay",from:"Ready",to:"Playing"},{name:"setWait",from:"Ready",to:"Waiting"},{name:"reset",from:"Completed",to:"None"}],callbacks:{onenterNone:function(e,t,i){h(I),T.rotation=0,E.rotation=0},onenterPlaying:function(){m.emit(nb.timelineProcessing.event.ON_START_PLAY)},onPlaying:function(e,t,i){b.interactive=!0,h(R*G+w.x),c()},onenterWaiting:function(e,t,i){TweenMax.to(w.stateOn,.4,{alpha:1}),w.x=M[V].x,m.emit(nb.timelineProcessing.event.ON_REACHMILESTONE,M[V].textValue)},onleaveWaiting:function(e,t,i){V=-1,TweenMax.to(w.stateOn,.4,{alpha:0}),"doDrag"===e&&m.emit(nb.timelineProcessing.event.ON_STOP_WAIT)},onenterCompleted:function(e,t,i){b.interactive=!0,m.addEventListener(nb.timelineProcessing.event.ON_RESET,p),m.emit(nb.timelineProcessing.event.ON_COMPLETE)},onleaveCompleted:function(e,t,i){m.removeEventListener(nb.timelineProcessing.event.ON_RESET,p)},onDragging:function(e,t,i){s(),c()},onenterDragging:function(e,t,r){b.addEventListener(TouchEvent.TOUCH_MOVE,i),b.addEventListener(TouchEvent.TOUCH_END,i),b.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,i)},onleaveDragging:function(e,t,r){S=1,b.removeEventListener(TouchEvent.TOUCH_MOVE,i),b.removeEventListener(TouchEvent.TOUCH_END,i),b.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,i)},onenterReady:function(){b.interactive=!1,a(w.x)?H.doComplete():H.setPlay()},onReady:function(e,t,i){},ondoDrag:function(e,t,i){h(N)}}});g.on("update",function(){switch(u(),TweenMax.to(w,0,{y:O}),m.emit(nb.timelineProcessing.event.ON_PLAY,U()/r),H.current){case"None":m.on(nb.timelineProcessing.event.ON_INIT,d);break;case"Playing":H.onPlaying(),a(w.x)&&H.doComplete(),s()&&H.reachMileStone();break;case"Dragging":H.onDragging();break;case"Waiting":m.on(nb.timelineProcessing.event.ON_ACTIVITIESDONE,f);break;case"Ready":H.onReady();break;case"Completed":break;default:throw"需要设置一个状态"+H.current}})},nb.timelineProcessing.event={ON_REACHMILESTONE:"onReachMilestone",ON_COMPLETE:"onComplete",ON_PLAY:"onPlay",ON_ACTIVITIESDONE:"onActivitiesDone",ON_STOP_WAIT:"onStopWait",ON_INIT:"onInit",ON_RESET:"onResetTimeline",ON_START_PLAY:"onStartPlay"},nb.timelineProcessing.milestoneState={UNREACHED:-1,ON:0,PASSED:1},e.exports=nb.timelineProcessing},function(e,t,i){!function(){var i={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,t){var r="string"==typeof e.initial?{state:e.initial}:e.initial,n=e.terminal||e.final,o=t||e.target||{},s=e.events||[],a=e.callbacks||{},l={},h={},c=function(e){var t=Array.isArray(e.from)?e.from:e.from?[e.from]:[i.WILDCARD];l[e.name]=l[e.name]||{};for(var r=0;r<t.length;r++)h[t[r]]=h[t[r]]||[],h[t[r]].push(e.name),l[e.name][t[r]]=e.to||t[r];e.to&&(h[e.to]=h[e.to]||[])};r&&(r.event=r.event||"startup",c({name:r.event,from:"none",to:r.state}));for(var u=0;u<s.length;u++)c(s[u]);for(var f in l)l.hasOwnProperty(f)&&(o[f]=i.buildEvent(f,l[f]));for(var f in a)a.hasOwnProperty(f)&&(o[f]=a[f]);return o.current="none",o.is=function(e){return Array.isArray(e)?e.indexOf(this.current)>=0:this.current===e},o.can=function(e){return!this.transition&&void 0!==l[e]&&(l[e].hasOwnProperty(this.current)||l[e].hasOwnProperty(i.WILDCARD))},o.cannot=function(e){return!this.can(e)},o.transitions=function(){return(h[this.current]||[]).concat(h[i.WILDCARD]||[])},o.isFinished=function(){return this.is(n)},o.error=e.error||function(e,t,i,r,n,o,s){throw s||o},o.states=function(){return Object.keys(h).sort()},r&&!r.defer&&o[r.event](),o},doCallback:function(e,t,r,n,o,s){if(t)try{return t.apply(e,[r,n,o].concat(s))}catch(t){return e.error(r,n,o,s,i.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",t)}},beforeAnyEvent:function(e,t,r,n,o){return i.doCallback(e,e.onbeforeevent,t,r,n,o)},afterAnyEvent:function(e,t,r,n,o){return i.doCallback(e,e.onafterevent||e.onevent,t,r,n,o)},leaveAnyState:function(e,t,r,n,o){return i.doCallback(e,e.onleavestate,t,r,n,o)},enterAnyState:function(e,t,r,n,o){return i.doCallback(e,e.onenterstate||e.onstate,t,r,n,o)},changeState:function(e,t,r,n,o){return i.doCallback(e,e.onchangestate,t,r,n,o)},beforeThisEvent:function(e,t,r,n,o){return i.doCallback(e,e["onbefore"+t],t,r,n,o)},afterThisEvent:function(e,t,r,n,o){return i.doCallback(e,e["onafter"+t]||e["on"+t],t,r,n,o)},leaveThisState:function(e,t,r,n,o){return i.doCallback(e,e["onleave"+r],t,r,n,o)},enterThisState:function(e,t,r,n,o){return i.doCallback(e,e["onenter"+n]||e["on"+n],t,r,n,o)},beforeEvent:function(e,t,r,n,o){if(!1===i.beforeThisEvent(e,t,r,n,o)||!1===i.beforeAnyEvent(e,t,r,n,o))return!1},afterEvent:function(e,t,r,n,o){i.afterThisEvent(e,t,r,n,o),i.afterAnyEvent(e,t,r,n,o)},leaveState:function(e,t,r,n,o){var s=i.leaveThisState(e,t,r,n,o),a=i.leaveAnyState(e,t,r,n,o);return!1!==s&&!1!==a&&(i.ASYNC===s||i.ASYNC===a?i.ASYNC:void 0)},enterState:function(e,t,r,n,o){i.enterThisState(e,t,r,n,o),i.enterAnyState(e,t,r,n,o)},buildEvent:function(e,t){return function(){var r=this.current,n=t[r]||(t[i.WILDCARD]!=i.WILDCARD?t[i.WILDCARD]:r)||r,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,n,o,i.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,n,o,i.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===i.beforeEvent(this,e,r,n,o))return i.Result.CANCELLED;if(r===n)return i.afterEvent(this,e,r,n,o),i.Result.NOTRANSITION;var s=this;this.transition=function(){return s.transition=null,s.current=n,i.enterState(s,e,r,n,o),i.changeState(s,e,r,n,o),i.afterEvent(s,e,r,n,o),i.Result.SUCCEEDED},this.transition.cancel=function(){s.transition=null,i.afterEvent(s,e,r,n,o)};var a=i.leaveState(this,e,r,n,o);return!1===a?(this.transition=null,i.Result.CANCELLED):i.ASYNC===a?i.Result.PENDING:this.transition?this.transition():void 0}}};void 0!==e&&e.exports&&(t=e.exports=i),t.StateMachine=i}()},function(e,t,i){"use strict";(function(t){var r=i(78),n=i(77),o=t.nb;o.microscopeWithThree=function(e,i,a){function l(){ve&&($("#nbTable")&&$("#nbTable").hide(),instance.menu&&instance.menu.setVisible(!1),instance.backBtn&&(instance.backBtn.visible=!1))}function c(){if(!B&&!K){ce.visible=!1;J.blur=Math.abs(U.position.y-.45)/1.193;var t=W.rotation.y/(2*Math.PI/5)%5,i=ne[Math.abs(oe)],r=i;Math.abs(oe-t)<.4?r*=1-Math.abs(oe-t)/.4:r=0;var n=G.localToWorld(new THREE.Vector3(0,0,0)),o=G.localToWorld(new THREE.Vector3(0,1,0)),s=(new THREE.Vector3).subVectors(n,o),a=(new THREE.Vector3).subVectors(se,n),l=s.angleTo(a),h=(new THREE.Vector3).crossVectors(a,s);h.normalize();var c=a.clone();c.applyAxisAngle(h,2*l),c.add(n);var u=new THREE.Line3(X.worldToLocal(n.clone()),X.worldToLocal(c.clone())),f=new THREE.Plane(new THREE.Vector3(0,1,0)),d=f.intersectLine(u);be.vertices[0]=se,be.vertices[1]=n;var p=1;if(d){var m=d.length();p=m>3?0:p<.6?1:1-m/2.4,be.vertices[2]=X.localToWorld(d)}else be.vertices[2]=n,p=0;be.verticesNeedUpdate=!0;var g,v=(Y.rotation.y/(2*Math.PI/3)-1)%3,y=Math.round(v);switch(y){case 0:case 3:case-3:g=0;break;case 1:case-2:g=1;break;case 2:case-1:g=2}-1!==J.mult&&(J.mult=g);var _=y-v;(isNaN(_)||_<.001)&&(_=0);var b=Math.atan2(e.camera.position.z,e.camera.position.x);J.rotation=b,J.brightness=p/(g+1),I.multiable||(J.brightness*=3),ee.update(J)}}function u(e,t){if(null==Se[e])return void console.log("没有找到装片");var i=Se[e];I.slide&&I.slide==i||we.open&&TweenLite.to(i.position,.5,{y:t?-7.5:-8.5})}function f(t){we.open&&(N.lockX=N.lockY=!1,we.open=!1,o.slidesList.hide(),I.showSight(),I.showTips(),Te=!1,e.tweenTo(e.camera,L.camera,{timer:1}),N.lookAtTarget(new THREE.Vector3),g(t),i.emit("clickPian"),setTimeout(function(){we.closeBox()},1500),N.zoomSpeed=1)}function d(){function t(t){function r(){i.emit("openBox"),N.isLookingAtTarget()||B||we.open||0==we.open&&(ee.setInteractive(!1),I.hideTips(),TweenLite.to(s.rotation,.5,{y:-1.7}),e.tweenTo(e.camera,Ae,{timer:1,onComplete:function(){I.hideSight(),o.slidesList.show(),Te=!0}}),N.lookAtTarget(a,{timer:1}),N.lockX=N.lockY=!0,we.open=!0,N.zoomSpeed=0)}L.add(we),we.scale.set(.87,.87,.87),we.position.set(2.5,-8.5,-10),we.open=!1;var s=we.getObjectByName("gaizi"),a=we.position.clone();a.y+=2,n.addGesture(we,n.gesture.TAP,r),we.openBox=function(){TweenLite.to(s.rotation,.5,{y:-1.7,onStart:function(){ee.setInteractive(!1),I.hideSight()}})},we.closeBox=function(){TweenLite.to(s.rotation,.5,{y:0,onComplete:function(){I.showSight()}})},m(),p(Pe)}we=e.loadNBSFile({id:"0022/model",callback:t})}function p(e){Pe=e,we&&(we.visible=e)}function m(){if(null==Ee)return void console.log("先用addSlides方法添加装片");for(var t=0;t<Ee.length;t++){var i=function(t){function i(i){if(this.conf.notInBox){if(this.onTable)return;TweenLite.to(this.position,.5,{x:0,onComplete:function(){e.add3DDrag({mesh:s,n:new THREE.Vector3(0,1,0),nBounds:{xMin:-ae,xMax:ae,yMin:0,yMax:0,zMin:-ae,zMax:ae},scale:.1}),s.defaultPos=s.position.clone(),s.addEventListener(NBDrag.event.DRAG_MOVE,R),s.addEventListener(NBDrag.event.STOP_DRAG,D),I.slide=s}}),this.onTable=!0,TweenLite.to(Q.rotation,.5,{y:-.4}),TweenLite.to(Z.rotation,.5,{y:.4})}else t.backBox()}var r=t.conf;if(t.name=r.slID,L.add(t),t.position.set(2.36+.14*t.slidesIndex,-8.5,-10),t.rotation.set(0,0,-1.57),"0145/model_slide1"==r.nbsID){var a;a=r.slID?r.newSlide?o.config.URI_PREFIX+"slides_new/"+r.slID+"/"+r.slTexture:o.config.URI_PREFIX+"slides/"+r.slID+"/"+r.slTexture:o.config.MODEL_URI_PREFIX+"models/eq0145/3.png";var l=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(a),transparent:!0});t.children[0].material=l}else if("0145/model_slide2"==r.nbsID)t.scale.set(2,2,2),t.children[0].translateY(.26),t.children[1].translateY(.26),t.children[2].translateY(.26),t.children[0].translateX(-.5),t.children[1].translateX(-.5),t.children[2].translateX(-.5),t.getChildByName("pasted__pasted__pasted__pCylinder3").material.map.image.src=o.config.MODEL_URI_PREFIX+"models/eq0145/yuan.png";else if("1006/model"==r.nbsID){var h=t.getChildByName("polySurface3").material;h.shading=1}r.notInBox&&(we.visible=!1,t.position.set(8,-1.75,0),t.rotation.set(0,0,0)),t.inboxPosition=t.position.clone(),n.addGesture(t,n.gesture.TAP,i),t.backBox=function(){if(this.onTable){we.openBox(),_();var i=k.localToWorld(Re.clone());L.add(t),t.position.copy(i),t.rotation.z=k.rotation.z,ee.removeSlides();var r=new TimelineLite;r.to(t.position,.5,{z:-10},0),r.to(t.position,.5,{x:2.36+.14*t.slidesIndex,onComplete:function(){Q.isUp&&b()}},1),r.to(t.rotation,.3,{z:-1.57},1),r.to(t.position,.5,{y:-8.5,onComplete:function(){t.onTable=!1,we.closeBox()}},1),I.slide=null,I.slide=void 0,e.remove3DDrag(this),t.removeEventListener(NBDrag.event.DRAG_MOVE,R),t.removeEventListener(NBDrag.event.STOP_DRAG,D)}}},r=Ee[t],s=e.loadNBSFile({id:r.nbsID,callback:i});s.slidesIndex=t,s.conf=r,Se.push(s)}}function g(i){if(null==Se[i])return void console.log("没有找到装片");var r=Se[i];if(!I.slide||I.slide!=r){I.slide&&I.slide.backBox();var n=k.localToWorld(Re.clone());console.log(n);var o=new TimelineLite;o.to(r.position,.5,{y:n.y},0),o.to(r.position,.5,{z:n.z,onComplete:function(){_()}},.5),o.to(r.rotation,.4,{z:0},.3),o.to(r.position,.5,{x:n.x,onComplete:function(){b(),r.onTable=!0,k.add(r),r.position.copy(Re),t.g=r,I.slide=r,e.add3DDrag({mesh:r,n:new THREE.Vector3(0,1,0),nBounds:{xMin:-ae,xMax:ae,yMin:0,yMax:0,zMin:-ae,zMax:ae},scale:.1}),r.defaultPos=r.position.clone(),r.addEventListener(NBDrag.event.DRAG_MOVE,R),r.addEventListener(NBDrag.event.STOP_DRAG,D),a[i].container?ee.changeSlides(a[i].container,J):ee.changeSlides(a[i].slID,J)}},.5)}}function v(e,t){return function(){var i=2*Math.PI/t,r=e.rotation.y%i;Math.abs(r)<i/2?TweenMax.to(e.rotation,.5,{y:e.rotation.y-r}):r<0?TweenMax.to(e.rotation,.5,{y:e.rotation.y-i-r}):TweenMax.to(e.rotation,.5,{y:e.rotation.y+(i-r)})}}function y(){0!=this.matrixAutoUpdate&&(Q.isUp=!Q.isUp,TweenMax.to(Q.rotation,.5,{z:Q.isUp?.12:0}),Z.isUp=!Z.isUp,TweenMax.to(Z.rotation,.5,{z:Z.isUp?.12:0}))}function _(){Q.isUp=Z.isUp=!0,TweenMax.to(Q.rotation,.5,{z:.12}),TweenMax.to(Z.rotation,.5,{z:.12})}function b(){Q.isUp=Z.isUp=!1,TweenMax.to(Q.rotation,.5,{z:0}),TweenMax.to(Z.rotation,.5,{z:0})}function x(e){De=e.angle}function T(e){Ie=e.angle}function E(e){Oe=e.angle}function S(){i.toLocal({x:o.stem.STEMMain.W,y:o.stem.STEMMain.H},instance.stage),i.toLocal({x:o.stem.W,y:0},instance.stage)}function M(e){var t=[W,Q,Z,Y,H,j,V,k,z,G,U];TweenLite.to(k.rotation,.6,{x:0,y:0,z:0,onStart:function(){t.forEach(function(e){e.defaultMatrixUpdate=e.matrixAutoUpdate,e.matrixAutoUpdate=!0})},onComplete:function(){c(),t.forEach(function(e){e.matrixAutoUpdate=e.defaultMatrixUpdate})}}),TweenLite.to(z.rotation,.5,{x:0,y:0,z:0}),TweenLite.to(G.rotation,.5,{x:0,y:0,z:.15}),TweenLite.to(W.rotation,.5,{x:0,y:1.2566,z:0}),TweenLite.to(H.rotation,.5,{x:0,y:0,z:3.14-Ie}),TweenLite.to(j.rotation,.5,{x:0,y:0,z:0-Oe}),TweenLite.to(U.position,.5,{y:.45}),I.multiable&&TweenLite.to(Y.rotation,.5,{y:2*Math.PI/3}),H.changeRangeAngle(3.14),j.changeRangeAngle(0),k.changeRangeAngle(0)}function A(e){e&&(Ee=e,o.slidesList.init(Ee,f,u,i),e.length>0&&d())}function P(){te&&(te.defaultVisible=te.visible,te.visible=!1),me=ce.localToWorld(new THREE.Vector3(0,5,0)),ge=ce.localToWorld(new THREE.Vector3(0,2,0)),ue=e.camera.position.clone(),e.controls.enabled=!1,B=!0,new TimelineMax({onComplete:function(){var t=r.vertoc3ToPoint(ce.position,e.camera);console.log("------\x3e>>>>",t),console.log(i.name),i.emit("startObserve"),ee.changeState(t)}}).to(e.camera.position,1,{x:me.x,y:me.y,z:me.z,onComplete:function(){}})}function C(){TweenMax.to(e.camera.position,1,{x:ue.x,y:ue.y,z:ue.z,onComplete:function(){B=!1,te&&(console.log("slidesContainer----\x3e",te),te.visible=!0),e.controls.enabled=!0,i.emit("endObserve")}})}function R(){if(void 0!==I.slide&&null!==I.slide){-1===J.mult?4:re[(J.mult+1)%3];var e=(this.position.x-this.defaultPos.x)/ae,t=(this.position.z-this.defaultPos.z)/ae;ee.view.pivot.y=h/2-h/2*e,ee.view.pivot.x=w/2+w/2*t,J.offsetX=e,J.offsetY=-t}}function D(){void 0!==I.slide&&null!==I.slide&&I.slide.conf.newSlide&&console.log(I.slide.conf.newSlide)}var I=this,O=null;I.multiable=!0;var F=I.jingbi.shoubi.jingtong_observe.children[0];F&&"Mesh"==F.type&&(F.material.map=THREE.ImageUtils.loadTexture(o.config.MODEL_URI_PREFIX+"models/eq0145/logoe.jpg"));var i=e.frame2D,L=e.scene;t.system=e;var B=!1,N=e.controls;L.camera0.position.set(50,12,0),e.tweenTo(e.camera,L.camera0),window.scene=L;var k=I.jingbi,V=k.shoubi.jingbi_observe,U=k.shoubi.jingtong_observe,z=k.fanguangjing_observe,G=z.fanguangjing.mirror,H=k.shoubi.cuzhunjiaoluoxuan_observe,j=k.shoubi.xizhunjiaoluoxuan_observe,W=k.zheguangqi_observe,X=k.zaiwutai.zaiwutai_observe,Y=U.convertorGroup_observe.group,K=!1,q=U.mujing_observe;q.add(U.polySurface153),q.add(U.polySurface106),U.jingtong1_observe.children[0].material.side=2;var Q=k.zaiwutai.iron_sheet_L,Z=k.zaiwutai.iron_sheet_R;Q.isUp=!1,Z.isUp=!1;var J={rotation:0,offsetX:0,offsetY:0,brightness:.3,blur:0,mult:0};t.sightconfig=J;var ee=new o.eyepiece(i,J);ee.on("optimum",M),ee.on("observeslide",P),ee.on("goback",C),ee.on("startGoback",function(){i.emit("startGoback")}),ee.on("gotoLarge",function(){i.emit("gotoLarge")}),ee.on("startShowView",function(){i.emit("startShowView")}),ee.on("startHideView",function(){i.emit("startHideView")});var te=null,ie=10,re=[40,4,10],ne=[.5,1.2,1,.8,.7],oe=0,se=new THREE.Vector3(20,10,0),ae=.1,le=new THREE.BoxGeometry(.1,.1,.1),he=new THREE.MeshBasicMaterial({color:0}),ce=new THREE.Mesh(le,he);ce.position.set(0,19,.03),window.cube=ce,k.add(ce),ce.scale.set(10,10,10),ce.visible=!1,ce.ref=!0;var ue,fe=(new PIXI.Point,new THREE.SphereGeometry(2)),de=new THREE.MeshBasicMaterial({color:10066329}),pe=new THREE.Mesh(fe,de);k.add(pe),pe.scale.set(.25,1e-6,.25),pe.position.set(5,1.4,0),t.c=pe;var me,ge,ve=!1;window.addEventListener("resize",l);var he=X.children[0].material;he.color.setHex(1184274),he.emissive.setHex(0),he.specular.setHex(1118481),he.shininess=30,he=Y.wujingzhuanhuanqi.children[0].material,he.color.setHex(2302755),he.specular.setHex(4473924),he.shininess=120;for(var ye=Y.wujingzhuanhuanqi.wujing40_observe.children[0].material,_e=0;_e<ye.materials.length;_e++)"jinshu6"===ye.materials[_e].name&&(ye.materials[_e].side=2);var be=new THREE.Geometry;be.vertices.push(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3);var xe=new THREE.Line(be,new THREE.LineBasicMaterial({color:16711680}));xe.visible=!1,L.add(xe);i.on("update",c);var Te=!1;i.onPause=function(){o.slidesList.hide(1)},i.onResume=function(){Te&&o.slidesList.show(1)};var Ee,Se=[];L.camera0&&(L.camera=L.camera0,L.camera.position.set(50.23,10.64,0),L.add(L.camera));var we,Me=new THREE.Vector3(7,-5.5,-10),Ae={position:Me},Pe=!0;this.setBoxVisible=p;var Ce=new THREE.Vector3(4.75,2.2,0),Re=Ce.clone();e.add3DRotation({collideObj:V,rotateObj:k,axis:new THREE.Vector3(0,0,1),pivot:k.position,startAngle:-.1,endAngle:.8,onComplete:x});var De=0;e.add3DRotation({collideObj:z,rotateObj:z,axis:new THREE.Vector3(1,0,0),pivot:z.position}),e.add3DRotation({collideObj:G,rotateObj:G,axis:new THREE.Vector3(0,0,1),pivot:G.position}),e.add3DRotation({collideObj:Y,rotateObj:Y,axis:new THREE.Vector3(0,1,0),useMatrix:!1,onStart:function(){TweenMax.killTweensOf(Y.rotation),K=!0},onComplete:function(){K=!1,v(Y,6)}}),Y.rotation.y=2*Math.PI/3,this.lockWujingMult=function(e){Y.rotation.y=2*Math.PI/3+e*Math.PI*2/3,I.multiable=!1,Y.matrixAutoUpdate=!1},e.add3DRotation({collideObj:Q,rotateObj:Q,axis:new THREE.Vector3(0,1,0),useMatrix:!1,startAngle:-Math.PI/2,endAngle:.2}),e.add3DRotation({collideObj:Z,rotateObj:Z,axis:new THREE.Vector3(0,1,0),useMatrix:!1,startAngle:-.2,endAngle:Math.PI/2}),e.add3DRotation({collideObj:W,rotateObj:W,axis:new THREE.Vector3(0,1,0),useMatrix:!1,onStart:function(){TweenMax.killTweensOf(W.rotation)},onComplete:v(W,5)}),e.add3DRotation({collideObj:H,rotateObj:H,axis:new THREE.Vector3(0,0,1),pivot:H.position,startAngle:0,endAngle:10*Math.PI,onUpdate:function(e){U.position.y+=.1*e.offset},onComplete:T});var Ie=0;e.add3DRotation({collideObj:j,rotateObj:j,axis:new THREE.Vector3(0,0,1),pivot:j.position,startAngle:0,endAngle:30*Math.PI,onUpdate:function(e){U.position.y+=.001*e.offset},onComplete:E});var Oe=0;n.addGesture(Q,n.gesture.TAP,y),n.addGesture(Z,n.gesture.TAP,y),this.addSlides=A,this.setEyepieceZoom=function(e){ie=e},this.hideSight=function(){ee.hide(),ee.setInteractive(!1)},this.showSight=function(){ee.show(),ee.setInteractive(!0)},this.setObjectivesZoom=function(e){re[0]=e[0]||40,re[1]=e[1]||4,re[2]=e[2]||10},this.showLightHelper=function(e){xe.visible=e},window.addEventListener("resize",S),S(),this.toBestObserve=M,M(),this.updateFrame=function(){i.removeEventListener("update",c),i=e.frame2D,Fe&&(i.addChild(Fe),Fe.visible?Fe.play():Fe.gotoAndStop(0)),i.onPause=function(){o.slidesList.hide(1)},i.onResume=function(){Te&&o.slidesList.show(1)},i.on("update",c),e.show(),o.slidesList.changeStep(i),ee.changeStep(i),te&&(i.addChildWithSamePos(te),te.x=1e3,te.y=800,te.visible=!1)},this.addSlides=function(){A(),d()},this.addSlides=function(){A(a)},this.addContainerSlides=function(t){O=t,te||(te=new PIXI.Container,i.addChild(te),te.x=600,te.y=500);for(var r=[],s=0;s<O.length;s++){var a=O[s],l=PIXI.Sprite.fromFrame(a.texture);r.push(l),l.conf=a,l.x=300,l.y=50*s,l.index=s;var h=new PIXI.Text(a.name,{font:"20px Microsoft Yahei",fill:16777215});h.pivot.x=h.width/2,l.addChild(h),h.x=120,h.y=50,l.addEventListener(TouchEvent.TAP,function(t){function r(){I.slide=h,I.slide.conf=l.conf,k.add(h),h.position.set(12,2.261,0),TweenMax.to(h.position,1,{x:5,onComplete:function(){b(),e.add3DDrag({mesh:h,n:new THREE.Vector3(0,1,0),nBounds:{xMin:-ae,xMax:ae,yMin:0,yMax:0,zMin:-ae,zMax:ae},scale:.1}),h.defaultPos=h.position.clone(),h.addEventListener(NBDrag.event.DRAG_MOVE,R),h.addEventListener(NBDrag.event.STOP_DRAG,D)}})}function s(t){h.removeEventListener(NBDrag.event.DRAG_MOVE,R),h.removeEventListener(NBDrag.event.STOP_DRAG,D),e.remove3DDrag(I.slide),ee.removeSlides(),TweenMax.to(I.slide.position,1,{x:12}),TweenMax.to(I.slide,1,{alpha:0,onComplete:function(){I.slide.parent&&I.slide.parent.remove(I.slide),I.slide=null,I.slide=void 0}})}function a(){if(i.emit("loadSlide",{index:l.index}),"0145/model_slide1"==l.conf.nbsID&&l.conf.slTexture){var e,t=l.conf;e=t.slID?t.newSlide?o.config.URI_PREFIX+"slides_new/"+t.slID+"/"+t.slTexture:o.config.URI_PREFIX+"slides/"+t.slID+"/"+t.slTexture:o.config.URI_PREFIX+"models/eq0145/"+t.slTexture,h.children[0].material.map.image.src=e}if("0145/model_slide2"==l.conf.nbsID){h.scale.set(2,2,2),h.children[0].translateY(.26),h.children[1].translateY(.26),h.children[2].translateY(.26),h.children[0].translateX(-.5),h.children[1].translateX(-.5),h.children[2].translateX(-.5);var e=o.config.URI_PREFIX+"models/eq0145/"+l.conf.slTexture;h.getChildByName("pasted__pasted__pasted__pCylinder3").material.map.image.src=o.config.MODEL_URI_PREFIX+"models/eq0145/yuan.png"}}var l=this,h=e.loadNBSFile({id:this.conf.nbsID,callback:a});void 0!=I.slide?(e.remove3DDrag(I.slide),ee.removeSlides(),TweenMax.to(I.slide.position,1,{x:12}),TweenMax.to(I.slide,1,{alpha:0,onComplete:function(){I.slide.parent&&I.slide.parent.remove(I.slide),r()}})):r(),n.addGesture(h,n.gesture.TAP,s),J.mult=l.conf.mult?0:-1,ee.changeSlides(l.conf.container,J)}),te.addChild(l),te.visible=!1}i.emit("loadedSlide",r)},this.showSlidesList=function(){te&&(te.visible=!0)},this.showFish=function(r){function s(e){function s(t){n.removeGesture(e,n.gesture.TAP),i.unBindDisplayFromMesh(e);var o=new TimelineMax({onComplete:function(){k.add(e),e.position.set(5,2.3,0),ee.setInteractive(!0),l.defaultPos=l.position.clone(),I.slide=l,J.mult=-1,ee.changeSlides(r,J)}});o.add(TweenMax.to(this.position,.5,{x:7,ease:Back.easeOut})),o.add(TweenMax.to(this.position,.5,{y:-1.7,z:0,ease:Sine.easeInOut}),"-=0.3"),o.add([TweenMax.to(this.position,.5,{x:0,ease:Sine.easeInOut}),TweenMax.to(Q.rotation,.5,{y:-.4}),TweenMax.to(Z.rotation,.5,{y:.4})]),this.onTable=!0}e.conf;e.name="fish",L.add(e),t.obj=e,e.position.set(2.5,-9.4,-10),e.rotation.set(0,0,0),e.children[0].translateY(.26),e.children[1].translateY(.26),e.children[2].translateY(.26),e.children[0].translateX(-.5),e.children[1].translateX(-.5),e.children[2].translateX(-.5),e.getChildByName("pasted__pasted__pasted__pCylinder3").material.map.image.src=o.config.MODEL_URI_PREFIX+"models/eq0145/yuan.png";var a={mesh:e};ee.setInteractive(!1),i.bindDisplayToMesh(a);n.addGesture(e,n.gesture.TAP,s)}var a={texture:"slide3",name:"小鱼尾鳍",nbsID:"0145/model_slide2",slID:"sl0000",notInBox:!0},l=e.loadNBSFile({id:a.nbsID,callback:s});Se.push(l)},this.deleteSlide=function(){I.slide&&(I.slide.backBox?I.slide.backBox():(e.remove3DDrag(I.slide),ee.removeSlides(),TweenMax.to(I.slide.position,1,{x:12}),TweenMax.to(I.slide,1,{alpha:0,onComplete:function(){I.slide.parent&&I.slide.parent.remove(I.slide),I.slide=void 0}})))};var Fe=instance.createChildFromData(i,s);Fe.visible=!1,Fe.animationSpeed=.5,Fe.x*=.5,Fe.x+=200,Fe.y*=.5,Fe.y+=100,Fe.scale.x=Fe.scale.y=.5,I.hideTips=function(){Fe.visible=!1,Fe.gotoAndStop(0)},I.showTips=function(){Fe.visible=!1,Fe.play()},i.emit("microscopeLoaded")},e.exports=o.microscopeWithThree;var s={0:{0:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:225.2,y:119.55,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:24},1:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},2:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px 'Microsoft Yahei'",c:"#FFFFFF",elementID:115},3:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:4},1:{0:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:219.15,y:124.15,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:26},1:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},2:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},3:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:4},2:{0:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:213.05,y:128.75,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:27},1:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},2:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},3:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:4},3:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:207,y:133.35,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:28},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},4:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:200.9,y:138,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:29},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},5:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:194.85,y:142.6,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:30},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},6:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:188.75,y:147.2,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:31},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},7:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:182.7,y:151.8,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:32},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},8:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:176.65,y:156.4,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:33},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},9:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:170.55,y:161,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:34},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},10:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:164.5,y:165.6,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:35},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},11:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:158.4,y:170.25,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:36},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},12:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:152.35,y:174.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:37},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},13:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:146.25,y:179.45,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:38},2:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},3:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},4:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:5},14:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},15:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},16:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},17:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},18:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},19:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},20:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},21:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"点击",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:23},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},22:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},23:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},24:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},25:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},26:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},3:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},4:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},5:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:6},27:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:140.2,y:184.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:39},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},28:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:145.8,y:184.45,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:40},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},29:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:151.45,y:184.9,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:41},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},30:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:157.05,y:185.3,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:42},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},31:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:162.65,y:185.75,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:43},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},32:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:168.25,y:186.15,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:44},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},33:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:173.9,y:186.6,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:45},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},34:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:179.5,y:187,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:46},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},35:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:185.1,y:187.4,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:47},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},36:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:190.75,y:187.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:48},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},37:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:196.35,y:188.25,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:49},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},38:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:201.95,y:188.7,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:50},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},39:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:207.55,y:189.1,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:51},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},40:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:213.2,y:189.55,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:52},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},41:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:218.8,y:189.95,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:53},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},42:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:224.4,y:190.35,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:54},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},43:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:230.05,y:190.8,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:55},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},44:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:235.65,y:191.2,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:56},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},45:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:241.25,y:191.65,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:57},2:{type:"shape",path:[255,227.8,235.55,2,227.8,180.8,2,227.8,180.8,1],elementID:86},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},46:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:246.85,y:192.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:58},2:{type:"bitmap",libName:"Bitmap 5",x:156.9,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:87},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},47:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:25},x:252.5,y:192.5,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:59},2:{type:"bitmap",libName:"Bitmap 6",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:88},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},48:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:258.1,y:192.9,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:60},2:{type:"bitmap",libName:"Bitmap 7",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:89},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},49:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:256.95,y:199.8,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:62},2:{type:"bitmap",libName:"Bitmap 8",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:90},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},50:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:255.4,y:206.65,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:63},2:{type:"bitmap",libName:"Bitmap 9",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:91},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},51:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:253.45,y:213.4,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:64},2:{type:"bitmap",libName:"Bitmap 10",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:92},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},52:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:251.1,y:220.05,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:65},2:{type:"bitmap",libName:"Bitmap 11",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:93},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},53:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:248.4,y:226.55,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:66},2:{type:"bitmap",libName:"Bitmap 12",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:94},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},54:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:245.3,y:232.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:67},2:{type:"bitmap",libName:"Bitmap 13",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:95},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},55:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:241.8,y:239,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:68},2:{type:"bitmap",libName:"Bitmap 14",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:96},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},56:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:238,y:244.95,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:69},2:{type:"bitmap",libName:"Bitmap 15",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:97},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},57:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:233.9,y:250.65,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:70},2:{type:"bitmap",libName:"Bitmap 16",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:98},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},58:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:229.45,y:256.1,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:71},2:{type:"bitmap",libName:"Bitmap 17",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:99},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},59:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:224.75,y:261.35,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:72},2:{type:"bitmap",libName:"Bitmap 18",x:127.75,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:100},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},60:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:219.8,y:266.35,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:73},2:{type:"bitmap",libName:"Bitmap 19",x:127.85,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:101},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},61:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:214.65,y:271.1,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:74},2:{type:"bitmap",libName:"Bitmap 20",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:102},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},62:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:209.25,y:275.6,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:75},2:{type:"bitmap",libName:"Bitmap 21",x:127.85,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:103},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},63:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:203.65,y:279.8,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:76},2:{type:"bitmap",libName:"Bitmap 22",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:104},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},64:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:197.85,y:283.65,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:77},2:{type:"bitmap",libName:"Bitmap 23",x:127.8,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:105},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},65:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:191.8,y:287.25,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:78},2:{type:"bitmap",libName:"Bitmap 24",x:127.85,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:106},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},66:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:185.55,y:290.45,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:79},2:{type:"bitmap",libName:"Bitmap 25",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:107},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},67:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:179.1,y:293.25,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:80},2:{type:"bitmap",libName:"Bitmap 26",x:127.85,y:173.3,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:108},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},68:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:172.5,y:295.7,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:81},2:{type:"bitmap",libName:"Bitmap 28",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:109},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},69:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:165.8,y:297.8,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:82},2:{type:"bitmap",libName:"Bitmap 29",x:127.85,y:173.25,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:110},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},70:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:61},x:158.95,y:299.45,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:83},2:{type:"bitmap",libName:"Bitmap 30",x:127.85,y:173.25,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:111},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},71:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},72:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},73:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},74:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},75:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},76:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},77:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},78:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},79:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},80:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},81:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},82:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},83:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},84:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},85:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},86:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},87:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},88:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},89:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},90:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},91:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},92:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},93:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},94:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},95:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},96:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},97:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},98:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},99:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},100:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},101:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},102:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},103:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},104:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},105:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},106:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},107:{0:{x:145.55,y:80.85,w:76.5,h:43.2,name:"",type:"text",r:0,txt:"拖动",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:22},1:{0:{type:"bitmap",libName:"Bitmap 4",x:-14.5,y:-16,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:85},x:152.05,y:300.85,name:"",type:"sprite",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:84},2:{type:"bitmap",libName:"Bitmap 31",x:127.85,y:173.35,r:0,sx:1,sy:1,skewX:0,skewY:0,elementID:112},3:{type:"shape",path:[255,144.9,161.05,156.75,172.05,173.15,172.05,3,173.15,172.05,190.45,172.05,202.65,159.8,3,202.65,159.8,214.9,147.6,214.9,130.3,3,214.9,130.3,214.9,113,202.65,100.75,3,202.65,100.75,190.45,88.55,173.15,88.55,3,173.15,88.55,156.75,88.55,144.9,99.5,3,144.9,99.5,144.25,100.1,143.6,100.75,3,143.6,100.75,131.4,113,131.4,130.3,3,131.4,130.3,131.4,147.6,143.6,159.8,3,143.6,159.8,144.25,160.45,144.9,161.05,3,.2980392156862745,16777215,33],elementID:113},4:{type:"bitmap",libName:"显微镜.png",x:21.7,y:29.85,r:0,sx:.83538818359375,sy:.83538818359375,skewX:0,skewY:0,elementID:114},5:{x:42.85,y:312.9,w:189,h:32,name:"",type:"text",r:0,txt:"操作提示",a:"center",f:"28px '凸版文久見出しゴシック エクストラボールド'",c:"#FFFFFF",elementID:115},6:{type:"shape",path:[255,32.35,264.15,2,340.35,264.15,360.35,264.15,360.35,244.15,3,360.35,244.15,2,360.35,18.15,360.35,-1.85,340.35,-1.85,3,340.35,-1.85,2,32.35,-1.85,12.35,-1.85,12.35,18.15,3,12.35,18.15,2,12.35,244.15,12.35,264.15,32.35,264.15,3,1,6710886,1.85,32,1,3223861,33],elementID:116},index:7},x:1650.95,y:955.7,name:"",type:"nbMovie",r:0,sx:1,sy:1,a:1,skewX:0,skewY:0,elementID:21}}).call(t,i(1))},function(e,t,i){"use strict";function r(){PIXI.Container.apply(this);var e=PIXI.Sprite.fromFrame("observe_close");this.addChild(e)}r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,e.exports=r},function(e,t,i){"use strict";function r(e){for(var t=e.split("\n"),i=[],r=0;r<t.length;r++)i[r]={},i[r].question=t[r].substring(t[r].indexOf("、")+1,t[r].lastIndexOf("？")+1),i[r].expend=!1,i[r].answer=t[r].substring(t[r].indexOf("[")+1,t[r].lastIndexOf("]"));return i}function n(e){var t=e.split("\n"),i=[];if(t.length>1)for(var r=0;r<t.length;r++)i[r]={},i[r].text=t[r].substring(t[r].indexOf("、")+1);else i[0]={},i[0].text=t[0].replace(/(^\s*)|(\s*$)/g,"");return i}var o={};o.getInfo=function(e){var t={"实验目的":"purpose","讨论":"conclusion","实验步骤":"experimentStep","实验器材":"equipment"},i={};i.headerTitle=e.info.title,i.principle=e.principle;for(var o=0;o<e.menu.length;o++){var s=e.menu[o];if(t[s.name])switch(s.name){case"实验目的":var a={};i[t[s.name]]=a,a.icon="./libs/framework/images/btn-shiyanmudi.png",a.name=s.name+"&nbsp;:",a.menu=n(s.params.text);break;case"讨论":var l={};i[t[s.name]]=l,l.icon="./libs/framework/images/btn-taolundian.png",l.name=s.name+"&nbsp;:",l.menu=r(s.params.text);break;case"材料用具":case"实验器材":var h={menu:[]};i[t[s.name]]=h,h.icon="./libs/framework/images/btn-shiyanqicai.png",h.name="材料用具&nbsp;:";var c="./courses/biology3027/res/images/";$.getJSON(c+"config.json",function(e){$.each(e,function(e,t){var i={};i.imgSrc=c+"/"+t.path+".png",i.name=t.name,h.menu.push(i)})});break;case"实验步骤":ex={},i[t[s.name]]=ex,ex.name=s.name,ex.goto=s.goto,ex.steps=[],ex.steps=s.items}}return i},e.exports=o},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=void 0,s=function(){function e(){r(this,e),this.html='\n        <div id="DNALoading" style="color:#EEE; width:80px; height:80px; left:0px; right:0px; top:0px; bottom:0px; position:absolute; margin:auto;">\n            <p style="    \n            position: inherit;\n            left: 42px;\n            top: 58px;"\n            ></p>\n        </div>';var t=this;this.count=0,this.total=0,$.getJSON(nb.config.URI_PREFIX+"assets/loadingFirst/DNA.json",function(e){o=e;var i=o.frames;for(var r in i)t.total++})}return n(e,[{key:"progress",value:function(e){var t=Math.round(100*e);0===t?this.progressValue="":100===t?this.hide():this.progressValue=t+"%"}},{key:"show",value:function(){if(this.element){if("block"===this.element.css("display"))return}else this.element=$(this.html),$("body").append(this.element),this.element=$(this.element),this.t=this.element.find("p");this.element.fadeIn(),clearInterval(this.intervalID),this.intervalID=setInterval(this.playAnimation.bind(this),40)}},{key:"hide",value:function(){this.element.fadeOut(),this.element.find("p").html("0%"),clearInterval(this.intervalID)}},{key:"playAnimation",value:function(){this.count=this.count%this.total;var e=this.count,t="f00"+(e<9?"0"+(e+1):e+1)+".png",i=nb.config.URI_PREFIX+"assets/loadingFirst/DNA.png",r=o.frames[t].frame,n=-r.x+"px",s=-r.y+"px";this.element.css("background","url("+i+") "+n+" "+s),this.t.html(this.progressValue),this.count++}}]),e}();e.exports=s},function(e,t,i){"use strict";function r(){var e=new PIXI.Container;return $(document.body).append("\n    <div class = 'model'></div>\n    "),$(document.body).append('\n    <div id="colPanel" ondragstart="return false">\n        <img src = \''+n+"'></img>\n        <p class = 'textCon'><p>\n    </div>"),e.setText=function(e){$(".textCon").html(e)},e.setTextAlign=function(e){$(".textCon").css({textAlign:e.textAlign||"center",paddingTop:e.paddingTop||"",lineHeight:e.lineHeight||"1.5rem"})},e}i(179),i(225);var n=i(227);e.exports=r},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,"@media (min-width: 320px){  \n    html{\n          font-size: 13px;\n      }\n  }  \n\n@media (min-width: 375px) {\n    html{\n        font-size: 14px;\n    }\n}\n\n@media (min-width: 550px){  \n    html{\n        font-size: 15px;\n    }\n}  \n\n\n@media (min-width: 768px){  \n    html{\n        font-size: 17px;\n    }\n}  \n\n@media (min-width: 960px){\n    html{\n        font-size: 20px;\n    }\n}\n\n@media (min-width: 1100px){\n    html{\n        font-size: 22px;\n    }\n}\n@media (min-width: 1200px){\n    html{\n        font-size: 24px;\n    }\n}\n@media (min-width: 1300px){\n    html{\n        font-size: 28px;\n    }\n}",""])},function(e,t,i){var r=i(226);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,"*{\n    margin: 0;\n    padding: 0;\n}\n#colPanel{\n    width: 25%;\n    min-width: 232px;\n    position: absolute;\n    left: 50%;\n    transform: translateY(-120%) translateX(-50%);\n    \n}\n\n#colPanel img{\n    width: 100%;\n}\n#colPanel .textCon{\n    color: #fff;\n    width: 80%;\n    height: 75%;\n    /* font-size: 28px; */\n    font-size: 1rem;\n    position: absolute;\n    /* padding: 80px 20px 10px 20px; */\n    /* padding: 2rem .5rem .25rem .5rem; */\n    left: 10%;\n    top: 25%;\n    box-sizing: border-box;\n    \n}\n.model{\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    background: rgb(0, 0, 0);\n    opacity: 0;\n    left:0;\n    top:0;\n    z-index: -1;\n}\n\n",""])},function(e,t,i){e.exports=i.p+"2557be032db3f2de0004b698277b87de.png"},function(e,t,i){"use strict";function r(){var e=new PIXI.Container,t=void 0;return $(document.body).append("\n    <div class = 'NBDown_tip'>\n        <img src = '"+n+"'></img>\n        <p class = 'tipText'><p>\n    </div>\n    "),e.setText=function(e){$(".NBDown_tip .tipText").html(e)},e.setTextAlign=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"center";$(".NBDown_tip .tipText").css({"text-align":e})},e.showTip=function(e){e&&$(".NBDown_tip .tipText").html(e),clearTimeout(t),$(".NBDown_tip").stop().animate({top:0},500,function(){clearTimeout(t),t=setTimeout(function(){$(".NBDown_tip").stop().animate({top:-115},500)},3e3)})},e.hideTip=function(){$(".NBDown_tip").stop().animate({top:-115},500,function(){})},e}i(179),i(229);var n=i(231);e.exports=r},function(e,t,i){var r=i(230);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,"div, p{\n    margin: 0;\n    padding: 0;\n}\n.NBDown_tip {\n    text-align: center;\n    position: absolute;\n    left: 50%;\n    top: -100%;\n    transform: translateX(-50%);\n    width: 40%;\n    min-width: 200px;\n}\n.NBDown_tip img {\n    width: 100%;\n}\n.NBDown_tip .tipText{\n    position: absolute;\n    color: #fff;\n    font-family: 'Microsoft Yahei';\n    font-size: 1rem;\n    text-align: center;\n    width:100%;\n    top: 50%;\n    transform: translateY(-70%);\n    /* line-height: 2rem; */\n    letter-spacing: 0.1em;\n}",""])},function(e,t,i){e.exports=i.p+"aa6a1cf968a0727f1ffc146735ddd3b3.png"},function(e,t,i){"use strict";function r(){var e=new PIXI.Container;return $(document.body).append("\n        <div class = 'tip'>\n            <img src = '"+n+"' class = 'img1' ondragstart = 'return false'></img>\n            <p class = 'tipText'><p>\n        </div>\n        "),e.setText=function(e){$(".tipText").html(e)},e.setTextAlign=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"center";$(".tipText").css({"text-align":e})},e.showTip=function(e){var t=void 0;e&&($(".tipText").html(e),t=e.length>10?10:5),TweenMax.to($(".tip"),.5,{top:-8,onComplete:function(){TweenMax.killTweensOf($(".tip")),TweenMax.to($(".tip"),.5,{top:-110,delay:t})}})},e.hideTip=function(){TweenMax.to($(".tip"),.5,{top:-110})},e.showORhide=function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?$(".tip").hide():$(".tip").show()},e.visibleHide=function(){$(".tip").css({display:"none"})},e}i(233);var n=i(236);e.exports=r},function(e,t,i){var r=i(234);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,".tip {\n    text-align: center;\n    position: absolute;\n    left: 50%;\n    /* top: -115px; */\n    top: -100%;\n    transform: translateX(-50%);\n    min-width: 200px;\n}\n.tip .img1 {\n    width: 100%;\n}\n.tip .tipText{\n    box-sizing: border-box;\n    white-space: nowrap;\n    position: absolute;\n    color: #fff;\n    font-family: 'Microsoft Yahei';\n    font-size: 1rem;\n    text-align: center;\n    top: 50%;\n    left: 50%;\n    /* transform: translateY(85%); */\n    transform: translate(-50%, -62%);\n    letter-spacing: 0.1em;\n    background: url("+i(235)+") 0 0 no-repeat;\n    /* background-position: 0.8rem  1.3rem; */\n    /* background-position: 5rem 0px; */\n    padding-left: 2em;\n    background-size:1em;\n\n}",""])},function(e,t,i){e.exports=i.p+"8825fac1f93df379cc01e5177efe9b2f.png"},function(e,t,i){e.exports=i.p+"cef1beb6ae7975d1deb9d0cf1effad9f.png"},function(e,t,i){"use strict";function r(e){if(void 0===e)throw"请传入type. 如: ConfigLoader.TYPE.PHY 代表物理";return s[e]?new Promise(function(t,i){t(s[e])}):new Promise(function(t,i){var r=new XMLHttpRequest;r.onreadystatechange=function(r){if(4===this.readyState)if(200===this.status){var a=JSON.parse(r.target.responseText);if(s[e]=a,a.loginAuth){try{a.loginAuth=o("aes128","17D2E2B6297FA",a.loginAuth)}catch(r){}a.authAction=a.authAction||{},a.auth=function(e){if(!(e=e||window.$))throw"请传入jquery, 调用方法 data.auth($)";return new Promise(function(t,i){e.ajax({url:a.loginAuth,jsonp:"jsoncallback",dataType:"jsonp",data:"pid="+a.pid,success:function(e){e.success?t(1!==parseInt(e.obj.vip)?!1:!0):i(e)},error:function(e){i({readyState:e.readyState,status:e.status})}})})},a.autoAuth=function(){a.auth().then(function(e){if(e)return e;var t;t="object"===n(a.authAction.notVip)?a.authAction.notVip.redirectURL:a.authAction.notVip,window.location.href=t||"http://www.nobook.com.cn/buy.html"}).catch(function(e){if(3018===e.errcode){var t;t="object"===n(a.authAction.notLogin)?a.authAction.notLogin.redirectURL:a.authAction.notLogin,window.location.href=(t||"https://passport.nobook.com/?return_url=")+encodeURIComponent(window.location.href)}return e})}}else a.auth=function(){throw"调用该方法之前需要在nbconfig/conf.json中加入loginAuth配置"};t(a)}else i()},r.open("GET","nbconfig/conf.json",!0),r.send()})}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=i(238).decrypt,s={},a={PHY:2,CHE:3,BIO_CZ:0,BIO_GZ:1,SCI:4,NB_PHY:20};window.nb&&(window.nb.ConfigLoader={loadConfig:r,TYPE:a}),e.exports={loadConfig:r,TYPE:a}},function(e,t,i){function r(e,t,i){var r="",n=o.createCipher(e,t);return r+=n.update(i,"binary","hex"),r+=n.final("hex")}function n(e,t,i){var r="",n=o.createDecipher(e,t);return r+=n.update(i,"hex","binary"),r+=n.final("binary")}const o=i(79);e.exports={encrypt:r,decrypt:n}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=document.createElement("div");e.setAttribute("class","nbScience_platform_backBtn"),e.innerHTML="<div class = 'nbScience_backBtn_img'></div>",$(document.body).append(e),window.onmessage=function(t){var i=t.data;if(i){if("science.message.update.button.styles"===i.type){var r=i.styles;r&&!$.isEmptyObject(r)&&$(e).css(r)}}},$(e).off(".exit.fullscreen").on("click.exit.fullscreen",function(e){try{window.parent.parent.postMessage({type:"science.message.click.button"},"*")}catch(e){console.warn("top is not find...")}}),$(document).ready(function(){console.log("readyhahahh-----");try{window.parent.parent.postMessage({type:"science.message.lab.onload"},"*")}catch(e){console.warn("top is not find...")}})},i(240)},function(e,t,i){var r=i(241);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,".nbScience_platform_backBtn {\n    width: 70px;\n    height: 70px;\n    position: absolute;\n    z-index: 1000;\n    left: 20px;\n    bottom: 20px;\n    visibility: hidden;\n}\n.nbScience_platform_backBtn .nbScience_backBtn_img {\n    width: 100%;\n    height: 100%;\n    background-image: url("+i(180)+");\n    background-repeat: no-repeat;\n    background-position: -71px, 0px;\n    /* transition: all .2s; */\n}\n.nbScience_platform_backBtn .nbScience_backBtn_img:hover {\n    background-image: url("+i(180)+");\n    background-position: 0px, 0px;\n}",""])},function(e,t,i){"use strict";function r(){PIXI.Container.call(this);var e=new PIXI.Graphics;e.beginFill(16711680,1),e.drawRect(0,0,5,5),TweenMax.to(e,1,{rotation:2*Math.PI,repeat:-1}),this.addChild(e)}r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.destory=function(){this.parent.removeChild(this),TweenMax.killTweensOf(this.loading)},e.exports=r},function(e,t,i){"use strict";(function(t){nb.eyepiece=function(e){function r(){var e=new PIXI.Point;return e.x=T/(80/m[C._config.mult]),e.y=E/(80/m[C._config.mult]),e}function n(){function i(e){var t=C._config.mult;if(e){t=e.target.multValue}var i=!0,r=!1,n=void 0;try{for(var o,s=K[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=a.icon,h=a.bg;h.clear(),t===a.multValue?(h.beginFill(299767,1),h.drawRoundedRect(0,0,W,W,8),l.alpha=1):(h.beginFill(16777215,.4),h.drawRoundedRect(0,0,W,W,8),l.alpha=.5)}}catch(e){r=!0,n=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw n}}E.text.text=m[t]+"×",E.text.x=(T.width-E.text.width)/2,t!==C._config.mult&&C.update({mult:t})}function n(){if(C.emit("startGoback"),C.state=b.MIDDLE,f.removeEventListener(TouchEvent.TAP,n),w.removeEventListener("mapMove",s),K&&K.length){var e=!0,t=!1,r=void 0;try{for(var c,u=K[Symbol.iterator]();!(e=(c=u.next()).done);e=!0){c.value.removeEventListener(TouchEvent.TAP,i)}}catch(e){t=!0,r=e}finally{try{!e&&u.return&&u.return()}finally{if(t)throw r}}}j&&GlobalEffect.fadeOut(j),M&&(M.removeEventListener(TouchEvent.TOUCH_BEGIN,a),M.removeEventListener(TouchEvent.TOUCH_MOVE,l),M.removeEventListener(TouchEvent.TOUCH_END,h),M.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,h)),E.parent.removeChild(E),GlobalEffect.fadeOut(f);var d=new TimelineMax({onComplete:o});d.add([TweenMax.to(F.scale,1.5,{x:0,y:0,ease:Sine.easeInOut}),TweenMax.to(R,.8,{alpha:0,ease:Sine.easeInOut})]);var p=[O,k];d.to(p,.5,{alpha:1,ease:Sine.easeInOut,onStart:function(){F.x=0,F.y=0,F.scale.x=1,F.scale.y=1,L.x=O.width/2,L.y=O.height/2,C.addChild(F),O.addChild(L),P.fadeIn()},onComplete:function(){nb.commonFunc.setArg(p,"interactive",!0),C.emit("goback")}})}function s(){if(x.length){var e=r(),t=w.pivot.x-e.x,i=w.pivot.y-e.y,n=80*i/(S*m[C._config.mult]),o=80*t/(S*m[C._config.mult]);Object.assign(C._config,{offsetX:n,offsetY:o}),B&&TweenMax.to(B,g,{x:A.x+o*y,y:A.y+n*y})}}C.emit("gotoLarge"),C.state=b.LARGE,w.addEventListener("mapMove",s);var c=PIXI.Sprite.fromFrame("backButton"),f=new PIXI.Container;f.pivot.x=c.width/2,f.pivot.y=c.height/2,f.addChild(c),f.alpha=0,e.addChild(f),f.x=d-c.width,f.y=p-c.height,f.scale.set(.5,.5),TweenMax.to(f,.5,{alpha:1}),f.addEventListener(TouchEvent.TAP,n);var T=PIXI.Sprite.fromFrame("win"),E=new PIXI.Container;E.addChild(T),e.addChild(E),E.x=-500,E.y=200;var A={x:-v/2+T.width/2,y:-v/2+T.height/2-25},D={x:T.width/2,y:T.height/2-22},I=new PIXI.Text(m[C._config.mult]+"×",{font:"bold 28pt Microsoft YaHei",fill:16777215,align:"center"});I.x=(T.width-I.width)/2,I.y=D.y+110,E.addChild(I),E.text=I;var B=null,N=new PIXI.Graphics;N.beginFill(),N.fillColor=16711680,N.drawRect(-140,-100,280,200),N.x=D.x,N.y=D.y,E.addChild(N);var V=!1;if(x.length){V=!0;var U=nb.config.MODEL_URI_PREFIX+"slides_new/"+x+"/sl.png",z=PIXI.Texture.fromImage(U);B=new PIXI.Sprite(z),B.x=A.x+C._config.offsetY*y,B.y=A.y+C._config.offsetX*y}else M&&M._slideConfig.smallMap&&(V=!0,B=M._slideConfig.smallMap,u(),B.visible=!1);if(V){E.visible=!0,E.addChild(B),B.mask=N;var G=new PIXI.Graphics;G.beginFill(16777215,0),G.lineStyle(3,16711680,.8),G.drawRect(-_/2,-_/2,_,_),G.x=D.x,G.y=D.y,E.addChild(G),t.hh=G}else E.visible=!1;if(x.length||M&&-1!==M._slideConfig.mult){var H=PIXI.Sprite.fromFrame("btnGroupBg"),j=new PIXI.Container;j.addChild(H),e.addChild(j),j.x=f.x-j.width,j.y=f.y-j.height/4,j.scale.set(.5,.5);for(var W=48,X=(H.width-3*W)/4,Y=(H.height-W)/2-20,K=[],q=0;q<3;q++){var Q=new PIXI.Container,Z=new PIXI.Graphics;Z.beginFill(299767,1),Z.drawRoundedRect(0,0,W,W,8),Q.x=X*(q+1)+W*q,Q.y=Y,j.addChild(Q),Q.addChild(Z),Q.bg=Z;var J=m[q],$=PIXI.Sprite.fromFrame("icon_"+J+"x_selected.png"),ee=new PIXI.Container;ee.x=(W-$.width)/2,ee.y=(W-$.height)/2,ee.addChild($),Q.addChild(ee),Q.icon=ee;var te=new PIXI.Text(J+"×",{font:"bold 15pt Microsoft YaHei",fill:16777215,align:"center"});te.x=(W-te.width)/2,te.y=W+5,Q.addChild(te),Q.text=te,Q.multValue=q,K.push(Q),Q.addEventListener(TouchEvent.TAP,i)}i()}}function o(){C.state=b.SMALL,w.interactive=!1}function s(e,t){M=e,M._slideConfig=Object.assign({mult:-1,smallMap:null,fouceSize:50},t),B.removeChild(w),B.addChild(e),e.x=0,e.y=0,e.visible=!0,t.smallMap&&(e.addEventListener(TouchEvent.TOUCH_BEGIN,a),e.addEventListener(TouchEvent.TOUCH_MOVE,l),e.addEventListener(TouchEvent.TOUCH_END,h),e.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,h)),-1!==M._slideConfig.mult&&C.update({mult:C._config.mult})}function a(e){M.__touchPoint=Object.assign({},e.data.global),console.log("start")}function l(e){if(M.__touchPoint){var t=e.data.global,i=t.x-M.__touchPoint.x,r=t.y-M.__touchPoint.y;M.__touchPoint=Object.assign({},t),console.log({dx:i,dy:r});var n=M,o=n.width,s=n.height,a=Math.max(o,s)/2;console.log({width:o,height:s});var l=C._config.offsetX-r/a,h=C._config.offsetY-i/a;console.log({offsetX:l,offsetY:h}),C.update({offsetX:l,offsetY:h}),u()}}function h(){M.__touchPoint=null,console.log("end")}function c(e){if(!(M._slideConfig.mult<0)){var t=m[e],i=m[M._slideConfig.mult],r=t/i;M.scale.x=r,M.scale.y=r}}function u(){var e=M._slideConfig,t=e.fouceSize,i=e.smallMap;i.x=155+t*C._config.offsetY,i.y=130+t*C._config.offsetX}var f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=nb.canvasWidth,p=nb.canvasHeight,m=[4,10,40],g=.3,v=618,y=50,_=30,b={SMALL:"small",MIDDLE:"middle",LARGE:"large"},x="",T=0,E=0,S=0,w=new nb.mapViewer,M=null,A=$(".player-controls")[0];A&&A.setAttribute("style","display: none");var P=$("#nb-biology-op-id"),C=new PIXI.Container;C._config={rotation:0,offsetX:0,offsetY:0,brightness:1,blur:0,mult:0},C.state=b.SMALL;var R=new PIXI.Graphics;R.beginFill(),R.fillColor=0,R.drawRect(-d,-p,3*d,3*p),e.addChild(R),C.bgb=R,R.alpha=0;var D=d-97.5-200;Object.assign(C,{x:D,y:97.5}),e.pivot.set(d/2,p/2),e.x=d/2,e.y=p/2,e.addChild(C),C.scale.set(.5,.5),Object.assign(C._config,f);var I=PIXI.Sprite.fromFrame("ocular"),O=new PIXI.Container;O.pivot.x=I.width/2,O.pivot.y=I.height/2,O.addChild(I),C.addChild(O);var F=new PIXI.Graphics;F.beginFill(),F.fillColor=10027008,F.drawCircle(0,-4,97.5),C.addChild(F),C.inner=F;var L=new PIXI.Container;L.x=O.width/2,L.y=O.height/2,L.mask=F,O.addChild(L),C.sl=L;var B=new PIXI.Graphics;B.beginFill(),B.fillColor=15134719,B.drawRect(1.5*-d,1.5*-p,3*d,3*p),L.addChild(B),L.bgw=B,B.addChild(w),w.init(),w.interactive=!1,w.changeCenterObj({x:0,y:0},B),w.update();var N=PIXI.Sprite.fromFrame("button"),k=new PIXI.Container;k.pivot.x=N.width/2,k.pivot.y=N.height/3,k.addChild(N),e.addChild(k),k.x=d-97.5-200,k.y=195,k.scale.set(.5,.5);var V=new PIXI.Text("自动调至最佳",{fontFamily:"Microsoft YaHei",fontSize:28,fill:16777215,align:"center"});V.x=N.width/2-84+2,V.y=N.height/3-14+2,k.addChild(V),k.addEventListener(TouchEvent.TAP,function(t){C.emit("optimum",t),e.emit("autoBtn")}),F.addEventListener(TouchEvent.TAP,function(){if(e.emit("last"),P.hide(),b.SMALL===C.state){C.state=b.MIDDLE;var t=[O,k];nb.commonFunc.setArg(t,"interactive",!1),TweenMax.to(t,.5,{alpha:0,ease:Sine.easeInOut,onComplete:function(){C.emit("observeslide")}})}}),C.changeState=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.updateTransform();var i=e.worldTransform,r=Object.assign({x:d/2+i.tx,y:p/2},t);e.addChild(F),L.alpha=0,e.addChild(L),F.x=L.x=r.x-i.tx,F.y=L.y=r.y-i.ty,F.scale.x=F.scale.y=.01;var o=new TimelineMax({onComplete:function(){w.interactive=!0,n()}});TweenMax.to(R,.8,{alpha:1,ease:Sine.easeInOut}),C._config.brightness&&o.add(TweenMax.to(L,.6,{alpha:C._config.brightness,ease:Sine.easeInOut})),o.add(TweenMax.to(F.scale,1.5,{x:25,y:25,ease:Sine.easeInOut}))},C.update=function(e){if(e){if(Object.assign(C._config,e),TweenMax.killTweensOf(C),void 0!==e.rotation&&(C.rotation=C._config.rotation),void 0!==e.brightness&&(e.brightness>=1?C._config.brightness=1:e.brightness<=0&&(C._config.brightness=0),TweenMax.killTweensOf(C.sl),TweenMax.to(C.sl,g,{alpha:C._config.brightness})),void 0!==e.blur){e.blur<0?C._config.blur=0:e.blur>1&&(C._config.blur=1);var t=1;if(0===e.blur)L.children[0].filters=null;else{var i=new PIXI.filters.BlurFilter;L.children[0].filters=[i],i.blur=20*C._config.blur,t=Math.sqrt(1-e.blur)}if(!w.visible)return;var n=M||w;TweenMax.killTweensOf(n),TweenMax.to(n,g,{alpha:.7*t})}if(void 0!==e.mult){if(C._config.mult=Math.round(C._config.mult),C._config.mult<0?C._config.mult=0:C._config.mult>2&&(C._config.mult=2),M)return void c(C._config.mult);if(!w.visible)return;x.length&&w.changeMult(C._config.mult+1)}if(x.length&&w&&(void 0!==e.offsetX||void 0!==e.offsetY)){var o=r();if(TweenMax.killTweensOf(w.pivot),void 0!==e.offsetX){var s=e.offsetX*S*m[C._config.mult]/80;TweenMax.to(w.pivot,g,{y:o.y+s,onComplete:function(){w.updatePivot(),w.update()}})}if(void 0!==e.offsetY){var a=e.offsetY*S*m[C._config.mult]/80;TweenMax.to(w.pivot,g,{x:o.x+a,onComplete:function(){w.updatePivot(),w.update()}})}}else if(M){var l=M,h=l.width,u=l.height,f=Math.max(h,u)/2;void 0!==e.offsetX&&(M.pivot.y=f*e.offsetX/M.scale.y),void 0!==e.offsetY&&(M.pivot.x=f*e.offsetY/M.scale.x)}w.visible&&w.update&&w.update()}};var U=i(244);return C.changeSlides=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(C.removeSlides(),"string"!=typeof e)s(e,t);else{var i=U.default[e];if(!i)return void console.error(e+"装片不存在");T=i.width,E=i.height,S=Math.max(T,E),x=e,w.changeSlide(e,T,E)}C.update(Object.assign({offsetX:0,offsetY:0,mult:C._config.mult},t)),w.visible=!0},C.removeSlides=function(){M&&(M.parent.removeChild(M),M.scale={x:1,y:1},M.pivot={x:1,y:1},M.alpha=1,M.filters=null,M=null),w.visible=!1},C.hide=function(e){C.visible=!1,k.visible=!1,1===e&&(C.visible=!0)},C.show=function(e){C.visible=!0,k.visible=!0,1===e&&(C.visible=!1)},C.changeStep=function(t){e=t,nb.commonFunc.setArg(e.children,"visible",!1),e.addChild(R),e.addChild(C),e.addChild(k)},C.setInteractive=function(e){var t=!!e;C.interactive=t,k.interactive=t,F.interactive=t},C.update(C._config),window.vision=C,C},e.exports=nb.eyepiece}).call(t,i(1))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={sl0001:{width:12176,height:18281},sl0002:{width:32100,height:33203},sl0003:{width:9648,height:18202},sl0007:{width:22856,height:17718},sl0011:{width:12348,height:37155},sl0012:{width:17448,height:13524},sl0013:{width:16276,height:16256},sl0017:{width:15700,height:15983},sl0018:{width:42372,height:34229},sl0019:{width:42308,height:12537},sl0020:{width:30296,height:21851},sl0022:{width:22480,height:21544},sl0023:{width:26180,height:30196},sl0024:{width:30116,height:44779},sl0025:{width:31372,height:27354},sl0026:{width:15008,height:21259},sl0027:{width:8484,height:7181},sl0028:{width:21764,height:16052},sl0030:{width:30564,height:14104},sl0031:{width:43580,height:35670},sl0032:{width:13036,height:13853},sl0035:{width:10604,height:10138},sl0038:{width:10440,height:28106},sl0040:{width:13148,height:15208},sl0041:{width:11944,height:12198},sl0042:{width:9912,height:9010},sl0043:{width:18148,height:14956},sl0044:{width:22480,height:20277},sl0045:{width:24036,height:15513},sl0048:{width:9756,height:6759},sl0049:{width:8056,height:7181},sl0050:{width:26964,height:8852},sl0053:{width:26912,height:23762},sl0054:{width:42464,height:22005},sl0055:{width:41984,height:30412},sl0057:{width:18456,height:17867},sl0058:{width:5088,height:5914},sl0059:{width:4240,height:3802},sl0060:{width:24076,height:15217},sl0061:{width:17332,height:17028},sl0062:{width:38984,height:30462},sl0063:{width:26288,height:11776},sl0064:{width:21208,height:17320},sl0065:{width:20464,height:20169},sl0077:{width:4184,height:4184},sl0078:{width:4773,height:4773},sl0079:{width:4773,height:4773},sl0080:{width:4773,height:4773},sl0081:{width:4773,height:4734},sl0082:{width:4773,height:4734},sl0083:{width:4773,height:4734},sl0085:{width:15268,height:12673},sl0086:{width:47524,height:42322},sl0088:{width:9170,height:41384}};t.default=r},function(e,t,i){"use strict";function r(e,t){var i=n.random(1,1)*o,r=Math.abs(Math.atan2(e.y-t.y,e.x-t.x)%i);return r>i/2&&(r=i-r),Math.random()>.5&&(r*=-1),r}var n=i(82),o=Math.PI/4,s=Math.PI/4,a={};a.fadeIn=function(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t=t.concat(a.fadeIn(e))}),t}return e.visible=!1,e.alpha=0,e.scale.x=e.scale.y=.85,[TweenMax.to(e,.8,{alpha:1,onStart:function(){e.visible=!0}}),TweenMax.to(e.scale,.8,{x:1,y:1})]},a.fadeOut=function(e){if(e instanceof Array){var t=[];return e.forEach(function(e){t.push(a.fadeOut(e))}),t}return e.visible=!0,TweenMax.to(e,.8,{alpha:0,onComplete:function(){e.parent&&e.parent.removeChild(e)}})},a.shake=function(e,t){return t=t||{},TweenMax.to(e,.05,{x:"+= "+(10*(+Math.random()-.5)+4),y:"+= "+(10*(+Math.random()-.5)+4),repeat:t.repeat||50,delay:.1,ease:Expo.easeInOut})},a.stir=function(e,t){var i=t||{repeat:6,radius:20};return TweenMax.to(e,.5,{x:"+="+i.radius,yoyo:!0,repeat:i.repeat,ease:Sine.easeInOut})},a.bezierFrom=function(e,t,i){i=i||{};var a=i.angle||s;a*=r(e,i)/o;var l=n.rotaPoint(i,e,a);l.x-=e.x,l.y-=e.y,l=n.normalize(l);var h=n.distance(i,e)/(2*Math.cos(a))*.95;l.x*=h,l.y*=h,l.x+=e.x,l.y+=e.y;var c,u=[{x:e.x,y:e.y},l,{x:i.x,y:i.y}];return c=isNaN(l.x)?{}:{bezier:{type:"thru",values:u},ease:Power2.easeInOut},delete i.x,delete i.y,TweenMax.from(e,t,Object.assign(c,i))},a.bezierTo=function(e,t,i){i=i||{};var a=i.angle||s;a*=r(e,i)/o;var l=n.rotaPoint(i,e,a);l.x-=e.x,l.y-=e.y,l=n.normalize(l);var h=n.distance(i,e)/(2*Math.cos(a))*.95;l.x*=h,l.y*=h,l.x+=e.x,l.y+=e.y;var c,u=[{x:e.x,y:e.y},l,{x:i.x,y:i.y}];return c=isNaN(l.x)?{}:{bezier:{type:"quadratic",values:u}},delete i.x,delete i.y,TweenMax.to(e,t,Object.assign(c,i))},a.dumpLiquids=function(e,t){var i=e.rotation,r=[];t=t*Math.PI/180;var n=(t-i)/3;return r[0]=TweenMax.to(e,1,{rotation:e.rotation+n,ease:Quad.easeIn}),r[1]=TweenMax.to(e,1.5,{rotation:e.rotation+n,delay:1}),r[2]=TweenMax.to(e,1,{rotation:e.rotation+n,ease:Quad.easeOut,delay:2.5}),r},e.exports=a},function(e,t,i){"use strict";var r=function(){function e(){if(r._auto_&&!r.drag.isDragging){var e=i-t;"vertical"===n?(r.drag.y+=r._speed_,r.drag.y>e&&(r.drag.y=e)):(r.drag.x+=r._speed_,r.drag.x>e&&(r.drag.x=e)),h()}}for(var t,i,r=this,n=this.a0.x===this.a1.x?"vertical":"horizontal",o=0,s=0;s<int.MAX_VALUE;s++){var a=this["a"+s];if(void 0===a){i="vertical"===n?this["a"+(s-1)].y:this["a"+(s-1)].x,o=s;break}0===s&&(t="vertical"===n?a.y:a.x),a.addEventListener(TouchEvent.TAP,function(){"vertical"===n?TweenMax.to(r.drag,.5,{y:this.y,onUpdate:h,onComplete:c}):TweenMax.to(r.drag,.5,{x:this.x,onUpdate:h,onComplete:c})})}var l;l="vertical"==n?{x:this.drag.x,y:this.drag.y,width:0,height:i}:{x:this.drag.x,y:this.drag.y,width:i,height:0},NBDrag.addDrag(r.drag,l),r.drag.addEventListener(NBDrag.event.STOP_DRAG,function(){if(!1!==r._align_){var e=o-1;if("vertical"===n){var s=Math.round((this.y-t)/(i-t)*e);s<0&&(s=0),TweenMax.to(this,.5,{y:s*(i-t)/e,onUpdate:h,onComplete:c})}else{var s=Math.round((this.x-t)/(i-t)*e);s<0&&(s=0),TweenMax.to(this,.5,{x:s*(i-t)/e,onUpdate:h,onComplete:c})}}}),r.drag.addEventListener(NBDrag.event.DRAG_MOVE,function(){h()});var h=function(){if("vertical"===n){var e=(r.drag.y-t)/(i-t);r.emit("change",{time:e})}else{var e=(r.drag.x-t)/(i-t);r.emit("change",{time:e})}},c=function(){var e=o-1;if("vertical"===n){var s=(r.drag.y-t)/(i-t),a=Math.round(s*e);r.emit("change",{index:a,time:s})}else{var s=(r.drag.x-t)/(i-t),a=Math.round(s*e);r.emit("change",{index:a,time:s})}};this.getNodeCount=function(){return o};var u=new PIXI.ticker.Ticker;u.add(e),u.start(),this.destory=function(){u.remove(e)},this.setAutoPlay=function(e,t){this._auto_=e,this._speed_=t||.1},this.setAutoAlign=function(e){this._align_=e},this.setMomentsPause=function(e,t,i){function r(r){if("drag"==r.target.name){if("vertical"===n&&l-5<=r.target.y&&l+5>=r.target.y)return;if("horizontal"===n&&h-5<=r.target.x&&h+5>=r.target.x)return}e&&(clearTimeout(s),this.parent.setAutoPlay(!1,i),s=setTimeout(function(){a.setAutoPlay(!0,i)},t))}var s,a=this;if("vertical"===n)var l;else var h;this.drag.addEventListener(TouchEvent.TOUCH_BEGIN,function(e){"vertacal"===n?l=e.target.y:h=e.target.x});for(var c=0;c<o;c++)this["a"+c].removeEventListener(TouchEvent.TAP,r),this["a"+c].addEventListener(TouchEvent.TAP,r);this.drag.removeListener(NBDrag.event.STOP_DRAG,r),this.drag.addEventListener(NBDrag.event.STOP_DRAG,r)}};e.exports=r},function(e,t,i){"use strict";function r(e){function t(){var e=instance.renderer.view;i.x=e.width-nb.stackPosX-(e.width-nb.canvasWidth)/2-h,i.y=nb.stem.STEMMain.H-l>>1}PIXI.Sprite.call(this);for(var i=this,r=new PIXI.Sprite,n=function(e){var t=instance.stage;r.texture=this.texture;var i=this.toGlobal({x:0,y:0});t.addChild(r),r.x=i.x,r.y=i.y,r.alpha=.5,NBDrag.addDrag(r),r.emit(TouchEvent.TOUCH_BEGIN,e),this.addEventListener(TouchEvent.TOUCH_END,o),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,o)},o=function e(t){this.removeEventListener(TouchEvent.TOUCH_END,e),this.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,e);var n=i.getRoot().getHitObject3D(r);r.parent&&r.parent.removeChild(r),n.object&&(n.type="hit",n.object.dispatchEvent(n))},s=0;s<e.length;s++){var a=new PIXI.Sprite.fromFrame(e[s].texture);a.width=128,a.width=128,a.addEventListener(TouchEvent.TOUCH_BEGIN,n),this.addChild(a)}var l=500,h=300,c=new PIXI.Graphics;c.lineStyle(3,10066329,1),c.beginFill(15658734,.2),c.drawRect(0,0,h,l),this.addChild(c),t(),window.addEventListener("resize",t),this.getRoot=function(){return this.parent.stepRoot}}r.KNIFE={texture:"ToolsMenu.KNIFE"},r.SCALPEL={texture:"ToolsMenu.SCALPEL"},r.prototype=Object.create(PIXI.Sprite.prototype),r.constructor=r,r.prototype.addTool=function(e){},r.prototype.removeTool=function(e){},e.exports=r},function(e,t,i){"use strict";var r=window.nb;r.MovieClip=function(){var e=0;this.animationSpeed=1;var t=r.MovieClip.ticker;this.totalFrames=0,this._currentTime=0,this.loop=!0,this.playing=!1,this.play=function(e){if(void 0!==e)return void TweenMax.to(this,this.totalFrames/60,{ease:Linear.easeNone,currentFrame:this.totalFrames,repeat:e});this.playing||(this.playing=!0,t.add(this.update,this))},this.stop=function(){this.playing&&(t.remove(this.update,this),this.playing=!1)},this.update=function(){if(this.__end__)return this.__end__=!1,this.__gotoAndStop__(0),void(this.__decimal__=0);this.__floor__=e+this.animationSpeed+(this.__decimal__||0);var t=Math.floor(this.__floor__);this.__decimal__=this.__floor__%1,t<0?this.loop?this.__gotoAndStop__(t):(this.__gotoAndStop__(0),this.onComplete&&this.onComplete()):t<=this.totalFrames-1?(this.loop?this.__gotoAndStop__(t):(this.__gotoAndStop__(t),t===this.totalFrames-1&&this.stop()),t===this.totalFrames-1&&(this.onComplete&&this.onComplete(),this.loop&&this.__decimal__+this.animationSpeed>=1&&(this.__end__=!0))):t>this.totalFrames-1&&(this.__gotoAndStop__(this.totalFrames-1),this.onComplete&&this.onComplete(),!1===this.loop&&this.stop())},this.insertDisplayObjectToFrame=function(e,t,i){void 0===this[t]&&(this[t]=[],t>=this.totalFrames&&(this.totalFrames=t+1)),this[t].push({dis:e,tweenTransform:i}),e.visible=!1},this.gotoAndStop=function(e){e=Math.round(e),this._currentTime=e,this.stop(),this.__gotoAndStop__(e)},this.gotoAndPlay=function(e){e=Math.round(e),this._currentTime=e,this.gotoAndStop(e),this.play()},this.__gotoAndStop__=function(t){var i,r;if(-1!==e&&void 0!==(i=this[e]))for(r=0;r<i.length;r++)i[r].dis.visible=!1;if(t>=this.totalFrames&&(t=this.totalFrames-1),e=t,void 0!==(i=this[t]))for(r=0;r<i.length;r++){var n=i[r].dis;if(n.visible=!0,n.parent&&(n.parent.addChildAt(n,0),i[r].tweenTransform)){var o=i[r].tweenTransform;0!=o.r?n.setTransform(o.x,o.y,o.sx,o.sy,o.r):n.setTransform(o.x,o.y,o.sx,o.sy,0,o.skewX,o.skewY)}}this.updateTransform()},this.stop=function(){this.playing&&(this.playing=!1,t.remove(this.update,this))},Object.defineProperty(this,"currentFrame",{get:function(){return e},set:function(e){this.gotoAndStop(Math.floor(e))}});var i=!1;Object.defineProperty(this,"reverse",{get:function(){return i},set:function(t){if(i!==t){-1!==e&&this.__gotoAndStop__(this.totalFrames-1-e);for(var r=Math.floor(this.totalFrames/2),n=0;n<r;n++){var o=this[n];this[n]=this[this.totalFrames-1-n],this[this.totalFrames-1-n]=o}i=t}}}),this.clone=function(){var e=instance.createChildFromData(this.parent,this._nbData_);return this.name&&""!==this.name&&(this.parent[this.name]=this),delete this.name,e}},r.MovieClip.ticker=new PIXI.ticker.Ticker,r.MovieClip.ticker.start(),e.exports=r.MovieClip},function(e,t,i){"use strict";(function(t){var i=t.nb;i.iconList=function(){function e(e){TweenMax.to(e,.5,{y:100*e.indexNum})}for(var t=this,i=[],r=[],n=0;n<1e4;n++)t["item"+n]&&(i.push(t["item"+n]),r.push(t["item"+n]));t.allList=i,t.showList=r,t.getNum=function(){for(var e=0;e<r.length;e++)r[e].indexNum=e},t.getNum();for(var n=0;n<i.length;n++)i[n].rm=function(){var e=this;r.splice(e.indexNum,1),t.getNum(),e.hide({time:.5,callback:function(){t.sortList(!0)}})},i[n].addTo=function(e){var i=this;if(e||0===e){var e=e;r.splice(e,0,i)}else r.push(i);t.getNum(),i.show({time:.5}),t.sortList(!0)};t.sortList=function(t){for(var i=0;i<r.length;i++)t?e(r[i]):r[i].y=100*r[i].indexNum}},e.exports=i.iconList}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.clock=function(){var e=0,t=!1;this.txt.text="00:00:00",this.render=function(i,r,n){if(!t){void 0===i&&(i=1/60),r=r||1;for(var o=0;o<r;o++){e+=i,void 0!=n&&e>=n&&(e=n,t=!0);var s=Math.floor(e/60);s=s<10?"0"+s:s;var a=Math.floor(e%60);a=a<10?"0"+a:a;var l=Math.floor(e%1*100);l=l<10?"0"+l:l,this.txt.text=s+":"+a+":"+l}}},this.reset=function(){e=0,t=!1,this.txt.text="00:00:00"},this.pause=function(){t=!0},this.resume=function(){t=!1}},e.exports=i.clock}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r=t.nb,n=i(41);r.matches=function(){function e(){i.visible=!1,t.putFire()}SoundManager.register({src:n.config.URI_PREFIX+"assets/sounds/match.mp3",id:"0010/match"});var t=this,i=this.parent.match;i.visible=!1,NBDrag.addDrag(i);var r=null;this.addEventListener(TouchEvent.TOUCH_BEGIN,function(e){var t=this.getBounds();i.visible=!0,i.alpha=1,i.x=this.x-(t.x-e.data.global.x)-100,i.y=this.y-(t.y-e.data.global.y),null==r&&(r=ParticleUtil.getParticle(ParticleUtil.particles.match_fire),r.alpha=.4,this.stepRoot.addChild(r),r.bind(i,0,50)),r.visible=!0,TouchEvent.simulateTouchDown(i,e),i.sound=SoundManager.play("0010/match")}),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,function(t){e()}),i.addEventListener(NBDrag.event.STOP_DRAG,function(t){e()}),this.render=function(){1==i.visible&&r&&r.render()};var o=[];this.addSpiritLamp=function(e){-1==o.indexOf(e)&&o.push(e)},i.addEventListener(TouchEvent.TOUCH_MOVE,function(e){this.parent&&this.parent.spiritLamp&&this.fireArea.hitTest(this.parent.spiritLamp.head)&&this.parent.spiritLamp.lightFire();for(var t=0;t<o.length;t++){var i=o[t];this.parent&&i&&this.fireArea.hitTest(i.head)&&i.lightFire()}}),this.putFire=function(){null!=r&&(r.visible=!1,r.destroy(),r=null),i.sound&&(i.sound.stop(),i.sound=null)},this.hideMatch=e,this.isBurning=function(){return null!=r}},e.exports=r.matches}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.box2dSwitchComponent=function(e){var t=0;e&&(t=e.type||0);for(var i=[],r=0;r<this.timeline.getNodeCount();r++){var n=this["step"+r];i.push(n),n.alpha=0,n.visible=!1}var o=this.step0;o.visible=!0,o.alpha=1;var s=0;this.timeline.on("change",function(e){if(0==t){if(void 0!==e.index&&e.index!=s){var r;r=e.index>s?1200:-1200,TweenMax.to(o,.6,{x:r,alpha:0,onComplete:function(e){e.visible=!1},onCompleteParams:[o],ease:Expo.easeOut}),s=e.index,o=i[s],o.visible=!0,o.x=-r,TweenMax.to(o,1,{x:0,alpha:1,ease:Expo.easeOut})}}else if(1==t&&void 0!==e.index&&e.index!=s){var r;r=e.index>s?1200:-1200,o.x=r,o.alpha=0,o.visible=!1,s=e.index,o=i[s],o.visible=!0,o.x=-r,o.x=0,o.alpha=1}}),this.onUpdate=function(){o.onUpdate&&o.onUpdate()}},e.exports=i.box2dSwitchComponent}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.drawPicture=function(e,t){function r(e){if(a.ref.addEventListener(TouchEvent.TOUCH_MOVE,s),(!a.pen||0!=a.pen.currentFrame)&&0==l){b=[];var i=new PIXI.Graphics;a.addChild(i);for(var r=0;r<t;r++)a.addChild(a["w"+r]);_.push(i),i.lineStyle(h,a.drawColor,c);var o=a.toLocal({x:e.data.global.x,y:e.data.global.y});v=o.x,y=o.y,a.ref.addEventListener(TouchEvent.TOUCH_MOVE,n)}}function n(e){var t=a.toLocal({x:e.data.global.x,y:e.data.global.y}),i=_.length-1;_[i].moveTo(v,y),_[i].lineTo(t.x,t.y),b.push({x:e.data.global.x,y:e.data.global.y}),_[i].bounds=b,v=t.x,y=t.y}function o(){for(var e=0;e<_.length;e++)_[e].clear(),_.splice(e,1),e--;a.pen.currentFrame=0}function s(e){if(1==l)for(var t=0;t<_.length;t++){if(void 0==_[t])return;var i=_[t].getBounds();if(e.data.global.x>i.x&&e.data.global.x<i.x+i.width&&e.data.global.y>i.y&&e.data.global.y<i.y+i.height)for(var r=0;r<_[t].bounds.length;r++){var n=_[t].bounds[r];if(NBPoint.distance(e.data.global,n)<20){_[t].clear(),_.splice(t,1),t--;break}}}}var a=e;a.drawColor=0,t=void 0===t?11:t;var l=!1,h=4,c=1,u=.5,f=[],d=[];if(t>0)for(var p=0;p<t;p++)f.push(a["w"+p].x),d.push(a["w"+p].y);a.setLineColor=function(e){a.drawColor=e},a.setLineWidth=function(e){h=e},a.setLineAlpha=function(e){c=e},a.setSpeed=function(e){u=e};var m=a.toLocal({x:0,y:0},instance.stage);if(a.ref.x=m.x,a.ref.y=m.y,a.ref.width=i.stem.STEMMain.W,a.ref.height=i.stem.STEMMain.H,t>0)for(var p=0;p<t;p++){var g=a["w"+p];NBDrag.addDrag(g),g.addEventListener(NBDrag.event.START_DRAG,function(e){var t=e;return function(){a.addChild(a["w"+t])}}(p))}a.ref.addEventListener(TouchEvent.TOUCH_BEGIN,r),a.ref.addEventListener(TouchEvent.TOUCH_END,function(){a.ref.removeListener(TouchEvent.TOUCH_MOVE,n),a.ref.removeListener(TouchEvent.TOUCH_MOVE,s)}),a.ref.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,function(){a.ref.removeListener(TouchEvent.TOUCH_MOVE,n),a.ref.removeListener(TouchEvent.TOUCH_MOVE,s)});var v=0,y=0,_=[],b=[];if(a.clear.addEventListener(TouchEvent.TOUCH_BEGIN,function(){a.clear.gotoAndStop(1)}),a.clear.addEventListener(TouchEvent.TOUCH_END,function(){a.clear.gotoAndStop(0)}),a.clear.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,function(){a.clear.gotoAndStop(0)}),a.clear.addEventListener(TouchEvent.TAP,o),a.pen){var x=function(e){a.pen.currentFrame=!a.pen.currentFrame,a.eraser.gotoAndStop(0),l=!1,0==a.pen.currentFrame&&o()};a.pen.addEventListener(TouchEvent.TAP,x)}a.eraser.addEventListener(TouchEvent.TAP,function(){!0===l?(l=!1,a.eraser.gotoAndStop(0)):(l=!0,a.eraser.gotoAndStop(1)),a.pen.currentFrame=0}),a.onUpdate=function(){0==_.length&&(l=!1,a.eraser.gotoAndStop(0))},a.drawUpdate=function(){0==_.length&&(l=!1,a.eraser.gotoAndStop(0))},a.btn&&a.btn.addEventListener(TouchEvent.TAP,function(){for(var e=0;e<t;e++)TweenMax.to(a["w"+e],u,{x:f[e],y:d[e]});for(var e=0;e<_.length;e++)_[e].clear(),_.splice(e,1),e--})},e.exports=i.drawPicture}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.judgebox=function(){var e=new PIXI.Container,t=new PIXI.Sprite.fromFrame("judge1"),i=new PIXI.Sprite.fromFrame("judge2");return e.addChild(t),e.addChild(i),e.changeValue=function(e){t.visible=!1,i.visible=!1,0==e?t.visible=!0:1==e&&(i.visible=!0)},e.changeValue(-1),e.desdroy=function(){e.removeChild(t),e.removeChild(i),e.destroy()},e},e.exports=i.judgebox}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.longRuler=function(){function e(){root.ruler.txt.text=((root.ruler.bar.x-15)/h).toFixed(1)+"cm",root.ruler.txt.x=root.ruler.bar.x,root.ruler.rightMc.x=root.ruler.bar.x+.8}function t(e){this.globalData={x:e.data.global.x,y:e.data.global.y},l.addEventListener(TouchEvent.TOUCH_END,r),l.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,r),l.addEventListener(TouchEvent.TOUCH_MOVE,i)}function i(e){root.ruler.x+=e.data.global.x-this.globalData.x,root.ruler.y+=e.data.global.y-this.globalData.y,this.globalData.x=e.data.global.x,this.globalData.y=e.data.global.y}function r(e){l.removeEventListener(TouchEvent.TOUCH_END,r),l.removeEventListener(TouchEvent.TOUCH_MOVE,i),l.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,r)}function n(e){this.globalData={x:e.data.global.x},root.ruler.bar.addEventListener(TouchEvent.TOUCH_END,s),root.ruler.bar.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,s),root.ruler.bar.addEventListener(TouchEvent.TOUCH_MOVE,o)}function o(e){this.x+=e.data.global.x-this.globalData.x,this.x<320&&(this.x=320),this.x>1528&&(this.x=1528),this.globalData.x=e.data.global.x,a()}function s(e){root.ruler.bar.removeEventListener(TouchEvent.TOUCH_END,s),root.ruler.bar.removeEventListener(TouchEvent.TOUCH_MOVE,o),root.ruler.bar.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,s)}root=this.parent;var a=function(){var t=root.ruler.m.getChildAt(0);t.clear(),t.beginFill(16711680,1),t.drawRect(0,0,root.ruler.bar.x,82),e()},l=root.ruler.m;root.ruler.bar.alpha=0,root.ruler.bar.getChildAt(0).x=-32;var h=30;l.addEventListener(TouchEvent.TOUCH_BEGIN,t),root.ruler.bar.addEventListener(TouchEvent.TOUCH_BEGIN,n),root.ruler.ruler_bg.mask=root.ruler.m.getChildAt(0),a()},e.exports=i.longRuler}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.whiteScene=function(e){function t(e,t,r,o,s,a){var l=new THREE.Mesh(new THREE.PlaneBufferGeometry(s,a),new THREE.MeshPhongMaterial({color:10066329,map:THREE.ImageUtils.loadTexture("assets/whitescene/"+e),transparent:!0}));l.position.set(t,r,o),l.lookAt(n.position),i.add(l)}var i=e.scene,r=new THREE.Mesh(new THREE.PlaneBufferGeometry(300,300),new THREE.MeshPhongMaterial({color:16777215,specular:1052688}));i.add(r),r.rotation.x=-Math.PI/2,r.receiveShadow=!0;var n=new THREE.Mesh(new THREE.BoxGeometry(5,5,5),new THREE.MeshLambertMaterial({color:16711680}));i.add(n),n.visible=!1,t("ye1.png",30,2,0,7,2),t("ye1.png",-30,2,0,7,2),t("ye2.png",0,2,50,7,3),t("ye2.png",30,2,-50,4,2),t("shu1.png",100,21,-100,95,36),t("shu2.png",-100,23.5,-50,124,40),t("shu1.png",-100,23.5,100,95,36),i.fog=new THREE.Fog(16777215,2,1e3)},e.exports=i.whiteScene}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.injector=function(){function e(){c.clear(),c.beginFill(h.fluidColor,h.fluidAlpha),c.drawRect(-f/2,0,f,u),c.endFill()}function t(t){var r=i();console.log(u,t),t>0&&((u+=t)<0||(u=0)),t<0&&r&&(u+=t),e()}function i(){for(var e=0;e<d.length;e++){var t=injectArrp[e];if(h.head.hitTest(t))return t}return null}function r(e){this.globalData={x:e.data.global.x,y:e.data.global.y},this.nowy=this.y,h.bar.addEventListener(TouchEvent.TOUCH_END,o),h.bar.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,o),h.bar.addEventListener(TouchEvent.TOUCH_MOVE,n)}function n(e){this.y+=e.data.global.y-this.globalData.y,this.y>=-148&&(this.y=-148),this.y<-320&&(this.y=-320),t(this.y-this.nowy),this.nowy=this.y,this.globalData.y=e.data.global.y}function o(e){h.bar.removeEventListener(TouchEvent.TOUCH_END,o),h.bar.removeEventListener(TouchEvent.TOUCH_MOVE,n),h.bar.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,o)}function s(e){this.globalData={x:e.data.global.x,y:e.data.global.y},p.addEventListener(TouchEvent.TOUCH_END,l),p.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,l),p.addEventListener(TouchEvent.TOUCH_MOVE,a)}function a(e){h.x+=e.data.global.x-this.globalData.x,h.y+=e.data.global.y-this.globalData.y,this.globalData.x=e.data.global.x,this.globalData.y=e.data.global.y}function l(e){p.removeEventListener(TouchEvent.TOUCH_END,l),p.removeEventListener(TouchEvent.TOUCH_MOVE,a),p.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,l)}var h=this;this.fluidColor=16711680,this.fluidAlpha=.5;var c=new PIXI.Graphics;c.y=-148,this.addChildAt(c,0);var u=0,f=50,d=[];this.addInjectObj=function(e){d.push(e)},h.bar.addEventListener(TouchEvent.TOUCH_BEGIN,r);var p=h.front;p.addEventListener(TouchEvent.TOUCH_BEGIN,s)},e.exports=i.injector}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.thermometer=function(){function e(e){a.binded=!1}function t(e){a.emit("this_end_touch")}function i(){var e=a.temp/r,t=e*n;a.waterColumn.height+=(t-a.waterColumn.height)*s;var i=e*o;a.big.bigTemp.y+=(i-a.big.bigTemp.y)*s,a.big.bigTemp.waterColumn&&(a.big.bigTemp.waterColumn.height=3.027*a.waterColumn.height+22)}this.binded=!1;var r=100,n=340,o=1024;this.temp=20;var s=.1;this.setSpeed=function(e){s=e};var a=this;NBDrag.addDrag(this),a.addEventListener(TouchEvent.TOUCH_BEGIN,e),a.addEventListener(TouchEvent.TOUCH_END,t),a.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,t);var l=new PIXI.Graphics;l.beginFill(0,1),l.drawCircle(0,0,142),l.endFill(),l.y=73,l.x=4,a.big.addChild(l),a.big.bigTemp.mask=l,this.getTemp=function(){return a.temp},this.setTemp=function(e){a.temp=e},this.update=function(){i()},a.big.qs1.visible=!1},e.exports=i.thermometer}).call(t,i(1))},function(e,t,i){"use strict";var r=function(){function e(e){function i(e){a=!0;var t=this.parent;this.x;t.progress.center.width=this.x;var i=this.x/n;t.emit("change",{time:i});var s=r.parent.toLocal({x:e.data.global.x,y:e.data.global.y});l.x-o<=n&&l.x-o>=0&&(l.x+=s.x-l._data.x,l._data=s),l.x-o<0&&(l.x=0),l.x-o>n&&(l.x=n)}function s(){t(),l.removeEventListener(TouchEvent.TOUCH_MOVE,i),l.removeEventListener(TouchEvent.TOUCH_END,s),l.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,s)}var l=this,h=r.parent.toLocal({x:e.data.global.x,y:e.data.global.y});l._data=h,l.addEventListener(TouchEvent.TOUCH_MOVE,i),l.addEventListener(TouchEvent.TOUCH_END,s),l.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,s)}function t(){a=!0,r.setMomentsPause(r._time_)}function i(e){var i=this.toLocal({x:e.data.global.x,y:e.data.global.y});i.x>0&&i.x<n&&(a=!1,TweenMax.to(this.clock,.1,{x:i.x,onUpdate:function(){a=!1,r.render(r._speed)},onComplete:function(){t()}}))}var r=this,n=this.progress.width,o=this.clock.x;this.clock.addEventListener(TouchEvent.TOUCH_BEGIN,e),r.reset=function(){r.clock.x=0,r.progress.center.width=0,r.setAutoPlay(!0)},this.progress.center.width=0;var s;r.setMomentsPause=function(e){r._time_=e,clearTimeout(s),s=setTimeout(function(){a=!1},e)},NBGesture.addGesture(r,NBGesture.gesture.TAP,i),this.setOperation=function(e){e?(this.clock.interactive=!0,NBGesture.addGesture(r,NBGesture.gesture.TAP,i)):(this.clock.interactive=!1,NBGesture.removeGesture(r,NBGesture.gesture.TAP,i))};var a=!1;this.setAutoPlay=function(e){a=!e},this.flagChange=function(){this.clock.interactive=!1,NBGesture.removeGesture(this,NBGesture.gesture.TAP)},this.render=function(e){if(!a){var t=this.progress;if(this.clock.x>t.front.width&&this.clock.x<n){var i=this.clock.x-t.front.width;t.center.width=i}else t.center.width=0;var r=this.clock.x/n;if(this.emit("change",{time:r}),e=e||1,this._speed=e,this.visible&&this.clock.x<=n&&(this.clock.x+=e),this.clock.x>n){this.clock.x=n;var i=this.clock.x-t.front.width;t.center.width=i,a=!0,this.emit("change",{time:1}),this.emit("complete"),this.complete=!0,console.log("当前时间已完成")}}}};e.exports=r},function(e,t,i){"use strict";(function(t){var i=t.nb;i.magGlass=function(e,t,i,r,n,o,s){function a(){f.x=e.x,f.y=e.y;var r=o.toLocal(b,y),n=e.x-r.x,s=e.y-r.y;t.x=e.x-n*_,t.y=e.y-s*_,i.x=t.x,i.y=t.y,l()}function l(){for(var r=i.ab.children.length,n=0;n<r;n++){var o=i.ab.getChildAt(n),s=i[o.name];o.name.substr(1,1)==t.currentFrame?e.hit.hitTest(o)?(s.visible=!0,TweenLite.to(s.scale,.5,{x:1,y:1,ease:Back.easeOut})):TweenLite.to(s.scale,.2,{x:0,y:0}):s.visible=!1}}function h(e){y=e,_=t.width/y.width}var c={};if(t.scale.x=n,t.scale.y=n,i.scale.x=n,i.scale.y=n,void 0===s||1==s){var u=new PIXI.Graphics;u.beginFill(13421823,1),u.drawRect(r.x,r.y,520,740),u.endFill(),o.addChild(u),o.small.mask=u}var f=new PIXI.Graphics;f.beginFill(2960672,1),f.drawCircle(2,2,231),f.endFill();var d=f.clone();e.addChild(d),o.addChild(f),t.mask=f;for(var p=i.ab.children.length,m=0;m<p;m++){var g=i.ab.getChildAt(m),v=i[g.name];v.scale.x=0,v.scale.y=0,g.alpha=0}var y=r.p1,_=t.width/y.width,b=new PIXI.Point,x={x:r.x,y:r.y};return c.switchSmall=function(e){var i=r["p"+e];TweenLite.to(r,.5,{x:x.x-i.x}),t.gotoAndStop(e-1),h(i)},c.glass=e,c.updataBig=a,c.changeSmall=h,c},e.exports=i.magGlass}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=function(){function e(e){l.lockClick(e)}function t(e){this.canDrag&&(this.globalData={x:e.data.global.x,y:e.data.global.y},f.addEventListener(TouchEvent.TOUCH_END,r),f.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,r),f.addEventListener(TouchEvent.TOUCH_MOVE,i))}function i(e){a.x+=e.data.global.x-this.globalData.x,a.y+=e.data.global.y-this.globalData.y,this.globalData.x=e.data.global.x,this.globalData.y=e.data.global.y}function r(e){f.removeEventListener(TouchEvent.TOUCH_END,r),f.removeEventListener(TouchEvent.TOUCH_MOVE,i),f.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,r)}function n(e){this.globalData={x:e.data.global.x},l.addEventListener(TouchEvent.TOUCH_END,s),l.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,s),l.addEventListener(TouchEvent.TOUCH_MOVE,o)}function o(e){l.islock||(this.x+=e.data.global.x-this.globalData.x,this.x<a.leftX+a.offX&&(this.x=a.leftX+a.offX),this.x>a.rightX+a.offX&&(this.x=a.rightX+a.offX),a.update(),this.globalData.x=e.data.global.x)}function s(e){l.removeEventListener(TouchEvent.TOUCH_END,s),l.removeEventListener(TouchEvent.TOUCH_MOVE,o),l.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,s)}var a=this,l=this.body_top,h=this.body_bottom,c=this.bg;l.scal.visible=!1,l.ten.alpha=!1,l.fifty.alpha=!1,l.islock=!1,this.offX=-240,this.leftX=0,this.rightX=510,this.bottomDx=h.x-this.leftX-this.offX,this.canDrag=!1,this.resetValue=function(e){TweenLite.to(l,.5,{x:e+this.offX})},this.bindObj=function(e){l.islock||(e?(TweenLite.to(e,.5,{x:a.x-330,y:a.y+110}),l.x-this.offX>=e.width||a.resetValue(e.width+200),a.leftX=e.width):(a.resetValue(0),a.leftX=0))},this.update=function(){h.x=l.x+a.bottomDx},this.getValue=function(){return l.showValue(!0)},l.txt=new PIXI.Text("",{font:"24px Arial",fill:16777215,align:"center"}),l.addChild(l.txt),l.txt.x=l.lock.x+40,l.txt.y=l.lock.y,l.graphics=new PIXI.Graphics,l.scal.addChildAt(l.graphics,1),l.graphics.x=-87,l.graphics.y=-102;var u={};u.getNumToInt=function(e){var t=e+"",i=t.indexOf(".");return(t=t.slice(0,i))-0},u.getNumJie=function(e,t){void 0===t&&(t=0);var i=Math.pow(10,t);return Math.round(e*i)/i},l.lock.addEventListener(TouchEvent.TAP,e),l.lockClick=function(e){this.islock=!this.islock,this.islock?(this.scal.visible=!0,this.lock.gotoAndStop(1),this.showValue()):(this.scal.visible=!1,this.lock.gotoAndStop(0),this.txt.text="")},l.showValue=function(e){var t,i,r=0,n=0;1==this.ten.alpha&&(t=this.ten.x,r=1,n=1),1==this.twenty.alpha&&(t=this.twenty.x,r=2,n=2),1==this.fifty.alpha&&(t=this.fifty.x,r=3,n=2);var o=this.parent.bg.x+this.x+t,s=o+320;(i=u.getNumJie(s/3,n))<0&&(i=0);var a;a=100*i%10,2==r?a<5?a=0:a>5&&(a=5):3==r&&a%2!=0&&a--,i=u.getNumJie(i,1)+.01*a;var l=u.getNumJie(i,n);if(e)return l;this.txt.text=l+"mm",l=l.toFixed(2),console.log(r,l),this.draw(r,l)},l.draw=function(e,t){this.graphics.removeChildren(),this.graphics.clear(),this.graphics.lineStyle(4,0);var i=t-0;i*=.1;var r=u.getNumToInt(i),n=u.getNumToInt(10*(i-r)),o=0,s=0,a=0,l=0,h=0;n>=5&&(s=5),1==e?(o=24,a=s+15,l=10,h=.9*o):2==e?(o=14.4,a=s+25,l=20,h=19*o/20):3==e&&(o=360/55,a=s+55,l=50,h=49*o/50);var c,f=0,d=0,p=0==s?r:r+1;for(c=s;c<=a;c++){var m=0;if(c%5==0&&c%10!=0)m=0+f*o,this.graphics.moveTo(m,0),this.graphics.lineTo(m,-24);else if(c%10==0){if(m=0+f*o,this.graphics.moveTo(m,0),this.graphics.lineTo(m,-34),p<=15){var g=this.getTxt(p);this.graphics.addChild(g),g.x=m-g.width/2,g.y=-60}p++}else m=0+f*o,this.graphics.moveTo(m,0),this.graphics.lineTo(m,-19);if(f++,c==n){var v=t;d=m+o*(v-u.getNumToInt(v))}}if(p=0,1==e||2==e)for(c=0;c<=l;c++)if(c%5==0&&c%10!=0){var y=d+c*h;this.graphics.moveTo(y,0),this.graphics.lineTo(y,24)}else if(c%10==0){var y=d+c*h;this.graphics.moveTo(y,0),this.graphics.lineTo(y,34);var g=this.getTxt(p);this.graphics.addChild(g),g.x=y-g.width/2,g.y=40,p+=10}else{var y=d+c*h;this.graphics.moveTo(y,0),this.graphics.lineTo(y,19)}else for(c=0;c<=l;c++)if(c%5==0){var y=d+c*h;this.graphics.moveTo(y,0),this.graphics.lineTo(y,34);var g=this.getTxt(p);this.graphics.addChild(g),g.x=y-g.width/2,g.y=40,p++}else{var y=d+c*h;this.graphics.moveTo(y,0),this.graphics.lineTo(y,19)}},l.getTxt=function(e){return new PIXI.Text(e,{font:"25px Arial",fill:0,align:"center"})};var f=c;f.addEventListener(TouchEvent.TOUCH_BEGIN,t),l.addEventListener(TouchEvent.TOUCH_BEGIN,n)},r=t.nb;r.VernierCaliper=i,e.exports=r.VernierCaliper}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.SetSquaresAndRuler=function(){function e(e){s.canDrag&&(this.globalData={x:e.data.global.x,y:e.data.global.y},a.addEventListener(TouchEvent.TOUCH_END,i),a.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,i),a.addEventListener(TouchEvent.TOUCH_MOVE,t))}function t(e){s.x+=e.data.global.x-this.globalData.x,s.y+=e.data.global.y-this.globalData.y,this.globalData.x=e.data.global.x,this.globalData.y=e.data.global.y}function i(e){a.removeEventListener(TouchEvent.TOUCH_END,i),a.removeEventListener(TouchEvent.TOUCH_MOVE,t),a.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,i)}function r(e){this.globalData={x:e.data.global.x},l.addEventListener(TouchEvent.TOUCH_END,o),l.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,o),l.addEventListener(TouchEvent.TOUCH_MOVE,n)}function n(e){this.x+=e.data.global.x-this.globalData.x,this.x<s.leftX+s.offX&&(this.x=s.leftX+s.offX),this.x>s.rightX+s.offX&&(this.x=s.rightX+s.offX),this.globalData.x=e.data.global.x}function o(e){l.removeEventListener(TouchEvent.TOUCH_END,o),l.removeEventListener(TouchEvent.TOUCH_MOVE,n),l.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,o)}var s=this;this.offX=20,this.leftX=0,this.rightX=450,this.canDrag=!1;var a=s.bottom,l=s.chi,h=this.rightX/15;this.resetValue=function(e){TweenLite.to(l,.5,{x:e+this.offX})},this.bindObj=function(e){e?(TweenLite.to(e,.5,{x:s.x+24,y:s.y+54}),l.x-this.offX>=e.width||s.resetValue(e.width+200),s.leftX=e.width):(s.resetValue(0),s.leftX=0)};var c=new PIXI.Sprite;this.addChild(c),c.addChild(a),c.addChild(l),this.small=c;var u=new PIXI.Sprite;s.addChild(u);var f=new PIXI.Sprite;u.addChild(f);var d=a.clone();f.addChild(d);var p=l.clone();f.addChild(p);f.scale.x=f.scale.y=3;var m=new PIXI.Graphics;m.beginFill(0),m.drawRoundedRect(-100,20,400,200,20),m.endFill(),u.addChild(m),f.mask=m,u.y=-230;var g=new PIXI.Text("",{font:"30px Aria"});u.addChild(g),g.y=180,this.update=function(){p.x=l.x,m.x=3*l.x,u.x=3*-l.x+l.x,g.text=((l.x-this.offX)/h).toFixed(2)+"cm",g.x=m.x+20},a.addEventListener(TouchEvent.TOUCH_BEGIN,e),l.addEventListener(TouchEvent.TOUCH_BEGIN,r)},e.exports=i.SetSquaresAndRuler}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.setDefaultAsHide=function(){this.visible=!1},e.exports=i.setDefaultAsHide}).call(t,i(1))},function(e,t,i){"use strict";nb=window.nb,nb.balance=function(){function e(e){TweenMax.killTweensOf(o.scal),TweenMax.to(o.scal,.3,{alpha:1});var i=(this.x-c)/(u-c);console.log(i);var n=o.toLocal({x:0,y:0},this);d.x=n.x,d.y=n.y-40,dy=h.y,o.niezi.visible=!0,this.globalData={x:e.data.global.x,y:e.data.global.y},this.nowx=this.x,h.addEventListener(TouchEvent.TOUCH_END,r),h.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,r),h.addEventListener(TouchEvent.TOUCH_MOVE,t)}function t(e){var t=o.toLocal({x:0,y:0},this);d.x=t.x,d.y=t.y-40;var i=e.data.global.x-this.globalData.x;if(0!=i){Math.abs(i)<3&&(i=i/Math.abs(i)*.5),this.x+=i;this.x;this.x>=u&&(this.x=u,o.niezi.x=l+u-i),
//!!!没细作 镊子的Y变化是手写的;
o.niezi.y=f+(h.x+c)/(c+u)*12,this.x>-c&&this.x<u&&(o.niezi.x=-193+this.x+150,o.scal.chizi.biaochi.x=2.675*-(this.x+150)),this.x<-c&&(this.x=-c,o.niezi.x=l);var r=this.x-this.nowx,n=r/(u+c)*5;o.left.y-=r/(u+c)*22,o.left.number&&(s[o.left.number].y-=r/(u+c)*22),o.right.y+=r/(u+c)*22,o.rot.rotation+=n*Math.PI/180,this.nowx=this.x,this.globalData.x=e.data.global.x,this.globalData.y=e.data.global.y}}function i(){if(o.niezi.x=-193+h.x+150,o.scal.chizi.biaochi.x=2.675*-(h.x+150),m=(h.x+c)/(u+c),o.scal.txt.text=(5*m).toFixed(2),void 0!=p){var e=o.scal.txt.text-0;e>p-.1&&e<p+.1&&(o.scal.txt.style.fill="#FFFF00",o.scal.txt.text.replace("g",""),o.scal.txt.text+="g"),e==p&&(o.scal.txt.style.fill="#FF0000",o.scal.txt.text.replace("g","")),(e<=p-.1||e>=p+.1)&&(o.scal.txt.style.fill="#FFFFFF",o.scal.txt.text.replace("g",""),o.scal.txt.text+="g")}else o.scal.txt.text=(Math.round(5*m*100)/100).toFixed(2)+"g";o.txt.text=0,o.txt.text=o.scal.txt.text,o.txt.style.fill=o.scal.txt.style.fill}function r(e){TweenMax.killTweensOf(o.scal),TweenMax.to(o.scal,.3,{alpha:0}),o.niezi.visible=!1,h.removeEventListener(TouchEvent.TOUCH_END,r),h.removeEventListener(TouchEvent.TOUCH_MOVE,t),h.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,r)}function n(){var e=this,t=e.name.substr(1,1);0==o.refL.getBounds().width&&(o.refL._bounds.width=354.2,o.refL._bounds.height=457.4),o.left.number&&e.hitTest(o.refL)&&(o.parent.addChildWithSamePos(s[o.left.number]),TweenMax.to(s[o.left.number],.3,{x:a[o.left.number].x,y:a[o.left.number].y})),e.hitTest(o.refL)||TweenMax.to(s[t],.3,{x:a[t].x,y:a[t].y}),e.hitTest(o.refL)&&(p=e.mass-0,NBDrag.removeDrag(e),o.addChildWithSamePos(e),o.addChildAt(e,0),TweenMax.to(e,.3,{x:o.left.x+180,y:o.left.y+10,onComplete:function(){o.left.info=!0,g=e.mass/5*22,v=e.mass/5*5,o.left.number&&(NBDrag.addDrag(s[o.left.number]),g=(e.mass-s[o.left.number].mass)/5*22,v=Math.floor((e.mass-s[o.left.number].mass)/5*5*100)/100),o.left.number=t,TweenMax.to(e,.3,{y:e.y+g}),TweenMax.to(o.left,.3,{y:o.left.y+g}),TweenMax.to(o.right,.3,{y:o.right.y-g}),TweenMax.to(o.rot,.3,{rotation:o.rot.rotation-v*Math.PI/180})}}))}var o=this;o.niezi.visible=!1,this.setMass=function(e,t){e.mass=t};var s=[],a=[];this.init=function(e){for(var t=0;t<e.length;t++){var i=e[t];a.push({x:i.x,y:i.y}),NBDrag.addDrag(i),i.on(NBDrag.event.STOP_DRAG,n),s.push(i)}},this.scal.chizi.mask=this.scal.m.getChildAt(0);var l=o.niezi.x,h=this.rot.drag,c=(h.x,150.35),u=174.85,f=o.niezi.y;h.addEventListener(TouchEvent.TOUCH_BEGIN,e);var d=this.scal;d.alpha=0;var p,m=0;this.update=i;var g=0,v=0},e.exports=nb.balance},function(e,t,i){"use strict";function r(){function e(){}var t=this;PIXI.Container.call(this),this.x=BiologyMain.STACK_WIDTH>>1,window.addEventListener("resize",e),this.drawColor=16777215,this.lineWidth=6,this.lineAlpha=1,PIXI.loader.reset(),PIXI.loader.add(nb.config.URI_PREFIX+"assets/components/DrawUtil/assets.json").load(function(){PIXI.loader.reset(),$.getJSON(nb.config.URI_PREFIX+"assets/components/DrawUtil/resource.json",function(e){var i=instance.createChildFromData(t,e[0]);t.initComplete(i)})}),this.ifShowIntro=!0,this.intro_title="",this.intro_info="",this.loaded=!1}r.constructor=r,r.prototype=Object.create(PIXI.Container.prototype),r.prototype.initComplete=function(e){function t(){if(m.parent){var t=m.parent.toLocal({x:0,y:BiologyMain.H},instance.stage);m.y=t.y-200}v.width=BiologyMain.W,v.height=BiologyMain.H;var i=e.toLocal(new PIXI.Point,instance.stage);g.position.copy(i)}function i(e){g.removeEventListener(TouchEvent.TOUCH_END,i),g.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,i),g.addEventListener(TouchEvent.TOUCH_BEGIN,r),g.removeEventListener(TouchEvent.TOUCH_MOVE,n),g.removeEventListener(TouchEvent.TOUCH_MOVE,s)}function r(e){if(0!=y.drawing()&&(g.removeEventListener(TouchEvent.TOUCH_BEGIN,r),g.addEventListener(TouchEvent.TOUCH_END,i),g.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,i),g.addEventListener(TouchEvent.TOUCH_MOVE,s),0==y.step)){T=[];var t=new PIXI.Graphics;g.addChild(t),x.push(t),t.blendMode=PIXI.BLEND_MODES.EXCLUSION,t.lineStyle(y.lineWidth,y.drawColor,y.lineAlpha);var o=g.toLocal({x:e.data.global.x,y:e.data.global.y});_=o.x,b=o.y,g.addEventListener(TouchEvent.TOUCH_MOVE,n)}}function n(e){var t=g.toLocal({x:e.data.global.x,y:e.data.global.y}),i=x.length-1;x[i].moveTo(_,b),x[i].lineTo(t.x,t.y),T.push({x:e.data.global.x,y:e.data.global.y}),x[i].bounds=T,_=t.x,b=t.y}function o(t){for(var i=0;i<x.length;i++)x[i].clear(),x.splice(i,1),i--;e.pen.currentFrame=0,g.visible=!1,t&&t.stopPropagation(),S.visible=!1}function s(e){if(1==y.step)for(var t=0;t<x.length;t++){if(void 0==x[t])return void(g.visible=!1);if(0==x[t].graphicsData.length){x[t].clear(),x.splice(t,1),t--;break}var i=x[t].getBounds();if(e.data.global.x>i.x&&e.data.global.x<i.x+i.width&&e.data.global.y>i.y&&e.data.global.y<i.y+i.height)for(var r=0;r<x[t].bounds.length;r++){var n=x[t].bounds[r];if(NBPoint.distance(e.data.global,n)<20){x[t].clear(),x.splice(t,1),t--;break}}}}function a(e){this.currentFrame=1}function l(e){this.currentFrame=0,m.emit("fangda")}function h(e){this.currentFrame=1}function c(e){this.currentFrame=0,m.emit("suoxiao")}function u(t){this.currentFrame=!this.currentFrame,e.sl.visible=this.currentFrame,t.stopPropagation()}function f(e){var t=e.color;m.setLineColor(t)}function d(){m.emit("back")}function p(t){var i=this==e.x4?0:this==e.x10?1:2;console.log(i),m.emit("changeMult",{mult:i})}var m=this,g=new PIXI.Graphics,v=new PIXI.Graphics;v.beginFill(16777215,0),v.drawRect(0,0,BiologyMain.W,BiologyMain.H),v.endFill(),g.addChild(v);instance.getCurrentFrame();e.addChildAt(g,0),$(window).resize(t),t();var y=this;y.component=e,y.step=!1,g.visible=!1,g.addEventListener(TouchEvent.TOUCH_BEGIN,r);var _=0,b=0,x=[],T=[];if(this.drawArr=x,e.clear.addEventListener(TouchEvent.TOUCH_BEGIN,function(){e.clear.gotoAndStop(1)}),e.clear.addEventListener(TouchEvent.TOUCH_END,function(){e.clear.gotoAndStop(0)}),e.clear.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,function(){e.clear.gotoAndStop(0)}),e.clear.addEventListener(TouchEvent.TAP,o),e.pen){var E=function(i){e.pen.currentFrame=!e.pen.currentFrame,e.eraser.gotoAndStop(0),y.step=!1,0==e.pen.currentFrame?o():(g.visible=!0,t(),S.visible=!0),i.stopPropagation()};e.pen.addEventListener(TouchEvent.TAP,E)}e.eraser.addEventListener(TouchEvent.TAP,function(t){!0===y.step?(y.step=!1,e.eraser.currentFrame=0,o()):(y.step=!0,e.eraser.currentFrame=1),e.pen.currentFrame=0,t.stopPropagation()}),e.fangda.addEventListener(TouchEvent.TOUCH_BEGIN,a),e.fangda.addEventListener(TouchEvent.TOUCH_END,l),e.suoxiao.addEventListener(TouchEvent.TOUCH_BEGIN,h),e.suoxiao.addEventListener(TouchEvent.TOUCH_END,c),e.sl.visible=!1,e.sl.infoTxt=new PIXI.Text("",{font:"50px Microsoft YaHei",fill:16777215,align:"left",wordWrap:!0,wordWrapWidth:560}),e.sl.addChild(e.sl.infoTxt),e.intro.addEventListener(TouchEvent.TAP,u),this.ifShowIntro||(e.intro.visible=!1),e.sl.title.style.font="80px 'Microsoft YaHei'";var S=new nb.colorSelector;this.addChild(S),S.addEventListener("change",f),S.rotation=-Math.PI/2,S.visible=!1,S.x=e.pen.x-450,S.y=e.pen.y,this.colors=S,this.loaded=!0,e.back.addEventListener(TouchEvent.TAP,d),e.x4.addEventListener(TouchEvent.TAP,p),e.x10.addEventListener(TouchEvent.TAP,p),e.x40.addEventListener(TouchEvent.TAP,p),this.allArr=[e.pen,e.eraser,e.intro,e.fangda,e.suoxiao,e.clear,e.back,e.x4,e.x10,e.x40],this.showInModels(),this.emit("initComplete")},r.prototype.showInModels=function(){if(this.loaded){var e=this.component,t=[e.pen,e.eraser,e.intro,e.clear];this.showSome(t)}},r.prototype.setMult=function(e){var t=4==e?0:10==e?1:2;if(this.loaded)for(var i=this.component,r=[i.x4,i.x10,i.x40],n=0;n<=2;n++){var o=r[n];o.currentFrame=t==n?1:0}},r.prototype.showInVideo=function(){if(this.loaded){var e=this.component,t=[e.pen,e.eraser,e.clear];this.showSome(t)}},r.prototype.showInMicApp=function(){if(this.loaded){var e=this.component,t=[e.x4,e.x10,e.x40,e.back];this.showSome(t)}},r.prototype.showInMicroscope=function(){if(this.loaded){var e=this.component,t=[e.pen,e.eraser,e.x4,e.x10,e.x40,e.clear,e.back];this.showSome(t)}},r.prototype.showInOldMicroscope=function(){if(this.loaded){var e=this.component,t=[e.pen,e.eraser,e.clear,e.back];this.showSome(t)}},r.prototype.showSome=function(e){if(this.loaded){for(var t=0;t<this.allArr.length;t++){var i=this.allArr[t];i.visible=!1}for(var t=0;t<e.length;t++){var i=e[t];i.visible=!0,i.x=50+115*t,i.y=50}}},r.prototype.showIntro=function(e,t){this.intro_title=e,this.intro_info=t},r.prototype.setIfShowIntro=function(e){this.ifShowIntro=e,this.component&&(this.component.intro.visible=e)},r.prototype.render=function(){this.drawArr&&0==this.drawArr.length&&(this.step=!1,this.component.eraser.gotoAndStop(0)),this.component&&(this.component.sl.title.text=this.intro_title,this.component.sl.infoTxt.text="    "+this.intro_info,this.component.sl.y=-this.component.sl.infoTxt.height)},r.prototype.drawing=function(){return!!this.component&&(1==this.component.pen.currentFrame||1==this.component.eraser.currentFrame)},r.prototype.setLineColor=function(e){this.drawColor=e},r.prototype.setLineWidth=function(e){this.lineWidth=e},r.prototype.setLineAlpha=function(e){this.lineAlpha=e},e.exports=r},function(e,t,i){"use strict";function r(){function e(){t.resize()}PIXI.Container.call(this);var t=this;PIXI.loader.add(nb.config.URI_PREFIX+"assets/components/SlideSwitch/assets.json").load(function(){PIXI.loader.reset(),$.getJSON(nb.config.URI_PREFIX+"assets/components/SlideSwitch/resource.json",function(e){var i=instance.createChildFromData(t,e[0]);t.initComplete(i)})}),window.addEventListener("resize",e),this.addEventListener("add",e),this.zoom=0,this.sl_img_url=""}r.constructor=r,r.prototype=Object.create(PIXI.Container.prototype),r.prototype.initComplete=function(e){function t(e){i(this.id)}function i(e){for(var t=0;t<o.length;t++){var i=o[t];i.id==e?0==i.alpha&&(i.alpha=1,r.emit("change",{m:e})):i.alpha=0}}var r=this;this.resize(),this.slideName=e.slideName,this.slideName.visible=!1,this.sl=e.sl,this.sl.interactive=!1,this.con=e.con,this.con.interactive=!1;var n=e.maskSp;this.con.mask=n.getChildAt(0),this.beishu=e.bTxt;var o=[e.b1,e.b2,e.b3];e.b1.alpha=1,e.b2.alpha=0,e.b3.alpha=0;for(var s=0;s<o.length;s++){var a=o[s];a.id=s,a.addEventListener(TouchEvent.TAP,t),a.visible=!1}this.sl_img=new PIXI.Sprite,this.con.addChild(this.sl_img),this.sl_img.pivot.set(309,309),this.sl_img.scale.set(.7,.7)},r.prototype.changeSlideImage=function(e){var t=nb.config.MODEL_URI_PREFIX+"slides_new/"+e.slID+"/"+e.slTexture;this.sl_img_url!=t&&(this.sl_img_url=t,this.sl_img.texture=PIXI.Texture.fromImage(t))},r.prototype.repositionSl=function(e,t){this.con&&(this.con.x=this.sl.x-50*e,this.con.y=this.sl.y-50*t)},r.prototype.setSlideName=function(e){this.slideName&&(this.slideName.text=e)},r.prototype.setMult=function(e){this.beishu&&(this.beishu.text=e+" X 10")},r.prototype.resize=function(){var e=this;if(e.parent){var t=e.parent.toLocal({x:0,y:0},instance.stage);e.x=t.x+2,e.y=t.y+2}},e.exports=r},function(e,t,i){"use strict";function r(){function e(e){var t=this.toLocal(e.data.global,instance.stage),i=Math.floor((t.y+this.r)/this.space);this.emit("change",{color:this.colorArr[i]}),this.c=i,this.reset()}PIXI.Container.call(this),this.colorArr=[16777215,171618,2452214,8267254,16767673,16131463,16143909],this.c=0,this.r=25,this.space=60,this.g=new PIXI.Graphics,this.addChild(this.g),this.reset(),this.addEventListener(TouchEvent.TOUCH_BEGIN,e)}r.constructor=r,r.prototype=Object.create(PIXI.Container.prototype),r.prototype.reset=function(){var e=this.g,t=this.r,i=this.colorArr,r=this.c;e.clear();for(var n=0;n<i.length;n++)e.beginFill(i[n],1),e.drawCircle(0,n*this.space,t);e.endFill(),e.lineStyle(3,16777215),e.drawCircle(0,r*this.space,t)},e.exports=r},function(e,t,i){"use strict";(function(t){var i=t.nb;i.pictureView=function(e,t,i,r,n,o,s,a){var l=e,h=o,c=o.length,t=t||8.5;n||(n=0),l.infoText&&(l.infoText.alpha=0),n=n;var u=new nbBio.plguin.THREE(l,{camera1:new THREE.OrthographicCamera(-10,10,8,-8,1,1e3)}),f=u.controls,d=u.scene;u.camera.lookAt(new THREE.Vector3),u.camera.position.set(20,0,0),u.camera.fov=i,f.enabled=!1;var p=new THREE.Object3D;d.add(p);for(var m=0;m<c;m++){var g,v,y;!function(){function e(e,n,o,s){var a=new THREE.PlaneGeometry(n,o),h=new THREE.MeshBasicMaterial({map:e,side:2});h.transparent=!0;var f=new THREE.Mesh(a,h),d=s/c*Math.PI*2;f.pp=s;var m=!1;NBGesture.addGesture(f,NBGesture.gesture.TAP,function(){this.pp;m?(TweenMax.to(u.camera,.6,{onUpdate:function(){u.camera.updateProjectionMatrix()},fov:i}),l.infoText&&TweenLite.to(l.infoText,.6,{alpha:0})):(TweenMax.to(u.camera,.6,{onUpdate:function(){u.camera.updateProjectionMatrix()},fov:r}),l.infoText&&TweenLite.to(l.infoText,.6,{alpha:1})),m=!m}),f.geometry.rotateY(-2*Math.PI/c*s+Math.PI/2),p.add(f),f.position.x=Math.cos(d)*t,f.position.z=Math.sin(d)*t}a?(g=document.createElement("video"),g.loop=!0,g.src=instance.baseURI+h[m],v=new THREE.VideoTexture(g),v.minFilter=THREE.LinearFilter,v.format=THREE.RGBFormat,v.generateMipmaps=!1,e(v,4,2.25,m)):(y=new THREE.TextureLoader,y.load(instance.baseURI+h[m]+"?id="+m,function(t){var i=t.image.src.indexOf("?id="),r=t.image.src.substring(i+4);console.log(r);var n=t.image.width,o=t.image.height,s=n/o;e(t,3*s,3,r)}))}()}var _=new PIXI.Graphics;instance.stage.addChildAt(_,0),_.beginFill(16777215,0),_.drawRect(0,0,BiologyMain.W,BiologyMain.H),_.addEventListener(TouchEvent.TOUCH_BEGIN,function(e){function t(e){T=(e.data.global.x-r)/500,x=b+T}function i(e){_.removeEventListener(TouchEvent.TOUCH_MOVE,t),_.removeEventListener(TouchEvent.TOUCH_END,i),_.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,i);var r=Math.round(x/(2*Math.PI/c));x=r*(2*Math.PI/c)}var r=e.data.global.x;b=p.rotation.y,_.addEventListener(TouchEvent.TOUCH_MOVE,t),_.addEventListener(TouchEvent.TOUCH_END,i),_.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,i)});var b=0,x=0,T=0,E=0;l.onUpdate=function(){u.render(),p.rotation.y+=.1*(x-p.rotation.y);var e=Math.round(p.rotation.y/(2*Math.PI/c)),i=e%c;E=Math.abs(i>=0?i:c+i),s&&l.infoText&&(l.infoText.text=s[E],l.infoText.y=BiologyMain.H-l.infoText.height-20);for(var i=0;i<c;i++){var r=p.children[i];if(void 0===r)break;var n=r.position.clone();if(p.localToWorld(n),r.material.opacity=(n.x+t)/(2*t),a){var o=r.material.map.image;if(isNaN(o.duration))return;E==i?1==o.paused&&o.play():0==o.paused&&o.pause()}}}},e.exports=i.pictureView}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb;i.pictureView2=function(e,t,r,n,o,s,a,l){var h=e,c=s,u=s.length;o||(o=0),h.infoText&&(h.infoText.alpha=0,h.infoText.style.wordWrapWidth=700,h.infoText.style.align="left");var f=5,d=5,p=2,m=5,g=5,v=3,y=null,_=Sine.easeInOut;o=o;var b=new nbBio.plguin.THREE(h,{camera:new THREE.PerspectiveCamera(120,1.25,1,1e3)});h.addEventListener("update",function(){});var x=b.controls,T=b.scene;b.camera.lookAt(new THREE.Vector3),b.camera.position.set(0,0,4),b.camera.fov=r,x.enabled=!1;var E=new THREE.Object3D;T.add(E);for(var S=[],w=!1,M=(THREE.ImageUtils.loadTexture(i.config.URI_PREFIX+"assets/video_loading.png"),0);M<u;M++){var A,P,C;!function(){function e(e,t,i,r){var n=new THREE.PlaneGeometry(t,i),o=new THREE.MeshBasicMaterial({map:e,side:2});o.transparent=!0;var s=new THREE.Mesh(n,o);Math.PI;s.pp=r,S.push(s);var a=!1;NBGesture.addGesture(s,NBGesture.gesture.TAP,function(){y=this,R=this.pp;var e=new TimelineLite;if(a?h.infoText&&e.to(h.infoText,.6,{alpha:0},0):h.infoText&&e.to(h.infoText,.6,{alpha:1},.9),a=!a,w){w=!1;var t=new TimelineLite,i=this,r=s.pp;i.pp%v<=1?(t.to(i.rotation,.4,{y:Math.PI+Math.PI/36,ease:_},0),t.to(i.position,.4,{z:p/2,ease:_},0),t.to(i.position,.5,{x:r%v*5-m,y:g-5*Math.floor(r/v),z:0,ease:_},.4),t.to(i.rotation,.5,{y:0,ease:_},.4),t.to(i.rotation,.2,{y:-Math.PI/36,ease:_},.9),t.to(i.rotation,.2,{y:0,ease:_},1.1)):(t.to(i.rotation,.4,{y:-Math.PI-Math.PI/36,ease:_},0),t.to(i.position,.4,{z:p/2,ease:_},0),t.to(i.position,.5,{x:r%v*5-m,y:g-5*Math.floor(r/v),z:0,ease:_},.4),t.to(i.rotation,.5,{y:0,ease:_},.4),t.to(i.rotation,.2,{y:Math.PI/36,ease:_},.9),t.to(i.rotation,.2,{y:0,ease:_},1.1));for(var n=0;n<u;n++)S[n].pp!=i.pp&&(S[n].visible=!0,t.to(S[n].material,.5,{opacity:1},0),t.to(S[n].position,.2,{z:.5,ease:_},.9),t.to(S[n].position,.5,{z:0,ease:Elastic.easeOut},1.1))}else{w=!0;var i=this,t=new TimelineLite;i.pp%v<=1?(t.to(i.position,.4,{x:i.position.x-2,ease:_},0),t.to(i.position,1.5,{x:0,y:-0,z:p,ease:_},0),t.to(i.rotation,.4,{y:-Math.PI/36,ease:_},0),t.to(i.position,.4,{x:i.position.x-2,ease:_},0),t.to(i.position,.7,{x:0,y:-0,z:p,ease:_},.4),t.to(i.rotation,.7,{y:Math.PI+Math.PI/30,ease:_},.4),t.to(i.rotation,.4,{y:Math.PI,ease:_},1.1)):(t.to(i.rotation,.4,{y:Math.PI/36,ease:_},0),t.to(i.position,.4,{x:i.position.x+2,ease:_},0),t.to(i.position,.7,{x:0,y:0,z:p,ease:_},.4),t.to(i.rotation,.7,{y:-Math.PI-Math.PI/30,ease:_},.4),t.to(i.rotation,.4,{y:-Math.PI,ease:_},1.1));for(var n=0;n<u;n++)S[n].pp!=i.pp&&(t.to(S[n].material,.5,{opacity:0,onComplete:function(){b.camera.lookAt(y.position)}},0),t.to(S[n].position,.5,{z:-1,ease:Elastic.easeOut,onComplete:function(e){var t=e;return function(){S[t].visible=!1}}(n)},0))}}),E.add(s);var l=s.pp;s.position.x=l%v*f-m,s.position.y=g-Math.floor(l/v)*d}l?(A=document.createElement("video"),A.loop=!0,A.autoplay=!0,A.src=instance.baseURI+c[M],P=new THREE.VideoTexture(A),P.minFilter=THREE.LinearFilter,P.format=THREE.RGBFormat,P.generateMipmaps=!1,e(P,4,2.25,M)):(C=new THREE.TextureLoader,C.load(instance.baseURI+c[M]+"?id="+M,function(t){var i=t.image.src.indexOf("?id="),r=t.image.src.substring(i+4),n=t.image.width,o=t.image.height,s=n/o;e(t,3*s,3,r)}))}()}var R=0;h.onUpdate=function(){b.render(),E.rotation.y+=.1*(0-E.rotation.y);for(var e=0;e<u;e++){var t=E.children[e];if(void 0===t)break;S[e].position.z==p&&(R=S[e].pp);var r=t.position.clone();if(E.localToWorld(r),l){var n=t.material.map.image;if(isNaN(n.duration))return;R==e?1==n.paused&&n.play():0==n.paused&&n.pause()}}a&&h.infoText&&(h.infoText.text=a[R],h.infoText.x=i.stem.STEMMain.W/2-h.infoText.width+500,h.infoText.y=i.stem.STEMMain.H/2-h.infoText.height/2)},console.log(h.parent),window.addEventListener("mousewheel",function(e){if(e=e||window.event,e.wheelDelta){if(e.wheelDelta>0)for(var t=0;t<u;t++)S[t].position.y+=.3;if(e.wheelDelta<0)for(var t=0;t<u;t++)S[t].position.y-=.3}else e.detail&&(e.detail,e.detail)})},e.exports=i.pictureView2}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.nb,r={};i.picTransform=function(e){if(void 0==r.once){r.once=!0;var t=document.createElement("div");t.id="scroll",t.className="scrollbar",$("body").append(t);var i=document.createElement("div");i.id="nbPic",i.className="clearfix",i.innerHTML=e,$("#scroll").append(i);var n=$("#scroll");n.css({position:"absolute",left:$(window).width()/2-210+"px",top:"100px","-webkit-user-select":"none","-moz-user-select":"none","user-select":"none",cursor:"pointer"}),n.css("position","absolute"),n.css("position","absolute"),n.css("left",$(window).width()/2-210+"px"),n.css("top",100)}},e.exports=i.picTransform}).call(t,i(1))},function(e,t,i){"use strict";var r=function(e,t,i,r){function n(){if(!W){z.removeEventListener("mousewheel",f),z.removeEventListener("mousedown",l),z.removeEventListener("mousemove",h),$(".scrollbar").mCustomScrollbar("disable"),C=(P-A)/2,T=$(".mCSB_container").css("top").replace("px","")-0,E=this.id.substr(3,2),F=E,w=Math.floor((E-0)/2);var e=Math.floor((-T-100)/I);-1==e&&(e=0),M=-I*e-T+D,w==e+1&&(R=-I*e-T-D-O),w==e+2&&(R=-I*(e+1)-T-D-O),w==e&&(R=M),console.log("第几行:"+w,"Y轴位移:"+R,"滑过了几行:"+e,"滑轮滑了:"+T,"第几列:"+E%2,"translate_X:"+C),C=E%2==0?C-L-10:-C-L,$(".divP").css({visibility:"hidden"}),$(".imgB").css({visibility:"hidden"});var t=x[this.id];$("#"+t.name).css({visibility:"visible"}),$("#imgB"+E).css({visibility:"visible"}),S||(S=!0,s(t)),t.com&&(a(t),p.infoText&&TweenLite.to(p.infoText,.6,{alpha:0}));var r=i[F].indexOf("：");_.innerHTML=i[F].slice(r+1),k.innerHTML=V[F]}}function o(e){var t=["translate3d("+e.transform.translate.x+"px, "+e.transform.translate.y+"px, 0)","scale("+e.transform.scaleX+", "+e.transform.scaleY+")","rotateY("+e.transform.ry+"deg)"];t=t.join(" "),e.style.webkitTransform=t,e.style.mozTransform=t,e.style.transform=t}function s(e){var t=e._domDIV;TweenMax.to(t.transform.translate,1.8,{ease:Back.easeInOut,easeParams:[3],x:C,y:R,onUpdateParams:[t],onUpdate:function(e){o(e)},onComplete:function(){e.com=!0,p.infoText&&TweenLite.to(p.infoText,.6,{alpha:1}),$("#nbPic").append(N),$("#text").addClass("text"),$("#text").append(k),$("#text").append(_),$("#_h").css({color:"#ffffff"}),$("#_p").css({color:"yellow",position:"relative"}),$("#text").css({top:-T+$("#img"+E).height()-$("#text").height()+240+"px",left:$("#nbPic").width()-(800-b[E])/2/B-L+"px"})}}),TweenMax.to(t.transform,1.8,{ease:Back.easeInOut,easeParams:[3],ry:180,onUpdateParams:[t],onUpdate:function(e){var t=e.id.substr(3,2);e.transform.ry>=90&&$("#imgB"+t).css({zIndex:"1"}),o(e)}});var i=b[E]/300/B;TweenMax.to(t.transform,.6,{ease:Linear.easeNone,easeParams:[3],scaleY:2/B,scaleX:i,onUpdateParams:[t],onUpdate:function(e){o(e)}})}function a(e){$("#text").remove(),e.com=!1;var t=e._domDIV;TweenMax.to(t.transform.translate,1.8,{ease:Back.easeInOut,easeParams:[3],x:0,y:0,onUpdateParams:[t],onUpdate:function(e){o(e)},onComplete:function(){S=!1,z.addEventListener("mousedown",l),z.addEventListener("mousewheel",f)}}),TweenMax.to(t.transform,1.8,{ease:Back.easeInOut,easeParams:[3],ry:0,onUpdateParams:[t],onUpdate:function(e){o(e);var t=e.id.substr(3,2);e.transform.ry<=90&&($("#imgB"+t).css({zIndex:"-1"}),$(".divP").css({visibility:"visible"}),$(".scrollbar").mCustomScrollbar("update"))}}),TweenMax.to(t.transform,.6,{ease:Linear.easeNone,easeParams:[3],scaleY:1,scaleX:1,onUpdateParams:[t],onUpdate:function(e){o(e)}})}function l(e){W=!1,G=e.clientY,e.touches&&(G=e.touches[0].clientY),z.addEventListener("mousemove",h),z.addEventListener("touchmove",function(e){h(e)},!0),z.addEventListener("mouseup",c)}function h(e){var t=e.clientY-G;if(e.touches)var t=e.touches[0].clientY-G;Math.abs(t)>2&&(W=!0);var i=$("#mCSB_1").height(),r=$("#nbPic").height(),n=r-i;$(".mCSB_container").css("top").replace("px","");j+=t,j>0&&(j=0),j<-n&&(j=-n),console.log(j),G=e.clientY,e.touches&&(G=e.touches[0].clientY),console.log(i,r,r-i)}function c(){z.removeEventListener("mousemove",h)}function u(){z.removeEventListener("mousemove",h),console.log("mouseout")}function f(e){var t=$("#mCSB_1").height(),i=$("#nbPic").height(),r=i-t;console.log(e.deltaY),j-=e.deltaY,j>0&&(j=0),j<-r&&(j=-r)}function d(){$("#scroll").css({left:$(window).width()/2-210+"px"})}var p=e,m="",g=nb.config.URI_PREFIX+"pictures/"+r+"/front/",v=nb.config.URI_PREFIX+"pictures/"+r+"/back/";t=t||20;for(var y=0;y<t;y++)m+='<div class="pull-left divP" id="img'+y+'"><img src="'+g+(y+1)+'.jpg" id="imgF'+y+'" class="imgF" draggable="false"/><img src="'+v+(y+1)+'.jpg" id="imgB'+y+'" class="imgB" draggable="false"/></div>';var _=nb.picTransform(m);$("#nbPic").addClass("div");for(var b=[],y=0;y<t;y++)b.push("");$(".imgB").load(function(){var e=this.id;this.loadedW=this.width;var t=e.replace("imgB","");b[t]=this.loadedW,$("#"+this.id).css({width:"300px",height:"300px",visibility:"visible"})}),console.log(b);for(var x={},y=0;y<t;y++){var e={};e.name="img"+y,e._domDIV=document.querySelector("#img"+y),e._domDIV.transform={translate:{x:0,y:0},scaleX:1,scaleY:1,angle:0,ry:0},x[e.name]=e}$(".scrollbar").mCustomScrollbar({mouseWheel:!1,callbacks:{onCreate:function(){$(".mCSB_container").css({height:"auto"}),$(".mCSB_draggerContainer").hide(),$(".mCustomScrollBox, .mCSB_container").css({overflow:"visible"}),$(".mCSB_draggerContainer").hide()}}});var T=$(".mCSB_container").css("top").replace("px","")-0,E=0,S=!1,w=0,M=0,A=300,P=$("#nbPic").css("width").replace("px","")-0,C=($("#nbPic").css("height").replace("px",""),(P-A)/2),R=0,D=100,I=340,O=140,F=0;$(".divP").mouseup(n);var L=120,B=1.2,N=document.createElement("div");N.id="text";var _=document.createElement("p");_.id="_p";var k=document.createElement("h1");k.id="_h";for(var V=[],y=0;y<t;y++){if(-1!=i[y].indexOf("："))var U=i[y].split("：");else var U=[""];V.push(U[0])}var z=document.getElementById("scroll"),G=0;z.addEventListener("mousedown",l),z.addEventListener("touchstart",function(e){l(e)},!0);var H=0,j=0,W=!1;this.setSroll=function(){H+=.1*(j-H),$(".mCSB_container").css("top",H),$(".scrollbar").mCustomScrollbar("update")},$(".scrollbar").mouseleave(u),z.addEventListener("mousewheel",f),$(window).resize(d),this.hide=function(){console.log("hide")},this.show=function(){console.log("show")}},n={};e.exports=function(e,t,i,o){return void 0===e.name&&(e.name=id++),n[e.name]?n[e.name]:(n[e.name]=new r(e,t,i,o),n[e.name])}},function(e,t,i){"use strict";(function(t){var i=t.nb;i.wallOfVideo=function(e,t,r,n){function o(){if(!N){O.removeEventListener("mousewheel",d),O.removeEventListener("mousedown",h),O.removeEventListener("mousemove",c),$(".scrollbar").mCustomScrollbar("disable"),M=(w-S)/2,_=$(".mCSB_container").css("top").replace("px","")-0,b=this.id.substr(3,2),R=b,console.log(R),T=Math.floor((b-0)/2);var e=Math.floor(-_/C);E=-C*e-_+P,T==e+1&&(A=-C*e-_+P-C),T==e+2&&(A=-C*(e+1)-_+P-C),T==e+3&&(A=-C*(e+2)-_+P-C),T==e&&(A=E),console.log("第几行:"+T,"Y轴位移:"+A,"滑过了几行:"+e,"滑轮滑了:"+_,"第几列:"+b%2,"translate_X:"+M),M=b%2==0?M:-M,$(".divP").css({visibility:"hidden"});var t=y[this.id];$("#"+t.name).css({visibility:"visible"}),x||(x=!0,a(t)),t.com&&l(t)}}function s(e){var t=["translate3d("+e.transform.translate.x+"px, "+e.transform.translate.y+"px, 0)","scale("+e.transform.scaleX+", "+e.transform.scaleY+")","rotateY("+e.transform.ry+"deg)"];t=t.join(" "),e.style.webkitTransform=t,e.style.mozTransform=t,e.style.transform=t}function a(e){var t=BiologyMain.isPC?".mp4":"_720.mp4";D.src=i.config.MODEL_URI_PREFIX+"video/"+r+"/"+(b-0+1)+t,D.id="_video",D.loop="loop",$("#img"+b).append(D),$("#_video").addClass("video");var n=e._domDIV;window._global_lg&&(I.src="./assets/logoPicture.png",I.id="_img",$(I).css({width:"300px",position:"absolute",transform:"scaleX(-1)","z-index":"-1"}),$(".video").css({position:"absolute"}),$("#img"+b).append(I)),TweenMax.to(n.transform.translate,1.8,{ease:Back.easeInOut,easeParams:[3],x:M,y:A,onUpdateParams:[n],onUpdate:function(e){s(e)},onComplete:function(){document.getElementById("_video").play(),e.com=!0}}),TweenMax.to(n.transform,1.8,{ease:Back.easeInOut,easeParams:[3],ry:180,onUpdateParams:[n],onUpdate:function(e){e.transform.ry>=90&&($("#_video").css({zIndex:"1"}),$("#_img").css({zIndex:"2"})),s(e)}}),TweenMax.to(n.transform,.6,{ease:Linear.easeNone,easeParams:[3],scaleY:2.5,scaleX:2.5,onUpdateParams:[n],onUpdate:function(e){s(e)}})}function l(e){e.com=!1;var t=e._domDIV;TweenMax.to(t.transform.translate,1.8,{ease:Back.easeInOut,easeParams:[3],x:0,y:0,onUpdateParams:[t],onUpdate:function(e){s(e)},onComplete:function(){O.addEventListener("mousedown",h),O.addEventListener("mousewheel",d),x=!1}}),TweenMax.to(t.transform,1.8,{ease:Back.easeInOut,easeParams:[3],ry:0,onUpdateParams:[t],onUpdate:function(e){s(e);e.id.substr(3,2);e.transform.ry<=90&&($("#_video").css({zIndex:"-1"}),$("#_img").css({zIndex:"-2"}),$(".divP").css({visibility:"visible"}),$(".scrollbar").mCustomScrollbar("update"))}}),TweenMax.to(t.transform,.6,{ease:Linear.easeNone,easeParams:[3],scaleY:1,scaleX:1,onUpdateParams:[t],onUpdate:function(e){s(e)}})}function h(e){N=!1,F=e.clientY,O.addEventListener("mousemove",c),O.addEventListener("mouseup",u)}function c(e){var t=e.clientY-F;Math.abs(t)>2&&(N=!0);var i=$("#mCSB_1").height(),r=$("#nbPic").height(),n=r-i;$(".mCSB_container").css("top").replace("px","");B+=t,B>0&&(B=0),B<-n&&(B=-n),console.log(B),F=e.clientY,console.log(i,r,r-i)}function u(){O.removeEventListener("mousemove",c)}function f(){O.removeEventListener("mousemove",c),console.log("mouseout")}function d(e){var t=$("#mCSB_1").height(),i=$("#nbPic").height(),r=i-t;console.log(e.deltaY),B-=e.deltaY,B>0&&(B=0),B<-r&&(B=-r)}function p(){$("#scroll").css({left:$(window).width()/2-280+"px"})}var m="",g=i.config.URI_PREFIX+"pictures/"+r+"/front/";if(t=t||20,window._global_lg)for(var v=0;v<t;v++)m+='<div class="pull-left divP" id="img'+v+'"><img src="'+g+(v+1)+'.jpg" id="imgF'+v+'" class="imgF" draggable="false"/><img src="./assets/logoPicture.png" style="position:absolute; width: 100%"></div>';else for(var v=0;v<t;v++)m+='<div class="pull-left divP" id="img'+v+'"><img src="'+g+(v+1)+'.jpg" id="imgF'+v+'" class="imgF" draggable="false"/></div>';i.picTransform(m);$("#nbPic").addClass("div");for(var y={},v=0;v<t;v++){var e={};e.name="img"+v,e._domDIV=document.querySelector("#img"+v),e._domDIV.transform={translate:{x:0,y:0},scaleX:1,scaleY:1,angle:0,ry:0},y[e.name]=e}$(".scrollbar").mCustomScrollbar({mouseWheel:!1,callbacks:{onCreate:function(){$(".mCSB_container").css({height:"auto"}),$(".mCSB_draggerContainer").hide(),$(".mCustomScrollBox, .mCSB_container").css({overflow:"visible"})}}});var _=$(".mCSB_container").css("top").replace("px","")-0,b=0,x=!1,T=0,E=0,S=300,w=$("#nbPic").css("width").replace("px","")-0,M=(w-S)/2,A=0,P=240,C=220.75;$(".imgF").css({height:n+"px"});var R=0;$(".divP").click(o);var D=document.createElement("video");$("body").append(D);var I=document.createElement("img"),O=document.getElementById("scroll"),F=0;O.addEventListener("mousedown",h);var L=0,B=0,N=!1;this.setSroll=function(){L+=.1*(B-L),$(".mCSB_container").css("top",L),$(".scrollbar").mCustomScrollbar("update")},$(".scrollbar").mouseleave(f),O.addEventListener("mousewheel",d),p(),$(window).resize(p),this.hide=function(){console.log("hide")},this.show=function(){console.log("show")}},e.exports=i.wallOfVideo}).call(t,i(1))},function(e,t,i){"use strict";nb.slidesList=function(){},nb.slidesList.init=function(e,t,i){function r(e,t){return $("<li class='clearfix'><span class='pull-left table-title'>"+e+"</span><span class='pull-left table-name'>"+t+"</span></li>")}var n=document.createElement("div");n.id="slidesList",$("body").append(n);var o=$("#slidesList");o.css("position","absolute"),o.css("left",$(window).width()/2-100),o.css("top",$(window).height()/2-50);var s=$("<ul class='table-menu'></ul>");o.append(s);var a=r("编号","实验名称");s.append(a);for(var l=0;l<e.length;l++){var h=e[l],c=r(l+1,h.name);s.append(c),c[0].id="index"+l,c.on("click",function(e){console.log(this.id,this.id.substring(5)),t&&t(this.id.substring(5))}),c.hover(function(){i(this.id.substring(5),!0)},function(){i(this.id.substring(5),!1)}),c.addClass("li_hover")}$("#slidesList").hide(),$("#slidesList").css("height","220px"),$(window).resize(function(){o.css("left",$(window).width()/2-100),o.css("top",$(window).height()/2-50)})},nb.slidesList.show=function(e){$("#slidesList").fadeIn(e||300)},nb.slidesList.hide=function(e){$("#slidesList").fadeOut(e||300)},nb.slidesList.constructor=nb.slidesList,e.exports=nb.slidesList},function(e,t,i){"use strict";function r(e,t,i){function r(e){0!=this.candragMove&&(l.copy(e.data.global),this.removeEventListener(TouchEvent.TOUCH_BEGIN,r),this.addEventListener(TouchEvent.TOUCH_MOVE,n),this.addEventListener(TouchEvent.TOUCH_END,o))}function n(e){var t=e.data.global.x-l.x,i=e.data.global.y-l.y;l.copy(e.data.global),s.x+=t,s.y+=i,this.moving=!0,this.updatePivot()}function o(e){this.addEventListener(TouchEvent.TOUCH_BEGIN,r),this.removeEventListener(TouchEvent.TOUCH_MOVE,n),this.removeEventListener(TouchEvent.TOUCH_END,o),this.moving=!1,this.updatePivot(),this.update()}PIXI.Sprite.call(this);var s=this;this.pathArr=[],this.ijArr=[],this.slID=e,this.oscale=4,this.w=512,this.dscale=this.oscale,this.zf=3,this.now_width=0,this.now_height=0,this.candragMove=!0,this.mapdate={},this.centerObject={point:new PIXI.Point(nb.stem.STEMMain.W/2,nb.stem.STEMMain.H/2),from:instance.stage};var a=new PIXI.Sprite;this.oimag=a,e&&(this.addChildAt(a,0),this.changeSlide(e,t,i)),this.moving=!1;var l=new PIXI.Point;this.addEventListener(TouchEvent.TOUCH_BEGIN,r)}r.constructor=r,r.prototype=Object.create(PIXI.Sprite.prototype),r.prototype.init=function(){if(null==this.parent)return void console.error("先把map放进显示对象里");this.updatePivot(),this.update()},r.prototype.changeCenterObj=function(e,t){this.centerObject.point=t.toGlobal(e),this.centerObject.from=t,this.updatePivot(),this.update()},r.prototype.xorEncryption=function(e,t){for(var i="",r=t.length,n=0,o=0;o<e.length;o++){var s=t.charCodeAt(n%r);n++;var a=e.charCodeAt(o)^s;i+=String.fromCharCode(a)}return i},r.prototype.getMapJSON=function(e){if(-1!=window.location.href.indexOf("android")||window.require){var t=this,i=!0,r=this;if(!t.hasMap&&i&&window.require){i=!1;var n=window.require("fs"),o=n.readFileSync("public/slides_new/map");o=o.toString();var s=JSON.parse(r.xorEncryption(o,"nbMap"));t.hasMap=s,setTimeout(function(){i=!0},5e3)}}},r.prototype.changeSlide=function(e,t,i){this.slID=e,this.getMapJSON(e);var r=nb.config.MODEL_URI_PREFIX+"slides_new/"+e+"/";this.imagePath=r,this.imagePathAndroid="/_slides_new/"+e+"/";var n=this.oimag;this.addChildAt(n,0),n.texture=PIXI.Texture.fromImage(r+e+".jpg"),n.max_width=t||3e4,n.max_height=i||3e4,this.now_width=n.max_width*(this.dscale/40),this.now_height=n.max_height*(this.dscale/40),n.width=this.now_width,n.height=this.now_height;var o=this.w;this.max_x=Math.ceil(n.width/o),this.max_y=Math.ceil(n.height/o),this.update()},r.prototype.readImage=function(){var e=this;if(PIXI.loader.reset(),this.moving)return this.pathArr.length=0,void(this.ijArr.length=0);if(this.pathArr&&this.pathArr.length>0){var t=this.pathArr.pop(),i=this.ijArr.pop(),r=i.i,n=i.j,o=i.key,s=PIXI.loader;PIXI.loader.resources[t]?e.loadImage():(s.add(t),s.load(function(){var i=PIXI.Texture.fromImage(t),s=new PIXI.Sprite(i);s.cacheAsBitmap=!0,e.addChild(s),s.x=r*e.w,s.y=n*e.w,e.mapdate[o]=s,e.mapDataLoad[o]=t,e.readImage()}))}else console.log("加载完成")},r.prototype.update=function(){if(!this.moving){var e=this.toLocal(this.centerObject.point,this.centerObject.from),t=Math.floor(e.x/this.w),i=Math.floor(e.y/this.w);this.getMapJSON(this.slID);for(var r=t-this.zf;r<=t+this.zf;r++){for(var n=i-this.zf;n<=i+this.zf;n++){var o=r+"_"+n+"_"+this.dscale+"_"+this.slID;if(void 0===this.mapdate[o]&&r>=0&&r<this.max_x&&n>=0&&n<this.max_y){var s=-1!=window.location.href.indexOf("android");if(nb.stem.STEMMain.isAndroid&&window.NbFile&&s){if(this[this.slID+"map"+this.dscale]){var a=r+"x"+n+".jpg",l=this[this.slID+"map"+this.dscale],h=l[a].start,c=l[a].end,u=this.imagePathAndroid+"out_"+this.dscale+"/"+r+"x"+n+".jpg?"+h+"&"+c,f={i:r,j:n,key:o};this.pathArr.push(u),this.ijArr.push(f)}}else if(window.require){if(this.hasMap){var a=r+"x"+n+".jpg",d=r+"x"+n+"_jpg",l=this.hasMap["slides_new_"+this.slID+"_out_"+this.dscale+"_"+d],h=l.start,c=l.end,u=nb.config.MODEL_URI_PREFIX+"slides_new/over?bytes="+h+"-"+c,p=PIXI.Texture.fromImage(u),m=new PIXI.Sprite(p);this.addChild(m),m.x=r*this.w,m.y=n*this.w,this.mapdate[o]=m}}else{var u=this.imagePath+"out_"+this.dscale+"/"+r+"x"+n+".jpg",p=PIXI.Texture.fromImage(u),m=new PIXI.Sprite(p);this.addChild(m),m.x=r*this.w,m.y=n*this.w,this.mapdate[o]=m}}}this.children.length>=4&&(null==this.texture.baseTexture.source&&(this.texture.baseTexture.source=new Image),this.texture.baseTexture.updateSourceImage(this.oimag.texture.baseTexture.source.src),this.texture.trim=new PIXI.Rectangle(0,0,20,20))}nb.stem.STEMMain.isAndroid&&window.NbFile&&s&&this.readImage();for(var m in this.mapdate){var g=m.split("_"),v=g[0],y=g[1],_=g[2],b=g[3];if(Math.abs(v-t)>5||Math.abs(y-i)>5||_!=this.dscale||b!=this.slID){var x=this.mapdate[m];this.removeChild(x),x.texture.baseTexture.source.remove(),x.texture.baseTexture.destroy(),x.texture.destroy(),x.destroy(),delete this.mapdate[m]}}}},r.prototype.updatePivot=function(){var e=this.centerObject.from.toGlobal(this.centerObject.point),t=this.toLocal(e);this.pivot.x=t.x,this.pivot.y=t.y;var i=this.parent.toLocal(this.centerObject.point,this.centerObject.from);this.x=i.x,this.y=i.y},r.prototype.changeMult=function(e){var t,i=this;switch(e){case 1:t=4;break;case 2:t=10;break;case 3:t=40;break;default:t=e}if(t!=this.dscale){this.dscale;i.dscale=t;var r=i.oimag.toLocal(this.centerObject.point,this.centerObject.from);i.scale.set(1,1),i.updateTransform(),i.now_width=i.oimag.max_width*(i.dscale/40),i.now_height=i.oimag.max_height*(i.dscale/40),i.oimag.width=i.now_width,i.oimag.height=i.now_height,i.max_x=Math.ceil(i.oimag.width/i.w),i.max_y=Math.ceil(i.oimag.height/i.w);var n=i.oimag.toGlobal(r),o=i.centerObject.from.toGlobal(i.centerObject.point),s=n.x-o.x,a=n.y-o.y;i.x-=s,i.y-=a,i.updatePivot(),i.update()}},e.exports=r},function(e,t,i){"use strict";e.exports={VREvent:i(183),ModelController:i(276)}},function(e,t,i){"use strict";function r(e,t){if(e){var i=e.backBtn,r=t.frame2D;t.vrSelector.registerListener(i,VREvent.EYES_HANG_ON,function(e){if(window.parent!=window){window.parent.instance.goback()}else location.href="index-vr.html"}),r.addEventListener("update",function(){i.lookAt(t.leftCamera.position)})}}e.exports=r},function(e,t,i){"use strict";(function(t){var i=t.nb;i.cuvette=function(){function e(){if(p.clear(),p.beginFill(r,n),t.rotation>=0&&t.rotation<=.5*Math.PI){var e=o*Math.tan(t.rotation);if(l=s-e/2,h=s+e/2,l>0&&h>a&&t.rotation-c>0){h=a;var i=a-e;u=(2*i+e)/2,s=s>u?u:s}else if(l<=0&&h>a&&t.rotation-c>0){var f=o*s,d=Math.sqrt(2*f/Math.tan(t.rotation)),m=a/Math.tan(t.rotation);u=m*a/2/o,s=s>u?u:s}l<0?(f=o*s,d=Math.sqrt(2*f/Math.tan(t.rotation)),m=d*Math.tan(t.rotation),p.moveTo(o-d,0),p.lineTo(o,-m),p.lineTo(o,0)):(p.moveTo(0,-l),p.lineTo(o,-h),p.lineTo(o,0),p.lineTo(0,0))}else t.rotation<0&&t.rotation>=-.5*Math.PI?(e=o*Math.tan(t.rotation),l=s-e/2,h=s+e/2,l>a&&h>0&&t.rotation-c<0?(e=Math.abs(e),l=a,i=a-e,u=(2*i+e)/2,s=s>u?u:s):l>a&&h<=0&&t.rotation-c<0&&(f=o*s,d=Math.sqrt(Math.abs(2*f/Math.tan(t.rotation))),m=Math.abs(a/Math.tan(t.rotation)),u=m*a/2/o,s=s>u?u:s),h>0?(p.moveTo(0,-l),p.lineTo(o,-h),p.lineTo(o,0),p.lineTo(0,0)):(f=o*s,d=Math.sqrt(Math.abs(2*f/Math.tan(t.rotation))),m=Math.abs(d*Math.tan(t.rotation)),p.moveTo(d,0),p.lineTo(0,-m),p.lineTo(0,0))):s=0;c=t.rotation}var t=this,i=t.shapeMask;i.alpha=0;var r=16711680,n=.5;t.timeNumH=0,t.timeNumA=0,t.timeNumC=0,t.timeNumS=0;var o=i.width,s=i.height,a=i.height,l=i.height,h=s,c=(t.rotation,t.rotation),u=0,f=t.hand0,d=t.hand1;f.visible=!1,d.visible=!1;var p=new PIXI.Graphics;t.addChild(p),t.addChildAt(p,0),p.y+=s+80,p.x+=10,this.graphicWater=p,this.resetGWToMask=function(){p.x=t.trueMask.x,p.y=t.trueMask.y},this.changeWaterIndex=function(e){t.addChildAt(p,e)},p.mask=t.trueMask.getChildAt(0),t.setWaterColor=function(t){r=t,e()},t.setWaterAlpha=function(t){n=t,e()},t.setWater=function(t,i){r=t,n=i,e()},t.drop=function(i,r,n){TweenMax.to(t,i,{rotation:r,onUpdate:function(){e()},onComplete:function(){n&&n()}})},t.shake=function(e,i,r){f.visible=!0,d.visible=!0;var n=i||.03;TweenMax.to(t,e,{timeNumS:6e3,onUpdate:function(){t.rotation+=n,t.rotation>Math.PI/36&&(n=-Math.abs(n)),t.rotation<-Math.PI/36&&(n=Math.abs(n))},onComplete:function(){t.rotation=0,t.timeNumS=0,f.visible=!1,d.visible=!1,r&&r()}})},t.setCapacity=function(t){s=i.height*t,l=s,h=s,u=s,e()},t.setCapacity(.2),t.changeWater=function(e,o){function a(e){for(var t=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e.charAt(i);return t}("0123456789ABCDEF"),i="";0!=e;){i=t[15&e]+i,e>>=4}return i}var l=(e.color,e.alpha||n),h=e.height||i.height/s,c=e.time||1,u=e.color||r;0==e.alpha&&(l=e.alpha),0==e.color&&e.alpha,0==e.height&&(h=e.height);var f=0;if(h!=i.height/s){var d=s/i.height,p=d;TweenMax.to(t,c,{timeNumH:6e3,onUpdate:function(){p+=(h-d)/(60*c),t.setCapacity(p)},onComplete:function(){t.timeNumH=0,t.setCapacity(h),o&&f<1&&(f++,o())}})}if(l!=n){var m=n,g=m;TweenMax.to(t,c,{timeNumA:6e3,onUpdate:function(){g+=(l-m)/(60*c),t.setWaterAlpha(g)},onComplete:function(){t.timeNumA=0,o&&f<1&&(f++,o())}})}if(u!=r){var v=r,y=v>>16,_=v>>8&255,b=255&v,x=u>>16,T=u>>8&255,E=255&u,S=y,w=_,M=b;TweenMax.to(t,c,{timeNumC:6e3,onUpdate:function(){S+=(x-y)/(60*c),w+=(T-_)/(60*c),M+=(E-b)/(60*c);var e="0x"+a(S)+a(w)+a(M);e=S<<16|w<<8|M,t.setWaterColor(e)},onComplete:function(){t.timeNumC=0,o&&f<1&&(f++,o())}})}}},e.exports=i.cuvette}).call(t,i(1))},function(e,t,i){"use strict";function r(e,t,i,r,n){function o(e){var e=e||window.event;i();var t=!0;if(t=e.wheelDelta?e.wheelDelta<0:e.detail>0,0!=e.wheelDelta){if(console.log(t),t){if(d>=n)return void(f.style.fontSize=r*n+"px");f.style.fontSize=parseFloat(f.style.fontSize)+1+"px"}else{if(d<=1)return void(f.style.fontSize=r+"px");f.style.fontSize=parseFloat(f.style.fontSize)-1+"px"}return d=parseFloat(f.style.fontSize)/r,console.log(d),e.preventDefault&&e.preventDefault(),!1}}function s(e,t,i){e.addEventListener(t,i,!1)}function a(e){var t=e.touches;e.preventDefault();parseFloat(f.style.marginLeft),parseFloat(f.style.marginTop);switch(t.length){case 2:m.push(c(t[0])),m.push(c(t[1]));var i=m[0].pageX-m[1].pageX,r=m[0].pageY-m[1].pageY;y=v=Math.sqrt(i*i+r*r)}}function l(e){i();var t=e.touches;switch(e.preventDefault(),t.length){case 2:for(var r,n,o=0;o<t.length;o++)t[o].identifier==m[0].identifier?r=t[o]:t[o].identifier==m[1].identifier&&(n=t[o]);if(!r||!n)return;var s=r.pageX-n.pageX,a=r.pageY-n.pageY;y=Math.sqrt(s*s+a*a);u(y/v)}}function h(e){e.preventDefault();var t=e.touches;switch(t.length){case 0:setTimeout(function(){$(e.target).click()},0);break;case 1:m=[];break;case 2:m=[],m.push(c(t[0])),m.push(c(t[1]));var i=m[0].pageX-m[1].pageX,r=m[0].pageY-m[1].pageY;y=v=Math.sqrt(i*i+r*r)}p=d}function c(e){return{identifier:e.identifier,pageX:e.pageX,pageY:e.pageY}}function u(e){g=e,d=p*e,d>n&&(d=n),d<1&&(d=1),f.style.fontSize=r*d+"px"}var f=e;if(0!=t){var r=r,n=n;f.style.fontSize=r+"px";var d=1,p=d;!function(){window.addEventListener("touchstart",a,!1),window.addEventListener("touchend",h,!1),window.addEventListener("touchmove",l,!1)}(),s(window,"mousewheel",o),s(window,"DOMMouseScroll",o);var m=[],g=1,v=0,y=0}else{f.removeEventListener("mousewheel",o),f.removeEventListener("DOMMouseScroll",o),window.removeEventListener("touchstart",a),window.removeEventListener("touchend",h),window.removeEventListener("touchmove",l);var d=1,p=d}}e.exports=r},function(e,t,i){"use strict";e.exports={Menu:i(177),TipAnimation:i(181),PopUpTip:i(184)}},function(e,t,i){"use strict";e.exports={THREE:i(281),ThreeObjParseUtils:i(188),NBGroup:i(80),box2d:i(304),BlendCharacter:i(189),InteractiveManager:i(178)}},function(e,t,i){"use strict";function r(){if(null==n){var e=a.W,t=a.H,i=instance.get3DCanvas();try{n=new THREE.WebGLRenderer({antialias:!0,alpha:!0,canvas:i})}catch(e){var r;r=window.require?confirm("您的显卡不支持webGL,已自动切换为普通渲染模式，可能某些3D效果将无法呈现!请检查您的显卡版本及显卡驱动版本!"):nb.stem.isAndroid?confirm("您的设备不支持webGL,已自动切换为普通渲染模式，可能某些3D效果将无法呈现!请您尝试升级安卓版本!"):confirm("您的浏览器不支持webGL,已自动切换为普通渲染模式，可能某些3D效果将无法呈现!您是否需要更换浏览器"),r&&updateBrowser(),n=new THREE.CanvasRenderer({antialias:!0,alpha:!0,canvas:i})}n.shadowMap.enabled=!0,n.shadowMapType=THREE.PCFSoftShadowMap,n.shadowMap.cullFace=THREE.CullFaceBack,n.domElement.id="threeJS",n.setClearColor(0,0),n.setSize(e,t);n.domElement.style.position="absolute",document.body.insertBefore(n.domElement,instance.canvas)}}var n,o=(i(282),i(294)),s=i(171),a=i(39),l=i(295),h=i(78),c=i(188),u=i(172),f=i(80),d=i(296),p=i(297),m=s(Object,{textureMap:{},init:function(e,t){if(void 0===e)return void console.warn("需要传入 frame");THREE.ImageUtils.crossOrigin=nb.config.crossOrigin,t=t||{},this._config=t;var o=a.W,s=a.H;instance.get3DCanvas();r(),this.observeManager=new l(this),this.canvasRenderer=this.canvas=n;var c=new THREE.PerspectiveCamera(80,o/s,nb.CAMERA_NEAR,3e3);this.camera=c;var u=new THREE.Scene;c.position.set(0,0,100),c.updateProjectionMatrix(),this.scene=u,window.addEventListener("resize",onresize),window.onresize=function(){var e=$(window).width(),t=$(window).height();nb.stem.isIOS&&window.parent&&(e=$(window.parent).width(),t=$(window.parent).height());var i=e/t,r=nb.canvasWidth/nb.canvasHeight,o=n.domElement;i>r?(o.width=nb.canvasWidth*(i/r),o.height=nb.canvasHeight):(o.width=nb.canvasWidth,o.height=nb.canvasHeight/(i/r));var s=(o.width,o.height,a.W),l=a.H,h=s/2-(s-nb.stackPosX)/2-nb.stackPosX;c.setViewOffset&&c.setViewOffset(s,l,h,0,s,l),n.setSize(s,l),c.updateProjectionMatrix(),o.style.width=e+"px",o.style.height=t+"px"},setTimeout(onresize,10);var f=i(298),p=t.controls||{minDistance:200,maxDistance:500,noZoom:!1,noPan:!0,enabled:!0},m=new f(c,instance.canvas);m.noZoom=void 0!=p.noZoom&&p.noZoom,m.noRotate=void 0!=p.noRotate&&p.noRotate,m.noPan=void 0==p.noPan||p.noPan,m.enabled=void 0==p.enabled||p.enabled,this.controls=m,e.threeSystem=this,this.frame2D=e,h.apply(e);for(var g=0;g<e.children.length;g++){var v=e.children[g],y=v.threeData;if(void 0!==y){var _=y.linkage,b=null;if(-1!==_.indexOf("nb.three.Plane"))b=this.addPlane(instance.baseURI+y.url);else if(-1!==_.indexOf("nb.three.Box")){var x=[instance.baseURI+y.right.url,instance.baseURI+y.left.url,instance.baseURI+y.top.url,instance.baseURI+y.bottom.url,instance.baseURI+y.front.url,instance.baseURI+y.behind.url];b=this.addBox(x,y)}v.name&&""!==v.name&&null!==b&&(e[v.name]=b),b.position.copy(this.convertPixiPostionToLocal(v)),v.parent.removeChild(v),v.destroy(),g--}}this.parseNBSConf(e,t);var T=this;this.scope=T,e.addEventListener("onResume",this.frameOnResume.bind(this)),e.addEventListener("onPause",this.frameOnPause.bind(this)),this.vrSelector=new d(this)},setVRMode:function(e){this.vrMode=e,void 0===this.vrConf&&this.setVRConfig();var t=this.getEyesHorizDirection();this.leftEyeDirection=t.left,this.rightEyeDirection=t.right,instance.menu.setVisible(!e)},getEyesHorizDirection:function(){var e={},t=new THREE.Vector3(0,1,0),i=(new THREE.Vector3).subVectors(this.controls.target,this.camera.position);return i.projectOnPlane(t),e.left=i.clone().applyAxisAngle(t,Math.PI/2).normalize(),e.right=i.clone().applyAxisAngle(t,-Math.PI/2).normalize(),e},setVRConfig:function(e){if(e=e||{},(void 0===e.eyeDistance||e.eyeDistance<0)&&(e.eyeDistance=1),(void 0===e.accelerationScale||e.accelerationScale<0)&&(e.accelerationScale=100),e.useOrientation=void 0!==e.useOrientation&&e.useOrientation,e.isLookAtTarget=void 0!==e.isLookAtTarget&&e.isLookAtTarget,e.useZoomIn=void 0!==e.useZoomIn&&e.useZoomIn,e.showVRSelector=void 0!==e.showVRSelector&&e.showVRSelector,e.showVRSelector?this.frame2D.addChild(this.vrSelector):this.frame2D.removeChild(this.vrSelector),this.vrConf=e,e.useOrientation&&void 0===this.hasOrientationListener){var t=this;this.hasOrientationListener=!0;var i=0,r=0,n=0;this.deviceAccelerationQueue=[],window.addEventListener("deviceorientation",function(e){void 0===t.orientationEuler&&(t.orientationEuler=new THREE.Euler),i=e.alpha/180*Math.PI,r=e.beta/180*Math.PI,n=e.gamma/180*Math.PI,t.orientationEuler.set(r,i,-n,"YXZ")})}},loadNBSFile:function(e){var t=new f,r=i(299);e.scene=this.scene;var n=e.callback,o=this;e.callback=function(t){t.traverse(function(i){if(void 0!==e.children){var r=e.children[i.name];if(t===i&&(r=e),void 0!=r){if(void 0===o._config||i.parent instanceof THREE.Scene||i instanceof THREE.Light){var n=r.m.elements;for(var s in n)i.matrix.elements[s]=n[s];i.matrix.decompose(i.position,i.quaternion,i.scale)}i.visible=r.v,i.castShadow=r.castShadow,i.receiveShadow=r.receiveShadow,i.system=o}if(i.material){var a=i.material.uuid;if(!e.scene.materialConfMap)return;var l=e.scene.materialConfMap,h=l[a];if(void 0===h){console.warn(a+"纹理可能不存在,进行第二轮搜索");var c=!0;for(var s in l)if(i.material.name&&l[s].name===i.material.name&&""!==i.material.name){c=!1,i.material.uuid=s,h=l[s];break}if(c)return void console.warn(a+"纹理不存在")}var u=i.material;if(void 0===u.isParsed){var f=function(t,i){if(null!=i){if(i.sourceFile){var r=THREE.ImageUtils.loadTexture(e.basePath+i.sourceFile);r.sourceFile=i.sourceFile,u[t]=r}r=u[t],r&&(i.rx&&(r.repeat.x=i.rx),i.ry&&(r.repeat.y=i.ry),i.ws&&(r.wrapS=i.ws),i.wt&&(r.wrapT=i.wt))}};u.isParsed=!0,u.color.setHex(h.color),u.emissive.setHex(h.emissive),u.specular.setHex(h.specular),u.shininess=h.shininess,u.skinning=h.skinning,u.side=h.side,u.shading=h.shading,u.blending=h.blending,u.opacity=h.opacity,u.transparent=h.transparent,u.alphaTest=h.alphaTest,u.wireframe=h.wireframe,u.bumpScale=h.bumpScale,u.displacementScale=h.displacementScale,f("map",h.map),f("alphaMap",h.alphaMap),f("bumpMap",h.bumpMap),f("normalMap",h.normalMap),f("displacementMap",h.displacementMap),f("specularMap",h.specularMap),f("envMap",h.envMap),f("lightMap",h.lightMap),f("aoMap",h.aoMap)}}}}),o.observeManager&&e.observe&&o.observeManager.parseScene(t,Object.create(e.observe)),n&&n(t),window.editor&&window.editor.addObject(t)};var s=new r;return e.group=t,s.load(e),t},parseNBSConf:function(e,t){function r(){e.removeChild(s),console.log("============end load============="),e.nbsLoadComplete&&($("#loading-bar-spinner").fadeOut(function(){$("#loading-bar-spinner").remove()}),e.nbsLoadComplete(),instance.firstCircle=!0)}var n=e.nbsConf;if(void 0!==n){var o=i(303),s=new o;e.addChild(s);var a=e.toLocal({x:nb.stem.STEMMain.W/2,y:nb.stem.STEMMain.H/2});s.x=a.x,s.y=a.y,console.log("==========start load============="),n=JSON.parse(e.nbsConf);for(var l=n.length,h=0,u=function(){++h==l&&r()},f={},d=function(e){f[e.url]=e;var t=0,i=0;for(var r in f)t+=f[r].total,i+=f[r].loaded;s.setPercent(i/t)},p=t.iosModels||[],m=0;m<l;m++){var g=n[m];if(!g.name||"6666/model"!=g.name||nb.stem.isPC)if(void 0==g.type){if(g.callback=u,g.observe=t.observe,g.progressCallback=d,nb.stem.isIOS||nb.stem.MicApp||!nb.stem.isPC)if(-1!=p.indexOf(g.id))if(g.id.endsWith(".dae")){var v=g.id.split(".dae")[0];g.id=v+"_ios.dae"}else-1===g.id.indexOf("/")&&(g.id=g.id+"/dat_ios");else"0145/model.dae"==g.id&&(g.id="0145/model_ios.dae");var y=this.loadNBSFile(g);this.scene.add(y)}else c.parse(g,this.scene),h++;else h++,this.scene.fog=null}h===l&&setTimeout(r,500)}},convertPixiPostionToLocal:function(e){var t=a.STACK_WIDTH,i=a.H,r=-(t/2-e.x),n=i/2-e.y;return new THREE.Vector3(r,n,0)},addPlane:function(e,t){t=t||{},t.position=t.position||new THREE.Vector3;var i=this.scene;o.loadTexture(e,function(e){var t=new THREE.PlaneGeometry(e.image.width,e.image.height);e.minFilter=THREE.LinearFilter;var n=new THREE.MeshBasicMaterial({map:e,wireframe:!1,side:THREE.DoubleSide});r.geometry=t,r.material=n,i.add(r)});var r=new THREE.Mesh;return r.position.set(t.position.x,t.position.y,t.position.z),r},addBox:function(e,t){t=t||{};for(var i=[],r=0,n=this,s=0;s<e.length;s++){var a={},l=new THREE.MeshLambertMaterial(a);o.loadTexture(e[s],function(o){return function(s){if(r===e.length-1){var a=new THREE.MeshFaceMaterial(i),l=new THREE.BoxGeometry(t.w||300,t.h||300,t.d||300);l.uvsNeedUpdate=!0,l.dynamic=!0,h.geometry=l,h.material=a,l.faceVertexUvs[0][10]=[new THREE.Vector2(1,0),new THREE.Vector2(1,1),new THREE.Vector2(0,0)],l.faceVertexUvs[0][11]=[new THREE.Vector2(1,1),new THREE.Vector2(0,1),new THREE.Vector2(0,0)],n.add(h)}r++,o.map=s,s.minFilter=THREE.LinearFilter}}(l)),i.push(l)}var h=new THREE.Mesh;return h},add:function(e){this.scene.add(e),e.threeSystem=this},remove:function(e){delete e.threeSystem,this.scene.remove(e)},render:function(){if(!1!==this.renderable)if(this.vrMode){this.canvas.setClearColor(0,0),this.controls.update(),void 0===this.leftCamera&&(this.leftCamera=this.camera.clone(),this.rightCamera=this.camera.clone(),this.scene.add(this.leftCamera),this.scene.add(this.rightCamera));var e=this.vrConf.eyesDistance/2;if(this.vrConf.useOrientation){var t=this.orientationEuler;if(!t)return;var i=new THREE.Quaternion;i.setFromEuler(t);var r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),o=Math.PI*-window.orientation/360,s=new THREE.Quaternion(0,Math.sin(o),0,Math.cos(o));if(i.multiply(s).multiply(r),this.vrConf.isLookAtTarget){var l=(new THREE.Vector3).subVectors(this.camera.position,this.controls.target);l.applyQuaternion(i),l.add(this.controls.target);var h=this.getEyesHorizDirection(),c=h.left.multiplyScalar(e),u=h.right.multiplyScalar(e);this.vrConf.useZoomIn?(this.leftCamera.position.copy(c).add(this.camera.position).add(l),this.rightCamera.position.copy(u).add(this.camera.position).add(l)):(this.leftCamera.position.copy(c).add(l),this.rightCamera.position.copy(u).add(l)),this.leftCamera.lookAt(this.controls.target),this.rightCamera.lookAt(this.controls.target)}else{this.leftCamera.rotation.setFromQuaternion(i),this.rightCamera.rotation.setFromQuaternion(i),this.camera.rotation.setFromQuaternion(i);var f=this.leftEyeDirection.clone().multiplyScalar(e),d=this.rightEyeDirection.clone().multiplyScalar(e);f.applyQuaternion(i),d.applyQuaternion(i),f.add(this.camera.position),d.add(this.camera.position),this.leftCamera.position.copy(f),this.rightCamera.position.copy(d)}}else{var h=this.getEyesHorizDirection(),c=h.left.multiplyScalar(e),u=h.right.multiplyScalar(e);this.leftCamera.position.copy(c).add(this.camera.position),this.rightCamera.position.copy(u).add(this.camera.position),this.leftCamera.lookAt(this.controls.target),this.rightCamera.lookAt(this.controls.target)}var p=nb.stem.STEMMain.W,m=nb.stem.STEMMain.H,g=0,v=0,y=.5*p,_=m;n.setViewport(g,v,y,_),n.setScissor(g,v,y,_),n.setScissorTest(!0),this.leftCamera.aspect=y/_,this.leftCamera.updateProjectionMatrix(),n.render(this.scene,this.leftCamera),g=.5*p,v=0,y=.5*p,_=m,n.setViewport(g,v,y,_),n.setScissor(g,v,y,_),n.setScissorTest(!0),this.rightCamera.aspect=y/_,this.rightCamera.updateProjectionMatrix(),n.render(this.scene,this.rightCamera)}else n.setViewport(0,0,a.W,a.H),n.setScissor(0,0,a.W,a.H),this.controls&&this.controls.update(),this.scene.fog?this.canvas.setClearColor(this.scene.fog.color):this.canvas.setClearColor(0,0),this.canvas.render(this.scene,this.camera)},isLoaded:function(){return o.isLoaded()},rotateCamera:function(e,t,i,r,n,o){null==o&&(o=this.camera.position);var s=o.clone(),a=this;n=n||{};var l=this.camera;this.__r__=0,n.__r__=1,n.onUpdate=function(){var r=s.clone(),n=a.__r__;e&&r.applyAxisAngle(new THREE.Vector3(1,0,0),e*n),t&&r.applyAxisAngle(new THREE.Vector3(0,1,0),t*n),i&&r.applyAxisAngle(new THREE.Vector3(0,0,1),i*n),l.position.copy(r),l.lookAt(new THREE.Vector3(0,0,0))};TweenMax.to(this,r,n)},hide:function(){this.controls.active=!1,this.scene.visible=!1,this.render()},addAmbientLight:function(e){var t=new THREE.AmbientLight(e||4210752);return this.add(t),t},addShadow:function(){for(var e=0;e<arguments.length;e++){arguments[e].traverse(function(e){e instanceof THREE.Mesh&&(e.castShadow=!0)})}},addReceiveShadow:function(){for(var e=0;e<arguments.length;e++){arguments[e].traverse(function(e){e instanceof THREE.Mesh&&(e.receiveShadow=!0)})}},tweenTo:function(e,t,i){i=i||{};var r=void 0===i.timer?2:i.timer,n=t.position,o=this;if(e instanceof THREE.Camera){TweenMax.killTweensOf(e),TweenMax.killTweensOf(e.position);var s=function(){i.onComplete&&i.onComplete(),o.controls.resetZoom(),console.log("reset zoom value")};if(i.through instanceof Array&&i.through.length>0){var a=new TimelineMax,l=i.through.concat();l.push(t.position);for(var h=0;h<l.length;h++){var c=l[h];a.append(TweenMax.to(e.position,r/l.length,{delay:i.delay,x:c.x,y:c.y,z:c.z}))}TweenMax.to(e,r,{fov:t.fov,near:nb.CAMERA_NEAR,far:t.far,onUpdate:function(){i.onUpdate&&i.onUpdate(),e.updateProjectionMatrix()},onComplete:s})}else TweenMax.to(e.position,r,{delay:i.delay,x:n.x,y:n.y,z:n.z,onComplete:s,onUpdate:i.onUpdate}),TweenMax.to(e,r,{fov:t.fov,near:nb.CAMERA_NEAR,far:t.far,onUpdate:function(){e.updateProjectionMatrix()}})}else TweenMax.to(e.position,r,{delay:i.delay,x:n.x,y:n.y,z:n.z,onComplete:i.onComplete,onUpdate:i.onUpdate})},show:function(){this.controls&&(this.controls.active=!0),this.scene.visible=!0,this.render()},remove3DDrag:function(e){e.__touchBegin__&&(e.removeEventListener(TouchEvent.TOUCH_BEGIN,e.__touchBegin__),e.__touchEnd__&&e.__touchEnd__(null,!1),delete e.__touchEnd__)},add3DRotation:function(e){function t(e){if(0!=this.matrixAutoUpdate&&!1!==d.enabled){e.stopPropagation(),g&&g();var t=l.parent.localToWorld(l.position.clone());s.position.copy(t);var a=l.position.clone();a.add(c),a=l.parent.localToWorld(a),s.lookAt(a),f.render();var u=m.getInteractiveObject(e.data.global,[s]);if(u&&u.point){s.worldToLocal(u.point),n=u.point,o=Math.atan2(n.y,n.x),f.scene.addEventListener(TouchEvent.TOUCH_MOVE,i),f.scene.addEventListener(TouchEvent.TOUCH_END,r),f.scene.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,r),d.enabled=!1,f.frame2D.addChild(w);var p=h.obj3DVecToDisPoint(s,new THREE.Vector3,f.camera,f.frame2D);w.x=p.x,w.y=p.y,w.startListener(e)}}}function i(e){var t=m.getInteractiveObject(e.data.global,[s]);if(t&&t.point){s.worldToLocal(t.point),n=t.point;var i=Math.atan2(n.y,n.x),r=i-o;if(o=i,r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r=2*Math.PI+r),T+=r,E>T&&(T-=r,r=E-T,T+=r),S<T&&(T-=r,r=S-T,T+=r),0!==r&&v&&v({offset:r}),_){l.applyMatrix(b);var a=new THREE.Matrix4;a.makeRotationAxis(c,r),l.applyMatrix(a),l.applyMatrix(x)}else l.rotation.x+=c.x*r,l.rotation.y+=c.y*r,l.rotation.z+=c.z*r}}function r(e){d.enabled=!0,f.scene.removeEventListener(TouchEvent.TOUCH_MOVE,i),f.scene.removeEventListener(TouchEvent.TOUCH_END,r),f.scene.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,r),w.end(),y&&y({angle:T})}var n,o,s=this.createRefPanel(),a=e.collideObj,l=e.rotateObj,c=e.axis?e.axis:new THREE.Vector3(1,0,0),u=e.pivot?e.pivot:new THREE.Vector3,f=this,d=this.controls,m=instance.interactiveManager,g=e.onStart,v=e.onUpdate,y=e.onComplete,_=void 0===e.useMatrix||e.useMatrix,b=new THREE.Matrix4;b.makeTranslation(-u.x,-u.y,-u.z);var x=b.clone();x=x.getInverse(x);var T=0,E=void 0!==e.startAngle?e.startAngle:NaN,S=void 0!==e.endAngle?e.endAngle:NaN,w=new p;a.addEventListener(TouchEvent.TOUCH_BEGIN,t),a.addEventListener(MouseEvent.MOUSE_OVER,function(){}),l.changeRangeAngle=function(e){T=e},l.change3DRotantion_StartAngle=function(e){E=e},l.change3DRotantion_EndAngle=function(e){S=e}},add3DDrag:function(e){var t=e.mesh,i=e.n,r=e.v,n=this.controls,o=this.scene,s=instance.interactiveManager,a=this.camera,l=this,h=this.createRefPanel(),c=e.scale||1,f=(new THREE.Vector3,e.nBounds);if(f)var d=t.position.clone().add(new THREE.Vector3(f.xMin,f.yMin,f.zMin)),p=t.position.clone().add(new THREE.Vector3(f.xMax,f.yMax,f.zMax));var m=(new THREE.Vector3,new THREE.Vector3,function(e){if(!1!==n.enabled){h.lookAt(a.position),h.position.copy(this.position),l.render();var m=s.getInteractiveObject(e.data.global,[h]),g=function(e){var n=s.getInteractiveObject(e.data.global,[h]);if(i){var o=n.point.clone().sub(m.point);o.multiplyScalar(c),m=n,o.projectOnPlane(i),void 0===f?t.position.add(o):(t.position.add(o),t.position.x>p.x?t.position.x=p.x:t.position.x<d.x&&(t.position.x=d.x),t.position.y>p.y?t.position.y=p.y:t.position.y<d.y&&(t.position.y=d.y),t.position.z>p.z?t.position.z=p.z:t.position.z<d.z&&(t.position.z=d.z))}else{var o=n.point.clone().sub(m.point);m=n,o.projectOnVector(r),t.position.add(o)}t.dispatchEvent({type:u.event.DRAG_MOVE})},v=function e(i,r){o.removeEventListener(TouchEvent.TOUCH_MOVE,g),o.removeEventListener(TouchEvent.TOUCH_END,e),n.enabled=!0,void 0!==r&&!0!==r||t.dispatchEvent({type:u.event.STOP_DRAG}),delete t.__touchEnd__};n.enabled=!1,o.addEventListener(TouchEvent.TOUCH_MOVE,g),o.addEventListener(TouchEvent.TOUCH_END,v),t.__touchEnd__=v,t.dispatchEvent({type:u.event.START_DRAG})}});t.addEventListener(TouchEvent.TOUCH_BEGIN,m),t.__touchBegin__=m},cloneToCamera:function(e){this.camera.position.copy(e.position),this.camera.rotation.copy(e.rotation),this.camera.fov=e.fov,this.camera.near=e.near,this.camera.far=e.far;var t=ThreeUtil.getCameraLookDir(e);this.controls.target=t,this.camera.updateProjectionMatrix()},addPhyDrag:function(e,t){this.addDrag(e,{phySystem:{world:t}})},createRefPanel:function(){var e=this.scene;if(void 0==e.__refPlane__){var t=new THREE.Mesh(new THREE.PlaneBufferGeometry(200*a.W,200*a.H,2,2),new THREE.MeshBasicMaterial({color:0,opacity:.25,transparent:!0,visible:!1,side:THREE.DoubleSide}));e.add(t),t.name="nbRef_Plane",e.__refPlane__=t}return e.__refPlane__},addDrag:function(e,t){var i=this;if(void 0===this.scene.refPlane){var r=function(e,t,i){_.position.set(e,t,i),c.update()},n=function(){v.removeConstraint(c),c=!1},o=function(e,t,i,r){g=r;var n=new CANNON.Vec3(e,t,i).vsub(g.position),o=g.quaternion.inverse(),s=o.vmult(n);_.position.set(e,t,i),c=new CANNON.PointToPointConstraint(g,s,_,new CANNON.Vec3(0,0,0)),v.addConstraint(c)};t=t||{};var s=this.camera,l=this.scene,h=new THREE.Mesh(new THREE.PlaneBufferGeometry(2*a.W,2*a.H,8,8),new THREE.MeshBasicMaterial({color:0,opacity:.25,transparent:!0}));h.visible=!1,l.add(h),l.dragObj=[],l.refPlane=h;var c,u=null,f=l.dragObj,d=new THREE.Vector2,p=new THREE.Vector3,m=new THREE.Raycaster;if(void 0!==t.phySystem){var g,v=t.phySystem.world,y=new CANNON.Sphere(.1),_=new CANNON.Body({mass:0});_.addShape(y),_.collisionFilterGroup=0,_.collisionFilterMask=0,v.add(_)}var b=function(e){if(!1!==l.visible){e.preventDefault(),x(d,e),m.setFromCamera(d,s);var r=m.intersectObjects(f);if(r.length>0){if(u=r[0].object,h.position.copy(u.position),e instanceof TouchEvent&&i.render(),r=m.intersectObject(h),r.length>0&&p.copy(r[0].point).sub(h.position),t.phySystem){var n=u.position;o(n.x,n.y,n.z,u.body)}p.z=0,instance.canvas.addEventListener(TouchEvent.TOUCH_MOVE,T),instance.canvas.addEventListener(MouseEvent.TOUCH_MOVE,T),instance.canvas.addEventListener(TouchEvent.TOUCH_END,E),instance.canvas.addEventListener(MouseEvent.TOUCH_END,E),instance.canvas.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,E),instance.canvas.addEventListener(MouseEvent.TOUCH_END_OUDSIDE,E)}}},x=function(e,t){var i=$("#threeJS").width(),r=$("#threeJS").height();if(t instanceof MouseEvent)var n=t.offsetX,o=t.offsetY;else{var s=t.touches[t.touches.length-1];n=s.pageX,o=s.pageY}e.x=n/i*2-1,e.y=-o/r*2+1},T=function(e){if(e.preventDefault(),x(d,e),m.setFromCamera(d,s),u){var i=m.intersectObject(h);if(i.length>0){var n=i[0].point.sub(p);t.phySystem?r(n.x,n.y,n.z):u.position.copy(n)}}},E=function e(i){i.preventDefault(),u=null,instance.canvas.removeEventListener(TouchEvent.TOUCH_MOVE,T),instance.canvas.removeEventListener(MouseEvent.TOUCH_MOVE,T),instance.canvas.removeEventListener(TouchEvent.TOUCH_END,e),instance.canvas.removeEventListener(MouseEvent.TOUCH_END,e),instance.canvas.removeEventListener(TouchEvent.TOUCH_END_OUDSIDE,e),instance.canvas.removeEventListener(MouseEvent.TOUCH_END_OUDSIDE,e),t.phySystem&&n()};instance.canvas.addEventListener(TouchEvent.TOUCH_BEGIN,b),instance.canvas.addEventListener(MouseEvent.TOUCH_BEGIN,b);var S=function(e){if(!1!==l.visible&&null==u){event.preventDefault(),x(d,event),m.setFromCamera(d,s);var t=m.intersectObjects(f);t.length>0&&h.position.copy(t[0].object.position)}};instance.canvas.addEventListener(TouchEvent.TOUCH_MOVE,S),instance.canvas.addEventListener(MouseEvent.TOUCH_MOVE,S)}this.scene.dragObj.push(e)},dataTrans:function(e){this.frame2D.removeEventListener("onResume",this.frameOnResume),this.frame2D.removeEventListener("onPause",this.frameOnPause),e.threeSystem=this,instance.threeSystem=this,this.frame2D=e,h.apply(e),e.addEventListener("onResume",this.frameOnResume.bind(this)),e.addEventListener("onPause",this.frameOnPause.bind(this)),this.vrSelector.frame2D=this.frame2D},frameOnResume:function(e){var t=this;this.threeFog&&(this.scene.fog=this.threeFog),setTimeout(function(){t.show()},1e3)},frameOnPause:function(e){this.threeFog=scene.fog,this.scene.fog=null,this.hide(),this.scope.render()}});e.exports=m},function(e,t,i){(function(e){var r=i(283),n=i(286),o=i(287),s=i(288),a=t;a.request=function(t,i){t="string"==typeof t?s.parse(t):n(t);var o=-1===e.location.protocol.search(/^https?:$/)?"http:":"",a=t.protocol||o,l=t.hostname||t.host,h=t.port,c=t.path||"/";l&&-1!==l.indexOf(":")&&(l="["+l+"]"),t.url=(l?a+"//"+l:"")+(h?":"+h:"")+c,t.method=(t.method||"GET").toUpperCase(),t.headers=t.headers||{};var u=new r(t);return i&&u.on("response",i),u},a.get=function(e,t){var i=a.request(e,t);return i.end(),i},a.Agent=function(){},a.Agent.defaultMaxSockets=4,a.STATUS_CODES=o,a.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(t,i(1))},function(e,t,i){(function(t,r,n){function o(e,t){return a.fetch&&t?"fetch":a.mozchunkedarraybuffer?"moz-chunked-arraybuffer":a.msstream?"ms-stream":a.arraybuffer&&e?"arraybuffer":a.vbArray&&e?"text:vbarray":"text"}function s(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}}var a=i(185),l=i(0),h=i(284),c=i(20),u=i(285),f=h.IncomingMessage,d=h.readyStates,p=e.exports=function(e){var i=this;c.Writable.call(i),i._opts=e,i._body=[],i._headers={},e.auth&&i.setHeader("Authorization","Basic "+new t(e.auth).toString("base64")),Object.keys(e.headers).forEach(function(t){i.setHeader(t,e.headers[t])});var r,n=!0;if("disable-fetch"===e.mode||"timeout"in e)n=!1,r=!0;else if("prefer-streaming"===e.mode)r=!1;else if("allow-wrong-content-type"===e.mode)r=!a.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");r=!0}i._mode=o(r,n),i.on("finish",function(){i._onFinish()})};l(p,c.Writable),p.prototype.setHeader=function(e,t){var i=this,r=e.toLowerCase();-1===m.indexOf(r)&&(i._headers[r]={name:e,value:t})},p.prototype.getHeader=function(e){var t=this._headers[e.toLowerCase()];return t?t.value:null},p.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},p.prototype._onFinish=function(){var e=this;if(!e._destroyed){var i=e._opts,o=e._headers,s=null;"GET"!==i.method&&"HEAD"!==i.method&&(s=a.blobConstructor?new r.Blob(e._body.map(function(e){return u(e)}),{type:(o["content-type"]||{}).value||""}):t.concat(e._body).toString());var l=[];if(Object.keys(o).forEach(function(e){var t=o[e].name,i=o[e].value;Array.isArray(i)?i.forEach(function(e){l.push([t,e])}):l.push([t,i])}),"fetch"===e._mode)r.fetch(e._opts.url,{method:e._opts.method,headers:l,body:s||void 0,mode:"cors",credentials:i.withCredentials?"include":"same-origin"}).then(function(t){e._fetchResponse=t,e._connect()},function(t){e.emit("error",t)});else{var h=e._xhr=new r.XMLHttpRequest;try{h.open(e._opts.method,e._opts.url,!0)}catch(t){return void n.nextTick(function(){e.emit("error",t)})}"responseType"in h&&(h.responseType=e._mode.split(":")[0]),"withCredentials"in h&&(h.withCredentials=!!i.withCredentials),"text"===e._mode&&"overrideMimeType"in h&&h.overrideMimeType("text/plain; charset=x-user-defined"),"timeout"in i&&(h.timeout=i.timeout,h.ontimeout=function(){e.emit("timeout")}),l.forEach(function(e){h.setRequestHeader(e[0],e[1])}),e._response=null,h.onreadystatechange=function(){switch(h.readyState){case d.LOADING:case d.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(h.onprogress=function(){e._onXHRProgress()}),h.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{h.send(s)}catch(t){return void n.nextTick(function(){e.emit("error",t)})}}}},p.prototype._onXHRProgress=function(){var e=this;s(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},p.prototype._connect=function(){var e=this;e._destroyed||(e._response=new f(e._xhr,e._fetchResponse,e._mode),e._response.on("error",function(t){e.emit("error",t)}),e.emit("response",e._response))},p.prototype._write=function(e,t,i){this._body.push(e),i()},p.prototype.abort=p.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr&&e._xhr.abort()},p.prototype.end=function(e,t,i){var r=this;"function"==typeof e&&(i=e,e=void 0),c.Writable.prototype.end.call(r,e,t,i)},p.prototype.flushHeaders=function(){},p.prototype.setTimeout=function(){},p.prototype.setNoDelay=function(){},p.prototype.setSocketKeepAlive=function(){};var m=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(t,i(3).Buffer,i(1),i(8))},function(e,t,i){(function(e,r,n){var o=i(185),s=i(0),a=i(20),l=t.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},h=t.IncomingMessage=function(t,i,n){function s(){h.read().then(function(e){if(!l._destroyed){if(e.done)return void l.push(null);l.push(new r(e.value)),s()}}).catch(function(e){l.emit("error",e)})}var l=this;if(a.Readable.call(l),l._mode=n,l.headers={},l.rawHeaders=[],l.trailers={},l.rawTrailers=[],l.on("end",function(){e.nextTick(function(){l.emit("close")})}),"fetch"===n){l._fetchResponse=i,l.url=i.url,l.statusCode=i.status,l.statusMessage=i.statusText,i.headers.forEach(function(e,t){l.headers[t.toLowerCase()]=e,l.rawHeaders.push(t,e)});var h=i.body.getReader();s()}else{l._xhr=t,l._pos=0,l.url=t.responseURL,l.statusCode=t.status,l.statusMessage=t.statusText;if(t.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var i=t[1].toLowerCase();"set-cookie"===i?(void 0===l.headers[i]&&(l.headers[i]=[]),l.headers[i].push(t[2])):void 0!==l.headers[i]?l.headers[i]+=", "+t[2]:l.headers[i]=t[2],l.rawHeaders.push(t[1],t[2])}}),l._charset="x-user-defined",!o.overrideMimeType){var c=l.rawHeaders["mime-type"];if(c){var u=c.match(/;\s*charset=([^;])(;|$)/);u&&(l._charset=u[1].toLowerCase())}l._charset||(l._charset="utf-8")}}};s(h,a.Readable),h.prototype._read=function(){},h.prototype._onXHRProgress=function(){var e=this,t=e._xhr,i=null;switch(e._mode){case"text:vbarray":if(t.readyState!==l.DONE)break;try{i=new n.VBArray(t.responseBody).toArray()}catch(e){}if(null!==i){e.push(new r(i));break}case"text":try{i=t.responseText}catch(t){e._mode="text:vbarray";break}if(i.length>e._pos){var o=i.substr(e._pos);if("x-user-defined"===e._charset){for(var s=new r(o.length),a=0;a<o.length;a++)s[a]=255&o.charCodeAt(a);e.push(s)}else e.push(o,e._charset);e._pos=i.length}break;case"arraybuffer":if(t.readyState!==l.DONE||!t.response)break;i=t.response,e.push(new r(new Uint8Array(i)));break;case"moz-chunked-arraybuffer":if(i=t.response,t.readyState!==l.LOADING||!i)break;e.push(new r(new Uint8Array(i)));break;case"ms-stream":if(i=t.response,t.readyState!==l.LOADING)break;var h=new n.MSStreamReader;h.onprogress=function(){h.result.byteLength>e._pos&&(e.push(new r(new Uint8Array(h.result.slice(e._pos)))),e._pos=h.result.byteLength)},h.onload=function(){e.push(null)},h.readAsArrayBuffer(i)}e._xhr.readyState===l.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(t,i(8),i(3).Buffer,i(1))},function(e,t,i){var r=i(3).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),i=e.length,n=0;n<i;n++)t[n]=e[n];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t){function i(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var n in i)r.call(i,n)&&(e[n]=i[n])}return e}e.exports=i;var r=Object.prototype.hasOwnProperty},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,i){"use strict";function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function n(e,t,i){if(e&&h.isObject(e)&&e instanceof r)return e;var n=new r;return n.parse(e,t,i),n}function o(e){return h.isString(e)&&(e=n(e)),e instanceof r?e.format():r.prototype.format.call(e)}function s(e,t){return n(e,!1,!0).resolve(t)}function a(e,t){return e?n(e,!1,!0).resolveObject(t):t}var l=i(289),h=i(290);t.parse=n,t.resolve=s,t.resolveObject=a,t.format=o,t.Url=r;var c=/^([a-z0-9.+-]+:)/i,u=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,d=["<",">",'"',"`"," ","\r","\n","\t"],p=["{","}","|","\\","^","`"].concat(d),m=["'"].concat(p),g=["%","/","?",";","#"].concat(m),v=["/","?","#"],y=/^[+a-z0-9A-Z_-]{0,63}$/,_=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,b={javascript:!0,"javascript:":!0},x={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},E=i(291);r.prototype.parse=function(e,t,i){if(!h.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),n=-1!==r&&r<e.indexOf("#")?"?":"#",o=e.split(n),s=/\\/g;o[0]=o[0].replace(s,"/"),e=o.join(n);var a=e;if(a=a.trim(),!i&&1===e.split("#").length){var u=f.exec(a);if(u)return this.path=a,this.href=a,this.pathname=u[1],u[2]?(this.search=u[2],this.query=t?E.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=c.exec(a);if(d){d=d[0];var p=d.toLowerCase();this.protocol=p,a=a.substr(d.length)}if(i||d||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var S="//"===a.substr(0,2);!S||d&&x[d]||(a=a.substr(2),this.slashes=!0)}if(!x[d]&&(S||d&&!T[d])){for(var w=-1,M=0;M<v.length;M++){var A=a.indexOf(v[M]);-1!==A&&(-1===w||A<w)&&(w=A)}var P,C;C=-1===w?a.lastIndexOf("@"):a.lastIndexOf("@",w),-1!==C&&(P=a.slice(0,C),a=a.slice(C+1),this.auth=decodeURIComponent(P)),w=-1;for(var M=0;M<g.length;M++){var A=a.indexOf(g[M]);-1!==A&&(-1===w||A<w)&&(w=A)}-1===w&&(w=a.length),this.host=a.slice(0,w),a=a.slice(w),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var D=this.hostname.split(/\./),M=0,I=D.length;M<I;M++){var O=D[M];if(O&&!O.match(y)){for(var F="",L=0,B=O.length;L<B;L++)O.charCodeAt(L)>127?F+="x":F+=O[L];if(!F.match(y)){var N=D.slice(0,M),k=D.slice(M+1),V=O.match(_);V&&(N.push(V[1]),k.unshift(V[2])),k.length&&(a="/"+k.join(".")+a),this.hostname=N.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=l.toASCII(this.hostname));var U=this.port?":"+this.port:"",z=this.hostname||"";this.host=z+U,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!b[p])for(var M=0,I=m.length;M<I;M++){var G=m[M];if(-1!==a.indexOf(G)){var H=encodeURIComponent(G);H===G&&(H=escape(G)),a=a.split(G).join(H)}}var j=a.indexOf("#");-1!==j&&(this.hash=a.substr(j),a=a.slice(0,j));var W=a.indexOf("?");if(-1!==W?(this.search=a.substr(W),this.query=a.substr(W+1),t&&(this.query=E.parse(this.query)),a=a.slice(0,W)):t&&(this.search="",this.query={}),a&&(this.pathname=a),T[p]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",X=this.search||"";this.path=U+X}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&h.isObject(this.query)&&Object.keys(this.query).length&&(o=E.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||T[t])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),s=s.replace("#","%23"),t+n+i+s+r},r.prototype.resolve=function(e){return this.resolveObject(n(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(h.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var i=new r,n=Object.keys(this),o=0;o<n.length;o++){var s=n[o];i[s]=this[s]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),l=0;l<a.length;l++){var c=a[l];"protocol"!==c&&(i[c]=e[c])}return T[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!T[e.protocol]){for(var u=Object.keys(e),f=0;f<u.length;f++){var d=u[f];i[d]=e[d]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||x[e.protocol])i.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var m=i.pathname||"",g=i.search||"";i.path=m+g}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var v=i.pathname&&"/"===i.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),_=y||v||i.host&&e.pathname,b=_,E=i.pathname&&i.pathname.split("/")||[],p=e.pathname&&e.pathname.split("/")||[],S=i.protocol&&!T[i.protocol];if(S&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),_=_&&(""===p[0]||""===E[0])),y)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),i.search=e.search,i.query=e.query;else if(!h.isNullOrUndefined(e.search)){if(S){i.hostname=i.host=E.shift();var w=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@");w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return i.search=e.search,i.query=e.query,h.isNull(i.pathname)&&h.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var M=E.slice(-1)[0],A=(i.host||e.host||E.length>1)&&("."===M||".."===M)||""===M,P=0,C=E.length;C>=0;C--)M=E[C],"."===M?E.splice(C,1):".."===M?(E.splice(C,1),P++):P&&(E.splice(C,1),P--);if(!_&&!b)for(;P--;P)E.unshift("..");!_||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),A&&"/"!==E.join("/").substr(-1)&&E.push("");var R=""===E[0]||E[0]&&"/"===E[0].charAt(0);if(S){i.hostname=i.host=R?"":E.length?E.shift():"";var w=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@");w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return _=_||i.host&&E.length,_&&!R&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),h.isNull(i.pathname)&&h.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var e=this.host,t=u.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,i){(function(e,r){var n;!function(o){function s(e){throw new RangeError(I[e])}function a(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function l(e,t){var i=e.split("@"),r="";return i.length>1&&(r=i[0]+"@",e=i[1]),e=e.replace(D,"."),r+a(e.split("."),t).join(".")}function h(e){for(var t,i,r=[],n=0,o=e.length;n<o;)t=e.charCodeAt(n++),t>=55296&&t<=56319&&n<o?(i=e.charCodeAt(n++),56320==(64512&i)?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--)):r.push(t);return r}function c(e){return a(e,function(e){var t="";return e>65535&&(e-=65536,t+=L(e>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function u(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:x}function f(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,i){var r=0;for(e=i?F(e/w):e>>1,e+=F(e/t);e>O*E>>1;r+=x)e=F(e/O);return F(r+(O+1)*e/(e+S))}function p(e){var t,i,r,n,o,a,l,h,f,p,m=[],g=e.length,v=0,y=A,_=M;for(i=e.lastIndexOf(P),i<0&&(i=0),r=0;r<i;++r)e.charCodeAt(r)>=128&&s("not-basic"),m.push(e.charCodeAt(r));for(n=i>0?i+1:0;n<g;){for(o=v,a=1,l=x;n>=g&&s("invalid-input"),h=u(e.charCodeAt(n++)),(h>=x||h>F((b-v)/a))&&s("overflow"),v+=h*a,f=l<=_?T:l>=_+E?E:l-_,!(h<f);l+=x)p=x-f,a>F(b/p)&&s("overflow"),a*=p;t=m.length+1,_=d(v-o,t,0==o),F(v/t)>b-y&&s("overflow"),y+=F(v/t),v%=t,m.splice(v++,0,y)}return c(m)}function m(e){var t,i,r,n,o,a,l,c,u,p,m,g,v,y,_,S=[];for(e=h(e),g=e.length,t=A,i=0,o=M,a=0;a<g;++a)(m=e[a])<128&&S.push(L(m));for(r=n=S.length,n&&S.push(P);r<g;){for(l=b,a=0;a<g;++a)(m=e[a])>=t&&m<l&&(l=m);for(v=r+1,l-t>F((b-i)/v)&&s("overflow"),i+=(l-t)*v,t=l,a=0;a<g;++a)if(m=e[a],m<t&&++i>b&&s("overflow"),m==t){for(c=i,u=x;p=u<=o?T:u>=o+E?E:u-o,!(c<p);u+=x)_=c-p,y=x-p,S.push(L(f(p+_%y,0))),c=F(_/y);S.push(L(f(c,0))),o=d(i,v,r==n),i=0,++r}++i,++t}return S.join("")}function g(e){return l(e,function(e){return C.test(e)?p(e.slice(4).toLowerCase()):e})}function v(e){return l(e,function(e){return R.test(e)?"xn--"+m(e):e})}var y=("object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType,"object"==typeof r&&r);var _,b=2147483647,x=36,T=1,E=26,S=38,w=700,M=72,A=128,P="-",C=/^xn--/,R=/[^\x20-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=x-T,F=Math.floor,L=String.fromCharCode;_={version:"1.4.1",ucs2:{decode:h,encode:c},decode:p,encode:m,toASCII:v,toUnicode:g},void 0!==(n=function(){return _}.call(t,i,t,e))&&(e.exports=n)}()}).call(t,i(61)(e),i(1))},function(e,t,i){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,i){"use strict";t.decode=t.parse=i(292),t.encode=t.stringify=i(293)},function(e,t,i){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,i,o){t=t||"&",i=i||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var h=e.length;l>0&&h>l&&(h=l);for(var c=0;c<h;++c){var u,f,d,p,m=e[c].replace(a,"%20"),g=m.indexOf(i);g>=0?(u=m.substr(0,g),f=m.substr(g+1)):(u=m,f=""),d=decodeURIComponent(u),p=decodeURIComponent(f),r(s,d)?n(s[d])?s[d].push(p):s[d]=[s[d],p]:s[d]=p}return s};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,i){"use strict";function r(e,t){if(e.map)return e.map(t);for(var i=[],r=0;r<e.length;r++)i.push(t(e[r],r));return i}var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,i,a){return t=t||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?r(s(e),function(s){var a=encodeURIComponent(n(s))+i;return o(e[s])?r(e[s],function(e){return a+encodeURIComponent(n(e))}).join(t):a+encodeURIComponent(n(e[s]))}).join(t):a?encodeURIComponent(n(a))+i+encodeURIComponent(n(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.push(i);return t}},function(e,t,i){"use strict";nb.THREE.TextureUtils=function(){function e(){for(var e in t)if(0!==t[e].callbacks.length)return;i=!0}var t={},i=!1;nb.THREE.TextureUtils={isLoaded:function(){return i},loadTexture:function(r,n){if(void 0===t[r])t[r]={callbacks:[n]},i=!1,THREE.ImageUtils.loadTexture(r,{},function(i){t[r].texture=i;for(var n=t[r].callbacks;;){var o=n.pop();if(void 0===o)break;nb.THREE.TextureUtils.loadTexture(r,o),e()}});else if(void 0===t[r].texture)t[r].callbacks.push(n);else{var o=t[r].texture;n.apply(null,[o])}}}},nb.THREE.TextureUtils()},function(e,t,i){"use strict";(function(t){function r(e){s=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture("assets/textures/bg_2.jpg")}),this.system=e,this.observeArray=[],this.tipControlor=l}function n(e,t){for(var i=0;i<t.length;i++)if(""!==t[i]&&-1!==e.name.indexOf(t[i]))return!0;return!1}function o(){for(var e=this.parent,t=e;;)if(!(t=t.parent)||t instanceof THREE.Scene)break;this.showByType=function(e){switch(e){case THREE.OBSERVE_TYPE_HIDE:this.showBrothers();break;case THREE.OBSERVE_TYPE_HIGH_LIGHT:this.stopHighLightBrothers();break;case THREE.OBSERVE_TYPE_EDGES:this.setBrothersFromEdges();break;case THREE.OBSERVE_TYPE_EDGES_NEW:this.setBrothersFromEdges2()}},this.hideByType=function(e){switch(e){case THREE.OBSERVE_TYPE_HIDE:this.hideBrothers();break;case THREE.OBSERVE_TYPE_HIGH_LIGHT:this.highLightBrothers();break;case THREE.OBSERVE_TYPE_EDGES:this.setBrothersToEdges();break;case THREE.OBSERVE_TYPE_EDGES_NEW:this.setBrothersToEdges2()}},this.overByType=function(e){switch(e){case THREE.OBSERVE_TYPE_HIDE:this.over_hide();break;case THREE.OBSERVE_TYPE_HIGH_LIGHT:this.over_high_light()}},this.outByType=function(e){switch(e){case THREE.OBSERVE_TYPE_HIDE:this.out_hide();break;case THREE.OBSERVE_TYPE_HIGH_LIGHT:this.out_high_light()}},this.setBrothersToEdges2=function(){function i(e){if(e!=o){if(e instanceof THREE.Mesh){n(e)?(e.visible=!0,void 0===e.__edges__&&(e.__edges__=new THREE.EdgesHelper(e,THREE.EAGES_LINE_COLOR)),t.remove(e.__edges__)):(e.visible=!1,void 0===e.__edges__&&(e.__edges__=new THREE.EdgesHelper(e,THREE.EAGES_LINE_COLOR)),t.add(e.__edges__))}if(e.children.length>0)for(var s=0;s<e.children.length;s++)i(e.children[s])}else r(o)}function r(e){if(e instanceof THREE.Mesh&&(e.visible=!0,void 0===e.__edges__&&(e.__edges__=new THREE.EdgesHelper(e,THREE.EAGES_LINE_COLOR)),t.remove(e.__edges__)),e.children.length>0)for(var i=0;i<e.children.length;i++)r(e.children[i])}function n(e){function t(e){if(e.children.length>0)for(var r=0;r<e.children.length;r++){var n=e.children[r];if(n==o){i=!0;break}t(n)}}var i=!1;return t(e),i}for(var o=this,s=this,a=e;;){if(a instanceof THREE.Scene)break;s=a,a=a.parent}i(s)},this.setBrothersFromEdges2=function(){function i(e){if(e instanceof THREE.Mesh&&(e.visible=!0,void 0===e.__edges__&&(e.__edges__=new THREE.EdgesHelper(e,THREE.EAGES_LINE_COLOR)),t.remove(e.__edges__)),e.children.length>0)for(var r=0;r<e.children.length;r++)i(e.children[r])}for(var r=this,n=e;;){if(n instanceof THREE.Scene)break;r=n,n=n.parent}i(r)},this.setBrothersToEdges=function(){function i(e){if(e instanceof THREE.Mesh){if(r.combineMeshes&&-1!==r.combineMeshes.indexOf(e))return;if(!0===e.ref)return;e.visible=!1,void 0===e.__edges__&&(e.__edges__=new THREE.EdgesHelper(e,THREE.EAGES_LINE_COLOR)),t.add(e.__edges__)}else for(var n=0;n<e.children.length;n++)i(e.children[n])}for(var r=this,n=e;;){for(var o=0;o<n.children.length;o++){var s=n.children[o];s!=r&&i(s)}if(n instanceof c||n instanceof THREE.Scene)break;r=n,n=n.parent}},this.setBrothersFromEdges=function(){function i(e){if(e instanceof THREE.Mesh)void 0===e.combineMeshes&&(e.visible=!0,e.__edges__&&t.remove(e.__edges__));else for(var r=0;r<e.children.length;r++)i(e.children[r])}for(var r=e;;){for(var n=0;n<r.children.length;n++){i(r.children[n])}if(r instanceof c||r instanceof THREE.Scene)break;r,r=r.parent}},this.highLightBrothers=function(){for(var t=0;t<e.children.length;t++){var i=e.children[t];i!=this&&i.material&&i.material!=s&&(i._defaultMaterial_=i.material,i.material=s)}},this.stopHighLightBrothers=function(){for(var t=0;t<e.children.length;t++){var i=e.children[t];i.material&&i._defaultMaterial_&&(i.material=i._defaultMaterial_,delete i._defaultMaterial_)}},this.over_hide=function(){var e=this;this.parent.children.forEach(function(t){t!=e&&TweenMax.to(t,.5,{alpha:.25})})},this.out_hide=function(){var e=this;this.parent.children.forEach(function(t){t!=e&&TweenMax.to(t,.5,{alpha:1})})},this.over_high_light=function(){},this.out_high_light=function(){},this.hideBrothers=function(){for(var t=0;t<e.children.length;t++){var i=e.children[t];i!=this&&(i.material?(0==i.alpha&&(i.visible=!1),i.material.alphaTest=.02,TweenMax.to(i,1,{alpha:0,onComplete:function(e){e.visible=!1},onCompleteParams:[i]})):i.visible=!1)}},this.showBrothers=function(){for(var t=0;t<e.children.length;t++){var i=e.children[t];i.visible=!0,TweenMax.to(i,1,{alpha:1})}}}void 0===t.THREE&&(t.THREE={}),t.THREE.OBSERVE_TYPE_HIDE=1,t.THREE.OBSERVE_TYPE_HIGH_LIGHT=2,t.THREE.OBSERVE_TYPE_NONE=3,t.THREE.OBSERVE_TYPE_EDGES=4,t.THREE.OBSERVE_TYPE_EDGES_NEW=5,t.THREE.EAGES_LINE_COLOR=16777215;var s,a=i(77),l=i(182),h=i(186),c=i(80);Object.defineProperty(r.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e}}),r.prototype.parseScene=function(e,t){if(t){var i=this.system.scene,r=this.system.controls,s=(this.system.camera,this.system.frame2D),c=e.children,u=this.system,f=this,d=s.addObserveButton();if(t.type=void 0==t.type?THREE.OBSERVE_TYPE_HIDE:t.type,t.lineColor=void 0==t.lineColor?16777215:t.lineColor,void 0==t.level){if(t.level=0,this.enabled=void 0===t.enabled||t.enabled,void 0==t.filter&&(t.filter="observe"),void 0===t.interactive&&(t.interactive=!0),void 0===t.mouseEnabled&&(t.mouseEnabled=!0),void 0===t.meshClick&&(t.meshClick=!0),void 0===t.ifObserveClose&&(t.ifObserveClose=!0),t.filterArray=t.filter.split("|"),void 0===s._isUseObserve_){s._isUseObserve_=!0,d.toggle=!1,d.addEventListener(TouchEvent.TAP,function(e){null==f._currentObserveObject&&(d.toggle=!d.toggle,d.toggle?l.showAllTips(u):l.hideAllTips(u))});var p=$('.timeline-time[goto="'+s.name+'"]');p[0]&&$(p[0]).click(function(){s.execCloseFunc()}),h.addEventListener(nb.event.OBSERVE,function(e){for(var t=0;t<f.observeArray.length;t++){var i=f.observeArray[t];if(-1!==i.name.indexOf(e.data.name)){i.tip.emit(a.gesture.TAP),flag=!0;break}}t==f.observeArray.length&&s.execCloseFunc()}),s.addEventListener("closeObserve",function(e){console.log("xx")})}var m=instance.findDataByLabel(s.name);if(m&&m.items)for(var g=m.items,v=0;v<g.length;v++){var y=g[v];if(y.click===nb.event.OBSERVE&&-1!=y.clickParams.name.indexOf("|")){var _=y.clickParams.name.split("|"),b=null,x=[];if(e.traverse(function(e){for(var t=0;t<_.length;t++)if(e.name===_[t]){if(null==b)b=new THREE.Box3,b.setFromObject(e);else{var i=new THREE.Box3;i.setFromObject(e),b.union(i)}x.push(e)}}),null!=b){console.log(b);var T=b.max.x-b.min.x,E=b.max.y-b.min.y,S=b.max.z-b.min.z,w=new THREE.BoxGeometry(T,E,S),M=new THREE.Mesh(w,new THREE.LineBasicMaterial({}));M.visible=!1;var A=(b.max.x+b.min.x)/2,P=(b.max.y+b.min.y)/2,C=(b.max.z+b.min.z)/2;M.position.set(A,P,C),M.combineMeshes=x,M.ref=!0,e.add(M),M.name=y.clickParams.name}}}}for(var R="",D="",I=c.length,v=0;v<I;v++){var O=c[v];if(n(O,t.filterArray)){for(var F,L=function(){if((1!==arguments.length||!1!==t.mouseEnabled)&&!1!==f._enabled){if(this instanceof l)e=this.bindTarget;else var e=this;if(f._currentObserveObject!=e){if(BioController.dispatchEvent({type:"observeSomeone",name:e.name}),null!=f._currentObserveObject)return console.log("+++++"),r.lookAtTarget(e),f._currentObserveObject.showByType(t.type),f._currentObserveObject=e,void e.hideByType(t.type);d.toggle&&l.hideAllTips(u),d.hide(),t.ifObserveClose,r.lookAtTarget(e,{savePos:!0}),f._currentObserveObject=e;var n=(e.parent,r.rotateRangeY);s.addCloseFunc(function(){r.rotateRangeY=n,f._currentObserveObject=null,r.lookAtTarget(i),e.showByType(t.type),d.toggle&&l.showAllTips(u),d.show()}),e.tip.hideTip(),e.hideByType(t.type)}}},B=O.name.split(" "),N=0;N<B.length&&void 0==(F=instance.info[B[N]]);N++);if(void 0==F){console.error("没有定义"+O.name+"的相关信息");for(var k=O.name.split(" "),N=0;N<k.length;N++)for(var V=0;V<t.filterArray.length;V++)-1!==k[N].indexOf(t.filterArray[V])&&(R+=k[N]+":{name:''},\n",D+="{name:'', click:nb.event.OBSERVE, clickParams:{name:'"+k[N]+"'}},\n")}else{if(""===F.name)continue;O.scientificName=F.name}f.observeArray.push(O),O.tip=s.createObserveText(O,O.scientificName||"数据读取出错",F&&F.offset||null),-1!==O.name.indexOf("|")&&(O.tip.renderable=!1,O.tip.visible=!1),o.apply(O),t.interactive&&(t.meshClick&&a.addGesture(O,a.gesture.TAP,L),O.tip.addEventListener(TouchEvent.TAP,L),O.addEventListener(MouseEvent.MOUSE_OVER,function(e){null!=f._currentObserveObject||d.toggle||!1!==t.mouseEnabled&&(this.outByType(t.type),this.tip.showTip())}),O.addEventListener(MouseEvent.MOUSE_OUT,function(e){null!=f._currentObserveObject||d.toggle||!1!==t.mouseEnabled&&(this.outByType(t.type),this.tip.hideTip())}))}t.level++,this.parseScene(O,t)}""!=R&&(console.log(R.substr(0,R.length-2)),console.log(D.substr(0,D.length-2)))}},e.exports=r}).call(t,i(1))},function(e,t,i){"use strict";function r(e){PIXI.Container.call(this);var t=new PIXI.Graphics;n(t),this.addChild(t);var i=new PIXI.Graphics;n(i),this.addChild(i),this.leftSelector=t,this.rightSelector=i,this.addEventListener("added",this.updatePosition);var r=this;window.addEventListener("resize",function(){setTimeout(r.updatePosition.bind(r),0)}),this.selectorObjects=[],this.system=e,this.frame2D=e.frame2D,this.intersectObj=null,this.hangOnTriggerTime=3,this.hangOnTimer=0}function n(e){e.clear(),e.lineStyle(0,1),e.beginFill(s,a),e.drawCircle(0,0,l)}var o=i(183),s=16777215,a=.3,l=13;r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.updatePosition=function(){if(this.parent){!1===this.hasEventListener("update")&&this.frame2D.addEventListener("update",this.render.bind(this));var e=BiologyMain.W,t=BiologyMain.H,i={x:e/4,y:t/2},r={x:e/4*3,y:t/2};i=this.parent.toLocal(i),r=this.parent.toLocal(r),this.leftSelector.x=i.x,this.leftSelector.y=i.y,this.rightSelector.x=r.x,this.rightSelector.y=r.y,this.raycaster=new THREE.Raycaster}},r.prototype.setPercent=function(e){e>1&&(e=1),e<0&&(e=0);for(var t=[this.leftSelector,this.rightSelector],i=0;i<t.length;i++){var r=t[i];n(r);var o=2/180*Math.PI,s=l+4,a=l+8;r.moveTo(Math.cos(0)*s,Math.sin(0)*s);for(var h=e*Math.PI*2,c=0;c<h;c+=o)r.lineTo(Math.cos(c)*s,Math.sin(c)*s);for(c=h;c>0;c-=o)r.lineTo(Math.cos(c)*a,Math.sin(c)*a)}},r.prototype.registerListener=function(e,t,i){-1===this.selectorObjects.indexOf(e)&&this.selectorObjects.push(e),e.addEventListener(t,i)},r.prototype.render=function(e){if(!1!==this.system.renderable){var t=this.system.leftCamera,i=this.raycaster,r={x:0,y:0};i.setFromCamera(r,t);var n=i.intersectObjects(this.selectorObjects,!0),s=n[0];if(!s)return void(this.intersectObj&&(this.intersectObj.dispatchEvent({type:o.EYES_OUT}),this.intersectObj=null,this.hangOnTimer=0,this.setPercent(0)));var a=s.object;if(null==this.intersectObj)this.intersectObj=a,a.dispatchEvent({type:o.EYES_OVER}),this.hangOnTimer=0;else if(this.intersectObj===a){if(-1!=this.hangOnTimer){this.hangOnTimer+=e.step/1e3;var l=this.hangOnTimer/this.hangOnTriggerTime;l>1&&(this.hangOnTimer=-1,a.dispatchEvent({type:o.EYES_HANG_ON})),this.setPercent(l)}}else this.intersectObj!==a&&(this.intersectObj.dispatchEvent({type:o.EYES_OUT}),this.intersectObj=a,a.dispatchEvent({type:o.EYES_OVER}))}},r.prototype.removeListener=function(e,t,i){if(e.removeEventListener(t,i),!1===e.hasEventListenter(t)){var r=this.selectorObjects.indexOf(e);-1!=r&&this.selectorObjects.splice(r,1)}},e.exports=r},function(e,t,i){"use strict";function r(){PIXI.Container.call(this),this.shape=new PIXI.Graphics,this.addChild(this.shape)}var n=i(78);r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.startListener=function(e){this.isMove=!1,TweenMax.killTweensOf(this.shape.scale),TweenMax.killTweensOf(this),this.globalPos=this.toGlobal({x:0,y:0});var t=n.canvasPoint2DisPoint(e.data.global);this.touchDownAngle=this.startAngle=Math.atan2(this.globalPos.y-t.y,this.globalPos.x-t.x),this.totalAngle=0,this.addEventListener(TouchEvent.TOUCH_MOVE,this.touchMove)},r.prototype.touchMove=function(e){!1===this.isMove&&(this.isMove=!0,this.shape.scale.x=this.shape.scale.y=.001,TweenMax.to(this.shape.scale,1,{x:1,y:1,ease:Elastic.easeOut})),this.tempGlobalPos={x:e.data.global.x,y:e.data.global.y},this.render(e.data.global,100)},r.prototype.render=function(e,t){var i=Math.atan2(this.globalPos.y-e.y,this.globalPos.x-e.x),r=i-this.startAngle;r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r=2*Math.PI+r),this.totalAngle+=r,this.totalAngle%=2*Math.PI,this.startAngle=i,this.shape.clear();var n=NBPoint.distance(e,this.globalPos);if(this.shape.beginFill(16603276,.3),this.shape.moveTo(0,0),this.totalAngle>0)for(var o=0;o<this.totalAngle;o+=.02){var s=this.touchDownAngle+o+Math.PI;this.shape.lineTo(Math.cos(s)*n,Math.sin(s)*n)}else for(var o=0;o>this.totalAngle;o-=.02){var s=this.touchDownAngle+o+Math.PI;this.shape.lineTo(Math.cos(s)*n,Math.sin(s)*n)}this.shape.lineStyle(3,10066329,.5),this.shape.beginFill(16777215,.2),this.shape.drawCircle(0,0,t),this.shape.endFill()},r.prototype.end=function(){var e=this,t=this.totalAngle;if(0===t)e.parent.removeChild(e);else var i=TweenMax.to(this,.6,{onUpdate:function(){var r=1-i.progress();e.render(e.tempGlobalPos||e.globalPos,100*Back.easeOut.getRatio(r)),e.totalAngle=t*Back.easeOut.getRatio(r),e.totalAngle>2*Math.PI?e.totalAngle=2*Math.PI-1e-5:e.totalAngle<2*-Math.PI&&(e.totalAngle=2*-Math.PI+1e-5)},onComplete:function(){e.parent&&e.parent.removeChild(e)}});this.removeEventListener(TouchEvent.TOUCH_MOVE,this.touchMove)},e.exports=r},function(e,t,i){"use strict";var r=i(172),n=function(e,t){function i(e){!1!==f.active&&!1!==f.enabled&&(window.removeEventListener("keydown",i),g=m,m===d.NONE&&(e.keyCode!==f.keys[d.ROTATE]||f.noRotate?e.keyCode!==f.keys[d.ZOOM]||f.noZoom?e.keyCode!==f.keys[d.PAN]||f.noPan||(m=d.PAN):m=d.ZOOM:m=d.ROTATE))}function n(e){!1!==f.active&&!1!==f.enabled&&(m=g,window.addEventListener("keydown",i,!1))}function o(e){!1!==f.active&&!1!==f.enabled&&(e.preventDefault(),e.stopPropagation(),m===d.NONE&&(m=e.button),m!==d.ROTATE||f.noRotate?m!==d.ZOOM||f.noZoom?m!==d.PAN||f.noPan||(M.copy(D(e.pageX,e.pageY)),A.copy(M)):(T.copy(D(e.pageX,e.pageY)),E.copy(T)):(_.copy(I(e.pageX,e.pageY)),y.copy(_)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),f.dispatchEvent(C))}function s(e){!1!==f.active&&!1!==f.enabled&&(r.isDragging()||(e.preventDefault(),e.stopPropagation(),m!==d.ROTATE||f.noRotate?m!==d.ZOOM||f.noZoom?m!==d.PAN||f.noPan||A.copy(D(e.pageX,e.pageY)):E.copy(D(e.pageX,e.pageY)):(y.copy(_),_.copy(I(e.pageX,e.pageY)))))}function a(e){!1!==f.active&&!1!==f.enabled&&(e.preventDefault(),e.stopPropagation(),m=d.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),f.dispatchEvent(R))}function l(e){if(!1!==f.active&&!1!==f.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),t>2?t=2:t<-2&&(t=-2),T.y+=.01*t,f.dispatchEvent(C),f.dispatchEvent(R)}}function h(e){if(!1!==f.active&&!1!==f.enabled&&void 0!==e.touches){var t=e.changedTouches[0];switch(e.touches.length){case 1:j[t.identifier]={moveCurr:I(e.touches[0].pageX,e.touches[0].pageY),movePrev:I(e.touches[0].pageX,e.touches[0].pageY)},m=d.TOUCH_ROTATE;break;case 2:m=d.TOUCH_ZOOM_PAN;var i=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;w=S=Math.sqrt(i*i+r*r);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;M.copy(D(n,o)),A.copy(M);break;default:m=d.NONE}f.dispatchEvent(C)}}function c(e){if(!1!==f.active&&!1!==f.enabled&&!r.isDragging()&&void 0!==e.touches){var t=e.changedTouches[0];switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:var i=j[t.identifier];i&&(y.copy(i.moveCurr),_.copy(I(e.touches[0].pageX,e.touches[0].pageY)),i.movePrev.copy(y),i.moveCurr.copy(_));break;case 2:var i=j[0];i&&(j[0]={moveCurr:I(e.touches[0].pageX,e.touches[0].pageY),movePrev:I(e.touches[0].pageX,e.touches[0].pageY)});var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;w=Math.sqrt(n*n+o*o);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(D(s,a));break;default:m=d.NONE}}}function u(e){if(!1!==f.active&&!1!==f.enabled&&void 0!==e.touches){var t=e.changedTouches[0];switch(delete j[t.identifier],e.touches.length){case 1:break;case 2:S=w=0;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;A.copy(D(i,r)),M.copy(A)}m=d.NONE,f.dispatchEvent(R)}}var f=this,d={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.active=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=6.5,this.zoomSpeed=1.01,this.panSpeed=.3,this.zoomValue=1,this.minZoom=.8,this.maxZoom=1.2,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.lockX=!1,this.lockY=!1,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=new THREE.Vector3,m=d.NONE,g=d.NONE,v=new THREE.Vector3,y=new THREE.Vector2,_=new THREE.Vector2,b=new THREE.Vector3,x=0,T=new THREE.Vector2,E=new THREE.Vector2,S=0,w=0,M=new THREE.Vector2,A=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var P={type:"change"},C={type:"start"},R={type:"end"};this.resetZoom=function(){this.zoomValue=1,this.rotateRangeY=0,T=new THREE.Vector2,E=new THREE.Vector2},this.setZoom=function(e,t){this.minZoom=e,this.maxZoom=t},this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.bindCameraToPos=function(e){this.bindCameraPos=e},this.bindLookAtTargetToPos=function(e){this.lookAtTargetPos=e},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)},this.setCameraScenePos=function(e){this.object.position.copy(e),this.object.scenePos=e.clone(),this.object.sceneRota=this.object.rotation.clone(),this.object.upPos=this.object.up.clone(),this.object.lookAtPos=this.target.clone()},this.lookAtTarget=function(e,t){var i=new THREE.Vector3;t=t||{};var r=t.timer||1.5,n=t.ease||Sine.easeInOut;if(e instanceof THREE.Scene){var o=this.object.scenePos||new THREE.Vector3(500,400,250);if(TweenMax.to(this.object.position,r,{ease:n,x:o.x,y:o.y,z:o.z}),this.object.sceneRota){var s=this.object.sceneRota;TweenMax.to(this.object.rotation,r,{ease:n,x:s.x,y:s.y,z:s.z});var a=this.object.upPos;TweenMax.to(this.object.up,r,{ease:n,x:a.x,y:a.y,z:a.z}),i.copy(this.object.lookAtPos)}}else if(e instanceof THREE.Object3D){var l,h=new THREE.Box3;h.setFromObject(e),l=h.getBoundingSphere(),!0===t.savePos&&this.setCameraScenePos(f.object.position);var c=l.center,u=l.radius;i.set(c.x,c.y,c.z);var d=f.object.position.clone();this.object.scenePos&&(d=this.object.scenePos.clone());var p=i.clone().sub(d).length(),m=f.object.fov/2,g=new THREE.Vector3;e.localToWorld(g);var v=u/Math.sin(m/180*Math.PI),y=(new THREE.Vector3).lerpVectors(i,d,v/p);TweenMax.to(f.object.position,r,{ease:n,x:y.x,y:y.y,z:y.z})}else e instanceof THREE.Vector3&&i.copy(e);TweenMax.to(this.target,r,{ease:n,x:i.x,y:i.y,z:i.z,onComplete:t.onComplete})},this.isLookingAtTarget=function(){return TweenMax.isTweening(this.target)};var D=function(){var e=new THREE.Vector2;return function(t,i){return e.set((t-f.screen.left)/f.screen.width,(i-f.screen.top)/f.screen.height),e}}(),I=function(){var e=new THREE.Vector2;return function(t,i){return e.set((t-.5*f.screen.width-f.screen.left)/(.5*f.screen.width),(f.screen.height+2*(f.screen.top-i))/f.screen.width),e}}(),O=0;this.setRotateType=function(e,t){O=e,t=t||{},0==O||(1==O?(F=0,B=void 0!==t.maxRotaX?t.maxRotaX:.2,N=void 0!==t.maxRotaY?t.maxRotaY:.2,delete v.offsetX):2==O&&(k=void 0===t.maxRangeY?1:t.maxRangeY,V=void 0===t.minRangeY?-1:t.minRangeY,U=void 0!==t.autoRotate&&t.autoRotate,z=void 0!==t.vr&&t.vr))};var F=0,L=0,B=.2,N=.2,k=1,V=-1,U=!1,z=!1,G=0,H=0;this.rotateRangeY=0,this.rotateCamera_mouse_offsetVec2=new THREE.Vector2,this.rotateCamera=function(){var t,i=new THREE.Vector3,r=new THREE.Quaternion,n=new THREE.Vector3,o=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3,l=0,h=0,c=0;return function(){var u=_.x-y.x,d=_.y-y.y;if(isNaN(u)&&(u=0),isNaN(d)&&(d=0),this.rotateCamera_mouse_offsetVec2.set(u,d),!0===f.lockX&&(u=0),!0===f.lockY&&(d=0),!TweenMax.isTweening(e)){if(0==O)a.set(u,d,0),t=a.length(),t?(v.copy(f.object.position).sub(f.target),n.copy(v).normalize(),o.copy(f.object.up).normalize(),s.crossVectors(o,n).normalize(),o.setLength(d),s.setLength(u),a.copy(o.add(s)),i.crossVectors(a,v).normalize(),t*=f.rotateSpeed,r.setFromAxisAngle(i,t),v.applyQuaternion(r),f.object.up.applyQuaternion(r),b.copy(i),x=t):!f.staticMoving&&x&&(x*=Math.sqrt(1-f.dynamicDampingFactor),v.copy(f.object.position).sub(f.target),r.setFromAxisAngle(b,x),v.applyQuaternion(r),f.object.up.applyQuaternion(r));else if(1==O){var p=f.object.position.clone();p.sub(f.target).length();if(0==u&&0==d)return;u*=this.rotateSpeed,d*=this.rotateSpeed,F+=-u,F>B?F=B:F<-B&&(F=-B),L+=-d,L>N?L=N:L<-N&&(L=-N),v.copy(f.object.position).sub(f.target),void 0==v.offsetX&&(v.offsetX=0,v.offsetY=0),h=v.offsetX;v.offsetX+=.15*(F-v.offsetX),v.applyAxisAngle(new THREE.Vector3(0,1,0),v.offsetX-h),c=v.offsetY,v.offsetY+=.15*(L-v.offsetY),v.applyAxisAngle(new THREE.Vector3(1,0,0),-(v.offsetY-c))}else if(2==O){!0===z?a.set(u,-d,0):a.set(u,d,0),t=a.length(),t?(h=-u*f.rotateSpeed,c=-d*f.rotateSpeed):(h*=Math.sqrt(1-f.dynamicDampingFactor),c*=Math.sqrt(1-f.dynamicDampingFactor)),this.rotateRangeY+=c,this.rotateRangeY>k?(this.rotateRangeY-=c,c=0):this.rotateRangeY<V&&(this.rotateRangeY-=c,c=0);var m=f.target;if(v.subVectors(f.object.position,m),r.setFromAxisAngle(new THREE.Vector3(0,1,0),h),v.applyQuaternion(r),0!=c&&(i=(new THREE.Vector3).crossVectors(v,new THREE.Vector3(0,1,0)),i.normalize(),r.setFromAxisAngle(i,c),v.applyQuaternion(r)),Math.abs(h)<1e-4&&Math.abs(c)<1e-4){if(++l>=120&&!0===U){r.setFromAxisAngle(new THREE.Vector3(0,1,0),.001),v.applyQuaternion(r);var g=(k-V)/4.1;if(f.lockY&&(g=0),120===l){var T=(k+V)/2;G=T>this.rotateRangeY?Math.PI:0,H=Math.cos(G)*g}else{G+=.003;var E=Math.cos(G)*g,S=E-H;H=E,i=(new THREE.Vector3).crossVectors(v,new THREE.Vector3(0,1,0)),i.normalize(),r.setFromAxisAngle(i,S),v.applyQuaternion(r),this.rotateRangeY+=S}}}else l=0}y.copy(_)}}}(),this.zoomCamera=function(){var e;if(m===d.TOUCH_ZOOM_PAN){if(e=S/w,S=w,this.zoomValue*=e,this.zoomValue<this.minZoom&&e<1){this.zoomValue/=e;var t=50*Math.abs(this.zoomValue-this.minZoom);t<1&&(t=1),e=Math.pow(e,1/t),isNaN(e)&&(e=1),this.zoomValue*=e}else this.zoomValue>this.maxZoom&&e>1&&(this.zoomValue/=e,t=25*Math.abs(this.zoomValue-this.minZoom),t<1&&(t=1),e=Math.pow(e,1/t),isNaN(e)&&(e=1),this.zoomValue*=e);v.multiplyScalar(e)}else if(1!==(e=1+(E.y-T.y)*f.zoomSpeed)&&e>0){if(this.zoomValue*=e,this.zoomValue<this.minZoom){var i=.3/(this.zoomValue/this.minZoom),r=(this.minZoom-this.zoomValue)*i+this.zoomValue;this.zoomValue/=e;var n=r/this.zoomValue;this.zoomValue*=n,e=n}else this.zoomValue>this.maxZoom&&(i=.3/(this.zoomValue/this.maxZoom),r=(this.maxZoom-this.zoomValue)*i+this.zoomValue,this.zoomValue/=e,n=r/this.zoomValue,this.zoomValue*=n,e=n);v.multiplyScalar(e),f.staticMoving?T.copy(E):T.y+=(E.y-T.y)*this.dynamicDampingFactor}else if(this.zoomValue<this.minZoom){var o=this.zoomValue;this.zoomValue=.15*(this.minZoom-this.zoomValue)+this.zoomValue,e=this.zoomValue/o,v.multiplyScalar(e)}else this.zoomValue>this.maxZoom&&(o=this.zoomValue,this.zoomValue=.15*(this.maxZoom-this.zoomValue)+this.zoomValue,e=this.zoomValue/o,v.multiplyScalar(e))},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,i=new THREE.Vector3;return function(){e.copy(A).sub(M),e.lengthSq()&&(e.multiplyScalar(v.length()*f.panSpeed),i.copy(v).cross(f.object.up).setLength(e.x),i.add(t.copy(f.object.up).setLength(e.y)),f.object.position.add(i),f.target.add(i),f.staticMoving?M.copy(A):M.add(e.subVectors(A,M).multiplyScalar(f.dynamicDampingFactor)))}}(),this.checkDistances=function(){f.noZoom&&f.noPan||(v.lengthSq()>f.maxDistance*f.maxDistance&&f.object.position.addVectors(f.target,v.setLength(f.maxDistance)),v.lengthSq()<f.minDistance*f.minDistance&&f.object.position.addVectors(f.target,v.setLength(f.minDistance)))},this.update=function(){if(this.bindCameraPos instanceof THREE.Vector3){var t=new THREE.Vector3;t.subVectors(this.bindCameraPos,this.object.position),t.multiplyScalar(.07),this.object.position.add(t)}if(this.lookAtTargetPos instanceof THREE.Vector3){var t=new THREE.Vector3;t.subVectors(this.lookAtTargetPos,this.target),t.multiplyScalar(.07),this.target.add(t)}v.subVectors(f.object.position,f.target),TweenMax.isTweening(e)||this.isLookingAtTarget()||(f.noRotate||f.rotateCamera(),f.noZoom||f.zoomCamera(),f.noPan||f.panCamera()),f.object.position.addVectors(f.target,v),f.checkDistances(),f.object.lookAt(f.target),p.distanceToSquared(f.object.position)>1e-6&&(f.dispatchEvent(P),p.copy(f.object.position))},this.reset=function(){m=d.NONE,g=d.NONE,f.target.copy(f.target0),f.object.position.copy(f.position0),f.object.up.copy(f.up0),v.subVectors(f.object.position,f.target),f.object.lookAt(f.target),f.dispatchEvent(P),p.copy(f.object.position)};var j={};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",l,!1),this.domElement.addEventListener("DOMMouseScroll",l,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",c,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",n,!1),this.handleResize(),this.update(),this.destoryListener=function(){this.domElement.removeEventListener("mousedown",o,!1),this.domElement.removeEventListener("mousewheel",l,!1),this.domElement.removeEventListener("DOMMouseScroll",l,!1),this.domElement.removeEventListener("touchstart",h,!1),this.domElement.removeEventListener("touchend",u,!1),this.domElement.removeEventListener("touchmove",c,!1),window.removeEventListener("keydown",i,!1),window.removeEventListener("keyup",n,!1)}};n.prototype=Object.create(THREE.EventDispatcher.prototype),n.prototype.constructor=n,e.exports=n},function(e,t,i){"use strict";(function(t){function r(){var e=new THREE.OBJMTLLoader;this.loader=e}i(300);var n=i(41),o=i(80);r.cache={},r.prototype.load=function(e){var t=e.url,i=n.config.MODEL_URI_PREFIX+(e.relativePath||"");t=void 0===t?-1===e.id.indexOf("/")?i+"models/eq"+e.id+"/dat":i+"models/eq"+e.id:t.endsWith(".nbs")?instance.baseURI+t.replace(".nbs",""):instance.baseURI+t,e.basePath=t.substr(0,t.lastIndexOf("/")+1);var s=function(t){function i(e){void 0!=e.parent[e.name]?console.warn(t.name+" 命名重复."):e.parent[e.name]=e,void 0===e.alpha&&(e._alpha=1,Object.defineProperty(e,"alpha",{get:function(){return this._alpha},set:function(e){0===e&&(e=1e-4);var t=this.material;if(void 0!=t){void 0===t.isCloned&&(t=this.material=this.material.clone(),this.material.isCloned=!0),t.transparent=!0;var i=t.opacity/this.alpha;t.opacity=i*e,this._alpha=e}else for(var r=0;r<this.children.length;r++)this.children[r].alpha=e}}));for(var r=e.children,n=0;n<r.length;n++){i(r[n])}}var r=e.scale||1;1!=r&&TweenMax.to(t.scale,1,{x:r,y:r,z:r}),t.name=e.name||e.url||e.id,t.parent&&i(t),e.callback&&e.callback(t)},a=function(t){if(t.lengthComputable){t.loaded,t.total;e.progressCallback&&e.progressCallback({loaded:t.loaded,total:t.total,url:t.srcElement.responseURL})}},l=function(e){console.warn(e)};if(void 0===r.cache[t]){var h=e.group||new o;h.ID=e.id,t.endsWith(".dae")?this.loader.load(t,"",h,s,a,l):this.loader.load(t+".nbs",t+".mtl",h,s,a)}},t.nb&&(t.nb.NBSLoader=r),e.exports=r}).call(t,i(1))},function(e,t,i){"use strict";i(301);var r=(i(187),i(189)),n={},o=i(302),s=i(41);s.lzmaBytesCache=n,THREE.OBJMTLLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(e,t,i,r,a,l){function h(t,i,n){function s(e){if(e.material.name){var t=n.create(e.material.name);t&&(e.material=t)}void 0!=e.parent[e.name]?console.warn(e.name+" 命名重复"):e.parent[e.name]=e}if(t.charAt&&"{"===t.charAt(0)){t=JSON.parse(t);var a=e.substr(0,e.lastIndexOf("/")+1);t.baseURI=a,"object"===t.metadata.type.toLowerCase()&&c.parseObject(t,i)}else if(t.charAt&&"<"===t.charAt(0)){var l=new THREE.ColladaLoader,h=l.parse(t),u=h.scene,f=[];u.traverse(function(e){if(e instanceof THREE.SkinnedMesh){var t=new THREE.Animation(e,e.geometry.animation);f.push(t),s(e),e.material.skinning=!0}else e instanceof THREE.Mesh&&s(e)});for(var d=u.children;d.length;){var p=d.pop();"Camera"!==p.name&&"Lamp"!==p.name&&i.add(p)}i.movie=new o(f)}else c.parse(t,null,i),i.traverse(function(e){e instanceof THREE.Mesh&&s(e)});r(i)}var c=this,u=new THREE.MTLLoader(e.substr(0,e.lastIndexOf("/")+1));u.crossOrigin=s.config.corssOrigin,t=window.location.href,u.load(t,function(t){var r=t;if(r.preload(),void 0!==n[e])n[e]instanceof Array?n[e].push(function(){h(n[e],i,r)}):h(n[e],i,r);else{var o=new THREE.XHRLoader(c.manager);n[e]=[],o.setCrossOrigin&&o.setCrossOrigin(c.crossOrigin),o.setResponseType("arraybuffer"),THREE.Cache.remove(e),o.load(e,function(t){function o(t){var o=n[e];n[e]=t;for(var s=0;s<o.length;s++){(0,o[s])()}h(t,i,r)}var s=new Int8Array(t);if(93===s[0])throw"lzma已经弃用";if(21===s[0]||51===s[0]){s=function(e,t){for(var i="",r=t.length,n=0,o=0;o<e.length;o++){var s=e[o],a=t.charCodeAt(n%r);n++;var l=s^a;i+=String.fromCharCode(l)}return i}(s,"nbsw"),o(s)}else if(82===s[0]){s=function(e,t){for(var i="",r=t.length,n=0,o=0;o<e.length;o++){var s=e[o],a=t.charCodeAt(n%r);n++;var l=s^a;i+=String.fromCharCode(l)}return i}(s,"nbsw"),o(s)}else{for(var a="",l=0;l<s.length;l++)a+=String.fromCharCode(s[l]);o(a)}},a,l)}},a,l)},parseObject:function(e,t){var i=new THREE.ObjectLoader;if(i.setCrossOrigin(s.config.corssOrigin),e.images)for(var n=0;n<e.images.length;n++){var o=e.images[n];o.url=e.baseURI+o.url}for(var a=i.parse(e),n=0;n<a.children.length;n++){var l=a.children[n];if(l instanceof THREE.Object3D)if(l.geometry&&l.geometry.animations){var h=new r;h.parse(l),t.add(h)}else t.add(l),n--}if(void 0!=a.animations){var c=new THREE.AnimationMixer(t);t.animations=a.animations;for(var n=0;n<t.animations.length;n++){var u=t.animations[n];c.addAction&&c.addAction(new THREE.AnimationAction(u))}t.createMovie(c)}return t},parse:function(e,t,i){function r(e,t,i){return new THREE.Vector3(e,t,i)}function n(e,t,i,r){return new THREE.Face3(e,t,i,r)}function o(e,t){m.length}function s(e,t,i,r){void 0===r?f.faces.push(n(parseInt(e)-(h+1),parseInt(t)-(h+1),parseInt(i)-(h+1))):f.faces.push(n(parseInt(e)-(h+1),parseInt(t)-(h+1),parseInt(i)-(h+1),[g[parseInt(r[0])-1].clone(),g[parseInt(r[1])-1].clone(),g[parseInt(r[2])-1].clone()]))}function a(e,t,i){f.faceVertexUvs[0].push([v[parseInt(e)-1].clone(),v[parseInt(t)-1].clone(),v[parseInt(i)-1].clone()])}function l(e,t,i){void 0===e[3]?(s(e[0],e[1],e[2],i),void 0!==t&&t.length>0&&a(t[0],t[1],t[2])):(void 0!==i&&i.length>0?(s(e[0],e[1],e[3],[i[0],i[1],i[3]]),s(e[1],e[2],e[3],[i[1],i[2],i[3]])):(s(e[0],e[1],e[3]),s(e[1],e[2],e[3])),void 0!==t&&t.length>0&&(a(t[0],t[1],t[3]),a(t[1],t[2],t[3])))}for(var h=0,c=i||new THREE.Group,u=c,f=new THREE.Geometry,d=new THREE.MeshLambertMaterial,p=new THREE.Mesh(f,d),m=[],g=[],v=[],y=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,_=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,b=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/,x=/f( +\d+)( +\d+)( +\d+)( +\d+)?/,T=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/,E=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/,S=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/,w=e.split("\n"),M=0;M<w.length;M++){var A=w[M];A=A.trim();var P;if(0!==A.length&&"#"!==A.charAt(0))if(null!==(P=y.exec(A)))m.push(r(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])));else if(null!==(P=_.exec(A)))g.push(r(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])));else if(null!==(P=b.exec(A)))v.push(function(e,t){return new THREE.Vector2(e,t)}(parseFloat(P[1]),parseFloat(P[2])));else if(null!==(P=x.exec(A)))l([P[1],P[2],P[3],P[4]]);else if(null!==(P=T.exec(A)))l([P[2],P[5],P[8],P[11]],[P[3],P[6],P[9],P[12]]);else if(null!==(P=E.exec(A)))l([P[2],P[6],P[10],P[14]],[P[3],P[7],P[11],P[15]],[P[4],P[8],P[12],P[16]]);else if(null!==(P=S.exec(A)))l([P[2],P[5],P[8],P[11]],[],[P[3],P[6],P[9],P[12]]);else if(/^o /.test(A))o(),h+=m.length,m=[],u=new THREE.Object3D,u.name=A.substring(2).trim(),c.add(u);else if(/^g /.test(A)){if("g default"==A){f&&m.length>0&&(f.vertices=m,f.mergeVertices(),f.computeFaceNormals(),f.computeBoundingSphere(),p.material=new THREE.MeshLambertMaterial,p.material.name=f._materialName_,p.name=f._meshName_,p.castShadow=!0,p.receiveShadow=!0,u.add(p)),f=new THREE.Geometry,d=new THREE.MeshLambertMaterial,p=new THREE.Mesh(f,d),p.castShadow=!0,p.receiveShadow=!0,m=[],g=[],v=[];continue}var C=w[M+1];/^usemtl /.test(C)?(o(A.substring(2).trim(),C.substring(7).trim()),f._meshName_=A.substring(2).trim(),f._materialName_=C.substring(7).trim(),M++):o(A.substring(2).trim(),void 0)}else if(/^usemtl /.test(A))o(void 0,A.substring(7).trim());else if(/^mtllib /.test(A)){if(t){var R=A.substring(7);R=R.trim(),t(R)}}else/^s /.test(A)||console.log("THREE.OBJMTLLoader: Unhandled line "+A)}return o(void 0,void 0),c}},THREE.EventDispatcher.prototype.apply(THREE.OBJMTLLoader.prototype),e.exports=THREE.OBJMTLLoader},function(e,t,i){"use strict";THREE.MTLLoader=function(e,t,i){this.baseUrl=e,this.options=t,this.crossOrigin=i},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(e,t,i,r){function n(e){t(o.parse(e))}var o=this,s=new THREE.XHRLoader;s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),s.load(e,n,i,r||function(){n("")})},parse:function(e){for(var t=e.split("\n"),i={},r=/\s+/,n={},o=0;o<t.length;o++){var s=t[o];if(s=s.trim(),0!==s.length&&"#"!==s.charAt(0)){var a=s.indexOf(" "),l=a>=0?s.substring(0,a):s;l=l.toLowerCase();var h=a>=0?s.substring(a+1):"";if(h=h.trim(),"newmtl"===l)i={name:h},n[h]=i;else if(i)if("ka"===l||"kd"===l||"ks"===l){var c=h.split(r,3);i[l]=[parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])]}else i[l]=h}}var u=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);return u.crossOrigin=this.crossOrigin,u.setMaterials(n),u}},THREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],n={};t[i]=n;for(var o in r){var s=!0,a=r[o],l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[1]&&(s=!1);break;case"d":this.options&&this.options.invertTransparency&&(a=1-a)}s&&(n[l]=a)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&(this.materials[e]=new THREE.MeshPhongMaterial({name:e,side:this.side})),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],i={name:e,side:this.side};for(var r in t){var n=t[r];switch(r.toLowerCase()){case"kd":0===n[0]&&0===n[1]&&0===n[2]&&(n=[.8,.8,.8]),i.diffuse=(new THREE.Color).fromArray(n);break;case"ka":break;case"ks":i.specular=(new THREE.Color).fromArray(n);break;case"map_kd":i.map=this.loadTexture(this.baseUrl+n),i.map.wrapS=this.wrap,i.map.wrapT=this.wrap;break;case"ns":i.shininess=n;break;case"d":n<1&&(i.transparent=!0,i.opacity=n);break;case"map_bump":case"bump":if(i.bumpMap)break;if(-1!=n.indexOf("-bm")){var o=n.split("-bm");n=o[0].trim();var s=parseFloat(o[1])}i.bumpMap=this.loadTexture(this.baseUrl+n),s&&(i.bumpScale=s),i.bumpMap.wrapS=this.wrap,i.bumpMap.wrapT=this.wrap;break;case"side":i.side=parseInt(n)}}return i.diffuse&&(i.color=i.diffuse),this.materials[e]=i,this.materials[e]},loadTexture:function(e,t,i,r){var n,o=THREE.Loader.Handlers.get(e);return null!==o?n=o.load(e,i):(n=new THREE.Texture,o=new THREE.ImageLoader,o.crossOrigin=this.crossOrigin,o.load(e,function(e){n.image=THREE.MTLLoader.ensurePowerOfTwo_(e),n.needsUpdate=!0,i&&i(n)})),void 0!==t&&(n.mapping=t),n}},THREE.MTLLoader.ensurePowerOfTwo_=function(e){if(!THREE.Math.isPowerOfTwo(e.width)||!THREE.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(e.width),t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(e.height);return t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},THREE.MTLLoader.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype)},function(e,t,i){"use strict";function r(e){this.animations=e,this.loop=!0,this.timescale=1,this.startFrame=NaN,this.endFrame=NaN}r.prototype.update=function(e){for(var t=this.animations,i=0;i<t.length;i++)t[i].resetBlendWeights();for(i=0;i<t.length;i++){var r=t[i];if(isNaN(r._startTime)||isNaN(r._endTime))r.update(e);else{var n=r._startTime,o=r._duration;if(this._loop){var s=r.currentTime-n+e*this.timescale;(s>o||s<0)&&(s%=o,s<0&&(s+=o),r.currentTime=0,r.reset(),console.log("one_loop"),this.onLoop&&this.onLoop()),r.currentTime=s+n}else r.stop();r.update(0)}}},r.prototype.replay=function(){this.play()},r.prototype.play=function(){for(var e=0;e<this.animations.length;e++)this.animations[e].play()},r.prototype.setPlayingFrameIndex=function(e,t){for(var i=0;i<this.animations.length;i++){var r=this.animations[i],n=r.data;r._startTime=e/n.fps,r._endTime=t/n.fps,r._duration=r._endTime-r._startTime}},r.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}},Object.defineProperty(r.prototype,"timescale",{get:function(){return this._timescale},set:function(e){this._timescale=e}}),Object.defineProperty(r.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e;for(var t=0;t<this.animations.length;t++){this.animations[t].loop=e}}}),e.exports=r},function(e,t,i){"use strict";function r(){if(instance.firstCircle=!1,0==instance.isFirstStart){$("#logo").before('<div id="loading-bar-spinner"><div class="spinner-icon"></div><div class="spinner-icon2"></div><div class="spinner-eye0"><div class="eyePoint"></div></div><div class="spinner-eye1"><div class="eyePoint"></div></div><div class="nose"></div><div id="loadingText"></div></div>')}PIXI.Container.call(this);var e=new PIXI.Text("",n);this.t=e,e.x=-e.width>>1,e.y=-e.height>>1,this.shape=new PIXI.Graphics,this.addChild(this.shape),this.addChild(this.t)}var n={font:"24px Arial",fill:0,align:"center",wordWrapWidth:200,wordWrap:!0};r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r;r.prototype.setPercent=function(e){this.shape.clear(),$("#loadingText")&&1!=e&&$("#loadingText").html((100*e>>0)+"%")},e.exports=r},function(e,t,i){"use strict";(function(t){var r=i(171),n=i(39);nb=t.nb;var o=function(e){return e};nb.Box2d=r(Object,{mouseJoint:null,stepAfterExecFuncs:[],init:function(e,t){if(window.particleFlags={b2_solidParticleGroup:1,b2_rigidParticleGroup:2,b2_wallParticle:4,b2_springParticle:8,b2_elasticParticle:16,b2_viscousParticle:32,b2_powderParticle:64,b2_tensileParticle:128,b2_staticPressureParticle:2048},this.frame=e,this.drawLayer=e.drawLayer||new PIXI.Graphics,null==this.drawLayer.parent&&e.addChildAt(this.drawLayer,0),t=t||{},void 0==t.gravityX&&(t.gravityX=0),void 0==t.gravityY&&(t.gravityY=10),this.b2Scale=120,this.useLiquidFun=!1,void 0!=window.Box2D)window.b2Vec2=this.b2Vec2=Box2D.Common.Math.b2Vec2,this.b2BodyDef=Box2D.Dynamics.b2BodyDef,this.b2Body=Box2D.Dynamics.b2Body,this.b2FixtureDef=Box2D.Dynamics.b2FixtureDef,this.b2Fixture=Box2D.Dynamics.b2Fixture,this.b2World=Box2D.Dynamics.b2World,this.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape,this.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape,this.b2RevoluteJointDef=Box2D.Dynamics.Joints.b2RevoluteJointDef,this.b2DebugDraw=Box2D.Dynamics.b2DebugDraw,this.b2AABB=Box2D.Collision.b2AABB,this.b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef,this.b2Joint=Box2D.Dynamics.Joints.b2Joint,this.b2PulleyJointDef=Box2D.Dynamics.Joints.b2PulleyJointDef,this.b2PulleyJoint=Box2D.Dynamics.Joints.b2PulleyJoint,window.b2DistanceJoint=Box2D.Dynamics.Joints.b2DistanceJoint,window.b2DistanceJointDef=Box2D.Dynamics.Joints.b2DistanceJointDef,window.b2ContactListener=this.b2ContactListener=Box2D.Dynamics.b2ContactListener,window.b2MassData=Box2D.Collision.Shapes.b2MassData,this.b2PulleyJoint.b2_minPulleyLength=0,window.b2WeldJointDef=Box2D.Dynamics.Joints.b2WeldJointDef;else if(void 0!=window.b2Vec2||null!=window.box2d){var i=window.box2d||window;if(i===window)this.useLiquidFun=!0;else{this.containsLiquidFun=!0,box2d.DEBUG=!1;for(prop in box2d)0==prop.indexOf("b2")&&(window[prop]=box2d[prop]);i.b2_dynamicBody=box2d.b2BodyType.b2_dynamicBody,i.b2_staticBody=box2d.b2BodyType.b2_staticBody,i.b2_kinematicBody=box2d.b2BodyType.b2_kinematicBody,i.b2_bulletBody=box2d.b2BodyType.b2_bulletBody}this.b2Vec2=i.b2Vec2,this.b2BodyDef=i.b2BodyDef,this.b2Body=i.b2Body,this.b2Body.b2_dynamicBody=i.b2_dynamicBody,this.b2Body.b2_staticBody=i.b2_staticBody,this.b2Body.b2_kinematicBody=i.b2_kinematicBody,this.b2FixtureDef=i.b2FixtureDef,this.b2Fixture=i.b2Fixture,this.b2World=i.b2World,this.b2PolygonShape=i.b2PolygonShape,this.b2CircleShape=i.b2CircleShape,this.b2RevoluteJointDef=i.b2RevoluteJointDef,this.b2DebugDraw=i.b2DebugDraw,this.b2AABB=i.b2AABB,this.b2MouseJointDef=i.b2MouseJointDef,this.b2Joint=i.b2Joint,this.b2PulleyJointDef=i.b2PulleyJointDef,this.b2PulleyJoint=i.b2PulleyJoint,this.b2ContactListener=i.b2ContactListener,this.useLiquidFun&&(i.b2PolygonShape.prototype.SetAsBox=i.b2PolygonShape.prototype.SetAsBoxXY,i.b2Body.prototype.CreateFixture=i.b2Body.prototype.CreateFixtureFromDef),this.b2World.prototype.GetGroundBody=function(){if(void 0==this.__ground__){var e=new b2BodyDef,t=this.CreateBody(e);this.__ground__=t}return this.__ground__}}window.world=this.world=new this.b2World(new this.b2Vec2(t.gravityX,t.gravityY),!0),0==this.useLiquidFun&&this.addContactListener(),this.createWall();var r=this;window.addEventListener("resize",function(){r.createWall()});for(var n=[],o=0;o<e.children.length;o++){var s=e.children[o];if(void 0!=s.b2Data){var a=s.b2Data.linkage;if(0==a.indexOf("b2Joint")){n.push(s);continue}0==a.indexOf("b2Circle")?(s.b2Data.view=s,this.addCircle(s.b2Data)):0==a.indexOf("b2Box")?(s.b2Data.view=s,this.addBox(s.b2Data)):0==a.indexOf("b2Poly")?(s.b2Data.view=s,this.addPoly(s.b2Data)):a.indexOf("b2MultiPolys")&&(s.b2Data.view=s,this.addPolys(s.b2Data));for(var l=0;l<s.children.length;l++)s.children[l]instanceof PIXI.Graphics&&(s.children[l].visible=!1)}}for(o=0;o<n.length;o++){s=n[o];var h=s.b2Data;switch(s.visible=!1,h.type){case"Weld":case"Revolute":s.b2Joint=this.createRevoluteJoint(s,h.type);break;case"Pulley":s.b2Joint=this.createPulleyJoint(s,h);break;case"Rope":case"Distance":s.b2Joint=this.createDistanceJoint(s,e[h.t2]);break;case"Prismatic":s.b2Joint=this.createPrismaticJoint(s,h)}}var c=this;e.on("update",function(){c.render()})},addContactListener:function(){var e=new b2ContactListener,t=this.stepAfterExecFuncs;e.BeginContact=function(e){var i=e.GetFixtureA().GetBody(),r=e.GetFixtureB().GetBody(),n=i.GetUserData(),o=r.GetUserData(),s=function(){null!=n&&n.emit(Box2dEvent.BEGIN_CONTACT,{disA:n,disB:o,bodyA:i,bodyB:r,contact:e}),null!=o&&o.emit(Box2dEvent.BEGIN_CONTACT,{disA:o,disB:n,bodyA:r,bodyB:i,contact:e})};t.push(s)},e.EndContact=function(e){var i=e.GetFixtureA().GetBody(),r=e.GetFixtureB().GetBody(),n=i.GetUserData(),o=r.GetUserData(),s=function(){null!=n&&n.emit(Box2dEvent.END_CONTACT,{disA:n,disB:o,bodyA:i,bodyB:r,contact:e}),null!=o&&o.emit(Box2dEvent.END_CONTACT,{disA:o,disB:n,bodyA:r,bodyB:i,contact:e})};t.push(s)},e.PostSolve=function(e,t){},e.PreSolve=function(e,t){},this.world.SetContactListener(e)},render:function(e,t,i){function r(e){var t=e.GetUserData();if(null!=t){var i=e.GetPosition();t.x=i.x*this.b2Scale,t.y=i.y*this.b2Scale,t.rotation=e.GetAngle()}e.__draw__}for(void 0==t&&(t=20),void 0==i&&(i=20),void 0==e&&(e=1/60),window.world!=this.world&&(window.world=this.world),this.world.Step(e,t,i);this.stepAfterExecFuncs.length;){var n=this.stepAfterExecFuncs.shift();n&&n()}if(null!=this.world.ClearForces&&this.world.ClearForces(),this.useLiquidFun){for(var o=this.world.bodies,s=o.length,a=0;a<s;a++){var l=o[a];r.apply(this,[l])}for(s=this.world.joints.length,a=0;a<s;a++){var h=this.world.joints[a];this.b2PulleyJoint}var c=world.particleSystems.length;for(a=0;a<c;a++)this.drawParticleSystem(world.particleSystems[a])}else{if(!0===this.containsLiquidFun)for(var u=this.world.GetParticleSystemList();u;u=u.GetNext())this.drawParticleSystemContainsLiquidFun(u);for(var l=this.world.GetBodyList();l;l=l.GetNext())r.apply(this,[l]);this.drawLayer.clear();this.drawLayer;this.drawLayer.lineStyle(4,16777215);for(var h=this.world.GetJointList();h;h=h.GetNext())if(!0!==h.disabledDraw)if(h instanceof this.b2PulleyJoint){if(1==h.GetAnchorA.length){var f=new b2Vec2,d=new b2Vec2;h.GetAnchorA(f),h.GetAnchorB(d)}else var f=h.GetAnchorA(),d=h.GetAnchorB();var p=h.GetGroundAnchorA(new b2Vec2),m=h.GetGroundAnchorB(new b2Vec2);this.drawLayer.moveTo(f.x*this.b2Scale,f.y*this.b2Scale),this.drawLayer.lineTo(p.x*this.b2Scale,p.y*this.b2Scale),this.drawLayer.moveTo(m.x*this.b2Scale,m.y*this.b2Scale),this.drawLayer.lineTo(d.x*this.b2Scale,d.y*this.b2Scale)}else if(h instanceof b2DistanceJoint||window.b2RopeJoint&&h instanceof b2RopeJoint){if(1==h.GetAnchorA.length){var f=new b2Vec2,d=new b2Vec2;h.GetAnchorA(f),h.GetAnchorB(d)}else var f=h.GetAnchorA(),d=h.GetAnchorB();var g=NBPoint.distance(f,d);if(g<2/this.b2Scale)continue;if(h._rope_body1&&h._rope_body2){h._rope_body1.SetPosition(new b2Vec2(f.x,f.y)),h._rope_body2.SetPosition(new b2Vec2(d.x,d.y));var v=h._rope_ary,s=v.length;this.drawLayer.moveTo(f.x*this.b2Scale,f.y*this.b2Scale);for(var a=0;a<s;a++){var g=v[a];this.drawLayer.lineTo(g.x,g.y)}this.drawLayer.lineTo(d.x*this.b2Scale,d.y*this.b2Scale)}else this.drawLayer.moveTo(f.x*this.b2Scale,f.y*this.b2Scale),this.drawLayer.lineTo(d.x*this.b2Scale,d.y*this.b2Scale)}}},drawParticleSystem:function(e){var t=e.GetPositionBuffer(),i=t.length;if(void 0==e.particleContainer){var r=new PIXI.ParticleContainer(1e4);e.particleContainer=r,this.frame.addChild(r);for(var n=0;n<i/2;n++){var o=PIXI.Sprite.fromFrame(e.particleTexture);o.anchor.x=.5,o.anchor.y=.5,o.scale.x=.67,o.scale.y=.67,o.alpha=.1,r.addChild(o)}}var r=e.particleContainer;for(n=0;n<t.length;n+=2)r.children[n/2].position.x=t[n]*this.b2Scale,r.children[n/2].position.y=t[n+1]*this.b2Scale},drawParticleSystemContainsLiquidFun:function(e){var t=e.GetPositionBuffer(),i=t.length;if(void 0==e.particleContainer){var r=new PIXI.ParticleContainer(1e4);e.particleContainer=r,this.frame.addChild(r);for(var n=0;n<i;n++){var o=PIXI.Sprite.fromFrame(e.particleTexture);o.anchor.x=.5,o.anchor.y=.5,r.addChild(o)}}var r=e.particleContainer;for(n=0;n<t.length&&t[n];n++)r.children[n].position.x=t[n].x*this.b2Scale,r.children[n].position.y=t[n].y*this.b2Scale},getBodiesAtPoint:function(e,t){function i(e){var i=e.shape||e.GetShape(),r=e.body||e.GetBody();if(r.GetType()!=h.b2_staticBody||t){var n;n=void 0==i.TestPoint?e.TestPoint(s):i.TestPoint(r.GetTransform(),s),n&&l.push(r)}return!0}function r(e){}void 0==t&&(t=!1);var n=e.x/this.b2Scale,o=e.y/this.b2Scale,s=new this.b2Vec2;s.Set(n,o);var a=new this.b2AABB;a.lowerBound.Set(n-.001,o-.001),a.upperBound.Set(n+.001,o+.001);var l=[],h=this.b2Body;if(r.prototype.ReportFixture=i,this.useLiquidFun){var c=new r(s);this.world.QueryAABB(c,a)}else this.world.QueryAABB(i,a);return l},getBodyAtPoint:function(e,t){for(var i=this.getBodiesAtPoint(e,t),r=-1,n=void 0,o=0;o<i.length;o++){var s=i[o].GetUserData(),a=s.parent,l=a.getChildIndex(s);l>r&&(r=l,n=s)}return n?n.b2Body:void 0},addBox:function(e){e instanceof PIXI.Container&&(e={view:e});var t=new this.b2PolygonShape,i=e.view||e.userData;return i&&(void 0==e.w&&(e.w=i.width/2),void 0==e.h&&(e.h=i.height/2)),t.SetAsBox(e.w/this.b2Scale,e.h/this.b2Scale),this.addCommonProperty(e,t)},addPoly:function(e){e instanceof PIXI.Container&&(e={view:e});for(var t=new this.b2PolygonShape,i=[],r=0;r<e.polyData.length;r++){var n=e.polyData[r],o=new this.b2Vec2(n.x/this.b2Scale,n.y/this.b2Scale);t.vertices?t.vertices.push(o):i.push(o)}void 0==t.vertices&&(void 0!=t.SetAsArray?t.SetAsArray(i):t.Set(i)),this.addCommonProperty(e,t)},addPolys:function(e){e instanceof PIXI.Container&&(e={view:e});e.view;throw new"方法还没有实现"},addCommonProperty:function(e,t){var i=e.view||e.userData;i&&(void 0==e.x&&(e.x=i.x),void 0==e.y&&(e.y=i.y),void 0==e.r&&(e.r=i.rotation));var r=new this.b2BodyDef;"Dynamic"==e.type?r.type=this.b2Body.b2_dynamicBody:"Static"==e.type?r.type=this.b2Body.b2_staticBody:"Kinematic"==e.type?r.type=this.b2Body.b2_kinematicBody:void 0==e.type&&(r.type=this.b2Body.b2_dynamicBody),r.userData=i,r.position.Set(e.x/this.b2Scale,e.y/this.b2Scale),r.bullet="true"==e.bullet,r.allowSleep="true"==e.autoSleep,r.angle=Number(e.r||0);var n=new this.b2FixtureDef,o=Number(e.density||1);if(n.density=Number(o),n.isSensor="true"==e.isSensor,n.friction=Number(e.friction||.2),n.restitution=Number(e.restitution||0),"true"===e.allowDragging&&this.addDrag(e.view),n.shape=t,void 0==e.collideGroup)n.filter.categoryBits=void 0==e.categoryBits?65535:e.categoryBits,n.filter.maskBits=void 0==e.maskBits?65535:e.maskBits;else{for(var s=e.collideGroup,a=0,l=0;l<s.length;l++)a|=1<<s[l];n.filter.categoryBits=a,n.filter.maskBits=a}if(r.angularDamping=Number(e.angularDamping||0),r.fixedRotation="true"==e.fixedRotation,r.angularVelocity=Number(e.angularVelocity||0),r.linearDamping=Number(e.linearDamping||0),"true"===e.useParticleSystem){var h=new b2ParticleGroupDef;h.position=new b2Vec2(e.x/this.b2Scale,e.y/this.b2Scale),h.shape=t,h.flags=e.flags||particleFlags.b2_tensileParticle|particleFlags.b2_colorMixingParticle,h.groupFlags=e.groupFlags||0,h.color.Set(255,0,0,255),null==this.frame.particleSystemMap&&(this.frame.particleSystemMap={});var c=this.frame.particleSystemMap;if(void 0==c[o]){var u=new b2ParticleSystemDef;u.radius=Number(e.particleRadius)||.055,u.dampingStrength=.4,c[o]=world.CreateParticleSystem(u),""==e.particleTexture||void 0===e.particleTexture?c[o].particleTexture="particle.liquid_particle":c[o].particleTexture=e.particleTexture,c[o].SetDensity(o)}e.view.visible=!1,c[o].CreateParticleGroup(h),i.b2ParticleSystem=c[o]}else{var f=this.world.CreateBody(r);f.CreateFixture(n),this.useLiquidFun&&(f.__view__=i,f.GetUserData=function(){return this.__view__}),i&&(i.b2Body=f)}return f},createWall:function(){this.leftWall&&(this.world.DestroyBody(this.leftWall),this.world.DestroyBody(this.rightWall),this.world.DestroyBody(this.topWall),this.world.DestroyBody(this.bottomWall));var e=new PIXI.Point,t=new PIXI.Point(0,BiologyMain.H),i=new PIXI.Point(BiologyMain.W),r=new PIXI.Point(BiologyMain.W,BiologyMain.H),s=this.frame.toLocal(e,instance.stage),a=(this.frame.toGlobal(t,instance.stage),this.frame.toLocal(i,instance.stage));this.frame.toGlobal(r,instance.stage);this.leftWall=this.addBox({x:s.x-50,y:s.y,w:o(100),h:BiologyMain.H,type:"Static"}),this.rightWall=this.addBox({x:a.x+50,y:a.y,w:o(100),h:BiologyMain.H,type:"Static"}),this.topWall=this.addBox({x:(2*n.STACK_WIDTH-n.W)/2,y:-o(100)+s.y,w:n.W,h:o(100),type:"Static"}),this.bottomWall=this.addBox({x:(2*n.STACK_WIDTH-n.W)/2,y:n.H+o(100)+s.y,w:n.W,h:o(100),type:"Static"})},addCircle:function(e){e instanceof PIXI.Container&&(e={view:e});var t=e.view||e.userData;null!=t&&void 0==e.r&&(e.r=t.width/2);var i;this.useLiquidFun?(i=new this.b2CircleShape,i.radius=e.r/this.b2Scale):i=new this.b2CircleShape(e.r/this.b2Scale),this.addCommonProperty(e,i)},removeDrag:function(e){void 0!==e.box2dDragFunc&&(e.removeListener(TouchEvent.TOUCH_BEGIN,e.box2dDragFunc),e.up&&(e.up(),delete e.up),e.box2dDragFunc=void 0)},addDrag:function(e,t){t=t||{},t.maxForce=t.maxForce||3e4,t.changeKinematicToDynamic=void 0===t.changeKinematicToDynamic||t.changeKinematicToDynamic;var i=this.getBodyAtPoint,r=this,n=function(e){var n=this.stepRoot.toLocal(e.data.global,instance.stage),o=i.apply(r,[n]);if(null!=o){var s=new r.b2MouseJointDef;if(s.bodyA=r.world.GetGroundBody(),s.bodyB=o,o.GetType()==r.b2Body.b2_kinematicBody&&t.changeKinematicToDynamic&&(o._lastType=r.b2Body.b2_kinematicBody,o.SetType(r.b2Body.b2_dynamicBody)),o.GetType()==r.b2Body.b2_dynamicBody){s.target.Set(n.x/r.b2Scale,n.y/r.b2Scale),s.maxForce=t.maxForce;var a=r.world.CreateJoint(s)}var l=function e(t){a&&r.world.DestroyJoint(a),void 0!=o._lastType&&(o.SetType(o._lastType),nb.Box2d.freezeBody(o),delete o._lastType),this.removeListener(TouchEvent.TOUCH_END,e),this.removeListener(TouchEvent.TOUCH_END_OUDSIDE,e),this.removeListener(TouchEvent.TOUCH_MOVE,h),t&&this.emit(NBDrag.event.STOP_DRAG,{target:this,data:t.data}),this.isDragging=!1},h=function(e){if(a){var t=this.stepRoot.toLocal(e.data.global,instance.stage),i=new r.b2Vec2(t.x/r.b2Scale,t.y/r.b2Scale);a.SetTarget(i),this.emit(NBDrag.event.DRAG_MOVE,{target:this,data:e.data})}else if(o.GetType()==r.b2Body.b2_kinematicBody){t=this.stepRoot.toLocal(e.data.global,instance.stage);var s=t.x-n.x,l=t.y-n.y,h=o.GetPosition();if(h.Copy)var c=h.Copy();else var c=h.Clone();c.x+=s/r.b2Scale,c.y+=l/r.b2Scale,o.SetPosition(c),n=t}};this.addEventListener(TouchEvent.TOUCH_END,l),this.addEventListener(TouchEvent.TOUCH_END_OUDSIDE,l),this.addEventListener(TouchEvent.TOUCH_MOVE,h),this.emit(NBDrag.event.START_DRAG,{target:this,data:e.data}),this.isDragging=!0,this.up=l}};e.box2dDragFunc=n,e.addEventListener(TouchEvent.TOUCH_BEGIN,n)},createRevoluteJoint:function(e,t){var i,r,n,o=e.b2Data,s=this.getBodiesAtPoint({x:e.x,y:e.y},!0),a=o.t1,l=o.t2;if(a&&l&&this.frame[a]&&this.frame[l]?(i=this.frame[a].b2Body,r=this.frame[l].b2Body,n=new this.b2Vec2(e.x/this.b2Scale,e.y/this.b2Scale)):0==s.length||(1==s.length?(i=this.world.GetGroundBody(),r=s[0],n=new this.b2Vec2(e.x/this.b2Scale,e.y/this.b2Scale)):s.length>1&&(i=s[0],r=s[1],n=new this.b2Vec2(e.x/this.b2Scale,e.y/this.b2Scale))),i&&r){if("Revolute"===t)var h=new this.b2RevoluteJointDef;else{if("Weld"!==t)return;var h=new b2WeldJointDef}if(void 0==h.Initialize)var c=h.InitializeAndCreate(i,r,n);else h.Initialize(i,r,n),c=this.world.CreateJoint(h)}return c},createPulleyJoint:function(e,t){var i,r,n,o,s,a,l=e,h=this.frame[t.t2],c=this.frame[t.ground1],u=this.frame[t.ground2];i=this.getBodyAtPoint({x:l.x,y:l.y},!0),r=this.getBodyAtPoint({x:h.x,y:h.y},!0),s=new this.b2Vec2(l.x/this.b2Scale,l.y/this.b2Scale),a=new this.b2Vec2(h.x/this.b2Scale,h.y/this.b2Scale),n=new this.b2Vec2(c.x/this.b2Scale,c.y/this.b2Scale),o=new this.b2Vec2(u.x/this.b2Scale,u.y/this.b2Scale);var f=new this.b2PulleyJointDef;return void 0==f.Initialize?f.InitializeAndCreate(i,r,n,o,s,a,t.ratio):(f.Initialize(i,r,n,o,s,a,t.ratio),this.world.CreateJoint(f))},createPrismaticJoint:function(e,t){var i,r,n,o,s=e,a=this.frame[t.t2];i=this.getBodyAtPoint({x:s.x,y:s.y},!0),r=this.getBodyAtPoint({x:a.x,y:a.y},!0),n=new this.b2Vec2(s.x/this.b2Scale,s.y/this.b2Scale),o=new this.b2Vec2(a.x/this.b2Scale,a.y/this.b2Scale);var l=new b2PrismaticJointDef;return l.Initialize(i,r,n,o),l.lowerTranslation=-60,l.upperTranslation=60,l.maxMotorForce=100,l.motorSpeed=14,l.enableMotor=!0,this.world.CreateJoint(l)},createDistanceJoint:function(e,t,i,r,n){var s=e.b2Data,a=null;a="Rope"===s.type?new b2RopeJointDef:new b2DistanceJointDef,a.collideConnected="true"===s.collideConnected,isNaN(s.dampingRatio)||(a.dampingRatio=s.dampingRatio),isNaN(s.frequencyHz)||(a.frequencyHz=s.frequencyHz);var l,h;if(e.b2Body&&t.b2Body?(l=e.b2Body,h=t.b2Body):(l=this.getBodyAtPoint({x:e.x,y:e.y},!0),null==(h=this.getBodyAtPoint({x:t.x,y:t.y},!0))&&(h=this.world.GetGroundBody())),l===h)return!1;if(null==l||null==h)return!1;if(null==i)if(e.b2Body===l)i={x:0,y:0};else{var c=l.GetUserData();i={x:e.x-c.x,y:e.y-c.y};var u=-l.GetAngle();i=NBMath.rotaPoint(i,{x:0,y:0},u)}if(null==r)if(t.b2Body===h)r={x:0,y:0};else{var c=h.GetUserData();r={x:t.x-c.x,y:t.y-c.y};var u=-h.GetAngle();r=NBMath.rotaPoint(r,{x:0,y:0},u)}var f={x:e.x+i.x,y:e.y+i.y},d={x:t.x+r.x,y:t.y+r.y};if(f.x/=this.b2Scale,f.y/=this.b2Scale,d.x/=this.b2Scale,d.y/=this.b2Scale,a.localAnchorA=new b2Vec2(i.x/this.b2Scale,i.y/this.b2Scale),h===this.world.GetGroundBody()?a.localAnchorB=new b2Vec2(d.x,d.y):a.localAnchorB=new b2Vec2(r.x/this.b2Scale,r.y/this.b2Scale),a.bodyA=l,a.bodyB=h,null==n?a.length=NBPoint.distance(e,t)/this.b2Scale:(n/=this.b2Scale,a.length=n),0===a.maxLength&&(a.maxLength=a.length,"true"===s.ropeGhost))for(var p,m,g,v=o(2),y=o(20),_=Math.floor(NBPoint.distance(e,t)/y),b={x:e.x,y:e.y},x={x:t.x,y:t.y},T=b2Atan2(x.y-b.y,x.x-b.x),E=[],S=0;S<_;S++){var w=new PIXI.Graphics;if(w.visible=!1,w.rotation=T-Math.PI/2,w.x=b.x+(x.x-b.x)*S/_,w.y=b.y+(x.y-b.y)*S/_,this.frame.addChild(w),type=0==S||S==_-1?"Kinematic":"Dynamic",this.addBox({view:w,w:v,h:y,r:w.rotation,type:type,collideGroup:[15]}),0==S?m=w.b2Body:S==_-1?g=w.b2Body:E.push(w),0!=S){var M=new b2RevoluteJointDef,A=p.b2Body,P=w.b2Body,C=new b2Vec2((p.x+w.x)/2/this.b2Scale,(p.y+w.y)/2/this.b2Scale);M.Initialize(A,P,C),this.world.CreateJoint(M)}p=w}var R=this.world.CreateJoint(a);return A&&P&&(R._rope_body1=m,R._rope_body2=g,R._rope_ary=E),R},resetBox2dData:function(){for(var e=this.frame,t=0;t<e.children.length;t++){var i=e.children[t],r=i.b2Data,n=i.b2Body;void 0!=r&&void 0!=n&&(nb.Box2d.freezeBody(n),n.SetPosition(new b2Vec2(r.x/this.b2Scale,r.y/this.b2Scale)),n.SetAngle(r.r))}}}),nb.Box2d.setBodyScale=function(e,t){this.b2CircleShape=window.Box2D?Box2D.Collision.Shapes.b2CircleShape:window.b2CircleShape;var i=0;void 0==e.__scale__?(e.__scale__=t,i=t):(i=1/e.__scale__*t,e.__scale__=t);var r=e.GetFixtureList().GetShape();if(e.GetFixtureList().GetShape()instanceof this.b2CircleShape)r.SetRadius(r.GetRadius()*i);else for(var n=r.GetVertices(),o=0;o<n.length;o++){var s=n[o];s.Multiply(i)}},nb.Box2d.freezeBody=function(e){e instanceof PIXI.Container&&(e=e.b2Body),e.SetLinearVelocity(new b2Vec2(0,0)),e.SetAngularVelocity(0)},nb.Box2d.destoryBodyJoint=function(e,t){void 0!==e.b2Body&&(e=e.b2Body);for(var i=e.GetJointList(),r=e.GetWorld();i;){for(var n=0;n<t.length;n++)i.joint instanceof t[n]&&r.DestroyJoint(i.joint);i=i.next}},nb.Box2d.updatePos=function(e,t,i,r){nb.Box2d.$updatePos$(e,{x:t,y:i,angle:r})},nb.Box2d.$updatePos$=function(e,t){if(void 0!==e.b2Body&&(e=e.b2Body),t=t||{},t.type=t.type||"update","update"===t.type)var i=new b2Vec2,r=0;else i=e.GetPosition().Clone(),r=e.GetAngle();i.x+=t.x||0,i.y+=t.y||0,r+=t.angle||0,e.SetPosition(i),e.SetAngle(r)},nb.Box2d.appendPos=function(e,t,i,r){nb.Box2d.$updatePos$(e,{x:t,y:i,angle:r,type:"append"})},nb.Box2d.getBodyJoint=function(e,t){void 0!==e.b2Body&&(e=e.b2Body);for(var i=e.GetJointList();i;){if(i.joint instanceof t)return i.joint;i=i.next}return null},nb.Box2d.setMass=function(e,t){e instanceof PIXI.Container&&(e=e.b2Body);var i=new b2MassData;e.GetMassData(i),i.mass=t,e.SetMassData(i)},nb.Box2d.getMass=function(e){e instanceof PIXI.Container&&(e=e.b2Body);var t=new b2MassData;return e.GetMassData(t),t.mass},void 0==window.Box2dEvent&&(window.Box2dEvent={END_CONTACT:"endContact",BEGIN_CONTACT:"beginContact"}),e.exports=nb.Box2d}).call(t,i(1))},function(e,t,i){"use strict";(function(t){function i(){}i.centerGeometry=function(e){var t=e.geometry;t.computeBoundingSphere();var i=t.boundingSphere.center;e.position.add(i),t.center()},t.MeshUtil=i,e.exports=i}).call(t,i(1))},function(e,t,i){"use strict";(function(e,t){var i={};i.hitTest=function(e,t){if(0!=e.visible&&0!=t.visible){var i=e.getBounds(),r=t.getBounds(),n=Math.max(i.x,r.x),o=Math.max(i.y,r.y),s=Math.min(i.x+i.width,r.x+r.width)-n,a=Math.min(i.y+i.height,r.y+r.height)-o;return!(a<=0||s<=0)&&s*a}},e.NBHitTest=i,t.export=i}).call(t,i(1),i(61)(e))},function(e,t,i){"use strict";(function(t){function i(){}i.getCameraLookDir=function(e){return new THREE.Vector3(0,0,-100).applyQuaternion(e.quaternion).add(e.position)},i.creatWater=function(e,t){var i=e.canvas,r=e.scene;if(null==r["6666/model"])return null;var n={width:200,height:200,widthSegments:250,heightSegments:250,depth:1500,param:4,filterparam:1},o=new THREE.TextureLoader;o.setCrossOrigin(nb.config.corssOrigin);var s=o.load(nb.config.MODEL_URI_PREFIX+"models/eq6666/waternormals.jpg");s.wrapS=s.wrapT=THREE.RepeatWrapping;var a=new THREE.Water(i,e.camera,r,{textureWidth:512,textureHeight:512,waterNormals:s,alpha:.7,sunDirection:t.position.clone().normalize(),sunColor:16777215,waterColor:3355443,distortionScale:15}),l=new THREE.Mesh(new THREE.PlaneBufferGeometry(n.width,n.height),a.material);return l.add(a),l.rotation.x=.5*-Math.PI,l.position.y=-7,l.position.x=370,l.position.z=-68,r.add(l),this.mesh=l,this.render=function(){a.material.uniforms.time.value+=1/60,a.render()},this.desdroy=function(){r.remove(l)},this},i.creatFlurView=function(e){SCREEN_WIDTH=$(window).innerWidth(),SCREEN_HEIGHT=$(window).innerHeight();var t=e.canvas,i=e.scene,r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},n=new THREE.WebGLRenderTarget(SCREEN_WIDTH,SCREEN_HEIGHT,r),o=new THREE.ShaderPass(THREE.HorizontalTiltShiftShader),s=new THREE.ShaderPass(THREE.VerticalTiltShiftShader);o.uniforms.h.value=2/SCREEN_WIDTH,s.uniforms.v.value=2/SCREEN_HEIGHT,o.uniforms.r.value=s.uniforms.r.value=.5,s.renderToScreen=!0;var a=new THREE.RenderPass(i,e.camera),l=new THREE.EffectComposer(t,n);return l.addPass(a),l.addPass(o),l.addPass(s),l},i.sceneFix=function(e){if(null!=e["6666/model"]){var t=e["6666/model"].pPlane18;t&&(t.visible=!1);for(var i=0;i<=13;i++){var r=e["6666/model"]["polySurface"+(3250+i)];r&&(r.material=r.material.clone(),r.material.side=2,r.material.color.setRGB(.8,.8,.8),r.material.needsUpdate=!0)}}},i.showSomeModelsInit=function(e,t){t.showOnly=function(){for(var i=0;i<e.length;i++)console.log(i==t.showIndex),e[i].visible=i==t.showIndex},t.showOnly(),t.showTar=function(){e[t.showIndex].visible=!0}},i.showSomeModels=function(e){function t(t){void 0!=t.index&&(e.showIndex=t.index,e.showTar&&e.showTar())}function i(t){e.showOnly&&e.showOnly()}e.showIndex=0,e.timeline.addEventListener("change",t),e.timeline.addEventListener("TweenComplete",i)},t.ThreeUtil=i,e.exports=i}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i={};i.getParticle=function(e){var t,i=new PIXI.Container;return"string"==typeof e.texture?t=PIXI.Texture.fromFrame(e.texture):(t=new Array,e.texture.forEach(function(e){t.push(PIXI.Texture.fromFrame(e))})),$.getJSON(e.path,function(e,r){"success"==r&&(i.particle=new cloudkid.Emitter(i,t,e),i.emit("particleLoaded"))}),i.render=function(){if(null!=this.particle){if(null!=this.bindObj){if(!this.parent)return;var e=this.parent.toLocal({x:0,y:0},this.bindObj),t={x:e.x+this.bindOffsetX,y:e.y+this.bindOffsetY},i=new PIXI.Matrix,r=Math.cos(this.rotation),n=Math.sin(this.rotation);i.set(this.scale.x*r,this.scale.x*n,-n*this.scale.y,this.scale.y*r,0,0),t=i.applyInverse(t),this.particle.updateOwnerPos(t.x+this.bindOffsetX,t.y+this.bindOffsetY)}var o=Date.now();this.particle.update(.001*(o-this.__timer__||0)),this.__timer__=o}},i.bind=function(e,t,r){i.bindObj=e,i.bindOffsetX=t||0,i.bindOffsetY=r||0},i.destroy=function(){this.parent&&this.parent.removeChild(this),i.bindObj=null,i.particle&&i.particle.destroy.apply(i.particle),delete i.bindObj,i=null,t=null},i.setStyle=function(e,t){i.particle[e]=t},i.getParticle=function(){return new Promise(function(e,t){i.particle?e(i.particle):i.on("particleLoaded",function(){e(i.particle)})})},i},i.particles={spirit_fire:{path:"assets/particles/spirit_fire.json",texture:"particle.spirit_fire"},spirit_fire_blue:{path:"assets/particles/spirit_fire_blue.json",texture:"particle.spirit_fire"},match_fire:{path:"assets/particles/match_fire.json",texture:"particle.spirit_fire"},water_vapor:{path:"assets/particles/water_vapor.json",texture:"particle.spirit_fire"},seed_fire:{path:"assets/particles/seed_fire.json",texture:"particle.spirit_fire"},seed_fire2:{path:"assets/particles/seed_fire2.json",texture:"particle.spirit_fire"},outSide_fire:{path:"assets/particles/outSide_fire.json",texture:"particle.spirit_fire"},huasheng_fire:{path:"assets/particles/huasheng_fire.json",texture:"particle.spirit_fire"},cut_leaf:{path:"assets/particles/cut_leaf.json",texture:"particle.leaf"},add_spices:{path:"assets/particles/add_spices.json",texture:"particle.spices"},add_yeast:{path:"assets/particles/add_yeast.json",texture:"particle.spices"},add_solid_block:{path:"assets/particles/add_solid.json",texture:"particle.spices"},water_boilingBubble:{path:"assets/particles/boiling_water.json",texture:"particle.boilingBubble"},water_boilingBubbleT:{path:"assets/particles/boiling_water_t.json",texture:"particle.boilingBubble"},bottle_gas:{path:"assets/particles/bottle_gas.json",texture:"particle_smoke_5"},bottle_gas2:{path:"assets/particles/bottle_gas.json",texture:["particle_smoke_1","particle_smoke_2","particle_smoke_3","particle_smoke_4","particle_smoke_5","particle_smoke_6"]}},t.ParticleUtil=i,e.exports=i}).call(t,i(1))},function(e,t,i){"use strict";var r={};r.fitMc=function(e,t){var i=e.getChildAt(1),r=i.width/i.height;r>=1?(i.width=t,i.height=t/r):(i.height=t,i.width=t*r),i.x=-i.width/2,i.y=(t-i.height)/2;var n=e.getChildAt(0);return n.x=-n.width/2,n.y=t+30,e},r.setRdmXY=function(e,t,i,r){e.x=Math.cos(Math.random()*Math.PI)*Math.random()*r+t,e.y=Math.sin(Math.random()*Math.PI)*Math.random()*r+i},e.exports=r},function(e,t,i){"use strict";var r={};r.PLANE_W=500,r.PLANE_H=500,r.getFan=function(e,t,i,r,n,o){for(var s=0,a=0,l=0,h=0,c=0;c<e.length;c++){var u,f,d=e[c][0],p=e[c][1];1==t?(u=d/i*n,f=p/r*o):(u=d,f=p);var m=1/u;s+=m,a+=f,l+=m*f,h+=m*m}var g=[[e.length,s],[s,h]],v=[[a],[l]],y=Matrix.inverse(g),_=Matrix.multiply(y,v);return Matrix.traceMatrix(_),_},r.getNiheStrAB=function(e,t,i,r,n,o){for(var s=0,a=0,l=0,h=0,c=0;c<e.length;c++){var u,f,d=e[c][0],p=e[c][1];e[c];t?(u=d/i*n,f=p/r*o):(u=d,f=p),s+=u,a+=f,l+=u*f;h+=u*u}var m=[[e.length,s],[s,h]],g=[[a],[l]],v=Matrix.inverse(m),y=Matrix.multiply(v,g);return Matrix.traceMatrix(y),y},r.getNiheCurABC=function(e,t,i,r,n,o){for(var s=0,a=0,l=0,h=0,c=0,u=0,f=0,d=0;d<e.length;d++){var p,m,g=e[d][0],v=e[d][1];t?(p=g/i*n,m=v/r*o):(p=g,m=v),s+=p,a+=m,l+=p*m;var y=p*p;h+=y,c+=y*m,u+=y*p,f+=y*y}var _=[[e.length,s,h],[s,h,u],[h,u,f]],b=[[a],[l],[c]],x=Matrix.inverse(_),T=Matrix.multiply(x,b);return Matrix.traceMatrix(T),T},r.getSomeData=function(e){if(0!=e.length){for(var t,i,n=0;n<e.length;n++){var o=e[n];0==n?(t=o,i=o):(o[0]>t[0]&&(t=o),o[1]>i[1]&&(i=o))}e=r.lToBArr(e);var s=1,a=1,l=1,h=1,c=t[0],u=i[1],f=r.getMinSec(c,u);return c>u?(u*=f,a=f):u>c&&(c*=f,s=f),console.log("_kxx,_kyy",s,a),c>=u&&(l=h=c/r.PLANE_W),u>=c&&(l=h=u/r.PLANE_H),console.log("_kx,_ky",l,h),[l,h,s,a]}},r.lToBArr=function(e){for(var t=1;t<e.length;t++)for(var i=0;i<e.length-t;i++)e[i][0]>e[i+1][0]&&(temp=e[i],e[i]=e[i+1],e[i+1]=temp);return e},r.getMinSec=function(e,t){if(e==t||0==e||0==t)return 1;for(var i=Math.min(e,t),r=Math.max(e,t),n=r/i,o=0,s=0,a=0;;){var l=i*Math.pow(10,s);if(l>r){a=l/r,a<n&&(n=a,o=s);break}(a=r/l)<n&&(n=a,o=s),s++}return Math.pow(10,o)},e.exports=r},function(e,t,i){"use strict";var r={};r.init=function(){this.renderer=PIXI.autoDetectRenderer(409,409,{transparent:!0}),document.body.appendChild(this.renderer.view),this.stage=new PIXI.Container,this.bunny=new PIXI.Sprite,this.stage.addChild(this.bunny),this.bunny.x=250,this.bunny.y=250,this.bunny.pivot.x=204.5,this.bunny.pivot.y=204.5},r.trimPic=function(e){e.texture=e,this.renderer.render(this.stage)},e.exports=r},function(e,t,i){"use strict";function r(e){function t(e){return e=e.replace(/,/g,"，"),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/!/g,"！"),e=e.replace(/\?/g,"？")}function i(){for(var e=0,t=0;t<f.children.length;t++){var i=f.children[t];i.x=nb.canvasWidth-d-i.style.wordWrapWidth>>1,i.y=e,e+=i.height}}function r(){p?(G=z,H=$(window).height()-G-60):(G=50,H=$(window).height()-2*G-60);var e={position:"absolute",top:G,width:"630px",height:H,left:$(window).width()/2-120+"px"};U.css(e)}function a(){var e=this,t=this.id.substr(1,1);$("#ap"+t).is(":animated")||(e.isOpen?$("#ap"+t).slideUp("fast"):$("#ap"+t).slideDown("fast"),e.isOpen=!e.isOpen)}function l(){var e=$("#txtDiv").height(),t=$("#disDiv").height(),i=(t-G-e)/2;0==K&&(K=40==M?0+2*M:0+A/2),p?e=K:i<0?e=0:(e=i,console.log(i)),$("#txtDiv").css({marginTop:e+"px",width:"600px"})}function h(e){clearInterval(q)}function c(e){q=setInterval(l,20)}function u(){$("#disDiv").css({top:G,left:$(window).width()/2-120+"px"}),$("#dis_img").css({left:$(window).width()/2-120+w.imgOffsetLeft+"px"})}PIXI.Container.call(this);var f=new PIXI.Container;this.addChild(f);var d=nb.stackPosX+300,p=!0;try{var m=new PIXI.Sprite.fromFrame("discuss.png")}catch(e){var m=new PIXI.Container;p=!1}var g=m.height,v=m.width,y=800;if(v>1300&&(y=1200),g>v){var _=400/g;m.height=400,m.width=_*v}if(v>2*g){var _=y/v;m.width=y,m.height=_*g}if(v<2*g&&g<v){var b=Math.abs(v/g),_=(400+100*b)/v;m.width=400+100*b,m.height=_*g}var x=instance.renderer.view.height/$(instance.renderer.view).height(),T=new PIXI.CanvasRenderer(BiologyMain.W,BiologyMain.H),E=m.generateTexture(T),S=E.getBase64(),w=document.createElement("div");w.id="dis_img",w.innerHTML='<img id="disImg" src="'+S+'" style="position: relative; width: '+m.width/x+"px;height: "+m.height/x+'px;">',$("body").append(w),$("#dis_img").css({position:"absolute"}),m.x=nb.canvasWidth-d-m.width/2>>1;var M=0,A=0;m.height<200?(M=40,m.y=(600-m.height)/2-M,A=(600-m.height)/2):(m.y=(600-m.height)/2,A=(600-m.height)/2);var P=(new PIXI.Sprite.fromFrame("conclusion.replay"),e.text.split(/\n/));for(I=1;I<P.length;I++){var C=P[I];C.length>2&&"、"!=C.charAt(1)&&(P[I-1]=P[I-1]+"\n"+P[I],P.splice(I,1),I--)}for(var R=[],D=P.length,I=0;I<D;I++){var O=P[I],F=n(),L=/\[([\s\S]*)\]/,B=L.exec(O);null!=B&&(B[1]=t(B[1]),O=O.replace(B[0],""),F.answer=o(),F.answer.text=B[1],F.addEventListener(TouchEvent.TOUCH_BEGIN,function(e){if(null==this.answer.parent){f.getChildIndex(this);this.answer.alpha=0,this.answer.scale.x=0,this.answer.scale.y=0}this.isOpen?(TweenMax.to(this.answer,.4,{alpha:0,onUpdate:i}),TweenMax.to(this.answer.scale,.4,{x:0,y:0})):(TweenMax.to(this.answer,.4,{alpha:1,onUpdate:i}),TweenMax.to(this.answer.scale,.4,{x:1,y:1})),this.isOpen=!this.isOpen})),R.push(O),F.text=O,F.y=f.height}f.x=nb.canvasWidth-d-s>>1,f.y=m.y+m.height+(nb.canvasHeight-m.y-m.height-f.height>>1),$(window).resize(u),u();var N=instance.getCurrentFrame();N.onResume=function(){$("#disDiv").show(),$("#dis_img").show()},N.onPause=function(){$("#disDiv").hide(),$("#dis_img").hide()};var k=document.createElement("div");k.id="disDiv",$($("#logo").get(0)).before(k),$("#disDiv").css({"-webkit-user-select":"none","-moz-user-select":"none","user-select":"none",cursor:"default"});var V=document.createElement("div");V.id="txtDiv";var U=$("#disDiv");U.append(V);var z=(m.y+m.height)/x,G=0,H=0;r(),window.addEventListener("resize",r),w.imgOffsetLeft=(600-$("#dis_img").width())/2,$("#dis_img").css({left:$(window).width()/2-120+w.imgOffsetLeft+"px",top:G-$("#dis_img").height()}),$("#disImg").css("margin-top",(G-$("#disImg").height())/2);for(var I=0;I<D;I++){var j='<div id="txtParentDiv'+I+'" class="txtParentDiv"></div>';R[I]=t(R[I]);var W="<p id='p"+I+"' class='_p'>"+R[I]+"</p>",O=P[I],L=/\[([\s\S]*)\]/,B=L.exec(O);if($("#p"+I).isOpen=!1,null!=B){B[1]=t(B[1]),O=O.replace(B[0],"");var X=B[1],Y="<p id='ap"+I+"' class='answer'>"+X+"</p>";$("#txtDiv").append(j),$("#txtParentDiv"+I).append(W),$("#txtParentDiv"+I).append(Y),$("#p"+I).click(a)}textControl($("#p"+I).get(0),!0,function(){},23,1.5),textControl($("#ap"+I).get(0),!0,function(){},20,1.5)}$(".txtParentDiv").css({"margin-bottom":"20px"}),$("._p").css({margin:0,color:"#FFFFFF",fontSize:"23px",padding:"0px"}),$(".answer").css({color:"#FFFF00",fontSize:"20px",padding:"20px 0 0",margin:"0px",display:"none",textIndent:"2em"});var K=0;l();var q,N=instance.getCurrentFrame();N.addEventListener("onPause",h),N.addEventListener("onResume",c),U.mCustomScrollbar({callbacks:{onCreate:function(){$(".mCSB_container").css({height:"auto"}),console.log("创建成功")}}})}function n(){return new PIXI.Text("",{fill:"#FFFFFF",strokeThickness:6,font:'normal 45px "Microsoft Yahei"',wordWrap:!0,wordWrapWidth:s,lineHeight:100})}function o(){return new PIXI.Text("",{fill:"#FFF000",strokeThickness:6,font:'normal 45px "Microsoft Yahei"',wordWrap:!0,wordWrapWidth:s,lineHeight:80})}var s=1050;r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.setText=function(e){this.text.text=e},e.exports=r},function(e,t,i){"use strict";function r(e){function t(){var e=$(window).width()-u;if($(window).width()>=640){$(window).width()-u>600?$("#_div_").css("width","600px"):$("#_div_").css("width",e);var t=$("#_div_").width();$("#_div_").css({top:$(window).height()/2-n.height()/2,left:u+(e-t)/2})}else $("#_div_").css("width",$(window).width()-10),$("#_div_").css({top:$(window).height()/2-n.height()/2,left:5})}PIXI.Container.call(this);var i=new PIXI.Sprite.fromFrame("frames.purpose");i.x=nb.canvasWidth-nb.stackPosX-i.width>>1,i.y=150,e.text=function(e){return e=e.replace(/,/g,"，"),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/\D\./g,function(e){return"."!==e.substr(0,1)?e.substr(0,1)+"。":"。。"}),e=e.replace(/!/g,"！"),e=e.replace(/\?/g,"？"),e=e.replace(/<br>/g,"")}(e.text);new PIXI.Sprite.fromFrame("conclusion.replay");this.text=new PIXI.Text("",{fill:"#FFFFFF",font:'normal 45px "Microsoft Yahei"',wordWrap:!0,wordWrapWidth:1550,lineHeight:100});var r=document.createElement("div");r.id="_div_",$("body").append(r);var n=$("#_div_"),o=instance.getCurrentFrame(),s=$("<div></div>");s.addClass("ft_"+o.name),n.append(s);for(var a=e.text.split("\n"),l=0;l<a.length;l++){var h=a[l];h=h.replace(/(\s|&nbsp;)+/g,"")+"\n";var c='<span id="_txt_" style="position: relative;margin: 50px; width:auto">'+h+"</span><br>";s.append(c)}o.showText=s,o.onResume=function(){$("#_div_").show(),o.showText.show(),t(),textControl(r,!0,t,23,2)},o.onPause=function(){$("#_div_").hide(),o.showText.hide(),textControl(r,!1)},n.css({position:"absolute",width:"600px",margin:0,color:"#FFFFFF",padding:"0px",top:$(window).height()/2-n.height()/2,left:$(window).width()/2-120+"px","z-index":-1});var u=336;$(window).resize(t),t()}r.prototype=Object.create(PIXI.Container.prototype),r.constructor=r,r.prototype.setText=function(e){this.text.text=e,this.text.y=BiologyMain.H-this.text.height>>1},e.exports=r},function(e,t,i){"use strict";(function(t){var i=t.THREE;i.Animation=function(e,t){this.root=e,this.data=i.AnimationHandler.init(t),this.hierarchy=i.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=i.AnimationHandler.LINEAR},i.Animation.prototype={constructor:i.Animation,keyTypes:["pos","rot","scl"],play:function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.reset(),i.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,i.AnimationHandler.stop(this)},reset:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e];void 0===i.animationCache&&(i.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});var r=this.data.name,n=i.animationCache.animations,o=n[r];void 0===o&&(o={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:i.matrix},n[r]=o);for(var s=0;s<3;s++){for(var a=this.keyTypes[s],l=this.data.hierarchy[e].keys[0],h=this.getNextKeyWith(a,e,1);h.time<this.currentTime&&h.index>l.index;)l=h,h=this.getNextKeyWith(a,e,h.index+1);o.prevKey[a]=l,o.nextKey[a]=h}}},resetBlendWeights:function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e],r=i.animationCache;if(void 0!==r){var n=r.blending;n.positionWeight=0,n.quaternionWeight=0,n.scaleWeight=0}}},update:function(){var e=[],t=new i.Vector3,r=new i.Vector3,n=new i.Quaternion,o=function(e,t){var i,r,n,o,a,l,h,c,u,f=[],d=[];return i=(e.length-1)*t,r=Math.floor(i),n=i-r,f[0]=0===r?r:r-1,f[1]=r,f[2]=r>e.length-2?r:r+1,f[3]=r>e.length-3?r:r+2,l=e[f[0]],h=e[f[1]],c=e[f[2]],u=e[f[3]],o=n*n,a=n*o,d[0]=s(l[0],h[0],c[0],u[0],n,o,a),d[1]=s(l[1],h[1],c[1],u[1],n,o,a),d[2]=s(l[2],h[2],c[2],u[2],n,o,a),d},s=function(e,t,i,r,n,o,s){var a=.5*(i-e),l=.5*(r-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*n+t};return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,0!==this.weight)){var a=this.data.length;(this.currentTime>a||this.currentTime<0)&&(this.loop?(this.currentTime%=a,this.currentTime<0&&(this.currentTime+=a),this.reset()):this.stop());for(var l=0,h=this.hierarchy.length;l<h;l++)for(var c=this.hierarchy[l],u=c.animationCache.animations[this.data.name],f=c.animationCache.blending,d=0;d<3;d++){var p=this.keyTypes[d],m=u.prevKey[p],g=u.nextKey[p];if(this.timeScale>0&&g.time<=this.currentTime||this.timeScale<0&&m.time>=this.currentTime){for(m=this.data.hierarchy[l].keys[0],g=this.getNextKeyWith(p,l,1);g.time<this.currentTime&&g.index>m.index;)m=g,g=this.getNextKeyWith(p,l,g.index+1);u.prevKey[p]=m,u.nextKey[p]=g}var v=(this.currentTime-m.time)/(g.time-m.time),y=m[p],_=g[p];if(v<0&&(v=0),v>1&&(v=1),"pos"===p){if(this.interpolationType===i.AnimationHandler.LINEAR){r.x=y[0]+(_[0]-y[0])*v,r.y=y[1]+(_[1]-y[1])*v,r.z=y[2]+(_[2]-y[2])*v;var b=this.weight/(this.weight+f.positionWeight);c.position.lerp(r,b),f.positionWeight+=this.weight}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",l,m.index-1).pos,e[1]=y,e[2]=_,e[3]=this.getNextKeyWith("pos",l,g.index+1).pos,v=.33*v+.33;var x=o(e,v),b=this.weight/(this.weight+f.positionWeight);f.positionWeight+=this.weight;var T=c.position;if(T.x=T.x+(x[0]-T.x)*b,T.y=T.y+(x[1]-T.y)*b,T.z=T.z+(x[2]-T.z)*b,this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var E=o(e,1.01*v);t.set(E[0],E[1],E[2]),t.sub(T),t.y=0,t.normalize();var S=Math.atan2(t.x,t.z);c.rotation.set(0,S,0)}}}else if("rot"===p)if(i.Quaternion.slerp(y,_,n,v),0===f.quaternionWeight)c.quaternion.copy(n),f.quaternionWeight=this.weight;else{var b=this.weight/(this.weight+f.quaternionWeight);i.Quaternion.slerp(c.quaternion,n,c.quaternion,b),f.quaternionWeight+=this.weight}else if("scl"===p){r.x=y[0]+(_[0]-y[0])*v,r.y=y[1]+(_[1]-y[1])*v,r.z=y[2]+(_[2]-y[2])*v;var b=this.weight/(this.weight+f.scaleWeight);c.scale.lerp(r,b),f.scaleWeight+=this.weight}}return!0}}}(),getNextKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?r=r<n.length-1?r:n.length-1:r%=n.length;r<n.length;r++)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[0]},getPrevKeyWith:function(e,t,r){var n=this.data.hierarchy[t].keys;for(r=this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+n.length;r>=0;r--)if(void 0!==n[r][e])return n[r];return this.data.hierarchy[t].keys[n.length-1]}},e.exports=i.Animation}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.THREE;i.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(!0===e.initialized)return e;for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof i.Quaternion)){var n=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=(new i.Quaternion).fromArray(n)}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var o={},r=0;r<e.hierarchy[t].keys.length;r++)for(var s=0;s<e.hierarchy[t].keys[r].morphTargets.length;s++){var a=e.hierarchy[t].keys[r].morphTargets[s];o[a]=-1}e.hierarchy[t].usedMorphTargets=o;for(var r=0;r<e.hierarchy[t].keys.length;r++){var l={};for(var a in o){for(var s=0;s<e.hierarchy[t].keys[r].morphTargets.length;s++)if(e.hierarchy[t].keys[r].morphTargets[s]===a){l[a]=e.hierarchy[t].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[t].keys[r].morphTargets.length&&(l[a]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=l}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}return e.initialized=!0,e},parse:function(e){var t=[];if(e instanceof i.SkinnedMesh)for(var r=0;r<e.skeleton.bones.length;r++)t.push(e.skeleton.bones[r]);else!function e(t,i){i.push(t);for(var r=0;r<t.children.length;r++)e(t.children[r],i)}(e,t);return t},play:function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},stop:function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},update:function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].resetBlendWeights();for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}},e.exports=i.AnimationHandler}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var i=t.THREE;i.KeyFrameAnimation=function(e){this.root=e.node,this.data=i.AnimationHandler.init(e),this.hierarchy=i.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,r=this.hierarchy.length;t<r;t++){var n=this.data.hierarchy[t].keys,o=this.data.hierarchy[t].sids,s=this.hierarchy[t];if(n.length&&o){for(var a=0;a<o.length;a++){var l=o[a],h=this.getNextKeyWith(l,t,0);h&&h.apply(l)}s.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},i.KeyFrameAnimation.prototype={constructor:i.KeyFrameAnimation,play:function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,r,n,o=this.hierarchy.length;for(t=0;t<o;t++){r=this.hierarchy[t],n=this.data.hierarchy[t],void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=r.matrix);var s=this.data.hierarchy[t].keys;s.length&&(n.animationCache.prevKey=s[0],n.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,i.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1,this.isPaused=!1,i.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var n=r.animationCache.originalMatrix;n.copy(t.matrix),t.matrix=n,delete r.animationCache}}},update:function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var i=0,r=this.hierarchy.length;i<r;i++){var n=this.hierarchy[i],o=this.data.hierarchy[i],s=o.keys,a=o.animationCache;if(s.length){var l=a.prevKey,h=a.nextKey;if(h.time<=this.currentTime){for(;h.time<this.currentTime&&h.index>l.index;)l=h,h=s[l.index+1];a.prevKey=l,a.nextKey=h}h.time>=this.currentTime?l.interpolate(h,this.currentTime):l.interpolate(h,h.time),this.data.hierarchy[i].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(i%=r.length;i<r.length;i++)if(r[i].hasTarget(e))return r[i];return r[0]},getPrevKeyWith:function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=i>=0?i:i+r.length;i>=0;i--)if(r[i].hasTarget(e))return r[i];return r[r.length-1]}},e.exports=i.KeyFrameAnimation}).call(t,i(1))},function(e,t){THREE.ColladaLoader=function(){function e(e,i,r,n){var o=0;if(document.implementation&&document.implementation.createDocument){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){if(0===s.status||200===s.status)if(s.responseXML)He=i,t(s.responseXML,void 0,e);else if(s.responseText){He=i;var a=new DOMParser,l=a.parseFromString(s.responseText,"application/xml");t(l,void 0,e)}else faillCallback?n():console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else 3===s.readyState&&r&&(0===o&&(o=s.getResponseHeader("Content-Length")),r({total:o,loaded:s.responseText.length}))},s.open("GET",e,!0),s.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(ze=e.charAt?jQuery.parseXML(e):e,t=t||He,void 0!==i){var o=i.split("/");o.pop(),ke=(o.length<1?".":o.join("/"))+"/"}r(),we(),We=n("library_images image",R,"image"),qe=n("library_materials material",Z,"material"),Qe=n("library_effects effect",ie,"effect"),Ke=n("library_geometries geometry",U,"geometry"),Ze=n("library_cameras camera",le,"camera"),Je=n("library_lights light",ce,"light"),Ye=n("library_controllers controller",D,"controller"),Xe=n("library_animations animation",ne,"animation"),Be=n("library_visual_scenes visual_scene",F,"visual_scene"),Ne=n("library_kinematics_models kinematics_model",fe,"kinematics_model"),Ve=[],Ue=[],Ie=a(),Ge=new THREE.Group;for(var s=0;s<Ie.nodes.length;s++)Ge.add(b(Ie.nodes[s]));Ge.scale.multiplyScalar(tt),h(),Oe=l(),_();var c={scene:Ge,morphs:Ve,skins:Ue,animations:Fe,kinematics:Le,dae:{images:We,materials:qe,cameras:Ze,lights:Je,effects:Qe,geometries:Ke,controllers:Ye,animations:Xe,visualScenes:Be,visualScene:Ie,scene:Ie,kinematicsModels:Ne,kinematicsModel:Oe}};return t&&t(c),c}function i(e){$e=e}function r(){var e=ze.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];switch(r.nodeName){case"unit":var n=r.getAttribute("meter");n&&(tt=parseFloat(n));break;case"up_axis":it=r.textContent.charAt(0)}}}function n(e,t,i){for(var r=ze.querySelectorAll(e),n={},o=0,s=r.length,a=0;a<s;a++){var l=r[a],h=(new t).parse(l);h.id&&0!==h.id.length||(h.id=i+o++),n[h.id]=h}return n}function a(){var e=ze.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return Be[t.length>0?t:"visual_scene0"]}return null}function l(){var e=ze.querySelectorAll("instance_kinematics_model")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return Ne[t.length>0?t:"kinematics_model0"]}return null}function h(){Fe=[],c(Ge)}function c(e){var t=Ie.getChildById(e.colladaId,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},Fe.push(i);for(var r=0,n=t.keys.length;r<n;r++)i.length=Math.max(i.length,t.keys[r].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var r=0,n=e.children.length;r<n;r++)for(var o=c(e.children[r]),s=0,a=o.hierarchy.length;s<a;s++)i.hierarchy.push({keys:[],sids:[]});return i}function u(){var e,t=1e6,i=-t,r=0;for(var n in Xe){var o=Xe[n];e=e||o.id;for(var s=0;s<o.sampler.length;s++){var a=o.sampler[s];a.create(),t=Math.min(t,a.startTime),i=Math.max(i,a.endTime),r=Math.max(r,a.input.length)}}return{start:t,end:i,frames:r,ID:e}}function f(e,t){var i=t instanceof N?Ye[t.url]:t;if(!i||!i.morph)return void console.log("could not find morph controller!");for(var r=i.morph,n=0;n<r.targets.length;n++){var o=r.targets[n],s=Ke[o];if(s.mesh&&s.mesh.primitives&&s.mesh.primitives.length){var a=s.mesh.primitives[0].geometry;a.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:a.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function d(e,t,i,r){if(e.world=e.world||new THREE.Matrix4,e.localworld=e.localworld||new THREE.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var n=e.channels[0],o=n.sampler.output[i];o instanceof THREE.Matrix4&&(e.world.copy(o),e.localworld.copy(o),0===i&&e.matrix.copy(o))}r&&e.world.multiplyMatrices(r,e.world),t.push(e);for(var s=0;s<e.nodes.length;s++)d(e.nodes[s],t,i,e.world)}function p(e,t){for(var i=0;i<e.length;i++){var r=e[i],n=-1;if("JOINT"==r.type){for(var o=0;o<t.joints.length;o++)if(r.sid===t.joints[o]){n=o;break}if(n>=0){var s=t.invBindMatrices[n];r.invBindMatrix=s,r.skinningMatrix=new THREE.Matrix4,r.skinningMatrix.multiplyMatrices(r.world,s),r.animatrix=new THREE.Matrix4,r.animatrix.copy(r.localworld),r.weights=[];for(var o=0;o<t.weights.length;o++)for(var a=0;a<t.weights[o].length;a++){var l=t.weights[o][a];l.joint===n&&r.weights.push(l)}}else r.skinningMatrix=new THREE.Matrix4,r.weights=[]}}}function m(e){var t=[],i=function(e,t,r){var n={};n.name=t.sid,n.parent=e,n.matrix=t.matrix;var o=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];n.matrix.decompose(o[0],o[1],o[2]),n.pos=[o[0].x,o[0].y,o[0].z],n.scl=[o[2].x,o[2].y,o[2].z],n.rotq=[o[1].x,o[1].y,o[1].z,o[1].w],r.push(n);for(var s in t.nodes)i(t.sid,t.nodes[s],r)};return i(-1,e,t),t}function g(e,t,i){var r=[];d(t,r,-1),p(r,i.skin),v=new THREE.Vector3;for(var n=[],a=0;a<e.vertices.length;a++)n.push(new THREE.Vector3);for(a=0;a<r.length;a++)if("JOINT"==r[a].type)for(j=0;j<r[a].weights.length;j++)w=r[a].weights[j],vidx=w.index,weight=w.weight,o=e.vertices[vidx],s=n[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(r[a].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var a=0;a<e.vertices.length;a++)e.vertices[a]=n[a]}function y(e,t,i){var r=Ye[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!t.skeleton||!t.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var n=u(),o=Ie.getChildById(t.skeleton[0],!0)||Ie.getChildBySid(t.skeleton[0],!0),s=m(o),a=r.skin.joints,l=[],h=0;h<a.length;h++)for(var c=0;c<s.length;c++)s[c].name===a[h]&&(l[h]=s[c]);for(var h=0;h<l.length;h++)for(var c=0;c<l.length;c++)void 0===l[c]&&debug,l[h].parent===l[c].name&&(l[h].parent=c);var h,c,f;new THREE.Vector3;for(h=0;h<e.vertices.length;h++)e.vertices[h].applyMatrix4(r.skin.bindShapeMatrix);for(var v=[],y=[],_=r.skin.weights,h=0;h<_.length;h++){var b=new THREE.Vector4(_[h][0]?_[h][0].joint:0,_[h][1]?_[h][1].joint:0,_[h][2]?_[h][2].joint:0,_[h][3]?_[h][3].joint:0),f=new THREE.Vector4(_[h][0]?_[h][0].weight:0,_[h][1]?_[h][1].weight:0,_[h][2]?_[h][2].weight:0,_[h][3]?_[h][3].weight:0);v.push(b),y.push(f)}e.skinIndices=v,e.skinWeights=y,e.bones=l;for(var x={name:n.ID,fps:30,length:n.frames/30,hierarchy:[]},c=0;c<l.length;c++)x.hierarchy.push({parent:l[c].parent,name:l[c].name,keys:[]});for(console.log("ColladaLoader:",n.ID+" has "+l.length+" bones."),g(e,o,r),i=0;i<n.frames;i++){var T=[];d(o,T,i),p(T,r.skin);for(var h=0;h<T.length;h++)for(var c=0;c<x.hierarchy.length;c++)if(x.hierarchy[c].name===T[h].sid){var E={};E.time=i/30,E.matrix=T[h].animatrix,0===i&&(T[h].matrix=E.matrix);var S=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];E.matrix.decompose(S[0],S[1],S[2]),E.pos=[S[0].x,S[0].y,S[0].z],E.scl=[S[2].x,S[2].y,S[2].z],E.rot=S[1],x.hierarchy[c].keys.push(E)}e.animation=x}}function _(){if(Oe&&0===Oe.joints.length)return void(Le=void 0);var e={};Le={joints:Oe&&Oe.joints,getJointValue:function(t){var i=e[t];if(i)return i.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue:function(t,r){var n=e[t];if(n){var o=n.joint;if(r>o.limits.max||r<o.limits.min)console.log("setJointValue: joint "+t+" value "+r+" outside of limits (min: "+o.limits.min+", max: "+o.limits.max+")");else if(o.static)console.log("setJointValue: joint "+t+" is static");else{var s=n.node,a=o.axis,l=n.transforms,h=new THREE.Matrix4;for(i=0;i<l.length;i++){var c=l[i];if(c.sid&&-1!==c.sid.indexOf("joint"+t))switch(o.type){case"revolute":h.multiply(u.makeRotationAxis(a,THREE.Math.degToRad(r)));break;case"prismatic":h.multiply(u.makeTranslation(a.x*r,a.y*r,a.z*r));break;default:console.warn("setJointValue: unknown joint type: "+o.type)}else{var u=new THREE.Matrix4;switch(c.type){case"matrix":h.multiply(c.obj);break;case"translate":h.multiply(u.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"rotate":h.multiply(u.makeRotationAxis(c.obj,c.angle))}}}var f=h.elements,d=Array.prototype.slice.call(f),p=[d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14],d[3],d[7],d[11],d[15]];s.matrix.set.apply(s.matrix,p),s.matrix.decompose(s.position,s.quaternion,s.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};var t=ze.querySelector("scene instance_kinematics_scene");if(t)for(var i=0;i<t.childNodes.length;i++){var r=t.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"bind_joint_axis":var n=r.getAttribute("target").split("/").pop(),o=r.querySelector("axis param").textContent,s=parseInt(o.split("joint").pop().split(".")[0]),a=ze.querySelector('[sid="'+n+'"]');if(a){var l=a.parentElement;!function(t,i){var r=i.getAttribute("id"),n=Ie.getChildById(r,!0),o=Oe.joints[t];Ge.traverse(function(i){i.colladaId==r&&(e[t]={node:i,transforms:n.transforms,joint:o,position:o.zeroPosition})})}(s,l)}}}}function b(e,t){var i,r,n,o,s=new THREE.Object3D;for(n=0;n<e.controllers.length;n++){var a=Ye[e.controllers[n].url];switch(a.type){case"skin":if(Ke[a.skin.source]){var l=new V;l.url=a.skin.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l),!0,i=e.controllers[n]}else if(Ye[a.skin.source]){var h=Ye[a.skin.source];if(r=h,h.morph&&Ke[h.morph.source]){var l=new V;l.url=h.morph.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l)}}break;case"morph":if(Ke[a.morph.source]){var l=new V;l.url=a.morph.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l),r=e.controllers[n]}console.log("ColladaLoader: Morph-controller partially supported.")}}var c={};for(n=0;n<e.geometries.length;n++){var u,d=e.geometries[n],p=d.instance_material,m=Ke[d.url],g={},v=[],_=0;if(m){if(!m.mesh||!m.mesh.primitives)continue;if(0===s.name.length&&(s.name=m.id),p)for(o=0;o<p.length;o++){var x=p[o],T=qe[x.target],E=T.instance_effect.url,S=Qe[E].shader,w=S.material;if(m.doubleSided){if(!(x.symbol in c)){var M=w.clone();M.side=THREE.DoubleSide,c[x.symbol]=M}w=c[x.symbol]}w.opacity=w.opacity?w.opacity:1,g[x.symbol]=_,v.push(w),u=w,u.name=null===T.name||""===T.name?T.id:T.name,_++}var A,P=u||new THREE.MeshLambertMaterial({color:14540253,side:m.doubleSided?THREE.DoubleSide:THREE.FrontSide}),C=m.mesh.geometry3js;if(_>1)for(P=new THREE.MeshFaceMaterial(v),o=0;o<C.faces.length;o++){var R=C.faces[o];R.materialIndex=g[R.daeMaterial]}void 0!==i?(y(C,i),C.morphTargets.length>0?(P.morphTargets=!0,P.skinning=!1):(P.morphTargets=!1,P.skinning=!0),A=new THREE.SkinnedMesh(C,P,!1),A.name="skin_"+Ue.length,Ue.push(A)):void 0!==r?(f(C,r),P.morphTargets=!0,A=new THREE.Mesh(C,P),A.name="morph_"+Ve.length,Ve.push(A)):A=!0===C.isLineStrip?new THREE.Line(C):new THREE.Mesh(C,P),s.add(A)}}for(n=0;n<e.cameras.length;n++){var D=e.cameras[n],I=Ze[D.url],O=new THREE.PerspectiveCamera(I.yfov,parseFloat(I.aspect_ratio),parseFloat(I.znear),parseFloat(I.zfar));s.add(O)}for(n=0;n<e.lights.length;n++){var F=null,L=e.lights[n],B=Je[L.url];if(B&&B.technique){var N=B.color.getHex(),k=B.intensity,U=B.distance,z=B.falloff_angle;switch(B.technique){case"directional":F=new THREE.DirectionalLight(N,k,U),F.position.set(0,0,1);break;case"point":F=new THREE.PointLight(N,k,U);break;case"spot":F=new THREE.SpotLight(N,k,U,z,void 0),F.position.set(0,0,1);break;case"ambient":F=new THREE.AmbientLight(N)}}F&&s.add(F)}if(s.name=e.name||e.id||"",s.colladaId=e.id||"",s.layer=e.layer||"",s.matrix=e.matrix,s.matrix.decompose(s.position,s.quaternion,s.scale),et.centerGeometry&&s.geometry){var G=s.geometry.center();G.multiply(s.scale),G.applyQuaternion(s.quaternion),s.position.sub(G)}for(n=0;n<e.nodes.length;n++)s.add(b(e.nodes[n],e));return s}function x(e){for(var t=ze.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var r=t[i].attributes.getNamedItem("id");if(r&&r.value===e)return t[i]}}function T(e){var t=[],i=1e6,r=-1e6;for(var n in Xe)for(var o=Xe[n],s=0;s<o.channel.length;s++){var a=o.channel[s],l=o.sampler[s],n=a.target.split("/")[0];n==e.id&&(l.create(),a.sampler=l,i=Math.min(i,l.startTime),r=Math.max(r,l.endTime),t.push(a))}return t.length&&(e.startTime=i,e.endTime=r),t}function E(e){if(e.channels&&e.channels.length){for(var t=[],i=[],r=0,n=e.channels.length;r<n;r++){var o,s=e.channels[r],a=s.fullSid,l=s.sampler,h=l.input,c=e.getTransformBySid(s.sid);if(s.arrIndices){o=[];for(var u=0,f=s.arrIndices.length;u<f;u++)o[u]=Re(s.arrIndices[u])}else o=De(s.member);if(c){-1===i.indexOf(a)&&i.push(a);for(var u=0,f=h.length;u<f;u++){var d=h[u],p=l.getData(c.type,u,o),m=S(t,d);if(!m){m=new ae(d);var g=M(t,d);t.splice(-1===g?t.length:g,0,m)}m.addTarget(a,c,o,p)}}else console.log('Could not find transform "'+s.sid+'" in node '+e.id)}for(var r=0;r<i.length;r++)for(var v=i[r],u=0;u<t.length;u++){var m=t[u];m.hasTarget(v)||A(t,m,u,v)}e.keys=t,e.sids=i}}function S(e,t){for(var i=null,r=0,n=e.length;r<n&&null===i;r++){var o=e[r];if(o.time===t)i=o;else if(o.time>t)break}return i}function M(e,t){for(var i=-1,r=0,n=e.length;r<n&&-1===i;r++){e[r].time>=t&&(i=r)}return i}function A(e,t,i,r){var n=C(e,r,i?i-1:0),o=P(e,r,i+1);if(n&&o){var s,a=(t.time-n.time)/(o.time-n.time),l=n.getTarget(r),h=o.getTarget(r).data,c=l.data;if("matrix"===l.type)s=c;else if(c.length){s=[];for(var u=0;u<c.length;++u)s[u]=c[u]+(h[u]-c[u])*a}else s=c+(h-c)*a;t.addTarget(r,l.transform,l.member,s)}}function P(e,t,i){for(;i<e.length;i++){var r=e[i];if(r.hasTarget(t))return r}return null}function C(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var r=e[i];if(r.hasTarget(t))return r}return null}function R(){this.id="",this.init_from=""}function D(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function I(){this.method=null,this.source=null,this.targets=null,this.weights=null}function O(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function F(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Group}function L(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function B(){this.sid="",this.type="",this.data=[],this.obj=null}function N(){this.url="",this.skeleton=[],this.instance_material=[]}function k(){this.symbol="",this.target=""}function V(){this.url="",this.instance_material=[]}function U(){this.id="",this.mesh=null}function z(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function G(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function H(){G.call(this),this.vcount=[]}function W(){G.call(this),this.vcount=1}function X(){G.call(this),this.vcount=3}function Y(){this.source="",this.count=0,this.stride=0,this.params=[]}function K(){this.input={}}function q(){this.semantic="",this.offset=0,this.source="",this.set=0}function Q(e){this.id=e,this.type=null}function Z(){this.id="",this.name="",this.instance_effect=null}function J(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function $(e,t){this.type=e,this.effect=t,this.material=null}function ee(e){this.effect=e,this.init_from=null,this.format=null}function te(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function ie(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function re(){this.url=""}function ne(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function oe(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function se(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function ae(e){this.targets=[],this.time=e}function le(){this.id="",this.name="",this.technique=""}function he(){this.url=""}function ce(){this.id="",this.name="",this.technique=""}function ue(){this.url=""}function fe(){this.id="",this.name="",this.joints=[],this.links=[]}function de(){this.sid="",this.name="",this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function pe(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function me(){this.joint="",this.transforms=[],this.links=[]}function ge(e){var t=e.getAttribute("id");return void 0!=je[t]?je[t]:(je[t]=new Q(t).parse(e),je[t])}function ve(e){for(var t=be(e),i=[],r=0,n=t.length;r<n;r++)i.push("true"===t[r]||"1"===t[r]);return i}function ye(e){for(var t=be(e),i=[],r=0,n=t.length;r<n;r++)i.push(parseFloat(t[r]));return i}function _e(e){for(var t=be(e),i=[],r=0,n=t.length;r<n;r++)i.push(parseInt(t[r],10));return i}function be(e){return e.length>0?xe(e).split(/\s+/):[]}function xe(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function Te(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function Ee(e,t){loader=new THREE.ImageLoader,loader.load(t,function(t){e.image=t,e.needsUpdate=!0})}function Se(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function we(){if(!0!==et.convertUpAxis||it===et.upAxis)rt=null;else switch(it){case"X":rt="Y"===et.upAxis?"XtoY":"XtoZ";break;case"Y":rt="X"===et.upAxis?"YtoX":"YtoZ";break;case"Z":rt="X"===et.upAxis?"ZtoX":"ZtoY"}}function Me(e,t){if(!0===et.convertUpAxis&&it!==et.upAxis)switch(rt){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function Ae(e,t){if(!0!==et.convertUpAxis||it===et.upAxis)return t;switch(e){case"X":t="XtoY"===rt?-1*t:t;break;case"Y":t="YtoZ"===rt||"YtoX"===rt?-1*t:t;break;case"Z":t="ZtoY"===rt?-1*t:t}return t}function Pe(e,t){var i=[e[t],e[t+1],e[t+2]];return Me(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function Ce(e){if(et.convertUpAxis){var t=[e[0],e[4],e[8]];Me(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],Me(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],Me(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],Me(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],Me(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],Me(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],Me(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return(new THREE.Matrix4).set(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Re(e){if(e>-1&&e<3){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=De(t[e]),e=i[e]}return e}function De(e){if(et.convertUpAxis)switch(e){case"X":switch(rt){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch(rt){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch(rt){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var Ie,Oe,Fe,Le,Be,Ne,ke,Ve,Ue,ze=null,Ge=null,He=null,je={},We={},Xe={},Ye={},Ke={},qe={},Qe={},Ze={},Je={},$e=THREE.SmoothShading,et={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},tt=1,it="Y",rt=null;return R.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"===i.nodeName&&(this.init_from=i.textContent)}return this},D.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new O).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new I).parse(i),this.type=i.nodeName}}return this},I.prototype.parse=function(e){var t,i={},r=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(1==n.nodeType)switch(n.nodeName){case"source":var o=(new Q).parse(n);i[o.id]=o;break;case"targets":r=this.parseInputs(n);break;default:console.log(n.nodeName)}}for(t=0;t<r.length;t++){var s=r[t],o=i[s.source];switch(s.semantic){case"MORPH_TARGET":this.targets=o.read();break;case"MORPH_WEIGHT":this.weights=o.read()}}return this},I.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":t.push((new q).parse(r))}}return t},O.prototype.parse=function(e){var t,i,r={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var s=ye(o.textContent);this.bindShapeMatrix=Ce(s);break;case"source":var a=(new Q).parse(o);r[a.id]=a;break;case"joints":t=o;break;case"vertex_weights":i=o;break;default:console.log(o.nodeName)}}return this.parseJoints(t,r),this.parseWeights(i,r),this},O.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"input":var n=(new q).parse(r),o=t[n.source];"JOINT"===n.semantic?this.joints=o.read():"INV_BIND_MATRIX"===n.semantic&&(this.invBindMatrices=o.read())}}},O.prototype.parseWeights=function(e,t){for(var i,r,n=[],o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1==s.nodeType)switch(s.nodeName){case"input":n.push((new q).parse(s));break;case"v":i=_e(s.textContent);break;case"vcount":r=_e(s.textContent)}}for(var a=0,o=0;o<r.length;o++){for(var l=r[o],h=[],c=0;c<l;c++){for(var u={},f=0;f<n.length;f++){var d=n[f],p=i[a+d.offset];switch(d.semantic){case"JOINT":u.joint=p;break;case"WEIGHT":u.weight=t[d.source].data[p]}}h.push(u),a+=n.length}for(var c=0;c<h.length;c++)h[c].index=o;this.weights.push(h)}},F.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},F.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},F.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new L).parse(i))}}return this},L.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i,r=this.channels[t],n=r.target.split("/"),o=(n.shift(),n.shift()),s=o.indexOf(".")>=0,a=o.indexOf("(")>=0;if(s)n=o.split("."),o=n.shift(),n.shift();else if(a){i=o.split("("),o=i.shift();for(var l=0;l<i.length;l++)i[l]=parseInt(i[l].replace(/\)/,""))}if(o===e)return r.info={sid:o,dotSyntax:s,arrSyntax:a,arrIndices:i},r}return null},L.prototype.getChildById=function(e,t){if(this.id===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildById(e,t);if(r)return r}return null},L.prototype.getChildBySid=function(e,t){if(this.sid===e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var r=this.nodes[i].getChildBySid(e,t);if(r)return r}return null},L.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid===e)return this.transforms[t];return null},L.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"node":this.nodes.push((new L).parse(r));break;case"instance_camera":this.cameras.push((new he).parse(r));break;case"instance_controller":this.controllers.push((new N).parse(r));break;case"instance_geometry":this.geometries.push((new V).parse(r));break;case"instance_light":this.lights.push((new ue).parse(r));break;case"instance_node":t=r.getAttribute("url").replace(/^#/,"");var n=x(t);n&&this.nodes.push((new L).parse(n));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new B).parse(r));break;case"extra":break;default:console.log(r.nodeName)}}return this.channels=T(this),E(this),this.updateMatrix(),this},L.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},B.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=ye(e.textContent),this.convert(),this},B.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Ce(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":Me(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Me(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},B.prototype.apply=function(){var e=new THREE.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),B.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var r="n"+(t[0]+1)+(t[1]+1);this.obj[r]=e}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},N.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var r=i.querySelectorAll("instance_material"),n=0;n<r.length;n++){var o=r[n];this.instance_material.push((new k).parse(o))}}}return this},k.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},V.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"===i.nodeName){for(var r=i.querySelectorAll("instance_material"),n=0;n<r.length;n++){var o=r[n];this.instance_material.push((new k).parse(o))}break}}return this},U.prototype.parse=function(e){this.id=e.getAttribute("id"),Se(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new z(this).parse(i)}}return this},z.prototype.parse=function(e){this.primitives=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":ge(i);break;case"vertices":this.vertices=(new K).parse(i);break;case"linestrips":this.primitives.push((new W).parse(i));break;case"triangles":this.primitives.push((new X).parse(i));break;case"polygons":this.primitives.push((new G).parse(i));break;case"polylist":this.primitives.push((new H).parse(i))}}if(this.geometry3js=new THREE.Geometry,null===this.vertices)return this;for(var r=je[this.vertices.input.POSITION.source].data,t=0;t<r.length;t+=3)this.geometry3js.vertices.push(Pe(r,t).clone());for(var t=0;t<this.primitives.length;t++){var n=this.primitives[t];n.setVertices(this.vertices),this.handlePrimitive(n,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},z.prototype.handlePrimitive=function(e,t){if(e instanceof W)return void(t.isLineStrip=!0);var i,r,n,o,s,a,l,h=e.p,c=e.inputs,u=0,f=3,d=0,p=[];for(i=0;i<c.length;i++){n=c[i];var m=n.offset+1;switch(d=d<m?m:d,n.semantic){case"TEXCOORD":p.push(n.set)}}for(var g=0;g<h.length;++g)for(var v=h[g],y=0;y<v.length;){var _=[],b=[],x=null,T=[];for(f=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:v.length/d,i=0;i<f;i++)for(r=0;r<c.length;r++)switch(n=c[r],a=je[n.source],o=v[y+i*d+n.offset],l=a.accessor.params.length,s=o*l,n.semantic){case"VERTEX":_.push(o);break;case"NORMAL":b.push(Pe(a.data,s));break;case"TEXCOORD":x=x||{},void 0===x[n.set]&&(x[n.set]=[]),x[n.set].push(new THREE.Vector2(a.data[s],a.data[s+1]));break;case"COLOR":T.push((new THREE.Color).setRGB(a.data[s],a.data[s+1],a.data[s+2]))}if(0===b.length)if(n=this.vertices.input.NORMAL){a=je[n.source],l=a.accessor.params.length;for(var E=0,S=_.length;E<S;E++)b.push(Pe(a.data,_[E]*l))}else t.calcNormals=!0;if(!x&&(x={},n=this.vertices.input.TEXCOORD)){p.push(n.set),a=je[n.source],l=a.accessor.params.length;for(var E=0,S=_.length;E<S;E++)s=_[E]*l,void 0===x[n.set]&&(x[n.set]=[]),x[n.set].push(new THREE.Vector2(a.data[s],1-a.data[s+1]))}if(0===T.length&&(n=this.vertices.input.COLOR)){a=je[n.source],l=a.accessor.params.length;for(var E=0,S=_.length;E<S;E++)s=_[E]*l,T.push((new THREE.Color).setRGB(a.data[s],a.data[s+1],a.data[s+2]))}var w,M,A=null,P=[];if(3===f)P.push(new THREE.Face3(_[0],_[1],_[2],b,T.length?T:new THREE.Color));else if(4===f)P.push(new THREE.Face3(_[0],_[1],_[3],[b[0].clone(),b[1].clone(),b[3].clone()],T.length?[T[0],T[1],T[3]]:new THREE.Color)),P.push(new THREE.Face3(_[1],_[2],_[3],[b[1].clone(),b[2].clone(),b[3].clone()],T.length?[T[1],T[2],T[3]]:new THREE.Color));else if(f>4&&et.subdivideFaces){var C=T.length?T:new THREE.Color;for(r=1;r<f-1;)P.push(new THREE.Face3(_[0],_[r],_[r+1],[b[0].clone(),b[r++].clone(),b[r].clone()],C))}if(P.length)for(var E=0,S=P.length;E<S;E++)for(A=P[E],A.daeMaterial=e.material,t.faces.push(A),r=0;r<p.length;r++)w=x[p[r]],M=f>4?[w[0],w[E+1],w[E+2]]:4===f?0===E?[w[0],w[1],w[3]]:[w[1].clone(),w[2],w[3].clone()]:[w[0],w[1],w[2]],void 0===t.faceVertexUvs[r]&&(t.faceVertexUvs[r]=[]),t.faceVertexUvs[r].push(M);else console.log("dropped face with vcount "+f+" for geometry with id: "+t.id);y+=d*f}},G.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source===e.id&&(this.inputs[t].source=e.input.POSITION.source)},G.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=Te(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new q).parse(e.childNodes[t]));break;case"vcount":this.vcount=_e(i.textContent);break;case"p":this.p.push(_e(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},H.prototype=Object.create(G.prototype),H.prototype.constructor=H,W.prototype=Object.create(G.prototype),W.prototype.constructor=W,X.prototype=Object.create(G.prototype),X.prototype.constructor=X,Y.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=Te(e,"count",0),this.stride=Te(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"===i.nodeName){var r={};r.name=i.getAttribute("name"),r.type=i.getAttribute("type"),this.params.push(r)}}return this},K.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"===e.childNodes[t].nodeName){var i=(new q).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},q.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=Te(e,"set",-1),this.offset=Te(e,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},Q.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=ve(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=ye(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=_e(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=be(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var r=0;r<i.childNodes.length;r++)if("accessor"===i.childNodes[r].nodeName){this.accessor=(new Y).parse(i.childNodes[r]);break}}}return this},Q.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var r=this.data.slice(i,i+16),n=Ce(r);e.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"===e.childNodes[t].nodeName){this.instance_effect=(new re).parse(e.childNodes[t]);break}return this},J.prototype.isColor=function(){return null===this.texture},J.prototype.isTexture=function(){return null!=this.texture},J.prototype.parse=function(e){"transparent"===e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var r=ye(i.textContent);this.color=new THREE.Color,this.color.setRGB(r[0],r[1],r[2]),this.color.a=r[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},J.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?this.texOpts[i.nodeName]=1:this.texOpts[i.nodeName]=parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},$.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new J).parse(i);break;case"bump":var r=i.getAttribute("bumptype");r?"heightfield"===r.toLowerCase()?this.bump=(new J).parse(i):"normalmap"===r.toLowerCase()?this.normal=(new J).parse(i):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+r+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new J).parse(i)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new J).parse(i));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var n=i.querySelectorAll("float");n.length>0&&(this[i.nodeName]=parseFloat(n[0].textContent))}}return this.create(),this},$.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var i=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}var r={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var o=this[n];if(o instanceof J)if(o.isTexture()){var s=o.texture,a=this.effect.sampler[s];if(void 0!==a&&void 0!==a.source){var l=this.effect.surface[a.source];if(void 0!==l){var h=We[l.init_from];if(h){var c,u=ke+h.init_from,f=THREE.Loader.Handlers.get(u);null!==f?c=f.load(u):(c=new THREE.Texture,Ee(c,u)),c.wrapS=o.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,c.wrapT=o.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,c.offset.x=o.texOpts.offsetU,c.offset.y=o.texOpts.offsetV,c.repeat.x=o.texOpts.repeatU,c.repeat.y=o.texOpts.repeatV,e[r[n]]=c,"emission"===n&&(e.emissive=16777215)}}}}else"diffuse"!==n&&t||("emission"===n?e.emissive=o.color.getHex():e[n]=o.color.getHex());break;case"shininess":e[n]=this[n];break;case"reflectivity":e[n]=this[n],e[n]>0&&(e.envMap=et.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[n],1!==this[n]&&(e.envMap=et.defaultEnvMap)}switch(e.shading=$e,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},ee.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},te.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},ie.prototype.create=function(){if(null===this.shader)return null},ie.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),Se(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},ie.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"surface":this.surface[t]=new ee(this).parse(r);break;case"sampler2D":this.sampler[t]=new te(this).parse(r);break;case"extra":break;default:console.log(r.nodeName)}}},ie.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"profile_COMMON":this.parseProfileCOMMON(r);break;case"technique":t=r;break;case"newparam":this.parseNewparam(r);break;case"image":var n=(new R).parse(r);We[n.id]=n;break;case"extra":break;default:console.log(r.nodeName)}}return t},ie.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new $(i.nodeName,this).parse(i);break;case"extra":this.parseExtra(i)}}},ie.prototype.parseExtra=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique":this.parseExtraTechnique(i)}}},ie.prototype.parseExtraTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"bump":this.shader.parse(e)}}},re.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ne.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var r=(new ne).parse(i);for(var n in r.source)this.source[n]=r.source[n];for(var o=0;o<r.channel.length;o++)this.channel.push(r.channel[o]),this.sampler.push(r.sampler[o]);break;case"source":var n=(new Q).parse(i);this.source[n.id]=n;break;case"sampler":this.sampler.push(new se(this).parse(i));break;case"channel":this.channel.push(new oe(this).parse(i))}}return this},oe.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/"),i=(t.shift(),t.shift()),r=i.indexOf(".")>=0,n=i.indexOf("(")>=0;if(r)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(n){var o=i.split("(");this.sid=o.shift();for(var s=0;s<o.length;s++)o[s]=parseInt(o[s].replace(/\)/,""));this.arrIndices=o}else this.sid=i;return this.fullSid=i,this.dotSyntax=r,this.arrSyntax=n,this},se.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new q).parse(i))}}return this},se.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},se.prototype.getData=function(e,t,i){var r;if("matrix"===e&&16===this.strideOut)r=this.output[t];else if(this.strideOut>1){r=[],t*=this.strideOut;for(var n=0;n<this.strideOut;++n)r[n]=this.output[t+n];if(3===this.strideOut)switch(e){case"rotate":case"translate":Me(r,-1);break;case"scale":Me(r,1)}else 4===this.strideOut&&"matrix"===e&&Me(r,-1)}else r=this.output[t],i&&"translate"===e&&(r=Ae(i,r));return r},ae.prototype.addTarget=function(e,t,i,r){this.targets.push({sid:e,member:i,transform:t,data:r})},ae.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},ae.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},ae.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},ae.prototype.interpolate=function(e,t){for(var i=0,r=this.targets.length;i<r;i++){var n,o=this.targets[i],s=e.getTarget(o.sid);if("matrix"!==o.transform.type&&s){var a=(t-this.time)/(e.time-this.time),l=s.data,h=o.data;if(a<0&&(a=0),a>1&&(a=1),h.length){n=[];for(var c=0;c<h.length;++c)n[c]=h[c]+(l[c]-h[c])*a}else n=h+(l-h)*a}else n=o.data;o.transform.update(n,o.member)}},le.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},le.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"===e.childNodes[t].nodeName)for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++)if(this.technique=i.childNodes[r].nodeName,"perspective"===this.technique)for(var n=i.childNodes[r],o=0;o<n.childNodes.length;o++){var s=n.childNodes[o];switch(s.nodeName){case"yfov":this.yfov=s.textContent;break;case"xfov":this.xfov=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}else if("orthographic"===this.technique)for(var a=i.childNodes[r],o=0;o<a.childNodes.length;o++){var s=a.childNodes[o];switch(s.nodeName){case"xmag":this.xmag=s.textContent;break;case"ymag":this.ymag=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}return this},he.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},ce.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},ce.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],r=0;r<i.childNodes.length;r++){var n=i.childNodes[r];switch(n.nodeName){case"color":var o=ye(n.textContent);this.color=new THREE.Color(0),this.color.setRGB(o[0],o[1],o[2]),this.color.a=o[3];break;case"falloff_angle":this.falloff_angle=parseFloat(n.textContent);break;case"quadratic_attenuation":var s=parseFloat(n.textContent);this.distance=s?Math.sqrt(1/s):0}}}return this},ce.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},ue.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},fe.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.joints=[],this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i)}}return this},fe.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(e.childNodes[t].nodeName){case"joint":this.joints.push((new de).parse(i));break;case"link":this.links.push((new pe).parse(i))}}return this},de.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.axis=new THREE.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var t=e.querySelector("axis"),i=ye(t.textContent);this.axis=Pe(i,0);var r=e.querySelector("limits min")?parseFloat(e.querySelector("limits min").textContent):-360,n=e.querySelector("limits max")?parseFloat(e.querySelector("limits max").textContent):360;this.limits={min:r,max:n};for(var o=["prismatic","revolute"],s=0;s<o.length;s++){var a=o[s];e.querySelector(a)&&(this.type=a)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},pe.prototype.parse=function(e){this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.transforms=[],this.attachments=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"attachment_full":this.attachments.push((new me).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new B).parse(i))}}return this},me.prototype.parse=function(e){this.joint=e.getAttribute("joint").split("/").pop(),this.links=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"link":this.links.push((new pe).parse(i));break;case"rotate":case"translate":case"matrix":this.transforms.push((new B).parse(i))}}return this},{load:e,parse:t,setPreferredShading:i,applySkin:y,geometries:Ke,options:et}}},function(e,t,i){"use strict";var r={};r.Mortar=i(319),e.exports=r},function(e,t,i){"use strict";function r(){this.cover.visible=!1,this.blend=function(e){e||(e=3),this.cover.main.rotation=-30/180*Math.PI,TweenMax.to(this.cover.main,.5,{yoyo:!0,repeat:e,rotation:30/180*Math.PI})},this.addMedicine=function(e,t){this.inner.addChild(e),t=t||{},t.x=t.x||0,t.y=t.y||0,e.x=-e.width/2+t.x,e.y=-e.height/2+t.y},this.checkEq=function(){if(!this.inner)throw"没有存放药品的内容对象"}}e.exports=r},function(e,t,i){"use strict";var r={};r=i(76),e.exports=r},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(184),s=function(){function e(){r(this,e)}return n(e,null,[{key:"create",value:function(e){return function(){e.apply(null,[this]);var t=new PIXI.Graphics;t.beginFill(16773120,0),t.drawRect(0,0,2e3,2e3),this.addChildAt(t,0),t.addEventListener(TouchEvent.TOUCH_END,function(){t.parent.getActiveStep().emit(nb.event.CLICK_OUT_SIDE,"uselessAction")});for(var i=null,r={},n=0;n<int.MAX_VALUE;n++){var s="step"+n;if(!this[s])break;r[s]=this[s],this[s].visible=!1,delete this[s]}this.getActiveIndex=function(){return parseInt(i.replace("step",""))},this.getActiveStep=function(){return i?this[i]:null},this.gotoStep=function(e){var t=this;if(i!==e){var n=r[e],s=n.parent,a=s[i];if(void 0===n)return void console.error("没有配置"+e+"对象");var l=n.clone(),h=l.name.replace("step","");s.addChild(l),s[l.name]=l;var c=new TimelineMax({onComplete:function(){a&&a.parent&&a.parent.removeChild(a)}});l.alpha=0,a&&c.to(a,.4,{alpha:0}),c.to(l,.4,{alpha:1},"-=0.4");var u=this["stepFunc"+h];if(u)try{l.showTip=function(e,i,r){t.tip?t.tip.setTip(e||" ",i||0,r||0):(t.tip=new o(e||" ",i||0,r||0),t.addChild(t.tip)),t.tip.displayNotes()},l.hideTip=function(){t.tip&&t.tip.hideNotes()},l.resetTip=function(){t.tip&&t.tip.setTip(" ",0,0)},l.initPhyEngine=function(){new nb.Box2d(l)},u.apply(l,[l]);var f=$("#bioCanvas");l.scene3D?f.fadeOut():f.fadeIn()}catch(e){console.error(e)}else console.warn("没有添加 stepFunc"+h+"的方法");if(i=e,l.hideTip(),a){if("step"+(parseInt(h)-1)===a.name&&!0===a._isStepComplete_)for(var d in n){var p=a[d],m=l[d];if(p instanceof PIXI.DisplayObject&&""!==d.name&&m&&m.parent===l){GlobalEffect.bezierFrom(m,1.2,{alpha:p.alpha,rotation:p.rotation,delay:.8,x:p.x,y:p.y},!0),TweenMax.from(m.scale,1.2,{x:p.scale.x,y:p.scale.y})}}a.emit("stepDestroy"),a.removeAllListeners(),this.tip&&(this.tip=null,TweenMax.killTweensOf(this.tip))}l.on("stepComplete",function(){l._isStepComplete_=!0,instance.menu.setSmallStepComplete(h)})}}}}}]),e}();e.exports=s},function(e,t,i){"use strict";var r={};r.BG_SOUND="bgSound",r.STEP_COMPLETE="stepComplete",r.CLICK_SOUND="clickSound",r.WARNING="warning",r.ALL_STEP_COMPLETE="allStepComplete",r.register=function(e){},r.loadCommonSounds=function(e){},r.play=function(e,t,i,r,n,o,s,a,l){if(void 0!==e){if("string"==typeof e)return{};return{}}},e.exports=r},function(e,t,i){"use strict";function r(){console.log(this),this.stepAry=[];var e=0;this.addStep=function(e){var t=new e;0===this.stepAry.length&&t.onStart.apply(t),this.stepAry.push(t)},this.gotoSmallStep=function(t){if(t!==e){if(-1!==e)if(t>e)for(var i=e;i<t;i++){var r=this.stepAry[i];r.onComplete.apply(r)}else{for(var i=e;i>t;i--){var r=this.stepAry[i];r.onDestroy.apply(r)}if(t-1>0){var r=this.stepAry[t-1];r.onComplete.apply(r)}}var r=this.stepAry[t];r.onStart.apply(r),e=t}},this.nextStep=!1}e.exports=r},function(e,t,i){"use strict";function r(){}r.fileOrDirExists=function(e,t){function i(i){i.root.fileOrDirExists(e,null,function(e){t&&t(e)})}requestFileSystem(LocalFileSystem.PERSISTENT,0,i)},r.dirname=function(e){var t=r.formatPath(e),i=t.lastIndexOf("/");return t.slice(0,i+1)},r.filename=function(e,t){var i=r.formatPath(e),n=i.split("/");return t?n.pop().replace(t,""):n.pop()},r.formatPath=function(e){return e.replace(/[\\]/g,"/")},r.readLocalFile=function(e,t,i){function r(r){r.root.readLocalFile(e,t,i)}requestFileSystem(LocalFileSystem.PERSISTENT,0,r)},r.userDataOption=function(e,t,i,r,n){function o(o){o.root.userDataOption(e,t,i,r,n)}requestFileSystem(LocalFileSystem.PERSISTENT,0,o)},r.readEquToollist=function(e,t,i){function r(r){r.root.readEquToollist(e,t,i)}requestFileSystem(LocalFileSystem.PERSISTENT,0,r)},r.readStoreFile=function(e,t,i){function r(r){r.root.readStoreFile(e,t,i)}requestFileSystem(LocalFileSystem.PERSISTENT,0,r)},r.rename=function(e,t,i,r,n){function o(o){o.root.rename(e,t,i,r,n)}requestFileSystem(LocalFileSystem.PERSISTENT,0,o)},r.removefile=function(e,t,i){function r(r){r.root.removefile(e,t,i)}requestFileSystem(LocalFileSystem.PERSISTENT,0,r)},r.writeStoreFile=function(e,t,i,r){function n(n){n.root.writeStoreFile(e,t,i,r)}requestFileSystem(LocalFileSystem.PERSISTENT,0,n)},r.readStreamFile=function(e,t,i,r,n){function o(o){o.root.readStreamfile(e,t,i,r,n)}requestFileSystem(LocalFileSystem.PERSISTENT,0,o)},e.exports=r},function(e,t,i){var r=i(326);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,'.babylon-2d-wrapper {\n    width: 100%;\n    height: 100%;\n    background: #383838;\n    position: absolute;\n    z-index: -1;\n}\n\n.babylon-2d {\n    width: 1000px;\n    height: 800px;\n    overflow: hidden;\n    position: absolute;\n    z-index: -1;\n    margin: auto;\n    top: 0px;\n    bottom: 0px;\n    background-color: #383838;\n}\n\n.babylon-viewer .annotation {\n    position: absolute;\n}\n\n.babylon-viewer .annotation .tooltip {\n    position: absolute;\n    top: 0;\n    left: 22px;\n    z-index: 1;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    width: 200px;\n    font-size: 12px;\n    line-height: 1.3em;\n    text-align: left;\n    pointer-events: none;\n    cursor: default;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n    -ms-flex-direction: column;\n    flex-direction: column;\n    opacity: 0;\n}\n\n.babylon-viewer .annotation .tooltip::before {\n    position: absolute;\n    top: 8px;\n    right: 100%;\n    display: block;\n    content: "";\n    border: 5px solid transparent;\n    border-right: 5px solid rgba(0, 0, 0, 0.8);\n    border-left: 0;\n}\n\n.babylon-viewer .annotation .tooltip .tooltip-content {\n    padding: 10px;\n    color: #ffffff;\n    cursor: auto;\n    -webkit-user-select: all;\n    -moz-user-select: all;\n    -ms-user-select: all;\n    user-select: all;\n    background: rgba(0, 0, 0, 0.8);\n    border-radius: 4px;\n}\n\n.babylon-viewer .annotation .tooltip .tooltip-content.padded {\n    padding-bottom: 52px;\n}\n\n.babylon-viewer .annotation .tooltip .title {\n    font-weight: bold;\n}\n\n.babylon-viewer .annotation .tooltip .title, \n.babylon-viewer .annotation .tooltip .description {\n    width: 100%;\n    color: #ffffff;\n    background: transparent;\n    border: 0;\n    outline: none;\n}\n\n.babylon-viewer .annotation .tooltip textarea.description {\n    height: 100px;\n}\n\n.babylon-viewer .annotation .tooltip .description {\n    display: block;\n    width: 180px;\n    margin-top: 10px;\n    resize: none;\n}\n\n.babylon-viewer .annotation.visible .tooltip.visible {\n    pointer-events: all;\n    opacity: 1;\n}\n\n.babylon-viewer .annotation .tooltip.reverse-x {\n    right: 22px;\n    left: auto;\n}\n\n/* Player 播放器配置 */\n.player-controls {\n    bottom: 25px;\n    position: absolute;\n    right: 0;\n    z-index: 2;\n    height: 50px;\n}\n\n.player-controls .timeline {\n    position: fixed;\n    right: 15px;\n    bottom: 50px;\n    left: 15px;\n    display: none;\n}\n\n.player-controls .ani-play-button {\n    width: 40px;\n    height: 40px;\n    border-radius: 20px;\n    text-align: center;\n    line-height: 36px;\n    font-size: 20px;\n    cursor: pointer;\n    padding-left: 2px;\n    left: 0px;\n    top: 24px;\n    color: #FFF;\n    transition: background 200ms ease-in-out;\n}\n\n.player-controls .ani-play-button:hover {\n    background: rgba(0, 0, 0, 0.58);\n}\n\n.timeline .nb-timeline-wrapper {\n    position: absolute;\n    left: 50%;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    width: 100%;\n    height: 100%;\n    box-sizing: border-box;\n    background: transparent;\n    transition: all 200ms ease-out;\n    -webkit-transform: translate(-50%, 0);\n    transform: translate(-50%, 0);\n    -webkit-box-orient: horizontal;\n    -webkit-box-direction: normal;\n    -ms-flex-flow: row nowrap;\n    flex-flow: row nowrap;\n    margin-left: 0px;\n}\n\n.timeline .track {\n    position: absolute;\n    top: 0;\n    right: 0px;\n    left: 0px;\n    height: 100%;\n    cursor: pointer;\n    transition: opacity 200ms ease-in-out;\n    -webkit-transform: translate(0, 0);\n    transform: translate(0, 0);\n    touch-action: none;\n}\n\n.timeline .track .bar {\n    position: absolute;\n    left: 0px;\n    right: 0px;\n    height: 2px;\n    margin-top: 14px;\n    background: rgba(238, 238, 238, 0.5);\n    -webkit-transform: none;\n    transform: none;\n}\n\n.timeline .track .knob {\n    position: absolute;\n    top: 8px;\n    left: 0px;\n    width: 13px;\n    height: 13px;\n    pointer-events: none;\n    background: #0097d5;\n    border: 2px solid #ffffff;\n    border-radius: 10px;\n}\n\n.threed-player {\n    position:relative;\n    right: 80px;\n    float: right;\n    bottom: -10px;\n}\n\n.threed-player .menu-wrapper {\n    /* margin-right: -80px !important; */\n    min-width: 200px;\n    min-height:160px;\n}\n\n.threed-player .setting-wrapper {\n    overflow: hidden;\n}\n\n.threed-player .setting-option {\n    list-style-type: none;\n    -webkit-box-flex: 1;\n    width: 100%;\n}\n\n.threed-player .setting-option .setting {\n    display: none;\n}\n\n.threed-player .setting-option .setting.show {\n    display: block;\n}\n\n.threed-player .setting-option .setting p.select:before {\n    position: relative;\n    top: 1px;\n    display: inline-block;\n    font-family: \'Glyphicons Halflings\';\n    font-style: normal;\n    font-weight: 400;\n    line-height: 1;\n    -webkit-font-smoothing: antialiased;\n\n    content: "\\E013";\n    margin-right: 8px;\n    margin-left: 4px;\n    font-size: 12px;\n    opacity: 1;\n}\n\n.threed-player .setting-option .setting p:before {\n    position: relative;\n    top: 1px;\n    display: inline-block;\n    font-family: \'Glyphicons Halflings\';\n    font-style: normal;\n    font-weight: 400;\n    line-height: 1;\n    -webkit-font-smoothing: antialiased;\n\n    content: "\\E013";\n    margin-right: 8px;\n    margin-left: 4px;\n    font-size: 12px;\n    opacity: 0;\n}\n\n.threed-player .setting-option .back:before {\n    margin-left: 8px;\n    margin-top: 2px;\n    font-size: 15px;\n    line-height: 14px;\n    color: #444;\n    content: "<";\n}\n\n\n.threed-player .player-setting {\n    transition: all 250ms;\n    display: flex;\n    width: 200%;\n}\n\n.threed-player .player-setting.inner-setting {\n    transform: translateX(-198px);\n}\n\n.threed-player .menu-item {\n    display: flex;\n    cursor: pointer;\n}\n\n.threed-player .menu-item .setting-label {\n    flex: 1;\n    -webkit-box-flex: 1;\n}\n\n.threed-player .menu-item .setting-value {\n    flex: 1;\n    -webkit-box-flex: 1;\n    text-align: right; \n}\n\n.threed-player .menu-item .setting-value:after {\n    margin-left: 8px;\n    margin-top: 2px;\n    font-size: 15px;\n    line-height: 14px;\n    color: #444;\n    content: ">";\n}\n\n.menu-item p {\n    margin-left: 6px;\n    font-weight: bold;\n}\n\n.glyphicon-setting:before {\n    content: "\\E019";\n}\n\n.glyphicon-animation:before {\n    content: "\\E059";\n}\n\n.icon-webvr:before {\n    font-family: "custom-icons";\n    content: "\\E614";\n}\n\n.custom-icons {\n    display: inline-block;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    -webkit-font-smoothing: antialiased;\n    line-height: 1;\n    text-transform: none;\n    speak: none;\n    width:32px;\n    height:32px;\n    font-size: 16px;\n}\n.cameraBtn{\n    display: none;\n}\n\n',""])},function(e,t,i){var r=i(328);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0};n.transform=void 0;i(27)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){t=e.exports=i(26)(void 0),t.push([e.i,"ul{\n    margin: 0;\n    padding: 0;\n}\n.pull-left{\n    float: left;\n}\n.clearfix:after{\n    display: table;\n    content: '';\n    clear: both;\n}\n.table-menu{\n    width: 392px;\n    min-height: 30px;\n    list-style: none;\n}\n.table-menu>li{\n    width: 100%;\n    height: 30px;\n    border: 1px solid #fff;\n    text-align: center;\n    color: #fff;\n    font-family: 'Microsoft Yahie';\n    font-size: 18px;\n    box-sizing: border-box;\n    border-bottom: 0;\n    cursor: default;\n    user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    -moz-user-select: none;\n}\n.table-menu>li:last-child{\n    border-bottom: 1px solid #fff;\n}\n.table-menu .table-title{\n    width: 79px;\n    height: 29px;\n    line-height: 29px;\n    border-right: 1px solid #fff;\n}\n.table-menu .table-name{\n    width: 308px;\n    height: 29px;\n    line-height: 29px;\n}\n\n.li_hover:hover {\n    /*background: #330404;*/\n    background: rgba(51, 4, 4, 0.7);\n    cursor:pointer;\n}",""])},function(e,t,i){"use strict";(function(e){var t=t||{};!function(){function i(){S=!0,clearTimeout(w),w=setTimeout(function(){S=!1},700)}function r(e){var t=[];if(e)for(t.unshift(e);e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function n(e,t){for(var i=r(e),n=r(t),o=null;i.length>0&&i[0]==n.shift();)o=i.shift();return o}function o(e,t,i){for(var r=n(e,t),o=e,s=[];o&&o!=r;)m(o,"pointerenter")&&s.push(o),o=o.parentNode;for(;s.length>0;)i(s.pop())}function s(e,t,i){for(var r=n(e,t),o=e;o&&o!=r;)m(o,"pointerleave")&&i(o),o=o.parentNode}function a(e,t){["pointerdown","pointermove","pointerup","pointerover","pointerout"].forEach(function(i){window.addEventListener(e(i),function(e){!S&&g(e.target,i)&&t(e,i,!0)})}),void 0===window["on"+e("pointerenter").toLowerCase()]&&window.addEventListener(e("pointerover"),function(e){if(!S){var i=g(e.target,"pointerenter");i&&i!==window&&(i.contains(e.relatedTarget)||o(i,e.relatedTarget,function(i){t(e,"pointerenter",!1,i)}))}}),void 0===window["on"+e("pointerleave").toLowerCase()]&&window.addEventListener(e("pointerout"),function(e){if(!S){var i=g(e.target,"pointerleave");i&&i!==window&&(i.contains(e.relatedTarget)||s(i,e.relatedTarget,function(i){t(e,"pointerleave",!1,i)}))}})}if(!window.PointerEvent){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=Object(this),i=t.length>>>0;if(0===i)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&r!=1/0&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=i)return-1;for(var n=r>=0?r:Math.max(i-Math.abs(r),0);n<i;n++)if(n in t&&t[n]===e)return n;return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")});var l=["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],h=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave"],c={},u=function(e){for(;e&&!e.handjs_forcePreventDefault;)e=e.parentNode;return!!e||window.handjs_forcePreventDefault},f=function(e,t,i,r){var n;if(document.createEvent?(n=document.createEvent("MouseEvents"),n.initMouseEvent(t,i,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,null)):(n=document.createEventObject(),n.screenX=e.screenX,n.screenY=e.screenY,n.clientX=e.clientX,n.clientY=e.clientY,n.ctrlKey=e.ctrlKey,n.altKey=e.altKey,n.shiftKey=e.shiftKey,n.metaKey=e.metaKey,n.button=e.button),void 0===n.offsetX&&(void 0!==e.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(n,"offsetX",{writable:!0}),Object.defineProperty(n,"offsetY",{writable:!0})),n.offsetX=e.offsetX,n.offsetY=e.offsetY):Object&&void 0!==Object.defineProperty?(Object.defineProperty(n,"offsetX",{get:function(){return this.currentTarget&&this.currentTarget.offsetLeft?e.clientX-this.currentTarget.offsetLeft:e.clientX}}),Object.defineProperty(n,"offsetY",{get:function(){return this.currentTarget&&this.currentTarget.offsetTop?e.clientY-this.currentTarget.offsetTop:e.clientY}})):void 0!==e.layerX&&(n.offsetX=e.layerX-e.currentTarget.offsetLeft,n.offsetY=e.layerY-e.currentTarget.offsetTop)),void 0!==e.isPrimary?n.isPrimary=e.isPrimary:n.isPrimary=!0,e.pressure)n.pressure=e.pressure;else{var o=0;void 0!==e.which?o=e.which:void 0!==e.button&&(o=e.button),n.pressure=0==o?0:.5}if(e.rotation?n.rotation=e.rotation:n.rotation=0,e.hwTimestamp?n.hwTimestamp=e.hwTimestamp:n.hwTimestamp=0,e.tiltX?n.tiltX=e.tiltX:n.tiltX=0,e.tiltY?n.tiltY=e.tiltY:n.tiltY=0,e.height?n.height=e.height:n.height=0,e.width?n.width=e.width:n.width=0,n.preventDefault=function(){void 0!==e.preventDefault&&e.preventDefault()},void 0!==n.stopPropagation){var s=n.stopPropagation;n.stopPropagation=function(){void 0!==e.stopPropagation&&e.stopPropagation(),s.call(this)}}switch(n.pointerId=e.pointerId,n.pointerType=e.pointerType,n.pointerType){case 2:n.pointerType="touch";break;case 3:n.pointerType="pen";break;case 4:n.pointerType="mouse"}r?r.dispatchEvent(n):e.target?e.target.dispatchEvent(n):e.srcElement.fireEvent("on"+y(t),n)},d=function(e,t,i,r){e.pointerId=1,e.pointerType="mouse",f(e,t,i,r)},p=function(e,t,i,r,n){var o=t.identifier+2;t.pointerId=o,t.pointerType="touch",t.currentTarget=i,void 0!==r.preventDefault&&(t.preventDefault=function(){r.preventDefault()}),f(t,e,n,i)},m=function(e,t){return e.__handjsGlobalRegisteredEvents&&e.__handjsGlobalRegisteredEvents[t]},g=function(e,t){for(;e&&!m(e,t);)e=e.parentNode;return e||(m(window,t)?window:void 0)},v=function(e,t,i,r,n){g(i,e)&&p(e,t,i,r,n)},y=function(e){return e.toLowerCase().replace("pointer","mouse")},_=function(e,t){var i=l.indexOf(t);return e+h[i]},b=function(e,t,i,r){if(void 0===e.__handjsRegisteredEvents&&(e.__handjsRegisteredEvents=[]),r){if(void 0!==e.__handjsRegisteredEvents[t])return void e.__handjsRegisteredEvents[t]++;e.__handjsRegisteredEvents[t]=1,e.addEventListener(t,i,!1)}else{if(-1!==e.__handjsRegisteredEvents.indexOf(t)&&0!=--e.__handjsRegisteredEvents[t])return;e.removeEventListener(t,i),e.__handjsRegisteredEvents[t]=0}},x=function(e,t,i){if(e.__handjsGlobalRegisteredEvents||(e.__handjsGlobalRegisteredEvents=[]),i){if(void 0!==e.__handjsGlobalRegisteredEvents[t])return void e.__handjsGlobalRegisteredEvents[t]++;e.__handjsGlobalRegisteredEvents[t]=1}else void 0!==e.__handjsGlobalRegisteredEvents[t]&&--e.__handjsGlobalRegisteredEvents[t]<0&&(e.__handjsGlobalRegisteredEvents[t]=0);if(!window.MSPointerEvent)switch(t){case"pointerenter":void 0!==e.onmouseenter&&b(e,"mouseenter",function(e){d(e,t)},i);break;case"pointerleave":void 0!==e.onmouseleave&&b(e,"mouseleave",function(e){d(e,t)},i)}},T=function(e){var t=e.prototype?e.prototype.addEventListener:e.addEventListener,i=function(e,i,r){-1!=l.indexOf(e)&&x(this,e,!0),void 0===t?this.attachEvent("on"+y(e),i):t.call(this,e,i,r)};e.prototype?e.prototype.addEventListener=i:e.addEventListener=i},E=function(e){var t=e.prototype?e.prototype.removeEventListener:e.removeEventListener,i=function(e,i,r){-1!=l.indexOf(e)&&x(this,e,!1),void 0===t?this.detachEvent(y(e),i):t.call(this,e,i,r)};e.prototype?e.prototype.removeEventListener=i:e.removeEventListener=i};T(window),T(window.HTMLElement||window.Element),T(document),T(HTMLBodyElement),T(HTMLDivElement),T(HTMLImageElement),T(HTMLUListElement),T(HTMLAnchorElement),T(HTMLLIElement),T(HTMLTableElement),window.HTMLSpanElement&&T(HTMLSpanElement),window.HTMLCanvasElement&&T(HTMLCanvasElement),window.SVGElement&&T(SVGElement),E(window),E(window.HTMLElement||window.Element),E(document),E(HTMLBodyElement),E(HTMLDivElement),E(HTMLImageElement),E(HTMLUListElement),E(HTMLAnchorElement),E(HTMLLIElement),E(HTMLTableElement),window.HTMLSpanElement&&E(HTMLSpanElement),window.HTMLCanvasElement&&E(HTMLCanvasElement),window.SVGElement&&E(SVGElement);var S=!1,w=-1;!function(){window.MSPointerEvent?a(function(e){return _("MS",e)},f):(a(y,d),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t];c[r.identifier]=r.target,v("pointerover",r,r.target,e,!0),o(r.target,null,function(t){p("pointerenter",r,t,e,!1)}),v("pointerdown",r,r.target,e,!0)}i()}),window.addEventListener("touchend",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t],n=c[r.identifier];v("pointerup",r,n,e,!0),v("pointerout",r,n,e,!0),s(n,null,function(t){p("pointerleave",r,t,e,!1)})}i()}),window.addEventListener("touchmove",function(e){for(var t=0;t<e.changedTouches.length;++t){var r=e.changedTouches[t],n=document.elementFromPoint(r.clientX,r.clientY),a=c[r.identifier];a&&!0===u(a)&&e.preventDefault(),v("pointermove",r,a,e,!0),a!==n&&(a&&(v("pointerout",r,a,e,!0),a.contains(n)||s(a,n,function(t){p("pointerleave",r,t,e,!1)})),n&&(v("pointerover",r,n,e,!0),n.contains(a)||o(n,a,function(t){p("pointerenter",r,t,e,!1)})),c[r.identifier]=n)}i()}),window.addEventListener("touchcancel",function(e){for(var t=0;t<e.changedTouches.length;++t){var i=e.changedTouches[t];v("pointercancel",i,c[i.identifier],e,!0)}})))}(),void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){if(!t.doNotProcessCSS&&void 0===document.body.style.touchAction){var i=new RegExp(".+?{.*?}","m"),r=new RegExp(".+?{","m"),n=function(e){var t=i.exec(e);if(t){var n=t[0];e=e.replace(n,"").trim();var o=r.exec(n)[0].replace("{","").trim();if(-1!=n.replace(/\s/g,"").indexOf("touch-action:none"))for(var s=document.querySelectorAll(o),a=0;a<s.length;a++){var l=s[a];void 0!==l.style.msTouchAction?l.style.msTouchAction="none":l.handjs_forcePreventDefault=!0}return e}},o=function t(i){if(window.setImmediate)i&&e(t,n(i));else for(;i;)i=n(i)};try{for(var s=0;s<document.styleSheets.length;s++){var a=document.styleSheets[s];if(void 0!=a.href){var l=new XMLHttpRequest;l.open("get",a.href,!1),l.send();o(l.responseText.replace(/(\n|\r)/g,""))}}}catch(e){}for(var h=document.getElementsByTagName("style"),s=0;s<h.length;s++){o(h[s].innerHTML.replace(/(\n|\r)/g,"").trim())}}},!1)}}()}).call(t,i(40).setImmediate)},function(e,t,i){var r,n,o,r,n,o;!function(s){n=[i(84)],r=s,void 0!==(o="function"==typeof r?r.apply(t,n):r)&&(e.exports=o)}(function(e){function t(t){var s=t||window.event,a=l.call(arguments,1),h=0,u=0,f=0,d=0,p=0,m=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(f=-1*s.detail),"wheelDelta"in s&&(f=s.wheelDelta),"wheelDeltaY"in s&&(f=s.wheelDeltaY),"wheelDeltaX"in s&&(u=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(u=-1*f,f=0),h=0===f?u:f,"deltaY"in s&&(f=-1*s.deltaY,h=f),"deltaX"in s&&(u=s.deltaX,0===f&&(h=-1*u)),0!==f||0!==u){if(1===s.deltaMode){var g=e.data(this,"mousewheel-line-height");h*=g,f*=g,u*=g}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");h*=v,f*=v,u*=v}if(d=Math.max(Math.abs(f),Math.abs(u)),(!o||o>d)&&(o=d,r(s,d)&&(o/=40)),r(s,d)&&(h/=40,u/=40,f/=40),h=Math[h>=1?"floor":"ceil"](h/o),u=Math[u>=1?"floor":"ceil"](u/o),f=Math[f>=1?"floor":"ceil"](f/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();p=t.clientX-y.left,m=t.clientY-y.top}return t.deltaX=u,t.deltaY=f,t.deltaFactor=o,t.offsetX=p,t.offsetY=m,t.deltaMode=0,a.unshift(t,h,u,f),n&&clearTimeout(n),n=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function i(){o=null}function r(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var n,o,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var h=s.length;h;)e.event.fixHooks[s[--h]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=a.length;i;)this.addEventListener(a[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=a.length;i;)this.removeEventListener(a[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),r=i["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(s){n=[i(84)],r=s,void 0!==(o="function"==typeof r?r.apply(t,n):r)&&(e.exports=o)}(function(e){function t(t){var s=t||window.event,a=l.call(arguments,1),h=0,u=0,f=0,d=0,p=0,m=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(f=-1*s.detail),"wheelDelta"in s&&(f=s.wheelDelta),"wheelDeltaY"in s&&(f=s.wheelDeltaY),"wheelDeltaX"in s&&(u=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(u=-1*f,f=0),h=0===f?u:f,"deltaY"in s&&(f=-1*s.deltaY,h=f),"deltaX"in s&&(u=s.deltaX,0===f&&(h=-1*u)),0!==f||0!==u){if(1===s.deltaMode){var g=e.data(this,"mousewheel-line-height");h*=g,f*=g,u*=g}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");h*=v,f*=v,u*=v}if(d=Math.max(Math.abs(f),Math.abs(u)),(!o||o>d)&&(o=d,r(s,d)&&(o/=40)),r(s,d)&&(h/=40,u/=40,f/=40),h=Math[h>=1?"floor":"ceil"](h/o),u=Math[u>=1?"floor":"ceil"](u/o),f=Math[f>=1?"floor":"ceil"](f/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();p=t.clientX-y.left,m=t.clientY-y.top}return t.deltaX=u,t.deltaY=f,t.deltaFactor=o,t.offsetX=p,t.offsetY=m,t.deltaMode=0,a.unshift(t,h,u,f),n&&clearTimeout(n),n=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function i(){o=null}function r(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var n,o,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var h=s.length;h;)e.event.fixHooks[s[--h]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=a.length;i;)this.addEventListener(a[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=a.length;i;)this.removeEventListener(a[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),r=i["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(t){void 0!==e&&e.exports?e.exports=t:t(jQuery,window,document)}(function(t){!function(r){var n=i(331),o=void 0!==e&&e.exports,s="https:"==document.location.protocol?"https:":"http:";n||(o?i(332)(t):t.event.special.mousewheel||t("head").append(decodeURI("%3Cscript src="+s+"//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js%3E%3C/script%3E"))),function(){var e,i="mCustomScrollbar",r="mCS",n=".mCustomScrollbar",o={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},s=0,a={},l=window.attachEvent&&!window.addEventListener?1:0,h=!1,c=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(e){var e=t.extend(!0,{},o,e),i=f.call(this);if(e.live){var l=e.liveSelector||this.selector||n,h=t(l);if("off"===e.live)return void p(l);a[l]=setTimeout(function(){h.mCustomScrollbar(e),"once"===e.live&&h.length&&p(l)},500)}else p(l);return e.setWidth=e.set_width?e.set_width:e.setWidth,e.setHeight=e.set_height?e.set_height:e.setHeight,e.axis=e.horizontalScroll?"x":m(e.axis),e.scrollInertia=e.scrollInertia>0&&e.scrollInertia<17?17:e.scrollInertia,"object"!=typeof e.mouseWheel&&1==e.mouseWheel&&(e.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),e.mouseWheel.scrollAmount=e.mouseWheelPixels?e.mouseWheelPixels:e.mouseWheel.scrollAmount,e.mouseWheel.normalizeDelta=e.advanced.normalizeMouseWheelDelta?e.advanced.normalizeMouseWheelDelta:e.mouseWheel.normalizeDelta,e.scrollButtons.scrollType=g(e.scrollButtons.scrollType),d(e),t(i).each(function(){var i=t(this);if(!i.data(r)){i.data(r,{idx:++s,opt:e,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:i.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var n=i.data(r),o=n.opt,a=i.data("mcs-axis"),l=i.data("mcs-scrollbar-position"),h=i.data("mcs-theme");a&&(o.axis=a),l&&(o.scrollbarPosition=l),h&&(o.theme=h,d(o)),v.call(this),n&&o.callbacks.onCreate&&"function"==typeof o.callbacks.onCreate&&o.callbacks.onCreate.call(this),t("#mCSB_"+n.idx+"_container img:not(."+c[2]+")").addClass(c[2]),u.update.call(null,i)}})},update:function(e,i){var n=e||f.call(this);return t(n).each(function(){var e=t(this);if(e.data(r)){var n=e.data(r),o=n.opt,s=t("#mCSB_"+n.idx+"_container"),a=t("#mCSB_"+n.idx),l=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")];if(!s.length)return;n.tweenRunning&&X(e),i&&n&&o.callbacks.onBeforeUpdate&&"function"==typeof o.callbacks.onBeforeUpdate&&o.callbacks.onBeforeUpdate.call(this),e.hasClass(c[3])&&e.removeClass(c[3]),e.hasClass(c[4])&&e.removeClass(c[4]),a.css("max-height","none"),a.height()!==e.height()&&a.css("max-height",e.height()),_.call(this),"y"===o.axis||o.advanced.autoExpandHorizontalScroll||s.css("width",y(s)),n.overflowed=S.call(this),P.call(this),o.autoDraggerLength&&x.call(this),T.call(this),M.call(this);var h=[Math.abs(s[0].offsetTop),Math.abs(s[0].offsetLeft)];"x"!==o.axis&&(n.overflowed[0]?l[0].height()>l[0].parent().height()?w.call(this):(Y(e,h[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(w.call(this),"y"===o.axis?A.call(this):"yx"===o.axis&&n.overflowed[1]&&Y(e,h[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==o.axis&&(n.overflowed[1]?l[1].width()>l[1].parent().width()?w.call(this):(Y(e,h[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(w.call(this),"x"===o.axis?A.call(this):"yx"===o.axis&&n.overflowed[0]&&Y(e,h[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),i&&n&&(2===i&&o.callbacks.onImageLoad&&"function"==typeof o.callbacks.onImageLoad?o.callbacks.onImageLoad.call(this):3===i&&o.callbacks.onSelectorChange&&"function"==typeof o.callbacks.onSelectorChange?o.callbacks.onSelectorChange.call(this):o.callbacks.onUpdate&&"function"==typeof o.callbacks.onUpdate&&o.callbacks.onUpdate.call(this)),j.call(this)}})},scrollTo:function(e,i){if(void 0!==e&&null!=e){var n=f.call(this);return t(n).each(function(){var n=t(this);if(n.data(r)){var o=n.data(r),s=o.opt,a={trigger:"external",scrollInertia:s.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},l=t.extend(!0,{},a,i),h=G.call(this,e),c=l.scrollInertia>0&&l.scrollInertia<17?17:l.scrollInertia;h[0]=H.call(this,h[0],"y"),h[1]=H.call(this,h[1],"x"),l.moveDragger&&(h[0]*=o.scrollRatio.y,h[1]*=o.scrollRatio.x),l.dur=ie()?0:c,setTimeout(function(){null!==h[0]&&void 0!==h[0]&&"x"!==s.axis&&o.overflowed[0]&&(l.dir="y",l.overwrite="all",Y(n,h[0].toString(),l)),null!==h[1]&&void 0!==h[1]&&"y"!==s.axis&&o.overflowed[1]&&(l.dir="x",l.overwrite="none",Y(n,h[1].toString(),l))},l.timeout)}})}},stop:function(){var e=f.call(this);return t(e).each(function(){var e=t(this);e.data(r)&&X(e)})},disable:function(e){var i=f.call(this);return t(i).each(function(){var i=t(this);i.data(r)&&(i.data(r),j.call(this,"remove"),A.call(this),e&&w.call(this),P.call(this,!0),i.addClass(c[3]))})},destroy:function(){var e=f.call(this);return t(e).each(function(){var n=t(this);if(n.data(r)){var o=n.data(r),s=o.opt,a=t("#mCSB_"+o.idx),l=t("#mCSB_"+o.idx+"_container"),h=t(".mCSB_"+o.idx+"_scrollbar");s.live&&p(s.liveSelector||t(e).selector),j.call(this,"remove"),A.call(this),w.call(this),n.removeData(r),Z(this,"mcs"),h.remove(),l.find("img."+c[2]).removeClass(c[2]),a.replaceWith(l.contents()),n.removeClass(i+" _"+r+"_"+o.idx+" "+c[6]+" "+c[7]+" "+c[5]+" "+c[3]).addClass(c[4])}})}},f=function(){return"object"!=typeof t(this)||t(this).length<1?n:this},d=function(e){var i=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],r=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],o=["minimal","minimal-dark"],s=["minimal","minimal-dark"];e.autoDraggerLength=!(t.inArray(e.theme,i)>-1)&&e.autoDraggerLength,e.autoExpandScrollbar=!(t.inArray(e.theme,r)>-1)&&e.autoExpandScrollbar,e.scrollButtons.enable=!(t.inArray(e.theme,n)>-1)&&e.scrollButtons.enable,e.autoHideScrollbar=t.inArray(e.theme,o)>-1||e.autoHideScrollbar,e.scrollbarPosition=t.inArray(e.theme,s)>-1?"outside":e.scrollbarPosition},p=function(e){a[e]&&(clearTimeout(a[e]),Z(a,e))},m=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},v=function(){var e=t(this),n=e.data(r),o=n.opt,s=o.autoExpandScrollbar?" "+c[1]+"_expand":"",a=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_vertical"+s+"'><div class='"+c[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_horizontal"+s+"'><div class='"+c[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],l="yx"===o.axis?"mCSB_vertical_horizontal":"x"===o.axis?"mCSB_horizontal":"mCSB_vertical",h="yx"===o.axis?a[0]+a[1]:"x"===o.axis?a[1]:a[0],u="yx"===o.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=o.autoHideScrollbar?" "+c[6]:"",d="x"!==o.axis&&"rtl"===n.langDir?" "+c[7]:"";o.setWidth&&e.css("width",o.setWidth),o.setHeight&&e.css("height",o.setHeight),o.setLeft="y"!==o.axis&&"rtl"===n.langDir?"989999px":o.setLeft,e.addClass(i+" _"+r+"_"+n.idx+f+d).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+o.theme+" "+l+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+o.setTop+"; left:"+o.setLeft+";' dir="+n.langDir+" /></div>");var p=t("#mCSB_"+n.idx),m=t("#mCSB_"+n.idx+"_container");"y"===o.axis||o.advanced.autoExpandHorizontalScroll||m.css("width",y(m)),"outside"===o.scrollbarPosition?("static"===e.css("position")&&e.css("position","relative"),e.css("overflow","visible"),p.addClass("mCSB_outside").after(h)):(p.addClass("mCSB_inside").append(h),m.wrap(u)),b.call(this);var g=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},y=function(e){var i=[e[0].scrollWidth,Math.max.apply(Math,e.children().map(function(){return t(this).outerWidth(!0)}).get())],r=e.parent().width();return i[0]>r?i[0]:i[1]>r?i[1]:"100%"},_=function(){var e=t(this),i=e.data(r),n=i.opt,o=t("#mCSB_"+i.idx+"_container");if(n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis){o.css({width:"auto","min-width":0,"overflow-x":"scroll"});var s=Math.ceil(o[0].scrollWidth);3===n.advanced.autoExpandHorizontalScroll||2!==n.advanced.autoExpandHorizontalScroll&&s>o.parent().width()?o.css({width:s,"min-width":"100%","overflow-x":"inherit"}):o.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(o[0].getBoundingClientRect().right+.4)-Math.floor(o[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},b=function(){var e=t(this),i=e.data(r),n=i.opt,o=t(".mCSB_"+i.idx+"_scrollbar:first"),s=ee(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",a=["<a href='#' class='"+c[13]+"' oncontextmenu='return false;' "+s+" />","<a href='#' class='"+c[14]+"' oncontextmenu='return false;' "+s+" />","<a href='#' class='"+c[15]+"' oncontextmenu='return false;' "+s+" />","<a href='#' class='"+c[16]+"' oncontextmenu='return false;' "+s+" />"],l=["x"===n.axis?a[2]:a[0],"x"===n.axis?a[3]:a[1],a[2],a[3]];n.scrollButtons.enable&&o.prepend(l[0]).append(l[1]).next(".mCSB_scrollTools").prepend(l[2]).append(l[3])},x=function(){var e=t(this),i=e.data(r),n=t("#mCSB_"+i.idx),o=t("#mCSB_"+i.idx+"_container"),s=[t("#mCSB_"+i.idx+"_dragger_vertical"),t("#mCSB_"+i.idx+"_dragger_horizontal")],a=[n.height()/o.outerHeight(!1),n.width()/o.outerWidth(!1)],h=[parseInt(s[0].css("min-height")),Math.round(a[0]*s[0].parent().height()),parseInt(s[1].css("min-width")),Math.round(a[1]*s[1].parent().width())],c=l&&h[1]<h[0]?h[0]:h[1],u=l&&h[3]<h[2]?h[2]:h[3];s[0].css({height:c,"max-height":s[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":h[0]+"px"}),s[1].css({width:u,"max-width":s[1].parent().width()-10})},T=function(){var e=t(this),i=e.data(r),n=t("#mCSB_"+i.idx),o=t("#mCSB_"+i.idx+"_container"),s=[t("#mCSB_"+i.idx+"_dragger_vertical"),t("#mCSB_"+i.idx+"_dragger_horizontal")],a=[o.outerHeight(!1)-n.height(),o.outerWidth(!1)-n.width()],l=[a[0]/(s[0].parent().height()-s[0].height()),a[1]/(s[1].parent().width()-s[1].width())];i.scrollRatio={y:l[0],x:l[1]}},E=function(e,t,i){var r=i?c[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(c[0]+" "+r),n.toggleClass(c[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(c[0]),n.removeClass(c[1])):(e.addClass(c[0]),n.addClass(c[1])))},S=function(){var e=t(this),i=e.data(r),n=t("#mCSB_"+i.idx),o=t("#mCSB_"+i.idx+"_container"),s=null==i.overflowed?o.height():o.outerHeight(!1),a=null==i.overflowed?o.width():o.outerWidth(!1),l=o[0].scrollHeight,h=o[0].scrollWidth;return l>s&&(s=l),h>a&&(a=h),[s>n.height(),a>n.width()]},w=function(){var e=t(this),i=e.data(r),n=i.opt,o=t("#mCSB_"+i.idx),s=t("#mCSB_"+i.idx+"_container"),a=[t("#mCSB_"+i.idx+"_dragger_vertical"),t("#mCSB_"+i.idx+"_dragger_horizontal")];if(X(e),("x"!==n.axis&&!i.overflowed[0]||"y"===n.axis&&i.overflowed[0])&&(a[0].add(s).css("top",0),Y(e,"_resetY")),"y"!==n.axis&&!i.overflowed[1]||"x"===n.axis&&i.overflowed[1]){var l=dx=0;"rtl"===i.langDir&&(l=o.width()-s.outerWidth(!1),dx=Math.abs(l/i.scrollRatio.x)),s.css("left",l),a[1].css("left",dx),Y(e,"_resetX")}},M=function(){function e(){s=setTimeout(function(){t.event.special.mousewheel?(clearTimeout(s),O.call(i[0])):e()},100)}var i=t(this),n=i.data(r),o=n.opt;if(!n.bindEvents){if(R.call(this),o.contentTouchScroll&&D.call(this),I.call(this),o.mouseWheel.enable){var s;e()}B.call(this),k.call(this),o.advanced.autoScrollOnFocus&&N.call(this),o.scrollButtons.enable&&V.call(this),o.keyboard.enable&&U.call(this),n.bindEvents=!0}},A=function(){var e=t(this),i=e.data(r),n=i.opt,o=r+"_"+i.idx,s=".mCSB_"+i.idx+"_scrollbar",a=t("#mCSB_"+i.idx+",#mCSB_"+i.idx+"_container,#mCSB_"+i.idx+"_container_wrapper,"+s+" ."+c[12]+",#mCSB_"+i.idx+"_dragger_vertical,#mCSB_"+i.idx+"_dragger_horizontal,"+s+">a"),l=t("#mCSB_"+i.idx+"_container");n.advanced.releaseDraggableSelectors&&a.add(t(n.advanced.releaseDraggableSelectors)),n.advanced.extraDraggableSelectors&&a.add(t(n.advanced.extraDraggableSelectors)),i.bindEvents&&(t(document).add(t(!F()||top.document)).unbind("."+o),a.each(function(){t(this).unbind("."+o)}),clearTimeout(e[0]._focusTimeout),Z(e[0],"_focusTimeout"),clearTimeout(i.sequential.step),Z(i.sequential,"step"),clearTimeout(l[0].onCompleteTimeout),Z(l[0],"onCompleteTimeout"),i.bindEvents=!1)},P=function(e){var i=t(this),n=i.data(r),o=n.opt,s=t("#mCSB_"+n.idx+"_container_wrapper"),a=s.length?s:t("#mCSB_"+n.idx+"_container"),l=[t("#mCSB_"+n.idx+"_scrollbar_vertical"),t("#mCSB_"+n.idx+"_scrollbar_horizontal")],h=[l[0].find(".mCSB_dragger"),l[1].find(".mCSB_dragger")];"x"!==o.axis&&(n.overflowed[0]&&!e?(l[0].add(h[0]).add(l[0].children("a")).css("display","block"),a.removeClass(c[8]+" "+c[10])):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&h[0].css("display","none"),a.removeClass(c[10])):(l[0].css("display","none"),a.addClass(c[10])),a.addClass(c[8]))),"y"!==o.axis&&(n.overflowed[1]&&!e?(l[1].add(h[1]).add(l[1].children("a")).css("display","block"),a.removeClass(c[9]+" "+c[11])):(o.alwaysShowScrollbar?(2!==o.alwaysShowScrollbar&&h[1].css("display","none"),a.removeClass(c[11])):(l[1].css("display","none"),a.addClass(c[11])),a.addClass(c[9]))),n.overflowed[0]||n.overflowed[1]?i.removeClass(c[5]):i.addClass(c[5])},C=function(e){var i=e.type,r=e.target.ownerDocument!==document?[t(frameElement).offset().top,t(frameElement).offset().left]:null,n=F()&&e.target.ownerDocument!==top.document?[t(e.view.frameElement).offset().top,t(e.view.frameElement).offset().left]:[0,0];switch(i){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return r?[e.originalEvent.pageY-r[0]+n[0],e.originalEvent.pageX-r[1]+n[1],!1]:[e.originalEvent.pageY,e.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var o=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],s=e.originalEvent.touches.length||e.originalEvent.changedTouches.length;return e.target.ownerDocument!==document?[o.screenY,o.screenX,s>1]:[o.pageY,o.pageX,s>1];default:return r?[e.pageY-r[0]+n[0],e.pageX-r[1]+n[1],!1]:[e.pageY,e.pageX,!1]}},R=function(){function e(e){var t=p.find("iframe");if(t.length){var i=e?"auto":"none";t.css("pointer-events",i)}}function i(e,t,i,r){if(p[0].idleTimer=u.scrollInertia<233?250:0,n.attr("id")===d[1])var o="x",s=(n[0].offsetLeft-t+r)*c.scrollRatio.x;else var o="y",s=(n[0].offsetTop-e+i)*c.scrollRatio.y;Y(a,s.toString(),{dir:o,drag:!0})}var n,o,s,a=t(this),c=a.data(r),u=c.opt,f=r+"_"+c.idx,d=["mCSB_"+c.idx+"_dragger_vertical","mCSB_"+c.idx+"_dragger_horizontal"],p=t("#mCSB_"+c.idx+"_container"),m=t("#"+d[0]+",#"+d[1]),g=u.advanced.releaseDraggableSelectors?m.add(t(u.advanced.releaseDraggableSelectors)):m,v=u.advanced.extraDraggableSelectors?t(!F()||top.document).add(t(u.advanced.extraDraggableSelectors)):t(!F()||top.document);m.bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(i){if(i.stopImmediatePropagation(),i.preventDefault(),J(i)){h=!0,l&&(document.onselectstart=function(){return!1}),e(!1),X(a),n=t(this);var r=n.offset(),c=C(i)[0]-r.top,f=C(i)[1]-r.left,d=n.height()+r.top,p=n.width()+r.left;d>c&&c>0&&p>f&&f>0&&(o=c,s=f),E(n,"active",u.autoExpandScrollbar)}}).bind("touchmove."+f,function(e){e.stopImmediatePropagation(),e.preventDefault();var t=n.offset(),r=C(e)[0]-t.top,a=C(e)[1]-t.left;i(o,s,r,a)}),t(document).add(v).bind("mousemove."+f+" pointermove."+f+" MSPointerMove."+f,function(e){if(n){var t=n.offset(),r=C(e)[0]-t.top,a=C(e)[1]-t.left;if(o===r&&s===a)return;i(o,s,r,a)}}).add(g).bind("mouseup."+f+" touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(t){n&&(E(n,"active",u.autoExpandScrollbar),n=null),h=!1,l&&(document.onselectstart=null),e(!0)})},D=function(){function i(t){if(!$(t)||h||C(t)[2])return void(e=0);e=1,T=0,E=0,c=1,S.removeClass("mCS_touch_action");var i=R.offset();u=C(t)[0]-i.top,f=C(t)[1]-i.left,N=[C(t)[0],C(t)[1]]}function n(e){if($(e)&&!h&&!C(e)[2]&&(M.documentTouchScroll||e.preventDefault(),e.stopImmediatePropagation(),(!E||T)&&c)){g=q();var t=P.offset(),i=C(e)[0]-t.top,r=C(e)[1]-t.left,n="mcsLinearOut";if(I.push(i),O.push(r),N[2]=Math.abs(C(e)[0]-N[0]),N[3]=Math.abs(C(e)[1]-N[1]),w.overflowed[0])var o=D[0].parent().height()-D[0].height(),s=u-i>0&&i-u>-o*w.scrollRatio.y&&(2*N[3]<N[2]||"yx"===M.axis);if(w.overflowed[1])var a=D[1].parent().width()-D[1].width(),d=f-r>0&&r-f>-a*w.scrollRatio.x&&(2*N[2]<N[3]||"yx"===M.axis);s||d?(U||e.preventDefault(),T=1):(E=1,S.addClass("mCS_touch_action")),U&&e.preventDefault(),b="yx"===M.axis?[u-i,f-r]:"x"===M.axis?[null,f-r]:[u-i,null],R[0].idleTimer=250,w.overflowed[0]&&l(b[0],L,n,"y","all",!0),w.overflowed[1]&&l(b[1],L,n,"x",B,!0)}}function o(t){if(!$(t)||h||C(t)[2])return void(e=0);e=1,t.stopImmediatePropagation(),X(S),m=q();var i=P.offset();d=C(t)[0]-i.top,p=C(t)[1]-i.left,I=[],O=[]}function s(e){if($(e)&&!h&&!C(e)[2]){c=0,e.stopImmediatePropagation(),T=0,E=0,v=q();var t=P.offset(),i=C(e)[0]-t.top,r=C(e)[1]-t.left;if(!(v-g>30)){_=1e3/(v-m);var n="mcsEaseOut",o=2.5>_,s=o?[I[I.length-2],O[O.length-2]]:[0,0];y=o?[i-s[0],r-s[1]]:[i-d,r-p];var u=[Math.abs(y[0]),Math.abs(y[1])];_=o?[Math.abs(y[0]/4),Math.abs(y[1]/4)]:[_,_];var f=[Math.abs(R[0].offsetTop)-y[0]*a(u[0]/_[0],_[0]),Math.abs(R[0].offsetLeft)-y[1]*a(u[1]/_[1],_[1])];b="yx"===M.axis?[f[0],f[1]]:"x"===M.axis?[null,f[1]]:[f[0],null],x=[4*u[0]+M.scrollInertia,4*u[1]+M.scrollInertia];var S=parseInt(M.contentTouchScroll)||0;b[0]=u[0]>S?b[0]:0,b[1]=u[1]>S?b[1]:0,w.overflowed[0]&&l(b[0],x[0],n,"y",B,!1),w.overflowed[1]&&l(b[1],x[1],n,"x",B,!1)}}}function a(e,t){var i=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?i[0]:i[3]:e>60?t>3?i[3]:i[2]:e>30?t>8?i[1]:t>6?i[0]:t>4?t:i[2]:t>8?t:i[3]}function l(e,t,i,r,n,o){e&&Y(S,e.toString(),{dur:t,scrollEasing:i,dir:r,overwrite:n,drag:o})}var c,u,f,d,p,m,g,v,y,_,b,x,T,E,S=t(this),w=S.data(r),M=w.opt,A=r+"_"+w.idx,P=t("#mCSB_"+w.idx),R=t("#mCSB_"+w.idx+"_container"),D=[t("#mCSB_"+w.idx+"_dragger_vertical"),t("#mCSB_"+w.idx+"_dragger_horizontal")],I=[],O=[],L=0,B="yx"===M.axis?"none":"all",N=[],k=R.find("iframe"),V=["touchstart."+A+" pointerdown."+A+" MSPointerDown."+A,"touchmove."+A+" pointermove."+A+" MSPointerMove."+A,"touchend."+A+" pointerup."+A+" MSPointerUp."+A],U=void 0!==document.body.style.touchAction;R.bind(V[0],function(e){i(e)}).bind(V[1],function(e){n(e)}),P.bind(V[0],function(e){o(e)}).bind(V[2],function(e){s(e)}),k.length&&k.each(function(){t(this).load(function(){F(this)&&t(this.contentDocument||this.contentWindow.document).bind(V[0],function(e){i(e),o(e)}).bind(V[1],function(e){n(e)}).bind(V[2],function(e){s(e)})})})},I=function(){function i(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function n(e,t,i){c.type=i&&o?"stepped":"stepless",c.scrollAmount=10,z(s,e,t,"mcsLinearOut",i?60:null)}var o,s=t(this),a=s.data(r),l=a.opt,c=a.sequential,u=r+"_"+a.idx,f=t("#mCSB_"+a.idx+"_container"),d=f.parent();f.bind("mousedown."+u,function(t){e||o||(o=1,h=!0)}).add(document).bind("mousemove."+u,function(t){if(!e&&o&&i()){var r=f.offset(),s=C(t)[0]-r.top+f[0].offsetTop,h=C(t)[1]-r.left+f[0].offsetLeft;s>0&&s<d.height()&&h>0&&h<d.width()?c.step&&n("off",null,"stepped"):("x"!==l.axis&&a.overflowed[0]&&(0>s?n("on",38):s>d.height()&&n("on",40)),"y"!==l.axis&&a.overflowed[1]&&(0>h?n("on",37):h>d.width()&&n("on",39)))}}).bind("mouseup."+u+" dragend."+u,function(t){e||(o&&(o=0,n("off",null)),h=!1)})},O=function(){function e(e,r){if(X(i),!L(i,e.target)){var s="auto"!==o.mouseWheel.deltaFactor?parseInt(o.mouseWheel.deltaFactor):l&&e.deltaFactor<100?100:e.deltaFactor||100,c=o.scrollInertia;if("x"===o.axis||"x"===o.mouseWheel.axis)var u="x",f=[Math.round(s*n.scrollRatio.x),parseInt(o.mouseWheel.scrollAmount)],d="auto"!==o.mouseWheel.scrollAmount?f[1]:f[0]>=a.width()?.9*a.width():f[0],p=Math.abs(t("#mCSB_"+n.idx+"_container")[0].offsetLeft),m=h[1][0].offsetLeft,g=h[1].parent().width()-h[1].width(),v=e.deltaX||e.deltaY||r;else var u="y",f=[Math.round(s*n.scrollRatio.y),parseInt(o.mouseWheel.scrollAmount)],d="auto"!==o.mouseWheel.scrollAmount?f[1]:f[0]>=a.height()?.9*a.height():f[0],p=Math.abs(t("#mCSB_"+n.idx+"_container")[0].offsetTop),m=h[0][0].offsetTop,g=h[0].parent().height()-h[0].height(),v=e.deltaY||r;"y"===u&&!n.overflowed[0]||"x"===u&&!n.overflowed[1]||((o.mouseWheel.invert||e.webkitDirectionInvertedFromDevice)&&(v=-v),o.mouseWheel.normalizeDelta&&(v=0>v?-1:1),(v>0&&0!==m||0>v&&m!==g||o.mouseWheel.preventDefault)&&(e.stopImmediatePropagation(),e.preventDefault()),e.deltaFactor<2&&!o.mouseWheel.normalizeDelta&&(d=e.deltaFactor,c=17),Y(i,(p-v*d).toString(),{dir:u,dur:c}))}}if(t(this).data(r)){var i=t(this),n=i.data(r),o=n.opt,s=r+"_"+n.idx,a=t("#mCSB_"+n.idx),h=[t("#mCSB_"+n.idx+"_dragger_vertical"),t("#mCSB_"+n.idx+"_dragger_horizontal")],c=t("#mCSB_"+n.idx+"_container").find("iframe");c.length&&c.each(function(){t(this).load(function(){F(this)&&t(this.contentDocument||this.contentWindow.document).bind("mousewheel."+s,function(t,i){e(t,i)})})}),a.bind("mousewheel."+s,function(t,i){e(t,i)})}},F=function(e){var t=null;if(e){try{var i=e.contentDocument||e.contentWindow.document;t=i.body.innerHTML}catch(e){}return null!==t}try{var i=top.document;t=i.body.innerHTML}catch(e){}return null!==t},L=function(e,i){var n=i.nodeName.toLowerCase(),o=e.data(r).opt.mouseWheel.disableOver,s=["select","textarea"];return t.inArray(n,o)>-1&&!(t.inArray(n,s)>-1&&!t(i).is(":focus"))},B=function(){var e,i=t(this),n=i.data(r),o=r+"_"+n.idx,s=t("#mCSB_"+n.idx+"_container"),a=s.parent();t(".mCSB_"+n.idx+"_scrollbar ."+c[12]).bind("mousedown."+o+" touchstart."+o+" pointerdown."+o+" MSPointerDown."+o,function(i){h=!0,t(i.target).hasClass("mCSB_dragger")||(e=1)}).bind("touchend."+o+" pointerup."+o+" MSPointerUp."+o,function(e){h=!1}).bind("click."+o,function(r){if(e&&(e=0,t(r.target).hasClass(c[12])||t(r.target).hasClass("mCSB_draggerRail"))){X(i);var o=t(this),l=o.find(".mCSB_dragger");if(o.parent(".mCSB_scrollTools_horizontal").length>0){if(!n.overflowed[1])return;var h="x",u=r.pageX>l.offset().left?-1:1,f=Math.abs(s[0].offsetLeft)-.9*u*a.width()}else{if(!n.overflowed[0])return;var h="y",u=r.pageY>l.offset().top?-1:1,f=Math.abs(s[0].offsetTop)-.9*u*a.height()}Y(i,f.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}})},N=function(){var e=t(this),i=e.data(r),n=i.opt,o=r+"_"+i.idx,s=t("#mCSB_"+i.idx+"_container"),a=s.parent();s.bind("focusin."+o,function(i){var r=t(document.activeElement),o=s.find(".mCustomScrollBox").length;r.is(n.advanced.autoScrollOnFocus)&&(X(e),clearTimeout(e[0]._focusTimeout),e[0]._focusTimer=o?17*o:0,e[0]._focusTimeout=setTimeout(function(){var t=[te(r)[0],te(r)[1]],i=[s[0].offsetTop,s[0].offsetLeft],o=[i[0]+t[0]>=0&&i[0]+t[0]<a.height()-r.outerHeight(!1),i[1]+t[1]>=0&&i[0]+t[1]<a.width()-r.outerWidth(!1)],l="yx"!==n.axis||o[0]||o[1]?"all":"none";"x"===n.axis||o[0]||Y(e,t[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:l,dur:0}),"y"===n.axis||o[1]||Y(e,t[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:l,dur:0})},e[0]._focusTimer))})},k=function(){var e=t(this),i=e.data(r),n=r+"_"+i.idx,o=t("#mCSB_"+i.idx+"_container").parent();o.bind("scroll."+n,function(e){(0!==o.scrollTop()||0!==o.scrollLeft())&&t(".mCSB_"+i.idx+"_scrollbar").css("visibility","hidden")})},V=function(){var e=t(this),i=e.data(r),n=i.opt,o=i.sequential,s=r+"_"+i.idx,a=".mCSB_"+i.idx+"_scrollbar";t(a+">a").bind("mousedown."+s+" touchstart."+s+" pointerdown."+s+" MSPointerDown."+s+" mouseup."+s+" touchend."+s+" pointerup."+s+" MSPointerUp."+s+" mouseout."+s+" pointerout."+s+" MSPointerOut."+s+" click."+s,function(r){function s(t,i){o.scrollAmount=n.scrollButtons.scrollAmount,z(e,t,i)}if(r.preventDefault(),J(r)){var a=t(this).attr("class");switch(o.type=n.scrollButtons.scrollType,r.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===o.type)return;h=!0,i.tweenRunning=!1,s("on",a);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===o.type)return;h=!1,o.dir&&s("off",a);break;case"click":if("stepped"!==o.type||i.tweenRunning)return;s("on",a)}}})},U=function(){function e(e){function r(e,t){s.type=o.keyboard.scrollType,s.scrollAmount=o.keyboard.scrollAmount,"stepped"===s.type&&n.tweenRunning||z(i,e,t)}switch(e.type){case"blur":n.tweenRunning&&s.dir&&r("off",null);break;case"keydown":case"keyup":var a=e.keyCode?e.keyCode:e.which,l="on";if("x"!==o.axis&&(38===a||40===a)||"y"!==o.axis&&(37===a||39===a)){if((38===a||40===a)&&!n.overflowed[0]||(37===a||39===a)&&!n.overflowed[1])return;"keyup"===e.type&&(l="off"),t(document.activeElement).is(u)||(e.preventDefault(),e.stopImmediatePropagation(),r(l,a))}else if(33===a||34===a){if((n.overflowed[0]||n.overflowed[1])&&(e.preventDefault(),e.stopImmediatePropagation()),"keyup"===e.type){X(i);var f=34===a?-1:1;if("x"===o.axis||"yx"===o.axis&&n.overflowed[1]&&!n.overflowed[0])var d="x",p=Math.abs(h[0].offsetLeft)-.9*f*c.width();else var d="y",p=Math.abs(h[0].offsetTop)-.9*f*c.height();Y(i,p.toString(),{dir:d,scrollEasing:"mcsEaseInOut"})}}else if((35===a||36===a)&&!t(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(e.preventDefault(),e.stopImmediatePropagation()),"keyup"===e.type)){if("x"===o.axis||"yx"===o.axis&&n.overflowed[1]&&!n.overflowed[0])var d="x",p=35===a?Math.abs(c.width()-h.outerWidth(!1)):0;else var d="y",p=35===a?Math.abs(c.height()-h.outerHeight(!1)):0;Y(i,p.toString(),{dir:d,scrollEasing:"mcsEaseInOut"})}}}var i=t(this),n=i.data(r),o=n.opt,s=n.sequential,a=r+"_"+n.idx,l=t("#mCSB_"+n.idx),h=t("#mCSB_"+n.idx+"_container"),c=h.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=h.find("iframe"),d=["blur."+a+" keydown."+a+" keyup."+a];f.length&&f.each(function(){t(this).load(function(){F(this)&&t(this.contentDocument||this.contentWindow.document).bind(d[0],function(t){e(t)})})}),l.attr("tabindex","0").bind(d[0],function(t){e(t)})},z=function(e,i,n,o,s){function a(t){h.snapAmount&&(u.scrollAmount=h.snapAmount instanceof Array?"x"===u.dir[0]?h.snapAmount[1]:h.snapAmount[0]:h.snapAmount);var i="stepped"!==u.type,r=s||(t?i?p/1.5:m:1e3/60),n=t?i?7.5:40:2.5,c=[Math.abs(f[0].offsetTop),Math.abs(f[0].offsetLeft)],d=[l.scrollRatio.y>10?10:l.scrollRatio.y,l.scrollRatio.x>10?10:l.scrollRatio.x],g="x"===u.dir[0]?c[1]+u.dir[1]*d[1]*n:c[0]+u.dir[1]*d[0]*n,v="x"===u.dir[0]?c[1]+u.dir[1]*parseInt(u.scrollAmount):c[0]+u.dir[1]*parseInt(u.scrollAmount),y="auto"!==u.scrollAmount?v:g,_=o||(t?i?"mcsLinearOut":"mcsEaseInOut":"mcsLinear"),b=!!t;return t&&17>r&&(y="x"===u.dir[0]?c[1]:c[0]),Y(e,y.toString(),{dir:u.dir[0],scrollEasing:_,dur:r,onComplete:b}),t?void(u.dir=!1):(clearTimeout(u.step),void(u.step=setTimeout(function(){a()},r)))}var l=e.data(r),h=l.opt,u=l.sequential,f=t("#mCSB_"+l.idx+"_container"),d="stepped"===u.type,p=h.scrollInertia<26?26:h.scrollInertia,m=h.scrollInertia<1?17:h.scrollInertia;switch(i){case"on":if(u.dir=[n===c[16]||n===c[15]||39===n||37===n?"x":"y",n===c[13]||n===c[15]||38===n||37===n?-1:1],X(e),ee(n)&&"stepped"===u.type)return;a(d);break;case"off":(function(){clearTimeout(u.step),Z(u,"step"),X(e)})(),(d||l.tweenRunning&&u.dir)&&a(!0)}},G=function(e){var i=t(this).data(r).opt,n=[];return"function"==typeof e&&(e=e()),e instanceof Array?n=e.length>1?[e[0],e[1]]:"x"===i.axis?[null,e[0]]:[e[0],null]:(n[0]=e.y?e.y:e.x||"x"===i.axis?null:e,n[1]=e.x?e.x:e.y||"y"===i.axis?null:e),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n},H=function(e,i){if(null!=e&&void 0!==e){var n=t(this),o=n.data(r),s=o.opt,a=t("#mCSB_"+o.idx+"_container"),l=a.parent(),h=typeof e;i||(i="x"===s.axis?"x":"y");var c="x"===i?a.outerWidth(!1):a.outerHeight(!1),f="x"===i?a[0].offsetLeft:a[0].offsetTop,d="x"===i?"left":"top";switch(h){case"function":return e();case"object":var p=e.jquery?e:t(e);if(!p.length)return;return"x"===i?te(p)[1]:te(p)[0];case"string":case"number":if(ee(e))return Math.abs(e);if(-1!==e.indexOf("%"))return Math.abs(c*parseInt(e)/100);if(-1!==e.indexOf("-="))return Math.abs(f-parseInt(e.split("-=")[1]));if(-1!==e.indexOf("+=")){var m=f+parseInt(e.split("+=")[1]);return m>=0?0:Math.abs(m)}if(-1!==e.indexOf("px")&&ee(e.split("px")[0]))return Math.abs(e.split("px")[0]);if("top"===e||"left"===e)return 0;if("bottom"===e)return Math.abs(l.height()-a.outerHeight(!1));if("right"===e)return Math.abs(l.width()-a.outerWidth(!1));if("first"===e||"last"===e){var p=a.find(":"+e);return"x"===i?te(p)[1]:te(p)[0]}return t(e).length?"x"===i?te(t(e))[1]:te(t(e))[0]:(a.css(d,e),void u.update.call(null,n[0]))}}},j=function(e){function i(){return clearTimeout(f[0].autoUpdate),0===a.parents("html").length?void(a=null):void(f[0].autoUpdate=setTimeout(function(){return h.advanced.updateOnSelectorChange&&(l.poll.change.n=o(),l.poll.change.n!==l.poll.change.o)?(l.poll.change.o=l.poll.change.n,void s(3)):h.advanced.updateOnContentResize&&(l.poll.size.n=a[0].scrollHeight+a[0].scrollWidth+f[0].offsetHeight+a[0].offsetHeight+a[0].offsetWidth,l.poll.size.n!==l.poll.size.o)?(l.poll.size.o=l.poll.size.n,void s(1)):!h.advanced.updateOnImageLoad||"auto"===h.advanced.updateOnImageLoad&&"y"===h.axis||(l.poll.img.n=f.find("img").length,l.poll.img.n===l.poll.img.o)?void((h.advanced.updateOnSelectorChange||h.advanced.updateOnContentResize||h.advanced.updateOnImageLoad)&&i()):(l.poll.img.o=l.poll.img.n,void f.find("img").each(function(){n(this)}))},h.advanced.autoUpdateTimeout))}function n(e){function i(){this.onload=null,t(e).addClass(c[2]),s(2)}if(t(e).hasClass(c[2]))return void s();var r=new Image;r.onload=function(e,t){return function(){return t.apply(e,arguments)}}(r,i),r.src=e.src}function o(){!0===h.advanced.updateOnSelectorChange&&(h.advanced.updateOnSelectorChange="*");var e=0,t=f.find(h.advanced.updateOnSelectorChange);return h.advanced.updateOnSelectorChange&&t.length>0&&t.each(function(){e+=this.offsetHeight+this.offsetWidth}),e}function s(e){clearTimeout(f[0].autoUpdate),u.update.call(null,a[0],e)}var a=t(this),l=a.data(r),h=l.opt,f=t("#mCSB_"+l.idx+"_container");return e?(clearTimeout(f[0].autoUpdate),void Z(f[0],"autoUpdate")):void i()},W=function(e,t,i){return Math.round(e/t)*t-i},X=function(e){var i=e.data(r);t("#mCSB_"+i.idx+"_container,#mCSB_"+i.idx+"_container_wrapper,#mCSB_"+i.idx+"_dragger_vertical,#mCSB_"+i.idx+"_dragger_horizontal").each(function(){Q.call(this)})},Y=function(e,i,n){function o(e){return l&&h.callbacks[e]&&"function"==typeof h.callbacks[e]}function s(){return[h.callbacks.alwaysTriggerOffsets||b>=x[0]+S,h.callbacks.alwaysTriggerOffsets||-w>=b]}function a(){var t=[d[0].offsetTop,d[0].offsetLeft],i=[y[0].offsetTop,y[0].offsetLeft],r=[d.outerHeight(!1),d.outerWidth(!1)],o=[f.height(),f.width()];e[0].mcs={content:d,top:t[0],left:t[1],draggerTop:i[0],draggerLeft:i[1],topPct:Math.round(100*Math.abs(t[0])/(Math.abs(r[0])-o[0])),leftPct:Math.round(100*Math.abs(t[1])/(Math.abs(r[1])-o[1])),direction:n.dir}}var l=e.data(r),h=l.opt,c={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:h.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=t.extend(c,n),u=[n.dur,n.drag?0:n.dur],f=t("#mCSB_"+l.idx),d=t("#mCSB_"+l.idx+"_container"),p=d.parent(),m=h.callbacks.onTotalScrollOffset?G.call(e,h.callbacks.onTotalScrollOffset):[0,0],g=h.callbacks.onTotalScrollBackOffset?G.call(e,h.callbacks.onTotalScrollBackOffset):[0,0];if(l.trigger=n.trigger,(0!==p.scrollTop()||0!==p.scrollLeft())&&(t(".mCSB_"+l.idx+"_scrollbar").css("visibility","visible"),p.scrollTop(0).scrollLeft(0)),"_resetY"!==i||l.contentReset.y||(o("onOverflowYNone")&&h.callbacks.onOverflowYNone.call(e[0]),l.contentReset.y=1),"_resetX"!==i||l.contentReset.x||(o("onOverflowXNone")&&h.callbacks.onOverflowXNone.call(e[0]),l.contentReset.x=1),"_resetY"!==i&&"_resetX"!==i){if(!l.contentReset.y&&e[0].mcs||!l.overflowed[0]||(o("onOverflowY")&&h.callbacks.onOverflowY.call(e[0]),l.contentReset.x=null),!l.contentReset.x&&e[0].mcs||!l.overflowed[1]||(o("onOverflowX")&&h.callbacks.onOverflowX.call(e[0]),l.contentReset.x=null),h.snapAmount){var v=h.snapAmount instanceof Array?"x"===n.dir?h.snapAmount[1]:h.snapAmount[0]:h.snapAmount;i=W(i,v,h.snapOffset)}switch(n.dir){case"x":var y=t("#mCSB_"+l.idx+"_dragger_horizontal"),_="left",b=d[0].offsetLeft,x=[f.width()-d.outerWidth(!1),y.parent().width()-y.width()],T=[i,0===i?0:i/l.scrollRatio.x],S=m[1],w=g[1],M=S>0?S/l.scrollRatio.x:0,A=w>0?w/l.scrollRatio.x:0;break;case"y":var y=t("#mCSB_"+l.idx+"_dragger_vertical"),_="top",b=d[0].offsetTop,x=[f.height()-d.outerHeight(!1),y.parent().height()-y.height()],T=[i,0===i?0:i/l.scrollRatio.y],S=m[0],w=g[0],M=S>0?S/l.scrollRatio.y:0,A=w>0?w/l.scrollRatio.y:0}T[1]<0||0===T[0]&&0===T[1]?T=[0,0]:T[1]>=x[1]?T=[x[0],x[1]]:T[0]=-T[0],e[0].mcs||(a(),o("onInit")&&h.callbacks.onInit.call(e[0])),clearTimeout(d[0].onCompleteTimeout),K(y[0],_,Math.round(T[1]),u[1],n.scrollEasing),(l.tweenRunning||!(0===b&&T[0]>=0||b===x[0]&&T[0]<=x[0]))&&K(d[0],_,Math.round(T[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!l.tweenRunning&&(o("onScrollStart")&&(a(),h.callbacks.onScrollStart.call(e[0])),l.tweenRunning=!0,E(y),l.cbOffsets=s())},onUpdate:function(){n.callbacks&&n.onUpdate&&o("whileScrolling")&&(a(),h.callbacks.whileScrolling.call(e[0]))},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===h.axis&&clearTimeout(d[0].onCompleteTimeout);var t=d[0].idleTimer||0;d[0].onCompleteTimeout=setTimeout(function(){o("onScroll")&&(a(),h.callbacks.onScroll.call(e[0])),o("onTotalScroll")&&T[1]>=x[1]-M&&l.cbOffsets[0]&&(a(),h.callbacks.onTotalScroll.call(e[0])),o("onTotalScrollBack")&&T[1]<=A&&l.cbOffsets[1]&&(a(),h.callbacks.onTotalScrollBack.call(e[0])),l.tweenRunning=!1,d[0].idleTimer=0,E(y,"hide")},t)}}})}},K=function(e,t,i,r,n,o,s){function a(){_.stop||(g||f.call(),g=q()-m,l(),g>=_.time&&(_.time=g>_.time?g+c-(g-_.time):g+c-1,_.time<g+1&&(_.time=g+1)),_.time<r?_.id=u(a):p.call())}function l(){r>0?(_.currVal=h(_.time,v,b,r,n),y[t]=Math.round(_.currVal)+"px"):y[t]=i+"px",d.call()}function h(e,t,i,r,n){switch(n){case"linear":case"mcsLinear":return i*e/r+t;case"mcsLinearOut":return e/=r,e--,i*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=r/2,1>e?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=r/2,1>e?i/2*Math.pow(2,10*(e-1))+t:(e--,i/2*(2-Math.pow(2,-10*e))+t);case"easeInOut":case"mcsEaseInOut":return e/=r/2,1>e?i/2*e*e*e+t:(e-=2,i/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=r,e--,-i*(e*e*e*e-1)+t;case"easeOutStrong":return i*(1-Math.pow(2,-10*e/r))+t;case"easeOut":case"mcsEaseOut":default:var o=(e/=r)*e,s=o*e;return t+i*(.499999999999997*s*o+-2.5*o*o+5.5*s+-6.5*o+4*e)}}e._mTween||(e._mTween={top:{},left:{}});var c,u,s=s||{},f=s.onStart||function(){},d=s.onUpdate||function(){},p=s.onComplete||function(){},m=q(),g=0,v=e.offsetTop,y=e.style,_=e._mTween[t];"left"===t&&(v=e.offsetLeft);var b=i-v;_.stop=0,"none"!==o&&function(){null!=_.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(_.id):clearTimeout(_.id),_.id=null)}(),function(){c=1e3/60,_.time=g+c,u=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return l(),setTimeout(e,.01)},_.id=u(a)}()},q=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Q=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],i=0;i<t.length;i++){var r=t[i];e._mTween[r].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[r].id):clearTimeout(e._mTween[r].id),e._mTween[r].id=null,e._mTween[r].stop=1)}},Z=function(e,t){try{delete e[t]}catch(i){e[t]=null}},J=function(e){return!(e.which&&1!==e.which)},$=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},ee=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},te=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]},ie=function(){var e=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();return!!e&&document[e]};t.fn[i]=function(e){return u[e]?u[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist"):u.init.apply(this,arguments)},t[i]=function(e){return u[e]?u[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist"):u.init.apply(this,arguments)},t[i].defaults=o,window[i]=!0,t(window).load(function(){t(n)[i](),t.extend(t.expr[":"],{mcsInView:t.expr[":"].mcsInView||function(e){var i,r,n=t(e),o=n.parents(".mCSB_container");if(o.length)return i=o.parent(),r=[o[0].offsetTop,o[0].offsetLeft],r[0]+te(n)[0]>=0&&r[0]+te(n)[0]<i.height()-n.outerHeight(!1)&&r[1]+te(n)[1]>=0&&r[1]+te(n)[1]<i.width()-n.outerWidth(!1)},mcsOverflow:t.expr[":"].mcsOverflow||function(e){var i=t(e).data(r);if(i)return i.overflowed[0]||i.overflowed[1]}})})}()}()})},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,i){var r=!1;(function(){/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 */
!function(t){"function"==typeof r&&r.amd?r(["jquery"],t):e.exports=t}(function(e){function t(t){var s=t||window.event,a=l.call(arguments,1),h=0,u=0,f=0,d=0,p=0,m=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(f=-1*s.detail),"wheelDelta"in s&&(f=s.wheelDelta),"wheelDeltaY"in s&&(f=s.wheelDeltaY),"wheelDeltaX"in s&&(u=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(u=-1*f,f=0),h=0===f?u:f,"deltaY"in s&&(f=-1*s.deltaY,h=f),"deltaX"in s&&(u=s.deltaX,0===f&&(h=-1*u)),0!==f||0!==u){if(1===s.deltaMode){var g=e.data(this,"mousewheel-line-height");h*=g,f*=g,u*=g}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");h*=v,f*=v,u*=v}if(d=Math.max(Math.abs(f),Math.abs(u)),(!o||d<o)&&(o=d,r(s,d)&&(o/=40)),r(s,d)&&(h/=40,u/=40,f/=40),h=Math[h>=1?"floor":"ceil"](h/o),u=Math[u>=1?"floor":"ceil"](u/o),f=Math[f>=1?"floor":"ceil"](f/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();p=t.clientX-y.left,m=t.clientY-y.top}return t.deltaX=u,t.deltaY=f,t.deltaFactor=o,t.offsetX=p,t.offsetY=m,t.deltaMode=0,a.unshift(t,h,u,f),n&&clearTimeout(n),n=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function i(){o=null}function r(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var n,o,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var h=s.length;h;)e.event.fixHooks[s[--h]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=a.length;i;)this.addEventListener(a[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=a.length;i;)this.removeEventListener(a[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),r=i["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})}).call(window)},function(module,exports){/*! PixiParticles 1.4.6 */
!function(){"use strict";!function(e){window.cloudkid=window.cloudkid||{};var t=PIXI.BLEND_MODES||PIXI.blendModes,i={},r=i.DEG_TO_RADS=Math.PI/180;i.rotatePoint=function(e,t){if(e){e*=r;var i=Math.sin(e),n=Math.cos(e),o=t.x*n-t.y*i,s=t.x*i+t.y*n;t.x=o,t.y=s}},i.combineRGBComponents=function(e,t,i){return e<<16|t<<8|i},i.normalize=function(e){var t=1/i.length(e);e.x*=t,e.y*=t},i.scaleBy=function(e,t){e.x*=t,e.y*=t},i.length=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},i.hexToRGB=function(e,t){t?t.length=0:t=[],"#"==e.charAt(0)?e=e.substr(1):0===e.indexOf("0x")&&(e=e.substr(2));var i;return 8==e.length&&(i=e.substr(0,2),e=e.substr(2)),t.push(parseInt(e.substr(0,2),16)),t.push(parseInt(e.substr(2,2),16)),t.push(parseInt(e.substr(4,2),16)),i&&t.push(parseInt(i,16)),t},i.generateEase=function(e){var t=e.length,i=1/t;return function(r){var n,o,s=t*r|0;return n=(r-s*i)*t,o=e[s]||e[t-1],o.s+n*(2*(1-n)*(o.cp-o.s)+n*(o.e-o.s))}},i.getBlendMode=function(e){if(!e)return t.NORMAL;for(e=e.toUpperCase();e.indexOf(" ")>=0;)e=e.replace(" ","_");return t[e]||t.NORMAL},cloudkid.ParticleUtils=i,Array.prototype.shuffle||Object.defineProperty(Array.prototype,"shuffle",{enumerable:!1,writable:!1,value:function(){for(var e,t,i=this.length;i;e=Math.floor(Math.random()*i),t=this[--i],this[i]=this[e],this[e]=t);return this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"random",{enumerable:!1,writable:!1,value:function(){return this[Math.floor(Math.random()*this.length)]}})}(),function(e,t){var i,r,n=e.ParticleUtils;PIXI.extras&&PIXI.extras.MovieClip?(i=PIXI.extras.MovieClip,r=!0):(i=PIXI.MovieClip,r=!1);var o=function(e){var t=e.particleImages[0]instanceof PIXI.Texture?[e.particleImages[0]]:e.particleImages[0];i.call(this,t),this.emitter=e,this.anchor.x=this.anchor.y=.5,this.velocity=new PIXI.Point,this.maxLife=0,this.age=0,this.ease=null,this.extraData=null,this.startAlpha=0,this.endAlpha=0,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=0,this.endScale=0,this.startColor=null,this._sR=0,this._sG=0,this._sB=0,this.endColor=null,this._eR=0,this._eG=0,this._eB=0,this._doAlpha=!1,this._doScale=!1,this._doSpeed=!1,this._doColor=!1,this._doNormalMovement=!1,this._oneOverLife=0,this.init=this.init,this.Particle_init=this.Particle_init,this.update=this.update,this.Particle_update=this.Particle_update,this.applyArt=this.applyArt,this.kill=this.kill},s=o.prototype=Object.create(i.prototype);s.init=s.Particle_init=function(){this.age=0,this.velocity.x=this.startSpeed,this.velocity.y=0,n.rotatePoint(this.rotation,this.velocity),this.rotation*=n.DEG_TO_RADS,this.rotationSpeed*=n.DEG_TO_RADS,this.alpha=this.startAlpha,this.scale.x=this.scale.y=this.startScale,this.startColor&&(this._sR=this.startColor[0],this._sG=this.startColor[1],this._sB=this.startColor[2],this.endColor&&(this._eR=this.endColor[0],this._eG=this.endColor[1],this._eB=this.endColor[2])),this._doAlpha=this.startAlpha!=this.endAlpha,this._doSpeed=this.startSpeed!=this.endSpeed,this._doScale=this.startScale!=this.endScale,this._doColor=!!this.endColor,this._doNormalMovement=this._doSpeed||0!==this.startSpeed||this.acceleration,this._oneOverLife=1/this.maxLife,this.tint=n.combineRGBComponents(this._sR,this._sG,this._sB),this.visible=!0},s.applyArt=function(e){r?this.texture=e:this.setTexture(e)},s.update=s.Particle_update=function(e){if(this.age+=e,this.age>=this.maxLife)return this.kill(),-1;var t=this.age*this._oneOverLife;if(this.ease&&(t=4==this.ease.length?this.ease(t,0,1,1):this.ease(t)),this._doAlpha&&(this.alpha=(this.endAlpha-this.startAlpha)*t+this.startAlpha),this._doScale){var i=(this.endScale-this.startScale)*t+this.startScale;this.scale.x=this.scale.y=i}if(this._doNormalMovement){if(this._doSpeed){var r=(this.endSpeed-this.startSpeed)*t+this.startSpeed;n.normalize(this.velocity),n.scaleBy(this.velocity,r)}else this.acceleration&&(this.velocity.x+=this.acceleration.x*e,this.velocity.y+=this.acceleration.y*e);this.position.x+=this.velocity.x*e,this.position.y+=this.velocity.y*e}if(this._doColor){var o=(this._eR-this._sR)*t+this._sR,s=(this._eG-this._sG)*t+this._sG,a=(this._eB-this._sB)*t+this._sB;this.tint=n.combineRGBComponents(o,s,a)}return 0!==this.rotationSpeed?this.rotation+=this.rotationSpeed*e:this.acceleration&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x)),t},s.kill=function(){this.emitter.recycle(this)},s.destroy=function(){this.emitter=null,this.velocity=null,this.startColor=this.endColor=null,this.ease=null},e.Particle=o}(cloudkid),function(cloudkid,undefined){var ParticleUtils=cloudkid.ParticleUtils,Particle=cloudkid.Particle,PathParticle=function(e){Particle.call(this,e),this.path=null,this.initialRotation=0,this.initialPosition=new PIXI.Point,this.movement=0},s=Particle.prototype,p=PathParticle.prototype=Object.create(s),helperPoint=new PIXI.Point;p.init=function(){if(this.initialRotation=this.rotation,this.Particle_init(),this.extraData&&this.extraData.path){var e=this.emitter._sharedExtraData;if(e.path!==undefined)this.path=e.path;else try{this.path=e.path=parsePath(this.extraData.path)}catch(t){console.error("PathParticle: error in parsing path expression"),this.path=e.path=null}}else console.error("PathParticle requires a path string in extraData!"),this.path=null;this._doNormalMovement=!this.path,this.movement=0,this.initialPosition.x=this.position.x,this.initialPosition.y=this.position.y};for(var MATH_FUNCS=["pow","sqrt","abs","floor","round","ceil","E","PI","sin","cos","tan","asin","acos","atan","atan2","log"],WHITELISTER="[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]",index=MATH_FUNCS.length-1;index>=0;--index)WHITELISTER+="|"+MATH_FUNCS[index];WHITELISTER=new RegExp(WHITELISTER,"g");var parsePath=function(pathString){for(var rtn,matches=pathString.match(WHITELISTER),i=matches.length-1;i>=0;--i)MATH_FUNCS.indexOf(matches[i])>=0&&(matches[i]="Math."+matches[i]);return pathString=matches.join(""),eval("rtn = function(x){ return "+pathString+"; };"),rtn};p.update=function(e){var t=this.Particle_update(e);if(t>=0&&this.path){var i=(this.endSpeed-this.startSpeed)*t+this.startSpeed;this.movement+=i*e,helperPoint.x=this.movement,helperPoint.y=this.path(this.movement),ParticleUtils.rotatePoint(this.initialRotation,helperPoint),this.position.x=this.initialPosition.x+helperPoint.x,this.position.y=this.initialPosition.y+helperPoint.y}},p.destroy=function(){s.destroy.call(this)},cloudkid.PathParticle=PathParticle}(cloudkid),function(e,t){var i=(e.ParticleUtils,e.Particle),r=function(e){i.call(this,e),this._helperTextures=[]},n=i.prototype,o=r.prototype=Object.create(n);o.init=function(){if(this.Particle_init(),this.extraData){this.extraData.fps?this.fps=this.extraData.fps:this.fps=60;var e=this.extraData.animationSpeed||1;"matchLife"==e?(this.loop=!1,this.hasOwnProperty("_duration")?this.animationSpeed=this._duration/this.maxLife:this.animationSpeed=this.textures.length/this.maxLife/60):(this.loop=!0,this.animationSpeed=e)}else this.loop=!0,this.animationSpeed=1;this.play()},o.applyArt=function(e){Array.isArray(e)?this.textures=e:(this._helperTextures[0]=e,this.textures=this._helperTextures),this.gotoAndStop(0)},o.update=function(e){this.Particle_update(e)>=0&&this._duration&&this.updateAnim(e)},o.destroy=function(){n.destroy.call(this)},e.AnimatedParticle=r}(cloudkid),function(e,t){var i=e.ParticleUtils,r=e.Particle,n=PIXI.ParticleContainer,o=function(e,t,i){this._particleConstructor=r,this.particleImages=null,this.startAlpha=1,this.endAlpha=1,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=1,this.endScale=1,this.minimumScaleMultiplier=1,this.startColor=null,this.endColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this.frequency=0,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this._parentIsPC=!1,this._parent=null,this.addAtBack=!1,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticles=[],this._pool=[],this._sharedExtraData=null,this.parent=e,t&&i&&this.init(t,i),this.recycle=this.recycle,this.update=this.update,this.rotate=this.rotate,this.updateSpawnPos=this.updateSpawnPos,this.updateOwnerPos=this.updateOwnerPos},s=o.prototype={},a=new PIXI.Point;Object.defineProperty(s,"particleConstructor",{get:function(){return this._particleConstructor},set:function(e){e!=this._particleConstructor&&(this._particleConstructor=e,this.cleanup(),this._activeParticles.length&&(this._activeParticles.length=0),this._pool.length&&(this._pool.length=0))}}),Object.defineProperty(s,"parent",{get:function(){return this._parent},set:function(e){this.cleanup(),this._parent=e,this._parentIsPC=n&&e&&e instanceof n}}),s.init=function(e,t){if(e&&t){this.cleanup(),this.particleImages=e instanceof PIXI.Texture?[e]:e,t.alpha?(this.startAlpha=t.alpha.start,this.endAlpha=t.alpha.end):this.startAlpha=this.endAlpha=1,t.speed?(this.startSpeed=t.speed.start,this.endSpeed=t.speed.end):this.startSpeed=this.endSpeed=0;var r=t.acceleration;r&&(r.x||r.y)?(this.endSpeed=this.startSpeed,this.acceleration=new PIXI.Point(r.x,r.y)):this.acceleration=null,t.scale?(this.startScale=t.scale.start,this.endScale=t.scale.end,this.minimumScaleMultiplier=t.scale.minimumScaleMultiplier||1):this.startScale=this.endScale=this.minimumScaleMultiplier=1,t.color&&(this.startColor=i.hexToRGB(t.color.start),t.color.start!=t.color.end?this.endColor=i.hexToRGB(t.color.end):this.endColor=null),t.startRotation?(this.minStartRotation=t.startRotation.min,this.maxStartRotation=t.startRotation.max):this.minStartRotation=this.maxStartRotation=0,t.rotationSpeed?(this.minRotationSpeed=t.rotationSpeed.min,this.maxRotationSpeed=t.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,this.particleBlendMode=i.getBlendMode(t.blendMode),t.ease?this.customEase="function"==typeof t.ease?t.ease:i.generateEase(t.ease):this.customEase=null,this.extraData=t.extraData||null,this._sharedExtraData={},this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0;var n;switch(t.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var o=t.spawnRect;this.spawnRect=new PIXI.Rectangle(o.x,o.y,o.w,o.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle,n=t.spawnCircle,this.spawnCircle=new PIXI.Circle(n.x,n.y,n.r);break;case"ring":this.spawnType="ring",this._spawnFunc=this._spawnRing,n=t.spawnCircle,this.spawnCircle=new PIXI.Circle(n.x,n.y,n.r),this.spawnCircle.minRadius=n.minR;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particlesPerWave=t.particlesPerWave,this.particleSpacing=t.particleSpacing,this.angleStart=t.angleStart?t.angleStart:0;break;case"point":this.spawnType="point",this._spawnFunc=this._spawnPoint;break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}this.frequency=t.frequency,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos=new PIXI.Point,this.spawnPos=new PIXI.Point(t.pos.x,t.pos.y),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=!0}},s.recycle=function(e){var t=this._activeParticles.indexOf(e);t<this._activeParticles.length-1&&(this._activeParticles[t]=this._activeParticles[this._activeParticles.length-1]),this._activeParticles.pop(),this._pool.push(e),this._parentIsPC?(e.alpha=0,e.visible=!1):e.parent&&e.parent.removeChild(e)},s.rotate=function(e){if(this.rotation!=e){var t=e-this.rotation;this.rotation=e,i.rotatePoint(t,this.spawnPos),this._posChanged=!0}},s.updateSpawnPos=function(e,t){this._posChanged=!0,this.spawnPos.x=e,this.spawnPos.y=t},s.updateOwnerPos=function(e,t){this._posChanged=!0,this.ownerPos.x=e,this.ownerPos.y=t},s.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(s,"emit",{get:function(){return this._emit},set:function(e){this._emit=!!e,this._emitterLife=this.emitterLifetime}}),s.update=function(e){var t,i=this._activeParticles;for(t=i.length-1;t>=0;--t)i[t].update(e);var r,n;this._prevPosIsValid&&(r=this._prevEmitterPos.x,n=this._prevEmitterPos.y);var o=this.ownerPos.x+this.spawnPos.x,s=this.ownerPos.y+this.spawnPos.y;if(this.emit)for(this._spawnTimer-=e;this._spawnTimer<=0;){if(this._emitterLife>0&&(this._emitterLife-=this.frequency,this._emitterLife<=0)){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}if(this._activeParticles.length>=this.maxParticles)this._spawnTimer+=this.frequency;else{var a;if(a=this.minLifetime==this.maxLifetime?this.minLifetime:Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime,-this._spawnTimer<a){var l,h;if(this._prevPosIsValid&&this._posChanged){var c=1+this._spawnTimer/e;l=(o-r)*c+r,h=(s-n)*c+n}else l=o,h=s;t=0;for(var u=Math.min(this.particlesPerWave,this.maxParticles-this._activeParticles.length);u>t;++t){var f=this._pool.length?this._pool.pop():new this.particleConstructor(this);if(this.particleImages.length>1?f.applyArt(this.particleImages.random()):f.applyArt(this.particleImages[0]),f.startAlpha=this.startAlpha,f.endAlpha=this.endAlpha,f.startSpeed=this.startSpeed,f.endSpeed=this.endSpeed,f.acceleration=this.acceleration,1!=this.minimumScaleMultiplier){var d=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier;f.startScale=this.startScale*d,f.endScale=this.endScale*d}else f.startScale=this.startScale,f.endScale=this.endScale;if(f.startColor=this.startColor,f.endColor=this.endColor,this.minRotationSpeed==this.maxRotationSpeed?f.rotationSpeed=this.minRotationSpeed:f.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,f.maxLife=a,f.blendMode=this.particleBlendMode,f.ease=this.customEase,f.extraData=this.extraData,this._spawnFunc(f,l,h,t),f.init(),f.update(-this._spawnTimer),this._parentIsPC&&f.parent){var p=this._parent.children,m=p.indexOf(f);1>m?p.shift():m==p.length-1?p.pop():p.splice(m,1),this.addAtBack?p.unshift(f):p.push(f)}else this.addAtBack?this._parent.addChildAt(f,0):this._parent.addChild(f);i.push(f)}}this._spawnTimer+=this.frequency}}this._posChanged&&(this._prevEmitterPos.x=o,this._prevEmitterPos.y=s,this._prevPosIsValid=!0,this._posChanged=!1)},s._spawnPoint=function(e,t,i,r){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,e.position.x=t,e.position.y=i},s._spawnRect=function(e,t,r,n){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,a.x=Math.random()*this.spawnRect.width+this.spawnRect.x,a.y=Math.random()*this.spawnRect.height+this.spawnRect.y,0!==this.rotation&&i.rotatePoint(this.rotation,a),e.position.x=t+a.x,e.position.y=r+a.y},s._spawnCircle=function(e,t,r,n){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,a.x=Math.random()*this.spawnCircle.radius,a.y=0,i.rotatePoint(360*Math.random(),a),a.x+=this.spawnCircle.x,a.y+=this.spawnCircle.y,0!==this.rotation&&i.rotatePoint(this.rotation,a),e.position.x=t+a.x,e.position.y=r+a.y},s._spawnRing=function(e,t,r,n){var o=this.spawnCircle;this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,o.minRadius==o.radius?a.x=Math.random()*(o.radius-o.minRadius)+o.minRadius:a.x=o.radius,a.y=0;var s=360*Math.random();e.rotation+=s,i.rotatePoint(s,a),a.x+=this.spawnCircle.x,a.y+=this.spawnCircle.y,0!==this.rotation&&i.rotatePoint(this.rotation,a),e.position.x=t+a.x,e.position.y=r+a.y},s._spawnBurst=function(e,t,i,r){0===this.particleSpacing?e.rotation=360*Math.random():e.rotation=this.angleStart+this.particleSpacing*r+this.rotation,e.position.x=t,e.position.y=i},s.cleanup=function(){for(var e=this._activeParticles.length-1;e>=0;--e){var t=this._activeParticles[e];this.recycle(t),t.parent&&t.parent.removeChild(t)}},s.destroy=function(){this.cleanup();for(var e=this._pool.length-1;e>=0;--e)this._pool[e].destroy();this._pool=null,this._activeParticles=null,this._parent=null,this.particleImages=null,this.spawnPos=null,this.ownerPos=null,this.startColor=null,this.endColor=null,this.customEase=null},e.Emitter=o}(cloudkid)}()}]);